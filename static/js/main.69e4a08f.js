/*! For license information please see main.69e4a08f.js.LICENSE.txt */
(()=>{var __webpack_modules__={638:(e,t,i)=>{e.exports={default:i(7478),__esModule:!0}},7151:(e,t,i)=>{e.exports={default:i(327),__esModule:!0}},5560:(e,t,i)=>{e.exports={default:i(6896),__esModule:!0}},7360:(e,t,i)=>{e.exports={default:i(9368),__esModule:!0}},1164:(e,t,i)=>{e.exports={default:i(1956),__esModule:!0}},6247:(e,t,i)=>{e.exports={default:i(4232),__esModule:!0}},4716:(e,t,i)=>{e.exports={default:i(7044),__esModule:!0}},6731:(e,t)=>{"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},2239:(e,t,i)=>{"use strict";t.__esModule=!0;var r,n=i(5560),a=(r=n)&&r.__esModule?r:{default:r};t.default=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,a.default)(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}()},4414:(e,t,i)=>{"use strict";t.__esModule=!0;var r,n=i(638),a=(r=n)&&r.__esModule?r:{default:r};t.default=a.default||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e}},6835:(e,t,i)=>{"use strict";t.__esModule=!0;var r=o(i(1164)),n=o(i(7151)),a=o(i(6926));function o(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"===typeof t?"undefined":(0,a.default)(t)));e.prototype=(0,n.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(r.default?(0,r.default)(e,t):e.__proto__=t)}},1912:(e,t,i)=>{"use strict";t.__esModule=!0;var r,n=i(6926),a=(r=n)&&r.__esModule?r:{default:r};t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"===typeof t?"undefined":(0,a.default)(t))&&"function"!==typeof t?e:t}},6926:(e,t,i)=>{"use strict";t.__esModule=!0;var r=o(i(4716)),n=o(i(6247)),a="function"===typeof n.default&&"symbol"===typeof r.default?function(e){return typeof e}:function(e){return e&&"function"===typeof n.default&&e.constructor===n.default&&e!==n.default.prototype?"symbol":typeof e};function o(e){return e&&e.__esModule?e:{default:e}}t.default="function"===typeof n.default&&"symbol"===a(r.default)?function(e){return"undefined"===typeof e?"undefined":a(e)}:function(e){return e&&"function"===typeof n.default&&e.constructor===n.default&&e!==n.default.prototype?"symbol":"undefined"===typeof e?"undefined":a(e)}},7478:(e,t,i)=>{i(3430),e.exports=i(2206).Object.assign},327:(e,t,i)=>{i(6279);var r=i(2206).Object;e.exports=function(e,t){return r.create(e,t)}},6896:(e,t,i)=>{i(4752);var r=i(2206).Object;e.exports=function(e,t,i){return r.defineProperty(e,t,i)}},9368:(e,t,i)=>{i(2408),e.exports=i(2206).Object.getPrototypeOf},1956:(e,t,i)=>{i(4996),e.exports=i(2206).Object.setPrototypeOf},4232:(e,t,i)=>{i(5842),i(6010),i(9380),i(9444),e.exports=i(2206).Symbol},7044:(e,t,i)=>{i(8271),i(4098),e.exports=i(5624).f("iterator")},9147:e=>{e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},5048:e=>{e.exports=function(){}},1908:(e,t,i)=>{var r=i(9785);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},3176:(e,t,i)=>{var r=i(8021),n=i(621),a=i(8749);e.exports=function(e){return function(t,i,o){var s,l=r(t),c=n(l.length),h=a(o,c);if(e&&i!=i){for(;c>h;)if((s=l[h++])!=s)return!0}else for(;c>h;h++)if((e||h in l)&&l[h]===i)return e||h||0;return!e&&-1}}},2929:e=>{var t={}.toString;e.exports=function(e){return t.call(e).slice(8,-1)}},2206:e=>{var t=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=t)},4892:(e,t,i)=>{var r=i(9147);e.exports=function(e,t,i){if(r(e),void 0===t)return e;switch(i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,r){return e.call(t,i,r)};case 3:return function(i,r,n){return e.call(t,i,r,n)}}return function(){return e.apply(t,arguments)}}},2112:e=>{e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},1843:(e,t,i)=>{e.exports=!i(5912)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},2770:(e,t,i)=>{var r=i(9785),n=i(86).document,a=r(n)&&r(n.createElement);e.exports=function(e){return a?n.createElement(e):{}}},8620:e=>{e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},8657:(e,t,i)=>{var r=i(847),n=i(6164),a=i(5425);e.exports=function(e){var t=r(e),i=n.f;if(i)for(var o,s=i(e),l=a.f,c=0;s.length>c;)l.call(e,o=s[c++])&&t.push(o);return t}},7503:(e,t,i)=>{var r=i(86),n=i(2206),a=i(4892),o=i(1773),s=i(685),l="prototype",c=function(e,t,i){var h,u,d,p=e&c.F,f=e&c.G,m=e&c.S,g=e&c.P,_=e&c.B,y=e&c.W,v=f?n:n[t]||(n[t]={}),x=v[l],b=f?r:m?r[t]:(r[t]||{})[l];for(h in f&&(i=t),i)(u=!p&&b&&void 0!==b[h])&&s(v,h)||(d=u?b[h]:i[h],v[h]=f&&"function"!=typeof b[h]?i[h]:_&&u?a(d,r):y&&b[h]==d?function(e){var t=function(t,i,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,i)}return new e(t,i,r)}return e.apply(this,arguments)};return t[l]=e[l],t}(d):g&&"function"==typeof d?a(Function.call,d):d,g&&((v.virtual||(v.virtual={}))[h]=d,e&c.R&&x&&!x[h]&&o(x,h,d)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},5912:e=>{e.exports=function(e){try{return!!e()}catch(t){return!0}}},86:e=>{var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)},685:e=>{var t={}.hasOwnProperty;e.exports=function(e,i){return t.call(e,i)}},1773:(e,t,i)=>{var r=i(7087),n=i(7228);e.exports=i(1843)?function(e,t,i){return r.f(e,t,n(1,i))}:function(e,t,i){return e[t]=i,e}},9628:(e,t,i)=>{var r=i(86).document;e.exports=r&&r.documentElement},2700:(e,t,i)=>{e.exports=!i(1843)&&!i(5912)((function(){return 7!=Object.defineProperty(i(2770)("div"),"a",{get:function(){return 7}}).a}))},9809:(e,t,i)=>{var r=i(2929);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},1037:(e,t,i)=>{var r=i(2929);e.exports=Array.isArray||function(e){return"Array"==r(e)}},9785:e=>{e.exports=function(e){return"object"===typeof e?null!==e:"function"===typeof e}},7872:(e,t,i)=>{"use strict";var r=i(399),n=i(7228),a=i(9108),o={};i(1773)(o,i(4038)("iterator"),(function(){return this})),e.exports=function(e,t,i){e.prototype=r(o,{next:n(1,i)}),a(e,t+" Iterator")}},8655:(e,t,i)=>{"use strict";var r=i(4510),n=i(7503),a=i(2779),o=i(1773),s=i(7018),l=i(7872),c=i(9108),h=i(755),u=i(4038)("iterator"),d=!([].keys&&"next"in[].keys()),p="keys",f="values",m=function(){return this};e.exports=function(e,t,i,g,_,y,v){l(i,t,g);var x,b,w,S=function(e){if(!d&&e in A)return A[e];switch(e){case p:case f:return function(){return new i(this,e)}}return function(){return new i(this,e)}},T=t+" Iterator",E=_==f,M=!1,A=e.prototype,P=A[u]||A["@@iterator"]||_&&A[_],C=P||S(_),I=_?E?S("entries"):C:void 0,k="Array"==t&&A.entries||P;if(k&&(w=h(k.call(new e)))!==Object.prototype&&w.next&&(c(w,T,!0),r||"function"==typeof w[u]||o(w,u,m)),E&&P&&P.name!==f&&(M=!0,C=function(){return P.call(this)}),r&&!v||!d&&!M&&A[u]||o(A,u,C),s[t]=C,s[T]=m,_)if(x={values:E?C:S(f),keys:y?C:S(p),entries:I},v)for(b in x)b in A||a(A,b,x[b]);else n(n.P+n.F*(d||M),t,x);return x}},8762:e=>{e.exports=function(e,t){return{value:t,done:!!e}}},7018:e=>{e.exports={}},4510:e=>{e.exports=!0},7388:(e,t,i)=>{var r=i(6559)("meta"),n=i(9785),a=i(685),o=i(7087).f,s=0,l=Object.isExtensible||function(){return!0},c=!i(5912)((function(){return l(Object.preventExtensions({}))})),h=function(e){o(e,r,{value:{i:"O"+ ++s,w:{}}})},u=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!n(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!a(e,r)){if(!l(e))return"F";if(!t)return"E";h(e)}return e[r].i},getWeak:function(e,t){if(!a(e,r)){if(!l(e))return!0;if(!t)return!1;h(e)}return e[r].w},onFreeze:function(e){return c&&u.NEED&&l(e)&&!a(e,r)&&h(e),e}}},2430:(e,t,i)=>{"use strict";var r=i(1843),n=i(847),a=i(6164),o=i(5425),s=i(862),l=i(9809),c=Object.assign;e.exports=!c||i(5912)((function(){var e={},t={},i=Symbol(),r="abcdefghijklmnopqrst";return e[i]=7,r.split("").forEach((function(e){t[e]=e})),7!=c({},e)[i]||Object.keys(c({},t)).join("")!=r}))?function(e,t){for(var i=s(e),c=arguments.length,h=1,u=a.f,d=o.f;c>h;)for(var p,f=l(arguments[h++]),m=u?n(f).concat(u(f)):n(f),g=m.length,_=0;g>_;)p=m[_++],r&&!d.call(f,p)||(i[p]=f[p]);return i}:c},399:(e,t,i)=>{var r=i(1908),n=i(9802),a=i(8620),o=i(254)("IE_PROTO"),s=function(){},l="prototype",c=function(){var e,t=i(2770)("iframe"),r=a.length;for(t.style.display="none",i(9628).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;r--;)delete c[l][a[r]];return c()};e.exports=Object.create||function(e,t){var i;return null!==e?(s[l]=r(e),i=new s,s[l]=null,i[o]=e):i=c(),void 0===t?i:n(i,t)}},7087:(e,t,i)=>{var r=i(1908),n=i(2700),a=i(6888),o=Object.defineProperty;t.f=i(1843)?Object.defineProperty:function(e,t,i){if(r(e),t=a(t,!0),r(i),n)try{return o(e,t,i)}catch(s){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(e[t]=i.value),e}},9802:(e,t,i)=>{var r=i(7087),n=i(1908),a=i(847);e.exports=i(1843)?Object.defineProperties:function(e,t){n(e);for(var i,o=a(t),s=o.length,l=0;s>l;)r.f(e,i=o[l++],t[i]);return e}},8929:(e,t,i)=>{var r=i(5425),n=i(7228),a=i(8021),o=i(6888),s=i(685),l=i(2700),c=Object.getOwnPropertyDescriptor;t.f=i(1843)?c:function(e,t){if(e=a(e),t=o(t,!0),l)try{return c(e,t)}catch(i){}if(s(e,t))return n(!r.f.call(e,t),e[t])}},5706:(e,t,i)=>{var r=i(8021),n=i(6855).f,a={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return o&&"[object Window]"==a.call(e)?function(e){try{return n(e)}catch(t){return o.slice()}}(e):n(r(e))}},6855:(e,t,i)=>{var r=i(1441),n=i(8620).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,n)}},6164:(e,t)=>{t.f=Object.getOwnPropertySymbols},755:(e,t,i)=>{var r=i(685),n=i(862),a=i(254)("IE_PROTO"),o=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=n(e),r(e,a)?e[a]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?o:null}},1441:(e,t,i)=>{var r=i(685),n=i(8021),a=i(3176)(!1),o=i(254)("IE_PROTO");e.exports=function(e,t){var i,s=n(e),l=0,c=[];for(i in s)i!=o&&r(s,i)&&c.push(i);for(;t.length>l;)r(s,i=t[l++])&&(~a(c,i)||c.push(i));return c}},847:(e,t,i)=>{var r=i(1441),n=i(8620);e.exports=Object.keys||function(e){return r(e,n)}},5425:(e,t)=>{t.f={}.propertyIsEnumerable},9387:(e,t,i)=>{var r=i(7503),n=i(2206),a=i(5912);e.exports=function(e,t){var i=(n.Object||{})[e]||Object[e],o={};o[e]=t(i),r(r.S+r.F*a((function(){i(1)})),"Object",o)}},7228:e=>{e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},2779:(e,t,i)=>{e.exports=i(1773)},6290:(e,t,i)=>{var r=i(9785),n=i(1908),a=function(e,t){if(n(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=i(4892)(Function.call,i(8929).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(n){t=!0}return function(e,i){return a(e,i),t?e.__proto__=i:r(e,i),e}}({},!1):void 0),check:a}},9108:(e,t,i)=>{var r=i(7087).f,n=i(685),a=i(4038)("toStringTag");e.exports=function(e,t,i){e&&!n(e=i?e:e.prototype,a)&&r(e,a,{configurable:!0,value:t})}},254:(e,t,i)=>{var r=i(7740)("keys"),n=i(6559);e.exports=function(e){return r[e]||(r[e]=n(e))}},7740:(e,t,i)=>{var r=i(2206),n=i(86),a="__core-js_shared__",o=n[a]||(n[a]={});(e.exports=function(e,t){return o[e]||(o[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:i(4510)?"pure":"global",copyright:"\xa9 2020 Denis Pushkarev (zloirock.ru)"})},924:(e,t,i)=>{var r=i(4751),n=i(2112);e.exports=function(e){return function(t,i){var a,o,s=String(n(t)),l=r(i),c=s.length;return l<0||l>=c?e?"":void 0:(a=s.charCodeAt(l))<55296||a>56319||l+1===c||(o=s.charCodeAt(l+1))<56320||o>57343?e?s.charAt(l):a:e?s.slice(l,l+2):o-56320+(a-55296<<10)+65536}}},8749:(e,t,i)=>{var r=i(4751),n=Math.max,a=Math.min;e.exports=function(e,t){return(e=r(e))<0?n(e+t,0):a(e,t)}},4751:e=>{var t=Math.ceil,i=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?i:t)(e)}},8021:(e,t,i)=>{var r=i(9809),n=i(2112);e.exports=function(e){return r(n(e))}},621:(e,t,i)=>{var r=i(4751),n=Math.min;e.exports=function(e){return e>0?n(r(e),9007199254740991):0}},862:(e,t,i)=>{var r=i(2112);e.exports=function(e){return Object(r(e))}},6888:(e,t,i)=>{var r=i(9785);e.exports=function(e,t){if(!r(e))return e;var i,n;if(t&&"function"==typeof(i=e.toString)&&!r(n=i.call(e)))return n;if("function"==typeof(i=e.valueOf)&&!r(n=i.call(e)))return n;if(!t&&"function"==typeof(i=e.toString)&&!r(n=i.call(e)))return n;throw TypeError("Can't convert object to primitive value")}},6559:e=>{var t=0,i=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++t+i).toString(36))}},2288:(e,t,i)=>{var r=i(86),n=i(2206),a=i(4510),o=i(5624),s=i(7087).f;e.exports=function(e){var t=n.Symbol||(n.Symbol=a?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||s(t,e,{value:o.f(e)})}},5624:(e,t,i)=>{t.f=i(4038)},4038:(e,t,i)=>{var r=i(7740)("wks"),n=i(6559),a=i(86).Symbol,o="function"==typeof a;(e.exports=function(e){return r[e]||(r[e]=o&&a[e]||(o?a:n)("Symbol."+e))}).store=r},3325:(e,t,i)=>{"use strict";var r=i(5048),n=i(8762),a=i(7018),o=i(8021);e.exports=i(8655)(Array,"Array",(function(e,t){this._t=o(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,i=this._i++;return!e||i>=e.length?(this._t=void 0,n(1)):n(0,"keys"==t?i:"values"==t?e[i]:[i,e[i]])}),"values"),a.Arguments=a.Array,r("keys"),r("values"),r("entries")},3430:(e,t,i)=>{var r=i(7503);r(r.S+r.F,"Object",{assign:i(2430)})},6279:(e,t,i)=>{var r=i(7503);r(r.S,"Object",{create:i(399)})},4752:(e,t,i)=>{var r=i(7503);r(r.S+r.F*!i(1843),"Object",{defineProperty:i(7087).f})},2408:(e,t,i)=>{var r=i(862),n=i(755);i(9387)("getPrototypeOf",(function(){return function(e){return n(r(e))}}))},4996:(e,t,i)=>{var r=i(7503);r(r.S,"Object",{setPrototypeOf:i(6290).set})},6010:()=>{},8271:(e,t,i)=>{"use strict";var r=i(924)(!0);i(8655)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,i=this._i;return i>=t.length?{value:void 0,done:!0}:(e=r(t,i),this._i+=e.length,{value:e,done:!1})}))},5842:(e,t,i)=>{"use strict";var r=i(86),n=i(685),a=i(1843),o=i(7503),s=i(2779),l=i(7388).KEY,c=i(5912),h=i(7740),u=i(9108),d=i(6559),p=i(4038),f=i(5624),m=i(2288),g=i(8657),_=i(1037),y=i(1908),v=i(9785),x=i(862),b=i(8021),w=i(6888),S=i(7228),T=i(399),E=i(5706),M=i(8929),A=i(6164),P=i(7087),C=i(847),I=M.f,k=P.f,D=E.f,R=r.Symbol,L=r.JSON,z=L&&L.stringify,F="prototype",O=p("_hidden"),B=p("toPrimitive"),N={}.propertyIsEnumerable,V=h("symbol-registry"),j=h("symbols"),U=h("op-symbols"),G=Object[F],q="function"==typeof R&&!!A.f,H=r.QObject,W=!H||!H[F]||!H[F].findChild,Z=a&&c((function(){return 7!=T(k({},"a",{get:function(){return k(this,"a",{value:7}).a}})).a}))?function(e,t,i){var r=I(G,t);r&&delete G[t],k(e,t,i),r&&e!==G&&k(G,t,r)}:k,Q=function(e){var t=j[e]=T(R[F]);return t._k=e,t},X=q&&"symbol"==typeof R.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof R},Y=function(e,t,i){return e===G&&Y(U,t,i),y(e),t=w(t,!0),y(i),n(j,t)?(i.enumerable?(n(e,O)&&e[O][t]&&(e[O][t]=!1),i=T(i,{enumerable:S(0,!1)})):(n(e,O)||k(e,O,S(1,{})),e[O][t]=!0),Z(e,t,i)):k(e,t,i)},J=function(e,t){y(e);for(var i,r=g(t=b(t)),n=0,a=r.length;a>n;)Y(e,i=r[n++],t[i]);return e},K=function(e){var t=N.call(this,e=w(e,!0));return!(this===G&&n(j,e)&&!n(U,e))&&(!(t||!n(this,e)||!n(j,e)||n(this,O)&&this[O][e])||t)},$=function(e,t){if(e=b(e),t=w(t,!0),e!==G||!n(j,t)||n(U,t)){var i=I(e,t);return!i||!n(j,t)||n(e,O)&&e[O][t]||(i.enumerable=!0),i}},ee=function(e){for(var t,i=D(b(e)),r=[],a=0;i.length>a;)n(j,t=i[a++])||t==O||t==l||r.push(t);return r},te=function(e){for(var t,i=e===G,r=D(i?U:b(e)),a=[],o=0;r.length>o;)!n(j,t=r[o++])||i&&!n(G,t)||a.push(j[t]);return a};q||(s((R=function(){if(this instanceof R)throw TypeError("Symbol is not a constructor!");var e=d(arguments.length>0?arguments[0]:void 0),t=function(i){this===G&&t.call(U,i),n(this,O)&&n(this[O],e)&&(this[O][e]=!1),Z(this,e,S(1,i))};return a&&W&&Z(G,e,{configurable:!0,set:t}),Q(e)})[F],"toString",(function(){return this._k})),M.f=$,P.f=Y,i(6855).f=E.f=ee,i(5425).f=K,A.f=te,a&&!i(4510)&&s(G,"propertyIsEnumerable",K,!0),f.f=function(e){return Q(p(e))}),o(o.G+o.W+o.F*!q,{Symbol:R});for(var ie="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),re=0;ie.length>re;)p(ie[re++]);for(var ne=C(p.store),ae=0;ne.length>ae;)m(ne[ae++]);o(o.S+o.F*!q,"Symbol",{for:function(e){return n(V,e+="")?V[e]:V[e]=R(e)},keyFor:function(e){if(!X(e))throw TypeError(e+" is not a symbol!");for(var t in V)if(V[t]===e)return t},useSetter:function(){W=!0},useSimple:function(){W=!1}}),o(o.S+o.F*!q,"Object",{create:function(e,t){return void 0===t?T(e):J(T(e),t)},defineProperty:Y,defineProperties:J,getOwnPropertyDescriptor:$,getOwnPropertyNames:ee,getOwnPropertySymbols:te});var oe=c((function(){A.f(1)}));o(o.S+o.F*oe,"Object",{getOwnPropertySymbols:function(e){return A.f(x(e))}}),L&&o(o.S+o.F*(!q||c((function(){var e=R();return"[null]"!=z([e])||"{}"!=z({a:e})||"{}"!=z(Object(e))}))),"JSON",{stringify:function(e){for(var t,i,r=[e],n=1;arguments.length>n;)r.push(arguments[n++]);if(i=t=r[1],(v(t)||void 0!==e)&&!X(e))return _(t)||(t=function(e,t){if("function"==typeof i&&(t=i.call(this,e,t)),!X(t))return t}),r[1]=t,z.apply(L,r)}}),R[F][B]||i(1773)(R[F],B,R[F].valueOf),u(R,"Symbol"),u(Math,"Math",!0),u(r.JSON,"JSON",!0)},9380:(e,t,i)=>{i(2288)("asyncIterator")},9444:(e,t,i)=>{i(2288)("observable")},4098:(e,t,i)=>{i(3325);for(var r=i(86),n=i(1773),a=i(7018),o=i(4038)("toStringTag"),s="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),l=0;l<s.length;l++){var c=s[l],h=r[c],u=h&&h.prototype;u&&!u[o]&&n(u,o,c),a[c]=a.Array}},1302:function(module,exports,__webpack_require__){var factory;"undefined"!==typeof navigator&&(factory=function(){"use strict";var svgNS="http://www.w3.org/2000/svg",locationHref="",_useWebWorker=!1,initialDefaultFrame=-999999,setWebWorker=function(e){_useWebWorker=!!e},getWebWorker=function(){return _useWebWorker},setLocationHref=function(e){locationHref=e},getLocationHref=function(){return locationHref};function createTag(e){return document.createElement(e)}function extendPrototype(e,t){var i,r,n=e.length;for(i=0;i<n;i+=1)for(var a in r=e[i].prototype)Object.prototype.hasOwnProperty.call(r,a)&&(t.prototype[a]=r[a])}function getDescriptor(e,t){return Object.getOwnPropertyDescriptor(e,t)}function createProxyFunction(e){function t(){}return t.prototype=e,t}var audioControllerFactory=function(){function e(e){this.audios=[],this.audioFactory=e,this._volume=1,this._isMuted=!1}return e.prototype={addAudio:function(e){this.audios.push(e)},pause:function(){var e,t=this.audios.length;for(e=0;e<t;e+=1)this.audios[e].pause()},resume:function(){var e,t=this.audios.length;for(e=0;e<t;e+=1)this.audios[e].resume()},setRate:function(e){var t,i=this.audios.length;for(t=0;t<i;t+=1)this.audios[t].setRate(e)},createAudio:function(e){return this.audioFactory?this.audioFactory(e):window.Howl?new window.Howl({src:[e]}):{isPlaying:!1,play:function(){this.isPlaying=!0},seek:function(){this.isPlaying=!1},playing:function(){},rate:function(){},setVolume:function(){}}},setAudioFactory:function(e){this.audioFactory=e},setVolume:function(e){this._volume=e,this._updateVolume()},mute:function(){this._isMuted=!0,this._updateVolume()},unmute:function(){this._isMuted=!1,this._updateVolume()},getVolume:function(){return this._volume},_updateVolume:function(){var e,t=this.audios.length;for(e=0;e<t;e+=1)this.audios[e].volume(this._volume*(this._isMuted?0:1))}},function(){return new e}}(),createTypedArray=function(){function e(e,t){var i,r=0,n=[];switch(e){case"int16":case"uint8c":i=1;break;default:i=1.1}for(r=0;r<t;r+=1)n.push(i);return n}return"function"===typeof Uint8ClampedArray&&"function"===typeof Float32Array?function(t,i){return"float32"===t?new Float32Array(i):"int16"===t?new Int16Array(i):"uint8c"===t?new Uint8ClampedArray(i):e(t,i)}:e}();function createSizedArray(e){return Array.apply(null,{length:e})}function _typeof$6(e){return _typeof$6="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$6(e)}var subframeEnabled=!0,expressionsPlugin=null,expressionsInterfaces=null,idPrefix$1="",isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),_shouldRoundValues=!1,bmPow=Math.pow,bmSqrt=Math.sqrt,bmFloor=Math.floor,bmMax=Math.max,bmMin=Math.min,BMMath={};function ProjectInterface$1(){return{}}!function(){var e,t=["abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","cbrt","expm1","clz32","cos","cosh","exp","floor","fround","hypot","imul","log","log1p","log2","log10","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc","E","LN10","LN2","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"],i=t.length;for(e=0;e<i;e+=1)BMMath[t[e]]=Math[t[e]]}(),BMMath.random=Math.random,BMMath.abs=function(e){if("object"===_typeof$6(e)&&e.length){var t,i=createSizedArray(e.length),r=e.length;for(t=0;t<r;t+=1)i[t]=Math.abs(e[t]);return i}return Math.abs(e)};var defaultCurveSegments=150,degToRads=Math.PI/180,roundCorner=.5519;function roundValues(e){_shouldRoundValues=!!e}function bmRnd(e){return _shouldRoundValues?Math.round(e):e}function styleDiv(e){e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.display="block",e.style.transformOrigin="0 0",e.style.webkitTransformOrigin="0 0",e.style.backfaceVisibility="visible",e.style.webkitBackfaceVisibility="visible",e.style.transformStyle="preserve-3d",e.style.webkitTransformStyle="preserve-3d",e.style.mozTransformStyle="preserve-3d"}function BMEnterFrameEvent(e,t,i,r){this.type=e,this.currentTime=t,this.totalTime=i,this.direction=r<0?-1:1}function BMCompleteEvent(e,t){this.type=e,this.direction=t<0?-1:1}function BMCompleteLoopEvent(e,t,i,r){this.type=e,this.currentLoop=i,this.totalLoops=t,this.direction=r<0?-1:1}function BMSegmentStartEvent(e,t,i){this.type=e,this.firstFrame=t,this.totalFrames=i}function BMDestroyEvent(e,t){this.type=e,this.target=t}function BMRenderFrameErrorEvent(e,t){this.type="renderFrameError",this.nativeError=e,this.currentTime=t}function BMConfigErrorEvent(e){this.type="configError",this.nativeError=e}function BMAnimationConfigErrorEvent(e,t){this.type=e,this.nativeError=t}var createElementID=function(){var e=0;return function(){return idPrefix$1+"__lottie_element_"+(e+=1)}}();function HSVtoRGB(e,t,i){var r,n,a,o,s,l,c,h;switch(l=i*(1-t),c=i*(1-(s=6*e-(o=Math.floor(6*e)))*t),h=i*(1-(1-s)*t),o%6){case 0:r=i,n=h,a=l;break;case 1:r=c,n=i,a=l;break;case 2:r=l,n=i,a=h;break;case 3:r=l,n=c,a=i;break;case 4:r=h,n=l,a=i;break;case 5:r=i,n=l,a=c}return[r,n,a]}function RGBtoHSV(e,t,i){var r,n=Math.max(e,t,i),a=Math.min(e,t,i),o=n-a,s=0===n?0:o/n,l=n/255;switch(n){case a:r=0;break;case e:r=t-i+o*(t<i?6:0),r/=6*o;break;case t:r=i-e+2*o,r/=6*o;break;case i:r=e-t+4*o,r/=6*o}return[r,s,l]}function addSaturationToRGB(e,t){var i=RGBtoHSV(255*e[0],255*e[1],255*e[2]);return i[1]+=t,i[1]>1?i[1]=1:i[1]<=0&&(i[1]=0),HSVtoRGB(i[0],i[1],i[2])}function addBrightnessToRGB(e,t){var i=RGBtoHSV(255*e[0],255*e[1],255*e[2]);return i[2]+=t,i[2]>1?i[2]=1:i[2]<0&&(i[2]=0),HSVtoRGB(i[0],i[1],i[2])}function addHueToRGB(e,t){var i=RGBtoHSV(255*e[0],255*e[1],255*e[2]);return i[0]+=t/360,i[0]>1?i[0]-=1:i[0]<0&&(i[0]+=1),HSVtoRGB(i[0],i[1],i[2])}var rgbToHex=function(){var e,t,i=[];for(e=0;e<256;e+=1)t=e.toString(16),i[e]=1===t.length?"0"+t:t;return function(e,t,r){return e<0&&(e=0),t<0&&(t=0),r<0&&(r=0),"#"+i[e]+i[t]+i[r]}}(),setSubframeEnabled=function(e){subframeEnabled=!!e},getSubframeEnabled=function(){return subframeEnabled},setExpressionsPlugin=function(e){expressionsPlugin=e},getExpressionsPlugin=function(){return expressionsPlugin},setExpressionInterfaces=function(e){expressionsInterfaces=e},getExpressionInterfaces=function(){return expressionsInterfaces},setDefaultCurveSegments=function(e){defaultCurveSegments=e},getDefaultCurveSegments=function(){return defaultCurveSegments},setIdPrefix=function(e){idPrefix$1=e},getIdPrefix=function(){return idPrefix$1};function createNS(e){return document.createElementNS(svgNS,e)}function _typeof$5(e){return _typeof$5="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$5(e)}var dataManager=function(){var e,t,i=1,r=[],n={onmessage:function(){},postMessage:function(t){e({data:t})}},a={postMessage:function(e){n.onmessage({data:e})}};function o(){t||(t=function(t){if(window.Worker&&window.Blob&&getWebWorker()){var i=new Blob(["var _workerSelf = self; self.onmessage = ",t.toString()],{type:"text/javascript"}),r=URL.createObjectURL(i);return new Worker(r)}return e=t,n}((function(e){if(a.dataManager||(a.dataManager=function(){function e(n,a){var o,s,l,c,u,d,p=n.length;for(s=0;s<p;s+=1)if("ks"in(o=n[s])&&!o.completed){if(o.completed=!0,o.hasMask){var f=o.masksProperties;for(c=f.length,l=0;l<c;l+=1)if(f[l].pt.k.i)r(f[l].pt.k);else for(d=f[l].pt.k.length,u=0;u<d;u+=1)f[l].pt.k[u].s&&r(f[l].pt.k[u].s[0]),f[l].pt.k[u].e&&r(f[l].pt.k[u].e[0])}0===o.ty?(o.layers=t(o.refId,a),e(o.layers,a)):4===o.ty?i(o.shapes):5===o.ty&&h(o)}}function t(e,t){var i=function(e,t){for(var i=0,r=t.length;i<r;){if(t[i].id===e)return t[i];i+=1}return null}(e,t);return i?i.layers.__used?JSON.parse(JSON.stringify(i.layers)):(i.layers.__used=!0,i.layers):null}function i(e){var t,n,a;for(t=e.length-1;t>=0;t-=1)if("sh"===e[t].ty)if(e[t].ks.k.i)r(e[t].ks.k);else for(a=e[t].ks.k.length,n=0;n<a;n+=1)e[t].ks.k[n].s&&r(e[t].ks.k[n].s[0]),e[t].ks.k[n].e&&r(e[t].ks.k[n].e[0]);else"gr"===e[t].ty&&i(e[t].it)}function r(e){var t,i=e.i.length;for(t=0;t<i;t+=1)e.i[t][0]+=e.v[t][0],e.i[t][1]+=e.v[t][1],e.o[t][0]+=e.v[t][0],e.o[t][1]+=e.v[t][1]}function n(e,t){var i=t?t.split("."):[100,100,100];return e[0]>i[0]||!(i[0]>e[0])&&(e[1]>i[1]||!(i[1]>e[1])&&(e[2]>i[2]||!(i[2]>e[2])&&null))}var a=function(){var e=[4,4,14];function t(e){var t=e.t.d;e.t.d={k:[{s:t,t:0}]}}function i(e){var i,r=e.length;for(i=0;i<r;i+=1)5===e[i].ty&&t(e[i])}return function(t){if(n(e,t.v)&&(i(t.layers),t.assets)){var r,a=t.assets.length;for(r=0;r<a;r+=1)t.assets[r].layers&&i(t.assets[r].layers)}}}(),o=function(){var e=[4,7,99];return function(t){if(t.chars&&!n(e,t.v)){var r,a=t.chars.length;for(r=0;r<a;r+=1){var o=t.chars[r];o.data&&o.data.shapes&&(i(o.data.shapes),o.data.ip=0,o.data.op=99999,o.data.st=0,o.data.sr=1,o.data.ks={p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0}},t.chars[r].t||(o.data.shapes.push({ty:"no"}),o.data.shapes[0].it.push({p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0},sk:{k:0,a:0},sa:{k:0,a:0},ty:"tr"})))}}}}(),s=function(){var e=[5,7,15];function t(e){var t=e.t.p;"number"===typeof t.a&&(t.a={a:0,k:t.a}),"number"===typeof t.p&&(t.p={a:0,k:t.p}),"number"===typeof t.r&&(t.r={a:0,k:t.r})}function i(e){var i,r=e.length;for(i=0;i<r;i+=1)5===e[i].ty&&t(e[i])}return function(t){if(n(e,t.v)&&(i(t.layers),t.assets)){var r,a=t.assets.length;for(r=0;r<a;r+=1)t.assets[r].layers&&i(t.assets[r].layers)}}}(),l=function(){var e=[4,1,9];function t(e){var i,r,n,a=e.length;for(i=0;i<a;i+=1)if("gr"===e[i].ty)t(e[i].it);else if("fl"===e[i].ty||"st"===e[i].ty)if(e[i].c.k&&e[i].c.k[0].i)for(n=e[i].c.k.length,r=0;r<n;r+=1)e[i].c.k[r].s&&(e[i].c.k[r].s[0]/=255,e[i].c.k[r].s[1]/=255,e[i].c.k[r].s[2]/=255,e[i].c.k[r].s[3]/=255),e[i].c.k[r].e&&(e[i].c.k[r].e[0]/=255,e[i].c.k[r].e[1]/=255,e[i].c.k[r].e[2]/=255,e[i].c.k[r].e[3]/=255);else e[i].c.k[0]/=255,e[i].c.k[1]/=255,e[i].c.k[2]/=255,e[i].c.k[3]/=255}function i(e){var i,r=e.length;for(i=0;i<r;i+=1)4===e[i].ty&&t(e[i].shapes)}return function(t){if(n(e,t.v)&&(i(t.layers),t.assets)){var r,a=t.assets.length;for(r=0;r<a;r+=1)t.assets[r].layers&&i(t.assets[r].layers)}}}(),c=function(){var e=[4,4,18];function t(e){var i,r,n;for(i=e.length-1;i>=0;i-=1)if("sh"===e[i].ty)if(e[i].ks.k.i)e[i].ks.k.c=e[i].closed;else for(n=e[i].ks.k.length,r=0;r<n;r+=1)e[i].ks.k[r].s&&(e[i].ks.k[r].s[0].c=e[i].closed),e[i].ks.k[r].e&&(e[i].ks.k[r].e[0].c=e[i].closed);else"gr"===e[i].ty&&t(e[i].it)}function i(e){var i,r,n,a,o,s,l=e.length;for(r=0;r<l;r+=1){if((i=e[r]).hasMask){var c=i.masksProperties;for(a=c.length,n=0;n<a;n+=1)if(c[n].pt.k.i)c[n].pt.k.c=c[n].cl;else for(s=c[n].pt.k.length,o=0;o<s;o+=1)c[n].pt.k[o].s&&(c[n].pt.k[o].s[0].c=c[n].cl),c[n].pt.k[o].e&&(c[n].pt.k[o].e[0].c=c[n].cl)}4===i.ty&&t(i.shapes)}}return function(t){if(n(e,t.v)&&(i(t.layers),t.assets)){var r,a=t.assets.length;for(r=0;r<a;r+=1)t.assets[r].layers&&i(t.assets[r].layers)}}}();function h(e){0===e.t.a.length&&e.t.p}var u={completeData:function(i){i.__complete||(l(i),a(i),o(i),s(i),c(i),e(i.layers,i.assets),function(i,r){if(i){var n=0,a=i.length;for(n=0;n<a;n+=1)1===i[n].t&&(i[n].data.layers=t(i[n].data.refId,r),e(i[n].data.layers,r))}}(i.chars,i.assets),i.__complete=!0)}};return u.checkColors=l,u.checkChars=o,u.checkPathProperties=s,u.checkShapes=c,u.completeLayers=e,u}()),a.assetLoader||(a.assetLoader=function(){function e(e){var t=e.getResponseHeader("content-type");return t&&"json"===e.responseType&&-1!==t.indexOf("json")||e.response&&"object"===_typeof$5(e.response)?e.response:e.response&&"string"===typeof e.response?JSON.parse(e.response):e.responseText?JSON.parse(e.responseText):null}return{load:function(t,i,r,n){var a,o=new XMLHttpRequest;try{o.responseType="json"}catch(s){}o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status)a=e(o),r(a);else try{a=e(o),r(a)}catch(s){n&&n(s)}};try{o.open(["G","E","T"].join(""),t,!0)}catch(l){o.open(["G","E","T"].join(""),i+"/"+t,!0)}o.send()}}}()),"loadAnimation"===e.data.type)a.assetLoader.load(e.data.path,e.data.fullPath,(function(t){a.dataManager.completeData(t),a.postMessage({id:e.data.id,payload:t,status:"success"})}),(function(){a.postMessage({id:e.data.id,status:"error"})}));else if("complete"===e.data.type){var t=e.data.animation;a.dataManager.completeData(t),a.postMessage({id:e.data.id,payload:t,status:"success"})}else"loadData"===e.data.type&&a.assetLoader.load(e.data.path,e.data.fullPath,(function(t){a.postMessage({id:e.data.id,payload:t,status:"success"})}),(function(){a.postMessage({id:e.data.id,status:"error"})}))})),t.onmessage=function(e){var t=e.data,i=t.id,n=r[i];r[i]=null,"success"===t.status?n.onComplete(t.payload):n.onError&&n.onError()})}function s(e,t){var n="processId_"+(i+=1);return r[n]={onComplete:e,onError:t},n}return{loadAnimation:function(e,i,r){o();var n=s(i,r);t.postMessage({type:"loadAnimation",path:e,fullPath:window.location.origin+window.location.pathname,id:n})},loadData:function(e,i,r){o();var n=s(i,r);t.postMessage({type:"loadData",path:e,fullPath:window.location.origin+window.location.pathname,id:n})},completeAnimation:function(e,i,r){o();var n=s(i,r);t.postMessage({type:"complete",animation:e,id:n})}}}(),ImagePreloader=function(){var e=function(){var e=createTag("canvas");e.width=1,e.height=1;var t=e.getContext("2d");return t.fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),e}();function t(){this.loadedAssets+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function i(){this.loadedFootagesCount+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function r(e,t,i){var r="";if(e.e)r=e.p;else if(t){var n=e.p;-1!==n.indexOf("images/")&&(n=n.split("/")[1]),r=t+n}else r=i,r+=e.u?e.u:"",r+=e.p;return r}function n(e){var t=0,i=setInterval(function(){(e.getBBox().width||t>500)&&(this._imageLoaded(),clearInterval(i)),t+=1}.bind(this),50)}function a(e){var t={assetData:e},i=r(e,this.assetsPath,this.path);return dataManager.loadData(i,function(e){t.img=e,this._footageLoaded()}.bind(this),function(){t.img={},this._footageLoaded()}.bind(this)),t}function o(){this._imageLoaded=t.bind(this),this._footageLoaded=i.bind(this),this.testImageLoaded=n.bind(this),this.createFootageData=a.bind(this),this.assetsPath="",this.path="",this.totalImages=0,this.totalFootages=0,this.loadedAssets=0,this.loadedFootagesCount=0,this.imagesLoadedCb=null,this.images=[]}return o.prototype={loadAssets:function(e,t){var i;this.imagesLoadedCb=t;var r=e.length;for(i=0;i<r;i+=1)e[i].layers||(e[i].t&&"seq"!==e[i].t?3===e[i].t&&(this.totalFootages+=1,this.images.push(this.createFootageData(e[i]))):(this.totalImages+=1,this.images.push(this._createImageData(e[i]))))},setAssetsPath:function(e){this.assetsPath=e||""},setPath:function(e){this.path=e||""},loadedImages:function(){return this.totalImages===this.loadedAssets},loadedFootages:function(){return this.totalFootages===this.loadedFootagesCount},destroy:function(){this.imagesLoadedCb=null,this.images.length=0},getAsset:function(e){for(var t=0,i=this.images.length;t<i;){if(this.images[t].assetData===e)return this.images[t].img;t+=1}return null},createImgData:function(t){var i=r(t,this.assetsPath,this.path),n=createTag("img");n.crossOrigin="anonymous",n.addEventListener("load",this._imageLoaded,!1),n.addEventListener("error",function(){a.img=e,this._imageLoaded()}.bind(this),!1),n.src=i;var a={img:n,assetData:t};return a},createImageData:function(t){var i=r(t,this.assetsPath,this.path),n=createNS("image");isSafari?this.testImageLoaded(n):n.addEventListener("load",this._imageLoaded,!1),n.addEventListener("error",function(){a.img=e,this._imageLoaded()}.bind(this),!1),n.setAttributeNS("http://www.w3.org/1999/xlink","href",i),this._elementHelper.append?this._elementHelper.append(n):this._elementHelper.appendChild(n);var a={img:n,assetData:t};return a},imageLoaded:t,footageLoaded:i,setCacheType:function(e,t){"svg"===e?(this._elementHelper=t,this._createImageData=this.createImageData.bind(this)):this._createImageData=this.createImgData.bind(this)}},o}();function BaseEvent(){}BaseEvent.prototype={triggerEvent:function(e,t){if(this._cbs[e])for(var i=this._cbs[e],r=0;r<i.length;r+=1)i[r](t)},addEventListener:function(e,t){return this._cbs[e]||(this._cbs[e]=[]),this._cbs[e].push(t),function(){this.removeEventListener(e,t)}.bind(this)},removeEventListener:function(e,t){if(t){if(this._cbs[e]){for(var i=0,r=this._cbs[e].length;i<r;)this._cbs[e][i]===t&&(this._cbs[e].splice(i,1),i-=1,r-=1),i+=1;this._cbs[e].length||(this._cbs[e]=null)}}else this._cbs[e]=null}};var markerParser=function(){function e(e){for(var t,i=e.split("\r\n"),r={},n=0,a=0;a<i.length;a+=1)2===(t=i[a].split(":")).length&&(r[t[0]]=t[1].trim(),n+=1);if(0===n)throw new Error;return r}return function(t){for(var i=[],r=0;r<t.length;r+=1){var n=t[r],a={time:n.tm,duration:n.dr};try{a.payload=JSON.parse(t[r].cm)}catch(o){try{a.payload=e(t[r].cm)}catch(s){a.payload={name:t[r].cm}}}i.push(a)}return i}}(),ProjectInterface=function(){function e(e){this.compositions.push(e)}return function(){function t(e){for(var t=0,i=this.compositions.length;t<i;){if(this.compositions[t].data&&this.compositions[t].data.nm===e)return this.compositions[t].prepareFrame&&this.compositions[t].data.xt&&this.compositions[t].prepareFrame(this.currentFrame),this.compositions[t].compInterface;t+=1}return null}return t.compositions=[],t.currentFrame=0,t.registerComposition=e,t}}(),renderers={},registerRenderer=function(e,t){renderers[e]=t};function getRenderer(e){return renderers[e]}function getRegisteredRenderer(){if(renderers.canvas)return"canvas";for(var e in renderers)if(renderers[e])return e;return""}function _typeof$4(e){return _typeof$4="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$4(e)}var AnimationItem=function(){this._cbs=[],this.name="",this.path="",this.isLoaded=!1,this.currentFrame=0,this.currentRawFrame=0,this.firstFrame=0,this.totalFrames=0,this.frameRate=0,this.frameMult=0,this.playSpeed=1,this.playDirection=1,this.playCount=0,this.animationData={},this.assets=[],this.isPaused=!0,this.autoplay=!1,this.loop=!0,this.renderer=null,this.animationID=createElementID(),this.assetsPath="",this.timeCompleted=0,this.segmentPos=0,this.isSubframeEnabled=getSubframeEnabled(),this.segments=[],this._idle=!0,this._completedLoop=!1,this.projectInterface=ProjectInterface(),this.imagePreloader=new ImagePreloader,this.audioController=audioControllerFactory(),this.markers=[],this.configAnimation=this.configAnimation.bind(this),this.onSetupError=this.onSetupError.bind(this),this.onSegmentComplete=this.onSegmentComplete.bind(this),this.drawnFrameEvent=new BMEnterFrameEvent("drawnFrame",0,0,0),this.expressionsPlugin=getExpressionsPlugin()};extendPrototype([BaseEvent],AnimationItem),AnimationItem.prototype.setParams=function(e){(e.wrapper||e.container)&&(this.wrapper=e.wrapper||e.container);var t="svg";e.animType?t=e.animType:e.renderer&&(t=e.renderer);var i=getRenderer(t);this.renderer=new i(this,e.rendererSettings),this.imagePreloader.setCacheType(t,this.renderer.globalData.defs),this.renderer.setProjectInterface(this.projectInterface),this.animType=t,""===e.loop||null===e.loop||void 0===e.loop||!0===e.loop?this.loop=!0:!1===e.loop?this.loop=!1:this.loop=parseInt(e.loop,10),this.autoplay=!("autoplay"in e)||e.autoplay,this.name=e.name?e.name:"",this.autoloadSegments=!Object.prototype.hasOwnProperty.call(e,"autoloadSegments")||e.autoloadSegments,this.assetsPath=e.assetsPath,this.initialSegment=e.initialSegment,e.audioFactory&&this.audioController.setAudioFactory(e.audioFactory),e.animationData?this.setupAnimation(e.animationData):e.path&&(-1!==e.path.lastIndexOf("\\")?this.path=e.path.substr(0,e.path.lastIndexOf("\\")+1):this.path=e.path.substr(0,e.path.lastIndexOf("/")+1),this.fileName=e.path.substr(e.path.lastIndexOf("/")+1),this.fileName=this.fileName.substr(0,this.fileName.lastIndexOf(".json")),dataManager.loadAnimation(e.path,this.configAnimation,this.onSetupError))},AnimationItem.prototype.onSetupError=function(){this.trigger("data_failed")},AnimationItem.prototype.setupAnimation=function(e){dataManager.completeAnimation(e,this.configAnimation)},AnimationItem.prototype.setData=function(e,t){t&&"object"!==_typeof$4(t)&&(t=JSON.parse(t));var i={wrapper:e,animationData:t},r=e.attributes;i.path=r.getNamedItem("data-animation-path")?r.getNamedItem("data-animation-path").value:r.getNamedItem("data-bm-path")?r.getNamedItem("data-bm-path").value:r.getNamedItem("bm-path")?r.getNamedItem("bm-path").value:"",i.animType=r.getNamedItem("data-anim-type")?r.getNamedItem("data-anim-type").value:r.getNamedItem("data-bm-type")?r.getNamedItem("data-bm-type").value:r.getNamedItem("bm-type")?r.getNamedItem("bm-type").value:r.getNamedItem("data-bm-renderer")?r.getNamedItem("data-bm-renderer").value:r.getNamedItem("bm-renderer")?r.getNamedItem("bm-renderer").value:getRegisteredRenderer()||"canvas";var n=r.getNamedItem("data-anim-loop")?r.getNamedItem("data-anim-loop").value:r.getNamedItem("data-bm-loop")?r.getNamedItem("data-bm-loop").value:r.getNamedItem("bm-loop")?r.getNamedItem("bm-loop").value:"";"false"===n?i.loop=!1:"true"===n?i.loop=!0:""!==n&&(i.loop=parseInt(n,10));var a=r.getNamedItem("data-anim-autoplay")?r.getNamedItem("data-anim-autoplay").value:r.getNamedItem("data-bm-autoplay")?r.getNamedItem("data-bm-autoplay").value:!r.getNamedItem("bm-autoplay")||r.getNamedItem("bm-autoplay").value;i.autoplay="false"!==a,i.name=r.getNamedItem("data-name")?r.getNamedItem("data-name").value:r.getNamedItem("data-bm-name")?r.getNamedItem("data-bm-name").value:r.getNamedItem("bm-name")?r.getNamedItem("bm-name").value:"","false"===(r.getNamedItem("data-anim-prerender")?r.getNamedItem("data-anim-prerender").value:r.getNamedItem("data-bm-prerender")?r.getNamedItem("data-bm-prerender").value:r.getNamedItem("bm-prerender")?r.getNamedItem("bm-prerender").value:"")&&(i.prerender=!1),i.path?this.setParams(i):this.trigger("destroy")},AnimationItem.prototype.includeLayers=function(e){e.op>this.animationData.op&&(this.animationData.op=e.op,this.totalFrames=Math.floor(e.op-this.animationData.ip));var t,i,r=this.animationData.layers,n=r.length,a=e.layers,o=a.length;for(i=0;i<o;i+=1)for(t=0;t<n;){if(r[t].id===a[i].id){r[t]=a[i];break}t+=1}if((e.chars||e.fonts)&&(this.renderer.globalData.fontManager.addChars(e.chars),this.renderer.globalData.fontManager.addFonts(e.fonts,this.renderer.globalData.defs)),e.assets)for(n=e.assets.length,t=0;t<n;t+=1)this.animationData.assets.push(e.assets[t]);this.animationData.__complete=!1,dataManager.completeAnimation(this.animationData,this.onSegmentComplete)},AnimationItem.prototype.onSegmentComplete=function(e){this.animationData=e;var t=getExpressionsPlugin();t&&t.initExpressions(this),this.loadNextSegment()},AnimationItem.prototype.loadNextSegment=function(){var e=this.animationData.segments;if(!e||0===e.length||!this.autoloadSegments)return this.trigger("data_ready"),void(this.timeCompleted=this.totalFrames);var t=e.shift();this.timeCompleted=t.time*this.frameRate;var i=this.path+this.fileName+"_"+this.segmentPos+".json";this.segmentPos+=1,dataManager.loadData(i,this.includeLayers.bind(this),function(){this.trigger("data_failed")}.bind(this))},AnimationItem.prototype.loadSegments=function(){this.animationData.segments||(this.timeCompleted=this.totalFrames),this.loadNextSegment()},AnimationItem.prototype.imagesLoaded=function(){this.trigger("loaded_images"),this.checkLoaded()},AnimationItem.prototype.preloadImages=function(){this.imagePreloader.setAssetsPath(this.assetsPath),this.imagePreloader.setPath(this.path),this.imagePreloader.loadAssets(this.animationData.assets,this.imagesLoaded.bind(this))},AnimationItem.prototype.configAnimation=function(e){if(this.renderer)try{this.animationData=e,this.initialSegment?(this.totalFrames=Math.floor(this.initialSegment[1]-this.initialSegment[0]),this.firstFrame=Math.round(this.initialSegment[0])):(this.totalFrames=Math.floor(this.animationData.op-this.animationData.ip),this.firstFrame=Math.round(this.animationData.ip)),this.renderer.configAnimation(e),e.assets||(e.assets=[]),this.assets=this.animationData.assets,this.frameRate=this.animationData.fr,this.frameMult=this.animationData.fr/1e3,this.renderer.searchExtraCompositions(e.assets),this.markers=markerParser(e.markers||[]),this.trigger("config_ready"),this.preloadImages(),this.loadSegments(),this.updaFrameModifier(),this.waitForFontsLoaded(),this.isPaused&&this.audioController.pause()}catch(t){this.triggerConfigError(t)}},AnimationItem.prototype.waitForFontsLoaded=function(){this.renderer&&(this.renderer.globalData.fontManager.isLoaded?this.checkLoaded():setTimeout(this.waitForFontsLoaded.bind(this),20))},AnimationItem.prototype.checkLoaded=function(){if(!this.isLoaded&&this.renderer.globalData.fontManager.isLoaded&&(this.imagePreloader.loadedImages()||"canvas"!==this.renderer.rendererType)&&this.imagePreloader.loadedFootages()){this.isLoaded=!0;var e=getExpressionsPlugin();e&&e.initExpressions(this),this.renderer.initItems(),setTimeout(function(){this.trigger("DOMLoaded")}.bind(this),0),this.gotoFrame(),this.autoplay&&this.play()}},AnimationItem.prototype.resize=function(e,t){var i="number"===typeof e?e:void 0,r="number"===typeof t?t:void 0;this.renderer.updateContainerSize(i,r)},AnimationItem.prototype.setSubframe=function(e){this.isSubframeEnabled=!!e},AnimationItem.prototype.gotoFrame=function(){this.currentFrame=this.isSubframeEnabled?this.currentRawFrame:~~this.currentRawFrame,this.timeCompleted!==this.totalFrames&&this.currentFrame>this.timeCompleted&&(this.currentFrame=this.timeCompleted),this.trigger("enterFrame"),this.renderFrame(),this.trigger("drawnFrame")},AnimationItem.prototype.renderFrame=function(){if(!1!==this.isLoaded&&this.renderer)try{this.expressionsPlugin&&this.expressionsPlugin.resetFrame(),this.renderer.renderFrame(this.currentFrame+this.firstFrame)}catch(e){this.triggerRenderFrameError(e)}},AnimationItem.prototype.play=function(e){e&&this.name!==e||!0===this.isPaused&&(this.isPaused=!1,this.trigger("_play"),this.audioController.resume(),this._idle&&(this._idle=!1,this.trigger("_active")))},AnimationItem.prototype.pause=function(e){e&&this.name!==e||!1===this.isPaused&&(this.isPaused=!0,this.trigger("_pause"),this._idle=!0,this.trigger("_idle"),this.audioController.pause())},AnimationItem.prototype.togglePause=function(e){e&&this.name!==e||(!0===this.isPaused?this.play():this.pause())},AnimationItem.prototype.stop=function(e){e&&this.name!==e||(this.pause(),this.playCount=0,this._completedLoop=!1,this.setCurrentRawFrameValue(0))},AnimationItem.prototype.getMarkerData=function(e){for(var t,i=0;i<this.markers.length;i+=1)if((t=this.markers[i]).payload&&t.payload.name===e)return t;return null},AnimationItem.prototype.goToAndStop=function(e,t,i){if(!i||this.name===i){var r=Number(e);if(isNaN(r)){var n=this.getMarkerData(e);n&&this.goToAndStop(n.time,!0)}else t?this.setCurrentRawFrameValue(e):this.setCurrentRawFrameValue(e*this.frameModifier);this.pause()}},AnimationItem.prototype.goToAndPlay=function(e,t,i){if(!i||this.name===i){var r=Number(e);if(isNaN(r)){var n=this.getMarkerData(e);n&&(n.duration?this.playSegments([n.time,n.time+n.duration],!0):this.goToAndStop(n.time,!0))}else this.goToAndStop(r,t,i);this.play()}},AnimationItem.prototype.advanceTime=function(e){if(!0!==this.isPaused&&!1!==this.isLoaded){var t=this.currentRawFrame+e*this.frameModifier,i=!1;t>=this.totalFrames-1&&this.frameModifier>0?this.loop&&this.playCount!==this.loop?t>=this.totalFrames?(this.playCount+=1,this.checkSegments(t%this.totalFrames)||(this.setCurrentRawFrameValue(t%this.totalFrames),this._completedLoop=!0,this.trigger("loopComplete"))):this.setCurrentRawFrameValue(t):this.checkSegments(t>this.totalFrames?t%this.totalFrames:0)||(i=!0,t=this.totalFrames-1):t<0?this.checkSegments(t%this.totalFrames)||(!this.loop||this.playCount--<=0&&!0!==this.loop?(i=!0,t=0):(this.setCurrentRawFrameValue(this.totalFrames+t%this.totalFrames),this._completedLoop?this.trigger("loopComplete"):this._completedLoop=!0)):this.setCurrentRawFrameValue(t),i&&(this.setCurrentRawFrameValue(t),this.pause(),this.trigger("complete"))}},AnimationItem.prototype.adjustSegment=function(e,t){this.playCount=0,e[1]<e[0]?(this.frameModifier>0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(-1)),this.totalFrames=e[0]-e[1],this.timeCompleted=this.totalFrames,this.firstFrame=e[1],this.setCurrentRawFrameValue(this.totalFrames-.001-t)):e[1]>e[0]&&(this.frameModifier<0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(1)),this.totalFrames=e[1]-e[0],this.timeCompleted=this.totalFrames,this.firstFrame=e[0],this.setCurrentRawFrameValue(.001+t)),this.trigger("segmentStart")},AnimationItem.prototype.setSegment=function(e,t){var i=-1;this.isPaused&&(this.currentRawFrame+this.firstFrame<e?i=e:this.currentRawFrame+this.firstFrame>t&&(i=t-e)),this.firstFrame=e,this.totalFrames=t-e,this.timeCompleted=this.totalFrames,-1!==i&&this.goToAndStop(i,!0)},AnimationItem.prototype.playSegments=function(e,t){if(t&&(this.segments.length=0),"object"===_typeof$4(e[0])){var i,r=e.length;for(i=0;i<r;i+=1)this.segments.push(e[i])}else this.segments.push(e);this.segments.length&&t&&this.adjustSegment(this.segments.shift(),0),this.isPaused&&this.play()},AnimationItem.prototype.resetSegments=function(e){this.segments.length=0,this.segments.push([this.animationData.ip,this.animationData.op]),e&&this.checkSegments(0)},AnimationItem.prototype.checkSegments=function(e){return!!this.segments.length&&(this.adjustSegment(this.segments.shift(),e),!0)},AnimationItem.prototype.destroy=function(e){e&&this.name!==e||!this.renderer||(this.renderer.destroy(),this.imagePreloader.destroy(),this.trigger("destroy"),this._cbs=null,this.onEnterFrame=null,this.onLoopComplete=null,this.onComplete=null,this.onSegmentStart=null,this.onDestroy=null,this.renderer=null,this.expressionsPlugin=null,this.imagePreloader=null,this.projectInterface=null)},AnimationItem.prototype.setCurrentRawFrameValue=function(e){this.currentRawFrame=e,this.gotoFrame()},AnimationItem.prototype.setSpeed=function(e){this.playSpeed=e,this.updaFrameModifier()},AnimationItem.prototype.setDirection=function(e){this.playDirection=e<0?-1:1,this.updaFrameModifier()},AnimationItem.prototype.setLoop=function(e){this.loop=e},AnimationItem.prototype.setVolume=function(e,t){t&&this.name!==t||this.audioController.setVolume(e)},AnimationItem.prototype.getVolume=function(){return this.audioController.getVolume()},AnimationItem.prototype.mute=function(e){e&&this.name!==e||this.audioController.mute()},AnimationItem.prototype.unmute=function(e){e&&this.name!==e||this.audioController.unmute()},AnimationItem.prototype.updaFrameModifier=function(){this.frameModifier=this.frameMult*this.playSpeed*this.playDirection,this.audioController.setRate(this.playSpeed*this.playDirection)},AnimationItem.prototype.getPath=function(){return this.path},AnimationItem.prototype.getAssetsPath=function(e){var t="";if(e.e)t=e.p;else if(this.assetsPath){var i=e.p;-1!==i.indexOf("images/")&&(i=i.split("/")[1]),t=this.assetsPath+i}else t=this.path,t+=e.u?e.u:"",t+=e.p;return t},AnimationItem.prototype.getAssetData=function(e){for(var t=0,i=this.assets.length;t<i;){if(e===this.assets[t].id)return this.assets[t];t+=1}return null},AnimationItem.prototype.hide=function(){this.renderer.hide()},AnimationItem.prototype.show=function(){this.renderer.show()},AnimationItem.prototype.getDuration=function(e){return e?this.totalFrames:this.totalFrames/this.frameRate},AnimationItem.prototype.updateDocumentData=function(e,t,i){try{this.renderer.getElementByPath(e).updateDocumentData(t,i)}catch(r){}},AnimationItem.prototype.trigger=function(e){if(this._cbs&&this._cbs[e])switch(e){case"enterFrame":this.triggerEvent(e,new BMEnterFrameEvent(e,this.currentFrame,this.totalFrames,this.frameModifier));break;case"drawnFrame":this.drawnFrameEvent.currentTime=this.currentFrame,this.drawnFrameEvent.totalTime=this.totalFrames,this.drawnFrameEvent.direction=this.frameModifier,this.triggerEvent(e,this.drawnFrameEvent);break;case"loopComplete":this.triggerEvent(e,new BMCompleteLoopEvent(e,this.loop,this.playCount,this.frameMult));break;case"complete":this.triggerEvent(e,new BMCompleteEvent(e,this.frameMult));break;case"segmentStart":this.triggerEvent(e,new BMSegmentStartEvent(e,this.firstFrame,this.totalFrames));break;case"destroy":this.triggerEvent(e,new BMDestroyEvent(e,this));break;default:this.triggerEvent(e)}"enterFrame"===e&&this.onEnterFrame&&this.onEnterFrame.call(this,new BMEnterFrameEvent(e,this.currentFrame,this.totalFrames,this.frameMult)),"loopComplete"===e&&this.onLoopComplete&&this.onLoopComplete.call(this,new BMCompleteLoopEvent(e,this.loop,this.playCount,this.frameMult)),"complete"===e&&this.onComplete&&this.onComplete.call(this,new BMCompleteEvent(e,this.frameMult)),"segmentStart"===e&&this.onSegmentStart&&this.onSegmentStart.call(this,new BMSegmentStartEvent(e,this.firstFrame,this.totalFrames)),"destroy"===e&&this.onDestroy&&this.onDestroy.call(this,new BMDestroyEvent(e,this))},AnimationItem.prototype.triggerRenderFrameError=function(e){var t=new BMRenderFrameErrorEvent(e,this.currentFrame);this.triggerEvent("error",t),this.onError&&this.onError.call(this,t)},AnimationItem.prototype.triggerConfigError=function(e){var t=new BMConfigErrorEvent(e,this.currentFrame);this.triggerEvent("error",t),this.onError&&this.onError.call(this,t)};var animationManager=function(){var e={},t=[],i=0,r=0,n=0,a=!0,o=!1;function s(e){for(var i=0,n=e.target;i<r;)t[i].animation===n&&(t.splice(i,1),i-=1,r-=1,n.isPaused||h()),i+=1}function l(e,i){if(!e)return null;for(var n=0;n<r;){if(t[n].elem===e&&null!==t[n].elem)return t[n].animation;n+=1}var a=new AnimationItem;return u(a,e),a.setData(e,i),a}function c(){n+=1,f()}function h(){n-=1}function u(e,i){e.addEventListener("destroy",s),e.addEventListener("_active",c),e.addEventListener("_idle",h),t.push({elem:i,animation:e}),r+=1}function d(e){var s,l=e-i;for(s=0;s<r;s+=1)t[s].animation.advanceTime(l);i=e,n&&!o?window.requestAnimationFrame(d):a=!0}function p(e){i=e,window.requestAnimationFrame(d)}function f(){!o&&n&&a&&(window.requestAnimationFrame(p),a=!1)}return e.registerAnimation=l,e.loadAnimation=function(e){var t=new AnimationItem;return u(t,null),t.setParams(e),t},e.setSpeed=function(e,i){var n;for(n=0;n<r;n+=1)t[n].animation.setSpeed(e,i)},e.setDirection=function(e,i){var n;for(n=0;n<r;n+=1)t[n].animation.setDirection(e,i)},e.play=function(e){var i;for(i=0;i<r;i+=1)t[i].animation.play(e)},e.pause=function(e){var i;for(i=0;i<r;i+=1)t[i].animation.pause(e)},e.stop=function(e){var i;for(i=0;i<r;i+=1)t[i].animation.stop(e)},e.togglePause=function(e){var i;for(i=0;i<r;i+=1)t[i].animation.togglePause(e)},e.searchAnimations=function(e,t,i){var r,n=[].concat([].slice.call(document.getElementsByClassName("lottie")),[].slice.call(document.getElementsByClassName("bodymovin"))),a=n.length;for(r=0;r<a;r+=1)i&&n[r].setAttribute("data-bm-type",i),l(n[r],e);if(t&&0===a){i||(i="svg");var o=document.getElementsByTagName("body")[0];o.innerText="";var s=createTag("div");s.style.width="100%",s.style.height="100%",s.setAttribute("data-bm-type",i),o.appendChild(s),l(s,e)}},e.resize=function(){var e;for(e=0;e<r;e+=1)t[e].animation.resize()},e.goToAndStop=function(e,i,n){var a;for(a=0;a<r;a+=1)t[a].animation.goToAndStop(e,i,n)},e.destroy=function(e){var i;for(i=r-1;i>=0;i-=1)t[i].animation.destroy(e)},e.freeze=function(){o=!0},e.unfreeze=function(){o=!1,f()},e.setVolume=function(e,i){var n;for(n=0;n<r;n+=1)t[n].animation.setVolume(e,i)},e.mute=function(e){var i;for(i=0;i<r;i+=1)t[i].animation.mute(e)},e.unmute=function(e){var i;for(i=0;i<r;i+=1)t[i].animation.unmute(e)},e.getRegisteredAnimations=function(){var e,i=t.length,r=[];for(e=0;e<i;e+=1)r.push(t[e].animation);return r},e}(),BezierFactory=function(){var e={getBezierEasing:function(e,i,r,n,a){var o=a||("bez_"+e+"_"+i+"_"+r+"_"+n).replace(/\./g,"p");if(t[o])return t[o];var s=new h([e,i,r,n]);return t[o]=s,s}},t={},i=11,r=1/(i-1),n="function"===typeof Float32Array;function a(e,t){return 1-3*t+3*e}function o(e,t){return 3*t-6*e}function s(e){return 3*e}function l(e,t,i){return((a(t,i)*e+o(t,i))*e+s(t))*e}function c(e,t,i){return 3*a(t,i)*e*e+2*o(t,i)*e+s(t)}function h(e){this._p=e,this._mSampleValues=n?new Float32Array(i):new Array(i),this._precomputed=!1,this.get=this.get.bind(this)}return h.prototype={get:function(e){var t=this._p[0],i=this._p[1],r=this._p[2],n=this._p[3];return this._precomputed||this._precompute(),t===i&&r===n?e:0===e?0:1===e?1:l(this._getTForX(e),i,n)},_precompute:function(){var e=this._p[0],t=this._p[1],i=this._p[2],r=this._p[3];this._precomputed=!0,e===t&&i===r||this._calcSampleValues()},_calcSampleValues:function(){for(var e=this._p[0],t=this._p[2],n=0;n<i;++n)this._mSampleValues[n]=l(n*r,e,t)},_getTForX:function(e){for(var t=this._p[0],n=this._p[2],a=this._mSampleValues,o=0,s=1,h=i-1;s!==h&&a[s]<=e;++s)o+=r;var u=o+(e-a[--s])/(a[s+1]-a[s])*r,d=c(u,t,n);return d>=.001?function(e,t,i,r){for(var n=0;n<4;++n){var a=c(t,i,r);if(0===a)return t;t-=(l(t,i,r)-e)/a}return t}(e,u,t,n):0===d?u:function(e,t,i,r,n){var a,o,s=0;do{(a=l(o=t+(i-t)/2,r,n)-e)>0?i=o:t=o}while(Math.abs(a)>1e-7&&++s<10);return o}(e,o,o+r,t,n)}},e}(),pooling={double:function(e){return e.concat(createSizedArray(e.length))}},poolFactory=function(e,t,i){var r=0,n=e,a=createSizedArray(n);return{newElement:function(){return r?a[r-=1]:t()},release:function(e){r===n&&(a=pooling.double(a),n*=2),i&&i(e),a[r]=e,r+=1}}},bezierLengthPool=poolFactory(8,(function(){return{addedLength:0,percents:createTypedArray("float32",getDefaultCurveSegments()),lengths:createTypedArray("float32",getDefaultCurveSegments())}})),segmentsLengthPool=poolFactory(8,(function(){return{lengths:[],totalLength:0}}),(function(e){var t,i=e.lengths.length;for(t=0;t<i;t+=1)bezierLengthPool.release(e.lengths[t]);e.lengths.length=0}));function bezFunction(){var e=Math;function t(e,t,i,r,n,a){var o=e*r+t*n+i*a-n*r-a*e-i*t;return o>-.001&&o<.001}var i=function(e,t,i,r){var n,a,o,s,l,c,h=getDefaultCurveSegments(),u=0,d=[],p=[],f=bezierLengthPool.newElement();for(o=i.length,n=0;n<h;n+=1){for(l=n/(h-1),c=0,a=0;a<o;a+=1)s=bmPow(1-l,3)*e[a]+3*bmPow(1-l,2)*l*i[a]+3*(1-l)*bmPow(l,2)*r[a]+bmPow(l,3)*t[a],d[a]=s,null!==p[a]&&(c+=bmPow(d[a]-p[a],2)),p[a]=d[a];c&&(u+=c=bmSqrt(c)),f.percents[n]=l,f.lengths[n]=u}return f.addedLength=u,f};function r(e){this.segmentLength=0,this.points=new Array(e)}function n(e,t){this.partialLength=e,this.point=t}var a=function(){var e={};return function(i,a,o,s){var l=(i[0]+"_"+i[1]+"_"+a[0]+"_"+a[1]+"_"+o[0]+"_"+o[1]+"_"+s[0]+"_"+s[1]).replace(/\./g,"p");if(!e[l]){var c,h,u,d,p,f,m,g=getDefaultCurveSegments(),_=0,y=null;2===i.length&&(i[0]!==a[0]||i[1]!==a[1])&&t(i[0],i[1],a[0],a[1],i[0]+o[0],i[1]+o[1])&&t(i[0],i[1],a[0],a[1],a[0]+s[0],a[1]+s[1])&&(g=2);var v=new r(g);for(u=o.length,c=0;c<g;c+=1){for(m=createSizedArray(u),p=c/(g-1),f=0,h=0;h<u;h+=1)d=bmPow(1-p,3)*i[h]+3*bmPow(1-p,2)*p*(i[h]+o[h])+3*(1-p)*bmPow(p,2)*(a[h]+s[h])+bmPow(p,3)*a[h],m[h]=d,null!==y&&(f+=bmPow(m[h]-y[h],2));_+=f=bmSqrt(f),v.points[c]=new n(f,m),y=m}v.segmentLength=_,e[l]=v}return e[l]}}();function o(e,t){var i=t.percents,r=t.lengths,n=i.length,a=bmFloor((n-1)*e),o=e*t.addedLength,s=0;if(a===n-1||0===a||o===r[a])return i[a];for(var l=r[a]>o?-1:1,c=!0;c;)if(r[a]<=o&&r[a+1]>o?(s=(o-r[a])/(r[a+1]-r[a]),c=!1):a+=l,a<0||a>=n-1){if(a===n-1)return i[a];c=!1}return i[a]+(i[a+1]-i[a])*s}var s=createTypedArray("float32",8);return{getSegmentsLength:function(e){var t,r=segmentsLengthPool.newElement(),n=e.c,a=e.v,o=e.o,s=e.i,l=e._length,c=r.lengths,h=0;for(t=0;t<l-1;t+=1)c[t]=i(a[t],a[t+1],o[t],s[t+1]),h+=c[t].addedLength;return n&&l&&(c[t]=i(a[t],a[0],o[t],s[0]),h+=c[t].addedLength),r.totalLength=h,r},getNewSegment:function(t,i,r,n,a,l,c){a<0?a=0:a>1&&(a=1);var h,u=o(a,c),d=o(l=l>1?1:l,c),p=t.length,f=1-u,m=1-d,g=f*f*f,_=u*f*f*3,y=u*u*f*3,v=u*u*u,x=f*f*m,b=u*f*m+f*u*m+f*f*d,w=u*u*m+f*u*d+u*f*d,S=u*u*d,T=f*m*m,E=u*m*m+f*d*m+f*m*d,M=u*d*m+f*d*d+u*m*d,A=u*d*d,P=m*m*m,C=d*m*m+m*d*m+m*m*d,I=d*d*m+m*d*d+d*m*d,k=d*d*d;for(h=0;h<p;h+=1)s[4*h]=e.round(1e3*(g*t[h]+_*r[h]+y*n[h]+v*i[h]))/1e3,s[4*h+1]=e.round(1e3*(x*t[h]+b*r[h]+w*n[h]+S*i[h]))/1e3,s[4*h+2]=e.round(1e3*(T*t[h]+E*r[h]+M*n[h]+A*i[h]))/1e3,s[4*h+3]=e.round(1e3*(P*t[h]+C*r[h]+I*n[h]+k*i[h]))/1e3;return s},getPointInSegment:function(t,i,r,n,a,s){var l=o(a,s),c=1-l;return[e.round(1e3*(c*c*c*t[0]+(l*c*c+c*l*c+c*c*l)*r[0]+(l*l*c+c*l*l+l*c*l)*n[0]+l*l*l*i[0]))/1e3,e.round(1e3*(c*c*c*t[1]+(l*c*c+c*l*c+c*c*l)*r[1]+(l*l*c+c*l*l+l*c*l)*n[1]+l*l*l*i[1]))/1e3]},buildBezierData:a,pointOnLine2D:t,pointOnLine3D:function(i,r,n,a,o,s,l,c,h){if(0===n&&0===s&&0===h)return t(i,r,a,o,l,c);var u,d=e.sqrt(e.pow(a-i,2)+e.pow(o-r,2)+e.pow(s-n,2)),p=e.sqrt(e.pow(l-i,2)+e.pow(c-r,2)+e.pow(h-n,2)),f=e.sqrt(e.pow(l-a,2)+e.pow(c-o,2)+e.pow(h-s,2));return(u=d>p?d>f?d-p-f:f-p-d:f>p?f-p-d:p-d-f)>-1e-4&&u<1e-4}}}var bez=bezFunction(),initFrame=initialDefaultFrame,mathAbs=Math.abs;function interpolateValue(e,t){var i,r=this.offsetTime;"multidimensional"===this.propType&&(i=createTypedArray("float32",this.pv.length));for(var n,a,o,s,l,c,h,u,d,p=t.lastIndex,f=p,m=this.keyframes.length-1,g=!0;g;){if(n=this.keyframes[f],a=this.keyframes[f+1],f===m-1&&e>=a.t-r){n.h&&(n=a),p=0;break}if(a.t-r>e){p=f;break}f<m-1?f+=1:(p=0,g=!1)}o=this.keyframesMetadata[f]||{};var _,y=a.t-r,v=n.t-r;if(n.to){o.bezierData||(o.bezierData=bez.buildBezierData(n.s,a.s||n.e,n.to,n.ti));var x=o.bezierData;if(e>=y||e<v){var b=e>=y?x.points.length-1:0;for(l=x.points[b].point.length,s=0;s<l;s+=1)i[s]=x.points[b].point[s]}else{o.__fnct?d=o.__fnct:(d=BezierFactory.getBezierEasing(n.o.x,n.o.y,n.i.x,n.i.y,n.n).get,o.__fnct=d),c=d((e-v)/(y-v));var w,S=x.segmentLength*c,T=t.lastFrame<e&&t._lastKeyframeIndex===f?t._lastAddedLength:0;for(u=t.lastFrame<e&&t._lastKeyframeIndex===f?t._lastPoint:0,g=!0,h=x.points.length;g;){if(T+=x.points[u].partialLength,0===S||0===c||u===x.points.length-1){for(l=x.points[u].point.length,s=0;s<l;s+=1)i[s]=x.points[u].point[s];break}if(S>=T&&S<T+x.points[u+1].partialLength){for(w=(S-T)/x.points[u+1].partialLength,l=x.points[u].point.length,s=0;s<l;s+=1)i[s]=x.points[u].point[s]+(x.points[u+1].point[s]-x.points[u].point[s])*w;break}u<h-1?u+=1:g=!1}t._lastPoint=u,t._lastAddedLength=T-x.points[u].partialLength,t._lastKeyframeIndex=f}}else{var E,M,A,P,C;if(m=n.s.length,_=a.s||n.e,this.sh&&1!==n.h)e>=y?(i[0]=_[0],i[1]=_[1],i[2]=_[2]):e<=v?(i[0]=n.s[0],i[1]=n.s[1],i[2]=n.s[2]):quaternionToEuler(i,slerp(createQuaternion(n.s),createQuaternion(_),(e-v)/(y-v)));else for(f=0;f<m;f+=1)1!==n.h&&(e>=y?c=1:e<v?c=0:(n.o.x.constructor===Array?(o.__fnct||(o.__fnct=[]),o.__fnct[f]?d=o.__fnct[f]:(E=void 0===n.o.x[f]?n.o.x[0]:n.o.x[f],M=void 0===n.o.y[f]?n.o.y[0]:n.o.y[f],A=void 0===n.i.x[f]?n.i.x[0]:n.i.x[f],P=void 0===n.i.y[f]?n.i.y[0]:n.i.y[f],d=BezierFactory.getBezierEasing(E,M,A,P).get,o.__fnct[f]=d)):o.__fnct?d=o.__fnct:(E=n.o.x,M=n.o.y,A=n.i.x,P=n.i.y,d=BezierFactory.getBezierEasing(E,M,A,P).get,n.keyframeMetadata=d),c=d((e-v)/(y-v)))),_=a.s||n.e,C=1===n.h?n.s[f]:n.s[f]+(_[f]-n.s[f])*c,"multidimensional"===this.propType?i[f]=C:i=C}return t.lastIndex=p,i}function slerp(e,t,i){var r,n,a,o,s,l=[],c=e[0],h=e[1],u=e[2],d=e[3],p=t[0],f=t[1],m=t[2],g=t[3];return(n=c*p+h*f+u*m+d*g)<0&&(n=-n,p=-p,f=-f,m=-m,g=-g),1-n>1e-6?(r=Math.acos(n),a=Math.sin(r),o=Math.sin((1-i)*r)/a,s=Math.sin(i*r)/a):(o=1-i,s=i),l[0]=o*c+s*p,l[1]=o*h+s*f,l[2]=o*u+s*m,l[3]=o*d+s*g,l}function quaternionToEuler(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=Math.atan2(2*r*a-2*i*n,1-2*r*r-2*n*n),s=Math.asin(2*i*r+2*n*a),l=Math.atan2(2*i*a-2*r*n,1-2*i*i-2*n*n);e[0]=o/degToRads,e[1]=s/degToRads,e[2]=l/degToRads}function createQuaternion(e){var t=e[0]*degToRads,i=e[1]*degToRads,r=e[2]*degToRads,n=Math.cos(t/2),a=Math.cos(i/2),o=Math.cos(r/2),s=Math.sin(t/2),l=Math.sin(i/2),c=Math.sin(r/2);return[s*l*o+n*a*c,s*a*o+n*l*c,n*l*o-s*a*c,n*a*o-s*l*c]}function getValueAtCurrentTime(){var e=this.comp.renderedFrame-this.offsetTime,t=this.keyframes[0].t-this.offsetTime,i=this.keyframes[this.keyframes.length-1].t-this.offsetTime;if(!(e===this._caching.lastFrame||this._caching.lastFrame!==initFrame&&(this._caching.lastFrame>=i&&e>=i||this._caching.lastFrame<t&&e<t))){this._caching.lastFrame>=e&&(this._caching._lastKeyframeIndex=-1,this._caching.lastIndex=0);var r=this.interpolateValue(e,this._caching);this.pv=r}return this._caching.lastFrame=e,this.pv}function setVValue(e){var t;if("unidimensional"===this.propType)t=e*this.mult,mathAbs(this.v-t)>1e-5&&(this.v=t,this._mdf=!0);else for(var i=0,r=this.v.length;i<r;)t=e[i]*this.mult,mathAbs(this.v[i]-t)>1e-5&&(this.v[i]=t,this._mdf=!0),i+=1}function processEffectsSequence(){if(this.elem.globalData.frameId!==this.frameId&&this.effectsSequence.length)if(this.lock)this.setVValue(this.pv);else{var e;this.lock=!0,this._mdf=this._isFirstFrame;var t=this.effectsSequence.length,i=this.kf?this.pv:this.data.k;for(e=0;e<t;e+=1)i=this.effectsSequence[e](i);this.setVValue(i),this._isFirstFrame=!1,this.lock=!1,this.frameId=this.elem.globalData.frameId}}function addEffect(e){this.effectsSequence.push(e),this.container.addDynamicProperty(this)}function ValueProperty(e,t,i,r){this.propType="unidimensional",this.mult=i||1,this.data=t,this.v=i?t.k*i:t.k,this.pv=t.k,this._mdf=!1,this.elem=e,this.container=r,this.comp=e.comp,this.k=!1,this.kf=!1,this.vel=0,this.effectsSequence=[],this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function MultiDimensionalProperty(e,t,i,r){var n;this.propType="multidimensional",this.mult=i||1,this.data=t,this._mdf=!1,this.elem=e,this.container=r,this.comp=e.comp,this.k=!1,this.kf=!1,this.frameId=-1;var a=t.k.length;for(this.v=createTypedArray("float32",a),this.pv=createTypedArray("float32",a),this.vel=createTypedArray("float32",a),n=0;n<a;n+=1)this.v[n]=t.k[n]*this.mult,this.pv[n]=t.k[n];this._isFirstFrame=!0,this.effectsSequence=[],this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function KeyframedValueProperty(e,t,i,r){this.propType="unidimensional",this.keyframes=t.k,this.keyframesMetadata=[],this.offsetTime=e.data.st,this.frameId=-1,this._caching={lastFrame:initFrame,lastIndex:0,value:0,_lastKeyframeIndex:-1},this.k=!0,this.kf=!0,this.data=t,this.mult=i||1,this.elem=e,this.container=r,this.comp=e.comp,this.v=initFrame,this.pv=initFrame,this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.addEffect=addEffect}function KeyframedMultidimensionalProperty(e,t,i,r){var n;this.propType="multidimensional";var a,o,s,l,c=t.k.length;for(n=0;n<c-1;n+=1)t.k[n].to&&t.k[n].s&&t.k[n+1]&&t.k[n+1].s&&(a=t.k[n].s,o=t.k[n+1].s,s=t.k[n].to,l=t.k[n].ti,(2===a.length&&(a[0]!==o[0]||a[1]!==o[1])&&bez.pointOnLine2D(a[0],a[1],o[0],o[1],a[0]+s[0],a[1]+s[1])&&bez.pointOnLine2D(a[0],a[1],o[0],o[1],o[0]+l[0],o[1]+l[1])||3===a.length&&(a[0]!==o[0]||a[1]!==o[1]||a[2]!==o[2])&&bez.pointOnLine3D(a[0],a[1],a[2],o[0],o[1],o[2],a[0]+s[0],a[1]+s[1],a[2]+s[2])&&bez.pointOnLine3D(a[0],a[1],a[2],o[0],o[1],o[2],o[0]+l[0],o[1]+l[1],o[2]+l[2]))&&(t.k[n].to=null,t.k[n].ti=null),a[0]===o[0]&&a[1]===o[1]&&0===s[0]&&0===s[1]&&0===l[0]&&0===l[1]&&(2===a.length||a[2]===o[2]&&0===s[2]&&0===l[2])&&(t.k[n].to=null,t.k[n].ti=null));this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.data=t,this.keyframes=t.k,this.keyframesMetadata=[],this.offsetTime=e.data.st,this.k=!0,this.kf=!0,this._isFirstFrame=!0,this.mult=i||1,this.elem=e,this.container=r,this.comp=e.comp,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.frameId=-1;var h=t.k[0].s.length;for(this.v=createTypedArray("float32",h),this.pv=createTypedArray("float32",h),n=0;n<h;n+=1)this.v[n]=initFrame,this.pv[n]=initFrame;this._caching={lastFrame:initFrame,lastIndex:0,value:createTypedArray("float32",h)},this.addEffect=addEffect}var PropertyFactory={getProp:function(e,t,i,r,n){var a;if(t.sid&&(t=e.globalData.slotManager.getProp(t)),t.k.length)if("number"===typeof t.k[0])a=new MultiDimensionalProperty(e,t,r,n);else switch(i){case 0:a=new KeyframedValueProperty(e,t,r,n);break;case 1:a=new KeyframedMultidimensionalProperty(e,t,r,n)}else a=new ValueProperty(e,t,r,n);return a.effectsSequence.length&&n.addDynamicProperty(a),a}};function DynamicPropertyContainer(){}DynamicPropertyContainer.prototype={addDynamicProperty:function(e){-1===this.dynamicProperties.indexOf(e)&&(this.dynamicProperties.push(e),this.container.addDynamicProperty(this),this._isAnimated=!0)},iterateDynamicProperties:function(){var e;this._mdf=!1;var t=this.dynamicProperties.length;for(e=0;e<t;e+=1)this.dynamicProperties[e].getValue(),this.dynamicProperties[e]._mdf&&(this._mdf=!0)},initDynamicPropertyContainer:function(e){this.container=e,this.dynamicProperties=[],this._mdf=!1,this._isAnimated=!1}};var pointPool=poolFactory(8,(function(){return createTypedArray("float32",2)}));function ShapePath(){this.c=!1,this._length=0,this._maxLength=8,this.v=createSizedArray(this._maxLength),this.o=createSizedArray(this._maxLength),this.i=createSizedArray(this._maxLength)}ShapePath.prototype.setPathData=function(e,t){this.c=e,this.setLength(t);for(var i=0;i<t;)this.v[i]=pointPool.newElement(),this.o[i]=pointPool.newElement(),this.i[i]=pointPool.newElement(),i+=1},ShapePath.prototype.setLength=function(e){for(;this._maxLength<e;)this.doubleArrayLength();this._length=e},ShapePath.prototype.doubleArrayLength=function(){this.v=this.v.concat(createSizedArray(this._maxLength)),this.i=this.i.concat(createSizedArray(this._maxLength)),this.o=this.o.concat(createSizedArray(this._maxLength)),this._maxLength*=2},ShapePath.prototype.setXYAt=function(e,t,i,r,n){var a;switch(this._length=Math.max(this._length,r+1),this._length>=this._maxLength&&this.doubleArrayLength(),i){case"v":a=this.v;break;case"i":a=this.i;break;case"o":a=this.o;break;default:a=[]}(!a[r]||a[r]&&!n)&&(a[r]=pointPool.newElement()),a[r][0]=e,a[r][1]=t},ShapePath.prototype.setTripleAt=function(e,t,i,r,n,a,o,s){this.setXYAt(e,t,"v",o,s),this.setXYAt(i,r,"o",o,s),this.setXYAt(n,a,"i",o,s)},ShapePath.prototype.reverse=function(){var e=new ShapePath;e.setPathData(this.c,this._length);var t=this.v,i=this.o,r=this.i,n=0;this.c&&(e.setTripleAt(t[0][0],t[0][1],r[0][0],r[0][1],i[0][0],i[0][1],0,!1),n=1);var a,o=this._length-1,s=this._length;for(a=n;a<s;a+=1)e.setTripleAt(t[o][0],t[o][1],r[o][0],r[o][1],i[o][0],i[o][1],a,!1),o-=1;return e},ShapePath.prototype.length=function(){return this._length};var shapePool=function(){var e=poolFactory(4,(function(){return new ShapePath}),(function(e){var t,i=e._length;for(t=0;t<i;t+=1)pointPool.release(e.v[t]),pointPool.release(e.i[t]),pointPool.release(e.o[t]),e.v[t]=null,e.i[t]=null,e.o[t]=null;e._length=0,e.c=!1}));return e.clone=function(t){var i,r=e.newElement(),n=void 0===t._length?t.v.length:t._length;for(r.setLength(n),r.c=t.c,i=0;i<n;i+=1)r.setTripleAt(t.v[i][0],t.v[i][1],t.o[i][0],t.o[i][1],t.i[i][0],t.i[i][1],i);return r},e}();function ShapeCollection(){this._length=0,this._maxLength=4,this.shapes=createSizedArray(this._maxLength)}ShapeCollection.prototype.addShape=function(e){this._length===this._maxLength&&(this.shapes=this.shapes.concat(createSizedArray(this._maxLength)),this._maxLength*=2),this.shapes[this._length]=e,this._length+=1},ShapeCollection.prototype.releaseShapes=function(){var e;for(e=0;e<this._length;e+=1)shapePool.release(this.shapes[e]);this._length=0};var shapeCollectionPool=function(){var e={newShapeCollection:function(){return t?r[t-=1]:new ShapeCollection},release:function(e){var n,a=e._length;for(n=0;n<a;n+=1)shapePool.release(e.shapes[n]);e._length=0,t===i&&(r=pooling.double(r),i*=2),r[t]=e,t+=1}},t=0,i=4,r=createSizedArray(i);return e}(),ShapePropertyFactory=function(){var e=-999999;function t(e,t,i){var r,n,a,o,s,l,c,h,u,d=i.lastIndex,p=this.keyframes;if(e<p[0].t-this.offsetTime)r=p[0].s[0],a=!0,d=0;else if(e>=p[p.length-1].t-this.offsetTime)r=p[p.length-1].s?p[p.length-1].s[0]:p[p.length-2].e[0],a=!0;else{for(var f,m,g,_=d,y=p.length-1,v=!0;v&&(f=p[_],!((m=p[_+1]).t-this.offsetTime>e));)_<y-1?_+=1:v=!1;if(g=this.keyframesMetadata[_]||{},d=_,!(a=1===f.h)){if(e>=m.t-this.offsetTime)h=1;else if(e<f.t-this.offsetTime)h=0;else{var x;g.__fnct?x=g.__fnct:(x=BezierFactory.getBezierEasing(f.o.x,f.o.y,f.i.x,f.i.y).get,g.__fnct=x),h=x((e-(f.t-this.offsetTime))/(m.t-this.offsetTime-(f.t-this.offsetTime)))}n=m.s?m.s[0]:f.e[0]}r=f.s[0]}for(l=t._length,c=r.i[0].length,i.lastIndex=d,o=0;o<l;o+=1)for(s=0;s<c;s+=1)u=a?r.i[o][s]:r.i[o][s]+(n.i[o][s]-r.i[o][s])*h,t.i[o][s]=u,u=a?r.o[o][s]:r.o[o][s]+(n.o[o][s]-r.o[o][s])*h,t.o[o][s]=u,u=a?r.v[o][s]:r.v[o][s]+(n.v[o][s]-r.v[o][s])*h,t.v[o][s]=u}function i(){var t=this.comp.renderedFrame-this.offsetTime,i=this.keyframes[0].t-this.offsetTime,r=this.keyframes[this.keyframes.length-1].t-this.offsetTime,n=this._caching.lastFrame;return n!==e&&(n<i&&t<i||n>r&&t>r)||(this._caching.lastIndex=n<t?this._caching.lastIndex:0,this.interpolateShape(t,this.pv,this._caching)),this._caching.lastFrame=t,this.pv}function r(){this.paths=this.localShapeCollection}function n(e){(function(e,t){if(e._length!==t._length||e.c!==t.c)return!1;var i,r=e._length;for(i=0;i<r;i+=1)if(e.v[i][0]!==t.v[i][0]||e.v[i][1]!==t.v[i][1]||e.o[i][0]!==t.o[i][0]||e.o[i][1]!==t.o[i][1]||e.i[i][0]!==t.i[i][0]||e.i[i][1]!==t.i[i][1])return!1;return!0})(this.v,e)||(this.v=shapePool.clone(e),this.localShapeCollection.releaseShapes(),this.localShapeCollection.addShape(this.v),this._mdf=!0,this.paths=this.localShapeCollection)}function a(){if(this.elem.globalData.frameId!==this.frameId)if(this.effectsSequence.length)if(this.lock)this.setVValue(this.pv);else{var e,t;this.lock=!0,this._mdf=!1,e=this.kf?this.pv:this.data.ks?this.data.ks.k:this.data.pt.k;var i=this.effectsSequence.length;for(t=0;t<i;t+=1)e=this.effectsSequence[t](e);this.setVValue(e),this.lock=!1,this.frameId=this.elem.globalData.frameId}else this._mdf=!1}function o(e,t,i){this.propType="shape",this.comp=e.comp,this.container=e,this.elem=e,this.data=t,this.k=!1,this.kf=!1,this._mdf=!1;var n=3===i?t.pt.k:t.ks.k;this.v=shapePool.clone(n),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.reset=r,this.effectsSequence=[]}function s(e){this.effectsSequence.push(e),this.container.addDynamicProperty(this)}function l(t,n,a){this.propType="shape",this.comp=t.comp,this.elem=t,this.container=t,this.offsetTime=t.data.st,this.keyframes=3===a?n.pt.k:n.ks.k,this.keyframesMetadata=[],this.k=!0,this.kf=!0;var o=this.keyframes[0].s[0].i.length;this.v=shapePool.newElement(),this.v.setPathData(this.keyframes[0].s[0].c,o),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.lastFrame=e,this.reset=r,this._caching={lastFrame:e,lastIndex:0},this.effectsSequence=[i.bind(this)]}o.prototype.interpolateShape=t,o.prototype.getValue=a,o.prototype.setVValue=n,o.prototype.addEffect=s,l.prototype.getValue=a,l.prototype.interpolateShape=t,l.prototype.setVValue=n,l.prototype.addEffect=s;var c=function(){var e=roundCorner;function t(e,t){this.v=shapePool.newElement(),this.v.setPathData(!0,4),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.localShapeCollection.addShape(this.v),this.d=t.d,this.elem=e,this.comp=e.comp,this.frameId=-1,this.initDynamicPropertyContainer(e),this.p=PropertyFactory.getProp(e,t.p,1,0,this),this.s=PropertyFactory.getProp(e,t.s,1,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertEllToPath())}return t.prototype={reset:r,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertEllToPath())},convertEllToPath:function(){var t=this.p.v[0],i=this.p.v[1],r=this.s.v[0]/2,n=this.s.v[1]/2,a=3!==this.d,o=this.v;o.v[0][0]=t,o.v[0][1]=i-n,o.v[1][0]=a?t+r:t-r,o.v[1][1]=i,o.v[2][0]=t,o.v[2][1]=i+n,o.v[3][0]=a?t-r:t+r,o.v[3][1]=i,o.i[0][0]=a?t-r*e:t+r*e,o.i[0][1]=i-n,o.i[1][0]=a?t+r:t-r,o.i[1][1]=i-n*e,o.i[2][0]=a?t+r*e:t-r*e,o.i[2][1]=i+n,o.i[3][0]=a?t-r:t+r,o.i[3][1]=i+n*e,o.o[0][0]=a?t+r*e:t-r*e,o.o[0][1]=i-n,o.o[1][0]=a?t+r:t-r,o.o[1][1]=i+n*e,o.o[2][0]=a?t-r*e:t+r*e,o.o[2][1]=i+n,o.o[3][0]=a?t-r:t+r,o.o[3][1]=i-n*e}},extendPrototype([DynamicPropertyContainer],t),t}(),h=function(){function e(e,t){this.v=shapePool.newElement(),this.v.setPathData(!0,0),this.elem=e,this.comp=e.comp,this.data=t,this.frameId=-1,this.d=t.d,this.initDynamicPropertyContainer(e),1===t.sy?(this.ir=PropertyFactory.getProp(e,t.ir,0,0,this),this.is=PropertyFactory.getProp(e,t.is,0,.01,this),this.convertToPath=this.convertStarToPath):this.convertToPath=this.convertPolygonToPath,this.pt=PropertyFactory.getProp(e,t.pt,0,0,this),this.p=PropertyFactory.getProp(e,t.p,1,0,this),this.r=PropertyFactory.getProp(e,t.r,0,degToRads,this),this.or=PropertyFactory.getProp(e,t.or,0,0,this),this.os=PropertyFactory.getProp(e,t.os,0,.01,this),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertToPath())}return e.prototype={reset:r,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertToPath())},convertStarToPath:function(){var e,t,i,r,n=2*Math.floor(this.pt.v),a=2*Math.PI/n,o=!0,s=this.or.v,l=this.ir.v,c=this.os.v,h=this.is.v,u=2*Math.PI*s/(2*n),d=2*Math.PI*l/(2*n),p=-Math.PI/2;p+=this.r.v;var f=3===this.data.d?-1:1;for(this.v._length=0,e=0;e<n;e+=1){i=o?c:h,r=o?u:d;var m=(t=o?s:l)*Math.cos(p),g=t*Math.sin(p),_=0===m&&0===g?0:g/Math.sqrt(m*m+g*g),y=0===m&&0===g?0:-m/Math.sqrt(m*m+g*g);m+=+this.p.v[0],g+=+this.p.v[1],this.v.setTripleAt(m,g,m-_*r*i*f,g-y*r*i*f,m+_*r*i*f,g+y*r*i*f,e,!0),o=!o,p+=a*f}},convertPolygonToPath:function(){var e,t=Math.floor(this.pt.v),i=2*Math.PI/t,r=this.or.v,n=this.os.v,a=2*Math.PI*r/(4*t),o=.5*-Math.PI,s=3===this.data.d?-1:1;for(o+=this.r.v,this.v._length=0,e=0;e<t;e+=1){var l=r*Math.cos(o),c=r*Math.sin(o),h=0===l&&0===c?0:c/Math.sqrt(l*l+c*c),u=0===l&&0===c?0:-l/Math.sqrt(l*l+c*c);l+=+this.p.v[0],c+=+this.p.v[1],this.v.setTripleAt(l,c,l-h*a*n*s,c-u*a*n*s,l+h*a*n*s,c+u*a*n*s,e,!0),o+=i*s}this.paths.length=0,this.paths[0]=this.v}},extendPrototype([DynamicPropertyContainer],e),e}(),u=function(){function e(e,t){this.v=shapePool.newElement(),this.v.c=!0,this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.elem=e,this.comp=e.comp,this.frameId=-1,this.d=t.d,this.initDynamicPropertyContainer(e),this.p=PropertyFactory.getProp(e,t.p,1,0,this),this.s=PropertyFactory.getProp(e,t.s,1,0,this),this.r=PropertyFactory.getProp(e,t.r,0,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertRectToPath())}return e.prototype={convertRectToPath:function(){var e=this.p.v[0],t=this.p.v[1],i=this.s.v[0]/2,r=this.s.v[1]/2,n=bmMin(i,r,this.r.v),a=n*(1-roundCorner);this.v._length=0,2===this.d||1===this.d?(this.v.setTripleAt(e+i,t-r+n,e+i,t-r+n,e+i,t-r+a,0,!0),this.v.setTripleAt(e+i,t+r-n,e+i,t+r-a,e+i,t+r-n,1,!0),0!==n?(this.v.setTripleAt(e+i-n,t+r,e+i-n,t+r,e+i-a,t+r,2,!0),this.v.setTripleAt(e-i+n,t+r,e-i+a,t+r,e-i+n,t+r,3,!0),this.v.setTripleAt(e-i,t+r-n,e-i,t+r-n,e-i,t+r-a,4,!0),this.v.setTripleAt(e-i,t-r+n,e-i,t-r+a,e-i,t-r+n,5,!0),this.v.setTripleAt(e-i+n,t-r,e-i+n,t-r,e-i+a,t-r,6,!0),this.v.setTripleAt(e+i-n,t-r,e+i-a,t-r,e+i-n,t-r,7,!0)):(this.v.setTripleAt(e-i,t+r,e-i+a,t+r,e-i,t+r,2),this.v.setTripleAt(e-i,t-r,e-i,t-r+a,e-i,t-r,3))):(this.v.setTripleAt(e+i,t-r+n,e+i,t-r+a,e+i,t-r+n,0,!0),0!==n?(this.v.setTripleAt(e+i-n,t-r,e+i-n,t-r,e+i-a,t-r,1,!0),this.v.setTripleAt(e-i+n,t-r,e-i+a,t-r,e-i+n,t-r,2,!0),this.v.setTripleAt(e-i,t-r+n,e-i,t-r+n,e-i,t-r+a,3,!0),this.v.setTripleAt(e-i,t+r-n,e-i,t+r-a,e-i,t+r-n,4,!0),this.v.setTripleAt(e-i+n,t+r,e-i+n,t+r,e-i+a,t+r,5,!0),this.v.setTripleAt(e+i-n,t+r,e+i-a,t+r,e+i-n,t+r,6,!0),this.v.setTripleAt(e+i,t+r-n,e+i,t+r-n,e+i,t+r-a,7,!0)):(this.v.setTripleAt(e-i,t-r,e-i+a,t-r,e-i,t-r,1,!0),this.v.setTripleAt(e-i,t+r,e-i,t+r-a,e-i,t+r,2,!0),this.v.setTripleAt(e+i,t+r,e+i-a,t+r,e+i,t+r,3,!0)))},getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertRectToPath())},reset:r},extendPrototype([DynamicPropertyContainer],e),e}(),d={getShapeProp:function(e,t,i){var r;return 3===i||4===i?r=(3===i?t.pt:t.ks).k.length?new l(e,t,i):new o(e,t,i):5===i?r=new u(e,t):6===i?r=new c(e,t):7===i&&(r=new h(e,t)),r.k&&e.addDynamicProperty(r),r},getConstructorFunction:function(){return o},getKeyframedConstructorFunction:function(){return l}};return d}(),Matrix=function(){var e=Math.cos,t=Math.sin,i=Math.tan,r=Math.round;function n(){return this.props[0]=1,this.props[1]=0,this.props[2]=0,this.props[3]=0,this.props[4]=0,this.props[5]=1,this.props[6]=0,this.props[7]=0,this.props[8]=0,this.props[9]=0,this.props[10]=1,this.props[11]=0,this.props[12]=0,this.props[13]=0,this.props[14]=0,this.props[15]=1,this}function a(i){if(0===i)return this;var r=e(i),n=t(i);return this._t(r,-n,0,0,n,r,0,0,0,0,1,0,0,0,0,1)}function o(i){if(0===i)return this;var r=e(i),n=t(i);return this._t(1,0,0,0,0,r,-n,0,0,n,r,0,0,0,0,1)}function s(i){if(0===i)return this;var r=e(i),n=t(i);return this._t(r,0,n,0,0,1,0,0,-n,0,r,0,0,0,0,1)}function l(i){if(0===i)return this;var r=e(i),n=t(i);return this._t(r,-n,0,0,n,r,0,0,0,0,1,0,0,0,0,1)}function c(e,t){return this._t(1,t,e,1,0,0)}function h(e,t){return this.shear(i(e),i(t))}function u(r,n){var a=e(n),o=t(n);return this._t(a,o,0,0,-o,a,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,i(r),1,0,0,0,0,1,0,0,0,0,1)._t(a,-o,0,0,o,a,0,0,0,0,1,0,0,0,0,1)}function d(e,t,i){return i||0===i||(i=1),1===e&&1===t&&1===i?this:this._t(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1)}function p(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m){return this.props[0]=e,this.props[1]=t,this.props[2]=i,this.props[3]=r,this.props[4]=n,this.props[5]=a,this.props[6]=o,this.props[7]=s,this.props[8]=l,this.props[9]=c,this.props[10]=h,this.props[11]=u,this.props[12]=d,this.props[13]=p,this.props[14]=f,this.props[15]=m,this}function f(e,t,i){return i=i||0,0!==e||0!==t||0!==i?this._t(1,0,0,0,0,1,0,0,0,0,1,0,e,t,i,1):this}function m(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m){var g=this.props;if(1===e&&0===t&&0===i&&0===r&&0===n&&1===a&&0===o&&0===s&&0===l&&0===c&&1===h&&0===u)return g[12]=g[12]*e+g[15]*d,g[13]=g[13]*a+g[15]*p,g[14]=g[14]*h+g[15]*f,g[15]*=m,this._identityCalculated=!1,this;var _=g[0],y=g[1],v=g[2],x=g[3],b=g[4],w=g[5],S=g[6],T=g[7],E=g[8],M=g[9],A=g[10],P=g[11],C=g[12],I=g[13],k=g[14],D=g[15];return g[0]=_*e+y*n+v*l+x*d,g[1]=_*t+y*a+v*c+x*p,g[2]=_*i+y*o+v*h+x*f,g[3]=_*r+y*s+v*u+x*m,g[4]=b*e+w*n+S*l+T*d,g[5]=b*t+w*a+S*c+T*p,g[6]=b*i+w*o+S*h+T*f,g[7]=b*r+w*s+S*u+T*m,g[8]=E*e+M*n+A*l+P*d,g[9]=E*t+M*a+A*c+P*p,g[10]=E*i+M*o+A*h+P*f,g[11]=E*r+M*s+A*u+P*m,g[12]=C*e+I*n+k*l+D*d,g[13]=C*t+I*a+k*c+D*p,g[14]=C*i+I*o+k*h+D*f,g[15]=C*r+I*s+k*u+D*m,this._identityCalculated=!1,this}function g(e){var t=e.props;return this.transform(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function _(){return this._identityCalculated||(this._identity=!(1!==this.props[0]||0!==this.props[1]||0!==this.props[2]||0!==this.props[3]||0!==this.props[4]||1!==this.props[5]||0!==this.props[6]||0!==this.props[7]||0!==this.props[8]||0!==this.props[9]||1!==this.props[10]||0!==this.props[11]||0!==this.props[12]||0!==this.props[13]||0!==this.props[14]||1!==this.props[15]),this._identityCalculated=!0),this._identity}function y(e){for(var t=0;t<16;){if(e.props[t]!==this.props[t])return!1;t+=1}return!0}function v(e){var t;for(t=0;t<16;t+=1)e.props[t]=this.props[t];return e}function x(e){var t;for(t=0;t<16;t+=1)this.props[t]=e[t]}function b(e,t,i){return{x:e*this.props[0]+t*this.props[4]+i*this.props[8]+this.props[12],y:e*this.props[1]+t*this.props[5]+i*this.props[9]+this.props[13],z:e*this.props[2]+t*this.props[6]+i*this.props[10]+this.props[14]}}function w(e,t,i){return e*this.props[0]+t*this.props[4]+i*this.props[8]+this.props[12]}function S(e,t,i){return e*this.props[1]+t*this.props[5]+i*this.props[9]+this.props[13]}function T(e,t,i){return e*this.props[2]+t*this.props[6]+i*this.props[10]+this.props[14]}function E(){var e=this.props[0]*this.props[5]-this.props[1]*this.props[4],t=this.props[5]/e,i=-this.props[1]/e,r=-this.props[4]/e,n=this.props[0]/e,a=(this.props[4]*this.props[13]-this.props[5]*this.props[12])/e,o=-(this.props[0]*this.props[13]-this.props[1]*this.props[12])/e,s=new Matrix;return s.props[0]=t,s.props[1]=i,s.props[4]=r,s.props[5]=n,s.props[12]=a,s.props[13]=o,s}function M(e){return this.getInverseMatrix().applyToPointArray(e[0],e[1],e[2]||0)}function A(e){var t,i=e.length,r=[];for(t=0;t<i;t+=1)r[t]=M(e[t]);return r}function P(e,t,i){var r=createTypedArray("float32",6);if(this.isIdentity())r[0]=e[0],r[1]=e[1],r[2]=t[0],r[3]=t[1],r[4]=i[0],r[5]=i[1];else{var n=this.props[0],a=this.props[1],o=this.props[4],s=this.props[5],l=this.props[12],c=this.props[13];r[0]=e[0]*n+e[1]*o+l,r[1]=e[0]*a+e[1]*s+c,r[2]=t[0]*n+t[1]*o+l,r[3]=t[0]*a+t[1]*s+c,r[4]=i[0]*n+i[1]*o+l,r[5]=i[0]*a+i[1]*s+c}return r}function C(e,t,i){return this.isIdentity()?[e,t,i]:[e*this.props[0]+t*this.props[4]+i*this.props[8]+this.props[12],e*this.props[1]+t*this.props[5]+i*this.props[9]+this.props[13],e*this.props[2]+t*this.props[6]+i*this.props[10]+this.props[14]]}function I(e,t){if(this.isIdentity())return e+","+t;var i=this.props;return Math.round(100*(e*i[0]+t*i[4]+i[12]))/100+","+Math.round(100*(e*i[1]+t*i[5]+i[13]))/100}function k(){for(var e=0,t=this.props,i="matrix3d(";e<16;)i+=r(1e4*t[e])/1e4,i+=15===e?")":",",e+=1;return i}function D(e){return e<1e-6&&e>0||e>-1e-6&&e<0?r(1e4*e)/1e4:e}function R(){var e=this.props;return"matrix("+D(e[0])+","+D(e[1])+","+D(e[4])+","+D(e[5])+","+D(e[12])+","+D(e[13])+")"}return function(){this.reset=n,this.rotate=a,this.rotateX=o,this.rotateY=s,this.rotateZ=l,this.skew=h,this.skewFromAxis=u,this.shear=c,this.scale=d,this.setTransform=p,this.translate=f,this.transform=m,this.multiply=g,this.applyToPoint=b,this.applyToX=w,this.applyToY=S,this.applyToZ=T,this.applyToPointArray=C,this.applyToTriplePoints=P,this.applyToPointStringified=I,this.toCSS=k,this.to2dCSS=R,this.clone=v,this.cloneFromProps=x,this.equals=y,this.inversePoints=A,this.inversePoint=M,this.getInverseMatrix=E,this._t=this.transform,this.isIdentity=_,this._identity=!0,this._identityCalculated=!1,this.props=createTypedArray("float32",16),this.reset()}}();function _typeof$3(e){return _typeof$3="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$3(e)}var lottie={},standalone="__[STANDALONE]__",animationData="__[ANIMATIONDATA]__",renderer="";function setLocation(e){setLocationHref(e)}function searchAnimations(){!0===standalone?animationManager.searchAnimations(animationData,standalone,renderer):animationManager.searchAnimations()}function setSubframeRendering(e){setSubframeEnabled(e)}function setPrefix(e){setIdPrefix(e)}function loadAnimation(e){return!0===standalone&&(e.animationData=JSON.parse(animationData)),animationManager.loadAnimation(e)}function setQuality(e){if("string"===typeof e)switch(e){case"high":setDefaultCurveSegments(200);break;default:case"medium":setDefaultCurveSegments(50);break;case"low":setDefaultCurveSegments(10)}else!isNaN(e)&&e>1&&setDefaultCurveSegments(e);getDefaultCurveSegments()>=50?roundValues(!1):roundValues(!0)}function inBrowser(){return"undefined"!==typeof navigator}function installPlugin(e,t){"expressions"===e&&setExpressionsPlugin(t)}function getFactory(e){switch(e){case"propertyFactory":return PropertyFactory;case"shapePropertyFactory":return ShapePropertyFactory;case"matrix":return Matrix;default:return null}}function checkReady(){"complete"===document.readyState&&(clearInterval(readyStateCheckInterval),searchAnimations())}function getQueryVariable(e){for(var t=queryString.split("&"),i=0;i<t.length;i+=1){var r=t[i].split("=");if(decodeURIComponent(r[0])==e)return decodeURIComponent(r[1])}return null}lottie.play=animationManager.play,lottie.pause=animationManager.pause,lottie.setLocationHref=setLocation,lottie.togglePause=animationManager.togglePause,lottie.setSpeed=animationManager.setSpeed,lottie.setDirection=animationManager.setDirection,lottie.stop=animationManager.stop,lottie.searchAnimations=searchAnimations,lottie.registerAnimation=animationManager.registerAnimation,lottie.loadAnimation=loadAnimation,lottie.setSubframeRendering=setSubframeRendering,lottie.resize=animationManager.resize,lottie.goToAndStop=animationManager.goToAndStop,lottie.destroy=animationManager.destroy,lottie.setQuality=setQuality,lottie.inBrowser=inBrowser,lottie.installPlugin=installPlugin,lottie.freeze=animationManager.freeze,lottie.unfreeze=animationManager.unfreeze,lottie.setVolume=animationManager.setVolume,lottie.mute=animationManager.mute,lottie.unmute=animationManager.unmute,lottie.getRegisteredAnimations=animationManager.getRegisteredAnimations,lottie.useWebWorker=setWebWorker,lottie.setIDPrefix=setPrefix,lottie.__getFactory=getFactory,lottie.version="5.12.2";var queryString="";if(standalone){var scripts=document.getElementsByTagName("script"),index=scripts.length-1,myScript=scripts[index]||{src:""};queryString=myScript.src?myScript.src.replace(/^[^\?]+\??/,""):"",renderer=getQueryVariable("renderer")}var readyStateCheckInterval=setInterval(checkReady,100);try{"object"!==_typeof$3(exports)&&__webpack_require__.amdO}catch(err){}var ShapeModifiers=function(){var e={},t={};return e.registerModifier=function(e,i){t[e]||(t[e]=i)},e.getModifier=function(e,i,r){return new t[e](i,r)},e}();function ShapeModifier(){}function TrimModifier(){}function PuckerAndBloatModifier(){}ShapeModifier.prototype.initModifierProperties=function(){},ShapeModifier.prototype.addShapeToModifier=function(){},ShapeModifier.prototype.addShape=function(e){if(!this.closed){e.sh.container.addDynamicProperty(e.sh);var t={shape:e.sh,data:e,localShapeCollection:shapeCollectionPool.newShapeCollection()};this.shapes.push(t),this.addShapeToModifier(t),this._isAnimated&&e.setAsAnimated()}},ShapeModifier.prototype.init=function(e,t){this.shapes=[],this.elem=e,this.initDynamicPropertyContainer(e),this.initModifierProperties(e,t),this.frameId=initialDefaultFrame,this.closed=!1,this.k=!1,this.dynamicProperties.length?this.k=!0:this.getValue(!0)},ShapeModifier.prototype.processKeys=function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties())},extendPrototype([DynamicPropertyContainer],ShapeModifier),extendPrototype([ShapeModifier],TrimModifier),TrimModifier.prototype.initModifierProperties=function(e,t){this.s=PropertyFactory.getProp(e,t.s,0,.01,this),this.e=PropertyFactory.getProp(e,t.e,0,.01,this),this.o=PropertyFactory.getProp(e,t.o,0,0,this),this.sValue=0,this.eValue=0,this.getValue=this.processKeys,this.m=t.m,this._isAnimated=!!this.s.effectsSequence.length||!!this.e.effectsSequence.length||!!this.o.effectsSequence.length},TrimModifier.prototype.addShapeToModifier=function(e){e.pathsData=[]},TrimModifier.prototype.calculateShapeEdges=function(e,t,i,r,n){var a=[];t<=1?a.push({s:e,e:t}):e>=1?a.push({s:e-1,e:t-1}):(a.push({s:e,e:1}),a.push({s:0,e:t-1}));var o,s,l=[],c=a.length;for(o=0;o<c;o+=1){var h,u;(s=a[o]).e*n<r||s.s*n>r+i||(h=s.s*n<=r?0:(s.s*n-r)/i,u=s.e*n>=r+i?1:(s.e*n-r)/i,l.push([h,u]))}return l.length||l.push([0,0]),l},TrimModifier.prototype.releasePathsData=function(e){var t,i=e.length;for(t=0;t<i;t+=1)segmentsLengthPool.release(e[t]);return e.length=0,e},TrimModifier.prototype.processShapes=function(e){var t,i,r,n;if(this._mdf||e){var a=this.o.v%360/360;if(a<0&&(a+=1),(t=this.s.v>1?1+a:this.s.v<0?0+a:this.s.v+a)>(i=this.e.v>1?1+a:this.e.v<0?0+a:this.e.v+a)){var o=t;t=i,i=o}t=1e-4*Math.round(1e4*t),i=1e-4*Math.round(1e4*i),this.sValue=t,this.eValue=i}else t=this.sValue,i=this.eValue;var s,l,c,h,u,d=this.shapes.length,p=0;if(i===t)for(n=0;n<d;n+=1)this.shapes[n].localShapeCollection.releaseShapes(),this.shapes[n].shape._mdf=!0,this.shapes[n].shape.paths=this.shapes[n].localShapeCollection,this._mdf&&(this.shapes[n].pathsData.length=0);else if(1===i&&0===t||0===i&&1===t){if(this._mdf)for(n=0;n<d;n+=1)this.shapes[n].pathsData.length=0,this.shapes[n].shape._mdf=!0}else{var f,m,g=[];for(n=0;n<d;n+=1)if((f=this.shapes[n]).shape._mdf||this._mdf||e||2===this.m){if(l=(r=f.shape.paths)._length,u=0,!f.shape._mdf&&f.pathsData.length)u=f.totalShapeLength;else{for(c=this.releasePathsData(f.pathsData),s=0;s<l;s+=1)h=bez.getSegmentsLength(r.shapes[s]),c.push(h),u+=h.totalLength;f.totalShapeLength=u,f.pathsData=c}p+=u,f.shape._mdf=!0}else f.shape.paths=f.localShapeCollection;var _,y=t,v=i,x=0;for(n=d-1;n>=0;n-=1)if((f=this.shapes[n]).shape._mdf){for((m=f.localShapeCollection).releaseShapes(),2===this.m&&d>1?(_=this.calculateShapeEdges(t,i,f.totalShapeLength,x,p),x+=f.totalShapeLength):_=[[y,v]],l=_.length,s=0;s<l;s+=1){y=_[s][0],v=_[s][1],g.length=0,v<=1?g.push({s:f.totalShapeLength*y,e:f.totalShapeLength*v}):y>=1?g.push({s:f.totalShapeLength*(y-1),e:f.totalShapeLength*(v-1)}):(g.push({s:f.totalShapeLength*y,e:f.totalShapeLength}),g.push({s:0,e:f.totalShapeLength*(v-1)}));var b=this.addShapes(f,g[0]);if(g[0].s!==g[0].e){if(g.length>1)if(f.shape.paths.shapes[f.shape.paths._length-1].c){var w=b.pop();this.addPaths(b,m),b=this.addShapes(f,g[1],w)}else this.addPaths(b,m),b=this.addShapes(f,g[1]);this.addPaths(b,m)}}f.shape.paths=m}}},TrimModifier.prototype.addPaths=function(e,t){var i,r=e.length;for(i=0;i<r;i+=1)t.addShape(e[i])},TrimModifier.prototype.addSegment=function(e,t,i,r,n,a,o){n.setXYAt(t[0],t[1],"o",a),n.setXYAt(i[0],i[1],"i",a+1),o&&n.setXYAt(e[0],e[1],"v",a),n.setXYAt(r[0],r[1],"v",a+1)},TrimModifier.prototype.addSegmentFromArray=function(e,t,i,r){t.setXYAt(e[1],e[5],"o",i),t.setXYAt(e[2],e[6],"i",i+1),r&&t.setXYAt(e[0],e[4],"v",i),t.setXYAt(e[3],e[7],"v",i+1)},TrimModifier.prototype.addShapes=function(e,t,i){var r,n,a,o,s,l,c,h,u=e.pathsData,d=e.shape.paths.shapes,p=e.shape.paths._length,f=0,m=[],g=!0;for(i?(s=i._length,h=i._length):(i=shapePool.newElement(),s=0,h=0),m.push(i),r=0;r<p;r+=1){for(l=u[r].lengths,i.c=d[r].c,a=d[r].c?l.length:l.length+1,n=1;n<a;n+=1)if(f+(o=l[n-1]).addedLength<t.s)f+=o.addedLength,i.c=!1;else{if(f>t.e){i.c=!1;break}t.s<=f&&t.e>=f+o.addedLength?(this.addSegment(d[r].v[n-1],d[r].o[n-1],d[r].i[n],d[r].v[n],i,s,g),g=!1):(c=bez.getNewSegment(d[r].v[n-1],d[r].v[n],d[r].o[n-1],d[r].i[n],(t.s-f)/o.addedLength,(t.e-f)/o.addedLength,l[n-1]),this.addSegmentFromArray(c,i,s,g),g=!1,i.c=!1),f+=o.addedLength,s+=1}if(d[r].c&&l.length){if(o=l[n-1],f<=t.e){var _=l[n-1].addedLength;t.s<=f&&t.e>=f+_?(this.addSegment(d[r].v[n-1],d[r].o[n-1],d[r].i[0],d[r].v[0],i,s,g),g=!1):(c=bez.getNewSegment(d[r].v[n-1],d[r].v[0],d[r].o[n-1],d[r].i[0],(t.s-f)/_,(t.e-f)/_,l[n-1]),this.addSegmentFromArray(c,i,s,g),g=!1,i.c=!1)}else i.c=!1;f+=o.addedLength,s+=1}if(i._length&&(i.setXYAt(i.v[h][0],i.v[h][1],"i",h),i.setXYAt(i.v[i._length-1][0],i.v[i._length-1][1],"o",i._length-1)),f>t.e)break;r<p-1&&(i=shapePool.newElement(),g=!0,m.push(i),s=0)}return m},extendPrototype([ShapeModifier],PuckerAndBloatModifier),PuckerAndBloatModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(e,t.a,0,null,this),this._isAnimated=!!this.amount.effectsSequence.length},PuckerAndBloatModifier.prototype.processPath=function(e,t){var i=t/100,r=[0,0],n=e._length,a=0;for(a=0;a<n;a+=1)r[0]+=e.v[a][0],r[1]+=e.v[a][1];r[0]/=n,r[1]/=n;var o,s,l,c,h,u,d=shapePool.newElement();for(d.c=e.c,a=0;a<n;a+=1)o=e.v[a][0]+(r[0]-e.v[a][0])*i,s=e.v[a][1]+(r[1]-e.v[a][1])*i,l=e.o[a][0]+(r[0]-e.o[a][0])*-i,c=e.o[a][1]+(r[1]-e.o[a][1])*-i,h=e.i[a][0]+(r[0]-e.i[a][0])*-i,u=e.i[a][1]+(r[1]-e.i[a][1])*-i,d.setTripleAt(o,s,l,c,h,u,a);return d},PuckerAndBloatModifier.prototype.processShapes=function(e){var t,i,r,n,a,o,s=this.shapes.length,l=this.amount.v;if(0!==l)for(i=0;i<s;i+=1){if(o=(a=this.shapes[i]).localShapeCollection,a.shape._mdf||this._mdf||e)for(o.releaseShapes(),a.shape._mdf=!0,t=a.shape.paths.shapes,n=a.shape.paths._length,r=0;r<n;r+=1)o.addShape(this.processPath(t[r],l));a.shape.paths=a.localShapeCollection}this.dynamicProperties.length||(this._mdf=!1)};var TransformPropertyFactory=function(){var e=[0,0];function t(e,t,i){if(this.elem=e,this.frameId=-1,this.propType="transform",this.data=t,this.v=new Matrix,this.pre=new Matrix,this.appliedTransformations=0,this.initDynamicPropertyContainer(i||e),t.p&&t.p.s?(this.px=PropertyFactory.getProp(e,t.p.x,0,0,this),this.py=PropertyFactory.getProp(e,t.p.y,0,0,this),t.p.z&&(this.pz=PropertyFactory.getProp(e,t.p.z,0,0,this))):this.p=PropertyFactory.getProp(e,t.p||{k:[0,0,0]},1,0,this),t.rx){if(this.rx=PropertyFactory.getProp(e,t.rx,0,degToRads,this),this.ry=PropertyFactory.getProp(e,t.ry,0,degToRads,this),this.rz=PropertyFactory.getProp(e,t.rz,0,degToRads,this),t.or.k[0].ti){var r,n=t.or.k.length;for(r=0;r<n;r+=1)t.or.k[r].to=null,t.or.k[r].ti=null}this.or=PropertyFactory.getProp(e,t.or,1,degToRads,this),this.or.sh=!0}else this.r=PropertyFactory.getProp(e,t.r||{k:0},0,degToRads,this);t.sk&&(this.sk=PropertyFactory.getProp(e,t.sk,0,degToRads,this),this.sa=PropertyFactory.getProp(e,t.sa,0,degToRads,this)),this.a=PropertyFactory.getProp(e,t.a||{k:[0,0,0]},1,0,this),this.s=PropertyFactory.getProp(e,t.s||{k:[100,100,100]},1,.01,this),t.o?this.o=PropertyFactory.getProp(e,t.o,0,.01,e):this.o={_mdf:!1,v:1},this._isDirty=!0,this.dynamicProperties.length||this.getValue(!0)}return t.prototype={applyToMatrix:function(e){var t=this._mdf;this.iterateDynamicProperties(),this._mdf=this._mdf||t,this.a&&e.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.s&&e.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&e.skewFromAxis(-this.sk.v,this.sa.v),this.r?e.rotate(-this.r.v):e.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.data.p.s?this.data.p.z?e.translate(this.px.v,this.py.v,-this.pz.v):e.translate(this.px.v,this.py.v,0):e.translate(this.p.v[0],this.p.v[1],-this.p.v[2])},getValue:function(t){if(this.elem.globalData.frameId!==this.frameId){if(this._isDirty&&(this.precalculateMatrix(),this._isDirty=!1),this.iterateDynamicProperties(),this._mdf||t){var i;if(this.v.cloneFromProps(this.pre.props),this.appliedTransformations<1&&this.v.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations<2&&this.v.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&this.appliedTransformations<3&&this.v.skewFromAxis(-this.sk.v,this.sa.v),this.r&&this.appliedTransformations<4?this.v.rotate(-this.r.v):!this.r&&this.appliedTransformations<4&&this.v.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.autoOriented){var r,n;if(i=this.elem.globalData.frameRate,this.p&&this.p.keyframes&&this.p.getValueAtTime)this.p._caching.lastFrame+this.p.offsetTime<=this.p.keyframes[0].t?(r=this.p.getValueAtTime((this.p.keyframes[0].t+.01)/i,0),n=this.p.getValueAtTime(this.p.keyframes[0].t/i,0)):this.p._caching.lastFrame+this.p.offsetTime>=this.p.keyframes[this.p.keyframes.length-1].t?(r=this.p.getValueAtTime(this.p.keyframes[this.p.keyframes.length-1].t/i,0),n=this.p.getValueAtTime((this.p.keyframes[this.p.keyframes.length-1].t-.05)/i,0)):(r=this.p.pv,n=this.p.getValueAtTime((this.p._caching.lastFrame+this.p.offsetTime-.01)/i,this.p.offsetTime));else if(this.px&&this.px.keyframes&&this.py.keyframes&&this.px.getValueAtTime&&this.py.getValueAtTime){r=[],n=[];var a=this.px,o=this.py;a._caching.lastFrame+a.offsetTime<=a.keyframes[0].t?(r[0]=a.getValueAtTime((a.keyframes[0].t+.01)/i,0),r[1]=o.getValueAtTime((o.keyframes[0].t+.01)/i,0),n[0]=a.getValueAtTime(a.keyframes[0].t/i,0),n[1]=o.getValueAtTime(o.keyframes[0].t/i,0)):a._caching.lastFrame+a.offsetTime>=a.keyframes[a.keyframes.length-1].t?(r[0]=a.getValueAtTime(a.keyframes[a.keyframes.length-1].t/i,0),r[1]=o.getValueAtTime(o.keyframes[o.keyframes.length-1].t/i,0),n[0]=a.getValueAtTime((a.keyframes[a.keyframes.length-1].t-.01)/i,0),n[1]=o.getValueAtTime((o.keyframes[o.keyframes.length-1].t-.01)/i,0)):(r=[a.pv,o.pv],n[0]=a.getValueAtTime((a._caching.lastFrame+a.offsetTime-.01)/i,a.offsetTime),n[1]=o.getValueAtTime((o._caching.lastFrame+o.offsetTime-.01)/i,o.offsetTime))}else r=n=e;this.v.rotate(-Math.atan2(r[1]-n[1],r[0]-n[0]))}this.data.p&&this.data.p.s?this.data.p.z?this.v.translate(this.px.v,this.py.v,-this.pz.v):this.v.translate(this.px.v,this.py.v,0):this.v.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}this.frameId=this.elem.globalData.frameId}},precalculateMatrix:function(){if(this.appliedTransformations=0,this.pre.reset(),!this.a.effectsSequence.length&&(this.pre.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations=1,!this.s.effectsSequence.length)){if(this.pre.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.appliedTransformations=2,this.sk){if(this.sk.effectsSequence.length||this.sa.effectsSequence.length)return;this.pre.skewFromAxis(-this.sk.v,this.sa.v),this.appliedTransformations=3}this.r?this.r.effectsSequence.length||(this.pre.rotate(-this.r.v),this.appliedTransformations=4):this.rz.effectsSequence.length||this.ry.effectsSequence.length||this.rx.effectsSequence.length||this.or.effectsSequence.length||(this.pre.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.appliedTransformations=4)}},autoOrient:function(){}},extendPrototype([DynamicPropertyContainer],t),t.prototype.addDynamicProperty=function(e){this._addDynamicProperty(e),this.elem.addDynamicProperty(e),this._isDirty=!0},t.prototype._addDynamicProperty=DynamicPropertyContainer.prototype.addDynamicProperty,{getTransformProperty:function(e,i,r){return new t(e,i,r)}}}();function RepeaterModifier(){}function RoundCornersModifier(){}function floatEqual(e,t){return 1e5*Math.abs(e-t)<=Math.min(Math.abs(e),Math.abs(t))}function floatZero(e){return Math.abs(e)<=1e-5}function lerp(e,t,i){return e*(1-i)+t*i}function lerpPoint(e,t,i){return[lerp(e[0],t[0],i),lerp(e[1],t[1],i)]}function quadRoots(e,t,i){if(0===e)return[];var r=t*t-4*e*i;if(r<0)return[];var n=-t/(2*e);if(0===r)return[n];var a=Math.sqrt(r)/(2*e);return[n-a,n+a]}function polynomialCoefficients(e,t,i,r){return[3*t-e-3*i+r,3*e-6*t+3*i,-3*e+3*t,e]}function singlePoint(e){return new PolynomialBezier(e,e,e,e,!1)}function PolynomialBezier(e,t,i,r,n){n&&pointEqual(e,t)&&(t=lerpPoint(e,r,1/3)),n&&pointEqual(i,r)&&(i=lerpPoint(e,r,2/3));var a=polynomialCoefficients(e[0],t[0],i[0],r[0]),o=polynomialCoefficients(e[1],t[1],i[1],r[1]);this.a=[a[0],o[0]],this.b=[a[1],o[1]],this.c=[a[2],o[2]],this.d=[a[3],o[3]],this.points=[e,t,i,r]}function extrema(e,t){var i=e.points[0][t],r=e.points[e.points.length-1][t];if(i>r){var n=r;r=i,i=n}for(var a=quadRoots(3*e.a[t],2*e.b[t],e.c[t]),o=0;o<a.length;o+=1)if(a[o]>0&&a[o]<1){var s=e.point(a[o])[t];s<i?i=s:s>r&&(r=s)}return{min:i,max:r}}function intersectData(e,t,i){var r=e.boundingBox();return{cx:r.cx,cy:r.cy,width:r.width,height:r.height,bez:e,t:(t+i)/2,t1:t,t2:i}}function splitData(e){var t=e.bez.split(.5);return[intersectData(t[0],e.t1,e.t),intersectData(t[1],e.t,e.t2)]}function boxIntersect(e,t){return 2*Math.abs(e.cx-t.cx)<e.width+t.width&&2*Math.abs(e.cy-t.cy)<e.height+t.height}function intersectsImpl(e,t,i,r,n,a){if(boxIntersect(e,t))if(i>=a||e.width<=r&&e.height<=r&&t.width<=r&&t.height<=r)n.push([e.t,t.t]);else{var o=splitData(e),s=splitData(t);intersectsImpl(o[0],s[0],i+1,r,n,a),intersectsImpl(o[0],s[1],i+1,r,n,a),intersectsImpl(o[1],s[0],i+1,r,n,a),intersectsImpl(o[1],s[1],i+1,r,n,a)}}function crossProduct(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function lineIntersection(e,t,i,r){var n=[e[0],e[1],1],a=[t[0],t[1],1],o=[i[0],i[1],1],s=[r[0],r[1],1],l=crossProduct(crossProduct(n,a),crossProduct(o,s));return floatZero(l[2])?null:[l[0]/l[2],l[1]/l[2]]}function polarOffset(e,t,i){return[e[0]+Math.cos(t)*i,e[1]-Math.sin(t)*i]}function pointDistance(e,t){return Math.hypot(e[0]-t[0],e[1]-t[1])}function pointEqual(e,t){return floatEqual(e[0],t[0])&&floatEqual(e[1],t[1])}function ZigZagModifier(){}function setPoint(e,t,i,r,n,a,o){var s=i-Math.PI/2,l=i+Math.PI/2,c=t[0]+Math.cos(i)*r*n,h=t[1]-Math.sin(i)*r*n;e.setTripleAt(c,h,c+Math.cos(s)*a,h-Math.sin(s)*a,c+Math.cos(l)*o,h-Math.sin(l)*o,e.length())}function getPerpendicularVector(e,t){var i=[t[0]-e[0],t[1]-e[1]],r=.5*-Math.PI;return[Math.cos(r)*i[0]-Math.sin(r)*i[1],Math.sin(r)*i[0]+Math.cos(r)*i[1]]}function getProjectingAngle(e,t){var i=0===t?e.length()-1:t-1,r=(t+1)%e.length(),n=getPerpendicularVector(e.v[i],e.v[r]);return Math.atan2(0,1)-Math.atan2(n[1],n[0])}function zigZagCorner(e,t,i,r,n,a,o){var s=getProjectingAngle(t,i),l=t.v[i%t._length],c=t.v[0===i?t._length-1:i-1],h=t.v[(i+1)%t._length],u=2===a?Math.sqrt(Math.pow(l[0]-c[0],2)+Math.pow(l[1]-c[1],2)):0,d=2===a?Math.sqrt(Math.pow(l[0]-h[0],2)+Math.pow(l[1]-h[1],2)):0;setPoint(e,t.v[i%t._length],s,o,r,d/(2*(n+1)),u/(2*(n+1)),a)}function zigZagSegment(e,t,i,r,n,a){for(var o=0;o<r;o+=1){var s=(o+1)/(r+1),l=2===n?Math.sqrt(Math.pow(t.points[3][0]-t.points[0][0],2)+Math.pow(t.points[3][1]-t.points[0][1],2)):0,c=t.normalAngle(s);setPoint(e,t.point(s),c,a,i,l/(2*(r+1)),l/(2*(r+1)),n),a=-a}return a}function linearOffset(e,t,i){var r=Math.atan2(t[0]-e[0],t[1]-e[1]);return[polarOffset(e,r,i),polarOffset(t,r,i)]}function offsetSegment(e,t){var i,r,n,a,o,s,l;i=(l=linearOffset(e.points[0],e.points[1],t))[0],r=l[1],n=(l=linearOffset(e.points[1],e.points[2],t))[0],a=l[1],o=(l=linearOffset(e.points[2],e.points[3],t))[0],s=l[1];var c=lineIntersection(i,r,n,a);null===c&&(c=r);var h=lineIntersection(o,s,n,a);return null===h&&(h=o),new PolynomialBezier(i,c,h,s)}function joinLines(e,t,i,r,n){var a=t.points[3],o=i.points[0];if(3===r)return a;if(pointEqual(a,o))return a;if(2===r){var s=-t.tangentAngle(1),l=-i.tangentAngle(0)+Math.PI,c=lineIntersection(a,polarOffset(a,s+Math.PI/2,100),o,polarOffset(o,s+Math.PI/2,100)),h=c?pointDistance(c,a):pointDistance(a,o)/2,u=polarOffset(a,s,2*h*roundCorner);return e.setXYAt(u[0],u[1],"o",e.length()-1),u=polarOffset(o,l,2*h*roundCorner),e.setTripleAt(o[0],o[1],o[0],o[1],u[0],u[1],e.length()),o}var d=lineIntersection(pointEqual(a,t.points[2])?t.points[0]:t.points[2],a,o,pointEqual(o,i.points[1])?i.points[3]:i.points[1]);return d&&pointDistance(d,a)<n?(e.setTripleAt(d[0],d[1],d[0],d[1],d[0],d[1],e.length()),d):a}function getIntersection(e,t){var i=e.intersections(t);return i.length&&floatEqual(i[0][0],1)&&i.shift(),i.length?i[0]:null}function pruneSegmentIntersection(e,t){var i=e.slice(),r=t.slice(),n=getIntersection(e[e.length-1],t[0]);return n&&(i[e.length-1]=e[e.length-1].split(n[0])[0],r[0]=t[0].split(n[1])[1]),e.length>1&&t.length>1&&(n=getIntersection(e[0],t[t.length-1]))?[[e[0].split(n[0])[0]],[t[t.length-1].split(n[1])[1]]]:[i,r]}function pruneIntersections(e){for(var t,i=1;i<e.length;i+=1)t=pruneSegmentIntersection(e[i-1],e[i]),e[i-1]=t[0],e[i]=t[1];return e.length>1&&(t=pruneSegmentIntersection(e[e.length-1],e[0]),e[e.length-1]=t[0],e[0]=t[1]),e}function offsetSegmentSplit(e,t){var i,r,n,a,o=e.inflectionPoints();if(0===o.length)return[offsetSegment(e,t)];if(1===o.length||floatEqual(o[1],1))return i=(n=e.split(o[0]))[0],r=n[1],[offsetSegment(i,t),offsetSegment(r,t)];i=(n=e.split(o[0]))[0];var s=(o[1]-o[0])/(1-o[0]);return a=(n=n[1].split(s))[0],r=n[1],[offsetSegment(i,t),offsetSegment(a,t),offsetSegment(r,t)]}function OffsetPathModifier(){}function getFontProperties(e){for(var t=e.fStyle?e.fStyle.split(" "):[],i="normal",r="normal",n=t.length,a=0;a<n;a+=1)switch(t[a].toLowerCase()){case"italic":r="italic";break;case"bold":i="700";break;case"black":i="900";break;case"medium":i="500";break;case"regular":case"normal":i="400";break;case"light":case"thin":i="200"}return{style:r,weight:e.fWeight||i}}extendPrototype([ShapeModifier],RepeaterModifier),RepeaterModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.c=PropertyFactory.getProp(e,t.c,0,null,this),this.o=PropertyFactory.getProp(e,t.o,0,null,this),this.tr=TransformPropertyFactory.getTransformProperty(e,t.tr,this),this.so=PropertyFactory.getProp(e,t.tr.so,0,.01,this),this.eo=PropertyFactory.getProp(e,t.tr.eo,0,.01,this),this.data=t,this.dynamicProperties.length||this.getValue(!0),this._isAnimated=!!this.dynamicProperties.length,this.pMatrix=new Matrix,this.rMatrix=new Matrix,this.sMatrix=new Matrix,this.tMatrix=new Matrix,this.matrix=new Matrix},RepeaterModifier.prototype.applyTransforms=function(e,t,i,r,n,a){var o=a?-1:1,s=r.s.v[0]+(1-r.s.v[0])*(1-n),l=r.s.v[1]+(1-r.s.v[1])*(1-n);e.translate(r.p.v[0]*o*n,r.p.v[1]*o*n,r.p.v[2]),t.translate(-r.a.v[0],-r.a.v[1],r.a.v[2]),t.rotate(-r.r.v*o*n),t.translate(r.a.v[0],r.a.v[1],r.a.v[2]),i.translate(-r.a.v[0],-r.a.v[1],r.a.v[2]),i.scale(a?1/s:s,a?1/l:l),i.translate(r.a.v[0],r.a.v[1],r.a.v[2])},RepeaterModifier.prototype.init=function(e,t,i,r){for(this.elem=e,this.arr=t,this.pos=i,this.elemsData=r,this._currentCopies=0,this._elements=[],this._groups=[],this.frameId=-1,this.initDynamicPropertyContainer(e),this.initModifierProperties(e,t[i]);i>0;)i-=1,this._elements.unshift(t[i]);this.dynamicProperties.length?this.k=!0:this.getValue(!0)},RepeaterModifier.prototype.resetElements=function(e){var t,i=e.length;for(t=0;t<i;t+=1)e[t]._processed=!1,"gr"===e[t].ty&&this.resetElements(e[t].it)},RepeaterModifier.prototype.cloneElements=function(e){var t=JSON.parse(JSON.stringify(e));return this.resetElements(t),t},RepeaterModifier.prototype.changeGroupRender=function(e,t){var i,r=e.length;for(i=0;i<r;i+=1)e[i]._render=t,"gr"===e[i].ty&&this.changeGroupRender(e[i].it,t)},RepeaterModifier.prototype.processShapes=function(e){var t,i,r,n,a,o=!1;if(this._mdf||e){var s,l=Math.ceil(this.c.v);if(this._groups.length<l){for(;this._groups.length<l;){var c={it:this.cloneElements(this._elements),ty:"gr"};c.it.push({a:{a:0,ix:1,k:[0,0]},nm:"Transform",o:{a:0,ix:7,k:100},p:{a:0,ix:2,k:[0,0]},r:{a:1,ix:6,k:[{s:0,e:0,t:0},{s:0,e:0,t:1}]},s:{a:0,ix:3,k:[100,100]},sa:{a:0,ix:5,k:0},sk:{a:0,ix:4,k:0},ty:"tr"}),this.arr.splice(0,0,c),this._groups.splice(0,0,c),this._currentCopies+=1}this.elem.reloadShapes(),o=!0}for(a=0,r=0;r<=this._groups.length-1;r+=1){if(s=a<l,this._groups[r]._render=s,this.changeGroupRender(this._groups[r].it,s),!s){var h=this.elemsData[r].it,u=h[h.length-1];0!==u.transform.op.v?(u.transform.op._mdf=!0,u.transform.op.v=0):u.transform.op._mdf=!1}a+=1}this._currentCopies=l;var d=this.o.v,p=d%1,f=d>0?Math.floor(d):Math.ceil(d),m=this.pMatrix.props,g=this.rMatrix.props,_=this.sMatrix.props;this.pMatrix.reset(),this.rMatrix.reset(),this.sMatrix.reset(),this.tMatrix.reset(),this.matrix.reset();var y,v,x=0;if(d>0){for(;x<f;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),x+=1;p&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,p,!1),x+=p)}else if(d<0){for(;x>f;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!0),x-=1;p&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,-p,!0),x-=p)}for(r=1===this.data.m?0:this._currentCopies-1,n=1===this.data.m?1:-1,a=this._currentCopies;a;){if(v=(i=(t=this.elemsData[r].it)[t.length-1].transform.mProps.v.props).length,t[t.length-1].transform.mProps._mdf=!0,t[t.length-1].transform.op._mdf=!0,t[t.length-1].transform.op.v=1===this._currentCopies?this.so.v:this.so.v+(this.eo.v-this.so.v)*(r/(this._currentCopies-1)),0!==x){for((0!==r&&1===n||r!==this._currentCopies-1&&-1===n)&&this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),this.matrix.transform(g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],g[8],g[9],g[10],g[11],g[12],g[13],g[14],g[15]),this.matrix.transform(_[0],_[1],_[2],_[3],_[4],_[5],_[6],_[7],_[8],_[9],_[10],_[11],_[12],_[13],_[14],_[15]),this.matrix.transform(m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15]),y=0;y<v;y+=1)i[y]=this.matrix.props[y];this.matrix.reset()}else for(this.matrix.reset(),y=0;y<v;y+=1)i[y]=this.matrix.props[y];x+=1,a-=1,r+=n}}else for(a=this._currentCopies,r=0,n=1;a;)i=(t=this.elemsData[r].it)[t.length-1].transform.mProps.v.props,t[t.length-1].transform.mProps._mdf=!1,t[t.length-1].transform.op._mdf=!1,a-=1,r+=n;return o},RepeaterModifier.prototype.addShape=function(){},extendPrototype([ShapeModifier],RoundCornersModifier),RoundCornersModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.rd=PropertyFactory.getProp(e,t.r,0,null,this),this._isAnimated=!!this.rd.effectsSequence.length},RoundCornersModifier.prototype.processPath=function(e,t){var i,r=shapePool.newElement();r.c=e.c;var n,a,o,s,l,c,h,u,d,p,f,m,g=e._length,_=0;for(i=0;i<g;i+=1)n=e.v[i],o=e.o[i],a=e.i[i],n[0]===o[0]&&n[1]===o[1]&&n[0]===a[0]&&n[1]===a[1]?0!==i&&i!==g-1||e.c?(s=0===i?e.v[g-1]:e.v[i-1],c=(l=Math.sqrt(Math.pow(n[0]-s[0],2)+Math.pow(n[1]-s[1],2)))?Math.min(l/2,t)/l:0,h=f=n[0]+(s[0]-n[0])*c,u=m=n[1]-(n[1]-s[1])*c,d=h-(h-n[0])*roundCorner,p=u-(u-n[1])*roundCorner,r.setTripleAt(h,u,d,p,f,m,_),_+=1,s=i===g-1?e.v[0]:e.v[i+1],c=(l=Math.sqrt(Math.pow(n[0]-s[0],2)+Math.pow(n[1]-s[1],2)))?Math.min(l/2,t)/l:0,h=d=n[0]+(s[0]-n[0])*c,u=p=n[1]+(s[1]-n[1])*c,f=h-(h-n[0])*roundCorner,m=u-(u-n[1])*roundCorner,r.setTripleAt(h,u,d,p,f,m,_),_+=1):(r.setTripleAt(n[0],n[1],o[0],o[1],a[0],a[1],_),_+=1):(r.setTripleAt(e.v[i][0],e.v[i][1],e.o[i][0],e.o[i][1],e.i[i][0],e.i[i][1],_),_+=1);return r},RoundCornersModifier.prototype.processShapes=function(e){var t,i,r,n,a,o,s=this.shapes.length,l=this.rd.v;if(0!==l)for(i=0;i<s;i+=1){if(o=(a=this.shapes[i]).localShapeCollection,a.shape._mdf||this._mdf||e)for(o.releaseShapes(),a.shape._mdf=!0,t=a.shape.paths.shapes,n=a.shape.paths._length,r=0;r<n;r+=1)o.addShape(this.processPath(t[r],l));a.shape.paths=a.localShapeCollection}this.dynamicProperties.length||(this._mdf=!1)},PolynomialBezier.prototype.point=function(e){return[((this.a[0]*e+this.b[0])*e+this.c[0])*e+this.d[0],((this.a[1]*e+this.b[1])*e+this.c[1])*e+this.d[1]]},PolynomialBezier.prototype.derivative=function(e){return[(3*e*this.a[0]+2*this.b[0])*e+this.c[0],(3*e*this.a[1]+2*this.b[1])*e+this.c[1]]},PolynomialBezier.prototype.tangentAngle=function(e){var t=this.derivative(e);return Math.atan2(t[1],t[0])},PolynomialBezier.prototype.normalAngle=function(e){var t=this.derivative(e);return Math.atan2(t[0],t[1])},PolynomialBezier.prototype.inflectionPoints=function(){var e=this.a[1]*this.b[0]-this.a[0]*this.b[1];if(floatZero(e))return[];var t=-.5*(this.a[1]*this.c[0]-this.a[0]*this.c[1])/e,i=t*t-1/3*(this.b[1]*this.c[0]-this.b[0]*this.c[1])/e;if(i<0)return[];var r=Math.sqrt(i);return floatZero(r)?r>0&&r<1?[t]:[]:[t-r,t+r].filter((function(e){return e>0&&e<1}))},PolynomialBezier.prototype.split=function(e){if(e<=0)return[singlePoint(this.points[0]),this];if(e>=1)return[this,singlePoint(this.points[this.points.length-1])];var t=lerpPoint(this.points[0],this.points[1],e),i=lerpPoint(this.points[1],this.points[2],e),r=lerpPoint(this.points[2],this.points[3],e),n=lerpPoint(t,i,e),a=lerpPoint(i,r,e),o=lerpPoint(n,a,e);return[new PolynomialBezier(this.points[0],t,n,o,!0),new PolynomialBezier(o,a,r,this.points[3],!0)]},PolynomialBezier.prototype.bounds=function(){return{x:extrema(this,0),y:extrema(this,1)}},PolynomialBezier.prototype.boundingBox=function(){var e=this.bounds();return{left:e.x.min,right:e.x.max,top:e.y.min,bottom:e.y.max,width:e.x.max-e.x.min,height:e.y.max-e.y.min,cx:(e.x.max+e.x.min)/2,cy:(e.y.max+e.y.min)/2}},PolynomialBezier.prototype.intersections=function(e,t,i){void 0===t&&(t=2),void 0===i&&(i=7);var r=[];return intersectsImpl(intersectData(this,0,1),intersectData(e,0,1),0,t,r,i),r},PolynomialBezier.shapeSegment=function(e,t){var i=(t+1)%e.length();return new PolynomialBezier(e.v[t],e.o[t],e.i[i],e.v[i],!0)},PolynomialBezier.shapeSegmentInverted=function(e,t){var i=(t+1)%e.length();return new PolynomialBezier(e.v[i],e.i[i],e.o[t],e.v[t],!0)},extendPrototype([ShapeModifier],ZigZagModifier),ZigZagModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.amplitude=PropertyFactory.getProp(e,t.s,0,null,this),this.frequency=PropertyFactory.getProp(e,t.r,0,null,this),this.pointsType=PropertyFactory.getProp(e,t.pt,0,null,this),this._isAnimated=0!==this.amplitude.effectsSequence.length||0!==this.frequency.effectsSequence.length||0!==this.pointsType.effectsSequence.length},ZigZagModifier.prototype.processPath=function(e,t,i,r){var n=e._length,a=shapePool.newElement();if(a.c=e.c,e.c||(n-=1),0===n)return a;var o=-1,s=PolynomialBezier.shapeSegment(e,0);zigZagCorner(a,e,0,t,i,r,o);for(var l=0;l<n;l+=1)o=zigZagSegment(a,s,t,i,r,-o),s=l!==n-1||e.c?PolynomialBezier.shapeSegment(e,(l+1)%n):null,zigZagCorner(a,e,l+1,t,i,r,o);return a},ZigZagModifier.prototype.processShapes=function(e){var t,i,r,n,a,o,s=this.shapes.length,l=this.amplitude.v,c=Math.max(0,Math.round(this.frequency.v)),h=this.pointsType.v;if(0!==l)for(i=0;i<s;i+=1){if(o=(a=this.shapes[i]).localShapeCollection,a.shape._mdf||this._mdf||e)for(o.releaseShapes(),a.shape._mdf=!0,t=a.shape.paths.shapes,n=a.shape.paths._length,r=0;r<n;r+=1)o.addShape(this.processPath(t[r],l,c,h));a.shape.paths=a.localShapeCollection}this.dynamicProperties.length||(this._mdf=!1)},extendPrototype([ShapeModifier],OffsetPathModifier),OffsetPathModifier.prototype.initModifierProperties=function(e,t){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(e,t.a,0,null,this),this.miterLimit=PropertyFactory.getProp(e,t.ml,0,null,this),this.lineJoin=t.lj,this._isAnimated=0!==this.amount.effectsSequence.length},OffsetPathModifier.prototype.processPath=function(e,t,i,r){var n=shapePool.newElement();n.c=e.c;var a,o,s,l=e.length();e.c||(l-=1);var c=[];for(a=0;a<l;a+=1)s=PolynomialBezier.shapeSegment(e,a),c.push(offsetSegmentSplit(s,t));if(!e.c)for(a=l-1;a>=0;a-=1)s=PolynomialBezier.shapeSegmentInverted(e,a),c.push(offsetSegmentSplit(s,t));c=pruneIntersections(c);var h=null,u=null;for(a=0;a<c.length;a+=1){var d=c[a];for(u&&(h=joinLines(n,u,d[0],i,r)),u=d[d.length-1],o=0;o<d.length;o+=1)s=d[o],h&&pointEqual(s.points[0],h)?n.setXYAt(s.points[1][0],s.points[1][1],"o",n.length()-1):n.setTripleAt(s.points[0][0],s.points[0][1],s.points[1][0],s.points[1][1],s.points[0][0],s.points[0][1],n.length()),n.setTripleAt(s.points[3][0],s.points[3][1],s.points[3][0],s.points[3][1],s.points[2][0],s.points[2][1],n.length()),h=s.points[3]}return c.length&&joinLines(n,u,c[0][0],i,r),n},OffsetPathModifier.prototype.processShapes=function(e){var t,i,r,n,a,o,s=this.shapes.length,l=this.amount.v,c=this.miterLimit.v,h=this.lineJoin;if(0!==l)for(i=0;i<s;i+=1){if(o=(a=this.shapes[i]).localShapeCollection,a.shape._mdf||this._mdf||e)for(o.releaseShapes(),a.shape._mdf=!0,t=a.shape.paths.shapes,n=a.shape.paths._length,r=0;r<n;r+=1)o.addShape(this.processPath(t[r],l,h,c));a.shape.paths=a.localShapeCollection}this.dynamicProperties.length||(this._mdf=!1)};var FontManager=function(){var e={w:0,size:0,shapes:[],data:{shapes:[]}},t=[];t=t.concat([2304,2305,2306,2307,2362,2363,2364,2364,2366,2367,2368,2369,2370,2371,2372,2373,2374,2375,2376,2377,2378,2379,2380,2381,2382,2383,2387,2388,2389,2390,2391,2402,2403]);var i=127988,r=127462,n=127487,a=["d83cdffb","d83cdffc","d83cdffd","d83cdffe","d83cdfff"];function o(e,t){var i=createTag("span");i.setAttribute("aria-hidden",!0),i.style.fontFamily=t;var r=createTag("span");r.innerText="giItT1WQy@!-/#",i.style.position="absolute",i.style.left="-10000px",i.style.top="-10000px",i.style.fontSize="300px",i.style.fontVariant="normal",i.style.fontStyle="normal",i.style.fontWeight="normal",i.style.letterSpacing="0",i.appendChild(r),document.body.appendChild(i);var n=r.offsetWidth;return r.style.fontFamily=function(e){var t,i=e.split(","),r=i.length,n=[];for(t=0;t<r;t+=1)"sans-serif"!==i[t]&&"monospace"!==i[t]&&n.push(i[t]);return n.join(",")}(e)+", "+t,{node:r,w:n,parent:i}}function s(e,t){var i,r=document.body&&t?"svg":"canvas",n=getFontProperties(e);if("svg"===r){var a=createNS("text");a.style.fontSize="100px",a.setAttribute("font-family",e.fFamily),a.setAttribute("font-style",n.style),a.setAttribute("font-weight",n.weight),a.textContent="1",e.fClass?(a.style.fontFamily="inherit",a.setAttribute("class",e.fClass)):a.style.fontFamily=e.fFamily,t.appendChild(a),i=a}else{var o=new OffscreenCanvas(500,500).getContext("2d");o.font=n.style+" "+n.weight+" 100px "+e.fFamily,i=o}return{measureText:function(e){return"svg"===r?(i.textContent=e,i.getComputedTextLength()):i.measureText(e).width}}}function l(e){var t=0,i=e.charCodeAt(0);if(i>=55296&&i<=56319){var r=e.charCodeAt(1);r>=56320&&r<=57343&&(t=1024*(i-55296)+r-56320+65536)}return t}function c(e){var t=l(e);return t>=r&&t<=n}var h=function(){this.fonts=[],this.chars=null,this.typekitLoaded=0,this.isLoaded=!1,this._warned=!1,this.initTime=Date.now(),this.setIsLoadedBinded=this.setIsLoaded.bind(this),this.checkLoadedFontsBinded=this.checkLoadedFonts.bind(this)};h.isModifier=function(e,t){var i=e.toString(16)+t.toString(16);return-1!==a.indexOf(i)},h.isZeroWidthJoiner=function(e){return 8205===e},h.isFlagEmoji=function(e){return c(e.substr(0,2))&&c(e.substr(2,2))},h.isRegionalCode=c,h.isCombinedCharacter=function(e){return-1!==t.indexOf(e)},h.isRegionalFlag=function(e,t){var r=l(e.substr(t,2));if(r!==i)return!1;var n=0;for(t+=2;n<5;){if((r=l(e.substr(t,2)))<917601||r>917626)return!1;n+=1,t+=2}return 917631===l(e.substr(t,2))},h.isVariationSelector=function(e){return 65039===e},h.BLACK_FLAG_CODE_POINT=i;var u={addChars:function(e){if(e){var t;this.chars||(this.chars=[]);var i,r,n=e.length,a=this.chars.length;for(t=0;t<n;t+=1){for(i=0,r=!1;i<a;)this.chars[i].style===e[t].style&&this.chars[i].fFamily===e[t].fFamily&&this.chars[i].ch===e[t].ch&&(r=!0),i+=1;r||(this.chars.push(e[t]),a+=1)}}},addFonts:function(e,t){if(e){if(this.chars)return this.isLoaded=!0,void(this.fonts=e.list);if(!document.body)return this.isLoaded=!0,e.list.forEach((function(e){e.helper=s(e),e.cache={}})),void(this.fonts=e.list);var i,r=e.list,n=r.length,a=n;for(i=0;i<n;i+=1){var l,c,h=!0;if(r[i].loaded=!1,r[i].monoCase=o(r[i].fFamily,"monospace"),r[i].sansCase=o(r[i].fFamily,"sans-serif"),r[i].fPath){if("p"===r[i].fOrigin||3===r[i].origin){if((l=document.querySelectorAll('style[f-forigin="p"][f-family="'+r[i].fFamily+'"], style[f-origin="3"][f-family="'+r[i].fFamily+'"]')).length>0&&(h=!1),h){var u=createTag("style");u.setAttribute("f-forigin",r[i].fOrigin),u.setAttribute("f-origin",r[i].origin),u.setAttribute("f-family",r[i].fFamily),u.type="text/css",u.innerText="@font-face {font-family: "+r[i].fFamily+"; font-style: normal; src: url('"+r[i].fPath+"');}",t.appendChild(u)}}else if("g"===r[i].fOrigin||1===r[i].origin){for(l=document.querySelectorAll('link[f-forigin="g"], link[f-origin="1"]'),c=0;c<l.length;c+=1)-1!==l[c].href.indexOf(r[i].fPath)&&(h=!1);if(h){var d=createTag("link");d.setAttribute("f-forigin",r[i].fOrigin),d.setAttribute("f-origin",r[i].origin),d.type="text/css",d.rel="stylesheet",d.href=r[i].fPath,document.body.appendChild(d)}}else if("t"===r[i].fOrigin||2===r[i].origin){for(l=document.querySelectorAll('script[f-forigin="t"], script[f-origin="2"]'),c=0;c<l.length;c+=1)r[i].fPath===l[c].src&&(h=!1);if(h){var p=createTag("link");p.setAttribute("f-forigin",r[i].fOrigin),p.setAttribute("f-origin",r[i].origin),p.setAttribute("rel","stylesheet"),p.setAttribute("href",r[i].fPath),t.appendChild(p)}}}else r[i].loaded=!0,a-=1;r[i].helper=s(r[i],t),r[i].cache={},this.fonts.push(r[i])}0===a?this.isLoaded=!0:setTimeout(this.checkLoadedFonts.bind(this),100)}else this.isLoaded=!0},getCharData:function(t,i,r){for(var n=0,a=this.chars.length;n<a;){if(this.chars[n].ch===t&&this.chars[n].style===i&&this.chars[n].fFamily===r)return this.chars[n];n+=1}return("string"===typeof t&&13!==t.charCodeAt(0)||!t)&&console&&console.warn&&!this._warned&&(this._warned=!0,console.warn("Missing character from exported characters list: ",t,i,r)),e},getFontByName:function(e){for(var t=0,i=this.fonts.length;t<i;){if(this.fonts[t].fName===e)return this.fonts[t];t+=1}return this.fonts[0]},measureText:function(e,t,i){var r=this.getFontByName(t),n=e;if(!r.cache[n]){var a=r.helper;if(" "===e){var o=a.measureText("|"+e+"|"),s=a.measureText("||");r.cache[n]=(o-s)/100}else r.cache[n]=a.measureText(e)/100}return r.cache[n]*i},checkLoadedFonts:function(){var e,t,i,r=this.fonts.length,n=r;for(e=0;e<r;e+=1)this.fonts[e].loaded?n-=1:"n"===this.fonts[e].fOrigin||0===this.fonts[e].origin?this.fonts[e].loaded=!0:(t=this.fonts[e].monoCase.node,i=this.fonts[e].monoCase.w,t.offsetWidth!==i?(n-=1,this.fonts[e].loaded=!0):(t=this.fonts[e].sansCase.node,i=this.fonts[e].sansCase.w,t.offsetWidth!==i&&(n-=1,this.fonts[e].loaded=!0)),this.fonts[e].loaded&&(this.fonts[e].sansCase.parent.parentNode.removeChild(this.fonts[e].sansCase.parent),this.fonts[e].monoCase.parent.parentNode.removeChild(this.fonts[e].monoCase.parent)));0!==n&&Date.now()-this.initTime<5e3?setTimeout(this.checkLoadedFontsBinded,20):setTimeout(this.setIsLoadedBinded,10)},setIsLoaded:function(){this.isLoaded=!0}};return h.prototype=u,h}();function SlotManager(e){this.animationData=e}function slotFactory(e){return new SlotManager(e)}function RenderableElement(){}SlotManager.prototype.getProp=function(e){return this.animationData.slots&&this.animationData.slots[e.sid]?Object.assign(e,this.animationData.slots[e.sid].p):e},RenderableElement.prototype={initRenderable:function(){this.isInRange=!1,this.hidden=!1,this.isTransparent=!1,this.renderableComponents=[]},addRenderableComponent:function(e){-1===this.renderableComponents.indexOf(e)&&this.renderableComponents.push(e)},removeRenderableComponent:function(e){-1!==this.renderableComponents.indexOf(e)&&this.renderableComponents.splice(this.renderableComponents.indexOf(e),1)},prepareRenderableFrame:function(e){this.checkLayerLimits(e)},checkTransparency:function(){this.finalTransform.mProp.o.v<=0?!this.isTransparent&&this.globalData.renderConfig.hideOnTransparent&&(this.isTransparent=!0,this.hide()):this.isTransparent&&(this.isTransparent=!1,this.show())},checkLayerLimits:function(e){this.data.ip-this.data.st<=e&&this.data.op-this.data.st>e?!0!==this.isInRange&&(this.globalData._mdf=!0,this._mdf=!0,this.isInRange=!0,this.show()):!1!==this.isInRange&&(this.globalData._mdf=!0,this.isInRange=!1,this.hide())},renderRenderable:function(){var e,t=this.renderableComponents.length;for(e=0;e<t;e+=1)this.renderableComponents[e].renderFrame(this._isFirstFrame)},sourceRectAtTime:function(){return{top:0,left:0,width:100,height:100}},getLayerSize:function(){return 5===this.data.ty?{w:this.data.textData.width,h:this.data.textData.height}:{w:this.data.width,h:this.data.height}}};var getBlendMode=function(){var e={0:"source-over",1:"multiply",2:"screen",3:"overlay",4:"darken",5:"lighten",6:"color-dodge",7:"color-burn",8:"hard-light",9:"soft-light",10:"difference",11:"exclusion",12:"hue",13:"saturation",14:"color",15:"luminosity"};return function(t){return e[t]||""}}();function SliderEffect(e,t,i){this.p=PropertyFactory.getProp(t,e.v,0,0,i)}function AngleEffect(e,t,i){this.p=PropertyFactory.getProp(t,e.v,0,0,i)}function ColorEffect(e,t,i){this.p=PropertyFactory.getProp(t,e.v,1,0,i)}function PointEffect(e,t,i){this.p=PropertyFactory.getProp(t,e.v,1,0,i)}function LayerIndexEffect(e,t,i){this.p=PropertyFactory.getProp(t,e.v,0,0,i)}function MaskIndexEffect(e,t,i){this.p=PropertyFactory.getProp(t,e.v,0,0,i)}function CheckboxEffect(e,t,i){this.p=PropertyFactory.getProp(t,e.v,0,0,i)}function NoValueEffect(){this.p={}}function EffectsManager(e,t){var i,r=e.ef||[];this.effectElements=[];var n,a=r.length;for(i=0;i<a;i+=1)n=new GroupEffect(r[i],t),this.effectElements.push(n)}function GroupEffect(e,t){this.init(e,t)}function BaseElement(){}function FrameElement(){}function FootageElement(e,t,i){this.initFrame(),this.initRenderable(),this.assetData=t.getAssetData(e.refId),this.footageData=t.imageLoader.getAsset(this.assetData),this.initBaseData(e,t,i)}function AudioElement(e,t,i){this.initFrame(),this.initRenderable(),this.assetData=t.getAssetData(e.refId),this.initBaseData(e,t,i),this._isPlaying=!1,this._canPlay=!1;var r=this.globalData.getAssetsPath(this.assetData);this.audio=this.globalData.audioController.createAudio(r),this._currentTime=0,this.globalData.audioController.addAudio(this),this._volumeMultiplier=1,this._volume=1,this._previousVolume=null,this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,t.frameRate,this):{_placeholder:!0},this.lv=PropertyFactory.getProp(this,e.au&&e.au.lv?e.au.lv:{k:[100]},1,.01,this)}function BaseRenderer(){}extendPrototype([DynamicPropertyContainer],GroupEffect),GroupEffect.prototype.getValue=GroupEffect.prototype.iterateDynamicProperties,GroupEffect.prototype.init=function(e,t){var i;this.data=e,this.effectElements=[],this.initDynamicPropertyContainer(t);var r,n=this.data.ef.length,a=this.data.ef;for(i=0;i<n;i+=1){switch(r=null,a[i].ty){case 0:r=new SliderEffect(a[i],t,this);break;case 1:r=new AngleEffect(a[i],t,this);break;case 2:r=new ColorEffect(a[i],t,this);break;case 3:r=new PointEffect(a[i],t,this);break;case 4:case 7:r=new CheckboxEffect(a[i],t,this);break;case 10:r=new LayerIndexEffect(a[i],t,this);break;case 11:r=new MaskIndexEffect(a[i],t,this);break;case 5:r=new EffectsManager(a[i],t,this);break;default:r=new NoValueEffect(a[i],t,this)}r&&this.effectElements.push(r)}},BaseElement.prototype={checkMasks:function(){if(!this.data.hasMask)return!1;for(var e=0,t=this.data.masksProperties.length;e<t;){if("n"!==this.data.masksProperties[e].mode&&!1!==this.data.masksProperties[e].cl)return!0;e+=1}return!1},initExpressions:function(){var e=getExpressionInterfaces();if(e){var t=e("layer"),i=e("effects"),r=e("shape"),n=e("text"),a=e("comp");this.layerInterface=t(this),this.data.hasMask&&this.maskManager&&this.layerInterface.registerMaskInterface(this.maskManager);var o=i.createEffectsInterface(this,this.layerInterface);this.layerInterface.registerEffectsInterface(o),0===this.data.ty||this.data.xt?this.compInterface=a(this):4===this.data.ty?(this.layerInterface.shapeInterface=r(this.shapesData,this.itemsData,this.layerInterface),this.layerInterface.content=this.layerInterface.shapeInterface):5===this.data.ty&&(this.layerInterface.textInterface=n(this),this.layerInterface.text=this.layerInterface.textInterface)}},setBlendMode:function(){var e=getBlendMode(this.data.bm);(this.baseElement||this.layerElement).style["mix-blend-mode"]=e},initBaseData:function(e,t,i){this.globalData=t,this.comp=i,this.data=e,this.layerId=createElementID(),this.data.sr||(this.data.sr=1),this.effectsManager=new EffectsManager(this.data,this,this.dynamicProperties)},getType:function(){return this.type},sourceRectAtTime:function(){}},FrameElement.prototype={initFrame:function(){this._isFirstFrame=!1,this.dynamicProperties=[],this._mdf=!1},prepareProperties:function(e,t){var i,r=this.dynamicProperties.length;for(i=0;i<r;i+=1)(t||this._isParent&&"transform"===this.dynamicProperties[i].propType)&&(this.dynamicProperties[i].getValue(),this.dynamicProperties[i]._mdf&&(this.globalData._mdf=!0,this._mdf=!0))},addDynamicProperty:function(e){-1===this.dynamicProperties.indexOf(e)&&this.dynamicProperties.push(e)}},FootageElement.prototype.prepareFrame=function(){},extendPrototype([RenderableElement,BaseElement,FrameElement],FootageElement),FootageElement.prototype.getBaseElement=function(){return null},FootageElement.prototype.renderFrame=function(){},FootageElement.prototype.destroy=function(){},FootageElement.prototype.initExpressions=function(){var e=getExpressionInterfaces();if(e){var t=e("footage");this.layerInterface=t(this)}},FootageElement.prototype.getFootageData=function(){return this.footageData},AudioElement.prototype.prepareFrame=function(e){if(this.prepareRenderableFrame(e,!0),this.prepareProperties(e,!0),this.tm._placeholder)this._currentTime=e/this.data.sr;else{var t=this.tm.v;this._currentTime=t}this._volume=this.lv.v[0];var i=this._volume*this._volumeMultiplier;this._previousVolume!==i&&(this._previousVolume=i,this.audio.volume(i))},extendPrototype([RenderableElement,BaseElement,FrameElement],AudioElement),AudioElement.prototype.renderFrame=function(){this.isInRange&&this._canPlay&&(this._isPlaying?(!this.audio.playing()||Math.abs(this._currentTime/this.globalData.frameRate-this.audio.seek())>.1)&&this.audio.seek(this._currentTime/this.globalData.frameRate):(this.audio.play(),this.audio.seek(this._currentTime/this.globalData.frameRate),this._isPlaying=!0))},AudioElement.prototype.show=function(){},AudioElement.prototype.hide=function(){this.audio.pause(),this._isPlaying=!1},AudioElement.prototype.pause=function(){this.audio.pause(),this._isPlaying=!1,this._canPlay=!1},AudioElement.prototype.resume=function(){this._canPlay=!0},AudioElement.prototype.setRate=function(e){this.audio.rate(e)},AudioElement.prototype.volume=function(e){this._volumeMultiplier=e,this._previousVolume=e*this._volume,this.audio.volume(this._previousVolume)},AudioElement.prototype.getBaseElement=function(){return null},AudioElement.prototype.destroy=function(){},AudioElement.prototype.sourceRectAtTime=function(){},AudioElement.prototype.initExpressions=function(){},BaseRenderer.prototype.checkLayers=function(e){var t,i,r=this.layers.length;for(this.completeLayers=!0,t=r-1;t>=0;t-=1)this.elements[t]||(i=this.layers[t]).ip-i.st<=e-this.layers[t].st&&i.op-i.st>e-this.layers[t].st&&this.buildItem(t),this.completeLayers=!!this.elements[t]&&this.completeLayers;this.checkPendingElements()},BaseRenderer.prototype.createItem=function(e){switch(e.ty){case 2:return this.createImage(e);case 0:return this.createComp(e);case 1:return this.createSolid(e);case 3:default:return this.createNull(e);case 4:return this.createShape(e);case 5:return this.createText(e);case 6:return this.createAudio(e);case 13:return this.createCamera(e);case 15:return this.createFootage(e)}},BaseRenderer.prototype.createCamera=function(){throw new Error("You're using a 3d camera. Try the html renderer.")},BaseRenderer.prototype.createAudio=function(e){return new AudioElement(e,this.globalData,this)},BaseRenderer.prototype.createFootage=function(e){return new FootageElement(e,this.globalData,this)},BaseRenderer.prototype.buildAllItems=function(){var e,t=this.layers.length;for(e=0;e<t;e+=1)this.buildItem(e);this.checkPendingElements()},BaseRenderer.prototype.includeLayers=function(e){var t;this.completeLayers=!1;var i,r=e.length,n=this.layers.length;for(t=0;t<r;t+=1)for(i=0;i<n;){if(this.layers[i].id===e[t].id){this.layers[i]=e[t];break}i+=1}},BaseRenderer.prototype.setProjectInterface=function(e){this.globalData.projectInterface=e},BaseRenderer.prototype.initItems=function(){this.globalData.progressiveLoad||this.buildAllItems()},BaseRenderer.prototype.buildElementParenting=function(e,t,i){for(var r=this.elements,n=this.layers,a=0,o=n.length;a<o;)n[a].ind==t&&(r[a]&&!0!==r[a]?(i.push(r[a]),r[a].setAsParent(),void 0!==n[a].parent?this.buildElementParenting(e,n[a].parent,i):e.setHierarchy(i)):(this.buildItem(a),this.addPendingElement(e))),a+=1},BaseRenderer.prototype.addPendingElement=function(e){this.pendingElements.push(e)},BaseRenderer.prototype.searchExtraCompositions=function(e){var t,i=e.length;for(t=0;t<i;t+=1)if(e[t].xt){var r=this.createComp(e[t]);r.initExpressions(),this.globalData.projectInterface.registerComposition(r)}},BaseRenderer.prototype.getElementById=function(e){var t,i=this.elements.length;for(t=0;t<i;t+=1)if(this.elements[t].data.ind===e)return this.elements[t];return null},BaseRenderer.prototype.getElementByPath=function(e){var t,i=e.shift();if("number"===typeof i)t=this.elements[i];else{var r,n=this.elements.length;for(r=0;r<n;r+=1)if(this.elements[r].data.nm===i){t=this.elements[r];break}}return 0===e.length?t:t.getElementByPath(e)},BaseRenderer.prototype.setupGlobalData=function(e,t){this.globalData.fontManager=new FontManager,this.globalData.slotManager=slotFactory(e),this.globalData.fontManager.addChars(e.chars),this.globalData.fontManager.addFonts(e.fonts,t),this.globalData.getAssetData=this.animationItem.getAssetData.bind(this.animationItem),this.globalData.getAssetsPath=this.animationItem.getAssetsPath.bind(this.animationItem),this.globalData.imageLoader=this.animationItem.imagePreloader,this.globalData.audioController=this.animationItem.audioController,this.globalData.frameId=0,this.globalData.frameRate=e.fr,this.globalData.nm=e.nm,this.globalData.compSize={w:e.w,h:e.h}};var effectTypes={TRANSFORM_EFFECT:"transformEFfect"};function TransformElement(){}function MaskElement(e,t,i){this.data=e,this.element=t,this.globalData=i,this.storedData=[],this.masksProperties=this.data.masksProperties||[],this.maskElement=null;var r,n,a=this.globalData.defs,o=this.masksProperties?this.masksProperties.length:0;this.viewData=createSizedArray(o),this.solidPath="";var s,l,c,h,u,d,p=this.masksProperties,f=0,m=[],g=createElementID(),_="clipPath",y="clip-path";for(r=0;r<o;r+=1)if(("a"!==p[r].mode&&"n"!==p[r].mode||p[r].inv||100!==p[r].o.k||p[r].o.x)&&(_="mask",y="mask"),"s"!==p[r].mode&&"i"!==p[r].mode||0!==f?c=null:((c=createNS("rect")).setAttribute("fill","#ffffff"),c.setAttribute("width",this.element.comp.data.w||0),c.setAttribute("height",this.element.comp.data.h||0),m.push(c)),n=createNS("path"),"n"===p[r].mode)this.viewData[r]={op:PropertyFactory.getProp(this.element,p[r].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,p[r],3),elem:n,lastPath:""},a.appendChild(n);else{var v;if(f+=1,n.setAttribute("fill","s"===p[r].mode?"#000000":"#ffffff"),n.setAttribute("clip-rule","nonzero"),0!==p[r].x.k?(_="mask",y="mask",d=PropertyFactory.getProp(this.element,p[r].x,0,null,this.element),v=createElementID(),(h=createNS("filter")).setAttribute("id",v),(u=createNS("feMorphology")).setAttribute("operator","erode"),u.setAttribute("in","SourceGraphic"),u.setAttribute("radius","0"),h.appendChild(u),a.appendChild(h),n.setAttribute("stroke","s"===p[r].mode?"#000000":"#ffffff")):(u=null,d=null),this.storedData[r]={elem:n,x:d,expan:u,lastPath:"",lastOperator:"",filterId:v,lastRadius:0},"i"===p[r].mode){l=m.length;var x=createNS("g");for(s=0;s<l;s+=1)x.appendChild(m[s]);var b=createNS("mask");b.setAttribute("mask-type","alpha"),b.setAttribute("id",g+"_"+f),b.appendChild(n),a.appendChild(b),x.setAttribute("mask","url("+getLocationHref()+"#"+g+"_"+f+")"),m.length=0,m.push(x)}else m.push(n);p[r].inv&&!this.solidPath&&(this.solidPath=this.createLayerSolidPath()),this.viewData[r]={elem:n,lastPath:"",op:PropertyFactory.getProp(this.element,p[r].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,p[r],3),invRect:c},this.viewData[r].prop.k||this.drawPath(p[r],this.viewData[r].prop.v,this.viewData[r])}for(this.maskElement=createNS(_),o=m.length,r=0;r<o;r+=1)this.maskElement.appendChild(m[r]);f>0&&(this.maskElement.setAttribute("id",g),this.element.maskedElement.setAttribute(y,"url("+getLocationHref()+"#"+g+")"),a.appendChild(this.maskElement)),this.viewData.length&&this.element.addRenderableComponent(this)}TransformElement.prototype={initTransform:function(){var e=new Matrix;this.finalTransform={mProp:this.data.ks?TransformPropertyFactory.getTransformProperty(this,this.data.ks,this):{o:0},_matMdf:!1,_localMatMdf:!1,_opMdf:!1,mat:e,localMat:e,localOpacity:1},this.data.ao&&(this.finalTransform.mProp.autoOriented=!0),this.data.ty},renderTransform:function(){if(this.finalTransform._opMdf=this.finalTransform.mProp.o._mdf||this._isFirstFrame,this.finalTransform._matMdf=this.finalTransform.mProp._mdf||this._isFirstFrame,this.hierarchy){var e,t=this.finalTransform.mat,i=0,r=this.hierarchy.length;if(!this.finalTransform._matMdf)for(;i<r;){if(this.hierarchy[i].finalTransform.mProp._mdf){this.finalTransform._matMdf=!0;break}i+=1}if(this.finalTransform._matMdf)for(e=this.finalTransform.mProp.v.props,t.cloneFromProps(e),i=0;i<r;i+=1)t.multiply(this.hierarchy[i].finalTransform.mProp.v)}this.finalTransform._matMdf&&(this.finalTransform._localMatMdf=this.finalTransform._matMdf),this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v)},renderLocalTransform:function(){if(this.localTransforms){var e=0,t=this.localTransforms.length;if(this.finalTransform._localMatMdf=this.finalTransform._matMdf,!this.finalTransform._localMatMdf||!this.finalTransform._opMdf)for(;e<t;)this.localTransforms[e]._mdf&&(this.finalTransform._localMatMdf=!0),this.localTransforms[e]._opMdf&&!this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v,this.finalTransform._opMdf=!0),e+=1;if(this.finalTransform._localMatMdf){var i=this.finalTransform.localMat;for(this.localTransforms[0].matrix.clone(i),e=1;e<t;e+=1){var r=this.localTransforms[e].matrix;i.multiply(r)}i.multiply(this.finalTransform.mat)}if(this.finalTransform._opMdf){var n=this.finalTransform.localOpacity;for(e=0;e<t;e+=1)n*=.01*this.localTransforms[e].opacity;this.finalTransform.localOpacity=n}}},searchEffectTransforms:function(){if(this.renderableEffectsManager){var e=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT);if(e.length){this.localTransforms=[],this.finalTransform.localMat=new Matrix;var t=0,i=e.length;for(t=0;t<i;t+=1)this.localTransforms.push(e[t])}}},globalToLocal:function(e){var t=[];t.push(this.finalTransform);for(var i,r=!0,n=this.comp;r;)n.finalTransform?(n.data.hasMask&&t.splice(0,0,n.finalTransform),n=n.comp):r=!1;var a,o=t.length;for(i=0;i<o;i+=1)a=t[i].mat.applyToPointArray(0,0,0),e=[e[0]-a[0],e[1]-a[1],0];return e},mHelper:new Matrix},MaskElement.prototype.getMaskProperty=function(e){return this.viewData[e].prop},MaskElement.prototype.renderFrame=function(e){var t,i=this.element.finalTransform.mat,r=this.masksProperties.length;for(t=0;t<r;t+=1)if((this.viewData[t].prop._mdf||e)&&this.drawPath(this.masksProperties[t],this.viewData[t].prop.v,this.viewData[t]),(this.viewData[t].op._mdf||e)&&this.viewData[t].elem.setAttribute("fill-opacity",this.viewData[t].op.v),"n"!==this.masksProperties[t].mode&&(this.viewData[t].invRect&&(this.element.finalTransform.mProp._mdf||e)&&this.viewData[t].invRect.setAttribute("transform",i.getInverseMatrix().to2dCSS()),this.storedData[t].x&&(this.storedData[t].x._mdf||e))){var n=this.storedData[t].expan;this.storedData[t].x.v<0?("erode"!==this.storedData[t].lastOperator&&(this.storedData[t].lastOperator="erode",this.storedData[t].elem.setAttribute("filter","url("+getLocationHref()+"#"+this.storedData[t].filterId+")")),n.setAttribute("radius",-this.storedData[t].x.v)):("dilate"!==this.storedData[t].lastOperator&&(this.storedData[t].lastOperator="dilate",this.storedData[t].elem.setAttribute("filter",null)),this.storedData[t].elem.setAttribute("stroke-width",2*this.storedData[t].x.v))}},MaskElement.prototype.getMaskelement=function(){return this.maskElement},MaskElement.prototype.createLayerSolidPath=function(){var e="M0,0 ";return e+=" h"+this.globalData.compSize.w,e+=" v"+this.globalData.compSize.h,e+=" h-"+this.globalData.compSize.w,e+=" v-"+this.globalData.compSize.h+" "},MaskElement.prototype.drawPath=function(e,t,i){var r,n,a=" M"+t.v[0][0]+","+t.v[0][1];for(n=t._length,r=1;r<n;r+=1)a+=" C"+t.o[r-1][0]+","+t.o[r-1][1]+" "+t.i[r][0]+","+t.i[r][1]+" "+t.v[r][0]+","+t.v[r][1];if(t.c&&n>1&&(a+=" C"+t.o[r-1][0]+","+t.o[r-1][1]+" "+t.i[0][0]+","+t.i[0][1]+" "+t.v[0][0]+","+t.v[0][1]),i.lastPath!==a){var o="";i.elem&&(t.c&&(o=e.inv?this.solidPath+a:a),i.elem.setAttribute("d",o)),i.lastPath=a}},MaskElement.prototype.destroy=function(){this.element=null,this.globalData=null,this.maskElement=null,this.data=null,this.masksProperties=null};var filtersFactory=function(){var e={createFilter:function(e,t){var i=createNS("filter");return i.setAttribute("id",e),!0!==t&&(i.setAttribute("filterUnits","objectBoundingBox"),i.setAttribute("x","0%"),i.setAttribute("y","0%"),i.setAttribute("width","100%"),i.setAttribute("height","100%")),i},createAlphaToLuminanceFilter:function(){var e=createNS("feColorMatrix");return e.setAttribute("type","matrix"),e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("values","0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 1"),e}};return e}(),featureSupport=function(){var e={maskType:!0,svgLumaHidden:!0,offscreenCanvas:"undefined"!==typeof OffscreenCanvas};return(/MSIE 10/i.test(navigator.userAgent)||/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent)||/Edge\/\d./i.test(navigator.userAgent))&&(e.maskType=!1),/firefox/i.test(navigator.userAgent)&&(e.svgLumaHidden=!1),e}(),registeredEffects$1={},idPrefix="filter_result_";function SVGEffects(e){var t,i,r="SourceGraphic",n=e.data.ef?e.data.ef.length:0,a=createElementID(),o=filtersFactory.createFilter(a,!0),s=0;for(this.filters=[],t=0;t<n;t+=1){i=null;var l=e.data.ef[t].ty;registeredEffects$1[l]&&(i=new(0,registeredEffects$1[l].effect)(o,e.effectsManager.effectElements[t],e,idPrefix+s,r),r=idPrefix+s,registeredEffects$1[l].countsAsEffect&&(s+=1)),i&&this.filters.push(i)}s&&(e.globalData.defs.appendChild(o),e.layerElement.setAttribute("filter","url("+getLocationHref()+"#"+a+")")),this.filters.length&&e.addRenderableComponent(this)}function registerEffect$1(e,t,i){registeredEffects$1[e]={effect:t,countsAsEffect:i}}function SVGBaseElement(){}function HierarchyElement(){}function RenderableDOMElement(){}function IImageElement(e,t,i){this.assetData=t.getAssetData(e.refId),this.assetData&&this.assetData.sid&&(this.assetData=t.slotManager.getProp(this.assetData)),this.initElement(e,t,i),this.sourceRect={top:0,left:0,width:this.assetData.w,height:this.assetData.h}}function ProcessedElement(e,t){this.elem=e,this.pos=t}function IShapeElement(){}SVGEffects.prototype.renderFrame=function(e){var t,i=this.filters.length;for(t=0;t<i;t+=1)this.filters[t].renderFrame(e)},SVGEffects.prototype.getEffects=function(e){var t,i=this.filters.length,r=[];for(t=0;t<i;t+=1)this.filters[t].type===e&&r.push(this.filters[t]);return r},SVGBaseElement.prototype={initRendererElement:function(){this.layerElement=createNS("g")},createContainerElements:function(){this.matteElement=createNS("g"),this.transformedElement=this.layerElement,this.maskedElement=this.layerElement,this._sizeChanged=!1;var e=null;if(this.data.td){this.matteMasks={};var t=createNS("g");t.setAttribute("id",this.layerId),t.appendChild(this.layerElement),e=t,this.globalData.defs.appendChild(t)}else this.data.tt?(this.matteElement.appendChild(this.layerElement),e=this.matteElement,this.baseElement=this.matteElement):this.baseElement=this.layerElement;if(this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),0===this.data.ty&&!this.data.hd){var i=createNS("clipPath"),r=createNS("path");r.setAttribute("d","M0,0 L"+this.data.w+",0 L"+this.data.w+","+this.data.h+" L0,"+this.data.h+"z");var n=createElementID();if(i.setAttribute("id",n),i.appendChild(r),this.globalData.defs.appendChild(i),this.checkMasks()){var a=createNS("g");a.setAttribute("clip-path","url("+getLocationHref()+"#"+n+")"),a.appendChild(this.layerElement),this.transformedElement=a,e?e.appendChild(this.transformedElement):this.baseElement=this.transformedElement}else this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+n+")")}0!==this.data.bm&&this.setBlendMode()},renderElement:function(){this.finalTransform._localMatMdf&&this.transformedElement.setAttribute("transform",this.finalTransform.localMat.to2dCSS()),this.finalTransform._opMdf&&this.transformedElement.setAttribute("opacity",this.finalTransform.localOpacity)},destroyBaseElement:function(){this.layerElement=null,this.matteElement=null,this.maskManager.destroy()},getBaseElement:function(){return this.data.hd?null:this.baseElement},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData),this.renderableEffectsManager=new SVGEffects(this),this.searchEffectTransforms()},getMatte:function(e){if(this.matteMasks||(this.matteMasks={}),!this.matteMasks[e]){var t,i,r,n,a=this.layerId+"_"+e;if(1===e||3===e){var o=createNS("mask");o.setAttribute("id",a),o.setAttribute("mask-type",3===e?"luminance":"alpha"),(r=createNS("use")).setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),o.appendChild(r),this.globalData.defs.appendChild(o),featureSupport.maskType||1!==e||(o.setAttribute("mask-type","luminance"),t=createElementID(),i=filtersFactory.createFilter(t),this.globalData.defs.appendChild(i),i.appendChild(filtersFactory.createAlphaToLuminanceFilter()),(n=createNS("g")).appendChild(r),o.appendChild(n),n.setAttribute("filter","url("+getLocationHref()+"#"+t+")"))}else if(2===e){var s=createNS("mask");s.setAttribute("id",a),s.setAttribute("mask-type","alpha");var l=createNS("g");s.appendChild(l),t=createElementID(),i=filtersFactory.createFilter(t);var c=createNS("feComponentTransfer");c.setAttribute("in","SourceGraphic"),i.appendChild(c);var h=createNS("feFuncA");h.setAttribute("type","table"),h.setAttribute("tableValues","1.0 0.0"),c.appendChild(h),this.globalData.defs.appendChild(i);var u=createNS("rect");u.setAttribute("width",this.comp.data.w),u.setAttribute("height",this.comp.data.h),u.setAttribute("x","0"),u.setAttribute("y","0"),u.setAttribute("fill","#ffffff"),u.setAttribute("opacity","0"),l.setAttribute("filter","url("+getLocationHref()+"#"+t+")"),l.appendChild(u),(r=createNS("use")).setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),l.appendChild(r),featureSupport.maskType||(s.setAttribute("mask-type","luminance"),i.appendChild(filtersFactory.createAlphaToLuminanceFilter()),n=createNS("g"),l.appendChild(u),n.appendChild(this.layerElement),l.appendChild(n)),this.globalData.defs.appendChild(s)}this.matteMasks[e]=a}return this.matteMasks[e]},setMatte:function(e){this.matteElement&&this.matteElement.setAttribute("mask","url("+getLocationHref()+"#"+e+")")}},HierarchyElement.prototype={initHierarchy:function(){this.hierarchy=[],this._isParent=!1,this.checkParenting()},setHierarchy:function(e){this.hierarchy=e},setAsParent:function(){this._isParent=!0},checkParenting:function(){void 0!==this.data.parent&&this.comp.buildElementParenting(this,this.data.parent,[])}},extendPrototype([RenderableElement,createProxyFunction({initElement:function(e,t,i){this.initFrame(),this.initBaseData(e,t,i),this.initTransform(e,t,i),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide()},hide:function(){this.hidden||this.isInRange&&!this.isTransparent||((this.baseElement||this.layerElement).style.display="none",this.hidden=!0)},show:function(){this.isInRange&&!this.isTransparent&&(this.data.hd||((this.baseElement||this.layerElement).style.display="block"),this.hidden=!1,this._isFirstFrame=!0)},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},renderInnerContent:function(){},prepareFrame:function(e){this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange),this.checkTransparency()},destroy:function(){this.innerElem=null,this.destroyBaseElement()}})],RenderableDOMElement),extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],IImageElement),IImageElement.prototype.createContent=function(){var e=this.globalData.getAssetsPath(this.assetData);this.innerElem=createNS("image"),this.innerElem.setAttribute("width",this.assetData.w+"px"),this.innerElem.setAttribute("height",this.assetData.h+"px"),this.innerElem.setAttribute("preserveAspectRatio",this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio),this.innerElem.setAttributeNS("http://www.w3.org/1999/xlink","href",e),this.layerElement.appendChild(this.innerElem)},IImageElement.prototype.sourceRectAtTime=function(){return this.sourceRect},IShapeElement.prototype={addShapeToModifiers:function(e){var t,i=this.shapeModifiers.length;for(t=0;t<i;t+=1)this.shapeModifiers[t].addShape(e)},isShapeInAnimatedModifiers:function(e){for(var t=this.shapeModifiers.length;0<t;)if(this.shapeModifiers[0].isAnimatedWithShape(e))return!0;return!1},renderModifiers:function(){if(this.shapeModifiers.length){var e,t=this.shapes.length;for(e=0;e<t;e+=1)this.shapes[e].sh.reset();for(e=(t=this.shapeModifiers.length)-1;e>=0&&!this.shapeModifiers[e].processShapes(this._isFirstFrame);e-=1);}},searchProcessedElement:function(e){for(var t=this.processedElements,i=0,r=t.length;i<r;){if(t[i].elem===e)return t[i].pos;i+=1}return 0},addProcessedElement:function(e,t){for(var i=this.processedElements,r=i.length;r;)if(i[r-=1].elem===e)return void(i[r].pos=t);i.push(new ProcessedElement(e,t))},prepareFrame:function(e){this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange)}};var lineCapEnum={1:"butt",2:"round",3:"square"},lineJoinEnum={1:"miter",2:"round",3:"bevel"};function SVGShapeData(e,t,i){this.caches=[],this.styles=[],this.transformers=e,this.lStr="",this.sh=i,this.lvl=t,this._isAnimated=!!i.k;for(var r=0,n=e.length;r<n;){if(e[r].mProps.dynamicProperties.length){this._isAnimated=!0;break}r+=1}}function SVGStyleData(e,t){this.data=e,this.type=e.ty,this.d="",this.lvl=t,this._mdf=!1,this.closed=!0===e.hd,this.pElem=createNS("path"),this.msElem=null}function DashProperty(e,t,i,r){var n;this.elem=e,this.frameId=-1,this.dataProps=createSizedArray(t.length),this.renderer=i,this.k=!1,this.dashStr="",this.dashArray=createTypedArray("float32",t.length?t.length-1:0),this.dashoffset=createTypedArray("float32",1),this.initDynamicPropertyContainer(r);var a,o=t.length||0;for(n=0;n<o;n+=1)a=PropertyFactory.getProp(e,t[n].v,0,0,this),this.k=a.k||this.k,this.dataProps[n]={n:t[n].n,p:a};this.k||this.getValue(!0),this._isAnimated=this.k}function SVGStrokeStyleData(e,t,i){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(e,t.o,0,.01,this),this.w=PropertyFactory.getProp(e,t.w,0,null,this),this.d=new DashProperty(e,t.d||{},"svg",this),this.c=PropertyFactory.getProp(e,t.c,1,255,this),this.style=i,this._isAnimated=!!this._isAnimated}function SVGFillStyleData(e,t,i){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(e,t.o,0,.01,this),this.c=PropertyFactory.getProp(e,t.c,1,255,this),this.style=i}function SVGNoStyleData(e,t,i){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.style=i}function GradientProperty(e,t,i){this.data=t,this.c=createTypedArray("uint8c",4*t.p);var r=t.k.k[0].s?t.k.k[0].s.length-4*t.p:t.k.k.length-4*t.p;this.o=createTypedArray("float32",r),this._cmdf=!1,this._omdf=!1,this._collapsable=this.checkCollapsable(),this._hasOpacity=r,this.initDynamicPropertyContainer(i),this.prop=PropertyFactory.getProp(e,t.k,1,null,this),this.k=this.prop.k,this.getValue(!0)}function SVGGradientFillStyleData(e,t,i){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.initGradientData(e,t,i)}function SVGGradientStrokeStyleData(e,t,i){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.w=PropertyFactory.getProp(e,t.w,0,null,this),this.d=new DashProperty(e,t.d||{},"svg",this),this.initGradientData(e,t,i),this._isAnimated=!!this._isAnimated}function ShapeGroupData(){this.it=[],this.prevViewData=[],this.gr=createNS("g")}function SVGTransformData(e,t,i){this.transform={mProps:e,op:t,container:i},this.elements=[],this._isAnimated=this.transform.mProps.dynamicProperties.length||this.transform.op.effectsSequence.length}SVGShapeData.prototype.setAsAnimated=function(){this._isAnimated=!0},SVGStyleData.prototype.reset=function(){this.d="",this._mdf=!1},DashProperty.prototype.getValue=function(e){if((this.elem.globalData.frameId!==this.frameId||e)&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf=this._mdf||e,this._mdf)){var t=0,i=this.dataProps.length;for("svg"===this.renderer&&(this.dashStr=""),t=0;t<i;t+=1)"o"!==this.dataProps[t].n?"svg"===this.renderer?this.dashStr+=" "+this.dataProps[t].p.v:this.dashArray[t]=this.dataProps[t].p.v:this.dashoffset[0]=this.dataProps[t].p.v}},extendPrototype([DynamicPropertyContainer],DashProperty),extendPrototype([DynamicPropertyContainer],SVGStrokeStyleData),extendPrototype([DynamicPropertyContainer],SVGFillStyleData),extendPrototype([DynamicPropertyContainer],SVGNoStyleData),GradientProperty.prototype.comparePoints=function(e,t){for(var i=0,r=this.o.length/2;i<r;){if(Math.abs(e[4*i]-e[4*t+2*i])>.01)return!1;i+=1}return!0},GradientProperty.prototype.checkCollapsable=function(){if(this.o.length/2!==this.c.length/4)return!1;if(this.data.k.k[0].s)for(var e=0,t=this.data.k.k.length;e<t;){if(!this.comparePoints(this.data.k.k[e].s,this.data.p))return!1;e+=1}else if(!this.comparePoints(this.data.k.k,this.data.p))return!1;return!0},GradientProperty.prototype.getValue=function(e){if(this.prop.getValue(),this._mdf=!1,this._cmdf=!1,this._omdf=!1,this.prop._mdf||e){var t,i,r,n=4*this.data.p;for(t=0;t<n;t+=1)i=t%4===0?100:255,r=Math.round(this.prop.v[t]*i),this.c[t]!==r&&(this.c[t]=r,this._cmdf=!e);if(this.o.length)for(n=this.prop.v.length,t=4*this.data.p;t<n;t+=1)i=t%2===0?100:1,r=t%2===0?Math.round(100*this.prop.v[t]):this.prop.v[t],this.o[t-4*this.data.p]!==r&&(this.o[t-4*this.data.p]=r,this._omdf=!e);this._mdf=!e}},extendPrototype([DynamicPropertyContainer],GradientProperty),SVGGradientFillStyleData.prototype.initGradientData=function(e,t,i){this.o=PropertyFactory.getProp(e,t.o,0,.01,this),this.s=PropertyFactory.getProp(e,t.s,1,null,this),this.e=PropertyFactory.getProp(e,t.e,1,null,this),this.h=PropertyFactory.getProp(e,t.h||{k:0},0,.01,this),this.a=PropertyFactory.getProp(e,t.a||{k:0},0,degToRads,this),this.g=new GradientProperty(e,t.g,this),this.style=i,this.stops=[],this.setGradientData(i.pElem,t),this.setGradientOpacity(t,i),this._isAnimated=!!this._isAnimated},SVGGradientFillStyleData.prototype.setGradientData=function(e,t){var i=createElementID(),r=createNS(1===t.t?"linearGradient":"radialGradient");r.setAttribute("id",i),r.setAttribute("spreadMethod","pad"),r.setAttribute("gradientUnits","userSpaceOnUse");var n,a,o,s=[];for(o=4*t.g.p,a=0;a<o;a+=4)n=createNS("stop"),r.appendChild(n),s.push(n);e.setAttribute("gf"===t.ty?"fill":"stroke","url("+getLocationHref()+"#"+i+")"),this.gf=r,this.cst=s},SVGGradientFillStyleData.prototype.setGradientOpacity=function(e,t){if(this.g._hasOpacity&&!this.g._collapsable){var i,r,n,a=createNS("mask"),o=createNS("path");a.appendChild(o);var s=createElementID(),l=createElementID();a.setAttribute("id",l);var c=createNS(1===e.t?"linearGradient":"radialGradient");c.setAttribute("id",s),c.setAttribute("spreadMethod","pad"),c.setAttribute("gradientUnits","userSpaceOnUse"),n=e.g.k.k[0].s?e.g.k.k[0].s.length:e.g.k.k.length;var h=this.stops;for(r=4*e.g.p;r<n;r+=2)(i=createNS("stop")).setAttribute("stop-color","rgb(255,255,255)"),c.appendChild(i),h.push(i);o.setAttribute("gf"===e.ty?"fill":"stroke","url("+getLocationHref()+"#"+s+")"),"gs"===e.ty&&(o.setAttribute("stroke-linecap",lineCapEnum[e.lc||2]),o.setAttribute("stroke-linejoin",lineJoinEnum[e.lj||2]),1===e.lj&&o.setAttribute("stroke-miterlimit",e.ml)),this.of=c,this.ms=a,this.ost=h,this.maskId=l,t.msElem=o}},extendPrototype([DynamicPropertyContainer],SVGGradientFillStyleData),extendPrototype([SVGGradientFillStyleData,DynamicPropertyContainer],SVGGradientStrokeStyleData);var buildShapeString=function(e,t,i,r){if(0===t)return"";var n,a=e.o,o=e.i,s=e.v,l=" M"+r.applyToPointStringified(s[0][0],s[0][1]);for(n=1;n<t;n+=1)l+=" C"+r.applyToPointStringified(a[n-1][0],a[n-1][1])+" "+r.applyToPointStringified(o[n][0],o[n][1])+" "+r.applyToPointStringified(s[n][0],s[n][1]);return i&&t&&(l+=" C"+r.applyToPointStringified(a[n-1][0],a[n-1][1])+" "+r.applyToPointStringified(o[0][0],o[0][1])+" "+r.applyToPointStringified(s[0][0],s[0][1]),l+="z"),l},SVGElementsRenderer=function(){var e=new Matrix,t=new Matrix;function i(e,t,i){(i||t.transform.op._mdf)&&t.transform.container.setAttribute("opacity",t.transform.op.v),(i||t.transform.mProps._mdf)&&t.transform.container.setAttribute("transform",t.transform.mProps.v.to2dCSS())}function r(){}function n(i,r,n){var a,o,s,l,c,h,u,d,p,f,m=r.styles.length,g=r.lvl;for(h=0;h<m;h+=1){if(l=r.sh._mdf||n,r.styles[h].lvl<g){for(d=t.reset(),p=g-r.styles[h].lvl,f=r.transformers.length-1;!l&&p>0;)l=r.transformers[f].mProps._mdf||l,p-=1,f-=1;if(l)for(p=g-r.styles[h].lvl,f=r.transformers.length-1;p>0;)d.multiply(r.transformers[f].mProps.v),p-=1,f-=1}else d=e;if(o=(u=r.sh.paths)._length,l){for(s="",a=0;a<o;a+=1)(c=u.shapes[a])&&c._length&&(s+=buildShapeString(c,c._length,c.c,d));r.caches[h]=s}else s=r.caches[h];r.styles[h].d+=!0===i.hd?"":s,r.styles[h]._mdf=l||r.styles[h]._mdf}}function a(e,t,i){var r=t.style;(t.c._mdf||i)&&r.pElem.setAttribute("fill","rgb("+bmFloor(t.c.v[0])+","+bmFloor(t.c.v[1])+","+bmFloor(t.c.v[2])+")"),(t.o._mdf||i)&&r.pElem.setAttribute("fill-opacity",t.o.v)}function o(e,t,i){s(e,t,i),l(0,t,i)}function s(e,t,i){var r,n,a,o,s,l=t.gf,c=t.g._hasOpacity,h=t.s.v,u=t.e.v;if(t.o._mdf||i){var d="gf"===e.ty?"fill-opacity":"stroke-opacity";t.style.pElem.setAttribute(d,t.o.v)}if(t.s._mdf||i){var p=1===e.t?"x1":"cx",f="x1"===p?"y1":"cy";l.setAttribute(p,h[0]),l.setAttribute(f,h[1]),c&&!t.g._collapsable&&(t.of.setAttribute(p,h[0]),t.of.setAttribute(f,h[1]))}if(t.g._cmdf||i){r=t.cst;var m=t.g.c;for(a=r.length,n=0;n<a;n+=1)(o=r[n]).setAttribute("offset",m[4*n]+"%"),o.setAttribute("stop-color","rgb("+m[4*n+1]+","+m[4*n+2]+","+m[4*n+3]+")")}if(c&&(t.g._omdf||i)){var g=t.g.o;for(a=(r=t.g._collapsable?t.cst:t.ost).length,n=0;n<a;n+=1)o=r[n],t.g._collapsable||o.setAttribute("offset",g[2*n]+"%"),o.setAttribute("stop-opacity",g[2*n+1])}if(1===e.t)(t.e._mdf||i)&&(l.setAttribute("x2",u[0]),l.setAttribute("y2",u[1]),c&&!t.g._collapsable&&(t.of.setAttribute("x2",u[0]),t.of.setAttribute("y2",u[1])));else if((t.s._mdf||t.e._mdf||i)&&(s=Math.sqrt(Math.pow(h[0]-u[0],2)+Math.pow(h[1]-u[1],2)),l.setAttribute("r",s),c&&!t.g._collapsable&&t.of.setAttribute("r",s)),t.e._mdf||t.h._mdf||t.a._mdf||i){s||(s=Math.sqrt(Math.pow(h[0]-u[0],2)+Math.pow(h[1]-u[1],2)));var _=Math.atan2(u[1]-h[1],u[0]-h[0]),y=t.h.v;y>=1?y=.99:y<=-1&&(y=-.99);var v=s*y,x=Math.cos(_+t.a.v)*v+h[0],b=Math.sin(_+t.a.v)*v+h[1];l.setAttribute("fx",x),l.setAttribute("fy",b),c&&!t.g._collapsable&&(t.of.setAttribute("fx",x),t.of.setAttribute("fy",b))}}function l(e,t,i){var r=t.style,n=t.d;n&&(n._mdf||i)&&n.dashStr&&(r.pElem.setAttribute("stroke-dasharray",n.dashStr),r.pElem.setAttribute("stroke-dashoffset",n.dashoffset[0])),t.c&&(t.c._mdf||i)&&r.pElem.setAttribute("stroke","rgb("+bmFloor(t.c.v[0])+","+bmFloor(t.c.v[1])+","+bmFloor(t.c.v[2])+")"),(t.o._mdf||i)&&r.pElem.setAttribute("stroke-opacity",t.o.v),(t.w._mdf||i)&&(r.pElem.setAttribute("stroke-width",t.w.v),r.msElem&&r.msElem.setAttribute("stroke-width",t.w.v))}return{createRenderFunction:function(e){switch(e.ty){case"fl":return a;case"gf":return s;case"gs":return o;case"st":return l;case"sh":case"el":case"rc":case"sr":return n;case"tr":return i;case"no":return r;default:return null}}}}();function SVGShapeElement(e,t,i){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.initElement(e,t,i),this.prevViewData=[]}function LetterProps(e,t,i,r,n,a){this.o=e,this.sw=t,this.sc=i,this.fc=r,this.m=n,this.p=a,this._mdf={o:!0,sw:!!t,sc:!!i,fc:!!r,m:!0,p:!0}}function TextProperty(e,t){this._frameId=initialDefaultFrame,this.pv="",this.v="",this.kf=!1,this._isFirstFrame=!0,this._mdf=!1,t.d&&t.d.sid&&(t.d=e.globalData.slotManager.getProp(t.d)),this.data=t,this.elem=e,this.comp=this.elem.comp,this.keysIndex=0,this.canResize=!1,this.minimumFontSize=1,this.effectsSequence=[],this.currentData={ascent:0,boxWidth:this.defaultBoxWidth,f:"",fStyle:"",fWeight:"",fc:"",j:"",justifyOffset:"",l:[],lh:0,lineWidths:[],ls:"",of:"",s:"",sc:"",sw:0,t:0,tr:0,sz:0,ps:null,fillColorAnim:!1,strokeColorAnim:!1,strokeWidthAnim:!1,yOffset:0,finalSize:0,finalText:[],finalLineHeight:0,__complete:!1},this.copyData(this.currentData,this.data.d.k[0].s),this.searchProperty()||this.completeTextData(this.currentData)}extendPrototype([BaseElement,TransformElement,SVGBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableDOMElement],SVGShapeElement),SVGShapeElement.prototype.initSecondaryElement=function(){},SVGShapeElement.prototype.identityMatrix=new Matrix,SVGShapeElement.prototype.buildExpressionInterface=function(){},SVGShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes()},SVGShapeElement.prototype.filterUniqueShapes=function(){var e,t,i,r,n=this.shapes.length,a=this.stylesList.length,o=[],s=!1;for(i=0;i<a;i+=1){for(r=this.stylesList[i],s=!1,o.length=0,e=0;e<n;e+=1)-1!==(t=this.shapes[e]).styles.indexOf(r)&&(o.push(t),s=t._isAnimated||s);o.length>1&&s&&this.setShapesAsAnimated(o)}},SVGShapeElement.prototype.setShapesAsAnimated=function(e){var t,i=e.length;for(t=0;t<i;t+=1)e[t].setAsAnimated()},SVGShapeElement.prototype.createStyleElement=function(e,t){var i,r=new SVGStyleData(e,t),n=r.pElem;return"st"===e.ty?i=new SVGStrokeStyleData(this,e,r):"fl"===e.ty?i=new SVGFillStyleData(this,e,r):"gf"===e.ty||"gs"===e.ty?(i=new("gf"===e.ty?SVGGradientFillStyleData:SVGGradientStrokeStyleData)(this,e,r),this.globalData.defs.appendChild(i.gf),i.maskId&&(this.globalData.defs.appendChild(i.ms),this.globalData.defs.appendChild(i.of),n.setAttribute("mask","url("+getLocationHref()+"#"+i.maskId+")"))):"no"===e.ty&&(i=new SVGNoStyleData(this,e,r)),"st"!==e.ty&&"gs"!==e.ty||(n.setAttribute("stroke-linecap",lineCapEnum[e.lc||2]),n.setAttribute("stroke-linejoin",lineJoinEnum[e.lj||2]),n.setAttribute("fill-opacity","0"),1===e.lj&&n.setAttribute("stroke-miterlimit",e.ml)),2===e.r&&n.setAttribute("fill-rule","evenodd"),e.ln&&n.setAttribute("id",e.ln),e.cl&&n.setAttribute("class",e.cl),e.bm&&(n.style["mix-blend-mode"]=getBlendMode(e.bm)),this.stylesList.push(r),this.addToAnimatedContents(e,i),i},SVGShapeElement.prototype.createGroupElement=function(e){var t=new ShapeGroupData;return e.ln&&t.gr.setAttribute("id",e.ln),e.cl&&t.gr.setAttribute("class",e.cl),e.bm&&(t.gr.style["mix-blend-mode"]=getBlendMode(e.bm)),t},SVGShapeElement.prototype.createTransformElement=function(e,t){var i=TransformPropertyFactory.getTransformProperty(this,e,this),r=new SVGTransformData(i,i.o,t);return this.addToAnimatedContents(e,r),r},SVGShapeElement.prototype.createShapeElement=function(e,t,i){var r=4;"rc"===e.ty?r=5:"el"===e.ty?r=6:"sr"===e.ty&&(r=7);var n=new SVGShapeData(t,i,ShapePropertyFactory.getShapeProp(this,e,r,this));return this.shapes.push(n),this.addShapeToModifiers(n),this.addToAnimatedContents(e,n),n},SVGShapeElement.prototype.addToAnimatedContents=function(e,t){for(var i=0,r=this.animatedContents.length;i<r;){if(this.animatedContents[i].element===t)return;i+=1}this.animatedContents.push({fn:SVGElementsRenderer.createRenderFunction(e),element:t,data:e})},SVGShapeElement.prototype.setElementStyles=function(e){var t,i=e.styles,r=this.stylesList.length;for(t=0;t<r;t+=1)this.stylesList[t].closed||i.push(this.stylesList[t])},SVGShapeElement.prototype.reloadShapes=function(){var e;this._isFirstFrame=!0;var t=this.itemsData.length;for(e=0;e<t;e+=1)this.prevViewData[e]=this.itemsData[e];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes(),t=this.dynamicProperties.length,e=0;e<t;e+=1)this.dynamicProperties[e].getValue();this.renderModifiers()},SVGShapeElement.prototype.searchShapes=function(e,t,i,r,n,a,o){var s,l,c,h,u,d,p=[].concat(a),f=e.length-1,m=[],g=[];for(s=f;s>=0;s-=1){if((d=this.searchProcessedElement(e[s]))?t[s]=i[d-1]:e[s]._render=o,"fl"===e[s].ty||"st"===e[s].ty||"gf"===e[s].ty||"gs"===e[s].ty||"no"===e[s].ty)d?t[s].style.closed=!1:t[s]=this.createStyleElement(e[s],n),e[s]._render&&t[s].style.pElem.parentNode!==r&&r.appendChild(t[s].style.pElem),m.push(t[s].style);else if("gr"===e[s].ty){if(d)for(c=t[s].it.length,l=0;l<c;l+=1)t[s].prevViewData[l]=t[s].it[l];else t[s]=this.createGroupElement(e[s]);this.searchShapes(e[s].it,t[s].it,t[s].prevViewData,t[s].gr,n+1,p,o),e[s]._render&&t[s].gr.parentNode!==r&&r.appendChild(t[s].gr)}else"tr"===e[s].ty?(d||(t[s]=this.createTransformElement(e[s],r)),h=t[s].transform,p.push(h)):"sh"===e[s].ty||"rc"===e[s].ty||"el"===e[s].ty||"sr"===e[s].ty?(d||(t[s]=this.createShapeElement(e[s],p,n)),this.setElementStyles(t[s])):"tm"===e[s].ty||"rd"===e[s].ty||"ms"===e[s].ty||"pb"===e[s].ty||"zz"===e[s].ty||"op"===e[s].ty?(d?(u=t[s]).closed=!1:((u=ShapeModifiers.getModifier(e[s].ty)).init(this,e[s]),t[s]=u,this.shapeModifiers.push(u)),g.push(u)):"rp"===e[s].ty&&(d?(u=t[s]).closed=!0:(u=ShapeModifiers.getModifier(e[s].ty),t[s]=u,u.init(this,e,s,t),this.shapeModifiers.push(u),o=!1),g.push(u));this.addProcessedElement(e[s],s+1)}for(f=m.length,s=0;s<f;s+=1)m[s].closed=!0;for(f=g.length,s=0;s<f;s+=1)g[s].closed=!0},SVGShapeElement.prototype.renderInnerContent=function(){var e;this.renderModifiers();var t=this.stylesList.length;for(e=0;e<t;e+=1)this.stylesList[e].reset();for(this.renderShape(),e=0;e<t;e+=1)(this.stylesList[e]._mdf||this._isFirstFrame)&&(this.stylesList[e].msElem&&(this.stylesList[e].msElem.setAttribute("d",this.stylesList[e].d),this.stylesList[e].d="M0 0"+this.stylesList[e].d),this.stylesList[e].pElem.setAttribute("d",this.stylesList[e].d||"M0 0"))},SVGShapeElement.prototype.renderShape=function(){var e,t,i=this.animatedContents.length;for(e=0;e<i;e+=1)t=this.animatedContents[e],(this._isFirstFrame||t.element._isAnimated)&&!0!==t.data&&t.fn(t.data,t.element,this._isFirstFrame)},SVGShapeElement.prototype.destroy=function(){this.destroyBaseElement(),this.shapesData=null,this.itemsData=null},LetterProps.prototype.update=function(e,t,i,r,n,a){this._mdf.o=!1,this._mdf.sw=!1,this._mdf.sc=!1,this._mdf.fc=!1,this._mdf.m=!1,this._mdf.p=!1;var o=!1;return this.o!==e&&(this.o=e,this._mdf.o=!0,o=!0),this.sw!==t&&(this.sw=t,this._mdf.sw=!0,o=!0),this.sc!==i&&(this.sc=i,this._mdf.sc=!0,o=!0),this.fc!==r&&(this.fc=r,this._mdf.fc=!0,o=!0),this.m!==n&&(this.m=n,this._mdf.m=!0,o=!0),!a.length||this.p[0]===a[0]&&this.p[1]===a[1]&&this.p[4]===a[4]&&this.p[5]===a[5]&&this.p[12]===a[12]&&this.p[13]===a[13]||(this.p=a,this._mdf.p=!0,o=!0),o},TextProperty.prototype.defaultBoxWidth=[0,0],TextProperty.prototype.copyData=function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},TextProperty.prototype.setCurrentData=function(e){e.__complete||this.completeTextData(e),this.currentData=e,this.currentData.boxWidth=this.currentData.boxWidth||this.defaultBoxWidth,this._mdf=!0},TextProperty.prototype.searchProperty=function(){return this.searchKeyframes()},TextProperty.prototype.searchKeyframes=function(){return this.kf=this.data.d.k.length>1,this.kf&&this.addEffect(this.getKeyframeValue.bind(this)),this.kf},TextProperty.prototype.addEffect=function(e){this.effectsSequence.push(e),this.elem.addDynamicProperty(this)},TextProperty.prototype.getValue=function(e){if(this.elem.globalData.frameId!==this.frameId&&this.effectsSequence.length||e){this.currentData.t=this.data.d.k[this.keysIndex].s.t;var t=this.currentData,i=this.keysIndex;if(this.lock)this.setCurrentData(this.currentData);else{var r;this.lock=!0,this._mdf=!1;var n=this.effectsSequence.length,a=e||this.data.d.k[this.keysIndex].s;for(r=0;r<n;r+=1)a=i!==this.keysIndex?this.effectsSequence[r](a,a.t):this.effectsSequence[r](this.currentData,a.t);t!==a&&this.setCurrentData(a),this.v=this.currentData,this.pv=this.v,this.lock=!1,this.frameId=this.elem.globalData.frameId}}},TextProperty.prototype.getKeyframeValue=function(){for(var e=this.data.d.k,t=this.elem.comp.renderedFrame,i=0,r=e.length;i<=r-1&&!(i===r-1||e[i+1].t>t);)i+=1;return this.keysIndex!==i&&(this.keysIndex=i),this.data.d.k[this.keysIndex].s},TextProperty.prototype.buildFinalText=function(e){for(var t,i,r=[],n=0,a=e.length,o=!1,s=!1,l="";n<a;)o=s,s=!1,t=e.charCodeAt(n),l=e.charAt(n),FontManager.isCombinedCharacter(t)?o=!0:t>=55296&&t<=56319?FontManager.isRegionalFlag(e,n)?l=e.substr(n,14):(i=e.charCodeAt(n+1))>=56320&&i<=57343&&(FontManager.isModifier(t,i)?(l=e.substr(n,2),o=!0):l=FontManager.isFlagEmoji(e.substr(n,4))?e.substr(n,4):e.substr(n,2)):t>56319?(i=e.charCodeAt(n+1),FontManager.isVariationSelector(t)&&(o=!0)):FontManager.isZeroWidthJoiner(t)&&(o=!0,s=!0),o?(r[r.length-1]+=l,o=!1):r.push(l),n+=l.length;return r},TextProperty.prototype.completeTextData=function(e){e.__complete=!0;var t,i,r,n,a,o,s,l=this.elem.globalData.fontManager,c=this.data,h=[],u=0,d=c.m.g,p=0,f=0,m=0,g=[],_=0,y=0,v=l.getFontByName(e.f),x=0,b=getFontProperties(v);e.fWeight=b.weight,e.fStyle=b.style,e.finalSize=e.s,e.finalText=this.buildFinalText(e.t),i=e.finalText.length,e.finalLineHeight=e.lh;var w,S=e.tr/1e3*e.finalSize;if(e.sz)for(var T,E,M=!0,A=e.sz[0],P=e.sz[1];M;){T=0,_=0,i=(E=this.buildFinalText(e.t)).length,S=e.tr/1e3*e.finalSize;var C=-1;for(t=0;t<i;t+=1)w=E[t].charCodeAt(0),r=!1," "===E[t]?C=t:13!==w&&3!==w||(_=0,r=!0,T+=e.finalLineHeight||1.2*e.finalSize),l.chars?(s=l.getCharData(E[t],v.fStyle,v.fFamily),x=r?0:s.w*e.finalSize/100):x=l.measureText(E[t],e.f,e.finalSize),_+x>A&&" "!==E[t]?(-1===C?i+=1:t=C,T+=e.finalLineHeight||1.2*e.finalSize,E.splice(t,C===t?1:0,"\r"),C=-1,_=0):(_+=x,_+=S);T+=v.ascent*e.finalSize/100,this.canResize&&e.finalSize>this.minimumFontSize&&P<T?(e.finalSize-=1,e.finalLineHeight=e.finalSize*e.lh/e.s):(e.finalText=E,i=e.finalText.length,M=!1)}_=-S,x=0;var I,k=0;for(t=0;t<i;t+=1)if(r=!1,13===(w=(I=e.finalText[t]).charCodeAt(0))||3===w?(k=0,g.push(_),y=_>y?_:y,_=-2*S,n="",r=!0,m+=1):n=I,l.chars?(s=l.getCharData(I,v.fStyle,l.getFontByName(e.f).fFamily),x=r?0:s.w*e.finalSize/100):x=l.measureText(n,e.f,e.finalSize)," "===I?k+=x+S:(_+=x+S+k,k=0),h.push({l:x,an:x,add:p,n:r,anIndexes:[],val:n,line:m,animatorJustifyOffset:0}),2==d){if(p+=x,""===n||" "===n||t===i-1){for(""!==n&&" "!==n||(p-=x);f<=t;)h[f].an=p,h[f].ind=u,h[f].extra=x,f+=1;u+=1,p=0}}else if(3==d){if(p+=x,""===n||t===i-1){for(""===n&&(p-=x);f<=t;)h[f].an=p,h[f].ind=u,h[f].extra=x,f+=1;p=0,u+=1}}else h[u].ind=u,h[u].extra=0,u+=1;if(e.l=h,y=_>y?_:y,g.push(_),e.sz)e.boxWidth=e.sz[0],e.justifyOffset=0;else switch(e.boxWidth=y,e.j){case 1:e.justifyOffset=-e.boxWidth;break;case 2:e.justifyOffset=-e.boxWidth/2;break;default:e.justifyOffset=0}e.lineWidths=g;var D,R,L,z,F=c.a;o=F.length;var O=[];for(a=0;a<o;a+=1){for((D=F[a]).a.sc&&(e.strokeColorAnim=!0),D.a.sw&&(e.strokeWidthAnim=!0),(D.a.fc||D.a.fh||D.a.fs||D.a.fb)&&(e.fillColorAnim=!0),z=0,L=D.s.b,t=0;t<i;t+=1)(R=h[t]).anIndexes[a]=z,(1==L&&""!==R.val||2==L&&""!==R.val&&" "!==R.val||3==L&&(R.n||" "==R.val||t==i-1)||4==L&&(R.n||t==i-1))&&(1===D.s.rn&&O.push(z),z+=1);c.a[a].s.totalChars=z;var B,N=-1;if(1===D.s.rn)for(t=0;t<i;t+=1)N!=(R=h[t]).anIndexes[a]&&(N=R.anIndexes[a],B=O.splice(Math.floor(Math.random()*O.length),1)[0]),R.anIndexes[a]=B}e.yOffset=e.finalLineHeight||1.2*e.finalSize,e.ls=e.ls||0,e.ascent=v.ascent*e.finalSize/100},TextProperty.prototype.updateDocumentData=function(e,t){t=void 0===t?this.keysIndex:t;var i=this.copyData({},this.data.d.k[t].s);i=this.copyData(i,e),this.data.d.k[t].s=i,this.recalculate(t),this.setCurrentData(i),this.elem.addDynamicProperty(this)},TextProperty.prototype.recalculate=function(e){var t=this.data.d.k[e].s;t.__complete=!1,this.keysIndex=0,this._isFirstFrame=!0,this.getValue(t)},TextProperty.prototype.canResizeFont=function(e){this.canResize=e,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)},TextProperty.prototype.setMinimumFontSize=function(e){this.minimumFontSize=Math.floor(e)||1,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)};var TextSelectorProp=function(){var e=Math.max,t=Math.min,i=Math.floor;function r(e,t){this._currentTextLength=-1,this.k=!1,this.data=t,this.elem=e,this.comp=e.comp,this.finalS=0,this.finalE=0,this.initDynamicPropertyContainer(e),this.s=PropertyFactory.getProp(e,t.s||{k:0},0,0,this),this.e="e"in t?PropertyFactory.getProp(e,t.e,0,0,this):{v:100},this.o=PropertyFactory.getProp(e,t.o||{k:0},0,0,this),this.xe=PropertyFactory.getProp(e,t.xe||{k:0},0,0,this),this.ne=PropertyFactory.getProp(e,t.ne||{k:0},0,0,this),this.sm=PropertyFactory.getProp(e,t.sm||{k:100},0,0,this),this.a=PropertyFactory.getProp(e,t.a,0,.01,this),this.dynamicProperties.length||this.getValue()}return r.prototype={getMult:function(r){this._currentTextLength!==this.elem.textProperty.currentData.l.length&&this.getValue();var n=0,a=0,o=1,s=1;this.ne.v>0?n=this.ne.v/100:a=-this.ne.v/100,this.xe.v>0?o=1-this.xe.v/100:s=1+this.xe.v/100;var l=BezierFactory.getBezierEasing(n,a,o,s).get,c=0,h=this.finalS,u=this.finalE,d=this.data.sh;if(2===d)c=l(c=u===h?r>=u?1:0:e(0,t(.5/(u-h)+(r-h)/(u-h),1)));else if(3===d)c=l(c=u===h?r>=u?0:1:1-e(0,t(.5/(u-h)+(r-h)/(u-h),1)));else if(4===d)u===h?c=0:(c=e(0,t(.5/(u-h)+(r-h)/(u-h),1)))<.5?c*=2:c=1-2*(c-.5),c=l(c);else if(5===d){if(u===h)c=0;else{var p=u-h,f=-p/2+(r=t(e(0,r+.5-h),u-h)),m=p/2;c=Math.sqrt(1-f*f/(m*m))}c=l(c)}else 6===d?(u===h?c=0:(r=t(e(0,r+.5-h),u-h),c=(1+Math.cos(Math.PI+2*Math.PI*r/(u-h)))/2),c=l(c)):(r>=i(h)&&(c=e(0,t(r-h<0?t(u,1)-(h-r):u-r,1))),c=l(c));if(100!==this.sm.v){var g=.01*this.sm.v;0===g&&(g=1e-8);var _=.5-.5*g;c<_?c=0:(c=(c-_)/g)>1&&(c=1)}return c*this.a.v},getValue:function(e){this.iterateDynamicProperties(),this._mdf=e||this._mdf,this._currentTextLength=this.elem.textProperty.currentData.l.length||0,e&&2===this.data.r&&(this.e.v=this._currentTextLength);var t=2===this.data.r?1:100/this.data.totalChars,i=this.o.v/t,r=this.s.v/t+i,n=this.e.v/t+i;if(r>n){var a=r;r=n,n=a}this.finalS=r,this.finalE=n}},extendPrototype([DynamicPropertyContainer],r),{getTextSelectorProp:function(e,t,i){return new r(e,t,i)}}}();function TextAnimatorDataProperty(e,t,i){var r={propType:!1},n=PropertyFactory.getProp,a=t.a;this.a={r:a.r?n(e,a.r,0,degToRads,i):r,rx:a.rx?n(e,a.rx,0,degToRads,i):r,ry:a.ry?n(e,a.ry,0,degToRads,i):r,sk:a.sk?n(e,a.sk,0,degToRads,i):r,sa:a.sa?n(e,a.sa,0,degToRads,i):r,s:a.s?n(e,a.s,1,.01,i):r,a:a.a?n(e,a.a,1,0,i):r,o:a.o?n(e,a.o,0,.01,i):r,p:a.p?n(e,a.p,1,0,i):r,sw:a.sw?n(e,a.sw,0,0,i):r,sc:a.sc?n(e,a.sc,1,0,i):r,fc:a.fc?n(e,a.fc,1,0,i):r,fh:a.fh?n(e,a.fh,0,0,i):r,fs:a.fs?n(e,a.fs,0,.01,i):r,fb:a.fb?n(e,a.fb,0,.01,i):r,t:a.t?n(e,a.t,0,0,i):r},this.s=TextSelectorProp.getTextSelectorProp(e,t.s,i),this.s.t=t.s.t}function TextAnimatorProperty(e,t,i){this._isFirstFrame=!0,this._hasMaskedPath=!1,this._frameId=-1,this._textData=e,this._renderType=t,this._elem=i,this._animatorsData=createSizedArray(this._textData.a.length),this._pathData={},this._moreOptions={alignment:{}},this.renderedLetters=[],this.lettersChangedFlag=!1,this.initDynamicPropertyContainer(i)}function ITextElement(){}TextAnimatorProperty.prototype.searchProperties=function(){var e,t,i=this._textData.a.length,r=PropertyFactory.getProp;for(e=0;e<i;e+=1)t=this._textData.a[e],this._animatorsData[e]=new TextAnimatorDataProperty(this._elem,t,this);this._textData.p&&"m"in this._textData.p?(this._pathData={a:r(this._elem,this._textData.p.a,0,0,this),f:r(this._elem,this._textData.p.f,0,0,this),l:r(this._elem,this._textData.p.l,0,0,this),r:r(this._elem,this._textData.p.r,0,0,this),p:r(this._elem,this._textData.p.p,0,0,this),m:this._elem.maskManager.getMaskProperty(this._textData.p.m)},this._hasMaskedPath=!0):this._hasMaskedPath=!1,this._moreOptions.alignment=r(this._elem,this._textData.m.a,1,0,this)},TextAnimatorProperty.prototype.getMeasures=function(e,t){if(this.lettersChangedFlag=t,this._mdf||this._isFirstFrame||t||this._hasMaskedPath&&this._pathData.m._mdf){this._isFirstFrame=!1;var i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,v,x,b=this._moreOptions.alignment.v,w=this._animatorsData,S=this._textData,T=this.mHelper,E=this._renderType,M=this.renderedLetters.length,A=e.l;if(this._hasMaskedPath){if(x=this._pathData.m,!this._pathData.n||this._pathData._mdf){var P,C=x.v;for(this._pathData.r.v&&(C=C.reverse()),o={tLength:0,segments:[]},a=C._length-1,_=0,n=0;n<a;n+=1)P=bez.buildBezierData(C.v[n],C.v[n+1],[C.o[n][0]-C.v[n][0],C.o[n][1]-C.v[n][1]],[C.i[n+1][0]-C.v[n+1][0],C.i[n+1][1]-C.v[n+1][1]]),o.tLength+=P.segmentLength,o.segments.push(P),_+=P.segmentLength;n=a,x.v.c&&(P=bez.buildBezierData(C.v[n],C.v[0],[C.o[n][0]-C.v[n][0],C.o[n][1]-C.v[n][1]],[C.i[0][0]-C.v[0][0],C.i[0][1]-C.v[0][1]]),o.tLength+=P.segmentLength,o.segments.push(P),_+=P.segmentLength),this._pathData.pi=o}if(o=this._pathData.pi,s=this._pathData.f.v,d=0,u=1,c=0,h=!0,m=o.segments,s<0&&x.v.c)for(o.tLength<Math.abs(s)&&(s=-Math.abs(s)%o.tLength),u=(f=m[d=m.length-1].points).length-1;s<0;)s+=f[u].partialLength,(u-=1)<0&&(u=(f=m[d-=1].points).length-1);p=(f=m[d].points)[u-1],g=(l=f[u]).partialLength}a=A.length,i=0,r=0;var I,k,D,R,L,z=1.2*e.finalSize*.714,F=!0;D=w.length;var O,B,N,V,j,U,G,q,H,W,Z,Q,X=-1,Y=s,J=d,K=u,$=-1,ee="",te=this.defaultPropsArray;if(2===e.j||1===e.j){var ie=0,re=0,ne=2===e.j?-.5:-1,ae=0,oe=!0;for(n=0;n<a;n+=1)if(A[n].n){for(ie&&(ie+=re);ae<n;)A[ae].animatorJustifyOffset=ie,ae+=1;ie=0,oe=!0}else{for(k=0;k<D;k+=1)(I=w[k].a).t.propType&&(oe&&2===e.j&&(re+=I.t.v*ne),(L=w[k].s.getMult(A[n].anIndexes[k],S.a[k].s.totalChars)).length?ie+=I.t.v*L[0]*ne:ie+=I.t.v*L*ne);oe=!1}for(ie&&(ie+=re);ae<n;)A[ae].animatorJustifyOffset=ie,ae+=1}for(n=0;n<a;n+=1){if(T.reset(),V=1,A[n].n)i=0,r+=e.yOffset,r+=F?1:0,s=Y,F=!1,this._hasMaskedPath&&(u=K,p=(f=m[d=J].points)[u-1],g=(l=f[u]).partialLength,c=0),ee="",Z="",H="",Q="",te=this.defaultPropsArray;else{if(this._hasMaskedPath){if($!==A[n].line){switch(e.j){case 1:s+=_-e.lineWidths[A[n].line];break;case 2:s+=(_-e.lineWidths[A[n].line])/2}$=A[n].line}X!==A[n].ind&&(A[X]&&(s+=A[X].extra),s+=A[n].an/2,X=A[n].ind),s+=b[0]*A[n].an*.005;var se=0;for(k=0;k<D;k+=1)(I=w[k].a).p.propType&&((L=w[k].s.getMult(A[n].anIndexes[k],S.a[k].s.totalChars)).length?se+=I.p.v[0]*L[0]:se+=I.p.v[0]*L),I.a.propType&&((L=w[k].s.getMult(A[n].anIndexes[k],S.a[k].s.totalChars)).length?se+=I.a.v[0]*L[0]:se+=I.a.v[0]*L);for(h=!0,this._pathData.a.v&&(s=.5*A[0].an+(_-this._pathData.f.v-.5*A[0].an-.5*A[A.length-1].an)*X/(a-1),s+=this._pathData.f.v);h;)c+g>=s+se||!f?(y=(s+se-c)/l.partialLength,B=p.point[0]+(l.point[0]-p.point[0])*y,N=p.point[1]+(l.point[1]-p.point[1])*y,T.translate(-b[0]*A[n].an*.005,-b[1]*z*.01),h=!1):f&&(c+=l.partialLength,(u+=1)>=f.length&&(u=0,m[d+=1]?f=m[d].points:x.v.c?(u=0,f=m[d=0].points):(c-=l.partialLength,f=null)),f&&(p=l,g=(l=f[u]).partialLength));O=A[n].an/2-A[n].add,T.translate(-O,0,0)}else O=A[n].an/2-A[n].add,T.translate(-O,0,0),T.translate(-b[0]*A[n].an*.005,-b[1]*z*.01,0);for(k=0;k<D;k+=1)(I=w[k].a).t.propType&&(L=w[k].s.getMult(A[n].anIndexes[k],S.a[k].s.totalChars),0===i&&0===e.j||(this._hasMaskedPath?L.length?s+=I.t.v*L[0]:s+=I.t.v*L:L.length?i+=I.t.v*L[0]:i+=I.t.v*L));for(e.strokeWidthAnim&&(U=e.sw||0),e.strokeColorAnim&&(j=e.sc?[e.sc[0],e.sc[1],e.sc[2]]:[0,0,0]),e.fillColorAnim&&e.fc&&(G=[e.fc[0],e.fc[1],e.fc[2]]),k=0;k<D;k+=1)(I=w[k].a).a.propType&&((L=w[k].s.getMult(A[n].anIndexes[k],S.a[k].s.totalChars)).length?T.translate(-I.a.v[0]*L[0],-I.a.v[1]*L[1],I.a.v[2]*L[2]):T.translate(-I.a.v[0]*L,-I.a.v[1]*L,I.a.v[2]*L));for(k=0;k<D;k+=1)(I=w[k].a).s.propType&&((L=w[k].s.getMult(A[n].anIndexes[k],S.a[k].s.totalChars)).length?T.scale(1+(I.s.v[0]-1)*L[0],1+(I.s.v[1]-1)*L[1],1):T.scale(1+(I.s.v[0]-1)*L,1+(I.s.v[1]-1)*L,1));for(k=0;k<D;k+=1){if(I=w[k].a,L=w[k].s.getMult(A[n].anIndexes[k],S.a[k].s.totalChars),I.sk.propType&&(L.length?T.skewFromAxis(-I.sk.v*L[0],I.sa.v*L[1]):T.skewFromAxis(-I.sk.v*L,I.sa.v*L)),I.r.propType&&(L.length?T.rotateZ(-I.r.v*L[2]):T.rotateZ(-I.r.v*L)),I.ry.propType&&(L.length?T.rotateY(I.ry.v*L[1]):T.rotateY(I.ry.v*L)),I.rx.propType&&(L.length?T.rotateX(I.rx.v*L[0]):T.rotateX(I.rx.v*L)),I.o.propType&&(L.length?V+=(I.o.v*L[0]-V)*L[0]:V+=(I.o.v*L-V)*L),e.strokeWidthAnim&&I.sw.propType&&(L.length?U+=I.sw.v*L[0]:U+=I.sw.v*L),e.strokeColorAnim&&I.sc.propType)for(q=0;q<3;q+=1)L.length?j[q]+=(I.sc.v[q]-j[q])*L[0]:j[q]+=(I.sc.v[q]-j[q])*L;if(e.fillColorAnim&&e.fc){if(I.fc.propType)for(q=0;q<3;q+=1)L.length?G[q]+=(I.fc.v[q]-G[q])*L[0]:G[q]+=(I.fc.v[q]-G[q])*L;I.fh.propType&&(G=L.length?addHueToRGB(G,I.fh.v*L[0]):addHueToRGB(G,I.fh.v*L)),I.fs.propType&&(G=L.length?addSaturationToRGB(G,I.fs.v*L[0]):addSaturationToRGB(G,I.fs.v*L)),I.fb.propType&&(G=L.length?addBrightnessToRGB(G,I.fb.v*L[0]):addBrightnessToRGB(G,I.fb.v*L))}}for(k=0;k<D;k+=1)(I=w[k].a).p.propType&&(L=w[k].s.getMult(A[n].anIndexes[k],S.a[k].s.totalChars),this._hasMaskedPath?L.length?T.translate(0,I.p.v[1]*L[0],-I.p.v[2]*L[1]):T.translate(0,I.p.v[1]*L,-I.p.v[2]*L):L.length?T.translate(I.p.v[0]*L[0],I.p.v[1]*L[1],-I.p.v[2]*L[2]):T.translate(I.p.v[0]*L,I.p.v[1]*L,-I.p.v[2]*L));if(e.strokeWidthAnim&&(H=U<0?0:U),e.strokeColorAnim&&(W="rgb("+Math.round(255*j[0])+","+Math.round(255*j[1])+","+Math.round(255*j[2])+")"),e.fillColorAnim&&e.fc&&(Z="rgb("+Math.round(255*G[0])+","+Math.round(255*G[1])+","+Math.round(255*G[2])+")"),this._hasMaskedPath){if(T.translate(0,-e.ls),T.translate(0,b[1]*z*.01+r,0),this._pathData.p.v){v=(l.point[1]-p.point[1])/(l.point[0]-p.point[0]);var le=180*Math.atan(v)/Math.PI;l.point[0]<p.point[0]&&(le+=180),T.rotate(-le*Math.PI/180)}T.translate(B,N,0),s-=b[0]*A[n].an*.005,A[n+1]&&X!==A[n+1].ind&&(s+=A[n].an/2,s+=.001*e.tr*e.finalSize)}else{switch(T.translate(i,r,0),e.ps&&T.translate(e.ps[0],e.ps[1]+e.ascent,0),e.j){case 1:T.translate(A[n].animatorJustifyOffset+e.justifyOffset+(e.boxWidth-e.lineWidths[A[n].line]),0,0);break;case 2:T.translate(A[n].animatorJustifyOffset+e.justifyOffset+(e.boxWidth-e.lineWidths[A[n].line])/2,0,0)}T.translate(0,-e.ls),T.translate(O,0,0),T.translate(b[0]*A[n].an*.005,b[1]*z*.01,0),i+=A[n].l+.001*e.tr*e.finalSize}"html"===E?ee=T.toCSS():"svg"===E?ee=T.to2dCSS():te=[T.props[0],T.props[1],T.props[2],T.props[3],T.props[4],T.props[5],T.props[6],T.props[7],T.props[8],T.props[9],T.props[10],T.props[11],T.props[12],T.props[13],T.props[14],T.props[15]],Q=V}M<=n?(R=new LetterProps(Q,H,W,Z,ee,te),this.renderedLetters.push(R),M+=1,this.lettersChangedFlag=!0):(R=this.renderedLetters[n],this.lettersChangedFlag=R.update(Q,H,W,Z,ee,te)||this.lettersChangedFlag)}}},TextAnimatorProperty.prototype.getValue=function(){this._elem.globalData.frameId!==this._frameId&&(this._frameId=this._elem.globalData.frameId,this.iterateDynamicProperties())},TextAnimatorProperty.prototype.mHelper=new Matrix,TextAnimatorProperty.prototype.defaultPropsArray=[],extendPrototype([DynamicPropertyContainer],TextAnimatorProperty),ITextElement.prototype.initElement=function(e,t,i){this.lettersChangedFlag=!0,this.initFrame(),this.initBaseData(e,t,i),this.textProperty=new TextProperty(this,e.t,this.dynamicProperties),this.textAnimator=new TextAnimatorProperty(e.t,this.renderType,this),this.initTransform(e,t,i),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide(),this.textAnimator.searchProperties(this.dynamicProperties)},ITextElement.prototype.prepareFrame=function(e){this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange)},ITextElement.prototype.createPathShape=function(e,t){var i,r,n=t.length,a="";for(i=0;i<n;i+=1)"sh"===t[i].ty&&(r=t[i].ks.k,a+=buildShapeString(r,r.i.length,!0,e));return a},ITextElement.prototype.updateDocumentData=function(e,t){this.textProperty.updateDocumentData(e,t)},ITextElement.prototype.canResizeFont=function(e){this.textProperty.canResizeFont(e)},ITextElement.prototype.setMinimumFontSize=function(e){this.textProperty.setMinimumFontSize(e)},ITextElement.prototype.applyTextPropertiesToMatrix=function(e,t,i,r,n){switch(e.ps&&t.translate(e.ps[0],e.ps[1]+e.ascent,0),t.translate(0,-e.ls,0),e.j){case 1:t.translate(e.justifyOffset+(e.boxWidth-e.lineWidths[i]),0,0);break;case 2:t.translate(e.justifyOffset+(e.boxWidth-e.lineWidths[i])/2,0,0)}t.translate(r,n,0)},ITextElement.prototype.buildColor=function(e){return"rgb("+Math.round(255*e[0])+","+Math.round(255*e[1])+","+Math.round(255*e[2])+")"},ITextElement.prototype.emptyProp=new LetterProps,ITextElement.prototype.destroy=function(){},ITextElement.prototype.validateText=function(){(this.textProperty._mdf||this.textProperty._isFirstFrame)&&(this.buildNewText(),this.textProperty._isFirstFrame=!1,this.textProperty._mdf=!1)};var emptyShapeData={shapes:[]};function SVGTextLottieElement(e,t,i){this.textSpans=[],this.renderType="svg",this.initElement(e,t,i)}function ISolidElement(e,t,i){this.initElement(e,t,i)}function NullElement(e,t,i){this.initFrame(),this.initBaseData(e,t,i),this.initFrame(),this.initTransform(e,t,i),this.initHierarchy()}function SVGRendererBase(){}function ICompElement(){}function SVGCompElement(e,t,i){this.layers=e.layers,this.supports3d=!0,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(e,t,i),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,t.frameRate,this):{_placeholder:!0}}function SVGRenderer(e,t){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.svgElement=createNS("svg");var i="";if(t&&t.title){var r=createNS("title"),n=createElementID();r.setAttribute("id",n),r.textContent=t.title,this.svgElement.appendChild(r),i+=n}if(t&&t.description){var a=createNS("desc"),o=createElementID();a.setAttribute("id",o),a.textContent=t.description,this.svgElement.appendChild(a),i+=" "+o}i&&this.svgElement.setAttribute("aria-labelledby",i);var s=createNS("defs");this.svgElement.appendChild(s);var l=createNS("g");this.svgElement.appendChild(l),this.layerElement=l,this.renderConfig={preserveAspectRatio:t&&t.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:t&&t.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:t&&t.contentVisibility||"visible",progressiveLoad:t&&t.progressiveLoad||!1,hideOnTransparent:!(t&&!1===t.hideOnTransparent),viewBoxOnly:t&&t.viewBoxOnly||!1,viewBoxSize:t&&t.viewBoxSize||!1,className:t&&t.className||"",id:t&&t.id||"",focusable:t&&t.focusable,filterSize:{width:t&&t.filterSize&&t.filterSize.width||"100%",height:t&&t.filterSize&&t.filterSize.height||"100%",x:t&&t.filterSize&&t.filterSize.x||"0%",y:t&&t.filterSize&&t.filterSize.y||"0%"},width:t&&t.width,height:t&&t.height,runExpressions:!t||void 0===t.runExpressions||t.runExpressions},this.globalData={_mdf:!1,frameNum:-1,defs:s,renderConfig:this.renderConfig},this.elements=[],this.pendingElements=[],this.destroyed=!1,this.rendererType="svg"}function ShapeTransformManager(){this.sequences={},this.sequenceList=[],this.transform_key_count=0}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],SVGTextLottieElement),SVGTextLottieElement.prototype.createContent=function(){this.data.singleShape&&!this.globalData.fontManager.chars&&(this.textContainer=createNS("text"))},SVGTextLottieElement.prototype.buildTextContents=function(e){for(var t=0,i=e.length,r=[],n="";t<i;)e[t]===String.fromCharCode(13)||e[t]===String.fromCharCode(3)?(r.push(n),n=""):n+=e[t],t+=1;return r.push(n),r},SVGTextLottieElement.prototype.buildShapeData=function(e,t){if(e.shapes&&e.shapes.length){var i=e.shapes[0];if(i.it){var r=i.it[i.it.length-1];r.s&&(r.s.k[0]=t,r.s.k[1]=t)}}return e},SVGTextLottieElement.prototype.buildNewText=function(){var e,t;this.addDynamicProperty(this);var i=this.textProperty.currentData;this.renderedLetters=createSizedArray(i?i.l.length:0),i.fc?this.layerElement.setAttribute("fill",this.buildColor(i.fc)):this.layerElement.setAttribute("fill","rgba(0,0,0,0)"),i.sc&&(this.layerElement.setAttribute("stroke",this.buildColor(i.sc)),this.layerElement.setAttribute("stroke-width",i.sw)),this.layerElement.setAttribute("font-size",i.finalSize);var r=this.globalData.fontManager.getFontByName(i.f);if(r.fClass)this.layerElement.setAttribute("class",r.fClass);else{this.layerElement.setAttribute("font-family",r.fFamily);var n=i.fWeight,a=i.fStyle;this.layerElement.setAttribute("font-style",a),this.layerElement.setAttribute("font-weight",n)}this.layerElement.setAttribute("aria-label",i.t);var o,s=i.l||[],l=!!this.globalData.fontManager.chars;t=s.length;var c=this.mHelper,h=this.data.singleShape,u=0,d=0,p=!0,f=.001*i.tr*i.finalSize;if(!h||l||i.sz){var m,g=this.textSpans.length;for(e=0;e<t;e+=1){if(this.textSpans[e]||(this.textSpans[e]={span:null,childSpan:null,glyph:null}),!l||!h||0===e){if(o=g>e?this.textSpans[e].span:createNS(l?"g":"text"),g<=e){if(o.setAttribute("stroke-linecap","butt"),o.setAttribute("stroke-linejoin","round"),o.setAttribute("stroke-miterlimit","4"),this.textSpans[e].span=o,l){var _=createNS("g");o.appendChild(_),this.textSpans[e].childSpan=_}this.textSpans[e].span=o,this.layerElement.appendChild(o)}o.style.display="inherit"}if(c.reset(),h&&(s[e].n&&(u=-f,d+=i.yOffset,d+=p?1:0,p=!1),this.applyTextPropertiesToMatrix(i,c,s[e].line,u,d),u+=s[e].l||0,u+=f),l){var y;if(1===(m=this.globalData.fontManager.getCharData(i.finalText[e],r.fStyle,this.globalData.fontManager.getFontByName(i.f).fFamily)).t)y=new SVGCompElement(m.data,this.globalData,this);else{var v=emptyShapeData;m.data&&m.data.shapes&&(v=this.buildShapeData(m.data,i.finalSize)),y=new SVGShapeElement(v,this.globalData,this)}if(this.textSpans[e].glyph){var x=this.textSpans[e].glyph;this.textSpans[e].childSpan.removeChild(x.layerElement),x.destroy()}this.textSpans[e].glyph=y,y._debug=!0,y.prepareFrame(0),y.renderFrame(),this.textSpans[e].childSpan.appendChild(y.layerElement),1===m.t&&this.textSpans[e].childSpan.setAttribute("transform","scale("+i.finalSize/100+","+i.finalSize/100+")")}else h&&o.setAttribute("transform","translate("+c.props[12]+","+c.props[13]+")"),o.textContent=s[e].val,o.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")}h&&o&&o.setAttribute("d","")}else{var b=this.textContainer,w="start";switch(i.j){case 1:w="end";break;case 2:w="middle";break;default:w="start"}b.setAttribute("text-anchor",w),b.setAttribute("letter-spacing",f);var S=this.buildTextContents(i.finalText);for(t=S.length,d=i.ps?i.ps[1]+i.ascent:0,e=0;e<t;e+=1)(o=this.textSpans[e].span||createNS("tspan")).textContent=S[e],o.setAttribute("x",0),o.setAttribute("y",d),o.style.display="inherit",b.appendChild(o),this.textSpans[e]||(this.textSpans[e]={span:null,glyph:null}),this.textSpans[e].span=o,d+=i.finalLineHeight;this.layerElement.appendChild(b)}for(;e<this.textSpans.length;)this.textSpans[e].span.style.display="none",e+=1;this._sizeChanged=!0},SVGTextLottieElement.prototype.sourceRectAtTime=function(){if(this.prepareFrame(this.comp.renderedFrame-this.data.st),this.renderInnerContent(),this._sizeChanged){this._sizeChanged=!1;var e=this.layerElement.getBBox();this.bbox={top:e.y,left:e.x,width:e.width,height:e.height}}return this.bbox},SVGTextLottieElement.prototype.getValue=function(){var e,t,i=this.textSpans.length;for(this.renderedFrame=this.comp.renderedFrame,e=0;e<i;e+=1)(t=this.textSpans[e].glyph)&&(t.prepareFrame(this.comp.renderedFrame-this.data.st),t._mdf&&(this._mdf=!0))},SVGTextLottieElement.prototype.renderInnerContent=function(){if(this.validateText(),(!this.data.singleShape||this._mdf)&&(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag)){var e,t;this._sizeChanged=!0;var i,r,n,a=this.textAnimator.renderedLetters,o=this.textProperty.currentData.l;for(t=o.length,e=0;e<t;e+=1)o[e].n||(i=a[e],r=this.textSpans[e].span,(n=this.textSpans[e].glyph)&&n.renderFrame(),i._mdf.m&&r.setAttribute("transform",i.m),i._mdf.o&&r.setAttribute("opacity",i.o),i._mdf.sw&&r.setAttribute("stroke-width",i.sw),i._mdf.sc&&r.setAttribute("stroke",i.sc),i._mdf.fc&&r.setAttribute("fill",i.fc))}},extendPrototype([IImageElement],ISolidElement),ISolidElement.prototype.createContent=function(){var e=createNS("rect");e.setAttribute("width",this.data.sw),e.setAttribute("height",this.data.sh),e.setAttribute("fill",this.data.sc),this.layerElement.appendChild(e)},NullElement.prototype.prepareFrame=function(e){this.prepareProperties(e,!0)},NullElement.prototype.renderFrame=function(){},NullElement.prototype.getBaseElement=function(){return null},NullElement.prototype.destroy=function(){},NullElement.prototype.sourceRectAtTime=function(){},NullElement.prototype.hide=function(){},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement],NullElement),extendPrototype([BaseRenderer],SVGRendererBase),SVGRendererBase.prototype.createNull=function(e){return new NullElement(e,this.globalData,this)},SVGRendererBase.prototype.createShape=function(e){return new SVGShapeElement(e,this.globalData,this)},SVGRendererBase.prototype.createText=function(e){return new SVGTextLottieElement(e,this.globalData,this)},SVGRendererBase.prototype.createImage=function(e){return new IImageElement(e,this.globalData,this)},SVGRendererBase.prototype.createSolid=function(e){return new ISolidElement(e,this.globalData,this)},SVGRendererBase.prototype.configAnimation=function(e){this.svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svgElement.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),this.renderConfig.viewBoxSize?this.svgElement.setAttribute("viewBox",this.renderConfig.viewBoxSize):this.svgElement.setAttribute("viewBox","0 0 "+e.w+" "+e.h),this.renderConfig.viewBoxOnly||(this.svgElement.setAttribute("width",e.w),this.svgElement.setAttribute("height",e.h),this.svgElement.style.width="100%",this.svgElement.style.height="100%",this.svgElement.style.transform="translate3d(0,0,0)",this.svgElement.style.contentVisibility=this.renderConfig.contentVisibility),this.renderConfig.width&&this.svgElement.setAttribute("width",this.renderConfig.width),this.renderConfig.height&&this.svgElement.setAttribute("height",this.renderConfig.height),this.renderConfig.className&&this.svgElement.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.svgElement.setAttribute("id",this.renderConfig.id),void 0!==this.renderConfig.focusable&&this.svgElement.setAttribute("focusable",this.renderConfig.focusable),this.svgElement.setAttribute("preserveAspectRatio",this.renderConfig.preserveAspectRatio),this.animationItem.wrapper.appendChild(this.svgElement);var t=this.globalData.defs;this.setupGlobalData(e,t),this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.data=e;var i=createNS("clipPath"),r=createNS("rect");r.setAttribute("width",e.w),r.setAttribute("height",e.h),r.setAttribute("x",0),r.setAttribute("y",0);var n=createElementID();i.setAttribute("id",n),i.appendChild(r),this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+n+")"),t.appendChild(i),this.layers=e.layers,this.elements=createSizedArray(e.layers.length)},SVGRendererBase.prototype.destroy=function(){var e;this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.layerElement=null,this.globalData.defs=null;var t=this.layers?this.layers.length:0;for(e=0;e<t;e+=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},SVGRendererBase.prototype.updateContainerSize=function(){},SVGRendererBase.prototype.findIndexByInd=function(e){var t=0,i=this.layers.length;for(t=0;t<i;t+=1)if(this.layers[t].ind===e)return t;return-1},SVGRendererBase.prototype.buildItem=function(e){var t=this.elements;if(!t[e]&&99!==this.layers[e].ty){t[e]=!0;var i=this.createItem(this.layers[e]);if(t[e]=i,getExpressionsPlugin()&&(0===this.layers[e].ty&&this.globalData.projectInterface.registerComposition(i),i.initExpressions()),this.appendElementInPos(i,e),this.layers[e].tt){var r="tp"in this.layers[e]?this.findIndexByInd(this.layers[e].tp):e-1;if(-1===r)return;if(this.elements[r]&&!0!==this.elements[r]){var n=t[r].getMatte(this.layers[e].tt);i.setMatte(n)}else this.buildItem(r),this.addPendingElement(i)}}},SVGRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();if(e.checkParenting(),e.data.tt)for(var t=0,i=this.elements.length;t<i;){if(this.elements[t]===e){var r="tp"in e.data?this.findIndexByInd(e.data.tp):t-1,n=this.elements[r].getMatte(this.layers[t].tt);e.setMatte(n);break}t+=1}}},SVGRendererBase.prototype.renderFrame=function(e){if(this.renderedFrame!==e&&!this.destroyed){var t;null===e?e=this.renderedFrame:this.renderedFrame=e,this.globalData.frameNum=e,this.globalData.frameId+=1,this.globalData.projectInterface.currentFrame=e,this.globalData._mdf=!1;var i=this.layers.length;for(this.completeLayers||this.checkLayers(e),t=i-1;t>=0;t-=1)(this.completeLayers||this.elements[t])&&this.elements[t].prepareFrame(e-this.layers[t].st);if(this.globalData._mdf)for(t=0;t<i;t+=1)(this.completeLayers||this.elements[t])&&this.elements[t].renderFrame()}},SVGRendererBase.prototype.appendElementInPos=function(e,t){var i=e.getBaseElement();if(i){for(var r,n=0;n<t;)this.elements[n]&&!0!==this.elements[n]&&this.elements[n].getBaseElement()&&(r=this.elements[n].getBaseElement()),n+=1;r?this.layerElement.insertBefore(i,r):this.layerElement.appendChild(i)}},SVGRendererBase.prototype.hide=function(){this.layerElement.style.display="none"},SVGRendererBase.prototype.show=function(){this.layerElement.style.display="block"},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement,RenderableDOMElement],ICompElement),ICompElement.prototype.initElement=function(e,t,i){this.initFrame(),this.initBaseData(e,t,i),this.initTransform(e,t,i),this.initRenderable(),this.initHierarchy(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),!this.data.xt&&t.progressiveLoad||this.buildAllItems(),this.hide()},ICompElement.prototype.prepareFrame=function(e){if(this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange),this.isInRange||this.data.xt){if(this.tm._placeholder)this.renderedFrame=e/this.data.sr;else{var t=this.tm.v;t===this.data.op&&(t=this.data.op-1),this.renderedFrame=t}var i,r=this.elements.length;for(this.completeLayers||this.checkLayers(this.renderedFrame),i=r-1;i>=0;i-=1)(this.completeLayers||this.elements[i])&&(this.elements[i].prepareFrame(this.renderedFrame-this.layers[i].st),this.elements[i]._mdf&&(this._mdf=!0))}},ICompElement.prototype.renderInnerContent=function(){var e,t=this.layers.length;for(e=0;e<t;e+=1)(this.completeLayers||this.elements[e])&&this.elements[e].renderFrame()},ICompElement.prototype.setElements=function(e){this.elements=e},ICompElement.prototype.getElements=function(){return this.elements},ICompElement.prototype.destroyElements=function(){var e,t=this.layers.length;for(e=0;e<t;e+=1)this.elements[e]&&this.elements[e].destroy()},ICompElement.prototype.destroy=function(){this.destroyElements(),this.destroyBaseElement()},extendPrototype([SVGRendererBase,ICompElement,SVGBaseElement],SVGCompElement),SVGCompElement.prototype.createComp=function(e){return new SVGCompElement(e,this.globalData,this)},extendPrototype([SVGRendererBase],SVGRenderer),SVGRenderer.prototype.createComp=function(e){return new SVGCompElement(e,this.globalData,this)},ShapeTransformManager.prototype={addTransformSequence:function(e){var t,i=e.length,r="_";for(t=0;t<i;t+=1)r+=e[t].transform.key+"_";var n=this.sequences[r];return n||(n={transforms:[].concat(e),finalTransform:new Matrix,_mdf:!1},this.sequences[r]=n,this.sequenceList.push(n)),n},processSequence:function(e,t){for(var i=0,r=e.transforms.length,n=t;i<r&&!t;){if(e.transforms[i].transform.mProps._mdf){n=!0;break}i+=1}if(n)for(e.finalTransform.reset(),i=r-1;i>=0;i-=1)e.finalTransform.multiply(e.transforms[i].transform.mProps.v);e._mdf=n},processSequences:function(e){var t,i=this.sequenceList.length;for(t=0;t<i;t+=1)this.processSequence(this.sequenceList[t],e)},getNewKey:function(){return this.transform_key_count+=1,"_"+this.transform_key_count}};var lumaLoader=function(){var e="__lottie_element_luma_buffer",t=null,i=null,r=null;function n(){t||(r=function(){var t=createNS("svg"),i=createNS("filter"),r=createNS("feColorMatrix");return i.setAttribute("id",e),r.setAttribute("type","matrix"),r.setAttribute("color-interpolation-filters","sRGB"),r.setAttribute("values","0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0"),i.appendChild(r),t.appendChild(i),t.setAttribute("id",e+"_svg"),featureSupport.svgLumaHidden&&(t.style.display="none"),t}(),document.body.appendChild(r),t=createTag("canvas"),(i=t.getContext("2d")).filter="url(#"+e+")",i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1))}return{load:n,get:function(r){return t||n(),t.width=r.width,t.height=r.height,i.filter="url(#"+e+")",t}}};function createCanvas(e,t){if(featureSupport.offscreenCanvas)return new OffscreenCanvas(e,t);var i=createTag("canvas");return i.width=e,i.height=t,i}var assetLoader={loadLumaCanvas:lumaLoader.load,getLumaCanvas:lumaLoader.get,createCanvas:createCanvas},registeredEffects={};function CVEffects(e){var t,i,r=e.data.ef?e.data.ef.length:0;for(this.filters=[],t=0;t<r;t+=1){i=null;var n=e.data.ef[t].ty;registeredEffects[n]&&(i=new(0,registeredEffects[n].effect)(e.effectsManager.effectElements[t],e)),i&&this.filters.push(i)}this.filters.length&&e.addRenderableComponent(this)}function registerEffect(e,t){registeredEffects[e]={effect:t}}function CVMaskElement(e,t){var i;this.data=e,this.element=t,this.masksProperties=this.data.masksProperties||[],this.viewData=createSizedArray(this.masksProperties.length);var r=this.masksProperties.length,n=!1;for(i=0;i<r;i+=1)"n"!==this.masksProperties[i].mode&&(n=!0),this.viewData[i]=ShapePropertyFactory.getShapeProp(this.element,this.masksProperties[i],3);this.hasMasks=n,n&&this.element.addRenderableComponent(this)}function CVBaseElement(){}CVEffects.prototype.renderFrame=function(e){var t,i=this.filters.length;for(t=0;t<i;t+=1)this.filters[t].renderFrame(e)},CVEffects.prototype.getEffects=function(e){var t,i=this.filters.length,r=[];for(t=0;t<i;t+=1)this.filters[t].type===e&&r.push(this.filters[t]);return r},CVMaskElement.prototype.renderFrame=function(){if(this.hasMasks){var e,t,i,r,n=this.element.finalTransform.mat,a=this.element.canvasContext,o=this.masksProperties.length;for(a.beginPath(),e=0;e<o;e+=1)if("n"!==this.masksProperties[e].mode){var s;this.masksProperties[e].inv&&(a.moveTo(0,0),a.lineTo(this.element.globalData.compSize.w,0),a.lineTo(this.element.globalData.compSize.w,this.element.globalData.compSize.h),a.lineTo(0,this.element.globalData.compSize.h),a.lineTo(0,0)),r=this.viewData[e].v,t=n.applyToPointArray(r.v[0][0],r.v[0][1],0),a.moveTo(t[0],t[1]);var l=r._length;for(s=1;s<l;s+=1)i=n.applyToTriplePoints(r.o[s-1],r.i[s],r.v[s]),a.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5]);i=n.applyToTriplePoints(r.o[s-1],r.i[0],r.v[0]),a.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5])}this.element.globalData.renderer.save(!0),a.clip()}},CVMaskElement.prototype.getMaskProperty=MaskElement.prototype.getMaskProperty,CVMaskElement.prototype.destroy=function(){this.element=null};var operationsMap={1:"source-in",2:"source-out",3:"source-in",4:"source-out"};function CVShapeData(e,t,i,r){this.styledShapes=[],this.tr=[0,0,0,0,0,0];var n,a=4;"rc"===t.ty?a=5:"el"===t.ty?a=6:"sr"===t.ty&&(a=7),this.sh=ShapePropertyFactory.getShapeProp(e,t,a,e);var o,s=i.length;for(n=0;n<s;n+=1)i[n].closed||(o={transforms:r.addTransformSequence(i[n].transforms),trNodes:[]},this.styledShapes.push(o),i[n].elements.push(o))}function CVShapeElement(e,t,i){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.itemsData=[],this.prevViewData=[],this.shapeModifiers=[],this.processedElements=[],this.transformsManager=new ShapeTransformManager,this.initElement(e,t,i)}function CVTextElement(e,t,i){this.textSpans=[],this.yOffset=0,this.fillColorAnim=!1,this.strokeColorAnim=!1,this.strokeWidthAnim=!1,this.stroke=!1,this.fill=!1,this.justifyOffset=0,this.currentRender=null,this.renderType="canvas",this.values={fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0)",sWidth:0,fValue:""},this.initElement(e,t,i)}function CVImageElement(e,t,i){this.assetData=t.getAssetData(e.refId),this.img=t.imageLoader.getAsset(this.assetData),this.initElement(e,t,i)}function CVSolidElement(e,t,i){this.initElement(e,t,i)}function CanvasRendererBase(){}function CanvasContext(){this.opacity=-1,this.transform=createTypedArray("float32",16),this.fillStyle="",this.strokeStyle="",this.lineWidth="",this.lineCap="",this.lineJoin="",this.miterLimit="",this.id=Math.random()}function CVContextData(){var e;for(this.stack=[],this.cArrPos=0,this.cTr=new Matrix,e=0;e<15;e+=1){var t=new CanvasContext;this.stack[e]=t}this._length=15,this.nativeContext=null,this.transformMat=new Matrix,this.currentOpacity=1,this.currentFillStyle="",this.appliedFillStyle="",this.currentStrokeStyle="",this.appliedStrokeStyle="",this.currentLineWidth="",this.appliedLineWidth="",this.currentLineCap="",this.appliedLineCap="",this.currentLineJoin="",this.appliedLineJoin="",this.appliedMiterLimit="",this.currentMiterLimit=""}function CVCompElement(e,t,i){this.completeLayers=!1,this.layers=e.layers,this.pendingElements=[],this.elements=createSizedArray(this.layers.length),this.initElement(e,t,i),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,t.frameRate,this):{_placeholder:!0}}function CanvasRenderer(e,t){this.animationItem=e,this.renderConfig={clearCanvas:!t||void 0===t.clearCanvas||t.clearCanvas,context:t&&t.context||null,progressiveLoad:t&&t.progressiveLoad||!1,preserveAspectRatio:t&&t.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:t&&t.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:t&&t.contentVisibility||"visible",className:t&&t.className||"",id:t&&t.id||"",runExpressions:!t||void 0===t.runExpressions||t.runExpressions},this.renderConfig.dpr=t&&t.dpr||1,this.animationItem.wrapper&&(this.renderConfig.dpr=t&&t.dpr||window.devicePixelRatio||1),this.renderedFrame=-1,this.globalData={frameNum:-1,_mdf:!1,renderConfig:this.renderConfig,currentGlobalAlpha:-1},this.contextData=new CVContextData,this.elements=[],this.pendingElements=[],this.transformMat=new Matrix,this.completeLayers=!1,this.rendererType="canvas",this.renderConfig.clearCanvas&&(this.ctxTransform=this.contextData.transform.bind(this.contextData),this.ctxOpacity=this.contextData.opacity.bind(this.contextData),this.ctxFillStyle=this.contextData.fillStyle.bind(this.contextData),this.ctxStrokeStyle=this.contextData.strokeStyle.bind(this.contextData),this.ctxLineWidth=this.contextData.lineWidth.bind(this.contextData),this.ctxLineCap=this.contextData.lineCap.bind(this.contextData),this.ctxLineJoin=this.contextData.lineJoin.bind(this.contextData),this.ctxMiterLimit=this.contextData.miterLimit.bind(this.contextData),this.ctxFill=this.contextData.fill.bind(this.contextData),this.ctxFillRect=this.contextData.fillRect.bind(this.contextData),this.ctxStroke=this.contextData.stroke.bind(this.contextData),this.save=this.contextData.save.bind(this.contextData))}function HBaseElement(){}function HSolidElement(e,t,i){this.initElement(e,t,i)}function HShapeElement(e,t,i){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.shapesContainer=createNS("g"),this.initElement(e,t,i),this.prevViewData=[],this.currentBBox={x:999999,y:-999999,h:0,w:0}}function HTextElement(e,t,i){this.textSpans=[],this.textPaths=[],this.currentBBox={x:999999,y:-999999,h:0,w:0},this.renderType="svg",this.isMasked=!1,this.initElement(e,t,i)}function HCameraElement(e,t,i){this.initFrame(),this.initBaseData(e,t,i),this.initHierarchy();var r=PropertyFactory.getProp;if(this.pe=r(this,e.pe,0,0,this),e.ks.p.s?(this.px=r(this,e.ks.p.x,1,0,this),this.py=r(this,e.ks.p.y,1,0,this),this.pz=r(this,e.ks.p.z,1,0,this)):this.p=r(this,e.ks.p,1,0,this),e.ks.a&&(this.a=r(this,e.ks.a,1,0,this)),e.ks.or.k.length&&e.ks.or.k[0].to){var n,a=e.ks.or.k.length;for(n=0;n<a;n+=1)e.ks.or.k[n].to=null,e.ks.or.k[n].ti=null}this.or=r(this,e.ks.or,1,degToRads,this),this.or.sh=!0,this.rx=r(this,e.ks.rx,0,degToRads,this),this.ry=r(this,e.ks.ry,0,degToRads,this),this.rz=r(this,e.ks.rz,0,degToRads,this),this.mat=new Matrix,this._prevMat=new Matrix,this._isFirstFrame=!0,this.finalTransform={mProp:this}}function HImageElement(e,t,i){this.assetData=t.getAssetData(e.refId),this.initElement(e,t,i)}function HybridRendererBase(e,t){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:t&&t.className||"",imagePreserveAspectRatio:t&&t.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(t&&!1===t.hideOnTransparent),filterSize:{width:t&&t.filterSize&&t.filterSize.width||"400%",height:t&&t.filterSize&&t.filterSize.height||"400%",x:t&&t.filterSize&&t.filterSize.x||"-100%",y:t&&t.filterSize&&t.filterSize.y||"-100%"}},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}function HCompElement(e,t,i){this.layers=e.layers,this.supports3d=!e.hasMask,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(e,t,i),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,t.frameRate,this):{_placeholder:!0}}function HybridRenderer(e,t){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:t&&t.className||"",imagePreserveAspectRatio:t&&t.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(t&&!1===t.hideOnTransparent),filterSize:{width:t&&t.filterSize&&t.filterSize.width||"400%",height:t&&t.filterSize&&t.filterSize.height||"400%",x:t&&t.filterSize&&t.filterSize.x||"-100%",y:t&&t.filterSize&&t.filterSize.y||"-100%"},runExpressions:!t||void 0===t.runExpressions||t.runExpressions},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}CVBaseElement.prototype={createElements:function(){},initRendererElement:function(){},createContainerElements:function(){if(this.data.tt>=1){this.buffers=[];var e=this.globalData.canvasContext,t=assetLoader.createCanvas(e.canvas.width,e.canvas.height);this.buffers.push(t);var i=assetLoader.createCanvas(e.canvas.width,e.canvas.height);this.buffers.push(i),this.data.tt>=3&&!document._isProxy&&assetLoader.loadLumaCanvas()}this.canvasContext=this.globalData.canvasContext,this.transformCanvas=this.globalData.transformCanvas,this.renderableEffectsManager=new CVEffects(this),this.searchEffectTransforms()},createContent:function(){},setBlendMode:function(){var e=this.globalData;if(e.blendMode!==this.data.bm){e.blendMode=this.data.bm;var t=getBlendMode(this.data.bm);e.canvasContext.globalCompositeOperation=t}},createRenderableComponents:function(){this.maskManager=new CVMaskElement(this.data,this),this.transformEffects=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT)},hideElement:function(){this.hidden||this.isInRange&&!this.isTransparent||(this.hidden=!0)},showElement:function(){this.isInRange&&!this.isTransparent&&(this.hidden=!1,this._isFirstFrame=!0,this.maskManager._isFirstFrame=!0)},clearCanvas:function(e){e.clearRect(this.transformCanvas.tx,this.transformCanvas.ty,this.transformCanvas.w*this.transformCanvas.sx,this.transformCanvas.h*this.transformCanvas.sy)},prepareLayer:function(){if(this.data.tt>=1){var e=this.buffers[0].getContext("2d");this.clearCanvas(e),e.drawImage(this.canvasContext.canvas,0,0),this.currentTransform=this.canvasContext.getTransform(),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform)}},exitLayer:function(){if(this.data.tt>=1){var e=this.buffers[1],t=e.getContext("2d");if(this.clearCanvas(t),t.drawImage(this.canvasContext.canvas,0,0),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform),this.comp.getElementById("tp"in this.data?this.data.tp:this.data.ind-1).renderFrame(!0),this.canvasContext.setTransform(1,0,0,1,0,0),this.data.tt>=3&&!document._isProxy){var i=assetLoader.getLumaCanvas(this.canvasContext.canvas);i.getContext("2d").drawImage(this.canvasContext.canvas,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.drawImage(i,0,0)}this.canvasContext.globalCompositeOperation=operationsMap[this.data.tt],this.canvasContext.drawImage(e,0,0),this.canvasContext.globalCompositeOperation="destination-over",this.canvasContext.drawImage(this.buffers[0],0,0),this.canvasContext.setTransform(this.currentTransform),this.canvasContext.globalCompositeOperation="source-over"}},renderFrame:function(e){if(!this.hidden&&!this.data.hd&&(1!==this.data.td||e)){this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.setBlendMode();var t=0===this.data.ty;this.prepareLayer(),this.globalData.renderer.save(t),this.globalData.renderer.ctxTransform(this.finalTransform.localMat.props),this.globalData.renderer.ctxOpacity(this.finalTransform.localOpacity),this.renderInnerContent(),this.globalData.renderer.restore(t),this.exitLayer(),this.maskManager.hasMasks&&this.globalData.renderer.restore(!0),this._isFirstFrame&&(this._isFirstFrame=!1)}},destroy:function(){this.canvasContext=null,this.data=null,this.globalData=null,this.maskManager.destroy()},mHelper:new Matrix},CVBaseElement.prototype.hide=CVBaseElement.prototype.hideElement,CVBaseElement.prototype.show=CVBaseElement.prototype.showElement,CVShapeData.prototype.setAsAnimated=SVGShapeData.prototype.setAsAnimated,extendPrototype([BaseElement,TransformElement,CVBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableElement],CVShapeElement),CVShapeElement.prototype.initElement=RenderableDOMElement.prototype.initElement,CVShapeElement.prototype.transformHelper={opacity:1,_opMdf:!1},CVShapeElement.prototype.dashResetter=[],CVShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[])},CVShapeElement.prototype.createStyleElement=function(e,t){var i={data:e,type:e.ty,preTransforms:this.transformsManager.addTransformSequence(t),transforms:[],elements:[],closed:!0===e.hd},r={};if("fl"===e.ty||"st"===e.ty?(r.c=PropertyFactory.getProp(this,e.c,1,255,this),r.c.k||(i.co="rgb("+bmFloor(r.c.v[0])+","+bmFloor(r.c.v[1])+","+bmFloor(r.c.v[2])+")")):"gf"!==e.ty&&"gs"!==e.ty||(r.s=PropertyFactory.getProp(this,e.s,1,null,this),r.e=PropertyFactory.getProp(this,e.e,1,null,this),r.h=PropertyFactory.getProp(this,e.h||{k:0},0,.01,this),r.a=PropertyFactory.getProp(this,e.a||{k:0},0,degToRads,this),r.g=new GradientProperty(this,e.g,this)),r.o=PropertyFactory.getProp(this,e.o,0,.01,this),"st"===e.ty||"gs"===e.ty){if(i.lc=lineCapEnum[e.lc||2],i.lj=lineJoinEnum[e.lj||2],1==e.lj&&(i.ml=e.ml),r.w=PropertyFactory.getProp(this,e.w,0,null,this),r.w.k||(i.wi=r.w.v),e.d){var n=new DashProperty(this,e.d,"canvas",this);r.d=n,r.d.k||(i.da=r.d.dashArray,i.do=r.d.dashoffset[0])}}else i.r=2===e.r?"evenodd":"nonzero";return this.stylesList.push(i),r.style=i,r},CVShapeElement.prototype.createGroupElement=function(){return{it:[],prevViewData:[]}},CVShapeElement.prototype.createTransformElement=function(e){return{transform:{opacity:1,_opMdf:!1,key:this.transformsManager.getNewKey(),op:PropertyFactory.getProp(this,e.o,0,.01,this),mProps:TransformPropertyFactory.getTransformProperty(this,e,this)}}},CVShapeElement.prototype.createShapeElement=function(e){var t=new CVShapeData(this,e,this.stylesList,this.transformsManager);return this.shapes.push(t),this.addShapeToModifiers(t),t},CVShapeElement.prototype.reloadShapes=function(){var e;this._isFirstFrame=!0;var t=this.itemsData.length;for(e=0;e<t;e+=1)this.prevViewData[e]=this.itemsData[e];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[]),t=this.dynamicProperties.length,e=0;e<t;e+=1)this.dynamicProperties[e].getValue();this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame)},CVShapeElement.prototype.addTransformToStyleList=function(e){var t,i=this.stylesList.length;for(t=0;t<i;t+=1)this.stylesList[t].closed||this.stylesList[t].transforms.push(e)},CVShapeElement.prototype.removeTransformFromStyleList=function(){var e,t=this.stylesList.length;for(e=0;e<t;e+=1)this.stylesList[e].closed||this.stylesList[e].transforms.pop()},CVShapeElement.prototype.closeStyles=function(e){var t,i=e.length;for(t=0;t<i;t+=1)e[t].closed=!0},CVShapeElement.prototype.searchShapes=function(e,t,i,r,n){var a,o,s,l,c,h,u=e.length-1,d=[],p=[],f=[].concat(n);for(a=u;a>=0;a-=1){if((l=this.searchProcessedElement(e[a]))?t[a]=i[l-1]:e[a]._shouldRender=r,"fl"===e[a].ty||"st"===e[a].ty||"gf"===e[a].ty||"gs"===e[a].ty)l?t[a].style.closed=!1:t[a]=this.createStyleElement(e[a],f),d.push(t[a].style);else if("gr"===e[a].ty){if(l)for(s=t[a].it.length,o=0;o<s;o+=1)t[a].prevViewData[o]=t[a].it[o];else t[a]=this.createGroupElement(e[a]);this.searchShapes(e[a].it,t[a].it,t[a].prevViewData,r,f)}else"tr"===e[a].ty?(l||(h=this.createTransformElement(e[a]),t[a]=h),f.push(t[a]),this.addTransformToStyleList(t[a])):"sh"===e[a].ty||"rc"===e[a].ty||"el"===e[a].ty||"sr"===e[a].ty?l||(t[a]=this.createShapeElement(e[a])):"tm"===e[a].ty||"rd"===e[a].ty||"pb"===e[a].ty||"zz"===e[a].ty||"op"===e[a].ty?(l?(c=t[a]).closed=!1:((c=ShapeModifiers.getModifier(e[a].ty)).init(this,e[a]),t[a]=c,this.shapeModifiers.push(c)),p.push(c)):"rp"===e[a].ty&&(l?(c=t[a]).closed=!0:(c=ShapeModifiers.getModifier(e[a].ty),t[a]=c,c.init(this,e,a,t),this.shapeModifiers.push(c),r=!1),p.push(c));this.addProcessedElement(e[a],a+1)}for(this.removeTransformFromStyleList(),this.closeStyles(d),u=p.length,a=0;a<u;a+=1)p[a].closed=!0},CVShapeElement.prototype.renderInnerContent=function(){this.transformHelper.opacity=1,this.transformHelper._opMdf=!1,this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame),this.renderShape(this.transformHelper,this.shapesData,this.itemsData,!0)},CVShapeElement.prototype.renderShapeTransform=function(e,t){(e._opMdf||t.op._mdf||this._isFirstFrame)&&(t.opacity=e.opacity,t.opacity*=t.op.v,t._opMdf=!0)},CVShapeElement.prototype.drawLayer=function(){var e,t,i,r,n,a,o,s,l,c=this.stylesList.length,h=this.globalData.renderer,u=this.globalData.canvasContext;for(e=0;e<c;e+=1)if(("st"!==(s=(l=this.stylesList[e]).type)&&"gs"!==s||0!==l.wi)&&l.data._shouldRender&&0!==l.coOp&&0!==this.globalData.currentGlobalAlpha){for(h.save(),a=l.elements,"st"===s||"gs"===s?(h.ctxStrokeStyle("st"===s?l.co:l.grd),h.ctxLineWidth(l.wi),h.ctxLineCap(l.lc),h.ctxLineJoin(l.lj),h.ctxMiterLimit(l.ml||0)):h.ctxFillStyle("fl"===s?l.co:l.grd),h.ctxOpacity(l.coOp),"st"!==s&&"gs"!==s&&u.beginPath(),h.ctxTransform(l.preTransforms.finalTransform.props),i=a.length,t=0;t<i;t+=1){for("st"!==s&&"gs"!==s||(u.beginPath(),l.da&&(u.setLineDash(l.da),u.lineDashOffset=l.do)),n=(o=a[t].trNodes).length,r=0;r<n;r+=1)"m"===o[r].t?u.moveTo(o[r].p[0],o[r].p[1]):"c"===o[r].t?u.bezierCurveTo(o[r].pts[0],o[r].pts[1],o[r].pts[2],o[r].pts[3],o[r].pts[4],o[r].pts[5]):u.closePath();"st"!==s&&"gs"!==s||(h.ctxStroke(),l.da&&u.setLineDash(this.dashResetter))}"st"!==s&&"gs"!==s&&this.globalData.renderer.ctxFill(l.r),h.restore()}},CVShapeElement.prototype.renderShape=function(e,t,i,r){var n,a;for(a=e,n=t.length-1;n>=0;n-=1)"tr"===t[n].ty?(a=i[n].transform,this.renderShapeTransform(e,a)):"sh"===t[n].ty||"el"===t[n].ty||"rc"===t[n].ty||"sr"===t[n].ty?this.renderPath(t[n],i[n]):"fl"===t[n].ty?this.renderFill(t[n],i[n],a):"st"===t[n].ty?this.renderStroke(t[n],i[n],a):"gf"===t[n].ty||"gs"===t[n].ty?this.renderGradientFill(t[n],i[n],a):"gr"===t[n].ty?this.renderShape(a,t[n].it,i[n].it):t[n].ty;r&&this.drawLayer()},CVShapeElement.prototype.renderStyledShape=function(e,t){if(this._isFirstFrame||t._mdf||e.transforms._mdf){var i,r,n,a=e.trNodes,o=t.paths,s=o._length;a.length=0;var l=e.transforms.finalTransform;for(n=0;n<s;n+=1){var c=o.shapes[n];if(c&&c.v){for(r=c._length,i=1;i<r;i+=1)1===i&&a.push({t:"m",p:l.applyToPointArray(c.v[0][0],c.v[0][1],0)}),a.push({t:"c",pts:l.applyToTriplePoints(c.o[i-1],c.i[i],c.v[i])});1===r&&a.push({t:"m",p:l.applyToPointArray(c.v[0][0],c.v[0][1],0)}),c.c&&r&&(a.push({t:"c",pts:l.applyToTriplePoints(c.o[i-1],c.i[0],c.v[0])}),a.push({t:"z"}))}}e.trNodes=a}},CVShapeElement.prototype.renderPath=function(e,t){if(!0!==e.hd&&e._shouldRender){var i,r=t.styledShapes.length;for(i=0;i<r;i+=1)this.renderStyledShape(t.styledShapes[i],t.sh)}},CVShapeElement.prototype.renderFill=function(e,t,i){var r=t.style;(t.c._mdf||this._isFirstFrame)&&(r.co="rgb("+bmFloor(t.c.v[0])+","+bmFloor(t.c.v[1])+","+bmFloor(t.c.v[2])+")"),(t.o._mdf||i._opMdf||this._isFirstFrame)&&(r.coOp=t.o.v*i.opacity)},CVShapeElement.prototype.renderGradientFill=function(e,t,i){var r,n=t.style;if(!n.grd||t.g._mdf||t.s._mdf||t.e._mdf||1!==e.t&&(t.h._mdf||t.a._mdf)){var a,o=this.globalData.canvasContext,s=t.s.v,l=t.e.v;if(1===e.t)r=o.createLinearGradient(s[0],s[1],l[0],l[1]);else{var c=Math.sqrt(Math.pow(s[0]-l[0],2)+Math.pow(s[1]-l[1],2)),h=Math.atan2(l[1]-s[1],l[0]-s[0]),u=t.h.v;u>=1?u=.99:u<=-1&&(u=-.99);var d=c*u,p=Math.cos(h+t.a.v)*d+s[0],f=Math.sin(h+t.a.v)*d+s[1];r=o.createRadialGradient(p,f,0,s[0],s[1],c)}var m=e.g.p,g=t.g.c,_=1;for(a=0;a<m;a+=1)t.g._hasOpacity&&t.g._collapsable&&(_=t.g.o[2*a+1]),r.addColorStop(g[4*a]/100,"rgba("+g[4*a+1]+","+g[4*a+2]+","+g[4*a+3]+","+_+")");n.grd=r}n.coOp=t.o.v*i.opacity},CVShapeElement.prototype.renderStroke=function(e,t,i){var r=t.style,n=t.d;n&&(n._mdf||this._isFirstFrame)&&(r.da=n.dashArray,r.do=n.dashoffset[0]),(t.c._mdf||this._isFirstFrame)&&(r.co="rgb("+bmFloor(t.c.v[0])+","+bmFloor(t.c.v[1])+","+bmFloor(t.c.v[2])+")"),(t.o._mdf||i._opMdf||this._isFirstFrame)&&(r.coOp=t.o.v*i.opacity),(t.w._mdf||this._isFirstFrame)&&(r.wi=t.w.v)},CVShapeElement.prototype.destroy=function(){this.shapesData=null,this.globalData=null,this.canvasContext=null,this.stylesList.length=0,this.itemsData.length=0},extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement,ITextElement],CVTextElement),CVTextElement.prototype.tHelper=createTag("canvas").getContext("2d"),CVTextElement.prototype.buildNewText=function(){var e=this.textProperty.currentData;this.renderedLetters=createSizedArray(e.l?e.l.length:0);var t=!1;e.fc?(t=!0,this.values.fill=this.buildColor(e.fc)):this.values.fill="rgba(0,0,0,0)",this.fill=t;var i=!1;e.sc&&(i=!0,this.values.stroke=this.buildColor(e.sc),this.values.sWidth=e.sw);var r,n,a,o,s,l,c,h,u,d,p,f,m=this.globalData.fontManager.getFontByName(e.f),g=e.l,_=this.mHelper;this.stroke=i,this.values.fValue=e.finalSize+"px "+this.globalData.fontManager.getFontByName(e.f).fFamily,n=e.finalText.length;var y=this.data.singleShape,v=.001*e.tr*e.finalSize,x=0,b=0,w=!0,S=0;for(r=0;r<n;r+=1){o=(a=this.globalData.fontManager.getCharData(e.finalText[r],m.fStyle,this.globalData.fontManager.getFontByName(e.f).fFamily))&&a.data||{},_.reset(),y&&g[r].n&&(x=-v,b+=e.yOffset,b+=w?1:0,w=!1),u=(c=o.shapes?o.shapes[0].it:[]).length,_.scale(e.finalSize/100,e.finalSize/100),y&&this.applyTextPropertiesToMatrix(e,_,g[r].line,x,b),p=createSizedArray(u-1);var T=0;for(h=0;h<u;h+=1)if("sh"===c[h].ty){for(l=c[h].ks.k.i.length,d=c[h].ks.k,f=[],s=1;s<l;s+=1)1===s&&f.push(_.applyToX(d.v[0][0],d.v[0][1],0),_.applyToY(d.v[0][0],d.v[0][1],0)),f.push(_.applyToX(d.o[s-1][0],d.o[s-1][1],0),_.applyToY(d.o[s-1][0],d.o[s-1][1],0),_.applyToX(d.i[s][0],d.i[s][1],0),_.applyToY(d.i[s][0],d.i[s][1],0),_.applyToX(d.v[s][0],d.v[s][1],0),_.applyToY(d.v[s][0],d.v[s][1],0));f.push(_.applyToX(d.o[s-1][0],d.o[s-1][1],0),_.applyToY(d.o[s-1][0],d.o[s-1][1],0),_.applyToX(d.i[0][0],d.i[0][1],0),_.applyToY(d.i[0][0],d.i[0][1],0),_.applyToX(d.v[0][0],d.v[0][1],0),_.applyToY(d.v[0][0],d.v[0][1],0)),p[T]=f,T+=1}y&&(x+=g[r].l,x+=v),this.textSpans[S]?this.textSpans[S].elem=p:this.textSpans[S]={elem:p},S+=1}},CVTextElement.prototype.renderInnerContent=function(){var e,t,i,r,n,a;this.validateText(),this.canvasContext.font=this.values.fValue,this.globalData.renderer.ctxLineCap("butt"),this.globalData.renderer.ctxLineJoin("miter"),this.globalData.renderer.ctxMiterLimit(4),this.data.singleShape||this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag);var o,s=this.textAnimator.renderedLetters,l=this.textProperty.currentData.l;t=l.length;var c,h,u=null,d=null,p=null,f=this.globalData.renderer;for(e=0;e<t;e+=1)if(!l[e].n){if((o=s[e])&&(f.save(),f.ctxTransform(o.p),f.ctxOpacity(o.o)),this.fill){for(o&&o.fc?u!==o.fc&&(f.ctxFillStyle(o.fc),u=o.fc):u!==this.values.fill&&(u=this.values.fill,f.ctxFillStyle(this.values.fill)),r=(c=this.textSpans[e].elem).length,this.globalData.canvasContext.beginPath(),i=0;i<r;i+=1)for(a=(h=c[i]).length,this.globalData.canvasContext.moveTo(h[0],h[1]),n=2;n<a;n+=6)this.globalData.canvasContext.bezierCurveTo(h[n],h[n+1],h[n+2],h[n+3],h[n+4],h[n+5]);this.globalData.canvasContext.closePath(),f.ctxFill()}if(this.stroke){for(o&&o.sw?p!==o.sw&&(p=o.sw,f.ctxLineWidth(o.sw)):p!==this.values.sWidth&&(p=this.values.sWidth,f.ctxLineWidth(this.values.sWidth)),o&&o.sc?d!==o.sc&&(d=o.sc,f.ctxStrokeStyle(o.sc)):d!==this.values.stroke&&(d=this.values.stroke,f.ctxStrokeStyle(this.values.stroke)),r=(c=this.textSpans[e].elem).length,this.globalData.canvasContext.beginPath(),i=0;i<r;i+=1)for(a=(h=c[i]).length,this.globalData.canvasContext.moveTo(h[0],h[1]),n=2;n<a;n+=6)this.globalData.canvasContext.bezierCurveTo(h[n],h[n+1],h[n+2],h[n+3],h[n+4],h[n+5]);this.globalData.canvasContext.closePath(),f.ctxStroke()}o&&this.globalData.renderer.restore()}},extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVImageElement),CVImageElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVImageElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVImageElement.prototype.createContent=function(){if(this.img.width&&(this.assetData.w!==this.img.width||this.assetData.h!==this.img.height)){var e=createTag("canvas");e.width=this.assetData.w,e.height=this.assetData.h;var t,i,r=e.getContext("2d"),n=this.img.width,a=this.img.height,o=n/a,s=this.assetData.w/this.assetData.h,l=this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio;o>s&&"xMidYMid slice"===l||o<s&&"xMidYMid slice"!==l?t=(i=a)*s:i=(t=n)/s,r.drawImage(this.img,(n-t)/2,(a-i)/2,t,i,0,0,this.assetData.w,this.assetData.h),this.img=e}},CVImageElement.prototype.renderInnerContent=function(){this.canvasContext.drawImage(this.img,0,0)},CVImageElement.prototype.destroy=function(){this.img=null},extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVSolidElement),CVSolidElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVSolidElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVSolidElement.prototype.renderInnerContent=function(){this.globalData.renderer.ctxFillStyle(this.data.sc),this.globalData.renderer.ctxFillRect(0,0,this.data.sw,this.data.sh)},extendPrototype([BaseRenderer],CanvasRendererBase),CanvasRendererBase.prototype.createShape=function(e){return new CVShapeElement(e,this.globalData,this)},CanvasRendererBase.prototype.createText=function(e){return new CVTextElement(e,this.globalData,this)},CanvasRendererBase.prototype.createImage=function(e){return new CVImageElement(e,this.globalData,this)},CanvasRendererBase.prototype.createSolid=function(e){return new CVSolidElement(e,this.globalData,this)},CanvasRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,CanvasRendererBase.prototype.ctxTransform=function(e){1===e[0]&&0===e[1]&&0===e[4]&&1===e[5]&&0===e[12]&&0===e[13]||this.canvasContext.transform(e[0],e[1],e[4],e[5],e[12],e[13])},CanvasRendererBase.prototype.ctxOpacity=function(e){this.canvasContext.globalAlpha*=e<0?0:e},CanvasRendererBase.prototype.ctxFillStyle=function(e){this.canvasContext.fillStyle=e},CanvasRendererBase.prototype.ctxStrokeStyle=function(e){this.canvasContext.strokeStyle=e},CanvasRendererBase.prototype.ctxLineWidth=function(e){this.canvasContext.lineWidth=e},CanvasRendererBase.prototype.ctxLineCap=function(e){this.canvasContext.lineCap=e},CanvasRendererBase.prototype.ctxLineJoin=function(e){this.canvasContext.lineJoin=e},CanvasRendererBase.prototype.ctxMiterLimit=function(e){this.canvasContext.miterLimit=e},CanvasRendererBase.prototype.ctxFill=function(e){this.canvasContext.fill(e)},CanvasRendererBase.prototype.ctxFillRect=function(e,t,i,r){this.canvasContext.fillRect(e,t,i,r)},CanvasRendererBase.prototype.ctxStroke=function(){this.canvasContext.stroke()},CanvasRendererBase.prototype.reset=function(){this.renderConfig.clearCanvas?this.contextData.reset():this.canvasContext.restore()},CanvasRendererBase.prototype.save=function(){this.canvasContext.save()},CanvasRendererBase.prototype.restore=function(e){this.renderConfig.clearCanvas?(e&&(this.globalData.blendMode="source-over"),this.contextData.restore(e)):this.canvasContext.restore()},CanvasRendererBase.prototype.configAnimation=function(e){if(this.animationItem.wrapper){this.animationItem.container=createTag("canvas");var t=this.animationItem.container.style;t.width="100%",t.height="100%";var i="0px 0px 0px";t.transformOrigin=i,t.mozTransformOrigin=i,t.webkitTransformOrigin=i,t["-webkit-transform"]=i,t.contentVisibility=this.renderConfig.contentVisibility,this.animationItem.wrapper.appendChild(this.animationItem.container),this.canvasContext=this.animationItem.container.getContext("2d"),this.renderConfig.className&&this.animationItem.container.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.animationItem.container.setAttribute("id",this.renderConfig.id)}else this.canvasContext=this.renderConfig.context;this.contextData.setContext(this.canvasContext),this.data=e,this.layers=e.layers,this.transformCanvas={w:e.w,h:e.h,sx:0,sy:0,tx:0,ty:0},this.setupGlobalData(e,document.body),this.globalData.canvasContext=this.canvasContext,this.globalData.renderer=this,this.globalData.isDashed=!1,this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.globalData.transformCanvas=this.transformCanvas,this.elements=createSizedArray(e.layers.length),this.updateContainerSize()},CanvasRendererBase.prototype.updateContainerSize=function(e,t){var i,r,n,a;if(this.reset(),e?(i=e,r=t,this.canvasContext.canvas.width=i,this.canvasContext.canvas.height=r):(this.animationItem.wrapper&&this.animationItem.container?(i=this.animationItem.wrapper.offsetWidth,r=this.animationItem.wrapper.offsetHeight):(i=this.canvasContext.canvas.width,r=this.canvasContext.canvas.height),this.canvasContext.canvas.width=i*this.renderConfig.dpr,this.canvasContext.canvas.height=r*this.renderConfig.dpr),-1!==this.renderConfig.preserveAspectRatio.indexOf("meet")||-1!==this.renderConfig.preserveAspectRatio.indexOf("slice")){var o=this.renderConfig.preserveAspectRatio.split(" "),s=o[1]||"meet",l=o[0]||"xMidYMid",c=l.substr(0,4),h=l.substr(4);n=i/r,(a=this.transformCanvas.w/this.transformCanvas.h)>n&&"meet"===s||a<n&&"slice"===s?(this.transformCanvas.sx=i/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=i/(this.transformCanvas.w/this.renderConfig.dpr)):(this.transformCanvas.sx=r/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.sy=r/(this.transformCanvas.h/this.renderConfig.dpr)),this.transformCanvas.tx="xMid"===c&&(a<n&&"meet"===s||a>n&&"slice"===s)?(i-this.transformCanvas.w*(r/this.transformCanvas.h))/2*this.renderConfig.dpr:"xMax"===c&&(a<n&&"meet"===s||a>n&&"slice"===s)?(i-this.transformCanvas.w*(r/this.transformCanvas.h))*this.renderConfig.dpr:0,this.transformCanvas.ty="YMid"===h&&(a>n&&"meet"===s||a<n&&"slice"===s)?(r-this.transformCanvas.h*(i/this.transformCanvas.w))/2*this.renderConfig.dpr:"YMax"===h&&(a>n&&"meet"===s||a<n&&"slice"===s)?(r-this.transformCanvas.h*(i/this.transformCanvas.w))*this.renderConfig.dpr:0}else"none"===this.renderConfig.preserveAspectRatio?(this.transformCanvas.sx=i/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=r/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.tx=0,this.transformCanvas.ty=0):(this.transformCanvas.sx=this.renderConfig.dpr,this.transformCanvas.sy=this.renderConfig.dpr,this.transformCanvas.tx=0,this.transformCanvas.ty=0);this.transformCanvas.props=[this.transformCanvas.sx,0,0,0,0,this.transformCanvas.sy,0,0,0,0,1,0,this.transformCanvas.tx,this.transformCanvas.ty,0,1],this.ctxTransform(this.transformCanvas.props),this.canvasContext.beginPath(),this.canvasContext.rect(0,0,this.transformCanvas.w,this.transformCanvas.h),this.canvasContext.closePath(),this.canvasContext.clip(),this.renderFrame(this.renderedFrame,!0)},CanvasRendererBase.prototype.destroy=function(){var e;for(this.renderConfig.clearCanvas&&this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),e=(this.layers?this.layers.length:0)-1;e>=0;e-=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.globalData.canvasContext=null,this.animationItem.container=null,this.destroyed=!0},CanvasRendererBase.prototype.renderFrame=function(e,t){if((this.renderedFrame!==e||!0!==this.renderConfig.clearCanvas||t)&&!this.destroyed&&-1!==e){var i;this.renderedFrame=e,this.globalData.frameNum=e-this.animationItem._isFirstFrame,this.globalData.frameId+=1,this.globalData._mdf=!this.renderConfig.clearCanvas||t,this.globalData.projectInterface.currentFrame=e;var r=this.layers.length;for(this.completeLayers||this.checkLayers(e),i=r-1;i>=0;i-=1)(this.completeLayers||this.elements[i])&&this.elements[i].prepareFrame(e-this.layers[i].st);if(this.globalData._mdf){for(!0===this.renderConfig.clearCanvas?this.canvasContext.clearRect(0,0,this.transformCanvas.w,this.transformCanvas.h):this.save(),i=r-1;i>=0;i-=1)(this.completeLayers||this.elements[i])&&this.elements[i].renderFrame();!0!==this.renderConfig.clearCanvas&&this.restore()}}},CanvasRendererBase.prototype.buildItem=function(e){var t=this.elements;if(!t[e]&&99!==this.layers[e].ty){var i=this.createItem(this.layers[e],this,this.globalData);t[e]=i,i.initExpressions()}},CanvasRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;)this.pendingElements.pop().checkParenting()},CanvasRendererBase.prototype.hide=function(){this.animationItem.container.style.display="none"},CanvasRendererBase.prototype.show=function(){this.animationItem.container.style.display="block"},CVContextData.prototype.duplicate=function(){var e=2*this._length,t=0;for(t=this._length;t<e;t+=1)this.stack[t]=new CanvasContext;this._length=e},CVContextData.prototype.reset=function(){this.cArrPos=0,this.cTr.reset(),this.stack[this.cArrPos].opacity=1},CVContextData.prototype.restore=function(e){this.cArrPos-=1;var t,i=this.stack[this.cArrPos],r=i.transform,n=this.cTr.props;for(t=0;t<16;t+=1)n[t]=r[t];if(e){this.nativeContext.restore();var a=this.stack[this.cArrPos+1];this.appliedFillStyle=a.fillStyle,this.appliedStrokeStyle=a.strokeStyle,this.appliedLineWidth=a.lineWidth,this.appliedLineCap=a.lineCap,this.appliedLineJoin=a.lineJoin,this.appliedMiterLimit=a.miterLimit}this.nativeContext.setTransform(r[0],r[1],r[4],r[5],r[12],r[13]),(e||-1!==i.opacity&&this.currentOpacity!==i.opacity)&&(this.nativeContext.globalAlpha=i.opacity,this.currentOpacity=i.opacity),this.currentFillStyle=i.fillStyle,this.currentStrokeStyle=i.strokeStyle,this.currentLineWidth=i.lineWidth,this.currentLineCap=i.lineCap,this.currentLineJoin=i.lineJoin,this.currentMiterLimit=i.miterLimit},CVContextData.prototype.save=function(e){e&&this.nativeContext.save();var t=this.cTr.props;this._length<=this.cArrPos&&this.duplicate();var i,r=this.stack[this.cArrPos];for(i=0;i<16;i+=1)r.transform[i]=t[i];this.cArrPos+=1;var n=this.stack[this.cArrPos];n.opacity=r.opacity,n.fillStyle=r.fillStyle,n.strokeStyle=r.strokeStyle,n.lineWidth=r.lineWidth,n.lineCap=r.lineCap,n.lineJoin=r.lineJoin,n.miterLimit=r.miterLimit},CVContextData.prototype.setOpacity=function(e){this.stack[this.cArrPos].opacity=e},CVContextData.prototype.setContext=function(e){this.nativeContext=e},CVContextData.prototype.fillStyle=function(e){this.stack[this.cArrPos].fillStyle!==e&&(this.currentFillStyle=e,this.stack[this.cArrPos].fillStyle=e)},CVContextData.prototype.strokeStyle=function(e){this.stack[this.cArrPos].strokeStyle!==e&&(this.currentStrokeStyle=e,this.stack[this.cArrPos].strokeStyle=e)},CVContextData.prototype.lineWidth=function(e){this.stack[this.cArrPos].lineWidth!==e&&(this.currentLineWidth=e,this.stack[this.cArrPos].lineWidth=e)},CVContextData.prototype.lineCap=function(e){this.stack[this.cArrPos].lineCap!==e&&(this.currentLineCap=e,this.stack[this.cArrPos].lineCap=e)},CVContextData.prototype.lineJoin=function(e){this.stack[this.cArrPos].lineJoin!==e&&(this.currentLineJoin=e,this.stack[this.cArrPos].lineJoin=e)},CVContextData.prototype.miterLimit=function(e){this.stack[this.cArrPos].miterLimit!==e&&(this.currentMiterLimit=e,this.stack[this.cArrPos].miterLimit=e)},CVContextData.prototype.transform=function(e){this.transformMat.cloneFromProps(e);var t=this.cTr;this.transformMat.multiply(t),t.cloneFromProps(this.transformMat.props);var i=t.props;this.nativeContext.setTransform(i[0],i[1],i[4],i[5],i[12],i[13])},CVContextData.prototype.opacity=function(e){var t=this.stack[this.cArrPos].opacity;t*=e<0?0:e,this.stack[this.cArrPos].opacity!==t&&(this.currentOpacity!==e&&(this.nativeContext.globalAlpha=e,this.currentOpacity=e),this.stack[this.cArrPos].opacity=t)},CVContextData.prototype.fill=function(e){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fill(e)},CVContextData.prototype.fillRect=function(e,t,i,r){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fillRect(e,t,i,r)},CVContextData.prototype.stroke=function(){this.appliedStrokeStyle!==this.currentStrokeStyle&&(this.appliedStrokeStyle=this.currentStrokeStyle,this.nativeContext.strokeStyle=this.appliedStrokeStyle),this.appliedLineWidth!==this.currentLineWidth&&(this.appliedLineWidth=this.currentLineWidth,this.nativeContext.lineWidth=this.appliedLineWidth),this.appliedLineCap!==this.currentLineCap&&(this.appliedLineCap=this.currentLineCap,this.nativeContext.lineCap=this.appliedLineCap),this.appliedLineJoin!==this.currentLineJoin&&(this.appliedLineJoin=this.currentLineJoin,this.nativeContext.lineJoin=this.appliedLineJoin),this.appliedMiterLimit!==this.currentMiterLimit&&(this.appliedMiterLimit=this.currentMiterLimit,this.nativeContext.miterLimit=this.appliedMiterLimit),this.nativeContext.stroke()},extendPrototype([CanvasRendererBase,ICompElement,CVBaseElement],CVCompElement),CVCompElement.prototype.renderInnerContent=function(){var e,t=this.canvasContext;for(t.beginPath(),t.moveTo(0,0),t.lineTo(this.data.w,0),t.lineTo(this.data.w,this.data.h),t.lineTo(0,this.data.h),t.lineTo(0,0),t.clip(),e=this.layers.length-1;e>=0;e-=1)(this.completeLayers||this.elements[e])&&this.elements[e].renderFrame()},CVCompElement.prototype.destroy=function(){var e;for(e=this.layers.length-1;e>=0;e-=1)this.elements[e]&&this.elements[e].destroy();this.layers=null,this.elements=null},CVCompElement.prototype.createComp=function(e){return new CVCompElement(e,this.globalData,this)},extendPrototype([CanvasRendererBase],CanvasRenderer),CanvasRenderer.prototype.createComp=function(e){return new CVCompElement(e,this.globalData,this)},HBaseElement.prototype={checkBlendMode:function(){},initRendererElement:function(){this.baseElement=createTag(this.data.tg||"div"),this.data.hasMask?(this.svgElement=createNS("svg"),this.layerElement=createNS("g"),this.maskedElement=this.layerElement,this.svgElement.appendChild(this.layerElement),this.baseElement.appendChild(this.svgElement)):this.layerElement=this.baseElement,styleDiv(this.baseElement)},createContainerElements:function(){this.renderableEffectsManager=new CVEffects(this),this.transformedElement=this.baseElement,this.maskedElement=this.layerElement,this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),0!==this.data.bm&&this.setBlendMode()},renderElement:function(){var e=this.transformedElement?this.transformedElement.style:{};if(this.finalTransform._matMdf){var t=this.finalTransform.mat.toCSS();e.transform=t,e.webkitTransform=t}this.finalTransform._opMdf&&(e.opacity=this.finalTransform.mProp.o.v)},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},destroy:function(){this.layerElement=null,this.transformedElement=null,this.matteElement&&(this.matteElement=null),this.maskManager&&(this.maskManager.destroy(),this.maskManager=null)},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData)},addEffects:function(){},setMatte:function(){}},HBaseElement.prototype.getBaseElement=SVGBaseElement.prototype.getBaseElement,HBaseElement.prototype.destroyBaseElement=HBaseElement.prototype.destroy,HBaseElement.prototype.buildElementParenting=BaseRenderer.prototype.buildElementParenting,extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],HSolidElement),HSolidElement.prototype.createContent=function(){var e;this.data.hasMask?((e=createNS("rect")).setAttribute("width",this.data.sw),e.setAttribute("height",this.data.sh),e.setAttribute("fill",this.data.sc),this.svgElement.setAttribute("width",this.data.sw),this.svgElement.setAttribute("height",this.data.sh)):((e=createTag("div")).style.width=this.data.sw+"px",e.style.height=this.data.sh+"px",e.style.backgroundColor=this.data.sc),this.layerElement.appendChild(e)},extendPrototype([BaseElement,TransformElement,HSolidElement,SVGShapeElement,HBaseElement,HierarchyElement,FrameElement,RenderableElement],HShapeElement),HShapeElement.prototype._renderShapeFrame=HShapeElement.prototype.renderInnerContent,HShapeElement.prototype.createContent=function(){var e;if(this.baseElement.style.fontSize=0,this.data.hasMask)this.layerElement.appendChild(this.shapesContainer),e=this.svgElement;else{e=createNS("svg");var t=this.comp.data?this.comp.data:this.globalData.compSize;e.setAttribute("width",t.w),e.setAttribute("height",t.h),e.appendChild(this.shapesContainer),this.layerElement.appendChild(e)}this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.shapesContainer,0,[],!0),this.filterUniqueShapes(),this.shapeCont=e},HShapeElement.prototype.getTransformedPoint=function(e,t){var i,r=e.length;for(i=0;i<r;i+=1)t=e[i].mProps.v.applyToPointArray(t[0],t[1],0);return t},HShapeElement.prototype.calculateShapeBoundingBox=function(e,t){var i,r,n,a,o,s=e.sh.v,l=e.transformers,c=s._length;if(!(c<=1)){for(i=0;i<c-1;i+=1)r=this.getTransformedPoint(l,s.v[i]),n=this.getTransformedPoint(l,s.o[i]),a=this.getTransformedPoint(l,s.i[i+1]),o=this.getTransformedPoint(l,s.v[i+1]),this.checkBounds(r,n,a,o,t);s.c&&(r=this.getTransformedPoint(l,s.v[i]),n=this.getTransformedPoint(l,s.o[i]),a=this.getTransformedPoint(l,s.i[0]),o=this.getTransformedPoint(l,s.v[0]),this.checkBounds(r,n,a,o,t))}},HShapeElement.prototype.checkBounds=function(e,t,i,r,n){this.getBoundsOfCurve(e,t,i,r);var a=this.shapeBoundingBox;n.x=bmMin(a.left,n.x),n.xMax=bmMax(a.right,n.xMax),n.y=bmMin(a.top,n.y),n.yMax=bmMax(a.bottom,n.yMax)},HShapeElement.prototype.shapeBoundingBox={left:0,right:0,top:0,bottom:0},HShapeElement.prototype.tempBoundingBox={x:0,xMax:0,y:0,yMax:0,width:0,height:0},HShapeElement.prototype.getBoundsOfCurve=function(e,t,i,r){for(var n,a,o,s,l,c,h,u=[[e[0],r[0]],[e[1],r[1]]],d=0;d<2;++d)a=6*e[d]-12*t[d]+6*i[d],n=-3*e[d]+9*t[d]-9*i[d]+3*r[d],o=3*t[d]-3*e[d],a|=0,o|=0,0===(n|=0)&&0===a||(0===n?(s=-o/a)>0&&s<1&&u[d].push(this.calculateF(s,e,t,i,r,d)):(l=a*a-4*o*n)>=0&&((c=(-a+bmSqrt(l))/(2*n))>0&&c<1&&u[d].push(this.calculateF(c,e,t,i,r,d)),(h=(-a-bmSqrt(l))/(2*n))>0&&h<1&&u[d].push(this.calculateF(h,e,t,i,r,d))));this.shapeBoundingBox.left=bmMin.apply(null,u[0]),this.shapeBoundingBox.top=bmMin.apply(null,u[1]),this.shapeBoundingBox.right=bmMax.apply(null,u[0]),this.shapeBoundingBox.bottom=bmMax.apply(null,u[1])},HShapeElement.prototype.calculateF=function(e,t,i,r,n,a){return bmPow(1-e,3)*t[a]+3*bmPow(1-e,2)*e*i[a]+3*(1-e)*bmPow(e,2)*r[a]+bmPow(e,3)*n[a]},HShapeElement.prototype.calculateBoundingBox=function(e,t){var i,r=e.length;for(i=0;i<r;i+=1)e[i]&&e[i].sh?this.calculateShapeBoundingBox(e[i],t):e[i]&&e[i].it?this.calculateBoundingBox(e[i].it,t):e[i]&&e[i].style&&e[i].w&&this.expandStrokeBoundingBox(e[i].w,t)},HShapeElement.prototype.expandStrokeBoundingBox=function(e,t){var i=0;if(e.keyframes){for(var r=0;r<e.keyframes.length;r+=1){var n=e.keyframes[r].s;n>i&&(i=n)}i*=e.mult}else i=e.v*e.mult;t.x-=i,t.xMax+=i,t.y-=i,t.yMax+=i},HShapeElement.prototype.currentBoxContains=function(e){return this.currentBBox.x<=e.x&&this.currentBBox.y<=e.y&&this.currentBBox.width+this.currentBBox.x>=e.x+e.width&&this.currentBBox.height+this.currentBBox.y>=e.y+e.height},HShapeElement.prototype.renderInnerContent=function(){if(this._renderShapeFrame(),!this.hidden&&(this._isFirstFrame||this._mdf)){var e=this.tempBoundingBox,t=999999;if(e.x=t,e.xMax=-t,e.y=t,e.yMax=-t,this.calculateBoundingBox(this.itemsData,e),e.width=e.xMax<e.x?0:e.xMax-e.x,e.height=e.yMax<e.y?0:e.yMax-e.y,this.currentBoxContains(e))return;var i=!1;if(this.currentBBox.w!==e.width&&(this.currentBBox.w=e.width,this.shapeCont.setAttribute("width",e.width),i=!0),this.currentBBox.h!==e.height&&(this.currentBBox.h=e.height,this.shapeCont.setAttribute("height",e.height),i=!0),i||this.currentBBox.x!==e.x||this.currentBBox.y!==e.y){this.currentBBox.w=e.width,this.currentBBox.h=e.height,this.currentBBox.x=e.x,this.currentBBox.y=e.y,this.shapeCont.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h);var r=this.shapeCont.style,n="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";r.transform=n,r.webkitTransform=n}}},extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],HTextElement),HTextElement.prototype.createContent=function(){if(this.isMasked=this.checkMasks(),this.isMasked){this.renderType="svg",this.compW=this.comp.data.w,this.compH=this.comp.data.h,this.svgElement.setAttribute("width",this.compW),this.svgElement.setAttribute("height",this.compH);var e=createNS("g");this.maskedElement.appendChild(e),this.innerElem=e}else this.renderType="html",this.innerElem=this.layerElement;this.checkParenting()},HTextElement.prototype.buildNewText=function(){var e=this.textProperty.currentData;this.renderedLetters=createSizedArray(e.l?e.l.length:0);var t=this.innerElem.style,i=e.fc?this.buildColor(e.fc):"rgba(0,0,0,0)";t.fill=i,t.color=i,e.sc&&(t.stroke=this.buildColor(e.sc),t.strokeWidth=e.sw+"px");var r,n,a=this.globalData.fontManager.getFontByName(e.f);if(!this.globalData.fontManager.chars)if(t.fontSize=e.finalSize+"px",t.lineHeight=e.finalSize+"px",a.fClass)this.innerElem.className=a.fClass;else{t.fontFamily=a.fFamily;var o=e.fWeight,s=e.fStyle;t.fontStyle=s,t.fontWeight=o}var l,c,h,u=e.l;n=u.length;var d,p=this.mHelper,f="",m=0;for(r=0;r<n;r+=1){if(this.globalData.fontManager.chars?(this.textPaths[m]?l=this.textPaths[m]:((l=createNS("path")).setAttribute("stroke-linecap",lineCapEnum[1]),l.setAttribute("stroke-linejoin",lineJoinEnum[2]),l.setAttribute("stroke-miterlimit","4")),this.isMasked||(this.textSpans[m]?h=(c=this.textSpans[m]).children[0]:((c=createTag("div")).style.lineHeight=0,(h=createNS("svg")).appendChild(l),styleDiv(c)))):this.isMasked?l=this.textPaths[m]?this.textPaths[m]:createNS("text"):this.textSpans[m]?(c=this.textSpans[m],l=this.textPaths[m]):(styleDiv(c=createTag("span")),styleDiv(l=createTag("span")),c.appendChild(l)),this.globalData.fontManager.chars){var g,_=this.globalData.fontManager.getCharData(e.finalText[r],a.fStyle,this.globalData.fontManager.getFontByName(e.f).fFamily);if(g=_?_.data:null,p.reset(),g&&g.shapes&&g.shapes.length&&(d=g.shapes[0].it,p.scale(e.finalSize/100,e.finalSize/100),f=this.createPathShape(p,d),l.setAttribute("d",f)),this.isMasked)this.innerElem.appendChild(l);else{if(this.innerElem.appendChild(c),g&&g.shapes){document.body.appendChild(h);var y=h.getBBox();h.setAttribute("width",y.width+2),h.setAttribute("height",y.height+2),h.setAttribute("viewBox",y.x-1+" "+(y.y-1)+" "+(y.width+2)+" "+(y.height+2));var v=h.style,x="translate("+(y.x-1)+"px,"+(y.y-1)+"px)";v.transform=x,v.webkitTransform=x,u[r].yOffset=y.y-1}else h.setAttribute("width",1),h.setAttribute("height",1);c.appendChild(h)}}else if(l.textContent=u[r].val,l.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),this.isMasked)this.innerElem.appendChild(l);else{this.innerElem.appendChild(c);var b=l.style,w="translate3d(0,"+-e.finalSize/1.2+"px,0)";b.transform=w,b.webkitTransform=w}this.isMasked?this.textSpans[m]=l:this.textSpans[m]=c,this.textSpans[m].style.display="block",this.textPaths[m]=l,m+=1}for(;m<this.textSpans.length;)this.textSpans[m].style.display="none",m+=1},HTextElement.prototype.renderInnerContent=function(){var e;if(this.validateText(),this.data.singleShape){if(!this._isFirstFrame&&!this.lettersChangedFlag)return;if(this.isMasked&&this.finalTransform._matMdf){this.svgElement.setAttribute("viewBox",-this.finalTransform.mProp.p.v[0]+" "+-this.finalTransform.mProp.p.v[1]+" "+this.compW+" "+this.compH),e=this.svgElement.style;var t="translate("+-this.finalTransform.mProp.p.v[0]+"px,"+-this.finalTransform.mProp.p.v[1]+"px)";e.transform=t,e.webkitTransform=t}}if(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag){var i,r,n,a,o,s=0,l=this.textAnimator.renderedLetters,c=this.textProperty.currentData.l;for(r=c.length,i=0;i<r;i+=1)c[i].n?s+=1:(a=this.textSpans[i],o=this.textPaths[i],n=l[s],s+=1,n._mdf.m&&(this.isMasked?a.setAttribute("transform",n.m):(a.style.webkitTransform=n.m,a.style.transform=n.m)),a.style.opacity=n.o,n.sw&&n._mdf.sw&&o.setAttribute("stroke-width",n.sw),n.sc&&n._mdf.sc&&o.setAttribute("stroke",n.sc),n.fc&&n._mdf.fc&&(o.setAttribute("fill",n.fc),o.style.color=n.fc));if(this.innerElem.getBBox&&!this.hidden&&(this._isFirstFrame||this._mdf)){var h=this.innerElem.getBBox();if(this.currentBBox.w!==h.width&&(this.currentBBox.w=h.width,this.svgElement.setAttribute("width",h.width)),this.currentBBox.h!==h.height&&(this.currentBBox.h=h.height,this.svgElement.setAttribute("height",h.height)),this.currentBBox.w!==h.width+2||this.currentBBox.h!==h.height+2||this.currentBBox.x!==h.x-1||this.currentBBox.y!==h.y-1){this.currentBBox.w=h.width+2,this.currentBBox.h=h.height+2,this.currentBBox.x=h.x-1,this.currentBBox.y=h.y-1,this.svgElement.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h),e=this.svgElement.style;var u="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";e.transform=u,e.webkitTransform=u}}}},extendPrototype([BaseElement,FrameElement,HierarchyElement],HCameraElement),HCameraElement.prototype.setup=function(){var e,t,i,r,n=this.comp.threeDElements.length;for(e=0;e<n;e+=1)if("3d"===(t=this.comp.threeDElements[e]).type){i=t.perspectiveElem.style,r=t.container.style;var a=this.pe.v+"px",o="0px 0px 0px",s="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";i.perspective=a,i.webkitPerspective=a,r.transformOrigin=o,r.mozTransformOrigin=o,r.webkitTransformOrigin=o,i.transform=s,i.webkitTransform=s}},HCameraElement.prototype.createElements=function(){},HCameraElement.prototype.hide=function(){},HCameraElement.prototype.renderFrame=function(){var e,t,i=this._isFirstFrame;if(this.hierarchy)for(t=this.hierarchy.length,e=0;e<t;e+=1)i=this.hierarchy[e].finalTransform.mProp._mdf||i;if(i||this.pe._mdf||this.p&&this.p._mdf||this.px&&(this.px._mdf||this.py._mdf||this.pz._mdf)||this.rx._mdf||this.ry._mdf||this.rz._mdf||this.or._mdf||this.a&&this.a._mdf){if(this.mat.reset(),this.hierarchy)for(e=t=this.hierarchy.length-1;e>=0;e-=1){var r=this.hierarchy[e].finalTransform.mProp;this.mat.translate(-r.p.v[0],-r.p.v[1],r.p.v[2]),this.mat.rotateX(-r.or.v[0]).rotateY(-r.or.v[1]).rotateZ(r.or.v[2]),this.mat.rotateX(-r.rx.v).rotateY(-r.ry.v).rotateZ(r.rz.v),this.mat.scale(1/r.s.v[0],1/r.s.v[1],1/r.s.v[2]),this.mat.translate(r.a.v[0],r.a.v[1],r.a.v[2])}if(this.p?this.mat.translate(-this.p.v[0],-this.p.v[1],this.p.v[2]):this.mat.translate(-this.px.v,-this.py.v,this.pz.v),this.a){var n;n=this.p?[this.p.v[0]-this.a.v[0],this.p.v[1]-this.a.v[1],this.p.v[2]-this.a.v[2]]:[this.px.v-this.a.v[0],this.py.v-this.a.v[1],this.pz.v-this.a.v[2]];var a=Math.sqrt(Math.pow(n[0],2)+Math.pow(n[1],2)+Math.pow(n[2],2)),o=[n[0]/a,n[1]/a,n[2]/a],s=Math.sqrt(o[2]*o[2]+o[0]*o[0]),l=Math.atan2(o[1],s),c=Math.atan2(o[0],-o[2]);this.mat.rotateY(c).rotateX(-l)}this.mat.rotateX(-this.rx.v).rotateY(-this.ry.v).rotateZ(this.rz.v),this.mat.rotateX(-this.or.v[0]).rotateY(-this.or.v[1]).rotateZ(this.or.v[2]),this.mat.translate(this.globalData.compSize.w/2,this.globalData.compSize.h/2,0),this.mat.translate(0,0,this.pe.v);var h=!this._prevMat.equals(this.mat);if((h||this.pe._mdf)&&this.comp.threeDElements){var u,d,p;for(t=this.comp.threeDElements.length,e=0;e<t;e+=1)if("3d"===(u=this.comp.threeDElements[e]).type){if(h){var f=this.mat.toCSS();(p=u.container.style).transform=f,p.webkitTransform=f}this.pe._mdf&&((d=u.perspectiveElem.style).perspective=this.pe.v+"px",d.webkitPerspective=this.pe.v+"px")}this.mat.clone(this._prevMat)}}this._isFirstFrame=!1},HCameraElement.prototype.prepareFrame=function(e){this.prepareProperties(e,!0)},HCameraElement.prototype.destroy=function(){},HCameraElement.prototype.getBaseElement=function(){return null},extendPrototype([BaseElement,TransformElement,HBaseElement,HSolidElement,HierarchyElement,FrameElement,RenderableElement],HImageElement),HImageElement.prototype.createContent=function(){var e=this.globalData.getAssetsPath(this.assetData),t=new Image;this.data.hasMask?(this.imageElem=createNS("image"),this.imageElem.setAttribute("width",this.assetData.w+"px"),this.imageElem.setAttribute("height",this.assetData.h+"px"),this.imageElem.setAttributeNS("http://www.w3.org/1999/xlink","href",e),this.layerElement.appendChild(this.imageElem),this.baseElement.setAttribute("width",this.assetData.w),this.baseElement.setAttribute("height",this.assetData.h)):this.layerElement.appendChild(t),t.crossOrigin="anonymous",t.src=e,this.data.ln&&this.baseElement.setAttribute("id",this.data.ln)},extendPrototype([BaseRenderer],HybridRendererBase),HybridRendererBase.prototype.buildItem=SVGRenderer.prototype.buildItem,HybridRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;)this.pendingElements.pop().checkParenting()},HybridRendererBase.prototype.appendElementInPos=function(e,t){var i=e.getBaseElement();if(i){var r=this.layers[t];if(r.ddd&&this.supports3d)this.addTo3dContainer(i,t);else if(this.threeDElements)this.addTo3dContainer(i,t);else{for(var n,a,o=0;o<t;)this.elements[o]&&!0!==this.elements[o]&&this.elements[o].getBaseElement&&(a=this.elements[o],n=(this.layers[o].ddd?this.getThreeDContainerByPos(o):a.getBaseElement())||n),o+=1;n?r.ddd&&this.supports3d||this.layerElement.insertBefore(i,n):r.ddd&&this.supports3d||this.layerElement.appendChild(i)}}},HybridRendererBase.prototype.createShape=function(e){return this.supports3d?new HShapeElement(e,this.globalData,this):new SVGShapeElement(e,this.globalData,this)},HybridRendererBase.prototype.createText=function(e){return this.supports3d?new HTextElement(e,this.globalData,this):new SVGTextLottieElement(e,this.globalData,this)},HybridRendererBase.prototype.createCamera=function(e){return this.camera=new HCameraElement(e,this.globalData,this),this.camera},HybridRendererBase.prototype.createImage=function(e){return this.supports3d?new HImageElement(e,this.globalData,this):new IImageElement(e,this.globalData,this)},HybridRendererBase.prototype.createSolid=function(e){return this.supports3d?new HSolidElement(e,this.globalData,this):new ISolidElement(e,this.globalData,this)},HybridRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,HybridRendererBase.prototype.getThreeDContainerByPos=function(e){for(var t=0,i=this.threeDElements.length;t<i;){if(this.threeDElements[t].startPos<=e&&this.threeDElements[t].endPos>=e)return this.threeDElements[t].perspectiveElem;t+=1}return null},HybridRendererBase.prototype.createThreeDContainer=function(e,t){var i,r,n=createTag("div");styleDiv(n);var a=createTag("div");if(styleDiv(a),"3d"===t){(i=n.style).width=this.globalData.compSize.w+"px",i.height=this.globalData.compSize.h+"px";var o="50% 50%";i.webkitTransformOrigin=o,i.mozTransformOrigin=o,i.transformOrigin=o;var s="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";(r=a.style).transform=s,r.webkitTransform=s}n.appendChild(a);var l={container:a,perspectiveElem:n,startPos:e,endPos:e,type:t};return this.threeDElements.push(l),l},HybridRendererBase.prototype.build3dContainers=function(){var e,t,i=this.layers.length,r="";for(e=0;e<i;e+=1)this.layers[e].ddd&&3!==this.layers[e].ty?("3d"!==r&&(r="3d",t=this.createThreeDContainer(e,"3d")),t.endPos=Math.max(t.endPos,e)):("2d"!==r&&(r="2d",t=this.createThreeDContainer(e,"2d")),t.endPos=Math.max(t.endPos,e));for(e=(i=this.threeDElements.length)-1;e>=0;e-=1)this.resizerElem.appendChild(this.threeDElements[e].perspectiveElem)},HybridRendererBase.prototype.addTo3dContainer=function(e,t){for(var i=0,r=this.threeDElements.length;i<r;){if(t<=this.threeDElements[i].endPos){for(var n,a=this.threeDElements[i].startPos;a<t;)this.elements[a]&&this.elements[a].getBaseElement&&(n=this.elements[a].getBaseElement()),a+=1;n?this.threeDElements[i].container.insertBefore(e,n):this.threeDElements[i].container.appendChild(e);break}i+=1}},HybridRendererBase.prototype.configAnimation=function(e){var t=createTag("div"),i=this.animationItem.wrapper,r=t.style;r.width=e.w+"px",r.height=e.h+"px",this.resizerElem=t,styleDiv(t),r.transformStyle="flat",r.mozTransformStyle="flat",r.webkitTransformStyle="flat",this.renderConfig.className&&t.setAttribute("class",this.renderConfig.className),i.appendChild(t),r.overflow="hidden";var n=createNS("svg");n.setAttribute("width","1"),n.setAttribute("height","1"),styleDiv(n),this.resizerElem.appendChild(n);var a=createNS("defs");n.appendChild(a),this.data=e,this.setupGlobalData(e,n),this.globalData.defs=a,this.layers=e.layers,this.layerElement=this.resizerElem,this.build3dContainers(),this.updateContainerSize()},HybridRendererBase.prototype.destroy=function(){var e;this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.animationItem.container=null,this.globalData.defs=null;var t=this.layers?this.layers.length:0;for(e=0;e<t;e+=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},HybridRendererBase.prototype.updateContainerSize=function(){var e,t,i,r,n=this.animationItem.wrapper.offsetWidth,a=this.animationItem.wrapper.offsetHeight,o=n/a;this.globalData.compSize.w/this.globalData.compSize.h>o?(e=n/this.globalData.compSize.w,t=n/this.globalData.compSize.w,i=0,r=(a-this.globalData.compSize.h*(n/this.globalData.compSize.w))/2):(e=a/this.globalData.compSize.h,t=a/this.globalData.compSize.h,i=(n-this.globalData.compSize.w*(a/this.globalData.compSize.h))/2,r=0);var s=this.resizerElem.style;s.webkitTransform="matrix3d("+e+",0,0,0,0,"+t+",0,0,0,0,1,0,"+i+","+r+",0,1)",s.transform=s.webkitTransform},HybridRendererBase.prototype.renderFrame=SVGRenderer.prototype.renderFrame,HybridRendererBase.prototype.hide=function(){this.resizerElem.style.display="none"},HybridRendererBase.prototype.show=function(){this.resizerElem.style.display="block"},HybridRendererBase.prototype.initItems=function(){if(this.buildAllItems(),this.camera)this.camera.setup();else{var e,t=this.globalData.compSize.w,i=this.globalData.compSize.h,r=this.threeDElements.length;for(e=0;e<r;e+=1){var n=this.threeDElements[e].perspectiveElem.style;n.webkitPerspective=Math.sqrt(Math.pow(t,2)+Math.pow(i,2))+"px",n.perspective=n.webkitPerspective}}},HybridRendererBase.prototype.searchExtraCompositions=function(e){var t,i=e.length,r=createTag("div");for(t=0;t<i;t+=1)if(e[t].xt){var n=this.createComp(e[t],r,this.globalData.comp,null);n.initExpressions(),this.globalData.projectInterface.registerComposition(n)}},extendPrototype([HybridRendererBase,ICompElement,HBaseElement],HCompElement),HCompElement.prototype._createBaseContainerElements=HCompElement.prototype.createContainerElements,HCompElement.prototype.createContainerElements=function(){this._createBaseContainerElements(),this.data.hasMask?(this.svgElement.setAttribute("width",this.data.w),this.svgElement.setAttribute("height",this.data.h),this.transformedElement=this.baseElement):this.transformedElement=this.layerElement},HCompElement.prototype.addTo3dContainer=function(e,t){for(var i,r=0;r<t;)this.elements[r]&&this.elements[r].getBaseElement&&(i=this.elements[r].getBaseElement()),r+=1;i?this.layerElement.insertBefore(e,i):this.layerElement.appendChild(e)},HCompElement.prototype.createComp=function(e){return this.supports3d?new HCompElement(e,this.globalData,this):new SVGCompElement(e,this.globalData,this)},extendPrototype([HybridRendererBase],HybridRenderer),HybridRenderer.prototype.createComp=function(e){return this.supports3d?new HCompElement(e,this.globalData,this):new SVGCompElement(e,this.globalData,this)};var CompExpressionInterface=function(e){function t(t){for(var i=0,r=e.layers.length;i<r;){if(e.layers[i].nm===t||e.layers[i].ind===t)return e.elements[i].layerInterface;i+=1}return null}return Object.defineProperty(t,"_name",{value:e.data.nm}),t.layer=t,t.pixelAspect=1,t.height=e.data.h||e.globalData.compSize.h,t.width=e.data.w||e.globalData.compSize.w,t.pixelAspect=1,t.frameDuration=1/e.globalData.frameRate,t.displayStartTime=0,t.numLayers=e.layers.length,t};function _typeof$2(e){return _typeof$2="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$2(e)}function seedRandom(e,t){var i,r=this,n=256,a="random",o=t.pow(n,6),s=t.pow(2,52),l=2*s,c=n-1;function h(e){var t,i=e.length,r=this,a=0,o=r.i=r.j=0,s=r.S=[];for(i||(e=[i++]);a<n;)s[a]=a++;for(a=0;a<n;a++)s[a]=s[o=c&o+e[a%i]+(t=s[a])],s[o]=t;r.g=function(e){for(var t,i=0,a=r.i,o=r.j,s=r.S;e--;)t=s[a=c&a+1],i=i*n+s[c&(s[a]=s[o=c&o+t])+(s[o]=t)];return r.i=a,r.j=o,i}}function u(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function d(e,t){var i,r=[],n=_typeof$2(e);if(t&&"object"==n)for(i in e)try{r.push(d(e[i],t-1))}catch(a){}return r.length?r:"string"==n?e:e+"\0"}function p(e,t){for(var i,r=e+"",n=0;n<r.length;)t[c&n]=c&(i^=19*t[c&n])+r.charCodeAt(n++);return f(t)}function f(e){return String.fromCharCode.apply(0,e)}t["seed"+a]=function(c,m,g){var _=[],y=p(d((m=!0===m?{entropy:!0}:m||{}).entropy?[c,f(e)]:null===c?function(){try{if(i)return f(i.randomBytes(n));var t=new Uint8Array(n);return(r.crypto||r.msCrypto).getRandomValues(t),f(t)}catch(s){var a=r.navigator,o=a&&a.plugins;return[+new Date,r,o,r.screen,f(e)]}}():c,3),_),v=new h(_),x=function(){for(var e=v.g(6),t=o,i=0;e<s;)e=(e+i)*n,t*=n,i=v.g(1);for(;e>=l;)e/=2,t/=2,i>>>=1;return(e+i)/t};return x.int32=function(){return 0|v.g(4)},x.quick=function(){return v.g(4)/4294967296},x.double=x,p(f(v.S),e),(m.pass||g||function(e,i,r,n){return n&&(n.S&&u(n,v),e.state=function(){return u(v,{})}),r?(t[a]=e,i):e})(x,y,"global"in m?m.global:this==t,m.state)},p(t.random(),e)}function initialize$2(e){seedRandom([],e)}var propTypes={SHAPE:"shape"};function _typeof$1(e){return _typeof$1="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$1(e)}var ExpressionManager=function(){var ob={},Math=BMMath,window=null,document=null,XMLHttpRequest=null,fetch=null,frames=null,_lottieGlobal={};function resetFrame(){_lottieGlobal={}}function $bm_isInstanceOfArray(e){return e.constructor===Array||e.constructor===Float32Array}function isNumerable(e,t){return"number"===e||t instanceof Number||"boolean"===e||"string"===e}function $bm_neg(e){var t=_typeof$1(e);if("number"===t||e instanceof Number||"boolean"===t)return-e;if($bm_isInstanceOfArray(e)){var i,r=e.length,n=[];for(i=0;i<r;i+=1)n[i]=-e[i];return n}return e.propType?e.v:-e}initialize$2(BMMath);var easeInBez=BezierFactory.getBezierEasing(.333,0,.833,.833,"easeIn").get,easeOutBez=BezierFactory.getBezierEasing(.167,.167,.667,1,"easeOut").get,easeInOutBez=BezierFactory.getBezierEasing(.33,0,.667,1,"easeInOut").get;function sum(e,t){var i=_typeof$1(e),r=_typeof$1(t);if(isNumerable(i,e)&&isNumerable(r,t)||"string"===i||"string"===r)return e+t;if($bm_isInstanceOfArray(e)&&isNumerable(r,t))return(e=e.slice(0))[0]+=t,e;if(isNumerable(i,e)&&$bm_isInstanceOfArray(t))return(t=t.slice(0))[0]=e+t[0],t;if($bm_isInstanceOfArray(e)&&$bm_isInstanceOfArray(t)){for(var n=0,a=e.length,o=t.length,s=[];n<a||n<o;)("number"===typeof e[n]||e[n]instanceof Number)&&("number"===typeof t[n]||t[n]instanceof Number)?s[n]=e[n]+t[n]:s[n]=void 0===t[n]?e[n]:e[n]||t[n],n+=1;return s}return 0}var add=sum;function sub(e,t){var i=_typeof$1(e),r=_typeof$1(t);if(isNumerable(i,e)&&isNumerable(r,t))return"string"===i&&(e=parseInt(e,10)),"string"===r&&(t=parseInt(t,10)),e-t;if($bm_isInstanceOfArray(e)&&isNumerable(r,t))return(e=e.slice(0))[0]-=t,e;if(isNumerable(i,e)&&$bm_isInstanceOfArray(t))return(t=t.slice(0))[0]=e-t[0],t;if($bm_isInstanceOfArray(e)&&$bm_isInstanceOfArray(t)){for(var n=0,a=e.length,o=t.length,s=[];n<a||n<o;)("number"===typeof e[n]||e[n]instanceof Number)&&("number"===typeof t[n]||t[n]instanceof Number)?s[n]=e[n]-t[n]:s[n]=void 0===t[n]?e[n]:e[n]||t[n],n+=1;return s}return 0}function mul(e,t){var i,r,n,a=_typeof$1(e),o=_typeof$1(t);if(isNumerable(a,e)&&isNumerable(o,t))return e*t;if($bm_isInstanceOfArray(e)&&isNumerable(o,t)){for(n=e.length,i=createTypedArray("float32",n),r=0;r<n;r+=1)i[r]=e[r]*t;return i}if(isNumerable(a,e)&&$bm_isInstanceOfArray(t)){for(n=t.length,i=createTypedArray("float32",n),r=0;r<n;r+=1)i[r]=e*t[r];return i}return 0}function div(e,t){var i,r,n,a=_typeof$1(e),o=_typeof$1(t);if(isNumerable(a,e)&&isNumerable(o,t))return e/t;if($bm_isInstanceOfArray(e)&&isNumerable(o,t)){for(n=e.length,i=createTypedArray("float32",n),r=0;r<n;r+=1)i[r]=e[r]/t;return i}if(isNumerable(a,e)&&$bm_isInstanceOfArray(t)){for(n=t.length,i=createTypedArray("float32",n),r=0;r<n;r+=1)i[r]=e/t[r];return i}return 0}function mod(e,t){return"string"===typeof e&&(e=parseInt(e,10)),"string"===typeof t&&(t=parseInt(t,10)),e%t}var $bm_sum=sum,$bm_sub=sub,$bm_mul=mul,$bm_div=div,$bm_mod=mod;function clamp(e,t,i){if(t>i){var r=i;i=t,t=r}return Math.min(Math.max(e,t),i)}function radiansToDegrees(e){return e/degToRads}var radians_to_degrees=radiansToDegrees;function degreesToRadians(e){return e*degToRads}var degrees_to_radians=radiansToDegrees,helperLengthArray=[0,0,0,0,0,0];function length(e,t){if("number"===typeof e||e instanceof Number)return t=t||0,Math.abs(e-t);var i;t||(t=helperLengthArray);var r=Math.min(e.length,t.length),n=0;for(i=0;i<r;i+=1)n+=Math.pow(t[i]-e[i],2);return Math.sqrt(n)}function normalize(e){return div(e,length(e))}function rgbToHsl(e){var t,i,r=e[0],n=e[1],a=e[2],o=Math.max(r,n,a),s=Math.min(r,n,a),l=(o+s)/2;if(o===s)t=0,i=0;else{var c=o-s;switch(i=l>.5?c/(2-o-s):c/(o+s),o){case r:t=(n-a)/c+(n<a?6:0);break;case n:t=(a-r)/c+2;break;case a:t=(r-n)/c+4}t/=6}return[t,i,l,e[3]]}function hue2rgb(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}function hslToRgb(e){var t,i,r,n=e[0],a=e[1],o=e[2];if(0===a)t=o,r=o,i=o;else{var s=o<.5?o*(1+a):o+a-o*a,l=2*o-s;t=hue2rgb(l,s,n+1/3),i=hue2rgb(l,s,n),r=hue2rgb(l,s,n-1/3)}return[t,i,r,e[3]]}function linear(e,t,i,r,n){if(void 0!==r&&void 0!==n||(r=t,n=i,t=0,i=1),i<t){var a=i;i=t,t=a}if(e<=t)return r;if(e>=i)return n;var o,s=i===t?0:(e-t)/(i-t);if(!r.length)return r+(n-r)*s;var l=r.length,c=createTypedArray("float32",l);for(o=0;o<l;o+=1)c[o]=r[o]+(n[o]-r[o])*s;return c}function random(e,t){if(void 0===t&&(void 0===e?(e=0,t=1):(t=e,e=void 0)),t.length){var i,r=t.length;e||(e=createTypedArray("float32",r));var n=createTypedArray("float32",r),a=BMMath.random();for(i=0;i<r;i+=1)n[i]=e[i]+a*(t[i]-e[i]);return n}return void 0===e&&(e=0),e+BMMath.random()*(t-e)}function createPath(e,t,i,r){var n,a=e.length,o=shapePool.newElement();o.setPathData(!!r,a);var s,l,c=[0,0];for(n=0;n<a;n+=1)s=t&&t[n]?t[n]:c,l=i&&i[n]?i[n]:c,o.setTripleAt(e[n][0],e[n][1],l[0]+e[n][0],l[1]+e[n][1],s[0]+e[n][0],s[1]+e[n][1],n,!0);return o}function initiateExpression(elem,data,property){function noOp(e){return e}if(!elem.globalData.renderConfig.runExpressions)return noOp;var val=data.x,needsVelocity=/velocity(?![\w\d])/.test(val),_needsRandom=-1!==val.indexOf("random"),elemType=elem.data.ty,transform,$bm_transform,content,effect,thisProperty=property;thisProperty.valueAtTime=thisProperty.getValueAtTime,Object.defineProperty(thisProperty,"value",{get:function(){return thisProperty.v}}),elem.comp.frameDuration=1/elem.comp.globalData.frameRate,elem.comp.displayStartTime=0;var inPoint=elem.data.ip/elem.comp.globalData.frameRate,outPoint=elem.data.op/elem.comp.globalData.frameRate,width=elem.data.sw?elem.data.sw:0,height=elem.data.sh?elem.data.sh:0,name=elem.data.nm,loopIn,loop_in,loopOut,loop_out,smooth,toWorld,fromWorld,fromComp,toComp,fromCompToSurface,position,rotation,anchorPoint,scale,thisLayer,thisComp,mask,valueAtTime,velocityAtTime,scoped_bm_rt,expression_function=eval("[function _expression_function(){"+val+";scoped_bm_rt=$bm_rt}]")[0],numKeys=property.kf?data.k.length:0,active=!this.data||!0!==this.data.hd,wiggle=function(e,t){var i,r,n=this.pv.length?this.pv.length:1,a=createTypedArray("float32",n),o=Math.floor(5*time);for(i=0,r=0;i<o;){for(r=0;r<n;r+=1)a[r]+=-t+2*t*BMMath.random();i+=1}var s=5*time,l=s-Math.floor(s),c=createTypedArray("float32",n);if(n>1){for(r=0;r<n;r+=1)c[r]=this.pv[r]+a[r]+(-t+2*t*BMMath.random())*l;return c}return this.pv+a[0]+(-t+2*t*BMMath.random())*l}.bind(this);function loopInDuration(e,t){return loopIn(e,t,!0)}function loopOutDuration(e,t){return loopOut(e,t,!0)}thisProperty.loopIn&&(loopIn=thisProperty.loopIn.bind(thisProperty),loop_in=loopIn),thisProperty.loopOut&&(loopOut=thisProperty.loopOut.bind(thisProperty),loop_out=loopOut),thisProperty.smooth&&(smooth=thisProperty.smooth.bind(thisProperty)),this.getValueAtTime&&(valueAtTime=this.getValueAtTime.bind(this)),this.getVelocityAtTime&&(velocityAtTime=this.getVelocityAtTime.bind(this));var comp=elem.comp.globalData.projectInterface.bind(elem.comp.globalData.projectInterface),time,velocity,value,text,textIndex,textTotal,selectorValue;function lookAt(e,t){var i=[t[0]-e[0],t[1]-e[1],t[2]-e[2]],r=Math.atan2(i[0],Math.sqrt(i[1]*i[1]+i[2]*i[2]))/degToRads;return[-Math.atan2(i[1],i[2])/degToRads,r,0]}function easeOut(e,t,i,r,n){return applyEase(easeOutBez,e,t,i,r,n)}function easeIn(e,t,i,r,n){return applyEase(easeInBez,e,t,i,r,n)}function ease(e,t,i,r,n){return applyEase(easeInOutBez,e,t,i,r,n)}function applyEase(e,t,i,r,n,a){void 0===n?(n=i,a=r):t=(t-i)/(r-i),t>1?t=1:t<0&&(t=0);var o=e(t);if($bm_isInstanceOfArray(n)){var s,l=n.length,c=createTypedArray("float32",l);for(s=0;s<l;s+=1)c[s]=(a[s]-n[s])*o+n[s];return c}return(a-n)*o+n}function nearestKey(e){var t,i,r,n=data.k.length;if(data.k.length&&"number"!==typeof data.k[0])if(i=-1,(e*=elem.comp.globalData.frameRate)<data.k[0].t)i=1,r=data.k[0].t;else{for(t=0;t<n-1;t+=1){if(e===data.k[t].t){i=t+1,r=data.k[t].t;break}if(e>data.k[t].t&&e<data.k[t+1].t){e-data.k[t].t>data.k[t+1].t-e?(i=t+2,r=data.k[t+1].t):(i=t+1,r=data.k[t].t);break}}-1===i&&(i=t+1,r=data.k[t].t)}else i=0,r=0;var a={};return a.index=i,a.time=r/elem.comp.globalData.frameRate,a}function key(e){var t,i,r;if(!data.k.length||"number"===typeof data.k[0])throw new Error("The property has no keyframe at index "+e);e-=1,t={time:data.k[e].t/elem.comp.globalData.frameRate,value:[]};var n=Object.prototype.hasOwnProperty.call(data.k[e],"s")?data.k[e].s:data.k[e-1].e;for(r=n.length,i=0;i<r;i+=1)t[i]=n[i],t.value[i]=n[i];return t}function framesToTime(e,t){return t||(t=elem.comp.globalData.frameRate),e/t}function timeToFrames(e,t){return e||0===e||(e=time),t||(t=elem.comp.globalData.frameRate),e*t}function seedRandom(e){BMMath.seedrandom(randSeed+e)}function sourceRectAtTime(){return elem.sourceRectAtTime()}function substring(e,t){return"string"===typeof value?void 0===t?value.substring(e):value.substring(e,t):""}function substr(e,t){return"string"===typeof value?void 0===t?value.substr(e):value.substr(e,t):""}function posterizeTime(e){time=0===e?0:Math.floor(time*e)/e,value=valueAtTime(time)}var index=elem.data.ind,hasParent=!(!elem.hierarchy||!elem.hierarchy.length),parent,randSeed=Math.floor(1e6*Math.random()),globalData=elem.globalData;function executeExpression(e){return value=e,this.frameExpressionId===elem.globalData.frameId&&"textSelector"!==this.propType?value:("textSelector"===this.propType&&(textIndex=this.textIndex,textTotal=this.textTotal,selectorValue=this.selectorValue),thisLayer||(text=elem.layerInterface.text,thisLayer=elem.layerInterface,thisComp=elem.comp.compInterface,toWorld=thisLayer.toWorld.bind(thisLayer),fromWorld=thisLayer.fromWorld.bind(thisLayer),fromComp=thisLayer.fromComp.bind(thisLayer),toComp=thisLayer.toComp.bind(thisLayer),mask=thisLayer.mask?thisLayer.mask.bind(thisLayer):null,fromCompToSurface=fromComp),transform||(transform=elem.layerInterface("ADBE Transform Group"),$bm_transform=transform,transform&&(anchorPoint=transform.anchorPoint)),4!==elemType||content||(content=thisLayer("ADBE Root Vectors Group")),effect||(effect=thisLayer(4)),(hasParent=!(!elem.hierarchy||!elem.hierarchy.length))&&!parent&&(parent=elem.hierarchy[0].layerInterface),time=this.comp.renderedFrame/this.comp.globalData.frameRate,_needsRandom&&seedRandom(randSeed+time),needsVelocity&&(velocity=velocityAtTime(time)),expression_function(),this.frameExpressionId=elem.globalData.frameId,scoped_bm_rt=scoped_bm_rt.propType===propTypes.SHAPE?scoped_bm_rt.v:scoped_bm_rt)}return executeExpression.__preventDeadCodeRemoval=[$bm_transform,anchorPoint,time,velocity,inPoint,outPoint,width,height,name,loop_in,loop_out,smooth,toComp,fromCompToSurface,toWorld,fromWorld,mask,position,rotation,scale,thisComp,numKeys,active,wiggle,loopInDuration,loopOutDuration,comp,lookAt,easeOut,easeIn,ease,nearestKey,key,text,textIndex,textTotal,selectorValue,framesToTime,timeToFrames,sourceRectAtTime,substring,substr,posterizeTime,index,globalData],executeExpression}return ob.initiateExpression=initiateExpression,ob.__preventDeadCodeRemoval=[window,document,XMLHttpRequest,fetch,frames,$bm_neg,add,$bm_sum,$bm_sub,$bm_mul,$bm_div,$bm_mod,clamp,radians_to_degrees,degreesToRadians,degrees_to_radians,normalize,rgbToHsl,hslToRgb,linear,random,createPath,_lottieGlobal],ob.resetFrame=resetFrame,ob}(),Expressions=function(){var e={initExpressions:function(e){var t=0,i=[];e.renderer.compInterface=CompExpressionInterface(e.renderer),e.renderer.globalData.projectInterface.registerComposition(e.renderer),e.renderer.globalData.pushExpression=function(){t+=1},e.renderer.globalData.popExpression=function(){0===(t-=1)&&function(){var e,t=i.length;for(e=0;e<t;e+=1)i[e].release();i.length=0}()},e.renderer.globalData.registerExpressionProperty=function(e){-1===i.indexOf(e)&&i.push(e)}}};return e.resetFrame=ExpressionManager.resetFrame,e}(),MaskManagerInterface=function(){function e(e,t){this._mask=e,this._data=t}return Object.defineProperty(e.prototype,"maskPath",{get:function(){return this._mask.prop.k&&this._mask.prop.getValue(),this._mask.prop}}),Object.defineProperty(e.prototype,"maskOpacity",{get:function(){return this._mask.op.k&&this._mask.op.getValue(),100*this._mask.op.v}}),function(t){var i,r=createSizedArray(t.viewData.length),n=t.viewData.length;for(i=0;i<n;i+=1)r[i]=new e(t.viewData[i],t.masksProperties[i]);return function(e){for(i=0;i<n;){if(t.masksProperties[i].nm===e)return r[i];i+=1}return null}}}(),ExpressionPropertyInterface=function(){var e={pv:0,v:0,mult:1},t={pv:[0,0,0],v:[0,0,0],mult:1};function i(e,t,i){Object.defineProperty(e,"velocity",{get:function(){return t.getVelocityAtTime(t.comp.currentFrame)}}),e.numKeys=t.keyframes?t.keyframes.length:0,e.key=function(r){if(!e.numKeys)return 0;var n="";n="s"in t.keyframes[r-1]?t.keyframes[r-1].s:"e"in t.keyframes[r-2]?t.keyframes[r-2].e:t.keyframes[r-2].s;var a="unidimensional"===i?new Number(n):Object.assign({},n);return a.time=t.keyframes[r-1].t/t.elem.comp.globalData.frameRate,a.value="unidimensional"===i?n[0]:n,a},e.valueAtTime=t.getValueAtTime,e.speedAtTime=t.getSpeedAtTime,e.velocityAtTime=t.getVelocityAtTime,e.propertyGroup=t.propertyGroup}function r(){return e}return function(n){return n?"unidimensional"===n.propType?function(t){t&&"pv"in t||(t=e);var r=1/t.mult,n=t.pv*r,a=new Number(n);return a.value=n,i(a,t,"unidimensional"),function(){return t.k&&t.getValue(),n=t.v*r,a.value!==n&&((a=new Number(n)).value=n,i(a,t,"unidimensional")),a}}(n):function(e){e&&"pv"in e||(e=t);var r=1/e.mult,n=e.data&&e.data.l||e.pv.length,a=createTypedArray("float32",n),o=createTypedArray("float32",n);return a.value=o,i(a,e,"multidimensional"),function(){e.k&&e.getValue();for(var t=0;t<n;t+=1)o[t]=e.v[t]*r,a[t]=o[t];return a}}(n):r}}(),TransformExpressionInterface=function(e){function t(e){switch(e){case"scale":case"Scale":case"ADBE Scale":case 6:return t.scale;case"rotation":case"Rotation":case"ADBE Rotation":case"ADBE Rotate Z":case 10:return t.rotation;case"ADBE Rotate X":return t.xRotation;case"ADBE Rotate Y":return t.yRotation;case"position":case"Position":case"ADBE Position":case 2:return t.position;case"ADBE Position_0":return t.xPosition;case"ADBE Position_1":return t.yPosition;case"ADBE Position_2":return t.zPosition;case"anchorPoint":case"AnchorPoint":case"Anchor Point":case"ADBE AnchorPoint":case 1:return t.anchorPoint;case"opacity":case"Opacity":case 11:return t.opacity;default:return null}}var i,r,n,a;return Object.defineProperty(t,"rotation",{get:ExpressionPropertyInterface(e.r||e.rz)}),Object.defineProperty(t,"zRotation",{get:ExpressionPropertyInterface(e.rz||e.r)}),Object.defineProperty(t,"xRotation",{get:ExpressionPropertyInterface(e.rx)}),Object.defineProperty(t,"yRotation",{get:ExpressionPropertyInterface(e.ry)}),Object.defineProperty(t,"scale",{get:ExpressionPropertyInterface(e.s)}),e.p?a=ExpressionPropertyInterface(e.p):(i=ExpressionPropertyInterface(e.px),r=ExpressionPropertyInterface(e.py),e.pz&&(n=ExpressionPropertyInterface(e.pz))),Object.defineProperty(t,"position",{get:function(){return e.p?a():[i(),r(),n?n():0]}}),Object.defineProperty(t,"xPosition",{get:ExpressionPropertyInterface(e.px)}),Object.defineProperty(t,"yPosition",{get:ExpressionPropertyInterface(e.py)}),Object.defineProperty(t,"zPosition",{get:ExpressionPropertyInterface(e.pz)}),Object.defineProperty(t,"anchorPoint",{get:ExpressionPropertyInterface(e.a)}),Object.defineProperty(t,"opacity",{get:ExpressionPropertyInterface(e.o)}),Object.defineProperty(t,"skew",{get:ExpressionPropertyInterface(e.sk)}),Object.defineProperty(t,"skewAxis",{get:ExpressionPropertyInterface(e.sa)}),Object.defineProperty(t,"orientation",{get:ExpressionPropertyInterface(e.or)}),t},LayerExpressionInterface=function(){function e(e){var t=new Matrix;return void 0!==e?this._elem.finalTransform.mProp.getValueAtTime(e).clone(t):this._elem.finalTransform.mProp.applyToMatrix(t),t}function t(e,t){var i=this.getMatrix(t);return i.props[12]=0,i.props[13]=0,i.props[14]=0,this.applyPoint(i,e)}function i(e,t){var i=this.getMatrix(t);return this.applyPoint(i,e)}function r(e,t){var i=this.getMatrix(t);return i.props[12]=0,i.props[13]=0,i.props[14]=0,this.invertPoint(i,e)}function n(e,t){var i=this.getMatrix(t);return this.invertPoint(i,e)}function a(e,t){if(this._elem.hierarchy&&this._elem.hierarchy.length){var i,r=this._elem.hierarchy.length;for(i=0;i<r;i+=1)this._elem.hierarchy[i].finalTransform.mProp.applyToMatrix(e)}return e.applyToPointArray(t[0],t[1],t[2]||0)}function o(e,t){if(this._elem.hierarchy&&this._elem.hierarchy.length){var i,r=this._elem.hierarchy.length;for(i=0;i<r;i+=1)this._elem.hierarchy[i].finalTransform.mProp.applyToMatrix(e)}return e.inversePoint(t)}function s(e){var t=new Matrix;if(t.reset(),this._elem.finalTransform.mProp.applyToMatrix(t),this._elem.hierarchy&&this._elem.hierarchy.length){var i,r=this._elem.hierarchy.length;for(i=0;i<r;i+=1)this._elem.hierarchy[i].finalTransform.mProp.applyToMatrix(t);return t.inversePoint(e)}return t.inversePoint(e)}function l(){return[1,1,1,1]}return function(c){var h;function u(e){switch(e){case"ADBE Root Vectors Group":case"Contents":case 2:return u.shapeInterface;case 1:case 6:case"Transform":case"transform":case"ADBE Transform Group":return h;case 4:case"ADBE Effect Parade":case"effects":case"Effects":return u.effect;case"ADBE Text Properties":return u.textInterface;default:return null}}u.getMatrix=e,u.invertPoint=o,u.applyPoint=a,u.toWorld=i,u.toWorldVec=t,u.fromWorld=n,u.fromWorldVec=r,u.toComp=i,u.fromComp=s,u.sampleImage=l,u.sourceRectAtTime=c.sourceRectAtTime.bind(c),u._elem=c;var d=getDescriptor(h=TransformExpressionInterface(c.finalTransform.mProp),"anchorPoint");return Object.defineProperties(u,{hasParent:{get:function(){return c.hierarchy.length}},parent:{get:function(){return c.hierarchy[0].layerInterface}},rotation:getDescriptor(h,"rotation"),scale:getDescriptor(h,"scale"),position:getDescriptor(h,"position"),opacity:getDescriptor(h,"opacity"),anchorPoint:d,anchor_point:d,transform:{get:function(){return h}},active:{get:function(){return c.isInRange}}}),u.startTime=c.data.st,u.index=c.data.ind,u.source=c.data.refId,u.height=0===c.data.ty?c.data.h:100,u.width=0===c.data.ty?c.data.w:100,u.inPoint=c.data.ip/c.comp.globalData.frameRate,u.outPoint=c.data.op/c.comp.globalData.frameRate,u._name=c.data.nm,u.registerMaskInterface=function(e){u.mask=new MaskManagerInterface(e,c)},u.registerEffectsInterface=function(e){u.effect=e},u}}(),propertyGroupFactory=function(e,t){return function(i){return(i=void 0===i?1:i)<=0?e:t(i-1)}},PropertyInterface=function(e,t){var i={_name:e};return function(e){return(e=void 0===e?1:e)<=0?i:t(e-1)}},EffectsExpressionInterface=function(){function e(i,r,n,a){function o(e){for(var t=i.ef,r=0,n=t.length;r<n;){if(e===t[r].nm||e===t[r].mn||e===t[r].ix)return 5===t[r].ty?c[r]:c[r]();r+=1}throw new Error}var s,l=propertyGroupFactory(o,n),c=[],h=i.ef.length;for(s=0;s<h;s+=1)5===i.ef[s].ty?c.push(e(i.ef[s],r.effectElements[s],r.effectElements[s].propertyGroup,a)):c.push(t(r.effectElements[s],i.ef[s].ty,a,l));return"ADBE Color Control"===i.mn&&Object.defineProperty(o,"color",{get:function(){return c[0]()}}),Object.defineProperties(o,{numProperties:{get:function(){return i.np}},_name:{value:i.nm},propertyGroup:{value:l}}),o.enabled=0!==i.en,o.active=o.enabled,o}function t(e,t,i,r){var n=ExpressionPropertyInterface(e.p);return e.p.setGroupProperty&&e.p.setGroupProperty(PropertyInterface("",r)),function(){return 10===t?i.comp.compInterface(e.p.v):n()}}return{createEffectsInterface:function(t,i){if(t.effectsManager){var r,n=[],a=t.data.ef,o=t.effectsManager.effectElements.length;for(r=0;r<o;r+=1)n.push(e(a[r],t.effectsManager.effectElements[r],i,t));var s=t.data.ef||[],l=function(e){for(r=0,o=s.length;r<o;){if(e===s[r].nm||e===s[r].mn||e===s[r].ix)return n[r];r+=1}return null};return Object.defineProperty(l,"numProperties",{get:function(){return s.length}}),l}return null}}}(),ShapePathInterface=function(e,t,i){var r=t.sh;function n(e){return"Shape"===e||"shape"===e||"Path"===e||"path"===e||"ADBE Vector Shape"===e||2===e?n.path:null}var a=propertyGroupFactory(n,i);return r.setGroupProperty(PropertyInterface("Path",a)),Object.defineProperties(n,{path:{get:function(){return r.k&&r.getValue(),r}},shape:{get:function(){return r.k&&r.getValue(),r}},_name:{value:e.nm},ix:{value:e.ix},propertyIndex:{value:e.ix},mn:{value:e.mn},propertyGroup:{value:i}}),n},ShapeExpressionInterface=function(){function e(e,o,d){var p,f=[],m=e?e.length:0;for(p=0;p<m;p+=1)"gr"===e[p].ty?f.push(t(e[p],o[p],d)):"fl"===e[p].ty?f.push(i(e[p],o[p],d)):"st"===e[p].ty?f.push(n(e[p],o[p],d)):"tm"===e[p].ty?f.push(a(e[p],o[p],d)):"tr"===e[p].ty||("el"===e[p].ty?f.push(s(e[p],o[p],d)):"sr"===e[p].ty?f.push(l(e[p],o[p],d)):"sh"===e[p].ty?f.push(ShapePathInterface(e[p],o[p],d)):"rc"===e[p].ty?f.push(c(e[p],o[p],d)):"rd"===e[p].ty?f.push(h(e[p],o[p],d)):"rp"===e[p].ty?f.push(u(e[p],o[p],d)):"gf"===e[p].ty?f.push(r(e[p],o[p],d)):f.push((e[p],o[p],function(){return null})));return f}function t(t,i,r){var n=function(e){switch(e){case"ADBE Vectors Group":case"Contents":case 2:return n.content;default:return n.transform}};n.propertyGroup=propertyGroupFactory(n,r);var a=function(t,i,r){var n,a=function(e){for(var t=0,i=n.length;t<i;){if(n[t]._name===e||n[t].mn===e||n[t].propertyIndex===e||n[t].ix===e||n[t].ind===e)return n[t];t+=1}return"number"===typeof e?n[e-1]:null};a.propertyGroup=propertyGroupFactory(a,r),n=e(t.it,i.it,a.propertyGroup),a.numProperties=n.length;var s=o(t.it[t.it.length-1],i.it[i.it.length-1],a.propertyGroup);return a.transform=s,a.propertyIndex=t.cix,a._name=t.nm,a}(t,i,n.propertyGroup),s=o(t.it[t.it.length-1],i.it[i.it.length-1],n.propertyGroup);return n.content=a,n.transform=s,Object.defineProperty(n,"_name",{get:function(){return t.nm}}),n.numProperties=t.np,n.propertyIndex=t.ix,n.nm=t.nm,n.mn=t.mn,n}function i(e,t,i){function r(e){return"Color"===e||"color"===e?r.color:"Opacity"===e||"opacity"===e?r.opacity:null}return Object.defineProperties(r,{color:{get:ExpressionPropertyInterface(t.c)},opacity:{get:ExpressionPropertyInterface(t.o)},_name:{value:e.nm},mn:{value:e.mn}}),t.c.setGroupProperty(PropertyInterface("Color",i)),t.o.setGroupProperty(PropertyInterface("Opacity",i)),r}function r(e,t,i){function r(e){return"Start Point"===e||"start point"===e?r.startPoint:"End Point"===e||"end point"===e?r.endPoint:"Opacity"===e||"opacity"===e?r.opacity:null}return Object.defineProperties(r,{startPoint:{get:ExpressionPropertyInterface(t.s)},endPoint:{get:ExpressionPropertyInterface(t.e)},opacity:{get:ExpressionPropertyInterface(t.o)},type:{get:function(){return"a"}},_name:{value:e.nm},mn:{value:e.mn}}),t.s.setGroupProperty(PropertyInterface("Start Point",i)),t.e.setGroupProperty(PropertyInterface("End Point",i)),t.o.setGroupProperty(PropertyInterface("Opacity",i)),r}function n(e,t,i){var r,n=propertyGroupFactory(c,i),a=propertyGroupFactory(l,n);function o(i){Object.defineProperty(l,e.d[i].nm,{get:ExpressionPropertyInterface(t.d.dataProps[i].p)})}var s=e.d?e.d.length:0,l={};for(r=0;r<s;r+=1)o(r),t.d.dataProps[r].p.setGroupProperty(a);function c(e){return"Color"===e||"color"===e?c.color:"Opacity"===e||"opacity"===e?c.opacity:"Stroke Width"===e||"stroke width"===e?c.strokeWidth:null}return Object.defineProperties(c,{color:{get:ExpressionPropertyInterface(t.c)},opacity:{get:ExpressionPropertyInterface(t.o)},strokeWidth:{get:ExpressionPropertyInterface(t.w)},dash:{get:function(){return l}},_name:{value:e.nm},mn:{value:e.mn}}),t.c.setGroupProperty(PropertyInterface("Color",n)),t.o.setGroupProperty(PropertyInterface("Opacity",n)),t.w.setGroupProperty(PropertyInterface("Stroke Width",n)),c}function a(e,t,i){function r(t){return t===e.e.ix||"End"===t||"end"===t?r.end:t===e.s.ix?r.start:t===e.o.ix?r.offset:null}var n=propertyGroupFactory(r,i);return r.propertyIndex=e.ix,t.s.setGroupProperty(PropertyInterface("Start",n)),t.e.setGroupProperty(PropertyInterface("End",n)),t.o.setGroupProperty(PropertyInterface("Offset",n)),r.propertyIndex=e.ix,r.propertyGroup=i,Object.defineProperties(r,{start:{get:ExpressionPropertyInterface(t.s)},end:{get:ExpressionPropertyInterface(t.e)},offset:{get:ExpressionPropertyInterface(t.o)},_name:{value:e.nm}}),r.mn=e.mn,r}function o(e,t,i){function r(t){return e.a.ix===t||"Anchor Point"===t?r.anchorPoint:e.o.ix===t||"Opacity"===t?r.opacity:e.p.ix===t||"Position"===t?r.position:e.r.ix===t||"Rotation"===t||"ADBE Vector Rotation"===t?r.rotation:e.s.ix===t||"Scale"===t?r.scale:e.sk&&e.sk.ix===t||"Skew"===t?r.skew:e.sa&&e.sa.ix===t||"Skew Axis"===t?r.skewAxis:null}var n=propertyGroupFactory(r,i);return t.transform.mProps.o.setGroupProperty(PropertyInterface("Opacity",n)),t.transform.mProps.p.setGroupProperty(PropertyInterface("Position",n)),t.transform.mProps.a.setGroupProperty(PropertyInterface("Anchor Point",n)),t.transform.mProps.s.setGroupProperty(PropertyInterface("Scale",n)),t.transform.mProps.r.setGroupProperty(PropertyInterface("Rotation",n)),t.transform.mProps.sk&&(t.transform.mProps.sk.setGroupProperty(PropertyInterface("Skew",n)),t.transform.mProps.sa.setGroupProperty(PropertyInterface("Skew Angle",n))),t.transform.op.setGroupProperty(PropertyInterface("Opacity",n)),Object.defineProperties(r,{opacity:{get:ExpressionPropertyInterface(t.transform.mProps.o)},position:{get:ExpressionPropertyInterface(t.transform.mProps.p)},anchorPoint:{get:ExpressionPropertyInterface(t.transform.mProps.a)},scale:{get:ExpressionPropertyInterface(t.transform.mProps.s)},rotation:{get:ExpressionPropertyInterface(t.transform.mProps.r)},skew:{get:ExpressionPropertyInterface(t.transform.mProps.sk)},skewAxis:{get:ExpressionPropertyInterface(t.transform.mProps.sa)},_name:{value:e.nm}}),r.ty="tr",r.mn=e.mn,r.propertyGroup=i,r}function s(e,t,i){function r(t){return e.p.ix===t?r.position:e.s.ix===t?r.size:null}var n=propertyGroupFactory(r,i);r.propertyIndex=e.ix;var a="tm"===t.sh.ty?t.sh.prop:t.sh;return a.s.setGroupProperty(PropertyInterface("Size",n)),a.p.setGroupProperty(PropertyInterface("Position",n)),Object.defineProperties(r,{size:{get:ExpressionPropertyInterface(a.s)},position:{get:ExpressionPropertyInterface(a.p)},_name:{value:e.nm}}),r.mn=e.mn,r}function l(e,t,i){function r(t){return e.p.ix===t?r.position:e.r.ix===t?r.rotation:e.pt.ix===t?r.points:e.or.ix===t||"ADBE Vector Star Outer Radius"===t?r.outerRadius:e.os.ix===t?r.outerRoundness:!e.ir||e.ir.ix!==t&&"ADBE Vector Star Inner Radius"!==t?e.is&&e.is.ix===t?r.innerRoundness:null:r.innerRadius}var n=propertyGroupFactory(r,i),a="tm"===t.sh.ty?t.sh.prop:t.sh;return r.propertyIndex=e.ix,a.or.setGroupProperty(PropertyInterface("Outer Radius",n)),a.os.setGroupProperty(PropertyInterface("Outer Roundness",n)),a.pt.setGroupProperty(PropertyInterface("Points",n)),a.p.setGroupProperty(PropertyInterface("Position",n)),a.r.setGroupProperty(PropertyInterface("Rotation",n)),e.ir&&(a.ir.setGroupProperty(PropertyInterface("Inner Radius",n)),a.is.setGroupProperty(PropertyInterface("Inner Roundness",n))),Object.defineProperties(r,{position:{get:ExpressionPropertyInterface(a.p)},rotation:{get:ExpressionPropertyInterface(a.r)},points:{get:ExpressionPropertyInterface(a.pt)},outerRadius:{get:ExpressionPropertyInterface(a.or)},outerRoundness:{get:ExpressionPropertyInterface(a.os)},innerRadius:{get:ExpressionPropertyInterface(a.ir)},innerRoundness:{get:ExpressionPropertyInterface(a.is)},_name:{value:e.nm}}),r.mn=e.mn,r}function c(e,t,i){function r(t){return e.p.ix===t?r.position:e.r.ix===t?r.roundness:e.s.ix===t||"Size"===t||"ADBE Vector Rect Size"===t?r.size:null}var n=propertyGroupFactory(r,i),a="tm"===t.sh.ty?t.sh.prop:t.sh;return r.propertyIndex=e.ix,a.p.setGroupProperty(PropertyInterface("Position",n)),a.s.setGroupProperty(PropertyInterface("Size",n)),a.r.setGroupProperty(PropertyInterface("Rotation",n)),Object.defineProperties(r,{position:{get:ExpressionPropertyInterface(a.p)},roundness:{get:ExpressionPropertyInterface(a.r)},size:{get:ExpressionPropertyInterface(a.s)},_name:{value:e.nm}}),r.mn=e.mn,r}function h(e,t,i){function r(t){return e.r.ix===t||"Round Corners 1"===t?r.radius:null}var n=propertyGroupFactory(r,i),a=t;return r.propertyIndex=e.ix,a.rd.setGroupProperty(PropertyInterface("Radius",n)),Object.defineProperties(r,{radius:{get:ExpressionPropertyInterface(a.rd)},_name:{value:e.nm}}),r.mn=e.mn,r}function u(e,t,i){function r(t){return e.c.ix===t||"Copies"===t?r.copies:e.o.ix===t||"Offset"===t?r.offset:null}var n=propertyGroupFactory(r,i),a=t;return r.propertyIndex=e.ix,a.c.setGroupProperty(PropertyInterface("Copies",n)),a.o.setGroupProperty(PropertyInterface("Offset",n)),Object.defineProperties(r,{copies:{get:ExpressionPropertyInterface(a.c)},offset:{get:ExpressionPropertyInterface(a.o)},_name:{value:e.nm}}),r.mn=e.mn,r}return function(t,i,r){var n;function a(e){if("number"===typeof e)return 0===(e=void 0===e?1:e)?r:n[e-1];for(var t=0,i=n.length;t<i;){if(n[t]._name===e)return n[t];t+=1}return null}return a.propertyGroup=propertyGroupFactory(a,(function(){return r})),n=e(t,i,a.propertyGroup),a.numProperties=n.length,a._name="Contents",a}}(),TextExpressionInterface=function(e){var t;function i(e){return"ADBE Text Document"===e?i.sourceText:null}return Object.defineProperty(i,"sourceText",{get:function(){e.textProperty.getValue();var i=e.textProperty.currentData.t;return t&&i===t.value||((t=new String(i)).value=i||new String(i),Object.defineProperty(t,"style",{get:function(){return{fillColor:e.textProperty.currentData.fc}}})),t}}),i};function _typeof(e){return _typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}var FootageInterface=function(){var e=function(e){function t(e){return"Outline"===e?t.outlineInterface():null}return t._name="Outline",t.outlineInterface=function(e){var t="",i=e.getFootageData();function r(e){if(i[e])return t=e,"object"===_typeof(i=i[e])?r:i;var n=e.indexOf(t);if(-1!==n){var a=parseInt(e.substr(n+t.length),10);return"object"===_typeof(i=i[a])?r:i}return""}return function(){return t="",i=e.getFootageData(),r}}(e),t};return function(t){function i(e){return"Data"===e?i.dataInterface:null}return i._name="Data",i.dataInterface=e(t),i}}(),interfaces={layer:LayerExpressionInterface,effects:EffectsExpressionInterface,comp:CompExpressionInterface,shape:ShapeExpressionInterface,text:TextExpressionInterface,footage:FootageInterface};function getInterface(e){return interfaces[e]||null}var expressionHelpers={searchExpressions:function(e,t,i){t.x&&(i.k=!0,i.x=!0,i.initiateExpression=ExpressionManager.initiateExpression,i.effectsSequence.push(i.initiateExpression(e,t,i).bind(i)))},getSpeedAtTime:function(e){var t=this.getValueAtTime(e),i=this.getValueAtTime(e+-.01),r=0;if(t.length){var n;for(n=0;n<t.length;n+=1)r+=Math.pow(i[n]-t[n],2);r=100*Math.sqrt(r)}else r=0;return r},getVelocityAtTime:function(e){if(void 0!==this.vel)return this.vel;var t,i,r=-.001,n=this.getValueAtTime(e),a=this.getValueAtTime(e+r);if(n.length)for(t=createTypedArray("float32",n.length),i=0;i<n.length;i+=1)t[i]=(a[i]-n[i])/r;else t=(a-n)/r;return t},getValueAtTime:function(e){return e*=this.elem.globalData.frameRate,(e-=this.offsetTime)!==this._cachingAtTime.lastFrame&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastFrame<e?this._cachingAtTime.lastIndex:0,this._cachingAtTime.value=this.interpolateValue(e,this._cachingAtTime),this._cachingAtTime.lastFrame=e),this._cachingAtTime.value},getStaticValueAtTime:function(){return this.pv},setGroupProperty:function(e){this.propertyGroup=e}};function addPropertyDecorator(){function e(e,t,i){if(!this.k||!this.keyframes)return this.pv;e=e?e.toLowerCase():"";var r,n,a,o,s,l=this.comp.renderedFrame,c=this.keyframes,h=c[c.length-1].t;if(l<=h)return this.pv;if(i?n=h-(r=t?Math.abs(h-this.elem.comp.globalData.frameRate*t):Math.max(0,h-this.elem.data.ip)):((!t||t>c.length-1)&&(t=c.length-1),r=h-(n=c[c.length-1-t].t)),"pingpong"===e){if(Math.floor((l-n)/r)%2!==0)return this.getValueAtTime((r-(l-n)%r+n)/this.comp.globalData.frameRate,0)}else{if("offset"===e){var u=this.getValueAtTime(n/this.comp.globalData.frameRate,0),d=this.getValueAtTime(h/this.comp.globalData.frameRate,0),p=this.getValueAtTime(((l-n)%r+n)/this.comp.globalData.frameRate,0),f=Math.floor((l-n)/r);if(this.pv.length){for(o=(s=new Array(u.length)).length,a=0;a<o;a+=1)s[a]=(d[a]-u[a])*f+p[a];return s}return(d-u)*f+p}if("continue"===e){var m=this.getValueAtTime(h/this.comp.globalData.frameRate,0),g=this.getValueAtTime((h-.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(o=(s=new Array(m.length)).length,a=0;a<o;a+=1)s[a]=m[a]+(m[a]-g[a])*((l-h)/this.comp.globalData.frameRate)/5e-4;return s}return m+(l-h)/.001*(m-g)}}return this.getValueAtTime(((l-n)%r+n)/this.comp.globalData.frameRate,0)}function t(e,t,i){if(!this.k)return this.pv;e=e?e.toLowerCase():"";var r,n,a,o,s,l=this.comp.renderedFrame,c=this.keyframes,h=c[0].t;if(l>=h)return this.pv;if(i?n=h+(r=t?Math.abs(this.elem.comp.globalData.frameRate*t):Math.max(0,this.elem.data.op-h)):((!t||t>c.length-1)&&(t=c.length-1),r=(n=c[t].t)-h),"pingpong"===e){if(Math.floor((h-l)/r)%2===0)return this.getValueAtTime(((h-l)%r+h)/this.comp.globalData.frameRate,0)}else{if("offset"===e){var u=this.getValueAtTime(h/this.comp.globalData.frameRate,0),d=this.getValueAtTime(n/this.comp.globalData.frameRate,0),p=this.getValueAtTime((r-(h-l)%r+h)/this.comp.globalData.frameRate,0),f=Math.floor((h-l)/r)+1;if(this.pv.length){for(o=(s=new Array(u.length)).length,a=0;a<o;a+=1)s[a]=p[a]-(d[a]-u[a])*f;return s}return p-(d-u)*f}if("continue"===e){var m=this.getValueAtTime(h/this.comp.globalData.frameRate,0),g=this.getValueAtTime((h+.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(o=(s=new Array(m.length)).length,a=0;a<o;a+=1)s[a]=m[a]+(m[a]-g[a])*(h-l)/.001;return s}return m+(m-g)*(h-l)/.001}}return this.getValueAtTime((r-((h-l)%r+h))/this.comp.globalData.frameRate,0)}function i(e,t){if(!this.k)return this.pv;if(e=.5*(e||.4),(t=Math.floor(t||5))<=1)return this.pv;var i,r,n=this.comp.renderedFrame/this.comp.globalData.frameRate,a=n-e,o=t>1?(n+e-a)/(t-1):1,s=0,l=0;for(i=this.pv.length?createTypedArray("float32",this.pv.length):0;s<t;){if(r=this.getValueAtTime(a+s*o),this.pv.length)for(l=0;l<this.pv.length;l+=1)i[l]+=r[l];else i+=r;s+=1}if(this.pv.length)for(l=0;l<this.pv.length;l+=1)i[l]/=t;else i/=t;return i}function r(e){this._transformCachingAtTime||(this._transformCachingAtTime={v:new Matrix});var t=this._transformCachingAtTime.v;if(t.cloneFromProps(this.pre.props),this.appliedTransformations<1){var i=this.a.getValueAtTime(e);t.translate(-i[0]*this.a.mult,-i[1]*this.a.mult,i[2]*this.a.mult)}if(this.appliedTransformations<2){var r=this.s.getValueAtTime(e);t.scale(r[0]*this.s.mult,r[1]*this.s.mult,r[2]*this.s.mult)}if(this.sk&&this.appliedTransformations<3){var n=this.sk.getValueAtTime(e),a=this.sa.getValueAtTime(e);t.skewFromAxis(-n*this.sk.mult,a*this.sa.mult)}if(this.r&&this.appliedTransformations<4){var o=this.r.getValueAtTime(e);t.rotate(-o*this.r.mult)}else if(!this.r&&this.appliedTransformations<4){var s=this.rz.getValueAtTime(e),l=this.ry.getValueAtTime(e),c=this.rx.getValueAtTime(e),h=this.or.getValueAtTime(e);t.rotateZ(-s*this.rz.mult).rotateY(l*this.ry.mult).rotateX(c*this.rx.mult).rotateZ(-h[2]*this.or.mult).rotateY(h[1]*this.or.mult).rotateX(h[0]*this.or.mult)}if(this.data.p&&this.data.p.s){var u=this.px.getValueAtTime(e),d=this.py.getValueAtTime(e);if(this.data.p.z){var p=this.pz.getValueAtTime(e);t.translate(u*this.px.mult,d*this.py.mult,-p*this.pz.mult)}else t.translate(u*this.px.mult,d*this.py.mult,0)}else{var f=this.p.getValueAtTime(e);t.translate(f[0]*this.p.mult,f[1]*this.p.mult,-f[2]*this.p.mult)}return t}function n(){return this.v.clone(new Matrix)}var a=TransformPropertyFactory.getTransformProperty;TransformPropertyFactory.getTransformProperty=function(e,t,i){var o=a(e,t,i);return o.dynamicProperties.length?o.getValueAtTime=r.bind(o):o.getValueAtTime=n.bind(o),o.setGroupProperty=expressionHelpers.setGroupProperty,o};var o=PropertyFactory.getProp;PropertyFactory.getProp=function(r,n,a,s,l){var c=o(r,n,a,s,l);c.kf?c.getValueAtTime=expressionHelpers.getValueAtTime.bind(c):c.getValueAtTime=expressionHelpers.getStaticValueAtTime.bind(c),c.setGroupProperty=expressionHelpers.setGroupProperty,c.loopOut=e,c.loopIn=t,c.smooth=i,c.getVelocityAtTime=expressionHelpers.getVelocityAtTime.bind(c),c.getSpeedAtTime=expressionHelpers.getSpeedAtTime.bind(c),c.numKeys=1===n.a?n.k.length:0,c.propertyIndex=n.ix;var h=0;return 0!==a&&(h=createTypedArray("float32",1===n.a?n.k[0].s.length:n.k.length)),c._cachingAtTime={lastFrame:initialDefaultFrame,lastIndex:0,value:h},expressionHelpers.searchExpressions(r,n,c),c.k&&l.addDynamicProperty(c),c};var s=ShapePropertyFactory.getConstructorFunction(),l=ShapePropertyFactory.getKeyframedConstructorFunction();function c(){}c.prototype={vertices:function(e,t){this.k&&this.getValue();var i,r=this.v;void 0!==t&&(r=this.getValueAtTime(t,0));var n=r._length,a=r[e],o=r.v,s=createSizedArray(n);for(i=0;i<n;i+=1)s[i]="i"===e||"o"===e?[a[i][0]-o[i][0],a[i][1]-o[i][1]]:[a[i][0],a[i][1]];return s},points:function(e){return this.vertices("v",e)},inTangents:function(e){return this.vertices("i",e)},outTangents:function(e){return this.vertices("o",e)},isClosed:function(){return this.v.c},pointOnPath:function(e,t){var i=this.v;void 0!==t&&(i=this.getValueAtTime(t,0)),this._segmentsLength||(this._segmentsLength=bez.getSegmentsLength(i));for(var r,n=this._segmentsLength,a=n.lengths,o=n.totalLength*e,s=0,l=a.length,c=0;s<l;){if(c+a[s].addedLength>o){var h=s,u=i.c&&s===l-1?0:s+1,d=(o-c)/a[s].addedLength;r=bez.getPointInSegment(i.v[h],i.v[u],i.o[h],i.i[u],d,a[s]);break}c+=a[s].addedLength,s+=1}return r||(r=i.c?[i.v[0][0],i.v[0][1]]:[i.v[i._length-1][0],i.v[i._length-1][1]]),r},vectorOnPath:function(e,t,i){1==e?e=this.v.c:0==e&&(e=.999);var r=this.pointOnPath(e,t),n=this.pointOnPath(e+.001,t),a=n[0]-r[0],o=n[1]-r[1],s=Math.sqrt(Math.pow(a,2)+Math.pow(o,2));return 0===s?[0,0]:"tangent"===i?[a/s,o/s]:[-o/s,a/s]},tangentOnPath:function(e,t){return this.vectorOnPath(e,t,"tangent")},normalOnPath:function(e,t){return this.vectorOnPath(e,t,"normal")},setGroupProperty:expressionHelpers.setGroupProperty,getValueAtTime:expressionHelpers.getStaticValueAtTime},extendPrototype([c],s),extendPrototype([c],l),l.prototype.getValueAtTime=function(e){return this._cachingAtTime||(this._cachingAtTime={shapeValue:shapePool.clone(this.pv),lastIndex:0,lastTime:initialDefaultFrame}),e*=this.elem.globalData.frameRate,(e-=this.offsetTime)!==this._cachingAtTime.lastTime&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastTime<e?this._caching.lastIndex:0,this._cachingAtTime.lastTime=e,this.interpolateShape(e,this._cachingAtTime.shapeValue,this._cachingAtTime)),this._cachingAtTime.shapeValue},l.prototype.initiateExpression=ExpressionManager.initiateExpression;var h=ShapePropertyFactory.getShapeProp;ShapePropertyFactory.getShapeProp=function(e,t,i,r,n){var a=h(e,t,i,r,n);return a.propertyIndex=t.ix,a.lock=!1,3===i?expressionHelpers.searchExpressions(e,t.pt,a):4===i&&expressionHelpers.searchExpressions(e,t.ks,a),a.k&&e.addDynamicProperty(a),a}}function initialize$1(){addPropertyDecorator()}function addDecorator(){TextProperty.prototype.getExpressionValue=function(e,t){var i=this.calculateExpression(t);if(e.t!==i){var r={};return this.copyData(r,e),r.t=i.toString(),r.__complete=!1,r}return e},TextProperty.prototype.searchProperty=function(){var e=this.searchKeyframes(),t=this.searchExpressions();return this.kf=e||t,this.kf},TextProperty.prototype.searchExpressions=function(){return this.data.d.x?(this.calculateExpression=ExpressionManager.initiateExpression.bind(this)(this.elem,this.data.d,this),this.addEffect(this.getExpressionValue.bind(this)),!0):null}}function initialize(){addDecorator()}function SVGComposableEffect(){}SVGComposableEffect.prototype={createMergeNode:function(e,t){var i,r,n=createNS("feMerge");for(n.setAttribute("result",e),r=0;r<t.length;r+=1)(i=createNS("feMergeNode")).setAttribute("in",t[r]),n.appendChild(i),n.appendChild(i);return n}};var linearFilterValue="0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0";function SVGTintFilter(e,t,i,r,n){this.filterManager=t;var a=createNS("feColorMatrix");a.setAttribute("type","matrix"),a.setAttribute("color-interpolation-filters","linearRGB"),a.setAttribute("values",linearFilterValue+" 1 0"),this.linearFilter=a,a.setAttribute("result",r+"_tint_1"),e.appendChild(a),(a=createNS("feColorMatrix")).setAttribute("type","matrix"),a.setAttribute("color-interpolation-filters","sRGB"),a.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),a.setAttribute("result",r+"_tint_2"),e.appendChild(a),this.matrixFilter=a;var o=this.createMergeNode(r,[n,r+"_tint_1",r+"_tint_2"]);e.appendChild(o)}function SVGFillFilter(e,t,i,r){this.filterManager=t;var n=createNS("feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),n.setAttribute("result",r),e.appendChild(n),this.matrixFilter=n}function SVGStrokeEffect(e,t,i){this.initialized=!1,this.filterManager=t,this.elem=i,this.paths=[]}function SVGTritoneFilter(e,t,i,r){this.filterManager=t;var n=createNS("feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("color-interpolation-filters","linearRGB"),n.setAttribute("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0"),e.appendChild(n);var a=createNS("feComponentTransfer");a.setAttribute("color-interpolation-filters","sRGB"),a.setAttribute("result",r),this.matrixFilter=a;var o=createNS("feFuncR");o.setAttribute("type","table"),a.appendChild(o),this.feFuncR=o;var s=createNS("feFuncG");s.setAttribute("type","table"),a.appendChild(s),this.feFuncG=s;var l=createNS("feFuncB");l.setAttribute("type","table"),a.appendChild(l),this.feFuncB=l,e.appendChild(a)}function SVGProLevelsFilter(e,t,i,r){this.filterManager=t;var n=this.filterManager.effectElements,a=createNS("feComponentTransfer");(n[10].p.k||0!==n[10].p.v||n[11].p.k||1!==n[11].p.v||n[12].p.k||1!==n[12].p.v||n[13].p.k||0!==n[13].p.v||n[14].p.k||1!==n[14].p.v)&&(this.feFuncR=this.createFeFunc("feFuncR",a)),(n[17].p.k||0!==n[17].p.v||n[18].p.k||1!==n[18].p.v||n[19].p.k||1!==n[19].p.v||n[20].p.k||0!==n[20].p.v||n[21].p.k||1!==n[21].p.v)&&(this.feFuncG=this.createFeFunc("feFuncG",a)),(n[24].p.k||0!==n[24].p.v||n[25].p.k||1!==n[25].p.v||n[26].p.k||1!==n[26].p.v||n[27].p.k||0!==n[27].p.v||n[28].p.k||1!==n[28].p.v)&&(this.feFuncB=this.createFeFunc("feFuncB",a)),(n[31].p.k||0!==n[31].p.v||n[32].p.k||1!==n[32].p.v||n[33].p.k||1!==n[33].p.v||n[34].p.k||0!==n[34].p.v||n[35].p.k||1!==n[35].p.v)&&(this.feFuncA=this.createFeFunc("feFuncA",a)),(this.feFuncR||this.feFuncG||this.feFuncB||this.feFuncA)&&(a.setAttribute("color-interpolation-filters","sRGB"),e.appendChild(a)),(n[3].p.k||0!==n[3].p.v||n[4].p.k||1!==n[4].p.v||n[5].p.k||1!==n[5].p.v||n[6].p.k||0!==n[6].p.v||n[7].p.k||1!==n[7].p.v)&&((a=createNS("feComponentTransfer")).setAttribute("color-interpolation-filters","sRGB"),a.setAttribute("result",r),e.appendChild(a),this.feFuncRComposed=this.createFeFunc("feFuncR",a),this.feFuncGComposed=this.createFeFunc("feFuncG",a),this.feFuncBComposed=this.createFeFunc("feFuncB",a))}function SVGDropShadowEffect(e,t,i,r,n){var a=t.container.globalData.renderConfig.filterSize,o=t.data.fs||a;e.setAttribute("x",o.x||a.x),e.setAttribute("y",o.y||a.y),e.setAttribute("width",o.width||a.width),e.setAttribute("height",o.height||a.height),this.filterManager=t;var s=createNS("feGaussianBlur");s.setAttribute("in","SourceAlpha"),s.setAttribute("result",r+"_drop_shadow_1"),s.setAttribute("stdDeviation","0"),this.feGaussianBlur=s,e.appendChild(s);var l=createNS("feOffset");l.setAttribute("dx","25"),l.setAttribute("dy","0"),l.setAttribute("in",r+"_drop_shadow_1"),l.setAttribute("result",r+"_drop_shadow_2"),this.feOffset=l,e.appendChild(l);var c=createNS("feFlood");c.setAttribute("flood-color","#00ff00"),c.setAttribute("flood-opacity","1"),c.setAttribute("result",r+"_drop_shadow_3"),this.feFlood=c,e.appendChild(c);var h=createNS("feComposite");h.setAttribute("in",r+"_drop_shadow_3"),h.setAttribute("in2",r+"_drop_shadow_2"),h.setAttribute("operator","in"),h.setAttribute("result",r+"_drop_shadow_4"),e.appendChild(h);var u=this.createMergeNode(r,[r+"_drop_shadow_4",n]);e.appendChild(u)}extendPrototype([SVGComposableEffect],SVGTintFilter),SVGTintFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t=this.filterManager.effectElements[0].p.v,i=this.filterManager.effectElements[1].p.v,r=this.filterManager.effectElements[2].p.v/100;this.linearFilter.setAttribute("values",linearFilterValue+" "+r+" 0"),this.matrixFilter.setAttribute("values",i[0]-t[0]+" 0 0 0 "+t[0]+" "+(i[1]-t[1])+" 0 0 0 "+t[1]+" "+(i[2]-t[2])+" 0 0 0 "+t[2]+" 0 0 0 1 0")}},SVGFillFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t=this.filterManager.effectElements[2].p.v,i=this.filterManager.effectElements[6].p.v;this.matrixFilter.setAttribute("values","0 0 0 0 "+t[0]+" 0 0 0 0 "+t[1]+" 0 0 0 0 "+t[2]+" 0 0 0 "+i+" 0")}},SVGStrokeEffect.prototype.initialize=function(){var e,t,i,r,n=this.elem.layerElement.children||this.elem.layerElement.childNodes;for(1===this.filterManager.effectElements[1].p.v?(r=this.elem.maskManager.masksProperties.length,i=0):r=1+(i=this.filterManager.effectElements[0].p.v-1),(t=createNS("g")).setAttribute("fill","none"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-dashoffset",1);i<r;i+=1)e=createNS("path"),t.appendChild(e),this.paths.push({p:e,m:i});if(3===this.filterManager.effectElements[10].p.v){var a=createNS("mask"),o=createElementID();a.setAttribute("id",o),a.setAttribute("mask-type","alpha"),a.appendChild(t),this.elem.globalData.defs.appendChild(a);var s=createNS("g");for(s.setAttribute("mask","url("+getLocationHref()+"#"+o+")");n[0];)s.appendChild(n[0]);this.elem.layerElement.appendChild(s),this.masker=a,t.setAttribute("stroke","#fff")}else if(1===this.filterManager.effectElements[10].p.v||2===this.filterManager.effectElements[10].p.v){if(2===this.filterManager.effectElements[10].p.v)for(n=this.elem.layerElement.children||this.elem.layerElement.childNodes;n.length;)this.elem.layerElement.removeChild(n[0]);this.elem.layerElement.appendChild(t),this.elem.layerElement.removeAttribute("mask"),t.setAttribute("stroke","#fff")}this.initialized=!0,this.pathMasker=t},SVGStrokeEffect.prototype.renderFrame=function(e){var t;this.initialized||this.initialize();var i,r,n=this.paths.length;for(t=0;t<n;t+=1)if(-1!==this.paths[t].m&&(i=this.elem.maskManager.viewData[this.paths[t].m],r=this.paths[t].p,(e||this.filterManager._mdf||i.prop._mdf)&&r.setAttribute("d",i.lastPath),e||this.filterManager.effectElements[9].p._mdf||this.filterManager.effectElements[4].p._mdf||this.filterManager.effectElements[7].p._mdf||this.filterManager.effectElements[8].p._mdf||i.prop._mdf)){var a;if(0!==this.filterManager.effectElements[7].p.v||100!==this.filterManager.effectElements[8].p.v){var o=.01*Math.min(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v),s=.01*Math.max(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v),l=r.getTotalLength();a="0 0 0 "+l*o+" ";var c,h=l*(s-o),u=1+2*this.filterManager.effectElements[4].p.v*this.filterManager.effectElements[9].p.v*.01,d=Math.floor(h/u);for(c=0;c<d;c+=1)a+="1 "+2*this.filterManager.effectElements[4].p.v*this.filterManager.effectElements[9].p.v*.01+" ";a+="0 "+10*l+" 0 0"}else a="1 "+2*this.filterManager.effectElements[4].p.v*this.filterManager.effectElements[9].p.v*.01;r.setAttribute("stroke-dasharray",a)}if((e||this.filterManager.effectElements[4].p._mdf)&&this.pathMasker.setAttribute("stroke-width",2*this.filterManager.effectElements[4].p.v),(e||this.filterManager.effectElements[6].p._mdf)&&this.pathMasker.setAttribute("opacity",this.filterManager.effectElements[6].p.v),(1===this.filterManager.effectElements[10].p.v||2===this.filterManager.effectElements[10].p.v)&&(e||this.filterManager.effectElements[3].p._mdf)){var p=this.filterManager.effectElements[3].p.v;this.pathMasker.setAttribute("stroke","rgb("+bmFloor(255*p[0])+","+bmFloor(255*p[1])+","+bmFloor(255*p[2])+")")}},SVGTritoneFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t=this.filterManager.effectElements[0].p.v,i=this.filterManager.effectElements[1].p.v,r=this.filterManager.effectElements[2].p.v,n=r[0]+" "+i[0]+" "+t[0],a=r[1]+" "+i[1]+" "+t[1],o=r[2]+" "+i[2]+" "+t[2];this.feFuncR.setAttribute("tableValues",n),this.feFuncG.setAttribute("tableValues",a),this.feFuncB.setAttribute("tableValues",o)}},SVGProLevelsFilter.prototype.createFeFunc=function(e,t){var i=createNS(e);return i.setAttribute("type","table"),t.appendChild(i),i},SVGProLevelsFilter.prototype.getTableValue=function(e,t,i,r,n){for(var a,o,s=0,l=Math.min(e,t),c=Math.max(e,t),h=Array.call(null,{length:256}),u=0,d=n-r,p=t-e;s<=256;)o=(a=s/256)<=l?p<0?n:r:a>=c?p<0?r:n:r+d*Math.pow((a-e)/p,1/i),h[u]=o,u+=1,s+=256/255;return h.join(" ")},SVGProLevelsFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t,i=this.filterManager.effectElements;this.feFuncRComposed&&(e||i[3].p._mdf||i[4].p._mdf||i[5].p._mdf||i[6].p._mdf||i[7].p._mdf)&&(t=this.getTableValue(i[3].p.v,i[4].p.v,i[5].p.v,i[6].p.v,i[7].p.v),this.feFuncRComposed.setAttribute("tableValues",t),this.feFuncGComposed.setAttribute("tableValues",t),this.feFuncBComposed.setAttribute("tableValues",t)),this.feFuncR&&(e||i[10].p._mdf||i[11].p._mdf||i[12].p._mdf||i[13].p._mdf||i[14].p._mdf)&&(t=this.getTableValue(i[10].p.v,i[11].p.v,i[12].p.v,i[13].p.v,i[14].p.v),this.feFuncR.setAttribute("tableValues",t)),this.feFuncG&&(e||i[17].p._mdf||i[18].p._mdf||i[19].p._mdf||i[20].p._mdf||i[21].p._mdf)&&(t=this.getTableValue(i[17].p.v,i[18].p.v,i[19].p.v,i[20].p.v,i[21].p.v),this.feFuncG.setAttribute("tableValues",t)),this.feFuncB&&(e||i[24].p._mdf||i[25].p._mdf||i[26].p._mdf||i[27].p._mdf||i[28].p._mdf)&&(t=this.getTableValue(i[24].p.v,i[25].p.v,i[26].p.v,i[27].p.v,i[28].p.v),this.feFuncB.setAttribute("tableValues",t)),this.feFuncA&&(e||i[31].p._mdf||i[32].p._mdf||i[33].p._mdf||i[34].p._mdf||i[35].p._mdf)&&(t=this.getTableValue(i[31].p.v,i[32].p.v,i[33].p.v,i[34].p.v,i[35].p.v),this.feFuncA.setAttribute("tableValues",t))}},extendPrototype([SVGComposableEffect],SVGDropShadowEffect),SVGDropShadowEffect.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){if((e||this.filterManager.effectElements[4].p._mdf)&&this.feGaussianBlur.setAttribute("stdDeviation",this.filterManager.effectElements[4].p.v/4),e||this.filterManager.effectElements[0].p._mdf){var t=this.filterManager.effectElements[0].p.v;this.feFlood.setAttribute("flood-color",rgbToHex(Math.round(255*t[0]),Math.round(255*t[1]),Math.round(255*t[2])))}if((e||this.filterManager.effectElements[1].p._mdf)&&this.feFlood.setAttribute("flood-opacity",this.filterManager.effectElements[1].p.v/255),e||this.filterManager.effectElements[2].p._mdf||this.filterManager.effectElements[3].p._mdf){var i=this.filterManager.effectElements[3].p.v,r=(this.filterManager.effectElements[2].p.v-90)*degToRads,n=i*Math.cos(r),a=i*Math.sin(r);this.feOffset.setAttribute("dx",n),this.feOffset.setAttribute("dy",a)}}};var _svgMatteSymbols=[];function SVGMatte3Effect(e,t,i){this.initialized=!1,this.filterManager=t,this.filterElem=e,this.elem=i,i.matteElement=createNS("g"),i.matteElement.appendChild(i.layerElement),i.matteElement.appendChild(i.transformedElement),i.baseElement=i.matteElement}function SVGGaussianBlurEffect(e,t,i,r){e.setAttribute("x","-100%"),e.setAttribute("y","-100%"),e.setAttribute("width","300%"),e.setAttribute("height","300%"),this.filterManager=t;var n=createNS("feGaussianBlur");n.setAttribute("result",r),e.appendChild(n),this.feGaussianBlur=n}function TransformEffect(){}function SVGTransformEffect(e,t){this.init(t)}function CVTransformEffect(e){this.init(e)}return SVGMatte3Effect.prototype.findSymbol=function(e){for(var t=0,i=_svgMatteSymbols.length;t<i;){if(_svgMatteSymbols[t]===e)return _svgMatteSymbols[t];t+=1}return null},SVGMatte3Effect.prototype.replaceInParent=function(e,t){var i=e.layerElement.parentNode;if(i){for(var r,n=i.children,a=0,o=n.length;a<o&&n[a]!==e.layerElement;)a+=1;a<=o-2&&(r=n[a+1]);var s=createNS("use");s.setAttribute("href","#"+t),r?i.insertBefore(s,r):i.appendChild(s)}},SVGMatte3Effect.prototype.setElementAsMask=function(e,t){if(!this.findSymbol(t)){var i=createElementID(),r=createNS("mask");r.setAttribute("id",t.layerId),r.setAttribute("mask-type","alpha"),_svgMatteSymbols.push(t);var n=e.globalData.defs;n.appendChild(r);var a=createNS("symbol");a.setAttribute("id",i),this.replaceInParent(t,i),a.appendChild(t.layerElement),n.appendChild(a);var o=createNS("use");o.setAttribute("href","#"+i),r.appendChild(o),t.data.hd=!1,t.show()}e.setMatte(t.layerId)},SVGMatte3Effect.prototype.initialize=function(){for(var e=this.filterManager.effectElements[0].p.v,t=this.elem.comp.elements,i=0,r=t.length;i<r;)t[i]&&t[i].data.ind===e&&this.setElementAsMask(this.elem,t[i]),i+=1;this.initialized=!0},SVGMatte3Effect.prototype.renderFrame=function(){this.initialized||this.initialize()},SVGGaussianBlurEffect.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var t=.3*this.filterManager.effectElements[0].p.v,i=this.filterManager.effectElements[1].p.v,r=3==i?0:t,n=2==i?0:t;this.feGaussianBlur.setAttribute("stdDeviation",r+" "+n);var a=1==this.filterManager.effectElements[2].p.v?"wrap":"duplicate";this.feGaussianBlur.setAttribute("edgeMode",a)}},TransformEffect.prototype.init=function(e){this.effectsManager=e,this.type=effectTypes.TRANSFORM_EFFECT,this.matrix=new Matrix,this.opacity=-1,this._mdf=!1,this._opMdf=!1},TransformEffect.prototype.renderFrame=function(e){if(this._opMdf=!1,this._mdf=!1,e||this.effectsManager._mdf){var t=this.effectsManager.effectElements,i=t[0].p.v,r=t[1].p.v,n=1===t[2].p.v,a=t[3].p.v,o=n?a:t[4].p.v,s=t[5].p.v,l=t[6].p.v,c=t[7].p.v;this.matrix.reset(),this.matrix.translate(-i[0],-i[1],i[2]),this.matrix.scale(.01*o,.01*a,1),this.matrix.rotate(-c*degToRads),this.matrix.skewFromAxis(-s*degToRads,(l+90)*degToRads),this.matrix.translate(r[0],r[1],0),this._mdf=!0,this.opacity!==t[8].p.v&&(this.opacity=t[8].p.v,this._opMdf=!0)}},extendPrototype([TransformEffect],SVGTransformEffect),extendPrototype([TransformEffect],CVTransformEffect),registerRenderer("canvas",CanvasRenderer),registerRenderer("html",HybridRenderer),registerRenderer("svg",SVGRenderer),ShapeModifiers.registerModifier("tm",TrimModifier),ShapeModifiers.registerModifier("pb",PuckerAndBloatModifier),ShapeModifiers.registerModifier("rp",RepeaterModifier),ShapeModifiers.registerModifier("rd",RoundCornersModifier),ShapeModifiers.registerModifier("zz",ZigZagModifier),ShapeModifiers.registerModifier("op",OffsetPathModifier),setExpressionsPlugin(Expressions),setExpressionInterfaces(getInterface),initialize$1(),initialize(),registerEffect$1(20,SVGTintFilter,!0),registerEffect$1(21,SVGFillFilter,!0),registerEffect$1(22,SVGStrokeEffect,!1),registerEffect$1(23,SVGTritoneFilter,!0),registerEffect$1(24,SVGProLevelsFilter,!0),registerEffect$1(25,SVGDropShadowEffect,!0),registerEffect$1(28,SVGMatte3Effect,!1),registerEffect$1(29,SVGGaussianBlurEffect,!0),registerEffect$1(35,SVGTransformEffect,!1),registerEffect(35,CVTransformEffect),lottie},module.exports=factory())},879:function(e){e.exports=function(){"use strict";var e,t,i;function r(r,n){if(e)if(t){var a="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",o={};e(o),i=n(o),"undefined"!==typeof window&&window&&window.URL&&window.URL.createObjectURL&&(i.workerUrl=window.URL.createObjectURL(new Blob([a],{type:"text/javascript"})))}else t=n;else e=n}return r(["exports"],(function(e){var t="3.4.0";let i;const r={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==i){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{i=null!={NODE_ENV:"production",PUBLIC_URL:"/keepers_app",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_MAPBOX_TOKEN:"pk.eyJ1Ijoia2llZmVycyIsImEiOiJjbHhwbWJvMWYwcWx3MmpzZXNxdGhqd3d4In0.oB6CUshVEfETHORooOun_w"}.API_URL_REGEX?new RegExp({NODE_ENV:"production",PUBLIC_URL:"/keepers_app",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_MAPBOX_TOKEN:"pk.eyJ1Ijoia2llZmVycyIsImEiOiJjbHhwbWJvMWYwcWx3MmpzZXNxdGhqd3d4In0.oB6CUshVEfETHORooOun_w"}.API_URL_REGEX):e}catch(t){i=e}}return i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!r.API_URL)return null;try{const e=new URL(r.API_URL);return"api.mapbox.cn"===e.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===e.hostname?"https://events.mapbox.com/events/v2":null}catch(e){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function n(e){return r.API_URL_REGEX.test(e)}function a(e){return 0===e.indexOf("mapbox:")}function o(e){return r.API_CDN_URL_REGEX.test(e)}function s(e){return r.API_SPRITE_REGEX.test(e)}function l(e){return r.API_STYLE_REGEX.test(e)&&!s(e)}const c={create:"create",load:"load",fullLoad:"fullLoad"};function h(e){const t=e.name.split("?")[0];return o(t)&&t.includes("mapbox-gl.js")?"javascript":o(t)&&t.includes("mapbox-gl.css")?"css":function(e){return r.API_FONTS_REGEX.test(e)}(t)?"fontRange":s(t)?"sprite":l(t)?"style":function(e){return r.API_TILEJSON_REGEX.test(e)}(t)?"tilejson":"other"}function u(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var d={},p={};Object.defineProperty(p,"__esModule",{value:!0}),p.setMatrixArrayType=function(e){p.ARRAY_TYPE=m=e},p.toRadian=function(e){return e*_},p.equals=function(e,t){return Math.abs(e-t)<=f*Math.max(1,Math.abs(e),Math.abs(t))},p.RANDOM=p.ARRAY_TYPE=p.EPSILON=void 0;var f=1e-6;p.EPSILON=f;var m="undefined"!=typeof Float32Array?Float32Array:Array;p.ARRAY_TYPE=m;var g=Math.random;p.RANDOM=g;var _=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var y={};function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}Object.defineProperty(y,"__esModule",{value:!0}),y.create=function(){var e=new x.ARRAY_TYPE(4);return x.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},y.clone=function(e){var t=new x.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},y.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},y.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},y.fromValues=function(e,t,i,r){var n=new x.ARRAY_TYPE(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n},y.set=function(e,t,i,r,n){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e},y.transpose=function(e,t){if(e===t){var i=t[1];e[1]=t[2],e[2]=i}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},y.invert=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=i*a-n*r;return o?(e[0]=a*(o=1/o),e[1]=-r*o,e[2]=-n*o,e[3]=i*o,e):null},y.adjoint=function(e,t){var i=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=i,e},y.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},y.multiply=w,y.rotate=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(i),l=Math.cos(i);return e[0]=r*l+a*s,e[1]=n*l+o*s,e[2]=r*-s+a*l,e[3]=n*-s+o*l,e},y.scale=function(e,t,i){var r=t[1],n=t[2],a=t[3],o=i[0],s=i[1];return e[0]=t[0]*o,e[1]=r*o,e[2]=n*s,e[3]=a*s,e},y.fromRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e},y.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},y.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},y.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},y.LDU=function(e,t,i,r){return e[2]=r[2]/r[0],i[0]=r[0],i[1]=r[1],i[3]=r[3]-e[2]*i[1],[e,t,i]},y.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},y.subtract=S,y.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},y.equals=function(e,t){var i=e[0],r=e[1],n=e[2],a=e[3],o=t[0],s=t[1],l=t[2],c=t[3];return Math.abs(i-o)<=x.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-s)<=x.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-l)<=x.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-c)<=x.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))},y.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},y.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e},y.sub=y.mul=void 0;var x=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==v(e)&&"function"!=typeof e)return{default:e};var i=b(void 0);if(i&&i.has(e))return i.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=n?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,i&&i.set(e,r),r}(p);function b(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(b=function(e){return e?i:t})(e)}function w(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=i[0],l=i[1],c=i[2],h=i[3];return e[0]=r*s+a*l,e[1]=n*s+o*l,e[2]=r*c+a*h,e[3]=n*c+o*h,e}function S(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}y.mul=w,y.sub=S;var T={};function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}Object.defineProperty(T,"__esModule",{value:!0}),T.create=function(){var e=new M.ARRAY_TYPE(6);return M.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},T.clone=function(e){var t=new M.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},T.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},T.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},T.fromValues=function(e,t,i,r,n,a){var o=new M.ARRAY_TYPE(6);return o[0]=e,o[1]=t,o[2]=i,o[3]=r,o[4]=n,o[5]=a,o},T.set=function(e,t,i,r,n,a,o){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=a,e[5]=o,e},T.invert=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=i*a-r*n;return l?(e[0]=a*(l=1/l),e[1]=-r*l,e[2]=-n*l,e[3]=i*l,e[4]=(n*s-a*o)*l,e[5]=(r*o-i*s)*l,e):null},T.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},T.multiply=P,T.rotate=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=Math.sin(i),h=Math.cos(i);return e[0]=r*h+a*c,e[1]=n*h+o*c,e[2]=r*-c+a*h,e[3]=n*-c+o*h,e[4]=s,e[5]=l,e},T.scale=function(e,t,i){var r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=i[0],c=i[1];return e[0]=t[0]*l,e[1]=r*l,e[2]=n*c,e[3]=a*c,e[4]=o,e[5]=s,e},T.translate=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=i[0],h=i[1];return e[0]=r,e[1]=n,e[2]=a,e[3]=o,e[4]=r*c+a*h+s,e[5]=n*c+o*h+l,e},T.fromRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=-i,e[3]=r,e[4]=0,e[5]=0,e},T.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},T.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},T.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},T.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)},T.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e},T.subtract=C,T.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e},T.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e},T.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},T.equals=function(e,t){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],l=t[0],c=t[1],h=t[2],u=t[3],d=t[4],p=t[5];return Math.abs(i-l)<=M.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-c)<=M.EPSILON*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-h)<=M.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(a-u)<=M.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(o-d)<=M.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(s-p)<=M.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))},T.sub=T.mul=void 0;var M=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==E(e)&&"function"!=typeof e)return{default:e};var i=A(void 0);if(i&&i.has(e))return i.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=n?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,i&&i.set(e,r),r}(p);function A(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(A=function(e){return e?i:t})(e)}function P(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=i[0],h=i[1],u=i[2],d=i[3],p=i[4],f=i[5];return e[0]=r*c+a*h,e[1]=n*c+o*h,e[2]=r*u+a*d,e[3]=n*u+o*d,e[4]=r*p+a*f+s,e[5]=n*p+o*f+l,e}function C(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e}T.mul=P,T.sub=C;var I={};function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}Object.defineProperty(I,"__esModule",{value:!0}),I.create=function(){var e=new D.ARRAY_TYPE(9);return D.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},I.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},I.clone=function(e){var t=new D.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},I.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},I.fromValues=function(e,t,i,r,n,a,o,s,l){var c=new D.ARRAY_TYPE(9);return c[0]=e,c[1]=t,c[2]=i,c[3]=r,c[4]=n,c[5]=a,c[6]=o,c[7]=s,c[8]=l,c},I.set=function(e,t,i,r,n,a,o,s,l,c){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=a,e[5]=o,e[6]=s,e[7]=l,e[8]=c,e},I.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},I.transpose=function(e,t){if(e===t){var i=t[1],r=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=r,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},I.invert=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],c=t[7],h=t[8],u=h*o-s*c,d=-h*a+s*l,p=c*a-o*l,f=i*u+r*d+n*p;return f?(e[0]=u*(f=1/f),e[1]=(-h*r+n*c)*f,e[2]=(s*r-n*o)*f,e[3]=d*f,e[4]=(h*i-n*l)*f,e[5]=(-s*i+n*a)*f,e[6]=p*f,e[7]=(-c*i+r*l)*f,e[8]=(o*i-r*a)*f,e):null},I.adjoint=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],c=t[7],h=t[8];return e[0]=o*h-s*c,e[1]=n*c-r*h,e[2]=r*s-n*o,e[3]=s*l-a*h,e[4]=i*h-n*l,e[5]=n*a-i*s,e[6]=a*c-o*l,e[7]=r*l-i*c,e[8]=i*o-r*a,e},I.determinant=function(e){var t=e[3],i=e[4],r=e[5],n=e[6],a=e[7],o=e[8];return e[0]*(o*i-r*a)+e[1]*(-o*t+r*n)+e[2]*(a*t-i*n)},I.multiply=L,I.translate=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=i[0],p=i[1];return e[0]=r,e[1]=n,e[2]=a,e[3]=o,e[4]=s,e[5]=l,e[6]=d*r+p*o+c,e[7]=d*n+p*s+h,e[8]=d*a+p*l+u,e},I.rotate=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=Math.sin(i),p=Math.cos(i);return e[0]=p*r+d*o,e[1]=p*n+d*s,e[2]=p*a+d*l,e[3]=p*o-d*r,e[4]=p*s-d*n,e[5]=p*l-d*a,e[6]=c,e[7]=h,e[8]=u,e},I.scale=function(e,t,i){var r=i[0],n=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},I.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},I.fromRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=-i,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},I.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},I.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},I.fromQuat=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=i+i,s=r+r,l=n+n,c=i*o,h=r*o,u=r*s,d=n*o,p=n*s,f=n*l,m=a*o,g=a*s,_=a*l;return e[0]=1-u-f,e[3]=h-_,e[6]=d+g,e[1]=h+_,e[4]=1-c-f,e[7]=p-m,e[2]=d-g,e[5]=p+m,e[8]=1-c-u,e},I.normalFromMat4=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],c=t[7],h=t[8],u=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15],y=i*s-r*o,v=i*l-n*o,x=i*c-a*o,b=r*l-n*s,w=r*c-a*s,S=n*c-a*l,T=h*m-u*f,E=h*g-d*f,M=h*_-p*f,A=u*g-d*m,P=u*_-p*m,C=d*_-p*g,I=y*C-v*P+x*A+b*M-w*E+S*T;return I?(e[0]=(s*C-l*P+c*A)*(I=1/I),e[1]=(l*M-o*C-c*E)*I,e[2]=(o*P-s*M+c*T)*I,e[3]=(n*P-r*C-a*A)*I,e[4]=(i*C-n*M+a*E)*I,e[5]=(r*M-i*P-a*T)*I,e[6]=(m*S-g*w+_*b)*I,e[7]=(g*x-f*S-_*v)*I,e[8]=(f*w-m*x+_*y)*I,e):null},I.projection=function(e,t,i){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/i,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},I.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},I.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])},I.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e},I.subtract=z,I.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e},I.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e},I.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},I.equals=function(e,t){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],l=e[6],c=e[7],h=e[8],u=t[0],d=t[1],p=t[2],f=t[3],m=t[4],g=t[5],_=t[6],y=t[7],v=t[8];return Math.abs(i-u)<=D.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(r-d)<=D.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(n-p)<=D.EPSILON*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(a-f)<=D.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(o-m)<=D.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(s-g)<=D.EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(l-_)<=D.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(c-y)<=D.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(h-v)<=D.EPSILON*Math.max(1,Math.abs(h),Math.abs(v))},I.sub=I.mul=void 0;var D=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==k(e)&&"function"!=typeof e)return{default:e};var i=R(void 0);if(i&&i.has(e))return i.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=n?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,i&&i.set(e,r),r}(p);function R(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(R=function(e){return e?i:t})(e)}function L(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=i[0],p=i[1],f=i[2],m=i[3],g=i[4],_=i[5],y=i[6],v=i[7],x=i[8];return e[0]=d*r+p*o+f*c,e[1]=d*n+p*s+f*h,e[2]=d*a+p*l+f*u,e[3]=m*r+g*o+_*c,e[4]=m*n+g*s+_*h,e[5]=m*a+g*l+_*u,e[6]=y*r+v*o+x*c,e[7]=y*n+v*s+x*h,e[8]=y*a+v*l+x*u,e}function z(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e}I.mul=L,I.sub=z;var F={};function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}Object.defineProperty(F,"__esModule",{value:!0}),F.create=function(){var e=new B.ARRAY_TYPE(16);return B.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},F.clone=function(e){var t=new B.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},F.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},F.fromValues=function(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m){var g=new B.ARRAY_TYPE(16);return g[0]=e,g[1]=t,g[2]=i,g[3]=r,g[4]=n,g[5]=a,g[6]=o,g[7]=s,g[8]=l,g[9]=c,g[10]=h,g[11]=u,g[12]=d,g[13]=p,g[14]=f,g[15]=m,g},F.set=function(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=a,e[5]=o,e[6]=s,e[7]=l,e[8]=c,e[9]=h,e[10]=u,e[11]=d,e[12]=p,e[13]=f,e[14]=m,e[15]=g,e},F.identity=V,F.transpose=function(e,t){if(e===t){var i=t[1],r=t[2],n=t[3],a=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=a,e[11]=t[14],e[12]=n,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},F.invert=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],c=t[7],h=t[8],u=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15],y=i*s-r*o,v=i*l-n*o,x=i*c-a*o,b=r*l-n*s,w=r*c-a*s,S=n*c-a*l,T=h*m-u*f,E=h*g-d*f,M=h*_-p*f,A=u*g-d*m,P=u*_-p*m,C=d*_-p*g,I=y*C-v*P+x*A+b*M-w*E+S*T;return I?(e[0]=(s*C-l*P+c*A)*(I=1/I),e[1]=(n*P-r*C-a*A)*I,e[2]=(m*S-g*w+_*b)*I,e[3]=(d*w-u*S-p*b)*I,e[4]=(l*M-o*C-c*E)*I,e[5]=(i*C-n*M+a*E)*I,e[6]=(g*x-f*S-_*v)*I,e[7]=(h*S-d*x+p*v)*I,e[8]=(o*P-s*M+c*T)*I,e[9]=(r*M-i*P-a*T)*I,e[10]=(f*w-m*x+_*y)*I,e[11]=(u*x-h*w-p*y)*I,e[12]=(s*E-o*A-l*T)*I,e[13]=(i*A-r*E+n*T)*I,e[14]=(m*v-f*b-g*y)*I,e[15]=(h*b-u*v+d*y)*I,e):null},F.adjoint=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=t[4],s=t[5],l=t[6],c=t[7],h=t[8],u=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],_=t[15];return e[0]=s*(d*_-p*g)-u*(l*_-c*g)+m*(l*p-c*d),e[1]=-(r*(d*_-p*g)-u*(n*_-a*g)+m*(n*p-a*d)),e[2]=r*(l*_-c*g)-s*(n*_-a*g)+m*(n*c-a*l),e[3]=-(r*(l*p-c*d)-s*(n*p-a*d)+u*(n*c-a*l)),e[4]=-(o*(d*_-p*g)-h*(l*_-c*g)+f*(l*p-c*d)),e[5]=i*(d*_-p*g)-h*(n*_-a*g)+f*(n*p-a*d),e[6]=-(i*(l*_-c*g)-o*(n*_-a*g)+f*(n*c-a*l)),e[7]=i*(l*p-c*d)-o*(n*p-a*d)+h*(n*c-a*l),e[8]=o*(u*_-p*m)-h*(s*_-c*m)+f*(s*p-c*u),e[9]=-(i*(u*_-p*m)-h*(r*_-a*m)+f*(r*p-a*u)),e[10]=i*(s*_-c*m)-o*(r*_-a*m)+f*(r*c-a*s),e[11]=-(i*(s*p-c*u)-o*(r*p-a*u)+h*(r*c-a*s)),e[12]=-(o*(u*g-d*m)-h*(s*g-l*m)+f*(s*d-l*u)),e[13]=i*(u*g-d*m)-h*(r*g-n*m)+f*(r*d-n*u),e[14]=-(i*(s*g-l*m)-o*(r*g-n*m)+f*(r*l-n*s)),e[15]=i*(s*d-l*u)-o*(r*d-n*u)+h*(r*l-n*s),e},F.determinant=function(e){var t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],h=e[9],u=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15];return(t*o-i*a)*(u*g-d*m)-(t*s-r*a)*(h*g-d*f)+(t*l-n*a)*(h*m-u*f)+(i*s-r*o)*(c*g-d*p)-(i*l-n*o)*(c*m-u*p)+(r*l-n*s)*(c*f-h*p)},F.multiply=j,F.translate=function(e,t,i){var r,n,a,o,s,l,c,h,u,d,p,f,m=i[0],g=i[1],_=i[2];return t===e?(e[12]=t[0]*m+t[4]*g+t[8]*_+t[12],e[13]=t[1]*m+t[5]*g+t[9]*_+t[13],e[14]=t[2]*m+t[6]*g+t[10]*_+t[14],e[15]=t[3]*m+t[7]*g+t[11]*_+t[15]):(n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=t[9],p=t[10],f=t[11],e[0]=r=t[0],e[1]=n,e[2]=a,e[3]=o,e[4]=s,e[5]=l,e[6]=c,e[7]=h,e[8]=u,e[9]=d,e[10]=p,e[11]=f,e[12]=r*m+s*g+u*_+t[12],e[13]=n*m+l*g+d*_+t[13],e[14]=a*m+c*g+p*_+t[14],e[15]=o*m+h*g+f*_+t[15]),e},F.scale=function(e,t,i){var r=i[0],n=i[1],a=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},F.rotate=function(e,t,i,r){var n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,v,x,b,w,S,T,E,M,A,P=r[0],C=r[1],I=r[2],k=Math.hypot(P,C,I);return k<B.EPSILON?null:(P*=k=1/k,C*=k,I*=k,n=Math.sin(i),a=Math.cos(i),l=t[1],c=t[2],h=t[3],d=t[5],p=t[6],f=t[7],g=t[9],_=t[10],y=t[11],v=P*P*(o=1-a)+a,w=P*C*o-I*n,S=C*C*o+a,T=I*C*o+P*n,E=P*I*o+C*n,M=C*I*o-P*n,A=I*I*o+a,e[0]=(s=t[0])*v+(u=t[4])*(x=C*P*o+I*n)+(m=t[8])*(b=I*P*o-C*n),e[1]=l*v+d*x+g*b,e[2]=c*v+p*x+_*b,e[3]=h*v+f*x+y*b,e[4]=s*w+u*S+m*T,e[5]=l*w+d*S+g*T,e[6]=c*w+p*S+_*T,e[7]=h*w+f*S+y*T,e[8]=s*E+u*M+m*A,e[9]=l*E+d*M+g*A,e[10]=c*E+p*M+_*A,e[11]=h*E+f*M+y*A,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},F.rotateX=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),a=t[4],o=t[5],s=t[6],l=t[7],c=t[8],h=t[9],u=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*n+c*r,e[5]=o*n+h*r,e[6]=s*n+u*r,e[7]=l*n+d*r,e[8]=c*n-a*r,e[9]=h*n-o*r,e[10]=u*n-s*r,e[11]=d*n-l*r,e},F.rotateY=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),a=t[0],o=t[1],s=t[2],l=t[3],c=t[8],h=t[9],u=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n-c*r,e[1]=o*n-h*r,e[2]=s*n-u*r,e[3]=l*n-d*r,e[8]=a*r+c*n,e[9]=o*r+h*n,e[10]=s*r+u*n,e[11]=l*r+d*n,e},F.rotateZ=function(e,t,i){var r=Math.sin(i),n=Math.cos(i),a=t[0],o=t[1],s=t[2],l=t[3],c=t[4],h=t[5],u=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n+c*r,e[1]=o*n+h*r,e[2]=s*n+u*r,e[3]=l*n+d*r,e[4]=c*n-a*r,e[5]=h*n-o*r,e[6]=u*n-s*r,e[7]=d*n-l*r,e},F.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},F.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},F.fromRotation=function(e,t,i){var r,n,a,o=i[0],s=i[1],l=i[2],c=Math.hypot(o,s,l);return c<B.EPSILON?null:(o*=c=1/c,s*=c,l*=c,r=Math.sin(t),n=Math.cos(t),e[0]=o*o*(a=1-n)+n,e[1]=s*o*a+l*r,e[2]=l*o*a-s*r,e[3]=0,e[4]=o*s*a-l*r,e[5]=s*s*a+n,e[6]=l*s*a+o*r,e[7]=0,e[8]=o*l*a+s*r,e[9]=s*l*a-o*r,e[10]=l*l*a+n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},F.fromXRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},F.fromYRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},F.fromZRotation=function(e,t){var i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},F.fromRotationTranslation=U,F.fromQuat2=function(e,t){var i=new B.ARRAY_TYPE(3),r=-t[0],n=-t[1],a=-t[2],o=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=r*r+n*n+a*a+o*o;return u>0?(i[0]=2*(s*o+h*r+l*a-c*n)/u,i[1]=2*(l*o+h*n+c*r-s*a)/u,i[2]=2*(c*o+h*a+s*n-l*r)/u):(i[0]=2*(s*o+h*r+l*a-c*n),i[1]=2*(l*o+h*n+c*r-s*a),i[2]=2*(c*o+h*a+s*n-l*r)),U(e,t,i),e},F.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},F.getScaling=G,F.getRotation=function(e,t){var i=new B.ARRAY_TYPE(3);G(i,t);var r=1/i[0],n=1/i[1],a=1/i[2],o=t[0]*r,s=t[1]*n,l=t[2]*a,c=t[4]*r,h=t[5]*n,u=t[6]*a,d=t[8]*r,p=t[9]*n,f=t[10]*a,m=o+h+f,g=0;return m>0?(g=2*Math.sqrt(m+1),e[3]=.25*g,e[0]=(u-p)/g,e[1]=(d-l)/g,e[2]=(s-c)/g):o>h&&o>f?(g=2*Math.sqrt(1+o-h-f),e[3]=(u-p)/g,e[0]=.25*g,e[1]=(s+c)/g,e[2]=(d+l)/g):h>f?(g=2*Math.sqrt(1+h-o-f),e[3]=(d-l)/g,e[0]=(s+c)/g,e[1]=.25*g,e[2]=(u+p)/g):(g=2*Math.sqrt(1+f-o-h),e[3]=(s-c)/g,e[0]=(d+l)/g,e[1]=(u+p)/g,e[2]=.25*g),e},F.fromRotationTranslationScale=function(e,t,i,r){var n=t[0],a=t[1],o=t[2],s=t[3],l=n+n,c=a+a,h=o+o,u=n*l,d=n*c,p=n*h,f=a*c,m=a*h,g=o*h,_=s*l,y=s*c,v=s*h,x=r[0],b=r[1],w=r[2];return e[0]=(1-(f+g))*x,e[1]=(d+v)*x,e[2]=(p-y)*x,e[3]=0,e[4]=(d-v)*b,e[5]=(1-(u+g))*b,e[6]=(m+_)*b,e[7]=0,e[8]=(p+y)*w,e[9]=(m-_)*w,e[10]=(1-(u+f))*w,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e},F.fromRotationTranslationScaleOrigin=function(e,t,i,r,n){var a=t[0],o=t[1],s=t[2],l=t[3],c=a+a,h=o+o,u=s+s,d=a*c,p=a*h,f=a*u,m=o*h,g=o*u,_=s*u,y=l*c,v=l*h,x=l*u,b=r[0],w=r[1],S=r[2],T=n[0],E=n[1],M=n[2],A=(1-(m+_))*b,P=(p+x)*b,C=(f-v)*b,I=(p-x)*w,k=(1-(d+_))*w,D=(g+y)*w,R=(f+v)*S,L=(g-y)*S,z=(1-(d+m))*S;return e[0]=A,e[1]=P,e[2]=C,e[3]=0,e[4]=I,e[5]=k,e[6]=D,e[7]=0,e[8]=R,e[9]=L,e[10]=z,e[11]=0,e[12]=i[0]+T-(A*T+I*E+R*M),e[13]=i[1]+E-(P*T+k*E+L*M),e[14]=i[2]+M-(C*T+D*E+z*M),e[15]=1,e},F.fromQuat=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=i+i,s=r+r,l=n+n,c=i*o,h=r*o,u=r*s,d=n*o,p=n*s,f=n*l,m=a*o,g=a*s,_=a*l;return e[0]=1-u-f,e[1]=h+_,e[2]=d-g,e[3]=0,e[4]=h-_,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-c-u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},F.frustum=function(e,t,i,r,n,a,o){var s=1/(i-t),l=1/(n-r),c=1/(a-o);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*l,e[6]=0,e[7]=0,e[8]=(i+t)*s,e[9]=(n+r)*l,e[10]=(o+a)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*c,e[15]=0,e},F.perspectiveNO=q,F.perspectiveZO=function(e,t,i,r,n){var a,o=1/Math.tan(t/2);return e[0]=o/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(e[10]=n*(a=1/(r-n)),e[14]=n*r*a):(e[10]=-1,e[14]=-r),e},F.perspectiveFromFieldOfView=function(e,t,i,r){var n=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+s),c=2/(n+a);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-s)*l*.5,e[9]=(n-a)*c*.5,e[10]=r/(i-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*i/(i-r),e[15]=0,e},F.orthoNO=H,F.orthoZO=function(e,t,i,r,n,a,o){var s=1/(t-i),l=1/(r-n),c=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=c,e[11]=0,e[12]=(t+i)*s,e[13]=(n+r)*l,e[14]=a*c,e[15]=1,e},F.lookAt=function(e,t,i,r){var n,a,o,s,l,c,h,u,d,p,f=t[0],m=t[1],g=t[2],_=r[0],y=r[1],v=r[2],x=i[0],b=i[1],w=i[2];return Math.abs(f-x)<B.EPSILON&&Math.abs(m-b)<B.EPSILON&&Math.abs(g-w)<B.EPSILON?V(e):(h=f-x,u=m-b,d=g-w,n=y*(d*=p=1/Math.hypot(h,u,d))-v*(u*=p),a=v*(h*=p)-_*d,o=_*u-y*h,(p=Math.hypot(n,a,o))?(n*=p=1/p,a*=p,o*=p):(n=0,a=0,o=0),s=u*o-d*a,l=d*n-h*o,c=h*a-u*n,(p=Math.hypot(s,l,c))?(s*=p=1/p,l*=p,c*=p):(s=0,l=0,c=0),e[0]=n,e[1]=s,e[2]=h,e[3]=0,e[4]=a,e[5]=l,e[6]=u,e[7]=0,e[8]=o,e[9]=c,e[10]=d,e[11]=0,e[12]=-(n*f+a*m+o*g),e[13]=-(s*f+l*m+c*g),e[14]=-(h*f+u*m+d*g),e[15]=1,e)},F.targetTo=function(e,t,i,r){var n=t[0],a=t[1],o=t[2],s=r[0],l=r[1],c=r[2],h=n-i[0],u=a-i[1],d=o-i[2],p=h*h+u*u+d*d;p>0&&(h*=p=1/Math.sqrt(p),u*=p,d*=p);var f=l*d-c*u,m=c*h-s*d,g=s*u-l*h;return(p=f*f+m*m+g*g)>0&&(f*=p=1/Math.sqrt(p),m*=p,g*=p),e[0]=f,e[1]=m,e[2]=g,e[3]=0,e[4]=u*g-d*m,e[5]=d*f-h*g,e[6]=h*m-u*f,e[7]=0,e[8]=h,e[9]=u,e[10]=d,e[11]=0,e[12]=n,e[13]=a,e[14]=o,e[15]=1,e},F.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},F.frob=function(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},F.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e},F.subtract=W,F.multiplyScalar=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e},F.multiplyScalarAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e[9]=t[9]+i[9]*r,e[10]=t[10]+i[10]*r,e[11]=t[11]+i[11]*r,e[12]=t[12]+i[12]*r,e[13]=t[13]+i[13]*r,e[14]=t[14]+i[14]*r,e[15]=t[15]+i[15]*r,e},F.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},F.equals=function(e,t){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],l=e[6],c=e[7],h=e[8],u=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],_=e[15],y=t[0],v=t[1],x=t[2],b=t[3],w=t[4],S=t[5],T=t[6],E=t[7],M=t[8],A=t[9],P=t[10],C=t[11],I=t[12],k=t[13],D=t[14],R=t[15];return Math.abs(i-y)<=B.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(r-v)<=B.EPSILON*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(n-x)<=B.EPSILON*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(a-b)<=B.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(o-w)<=B.EPSILON*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(s-S)<=B.EPSILON*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(l-T)<=B.EPSILON*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-E)<=B.EPSILON*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(h-M)<=B.EPSILON*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(u-A)<=B.EPSILON*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(d-P)<=B.EPSILON*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(p-C)<=B.EPSILON*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(f-I)<=B.EPSILON*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(m-k)<=B.EPSILON*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(g-D)<=B.EPSILON*Math.max(1,Math.abs(g),Math.abs(D))&&Math.abs(_-R)<=B.EPSILON*Math.max(1,Math.abs(_),Math.abs(R))},F.sub=F.mul=F.ortho=F.perspective=void 0;var B=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==O(e)&&"function"!=typeof e)return{default:e};var i=N(void 0);if(i&&i.has(e))return i.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=n?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,i&&i.set(e,r),r}(p);function N(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(N=function(e){return e?i:t})(e)}function V(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function j(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],_=t[14],y=t[15],v=i[0],x=i[1],b=i[2],w=i[3];return e[0]=v*r+x*s+b*u+w*m,e[1]=v*n+x*l+b*d+w*g,e[2]=v*a+x*c+b*p+w*_,e[3]=v*o+x*h+b*f+w*y,e[4]=(v=i[4])*r+(x=i[5])*s+(b=i[6])*u+(w=i[7])*m,e[5]=v*n+x*l+b*d+w*g,e[6]=v*a+x*c+b*p+w*_,e[7]=v*o+x*h+b*f+w*y,e[8]=(v=i[8])*r+(x=i[9])*s+(b=i[10])*u+(w=i[11])*m,e[9]=v*n+x*l+b*d+w*g,e[10]=v*a+x*c+b*p+w*_,e[11]=v*o+x*h+b*f+w*y,e[12]=(v=i[12])*r+(x=i[13])*s+(b=i[14])*u+(w=i[15])*m,e[13]=v*n+x*l+b*d+w*g,e[14]=v*a+x*c+b*p+w*_,e[15]=v*o+x*h+b*f+w*y,e}function U(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=r+r,l=n+n,c=a+a,h=r*s,u=r*l,d=r*c,p=n*l,f=n*c,m=a*c,g=o*s,_=o*l,y=o*c;return e[0]=1-(p+m),e[1]=u+y,e[2]=d-_,e[3]=0,e[4]=u-y,e[5]=1-(h+m),e[6]=f+g,e[7]=0,e[8]=d+_,e[9]=f-g,e[10]=1-(h+p),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function G(e,t){var i=t[4],r=t[5],n=t[6],a=t[8],o=t[9],s=t[10];return e[0]=Math.hypot(t[0],t[1],t[2]),e[1]=Math.hypot(i,r,n),e[2]=Math.hypot(a,o,s),e}function q(e,t,i,r,n){var a,o=1/Math.tan(t/2);return e[0]=o/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0?(e[10]=(n+r)*(a=1/(r-n)),e[14]=2*n*r*a):(e[10]=-1,e[14]=-2*r),e}function H(e,t,i,r,n,a,o){var s=1/(t-i),l=1/(r-n),c=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*s,e[13]=(n+r)*l,e[14]=(o+a)*c,e[15]=1,e}function W(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}F.perspective=q,F.ortho=H,F.mul=j,F.sub=W;var Z={},Q={};function X(e){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},X(e)}Object.defineProperty(Q,"__esModule",{value:!0}),Q.create=K,Q.clone=function(e){var t=new Y.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Q.length=$,Q.fromValues=function(e,t,i){var r=new Y.ARRAY_TYPE(3);return r[0]=e,r[1]=t,r[2]=i,r},Q.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Q.set=function(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e},Q.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e},Q.subtract=ee,Q.multiply=te,Q.divide=ie,Q.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},Q.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},Q.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e},Q.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e},Q.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},Q.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e},Q.scaleAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e},Q.distance=re,Q.squaredDistance=ne,Q.squaredLength=ae,Q.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},Q.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},Q.normalize=function(e,t){var i=t[0],r=t[1],n=t[2],a=i*i+r*r+n*n;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e},Q.dot=oe,Q.cross=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=i[0],s=i[1],l=i[2];return e[0]=n*l-a*s,e[1]=a*o-r*l,e[2]=r*s-n*o,e},Q.lerp=function(e,t,i,r){var n=t[0],a=t[1],o=t[2];return e[0]=n+r*(i[0]-n),e[1]=a+r*(i[1]-a),e[2]=o+r*(i[2]-o),e},Q.hermite=function(e,t,i,r,n,a){var o=a*a,s=o*(2*a-3)+1,l=o*(a-2)+a,c=o*(a-1),h=o*(3-2*a);return e[0]=t[0]*s+i[0]*l+r[0]*c+n[0]*h,e[1]=t[1]*s+i[1]*l+r[1]*c+n[1]*h,e[2]=t[2]*s+i[2]*l+r[2]*c+n[2]*h,e},Q.bezier=function(e,t,i,r,n,a){var o=1-a,s=o*o,l=a*a,c=s*o,h=3*a*s,u=3*l*o,d=l*a;return e[0]=t[0]*c+i[0]*h+r[0]*u+n[0]*d,e[1]=t[1]*c+i[1]*h+r[1]*u+n[1]*d,e[2]=t[2]*c+i[2]*h+r[2]*u+n[2]*d,e},Q.random=function(e,t){t=t||1;var i=2*Y.RANDOM()*Math.PI,r=2*Y.RANDOM()-1,n=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(i)*n,e[1]=Math.sin(i)*n,e[2]=r*t,e},Q.transformMat4=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=i[3]*r+i[7]*n+i[11]*a+i[15];return e[0]=(i[0]*r+i[4]*n+i[8]*a+i[12])/(o=o||1),e[1]=(i[1]*r+i[5]*n+i[9]*a+i[13])/o,e[2]=(i[2]*r+i[6]*n+i[10]*a+i[14])/o,e},Q.transformMat3=function(e,t,i){var r=t[0],n=t[1],a=t[2];return e[0]=r*i[0]+n*i[3]+a*i[6],e[1]=r*i[1]+n*i[4]+a*i[7],e[2]=r*i[2]+n*i[5]+a*i[8],e},Q.transformQuat=function(e,t,i){var r=i[0],n=i[1],a=i[2],o=t[0],s=t[1],l=t[2],c=n*l-a*s,h=a*o-r*l,u=r*s-n*o,d=n*u-a*h,p=a*c-r*u,f=r*h-n*c,m=2*i[3];return h*=m,u*=m,p*=2,f*=2,e[0]=o+(c*=m)+(d*=2),e[1]=s+h+p,e[2]=l+u+f,e},Q.rotateX=function(e,t,i,r){var n=[],a=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],a[0]=n[0],a[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),a[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),e[0]=a[0]+i[0],e[1]=a[1]+i[1],e[2]=a[2]+i[2],e},Q.rotateY=function(e,t,i,r){var n=[],a=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],a[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),a[1]=n[1],a[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),e[0]=a[0]+i[0],e[1]=a[1]+i[1],e[2]=a[2]+i[2],e},Q.rotateZ=function(e,t,i,r){var n=[],a=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],a[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),a[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),a[2]=n[2],e[0]=a[0]+i[0],e[1]=a[1]+i[1],e[2]=a[2]+i[2],e},Q.angle=function(e,t){var i=e[0],r=e[1],n=e[2],a=t[0],o=t[1],s=t[2],l=Math.sqrt(i*i+r*r+n*n)*Math.sqrt(a*a+o*o+s*s),c=l&&oe(e,t)/l;return Math.acos(Math.min(Math.max(c,-1),1))},Q.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e},Q.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},Q.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},Q.equals=function(e,t){var i=e[0],r=e[1],n=e[2],a=t[0],o=t[1],s=t[2];return Math.abs(i-a)<=Y.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-o)<=Y.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-s)<=Y.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))},Q.forEach=Q.sqrLen=Q.len=Q.sqrDist=Q.dist=Q.div=Q.mul=Q.sub=void 0;var Y=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==X(e)&&"function"!=typeof e)return{default:e};var i=J(void 0);if(i&&i.has(e))return i.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=n?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,i&&i.set(e,r),r}(p);function J(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(J=function(e){return e?i:t})(e)}function K(){var e=new Y.ARRAY_TYPE(3);return Y.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function $(e){return Math.hypot(e[0],e[1],e[2])}function ee(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function te(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function ie(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function re(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])}function ne(e,t){var i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2];return i*i+r*r+n*n}function ae(e){var t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r}function oe(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}Q.sub=ee,Q.mul=te,Q.div=ie,Q.dist=re,Q.sqrDist=ne,Q.len=$,Q.sqrLen=ae;var se,le=(se=K(),function(e,t,i,r,n,a){var o,s;for(t||(t=3),i||(i=0),s=r?Math.min(r*t+i,e.length):e.length,o=i;o<s;o+=t)se[0]=e[o],se[1]=e[o+1],se[2]=e[o+2],n(se,se,a),e[o]=se[0],e[o+1]=se[1],e[o+2]=se[2];return e});Q.forEach=le;var ce={};function he(e){return he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},he(e)}Object.defineProperty(ce,"__esModule",{value:!0}),ce.create=pe,ce.clone=function(e){var t=new ue.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},ce.fromValues=function(e,t,i,r){var n=new ue.ARRAY_TYPE(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n},ce.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},ce.set=function(e,t,i,r,n){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e},ce.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e},ce.subtract=fe,ce.multiply=me,ce.divide=ge,ce.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},ce.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},ce.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e},ce.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e},ce.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},ce.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e},ce.scaleAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e},ce.distance=_e,ce.squaredDistance=ye,ce.length=ve,ce.squaredLength=xe,ce.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},ce.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},ce.normalize=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=i*i+r*r+n*n+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=i*o,e[1]=r*o,e[2]=n*o,e[3]=a*o,e},ce.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},ce.cross=function(e,t,i,r){var n=i[0]*r[1]-i[1]*r[0],a=i[0]*r[2]-i[2]*r[0],o=i[0]*r[3]-i[3]*r[0],s=i[1]*r[2]-i[2]*r[1],l=i[1]*r[3]-i[3]*r[1],c=i[2]*r[3]-i[3]*r[2],h=t[0],u=t[1],d=t[2],p=t[3];return e[0]=u*c-d*l+p*s,e[1]=-h*c+d*o-p*a,e[2]=h*l-u*o+p*n,e[3]=-h*s+u*a-d*n,e},ce.lerp=function(e,t,i,r){var n=t[0],a=t[1],o=t[2],s=t[3];return e[0]=n+r*(i[0]-n),e[1]=a+r*(i[1]-a),e[2]=o+r*(i[2]-o),e[3]=s+r*(i[3]-s),e},ce.random=function(e,t){var i,r,n,a,o,s;t=t||1;do{o=(i=2*ue.RANDOM()-1)*i+(r=2*ue.RANDOM()-1)*r}while(o>=1);do{s=(n=2*ue.RANDOM()-1)*n+(a=2*ue.RANDOM()-1)*a}while(s>=1);var l=Math.sqrt((1-o)/s);return e[0]=t*i,e[1]=t*r,e[2]=t*n*l,e[3]=t*a*l,e},ce.transformMat4=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3];return e[0]=i[0]*r+i[4]*n+i[8]*a+i[12]*o,e[1]=i[1]*r+i[5]*n+i[9]*a+i[13]*o,e[2]=i[2]*r+i[6]*n+i[10]*a+i[14]*o,e[3]=i[3]*r+i[7]*n+i[11]*a+i[15]*o,e},ce.transformQuat=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=i[0],s=i[1],l=i[2],c=i[3],h=c*r+s*a-l*n,u=c*n+l*r-o*a,d=c*a+o*n-s*r,p=-o*r-s*n-l*a;return e[0]=h*c+p*-o+u*-l-d*-s,e[1]=u*c+p*-s+d*-o-h*-l,e[2]=d*c+p*-l+h*-s-u*-o,e[3]=t[3],e},ce.zero=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},ce.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},ce.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},ce.equals=function(e,t){var i=e[0],r=e[1],n=e[2],a=e[3],o=t[0],s=t[1],l=t[2],c=t[3];return Math.abs(i-o)<=ue.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-s)<=ue.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-l)<=ue.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-c)<=ue.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))},ce.forEach=ce.sqrLen=ce.len=ce.sqrDist=ce.dist=ce.div=ce.mul=ce.sub=void 0;var ue=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==he(e)&&"function"!=typeof e)return{default:e};var i=de(void 0);if(i&&i.has(e))return i.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=n?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,i&&i.set(e,r),r}(p);function de(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(de=function(e){return e?i:t})(e)}function pe(){var e=new ue.ARRAY_TYPE(4);return ue.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function fe(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function me(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function ge(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function _e(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2],t[3]-e[3])}function ye(e,t){var i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return i*i+r*r+n*n+a*a}function ve(e){return Math.hypot(e[0],e[1],e[2],e[3])}function xe(e){var t=e[0],i=e[1],r=e[2],n=e[3];return t*t+i*i+r*r+n*n}ce.sub=fe,ce.mul=me,ce.div=ge,ce.dist=_e,ce.sqrDist=ye,ce.len=ve,ce.sqrLen=xe;var be=function(){var e=pe();return function(t,i,r,n,a,o){var s,l;for(i||(i=4),r||(r=0),l=n?Math.min(n*i+r,t.length):t.length,s=r;s<l;s+=i)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],a(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}}();function we(e){return we="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},we(e)}ce.forEach=be,Object.defineProperty(Z,"__esModule",{value:!0}),Z.create=Ce,Z.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},Z.setAxisAngle=Ie,Z.getAxisAngle=function(e,t){var i=2*Math.acos(t[3]),r=Math.sin(i/2);return r>Se.EPSILON?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),i},Z.getAngle=function(e,t){var i=Oe(e,t);return Math.acos(2*i*i-1)},Z.multiply=ke,Z.rotateX=function(e,t,i){i*=.5;var r=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(i),l=Math.cos(i);return e[0]=r*l+o*s,e[1]=n*l+a*s,e[2]=a*l-n*s,e[3]=o*l-r*s,e},Z.rotateY=function(e,t,i){i*=.5;var r=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(i),l=Math.cos(i);return e[0]=r*l-a*s,e[1]=n*l+o*s,e[2]=a*l+r*s,e[3]=o*l-n*s,e},Z.rotateZ=function(e,t,i){i*=.5;var r=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(i),l=Math.cos(i);return e[0]=r*l+n*s,e[1]=n*l-r*s,e[2]=a*l+o*s,e[3]=o*l-a*s,e},Z.calculateW=function(e,t){var i=t[0],r=t[1],n=t[2];return e[0]=i,e[1]=r,e[2]=n,e[3]=Math.sqrt(Math.abs(1-i*i-r*r-n*n)),e},Z.exp=De,Z.ln=Re,Z.pow=function(e,t,i){return Re(e,t),Fe(e,e,i),De(e,e),e},Z.slerp=Le,Z.random=function(e){var t=Se.RANDOM(),i=Se.RANDOM(),r=Se.RANDOM(),n=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=n*Math.sin(2*Math.PI*i),e[1]=n*Math.cos(2*Math.PI*i),e[2]=a*Math.sin(2*Math.PI*r),e[3]=a*Math.cos(2*Math.PI*r),e},Z.invert=function(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=i*i+r*r+n*n+a*a,s=o?1/o:0;return e[0]=-i*s,e[1]=-r*s,e[2]=-n*s,e[3]=a*s,e},Z.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},Z.fromMat3=ze,Z.fromEuler=function(e,t,i,r){var n=.5*Math.PI/180;t*=n,i*=n,r*=n;var a=Math.sin(t),o=Math.cos(t),s=Math.sin(i),l=Math.cos(i),c=Math.sin(r),h=Math.cos(r);return e[0]=a*l*h-o*s*c,e[1]=o*s*h+a*l*c,e[2]=o*l*c-a*s*h,e[3]=o*l*h+a*s*c,e},Z.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},Z.setAxes=Z.sqlerp=Z.rotationTo=Z.equals=Z.exactEquals=Z.normalize=Z.sqrLen=Z.squaredLength=Z.len=Z.length=Z.lerp=Z.dot=Z.scale=Z.mul=Z.add=Z.set=Z.copy=Z.fromValues=Z.clone=void 0;var Se=Pe(p),Te=Pe(I),Ee=Pe(Q),Me=Pe(ce);function Ae(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(Ae=function(e){return e?i:t})(e)}function Pe(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==we(e)&&"function"!=typeof e)return{default:e};var i=Ae(t);if(i&&i.has(e))return i.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=n?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,i&&i.set(e,r),r}function Ce(){var e=new Se.ARRAY_TYPE(4);return Se.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Ie(e,t,i){i*=.5;var r=Math.sin(i);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(i),e}function ke(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=i[0],l=i[1],c=i[2],h=i[3];return e[0]=r*h+o*s+n*c-a*l,e[1]=n*h+o*l+a*s-r*c,e[2]=a*h+o*c+r*l-n*s,e[3]=o*h-r*s-n*l-a*c,e}function De(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=Math.sqrt(i*i+r*r+n*n),s=Math.exp(a),l=o>0?s*Math.sin(o)/o:0;return e[0]=i*l,e[1]=r*l,e[2]=n*l,e[3]=s*Math.cos(o),e}function Re(e,t){var i=t[0],r=t[1],n=t[2],a=t[3],o=Math.sqrt(i*i+r*r+n*n),s=o>0?Math.atan2(o,a)/o:0;return e[0]=i*s,e[1]=r*s,e[2]=n*s,e[3]=.5*Math.log(i*i+r*r+n*n+a*a),e}function Le(e,t,i,r){var n,a,o,s,l,c=t[0],h=t[1],u=t[2],d=t[3],p=i[0],f=i[1],m=i[2],g=i[3];return(a=c*p+h*f+u*m+d*g)<0&&(a=-a,p=-p,f=-f,m=-m,g=-g),1-a>Se.EPSILON?(n=Math.acos(a),o=Math.sin(n),s=Math.sin((1-r)*n)/o,l=Math.sin(r*n)/o):(s=1-r,l=r),e[0]=s*c+l*p,e[1]=s*h+l*f,e[2]=s*u+l*m,e[3]=s*d+l*g,e}function ze(e,t){var i,r=t[0]+t[4]+t[8];if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,e[0]=(t[5]-t[7])*(i=.5/i),e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);var a=(n+1)%3,o=(n+2)%3;i=Math.sqrt(t[3*n+n]-t[3*a+a]-t[3*o+o]+1),e[n]=.5*i,e[3]=(t[3*a+o]-t[3*o+a])*(i=.5/i),e[a]=(t[3*a+n]+t[3*n+a])*i,e[o]=(t[3*o+n]+t[3*n+o])*i}return e}Z.clone=Me.clone,Z.fromValues=Me.fromValues,Z.copy=Me.copy,Z.set=Me.set,Z.add=Me.add,Z.mul=ke;var Fe=Me.scale;Z.scale=Fe;var Oe=Me.dot;Z.dot=Oe,Z.lerp=Me.lerp;var Be=Me.length;Z.length=Be,Z.len=Be;var Ne=Me.squaredLength;Z.squaredLength=Ne,Z.sqrLen=Ne;var Ve=Me.normalize;Z.normalize=Ve,Z.exactEquals=Me.exactEquals,Z.equals=Me.equals;var je,Ue,Ge,qe=(je=Ee.create(),Ue=Ee.fromValues(1,0,0),Ge=Ee.fromValues(0,1,0),function(e,t,i){var r=Ee.dot(t,i);return r<-.999999?(Ee.cross(je,Ue,t),Ee.len(je)<1e-6&&Ee.cross(je,Ge,t),Ee.normalize(je,je),Ie(e,je,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(Ee.cross(je,t,i),e[0]=je[0],e[1]=je[1],e[2]=je[2],e[3]=1+r,Ve(e,e))});Z.rotationTo=qe;var He,We,Ze=(He=Ce(),We=Ce(),function(e,t,i,r,n,a){return Le(He,t,n,a),Le(We,i,r,a),Le(e,He,We,2*a*(1-a)),e});Z.sqlerp=Ze;var Qe,Xe=(Qe=Te.create(),function(e,t,i,r){return Qe[0]=i[0],Qe[3]=i[1],Qe[6]=i[2],Qe[1]=r[0],Qe[4]=r[1],Qe[7]=r[2],Qe[2]=-t[0],Qe[5]=-t[1],Qe[8]=-t[2],Ve(e,ze(e,Qe))});Z.setAxes=Xe;var Ye={};function Je(e){return Je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Je(e)}Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.create=function(){var e=new Ke.ARRAY_TYPE(8);return Ke.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},Ye.clone=function(e){var t=new Ke.ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},Ye.fromValues=function(e,t,i,r,n,a,o,s){var l=new Ke.ARRAY_TYPE(8);return l[0]=e,l[1]=t,l[2]=i,l[3]=r,l[4]=n,l[5]=a,l[6]=o,l[7]=s,l},Ye.fromRotationTranslationValues=function(e,t,i,r,n,a,o){var s=new Ke.ARRAY_TYPE(8);s[0]=e,s[1]=t,s[2]=i,s[3]=r;var l=.5*n,c=.5*a,h=.5*o;return s[4]=l*r+c*i-h*t,s[5]=c*r+h*e-l*i,s[6]=h*r+l*t-c*e,s[7]=-l*e-c*t-h*i,s},Ye.fromRotationTranslation=rt,Ye.fromTranslation=function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},Ye.fromRotation=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},Ye.fromMat4=function(e,t){var i=$e.create();et.getRotation(i,t);var r=new Ke.ARRAY_TYPE(3);return et.getTranslation(r,t),rt(e,i,r),e},Ye.copy=nt,Ye.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},Ye.set=function(e,t,i,r,n,a,o,s,l){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=a,e[5]=o,e[6]=s,e[7]=l,e},Ye.getDual=function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},Ye.setDual=function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},Ye.getTranslation=function(e,t){var i=t[4],r=t[5],n=t[6],a=t[7],o=-t[0],s=-t[1],l=-t[2],c=t[3];return e[0]=2*(i*c+a*o+r*l-n*s),e[1]=2*(r*c+a*s+n*o-i*l),e[2]=2*(n*c+a*l+i*s-r*o),e},Ye.translate=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=.5*i[0],l=.5*i[1],c=.5*i[2],h=t[4],u=t[5],d=t[6],p=t[7];return e[0]=r,e[1]=n,e[2]=a,e[3]=o,e[4]=o*s+n*c-a*l+h,e[5]=o*l+a*s-r*c+u,e[6]=o*c+r*l-n*s+d,e[7]=-r*s-n*l-a*c+p,e},Ye.rotateX=function(e,t,i){var r=-t[0],n=-t[1],a=-t[2],o=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=s*o+h*r+l*a-c*n,d=l*o+h*n+c*r-s*a,p=c*o+h*a+s*n-l*r,f=h*o-s*r-l*n-c*a;return $e.rotateX(e,t,i),e[4]=u*(o=e[3])+f*(r=e[0])+d*(a=e[2])-p*(n=e[1]),e[5]=d*o+f*n+p*r-u*a,e[6]=p*o+f*a+u*n-d*r,e[7]=f*o-u*r-d*n-p*a,e},Ye.rotateY=function(e,t,i){var r=-t[0],n=-t[1],a=-t[2],o=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=s*o+h*r+l*a-c*n,d=l*o+h*n+c*r-s*a,p=c*o+h*a+s*n-l*r,f=h*o-s*r-l*n-c*a;return $e.rotateY(e,t,i),e[4]=u*(o=e[3])+f*(r=e[0])+d*(a=e[2])-p*(n=e[1]),e[5]=d*o+f*n+p*r-u*a,e[6]=p*o+f*a+u*n-d*r,e[7]=f*o-u*r-d*n-p*a,e},Ye.rotateZ=function(e,t,i){var r=-t[0],n=-t[1],a=-t[2],o=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=s*o+h*r+l*a-c*n,d=l*o+h*n+c*r-s*a,p=c*o+h*a+s*n-l*r,f=h*o-s*r-l*n-c*a;return $e.rotateZ(e,t,i),e[4]=u*(o=e[3])+f*(r=e[0])+d*(a=e[2])-p*(n=e[1]),e[5]=d*o+f*n+p*r-u*a,e[6]=p*o+f*a+u*n-d*r,e[7]=f*o-u*r-d*n-p*a,e},Ye.rotateByQuatAppend=function(e,t,i){var r=i[0],n=i[1],a=i[2],o=i[3],s=t[0],l=t[1],c=t[2],h=t[3];return e[0]=s*o+h*r+l*a-c*n,e[1]=l*o+h*n+c*r-s*a,e[2]=c*o+h*a+s*n-l*r,e[3]=h*o-s*r-l*n-c*a,e[4]=(s=t[4])*o+(h=t[7])*r+(l=t[5])*a-(c=t[6])*n,e[5]=l*o+h*n+c*r-s*a,e[6]=c*o+h*a+s*n-l*r,e[7]=h*o-s*r-l*n-c*a,e},Ye.rotateByQuatPrepend=function(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=i[0],l=i[1],c=i[2],h=i[3];return e[0]=r*h+o*s+n*c-a*l,e[1]=n*h+o*l+a*s-r*c,e[2]=a*h+o*c+r*l-n*s,e[3]=o*h-r*s-n*l-a*c,e[4]=r*(h=i[7])+o*(s=i[4])+n*(c=i[6])-a*(l=i[5]),e[5]=n*h+o*l+a*s-r*c,e[6]=a*h+o*c+r*l-n*s,e[7]=o*h-r*s-n*l-a*c,e},Ye.rotateAroundAxis=function(e,t,i,r){if(Math.abs(r)<Ke.EPSILON)return nt(e,t);var n=Math.hypot(i[0],i[1],i[2]);r*=.5;var a=Math.sin(r),o=a*i[0]/n,s=a*i[1]/n,l=a*i[2]/n,c=Math.cos(r),h=t[0],u=t[1],d=t[2],p=t[3];e[0]=h*c+p*o+u*l-d*s,e[1]=u*c+p*s+d*o-h*l,e[2]=d*c+p*l+h*s-u*o,e[3]=p*c-h*o-u*s-d*l;var f=t[4],m=t[5],g=t[6],_=t[7];return e[4]=f*c+_*o+m*l-g*s,e[5]=m*c+_*s+g*o-f*l,e[6]=g*c+_*l+f*s-m*o,e[7]=_*c-f*o-m*s-g*l,e},Ye.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e},Ye.multiply=at,Ye.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e},Ye.lerp=function(e,t,i,r){var n=1-r;return ot(t,i)<0&&(r=-r),e[0]=t[0]*n+i[0]*r,e[1]=t[1]*n+i[1]*r,e[2]=t[2]*n+i[2]*r,e[3]=t[3]*n+i[3]*r,e[4]=t[4]*n+i[4]*r,e[5]=t[5]*n+i[5]*r,e[6]=t[6]*n+i[6]*r,e[7]=t[7]*n+i[7]*r,e},Ye.invert=function(e,t){var i=lt(t);return e[0]=-t[0]/i,e[1]=-t[1]/i,e[2]=-t[2]/i,e[3]=t[3]/i,e[4]=-t[4]/i,e[5]=-t[5]/i,e[6]=-t[6]/i,e[7]=t[7]/i,e},Ye.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},Ye.normalize=function(e,t){var i=lt(t);if(i>0){i=Math.sqrt(i);var r=t[0]/i,n=t[1]/i,a=t[2]/i,o=t[3]/i,s=t[4],l=t[5],c=t[6],h=t[7],u=r*s+n*l+a*c+o*h;e[0]=r,e[1]=n,e[2]=a,e[3]=o,e[4]=(s-r*u)/i,e[5]=(l-n*u)/i,e[6]=(c-a*u)/i,e[7]=(h-o*u)/i}return e},Ye.str=function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},Ye.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},Ye.equals=function(e,t){var i=e[0],r=e[1],n=e[2],a=e[3],o=e[4],s=e[5],l=e[6],c=e[7],h=t[0],u=t[1],d=t[2],p=t[3],f=t[4],m=t[5],g=t[6],_=t[7];return Math.abs(i-h)<=Ke.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(r-u)<=Ke.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(n-d)<=Ke.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(a-p)<=Ke.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(o-f)<=Ke.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-m)<=Ke.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(l-g)<=Ke.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-_)<=Ke.EPSILON*Math.max(1,Math.abs(c),Math.abs(_))},Ye.sqrLen=Ye.squaredLength=Ye.len=Ye.length=Ye.dot=Ye.mul=Ye.setReal=Ye.getReal=void 0;var Ke=it(p),$e=it(Z),et=it(F);function tt(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(tt=function(e){return e?i:t})(e)}function it(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==Je(e)&&"function"!=typeof e)return{default:e};var i=tt(t);if(i&&i.has(e))return i.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=n?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,i&&i.set(e,r),r}function rt(e,t,i){var r=.5*i[0],n=.5*i[1],a=.5*i[2],o=t[0],s=t[1],l=t[2],c=t[3];return e[0]=o,e[1]=s,e[2]=l,e[3]=c,e[4]=r*c+n*l-a*s,e[5]=n*c+a*o-r*l,e[6]=a*c+r*s-n*o,e[7]=-r*o-n*s-a*l,e}function nt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function at(e,t,i){var r=t[0],n=t[1],a=t[2],o=t[3],s=i[4],l=i[5],c=i[6],h=i[7],u=t[4],d=t[5],p=t[6],f=t[7],m=i[0],g=i[1],_=i[2],y=i[3];return e[0]=r*y+o*m+n*_-a*g,e[1]=n*y+o*g+a*m-r*_,e[2]=a*y+o*_+r*g-n*m,e[3]=o*y-r*m-n*g-a*_,e[4]=r*h+o*s+n*c-a*l+u*y+f*m+d*_-p*g,e[5]=n*h+o*l+a*s-r*c+d*y+f*g+p*m-u*_,e[6]=a*h+o*c+r*l-n*s+p*y+f*_+u*g-d*m,e[7]=o*h-r*s-n*l-a*c+f*y-u*m-d*g-p*_,e}Ye.getReal=$e.copy,Ye.setReal=$e.copy,Ye.mul=at;var ot=$e.dot;Ye.dot=ot;var st=$e.length;Ye.length=st,Ye.len=st;var lt=$e.squaredLength;Ye.squaredLength=lt,Ye.sqrLen=lt;var ct={};function ht(e){return ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ht(e)}Object.defineProperty(ct,"__esModule",{value:!0}),ct.create=pt,ct.clone=function(e){var t=new ut.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},ct.fromValues=function(e,t){var i=new ut.ARRAY_TYPE(2);return i[0]=e,i[1]=t,i},ct.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},ct.set=function(e,t,i){return e[0]=t,e[1]=i,e},ct.add=function(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e},ct.subtract=ft,ct.multiply=mt,ct.divide=gt,ct.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},ct.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},ct.min=function(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e},ct.max=function(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e},ct.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},ct.scale=function(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e},ct.scaleAndAdd=function(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e},ct.distance=_t,ct.squaredDistance=yt,ct.length=vt,ct.squaredLength=xt,ct.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},ct.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},ct.normalize=function(e,t){var i=t[0],r=t[1],n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e},ct.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},ct.cross=function(e,t,i){var r=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=r,e},ct.lerp=function(e,t,i,r){var n=t[0],a=t[1];return e[0]=n+r*(i[0]-n),e[1]=a+r*(i[1]-a),e},ct.random=function(e,t){t=t||1;var i=2*ut.RANDOM()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e},ct.transformMat2=function(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[2]*n,e[1]=i[1]*r+i[3]*n,e},ct.transformMat2d=function(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[2]*n+i[4],e[1]=i[1]*r+i[3]*n+i[5],e},ct.transformMat3=function(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[3]*n+i[6],e[1]=i[1]*r+i[4]*n+i[7],e},ct.transformMat4=function(e,t,i){var r=t[0],n=t[1];return e[0]=i[0]*r+i[4]*n+i[12],e[1]=i[1]*r+i[5]*n+i[13],e},ct.rotate=function(e,t,i,r){var n=t[0]-i[0],a=t[1]-i[1],o=Math.sin(r),s=Math.cos(r);return e[0]=n*s-a*o+i[0],e[1]=n*o+a*s+i[1],e},ct.angle=function(e,t){var i=e[0],r=e[1],n=t[0],a=t[1],o=Math.sqrt(i*i+r*r)*Math.sqrt(n*n+a*a);return Math.acos(Math.min(Math.max(o&&(i*n+r*a)/o,-1),1))},ct.zero=function(e){return e[0]=0,e[1]=0,e},ct.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},ct.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},ct.equals=function(e,t){var i=e[0],r=e[1],n=t[0],a=t[1];return Math.abs(i-n)<=ut.EPSILON*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-a)<=ut.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))},ct.forEach=ct.sqrLen=ct.sqrDist=ct.dist=ct.div=ct.mul=ct.sub=ct.len=void 0;var ut=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==ht(e)&&"function"!=typeof e)return{default:e};var i=dt(void 0);if(i&&i.has(e))return i.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=n?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,i&&i.set(e,r),r}(p);function dt(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(dt=function(e){return e?i:t})(e)}function pt(){var e=new ut.ARRAY_TYPE(2);return ut.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function ft(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function mt(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function gt(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function _t(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1])}function yt(e,t){var i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function vt(e){return Math.hypot(e[0],e[1])}function xt(e){var t=e[0],i=e[1];return t*t+i*i}ct.len=vt,ct.sub=ft,ct.mul=mt,ct.div=gt,ct.dist=_t,ct.sqrDist=yt,ct.sqrLen=xt;var bt=function(){var e=pt();return function(t,i,r,n,a,o){var s,l;for(i||(i=2),r||(r=0),l=n?Math.min(n*i+r,t.length):t.length,s=r;s<l;s+=i)e[0]=t[s],e[1]=t[s+1],a(e,e,o),t[s]=e[0],t[s+1]=e[1];return t}}();function wt(e){return wt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wt(e)}ct.forEach=bt,Object.defineProperty(d,"__esModule",{value:!0}),e.aa=d.vec4=e.Q=d.vec3=d.vec2=d.quat2=e.bl=d.quat=e.a9=d.mat4=e.ct=d.mat3=d.mat2d=e.b7=d.mat2=d.glMatrix=void 0;var St=Lt(p);d.glMatrix=St;var Tt=Lt(y);e.b7=d.mat2=Tt;var Et=Lt(T);d.mat2d=Et;var Mt=Lt(I);e.ct=d.mat3=Mt;var At=Lt(F);e.a9=d.mat4=At;var Pt=Lt(Z);e.bl=d.quat=Pt;var Ct=Lt(Ye);d.quat2=Ct;var It=Lt(ct);d.vec2=It;var kt=Lt(Q);e.Q=d.vec3=kt;var Dt=Lt(ce);function Rt(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(Rt=function(e){return e?i:t})(e)}function Lt(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!==wt(e)&&"function"!=typeof e)return{default:e};var i=Rt(t);if(i&&i.has(e))return i.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var o=n?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,i&&i.set(e,r),r}e.aa=d.vec4=Dt;var zt=Ft;function Ft(e,t,i,r){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=i,this.p2y=r}Ft.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var i=e,r=0;r<8;r++){var n=this.sampleCurveX(i)-e;if(Math.abs(n)<t)return i;var a=this.sampleCurveDerivativeX(i);if(Math.abs(a)<1e-6)break;i-=n/a}var o=0,s=1;for(i=e,r=0;r<20&&(n=this.sampleCurveX(i),!(Math.abs(n-e)<t));r++)e>n?o=i:s=i,i=.5*(s-o)+o;return i},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var Ot=u(zt),Bt=Nt;function Nt(e,t){this.x=e,this.y=t}Nt.prototype={clone:function(){return new Nt(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),r=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=r,this},_rotateAround:function(e,t){var i=Math.cos(e),r=Math.sin(e),n=t.y+r*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-r*(this.y-t.y),this.y=n,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Nt.convert=function(e){return e instanceof Nt?e:Array.isArray(e)?new Nt(e[0],e[1]):e};var Vt=u(Bt);const jt=Math.PI/180,Ut=180/Math.PI;function Gt(e){return e*jt}function qt(e){return e*Ut}const Ht=[[0,0],[1,0],[1,1],[0,1]];function Wt(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,i=t*e;return 4*(e<.5?i:3*(e-t)+i-.75)}function Zt(e,t,i,r){const n=new Ot(e,t,i,r);return function(e){return n.solve(e)}}const Qt=Zt(.25,.1,.25,1);function Xt(e,t,i){return Math.min(i,Math.max(t,e))}function Yt(e,t,i){return(i=Xt((i-e)/(t-e),0,1))*i*(3-2*i)}function Jt(e,t,i){const r=i-t,n=((e-t)%r+r)%r+t;return n===t?i:n}function Kt(e,t,i){if(!e.length)return i(null,[]);let r=e.length;const n=new Array(e.length);let a=null;e.forEach(((e,o)=>{t(e,((e,t)=>{e&&(a=e),n[o]=t,0==--r&&i(a,n)}))}))}function $t(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];for(const n of i)for(const t in n)e[t]=n[t];return e}let ei=1;function ti(){return ei++}function ii(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function ri(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function ni(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function ai(e,t){e.forEach((e=>{t[e]&&(t[e]=t[e].bind(t))}))}function oi(e,t){return-1!==e.indexOf(t,e.length-t.length)}function si(e,t,i){const r={};for(const n in e)r[n]=t.call(this,e[n],n,e);return r}function li(e,t,i){const r={};for(const n in e)t.call(this,e[n],n,e)&&(r[n]=e[n]);return r}function ci(e){return Array.isArray(e)?e.map(ci):"object"==typeof e&&e?si(e,ci):e}const hi={};function ui(e){hi[e]||("undefined"!=typeof console&&console.warn(e),hi[e]=!0)}function di(e,t,i){return(i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}function pi(e){let t=0;for(let i,r,n=0,a=e.length,o=a-1;n<a;o=n++)i=e[n],r=e[o],t+=(r.x-i.x)*(i.y+r.y);return t}function fi(e){let[t,i,r]=e;const n=Gt(i+90),a=Gt(r);return{x:t*Math.cos(n)*Math.sin(a),y:t*Math.sin(n)*Math.sin(a),z:t*Math.cos(a),azimuthal:i,polar:r}}function mi(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function gi(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((e,i,r,n)=>{const a=r||n;return t[i]=!a||a.toLowerCase(),""})),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let _i,yi,vi,xi,bi,wi,Si=null;function Ti(e){try{const t=self[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}}function Ei(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function Mi(e,t,i,r){for(;t<i;){const n=t+i>>1;e[n]<r?t=n+1:i=n}return t}function Ai(e,t,i,r){for(;t<i;){const n=t+i>>1;e[n]<=r?t=n+1:i=n}return t}function Pi(e){return e>0?1/(1.001-e):1+e}function Ci(e){return e>0?1-1/(1.001-e):-e}function Ii(){return null==_i&&(_i=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),_i}const ki={now:()=>void 0!==xi?xi:performance.now(),setNow(e){xi=e},restoreNow(){xi=void 0},frame(e){const t=requestAnimationFrame(e);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{width:i,height:r}=e;bi||(bi=document.createElement("canvas"));const n=bi.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return(i>bi.width||r>bi.height)&&(bi.width=i,bi.height=r),n.clearRect(-t,-t,i+2*t,r+2*t),n.drawImage(e,0,0,i,r),n.getImageData(-t,-t,i+2*t,r+2*t)},resolveURL:e=>(yi||(yi=document.createElement("a")),yi.href=e,yi.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==vi&&(vi=window.matchMedia("(prefers-reduced-motion: reduce)")),vi.matches)},hasCanvasFingerprintNoise(){if(void 0!==wi)return wi;if(!Ii())return wi=!1,!1;const e=new OffscreenCanvas(85,1),t=e.getContext("2d",{willReadFrequently:!0});let i=0;for(let n=0;n<e.width;++n)t.fillStyle="rgba(".concat(i++,",").concat(i++,",").concat(i++,", 255)"),t.fillRect(n,0,1,1);const r=t.getImageData(0,0,e.width,e.height);i=0;for(let n=0;n<r.data.length;++n)if(n%4!=3&&i++!==r.data[n])return wi=!0,!0;return wi=!1,!1}};function Di(e,t){const i=e.indexOf("?");if(i<0)return"".concat(e,"?").concat(new URLSearchParams(t).toString());const r=new URLSearchParams(e.slice(i));for(const n in t)r.set(n,t[n]);return"".concat(e.slice(0,i),"?").concat(r.toString())}function Ri(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{persistentParams:[]};const i=e.indexOf("?");if(i<0)return e;const r=new URLSearchParams,n=new URLSearchParams(e.slice(i));for(const o of t.persistentParams){const e=n.get(o);e&&r.set(o,e)}const a=r.toString();return"".concat(e.slice(0,i)).concat(a.length>0?"?".concat(a):"")}const Li="mapbox-tiles";let zi,Fi,Oi=500,Bi=50;function Ni(){try{return caches}catch(e){}}function Vi(){const e=Ni();e&&!zi&&(zi=e.open(Li))}let ji=1/0;const Ui={supported:!1,testSupport:function(e){!Hi&&qi&&(Wi?Qi(e):Gi=e)}};let Gi,qi,Hi=!1,Wi=!1;const Zi="undefined"!=typeof self?self:{};function Qi(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,qi),e.isContextLost())return;Ui.supported=!0}catch(e){}e.deleteTexture(t),Hi=!0}Zi.document&&(qi=Zi.document.createElement("img"),qi.onload=function(){Gi&&Qi(Gi),Gi=null,Wi=!0},qi.onerror=function(){Hi=!0,Gi=null},qi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Xi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Xi);class Yi extends Error{constructor(e,t,i){401===t&&n(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=i}toString(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}const Ji=mi()?()=>self.worker&&self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,Ki=function(e,t){if(!(/^file:/.test(i=e.url)||/^file:/.test(Ji())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(e,t){const i=new AbortController,r=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:Ji(),referrerPolicy:e.referrerPolicy,signal:i.signal});let a=!1,o=!1;const s=(l=r.url).indexOf("sku=")>0&&n(l);var l;"json"===e.type&&r.headers.set("Accept","application/json");const c=(i,n,a)=>{if(o)return;if(i&&"SecurityError"!==i.message&&ui(i.toString()),n&&a)return h(n);const l=Date.now();fetch(r).then((i=>{if(i.ok){const e=s?i.clone():null;return h(i,e,l)}return t(new Yi(i.statusText,i.status,e.url))})).catch((i=>{"AbortError"!==i.name&&t(new Error("".concat(i.message," ").concat(e.url)))}))},h=(i,n,s)=>{("arrayBuffer"===e.type?i.arrayBuffer():"json"===e.type?i.json():i.text()).then((e=>{o||(n&&s&&function(e,t,i){if(Vi(),!zi)return;const r=gi(t.headers.get("Cache-Control")||"");if(r["no-store"])return;const n={status:t.status,statusText:t.statusText,headers:new Headers};t.headers.forEach(((e,t)=>n.headers.set(t,e))),r["max-age"]&&n.headers.set("Expires",new Date(i+1e3*r["max-age"]).toUTCString());const a=n.headers.get("Expires");if(!a)return;if(new Date(a).getTime()-i<42e4)return;let o=Ri(e.url,{persistentParams:["language","worldview"]});if(206===t.status){const t=e.headers.get("Range");if(!t)return;n.status=200,o=Di(o,{range:t})}!function(e,t){if(void 0===Fi)try{new Response(new ReadableStream),Fi=!0}catch(e){Fi=!1}Fi?t(e.body):e.blob().then(t)}(t,(e=>{const t=new Response(e,n);Vi(),zi&&zi.then((e=>e.put(o,t))).catch((e=>ui(e.message)))}))}(r,n,s),a=!0,t(null,e,i.headers.get("Cache-Control"),i.headers.get("Expires")))})).catch((e=>{o||t(new Error(e.message))}))};return s?function(e,t){if(Vi(),!zi)return t(null);zi.then((i=>{let r=Ri(e.url,{persistentParams:["language","worldview"]});const n=e.headers.get("Range");n&&(r=Di(r,{range:n})),i.match(r).then((e=>{const n=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),i=gi(e.headers.get("Cache-Control")||"");return t>Date.now()&&!i["no-cache"]}(e);i.delete(r),n&&i.put(r,e.clone()),t(null,e,n)})).catch(t)})).catch(t)}(r,c):c(null,null),{cancel:()=>{o=!0,a||i.abort()}}}(e,t);if(mi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var i;return function(e,t){const i=new XMLHttpRequest;i.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(i.responseType="arraybuffer");for(const r in e.headers)i.setRequestHeader(r,e.headers[r]);return"json"===e.type&&(i.responseType="text",i.setRequestHeader("Accept","application/json")),i.withCredentials="include"===e.credentials,i.onerror=()=>{t(new Error(i.statusText))},i.onload=()=>{if((i.status>=200&&i.status<300||0===i.status)&&null!==i.response){let r=i.response;if("json"===e.type)try{r=JSON.parse(i.response)}catch(e){return t(e)}t(null,r,i.getResponseHeader("Cache-Control"),i.getResponseHeader("Expires"))}else t(new Yi(i.statusText,i.status,e.url))},i.send(e.body),{cancel:()=>i.abort()}}(e,t)},$i=function(e,t){return Ki($t(e,{type:"arrayBuffer"}),t)};function er(e){const t=document.createElement("a");return t.href=e,t.protocol===location.protocol&&t.host===location.host}const tr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ir,rr;ir=[],rr=0;const nr=function(e,t){if(Ui.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),rr>=r.MAX_PARALLEL_IMAGE_REQUESTS){const i={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return ir.push(i),i}rr++;let i=!1;const n=()=>{if(!i)for(i=!0,rr--;ir.length&&rr<r.MAX_PARALLEL_IMAGE_REQUESTS;){const e=ir.shift(),{requestParameters:t,callback:i,cancelled:r}=e;r||(e.cancel=nr(t,i).cancel)}},a=$i(e,((e,i,r,a)=>{n(),e?t(e):i&&(self.createImageBitmap?function(e,t){const i=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(i).then((e=>{t(null,e)})).catch((e=>{t(new Error("Could not load image because of ".concat(e.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))}))}(i,((e,i)=>t(e,i,r,a))):function(e,t){const i=new Image;i.onload=()=>{t(null,i),URL.revokeObjectURL(i.src),i.onload=null,requestAnimationFrame((()=>{i.src=tr}))},i.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const r=new Blob([new Uint8Array(e)],{type:"image/png"});i.src=e.byteLength?URL.createObjectURL(r):tr}(i,((e,i)=>t(e,i,r,a))))}));return{cancel:()=>{a.cancel(),n()}}},ar="01",or="NO_ACCESS_TOKEN",sr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function lr(e){const t=e.match(sr);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function cr(e){const t=e.params.length?"?".concat(e.params.join("&")):"";return"".concat(e.protocol,"://").concat(e.authority).concat(e.path).concat(t)}const hr="mapbox.eventData";function ur(e){if(!e)return null;const t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(atob(t[1]).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join("")))}catch(e){return null}}class dr{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const t=ur(r.ACCESS_TOKEN);let i="";return i=t&&t.u?btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode(Number("0x"+t))))):r.ACCESS_TOKEN||"",e?"".concat(hr,".").concat(e,":").concat(i):"".concat(hr,":").concat(i)}fetchEventData(){const e=Ti("localStorage"),t=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{const e=localStorage.getItem(t);e&&(this.eventData=JSON.parse(e));const r=localStorage.getItem(i);r&&(this.anonId=r)}catch(e){ui("Unable to read from LocalStorage")}}saveEventData(){const e=Ti("localStorage"),t=this.getStorageKey(),i=this.getStorageKey("uuid"),r=this.anonId;if(e&&r)try{localStorage.setItem(i,r),Object.keys(this.eventData).length>=1&&localStorage.setItem(t,JSON.stringify(this.eventData))}catch(e){ui("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,i,n){if(!r.EVENTS_URL)return;const a=lr(r.EVENTS_URL);a.params.push("access_token=".concat(n||r.ACCESS_TOKEN||""));const o={event:this.type,created:new Date(e).toISOString()},s=t?$t(o,t):o,l={url:cr(a),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=function(e,t){return Ki($t(e,{method:"POST"}),t)}(l,(e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(n)}))}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const pr=new class extends dr{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){r.EVENTS_URL&&r.ACCESS_TOKEN&&Array.isArray(e)&&e.some((e=>a(e)||n(e)))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=ur(r.ACCESS_TOKEN),n=i?i.u:r.ACCESS_TOKEN;let a=n!==this.eventData.tokenU;ni(this.anonId)||(this.anonId=ii(),a=!0);const o=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(o),i=(o-this.eventData.lastSuccess)/864e5;a=a||i>=1||i<-1||e.getDate()!==t.getDate()}else a=!0;a?this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:ar,"enabled.telemetry":!1,userId:this.anonId},(e=>{e||(this.eventData.lastSuccess=o,this.eventData.tokenU=n)}),e):this.processRequests()}},fr=pr.postTurnstileEvent.bind(pr),mr=new class extends dr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,i,n){this.skuToken=t,this.errorCb=n,r.EVENTS_URL&&(i||r.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(or)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:r}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),ni(this.anonId)||(this.anonId=ii()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:ar,skuToken:this.skuToken,userId:this.anonId},(e=>{e?this.errorCb(e):i&&(this.success[i]=!0)}),e))}remove(){this.errorCb=null}},gr=mr.postMapLoadEvent.bind(mr),_r=new class extends dr{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(e){let t=this.mapInstanceIdMap.get(e);return t||(t=ii(),this.mapInstanceIdMap.set(e,t)),t}getEventId(e){const t=this.eventIdPerMapInstanceMap.get(e)||0;return this.eventIdPerMapInstanceMap.set(e,t+1),t}postStyleLoadEvent(e,t){const{map:i,style:n,importedStyles:a}=t;if(!r.EVENTS_URL||!e&&!r.ACCESS_TOKEN)return;const o=this.getMapInstanceId(i),s={mapInstanceId:o,eventId:this.getEventId(o),style:n};a.length&&(s.importedStyles=a),this.queueRequest({timestamp:Date.now(),payload:s},e)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,payload:i}=this.queue.shift();this.postEvent(t,i,(()=>{}),e)}},yr=_r.postStyleLoadEvent.bind(_r),vr=new class extends dr{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){r.EVENTS_URL&&(e||r.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:i,performanceData:r}=this.queue.shift(),n=function(e){const i=performance.getEntriesByType("resource"),r=performance.getEntriesByType("mark"),n=function(e){const t={};if(e)for(const i in e)if("other"!==i)for(const r of e[i]){const e="".concat(i,"ResolveRangeMin"),n="".concat(i,"ResolveRangeMax"),a="".concat(i,"RequestCount"),o="".concat(i,"RequestCachedCount");t[e]=Math.min(t[e]||1/0,r.startTime),t[n]=Math.max(t[n]||-1/0,r.responseEnd);const s=e=>{void 0===t[e]&&(t[e]=0),++t[e]};void 0!==r.transferSize&&0===r.transferSize&&s(o),s(a)}return t}(function(e,t){const i={};if(e)for(const r of e){const e=t(r);void 0===i[e]&&(i[e]=[]),i[e].push(r)}return i}(i,h)),a=window.devicePixelRatio,o=navigator.connection||navigator.mozConnection||navigator.webkitConnection,s=o?o.effectiveType:void 0,u={counters:[],metadata:[],attributes:[]},d=(e,t,i)=>{null!=i&&e.push({name:t,value:i.toString()})};for(const t in n)d(u.counters,t,n[t]);if(e.interactionRange[0]!==1/0&&e.interactionRange[1]!==-1/0&&(d(u.counters,"interactionRangeMin",e.interactionRange[0]),d(u.counters,"interactionRangeMax",e.interactionRange[1])),r)for(const t of Object.keys(c)){const e=c[t],i=r.find((t=>t.name===e));i&&d(u.counters,e,i.startTime)}return d(u.counters,"visibilityHidden",e.visibilityHidden),d(u.attributes,"style",function(e){if(e)for(const t of e){const e=t.name.split("?")[0];if(l(e)){const t=e.split("/").slice(-2);if(2===t.length)return"mapbox://styles/".concat(t[0],"/").concat(t[1])}}}(i)),d(u.attributes,"terrainEnabled",e.terrainEnabled?"true":"false"),d(u.attributes,"fogEnabled",e.fogEnabled?"true":"false"),d(u.attributes,"projection",e.projection),d(u.attributes,"zoom",e.zoom),d(u.metadata,"devicePixelRatio",a),d(u.metadata,"connectionEffectiveType",s),d(u.metadata,"navigatorUserAgent",navigator.userAgent),d(u.metadata,"screenWidth",window.screen.width),d(u.metadata,"screenHeight",window.screen.height),d(u.metadata,"windowWidth",window.innerWidth),d(u.metadata,"windowHeight",window.innerHeight),d(u.metadata,"mapWidth",e.width/a),d(u.metadata,"mapHeight",e.height/a),d(u.metadata,"webglRenderer",e.renderer),d(u.metadata,"webglVendor",e.vendor),d(u.metadata,"sdkVersion",t),d(u.metadata,"sdkIdentifier","mapbox-gl-js"),u}(r);for(const t of n.metadata);for(const t of n.counters);for(const t of n.attributes);this.postEvent(i,n,(()=>{}),e)}},xr=vr.postPerformanceEvent.bind(vr),br=new class extends dr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,i,n){if(!r.API_URL||!r.SESSION_PATH)return;const a=lr(r.API_URL+r.SESSION_PATH);a.params.push("sku=".concat(t||"")),a.params.push("access_token=".concat(n||r.ACCESS_TOKEN||""));const o={url:cr(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(e,t){return Ki($t(e,{method:"GET"}),t)}(o,(e=>{this.pendingRequest=null,i(e),this.saveEventData(),this.processRequests(n)}))}getSessionAPI(e,t,i,n){this.skuToken=t,this.errorCb=n,r.SESSION_PATH&&r.API_URL&&(i||r.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(or)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,(e=>{e?this.errorCb(e):t&&(this.success[t]=!0)}),e)}remove(){this.errorCb=null}},wr=br.getSessionAPI.bind(br),Sr=new Set;var Tr={exports:{}},Er={exports:{}};Er.exports=function(e,t){var i,r,n,a,o,s,l,c;for(r=e.length-(i=3&e.length),n=t,o=3432918353,s=461845907,c=0;c<r;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,n=27492+(65535&(a=5*(65535&(n=(n^=l=(65535&(l=(l=(65535&l)*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|n>>>19))+((5*(n>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(l=0,i){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:n^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return n^=e.length,n=2246822507*(65535&(n^=n>>>16))+((2246822507*(n>>>16)&65535)<<16)&4294967295,n=3266489909*(65535&(n^=n>>>13))+((3266489909*(n>>>16)&65535)<<16)&4294967295,(n^=n>>>16)>>>0};var Mr=Er.exports,Ar={exports:{}};Ar.exports=function(e,t){for(var i,r=e.length,n=t^r,a=0;r>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(a)|(255&e.charCodeAt(++a))<<8|(255&e.charCodeAt(++a))<<16|(255&e.charCodeAt(++a))<<24))+((1540483477*(i>>>16)&65535)<<16),n=1540483477*(65535&n)+((1540483477*(n>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++a;switch(r){case 3:n^=(255&e.charCodeAt(a+2))<<16;case 2:n^=(255&e.charCodeAt(a+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(a)))+((1540483477*(n>>>16)&65535)<<16)}return n=1540483477*(65535&(n^=n>>>13))+((1540483477*(n>>>16)&65535)<<16),(n^=n>>>15)>>>0};var Pr=Mr,Cr=Ar.exports;Tr.exports=Pr,Tr.exports.murmur3=Pr,Tr.exports.murmur2=Cr;var Ir=u(Tr.exports);function kr(e,t,i){i[e]&&-1!==i[e].indexOf(t)||(i[e]=i[e]||[],i[e].push(t))}function Dr(e,t,i){if(i&&i[e]){const r=i[e].indexOf(t);-1!==r&&i[e].splice(r,1)}}class Rr{constructor(e){$t(this,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}),this.type=e}}class Lr extends Rr{constructor(e){super("error",$t({error:e},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}))}}class zr{on(e,t){return this._listeners=this._listeners||{},kr(e,t,this._listeners),this}off(e,t){return Dr(e,t,this._listeners),Dr(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},kr(e,t,this._oneTimeListeners),this):new Promise((t=>this.once(e,t)))}fire(e,t){"string"==typeof e&&(e=new Rr(e,t||{}));const i=e.type;if(this.listens(i)){e.target=this;const t=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(const i of t)i.call(this,e);const r=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(const a of r)Dr(i,a,this._oneTimeListeners),a.call(this,e);const n=this._eventedParent;n&&($t(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),n.fire(e))}else e instanceof Lr&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}e.z=void 0;var Fr={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Or(e){return(e=Math.round(e))<0?0:e>255?255:e}function Br(e){return Or("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function Nr(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function Vr(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{e.z={}.parseCSSColor=function(e){var t,i=e.replace(/ /g,"").toLowerCase();if(i in Fr)return Fr[i].slice();if("#"===i[0])return 4===i.length?(t=parseInt(i.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===i.length&&(t=parseInt(i.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var r=i.indexOf("("),n=i.indexOf(")");if(-1!==r&&n+1===i.length){var a=i.substr(0,r),o=i.substr(r+1,n-(r+1)).split(","),s=1;switch(a){case"rgba":if(4!==o.length)return null;s=Nr(o.pop());case"rgb":return 3!==o.length?null:[Br(o[0]),Br(o[1]),Br(o[2]),s];case"hsla":if(4!==o.length)return null;s=Nr(o.pop());case"hsl":if(3!==o.length)return null;var l=(parseFloat(o[0])%360+360)%360/360,c=Nr(o[1]),h=Nr(o[2]),u=h<=.5?h*(c+1):h+c-h*c,d=2*h-u;return[Or(255*Vr(d,u,l+1/3)),Or(255*Vr(d,u,l)),Or(255*Vr(d,u,l-1/3)),s];default:return null}}return null}}catch(e){}class jr{constructor(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=e,this.g=t,this.b=i,this.a=r}static parse(t){if(!t)return;if(t instanceof jr)return t;if("string"!=typeof t)return;const i=e.z(t);return i?new jr(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,t,i,r]=this.toArray();return"rgba(".concat(Math.round(e),",").concat(Math.round(t),",").concat(Math.round(i),",").concat(r,")")}toArray(){const{r:e,g:t,b:i,a:r}=this;return 0===r?[0,0,0,0]:[255*e/r,255*t/r,255*i/r,r]}toArray01(){const{r:e,g:t,b:i,a:r}=this;return 0===r?[0,0,0,0]:[e/r,t/r,i/r,r]}toArray01Scaled(e){const{r:t,g:i,b:r,a:n}=this;return 0===n?[0,0,0]:[t/n*e,i/n*e,r/n*e]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:i,a:r}=this;return[e,t,i,r]}toArray01Linear(){const{r:e,g:t,b:i,a:r}=this;return 0===r?[0,0,0,0]:[Math.pow(e/r,2.2),Math.pow(t/r,2.2),Math.pow(i/r,2.2),r]}}function Ur(e,t,i){return e*(1-i)+t*i}function Gr(e,t,i){return e.map(((e,r)=>Ur(e,t[r],i)))}jr.black=new jr(0,0,0,1),jr.white=new jr(1,1,1,1),jr.transparent=new jr(0,0,0,0),jr.red=new jr(1,0,0,1),jr.blue=new jr(0,0,1,1);var qr=Object.freeze({__proto__:null,array:Gr,color:function(e,t,i){return new jr(Ur(e.r,t.r,i),Ur(e.g,t.g,i),Ur(e.b,t.b,i),Ur(e.a,t.a,i))},number:Ur});function Hr(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];for(const n of i)for(const t in n)e[t]=n[t];return e}class Wr extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class Zr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.parent=e,this.bindings={};for(const[i,r]of t)this.bindings[i]=r}concat(e){return new Zr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error("".concat(e," not found in scope."))}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Qr={kind:"null"},Xr={kind:"number"},Yr={kind:"string"},Jr={kind:"boolean"},Kr={kind:"color"},$r={kind:"object"},en={kind:"value"},tn={kind:"collator"},rn={kind:"formatted"},nn={kind:"resolvedImage"};function an(e,t){return{kind:"array",itemType:e,N:t}}function on(e){if("array"===e.kind){const t=on(e.itemType);return"number"==typeof e.N?"array<".concat(t,", ").concat(e.N,">"):"value"===e.itemType.kind?"array":"array<".concat(t,">")}return e.kind}const sn=[Qr,Xr,Yr,Jr,Kr,rn,$r,an(en),nn];function ln(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!ln(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of sn)if(!ln(e,t))return null}return"Expected ".concat(on(e)," but found ").concat(on(t)," instead.")}function cn(e,t){return t.some((t=>t.kind===e.kind))}function hn(e,t){return t.some((t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e))}class un{constructor(e,t,i){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class dn{constructor(e,t,i,r,n){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=i,this.fontStack=r,this.textColor=n}}class pn{constructor(e){this.sections=e}static fromString(e){return new pn([new dn(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((e=>0!==e.text.length||e.image&&0!==e.image.namePrimary.length))}static factory(e){return e instanceof pn?e:pn.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.namePrimary]);continue}e.push(t.text);const i={};t.fontStack&&(i["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(i["font-scale"]=t.scale),t.textColor&&(i["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(i)}return e}}class fn{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?"[".concat(this.namePrimary,",").concat(this.nameSecondary,"]"):this.namePrimary}static fromString(e,t){return e?new fn({namePrimary:e,nameSecondary:t,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function mn(e,t,i,r){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:"Invalid rgba value [".concat([e,t,i,r].join(", "),"]: 'a' must be between 0 and 1."):"Invalid rgba value [".concat(("number"==typeof r?[e,t,i,r]:[e,t,i]).join(", "),"]: 'r', 'g', and 'b' must be between 0 and 255.")}function gn(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof jr)return!0;if(e instanceof un)return!0;if(e instanceof pn)return!0;if(e instanceof fn)return!0;if(Array.isArray(e)){for(const t of e)if(!gn(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!gn(e[t]))return!1;return!0}return!1}function _n(e){if(null===e)return Qr;if("string"==typeof e)return Yr;if("boolean"==typeof e)return Jr;if("number"==typeof e)return Xr;if(e instanceof jr)return Kr;if(e instanceof un)return tn;if(e instanceof pn)return rn;if(e instanceof fn)return nn;if(Array.isArray(e)){const t=e.length;let i;for(const r of e){const e=_n(r);if(i){if(i===e)continue;i=en;break}i=e}return an(i||en,t)}return $r}function yn(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof jr||e instanceof pn||e instanceof fn?e.toString():JSON.stringify(e)}class vn{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error("'literal' expression requires exactly one argument, but found ".concat(e.length-1," instead."));if(!gn(e[1]))return t.error("invalid value");const i=e[1];let r=_n(i);const n=t.expectedType;return"array"!==r.kind||0!==r.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(r=n),new vn(r,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof jr?["rgba"].concat(this.value.toArray()):this.value instanceof pn?this.value.serialize():this.value}}class xn{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const bn={string:Yr,number:Xr,boolean:Jr,object:$r};class wn{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let i,r=1;const n=e[0];if("array"===n){let n,a;if(e.length>2){const i=e[1];if("string"!=typeof i||!(i in bn)||"object"===i)return t.error('The item type argument of "array" must be one of string, number, boolean',1);n=bn[i],r++}else n=en;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);a=e[2],r++}i=an(n,a)}else i=bn[n];const a=[];for(;r<e.length;r++){const i=t.parse(e[r],r,en);if(!i)return null;a.push(i)}return new wn(i,a)}evaluate(e){for(let t=0;t<this.args.length;t++){const i=this.args[t].evaluate(e);if(!ln(this.type,_n(i)))return i;if(t===this.args.length-1)throw new xn("Expected value to be of type ".concat(on(this.type),", but found ").concat(on(_n(i))," instead."))}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const i=e.itemType;if("string"===i.kind||"number"===i.kind||"boolean"===i.kind){t.push(i.kind);const r=e.N;("number"==typeof r||this.args.length>1)&&t.push(r)}}return t.concat(this.args.map((e=>e.serialize())))}}class Sn{constructor(e){this.type=rn,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return t.error("First argument must be an image or text section.");const r=[];let n=!1;for(let a=1;a<=e.length-1;++a){const i=e[a];if(n&&"object"==typeof i&&!Array.isArray(i)){n=!1;let e=null;if(i["font-scale"]&&(e=t.parse(i["font-scale"],1,Xr),!e))return null;let a=null;if(i["text-font"]&&(a=t.parse(i["text-font"],1,an(Yr)),!a))return null;let o=null;if(i["text-color"]&&(o=t.parse(i["text-color"],1,Kr),!o))return null;const s=r[r.length-1];s.scale=e,s.font=a,s.textColor=o}else{const i=t.parse(e[a],1,en);if(!i)return null;const o=i.type.kind;if("string"!==o&&"value"!==o&&"null"!==o&&"resolvedImage"!==o)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");n=!0,r.push({content:i,scale:null,font:null,textColor:null})}}return new Sn(r)}evaluate(e){return new pn(this.sections.map((t=>{const i=t.content.evaluate(e);return _n(i)===nn?new dn("",i,null,null,null):new dn(yn(i),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const i={};t.scale&&(i["font-scale"]=t.scale.serialize()),t.font&&(i["text-font"]=t.font.serialize()),t.textColor&&(i["text-color"]=t.textColor.serialize()),e.push(i)}return e}}class Tn{constructor(e,t){this.type=nn,this.inputPrimary=e,this.inputSecondary=t}static parse(e,t){if(e.length<2)return t.error("Expected two or more arguments.");const i=t.parse(e[1],1,Yr);if(!i)return t.error("No image name provided.");if(2===e.length)return new Tn(i);const r=t.parse(e[2],1,Yr);return r?new Tn(i,r):t.error("Secondary image variant is not a string.")}evaluate(e){const t=fn.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return t&&e.availableImages&&(t.available=e.availableImages.indexOf(t.namePrimary)>-1,t.nameSecondary&&t.available&&e.availableImages&&(t.available=e.availableImages.indexOf(t.nameSecondary)>-1)),t}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function En(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}const Mn={"to-boolean":Jr,"to-color":Kr,"to-number":Xr,"to-string":Yr};class An{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[0],r=[];let n=Qr;if("to-array"===i){if(!Array.isArray(e[1]))return null;const i=e[1].length;if(t.expectedType){if("array"!==t.expectedType.kind)return t.error("Expected ".concat(t.expectedType.kind," but found array."));n=an(t.expectedType.itemType,i)}else{if(!(i>0&&gn(e[1][0])))return null;n=an(_n(e[1][0]),i)}for(let a=0;a<i;a++){const i=e[1][a];let o;if("array"===En(i))o=t.parse(i,void 0,n.itemType);else{const e=En(i);if(e!==n.itemType.kind)return t.error("Expected ".concat(n.itemType.kind," but found ").concat(e,"."));o=t.registry.literal.parse(["literal",void 0===i?null:i],t)}if(!o)return null;r.push(o)}}else{if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return t.error("Expected one argument.");n=Mn[i];for(let i=1;i<e.length;i++){const n=t.parse(e[i],i,en);if(!n)return null;r.push(n)}}return new An(n,r)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,i;for(const r of this.args){if(t=r.evaluate(e),i=null,t instanceof jr)return t;if("string"==typeof t){const i=e.parseColor(t);if(i)return i}else if(Array.isArray(t)&&(i=t.length<3||t.length>4?"Invalid rbga value ".concat(JSON.stringify(t),": expected an array containing either three or four numeric values."):mn(t[0],t[1],t[2],t[3]),!i))return new jr(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new xn(i||"Could not parse color from value '".concat("string"==typeof t?t:String(JSON.stringify(t)),"'"))}if("number"===this.type.kind){let t=null;for(const i of this.args){if(t=i.evaluate(e),null===t)return 0;const r=Number(t);if(!isNaN(r))return r}throw new xn("Could not convert ".concat(JSON.stringify(t)," to number."))}return"formatted"===this.type.kind?pn.fromString(yn(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?fn.fromString(yn(this.args[0].evaluate(e))):"array"===this.type.kind?this.args.map((t=>t.evaluate(e))):yn(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new Sn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Tn(this.args[0]).serialize();const e="array"===this.type.kind?[]:["to-".concat(this.type.kind)];return this.eachChild((t=>{e.push(t.serialize())})),e}}const Pn=["Unknown","Point","LineString","Polygon"];class Cn{constructor(e,t){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=t}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Pn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*t-e[0])+this.featureDistanceData.bearing[1]*(r*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=jr.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}}class In{constructor(e,t,i,r,n){this.name=e,this.type=t,this._evaluate=i,this.args=r,this._overloadIndex=n}evaluate(e){if(!this._evaluate){const e=In.definitions[this.name];this._evaluate=Array.isArray(e)?e[2]:e.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,t){const i=e[0],r=In.definitions[i];if(!r)return t.error('Unknown expression "'.concat(i,'". If you wanted a literal array, use ["literal", [...]].'),0);const n=Array.isArray(r)?r[0]:r.type,a=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,o=[];let s=null,l=-1;for(const[c,h]of a){if(Array.isArray(c)&&c.length!==e.length-1)continue;o.push(c),l++,s=new Ga(t.registry,t.path,null,t.scope,void 0,t._scope,t.options);const r=[];let a=!1;for(let t=1;t<e.length;t++){const i=e[t],n=Array.isArray(c)?c[t-1]:c.type,o=s.parse(i,1+r.length,n);if(!o){a=!0;break}r.push(o)}if(!a)if(Array.isArray(c)&&c.length!==r.length)s.error("Expected ".concat(c.length," arguments, but found ").concat(r.length," instead."));else{for(let e=0;e<r.length;e++){const t=Array.isArray(c)?c[e]:c.type,i=r[e];s.concat(e+1).checkSubtype(t,i.type)}if(0===s.errors.length)return new In(i,n,h,r,l)}}if(1===o.length)t.errors.push(...s.errors);else{const i=(o.length?o:a.map((e=>{let[t]=e;return t}))).map(kn).join(" | "),r=[];for(let n=1;n<e.length;n++){const i=t.parse(e[n],1+r.length);if(!i)return null;r.push(on(i.type))}t.error("Expected arguments of type ".concat(i,", but found (").concat(r.join(", "),") instead."))}return null}static register(e,t){In.definitions=t;for(const i in t)e[i]=In}}function kn(e){return Array.isArray(e)?"(".concat(e.map(on).join(", "),")"):"(".concat(on(e.type),"...)")}class Dn{constructor(e,t,i){this.type=tn,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const i=e[1];if("object"!=typeof i||Array.isArray(i))return t.error("Collator options argument must be an object.");const r=t.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,Jr);if(!r)return null;const n=t.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,Jr);if(!n)return null;let a=null;return i.locale&&(a=t.parse(i.locale,1,Yr),!a)?null:new Dn(r,n,a)}evaluate(e){return new un(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Rn={exports:{}};Rn.exports=function(){function e(i,r,n,a,o){for(;a>n;){if(a-n>600){var s=a-n+1,l=r-n+1,c=Math.log(s),h=.5*Math.exp(2*c/3),u=.5*Math.sqrt(c*h*(s-h)/s)*(l-s/2<0?-1:1);e(i,r,Math.max(n,Math.floor(r-l*h/s+u)),Math.min(a,Math.floor(r+(s-l)*h/s+u)),o)}var d=i[r],p=n,f=a;for(t(i,n,r),o(i[a],d)>0&&t(i,n,a);p<f;){for(t(i,p,f),p++,f--;o(i[p],d)<0;)p++;for(;o(i[f],d)>0;)f--}0===o(i[n],d)?t(i,n,f):t(i,++f,a),f<=r&&(n=f+1),r<=f&&(a=f-1)}}function t(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function i(e,t){return e<t?-1:e>t?1:0}return function(t,r,n,a,o){e(t,r,n||0,a||t.length-1,o||i)}}();var Ln=u(Rn.exports);function zn(e){let t=0;for(let i,r,n=0,a=e.length,o=a-1;n<a;o=n++)i=e[n],r=e[o],t+=(r.x-i.x)*(i.y+r.y);return t}function Fn(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function On(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Bn(e,t,i){const r=e[0]-t[0],n=e[1]-t[1],a=e[0]-i[0],o=e[1]-i[1];return r*o-a*n==0&&r*a<=0&&n*o<=0}function Nn(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!1;for(let s=0,l=t.length;s<l;s++){const l=t[s];for(let t=0,s=l.length,c=s-1;t<s;c=t++){const s=l[c],h=l[t];if(Bn(e,s,h))return i;(a=s)[1]>(n=e)[1]!=(o=h)[1]>n[1]&&n[0]<(o[0]-a[0])*(n[1]-a[1])/(o[1]-a[1])+a[0]&&(r=!r)}}var n,a,o;return r}function Vn(e,t,i,r){const n=r[0]-i[0],a=r[1]-i[1],o=(e[0]-i[0])*a-n*(e[1]-i[1]),s=(t[0]-i[0])*a-n*(t[1]-i[1]);return o>0&&s<0||o<0&&s>0}function jn(e,t,i,r){return 0!=(n=[r[0]-i[0],r[1]-i[1]])[0]*(a=[t[0]-e[0],t[1]-e[1]])[1]-n[1]*a[0]&&!(!Vn(e,t,i,r)||!Vn(i,r,e,t));var n,a}const Un=8192;function Gn(e,t){const i=(180+e[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,n=Math.pow(2,t.z);return[Math.round(i*n*Un),Math.round(r*n*Un)]}function qn(e,t){for(let i=0;i<t.length;i++)if(Nn(e,t[i]))return!0;return!1}function Hn(e,t,i){for(const r of i)for(let i=0,n=r.length,a=n-1;i<n;a=i++)if(jn(e,t,r[a],r[i]))return!0;return!1}function Wn(e,t){for(let i=0;i<e.length;++i)if(!Nn(e[i],t))return!1;for(let i=0;i<e.length-1;++i)if(Hn(e[i],e[i+1],t))return!1;return!0}function Zn(e,t){for(let i=0;i<t.length;i++)if(Wn(e,t[i]))return!0;return!1}function Qn(e,t,i){const r=[];for(let n=0;n<e.length;n++){const a=[];for(let r=0;r<e[n].length;r++){const o=Gn(e[n][r],i);Fn(t,o),a.push(o)}r.push(a)}return r}function Xn(e,t,i){const r=[];for(let n=0;n<e.length;n++){const a=Qn(e[n],t,i);r.push(a)}return r}function Yn(e,t,i,r){if(e[0]<i[0]||e[0]>i[2]){const t=.5*r;let n=e[0]-i[0]>t?-r:i[0]-e[0]>t?r:0;0===n&&(n=e[0]-i[2]>t?-r:i[2]-e[0]>t?r:0),e[0]+=n}Fn(t,e)}function Jn(e,t,i,r){const n=Math.pow(2,r.z)*Un,a=[r.x*Un,r.y*Un],o=[];if(!e)return o;for(const s of e)for(const e of s){const r=[e.x+a[0],e.y+a[1]];Yn(r,t,i,n),o.push(r)}return o}function Kn(e,t,i,r){const n=Math.pow(2,r.z)*Un,a=[r.x*Un,r.y*Un],o=[];if(!e)return o;for(const l of e){const e=[];for(const i of l){const r=[i.x+a[0],i.y+a[1]];Fn(t,r),e.push(r)}o.push(e)}if(t[2]-t[0]<=n/2){(s=t)[0]=s[1]=1/0,s[2]=s[3]=-1/0;for(const e of o)for(const r of e)Yn(r,t,i,n)}var s;return o}class $n{constructor(e,t){this.type=Jr,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error("'within' expression requires exactly one argument, but found ".concat(e.length-1," instead."));if(gn(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const i=t.features[e].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new $n(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new $n(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new $n(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if(!n)return!1;if("Polygon"===t.type){const a=Qn(t.coordinates,r,n),o=Jn(e.geometry(),i,r,n);if(!On(i,r))return!1;for(const e of o)if(!Nn(e,a))return!1}if("MultiPolygon"===t.type){const a=Xn(t.coordinates,r,n),o=Jn(e.geometry(),i,r,n);if(!On(i,r))return!1;for(const e of o)if(!qn(e,a))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const i=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],n=e.canonicalID();if(!n)return!1;if("Polygon"===t.type){const a=Qn(t.coordinates,r,n),o=Kn(e.geometry(),i,r,n);if(!On(i,r))return!1;for(const e of o)if(!Wn(e,a))return!1}if("MultiPolygon"===t.type){const a=Xn(t.coordinates,r,n),o=Kn(e.geometry(),i,r,n);if(!On(i,r))return!1;for(const e of o)if(!Zn(e,a))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var ea={exports:{}};!function(e,t){e.exports=function(){var e={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},t=1/298.257223563,i=t*(2-t),r=Math.PI/180,n=function(t,n){if(void 0===t)throw new Error("No latitude given.");if(n&&!e[n])throw new Error("Unknown unit "+n+". Use one of: "+Object.keys(e).join(", "));var a=6378.137*r*(n?e[n]:1),o=Math.cos(t*r),s=1/(1-i*(1-o*o)),l=Math.sqrt(s);this.kx=a*l*o,this.ky=a*l*s*(1-i)},a={units:{configurable:!0}};function o(e,t){return e[0]===t[0]&&e[1]===t[1]}function s(e,t,i){var r=l(t[0]-e[0]);return[e[0]+r*i,e[1]+(t[1]-e[1])*i]}function l(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}return n.fromTile=function(e,t,i){var a=Math.PI*(1-2*(e+.5)/Math.pow(2,t)),o=Math.atan(.5*(Math.exp(a)-Math.exp(-a)))/r;return new n(o,i)},a.units.get=function(){return e},n.prototype.distance=function(e,t){var i=l(e[0]-t[0])*this.kx,r=(e[1]-t[1])*this.ky;return Math.sqrt(i*i+r*r)},n.prototype.bearing=function(e,t){var i=l(t[0]-e[0])*this.kx;return Math.atan2(i,(t[1]-e[1])*this.ky)/r},n.prototype.destination=function(e,t,i){var n=i*r;return this.offset(e,Math.sin(n)*t,Math.cos(n)*t)},n.prototype.offset=function(e,t,i){return[e[0]+t/this.kx,e[1]+i/this.ky]},n.prototype.lineDistance=function(e){for(var t=0,i=0;i<e.length-1;i++)t+=this.distance(e[i],e[i+1]);return t},n.prototype.area=function(e){for(var t=0,i=0;i<e.length;i++)for(var r=e[i],n=0,a=r.length,o=a-1;n<a;o=n++)t+=l(r[n][0]-r[o][0])*(r[n][1]+r[o][1])*(i?-1:1);return Math.abs(t)/2*this.kx*this.ky},n.prototype.along=function(e,t){var i=0;if(t<=0)return e[0];for(var r=0;r<e.length-1;r++){var n=e[r],a=e[r+1],o=this.distance(n,a);if((i+=o)>t)return s(n,a,(t-(i-o))/o)}return e[e.length-1]},n.prototype.pointToSegmentDistance=function(e,t,i){var r=t[0],n=t[1],a=l(i[0]-r)*this.kx,o=(i[1]-n)*this.ky,s=0;return 0===a&&0===o||((s=(l(e[0]-r)*this.kx*a+(e[1]-n)*this.ky*o)/(a*a+o*o))>1?(r=i[0],n=i[1]):s>0&&(r+=a/this.kx*s,n+=o/this.ky*s)),a=l(e[0]-r)*this.kx,o=(e[1]-n)*this.ky,Math.sqrt(a*a+o*o)},n.prototype.pointOnLine=function(e,t){for(var i,r,n,a,o=1/0,s=0;s<e.length-1;s++){var c=e[s][0],h=e[s][1],u=l(e[s+1][0]-c)*this.kx,d=(e[s+1][1]-h)*this.ky,p=0;0===u&&0===d||((p=(l(t[0]-c)*this.kx*u+(t[1]-h)*this.ky*d)/(u*u+d*d))>1?(c=e[s+1][0],h=e[s+1][1]):p>0&&(c+=u/this.kx*p,h+=d/this.ky*p));var f=(u=l(t[0]-c)*this.kx)*u+(d=(t[1]-h)*this.ky)*d;f<o&&(o=f,i=c,r=h,n=s,a=p)}return{point:[i,r],index:n,t:Math.max(0,Math.min(1,a))}},n.prototype.lineSlice=function(e,t,i){var r=this.pointOnLine(i,e),n=this.pointOnLine(i,t);if(r.index>n.index||r.index===n.index&&r.t>n.t){var a=r;r=n,n=a}var s=[r.point],l=r.index+1,c=n.index;!o(i[l],s[0])&&l<=c&&s.push(i[l]);for(var h=l+1;h<=c;h++)s.push(i[h]);return o(i[c],n.point)||s.push(n.point),s},n.prototype.lineSliceAlong=function(e,t,i){for(var r=0,n=[],a=0;a<i.length-1;a++){var o=i[a],l=i[a+1],c=this.distance(o,l);if((r+=c)>e&&0===n.length&&n.push(s(o,l,(e-(r-c))/c)),r>=t)return n.push(s(o,l,(t-(r-c))/c)),n;r>e&&n.push(l)}return n},n.prototype.bufferPoint=function(e,t){var i=t/this.ky,r=t/this.kx;return[e[0]-r,e[1]-i,e[0]+r,e[1]+i]},n.prototype.bufferBBox=function(e,t){var i=t/this.ky,r=t/this.kx;return[e[0]-r,e[1]-i,e[2]+r,e[3]+i]},n.prototype.insideBBox=function(e,t){return l(e[0]-t[0])>=0&&l(e[0]-t[2])<=0&&e[1]>=t[1]&&e[1]<=t[3]},Object.defineProperties(n,a),n}()}(ea);var ta=u(ea.exports),ia={exports:{}};!function(e,t){e.exports=function(){var e=function(e,i){if(void 0===e&&(e=[]),void 0===i&&(i=t),this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function t(e,t){return e<t?-1:e>t?1:0}return e.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(0!==this.length){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(e){for(var t=this.data,i=this.compare,r=t[e];e>0;){var n=e-1>>1,a=t[n];if(i(r,a)>=0)break;t[e]=a,e=n}t[e]=r},e.prototype._down=function(e){for(var t=this.data,i=this.compare,r=this.length>>1,n=t[e];e<r;){var a=1+(e<<1),o=t[a],s=a+1;if(s<this.length&&i(t[s],o)<0&&(a=s,o=t[s]),i(o,n)>=0)break;t[e]=o,e=a}t[e]=n},e}()}(ia);var ra=u(ia.exports),na=8192;function aa(e,t){return t.dist-e.dist}const oa=100,sa=50;function la(e){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function ca(e){return e[1]-e[0]+1}function ha(e,t){const i=e[1]>=e[0]&&e[1]<t;return i||console.warn("Distance Expression: Index is out of range"),i}function ua(e,t){if(e[0]>e[1])return[null,null];const i=ca(e);if(t){if(2===i)return[e,null];const t=Math.floor(i/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}{if(1===i)return[e,null];const t=Math.floor(i/2)-1;return[[e[0],e[0]+t],[e[0]+t+1,e[1]]]}}function da(e,t){const i=[1/0,1/0,-1/0,-1/0];if(!ha(t,e.length))return i;for(let r=t[0];r<=t[1];++r)Fn(i,e[r]);return i}function pa(e){const t=[1/0,1/0,-1/0,-1/0];for(let i=0;i<e.length;++i)for(let r=0;r<e[i].length;++r)Fn(t,e[i][r]);return t}function fa(e,t,i){if(la(e)||la(t))return NaN;let r=0,n=0;return e[2]<t[0]&&(r=t[0]-e[2]),e[0]>t[2]&&(r=e[0]-t[2]),e[1]>t[3]&&(n=e[1]-t[3]),e[3]<t[1]&&(n=t[1]-e[3]),i.distance([0,0],[r,n])}function ma(e){return 360*e-180}function ga(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function _a(e,t){const i=Math.pow(2,t.z),r=(e.y/na+t.y)/i;return[ma((e.x/na+t.x)/i),ga(r)]}function ya(e,t){const i=[];for(let r=0;r<e.length;++r)i.push(_a(e[r],t));return i}function va(e,t,i){const r=i.pointOnLine(t,e).point;return i.distance(e,r)}function xa(e,t,i,r,n){const a=i.slice(r[0],r[1]+1);let o=1/0;for(let s=t[0];s<=t[1];++s)if(0===(o=Math.min(o,va(e[s],a,n))))return 0;return o}function ba(e,t,i,r,n){const a=Math.min(n.pointToSegmentDistance(e,i,r),n.pointToSegmentDistance(t,i,r)),o=Math.min(n.pointToSegmentDistance(i,e,t),n.pointToSegmentDistance(r,e,t));return Math.min(a,o)}function wa(e,t,i,r,n){if(!ha(t,e.length)||!ha(r,i.length))return NaN;let a=1/0;for(let o=t[0];o<t[1];++o)for(let t=r[0];t<r[1];++t){if(jn(e[o],e[o+1],i[t],i[t+1]))return 0;a=Math.min(a,ba(e[o],e[o+1],i[t],i[t+1],n))}return a}function Sa(e,t,i,r,n){if(!ha(t,e.length)||!ha(r,i.length))return NaN;let a=1/0;for(let o=t[0];o<=t[1];++o)for(let t=r[0];t<=r[1];++t)if(0===(a=Math.min(a,n.distance(e[o],i[t]))))return a;return a}function Ta(e,t,i){if(Nn(e,t,!0))return 0;let r=1/0;for(const n of t){const t=n.length;if(t<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(n[0]!==n[t-1]&&0===(r=Math.min(r,i.pointToSegmentDistance(e,n[t-1],n[0]))))return r;if(0===(r=Math.min(r,va(e,n,i))))return r}return r}function Ea(e,t,i,r){if(!ha(t,e.length))return NaN;for(let a=t[0];a<=t[1];++a)if(Nn(e[a],i,!0))return 0;let n=1/0;for(let a=t[0];a<t[1];++a)for(const t of i)for(let i=0,o=t.length,s=o-1;i<o;s=i++){if(jn(e[a],e[a+1],t[s],t[i]))return 0;n=Math.min(n,ba(e[a],e[a+1],t[s],t[i],r))}return n}function Ma(e,t){for(const i of e)for(let e=0;e<=i.length-1;++e)if(Nn(i[e],t,!0))return!0;return!1}function Aa(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;const n=pa(e),a=pa(t);if(r!==1/0&&fa(n,a,i)>=r)return r;if(On(n,a)){if(Ma(e,t))return 0}else if(Ma(t,e))return 0;let o=r;for(const s of e)for(let e=0,r=s.length,n=r-1;e<r;n=e++)for(const a of t)for(let t=0,r=a.length,l=r-1;t<r;l=t++){if(jn(s[n],s[e],a[l],a[t]))return 0;o=Math.min(o,ba(s[n],s[e],a[l],a[t],i))}return o}function Pa(e,t,i,r,n,a,o){if(null===a||null===o)return;const s=fa(da(r,a),da(n,o),i);s<t&&e.push({dist:s,range1:a,range2:o})}function Ca(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,a=Math.min(r.distance(e[0],i[0][0]),n);if(0===a)return a;const o=new ra([{dist:0,range1:[0,e.length-1],range2:[0,0]}],aa),s=t?sa:oa,l=pa(i);for(;o.length;){const n=o.pop();if(n.dist>=a)continue;const c=n.range1;if(ca(c)<=s){if(!ha(c,e.length))return NaN;if(t){const t=Ea(e,c,i,r);if(0===(a=Math.min(a,t)))return a}else for(let t=c[0];t<=c[1];++t){const n=Ta(e[t],i,r);if(0===(a=Math.min(a,n)))return a}}else{const i=ua(c,t);if(null!==i[0]){const t=fa(da(e,i[0]),l,r);t<a&&o.push({dist:t,range1:i[0],range2:[0,0]})}if(null!==i[1]){const t=fa(da(e,i[1]),l,r);t<a&&o.push({dist:t,range1:i[1],range2:[0,0]})}}}return a}function Ia(e,t,i,r,n){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,o=Math.min(a,n.distance(e[0],i[0]));if(0===o)return o;const s=new ra([{dist:0,range1:[0,e.length-1],range2:[0,i.length-1]}],aa),l=t?sa:oa,c=r?sa:oa;for(;s.length;){const a=s.pop();if(a.dist>=o)continue;const h=a.range1,u=a.range2;if(ca(h)<=l&&ca(u)<=c){if(!ha(h,e.length)||!ha(u,i.length))return NaN;if(t&&r?o=Math.min(o,wa(e,h,i,u,n)):t||r?t&&!r?o=Math.min(o,xa(i,u,e,h,n)):!t&&r&&(o=Math.min(o,xa(e,h,i,u,n))):o=Math.min(o,Sa(e,h,i,u,n)),0===o)return o}else{const a=ua(h,t),l=ua(u,r);Pa(s,o,n,e,i,a[0],l[0]),Pa(s,o,n,e,i,a[0],l[1]),Pa(s,o,n,e,i,a[1],l[0]),Pa(s,o,n,e,i,a[1],l[1])}}return o}function ka(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const a=da(e,[0,e.length-1]);for(const o of i)if(!(n!==1/0&&fa(a,da(o,[0,o.length-1]),r)>=n)&&(n=Math.min(n,Ia(e,t,o,!0,r,n)),0===n))return n;return n}function Da(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const a=da(e,[0,e.length-1]);for(const o of i){if(n!==1/0&&fa(a,pa(o),r)>=n)continue;const i=Ca(e,t,o,r,n);if(isNaN(i))return i;if(0===(n=Math.min(n,i)))return n}return n}function Ra(e){return"Point"===e||"MultiPoint"===e||"LineString"===e||"MultiLineString"===e||"Polygon"===e||"MultiPolygon"===e}class La{constructor(e,t){this.type=Xr,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error("'distance' expression requires either one argument, but found ' ".concat(e.length-1," instead."));if(gn(e[1])){const t=e[1];if("FeatureCollection"===t.type){for(let e=0;e<t.features.length;++e)if(Ra(t.features[e].geometry.type))return new La(t,t.features[e].geometry)}else if("Feature"===t.type){if(Ra(t.geometry.type))return new La(t,t.geometry)}else if(Ra(t.type))return new La(t,t)}return t.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const t=e.geometry(),i=e.canonicalID();if(null!=t&&null!=i){if("Point"===e.geometryType())return function(e,t,i){const r=[];for(const a of e)for(const e of a)r.push(_a(e,t));const n=new ta(r[0][1],"meters");return"Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type?Ia(r,!1,"Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,n):"MultiLineString"===i.type?ka(r,!1,i.coordinates,n):"Polygon"===i.type||"MultiPolygon"===i.type?Da(r,!1,"Polygon"===i.type?[i.coordinates]:i.coordinates,n):null}(t,i,this.geometries);if("LineString"===e.geometryType())return function(e,t,i){const r=[];for(const a of e){const e=[];for(const i of a)e.push(_a(i,t));r.push(e)}const n=new ta(r[0][0][1],"meters");if("Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type)return ka("Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,r,n);if("MultiLineString"===i.type){let e=1/0;for(let t=0;t<i.coordinates.length;t++){const a=ka(i.coordinates[t],!0,r,n,e);if(isNaN(a))return a;if(0===(e=Math.min(e,a)))return e}return e}if("Polygon"===i.type||"MultiPolygon"===i.type){let e=1/0;for(let t=0;t<r.length;t++){const a=Da(r[t],!0,"Polygon"===i.type?[i.coordinates]:i.coordinates,n,e);if(isNaN(a))return a;if(0===(e=Math.min(e,a)))return e}return e}return null}(t,i,this.geometries);if("Polygon"===e.geometryType())return function(e,t,i){const r=[];for(const a of function(e,t){const i=e.length;if(i<=1)return[e];const r=[];let n,a;for(let o=0;o<i;o++){const t=zn(e[o]);0!==t&&(e[o].area=Math.abs(t),void 0===a&&(a=t<0),a===t<0?(n&&r.push(n),n=[e[o]]):n.push(e[o]))}return n&&r.push(n),r}(e)){const e=[];for(let i=0;i<a.length;++i)e.push(ya(a[i],t));r.push(e)}const n=new ta(r[0][0][0][1],"meters");if("Point"===i.type||"MultiPoint"===i.type||"LineString"===i.type)return Da("Point"===i.type?[i.coordinates]:i.coordinates,"LineString"===i.type,r,n);if("MultiLineString"===i.type){let e=1/0;for(let t=0;t<i.coordinates.length;t++){const a=Da(i.coordinates[t],!0,r,n,e);if(isNaN(a))return a;if(0===(e=Math.min(e,a)))return e}return e}return"Polygon"===i.type||"MultiPolygon"===i.type?function(e,t,i){let r=1/0;for(const n of e)for(const e of t){const t=Aa(n,e,i,r);if(isNaN(t))return t;if(0===(r=Math.min(r,t)))return r}return r}("Polygon"===i.type?[i.coordinates]:i.coordinates,r,n):null}(t,i,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function za(e,t){switch(e){case"string":return yn(t);case"number":return+t;case"boolean":return!!t;case"color":return jr.parse(t);case"formatted":return pn.fromString(yn(t));case"resolvedImage":return fn.fromString(yn(t))}return t}function Fa(e,t,i,r){return void 0!==r&&(e=r*Math.round(e/r)),void 0!==t&&e<t&&(e=t),void 0!==i&&e>i&&(e=i),e}class Oa{constructor(e,t,i){this.type=e,this.key=t,this.scope=i}static parse(e,t){let i=t.expectedType;if(null==i&&(i=en),e.length<2||e.length>3)return t.error("Invalid number of arguments for 'config' expression.");const r=t.parse(e[1],1);if(!(r instanceof vn))return t.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const n=t.parse(e[2],2);return n instanceof vn?new Oa(i,yn(r.value),yn(n.value)):t.error("Scope of 'config' expression must be a string literal.")}return new Oa(i,yn(r.value))}evaluate(e){const t=[this.key,this.scope,e.scope].filter(Boolean).join("\x1f"),i=e.getConfig(t);if(!i)return null;const{type:r,value:n,values:a,minValue:o,maxValue:s,stepValue:l}=i,c=i.default.evaluate(e);let h=c;if(n){const t=e.scope;e.scope=(t||"").split("\x1f").slice(1).join("\x1f"),h=n.evaluate(e),e.scope=t}return r&&(h=za(r,h)),void 0===h||void 0===o&&void 0===s&&void 0===l||("number"==typeof h?h=Fa(h,o,s,l):Array.isArray(h)&&(h=h.map((e=>"number"==typeof e?Fa(e,o,s,l):e)))),void 0!==n&&void 0!==h&&a&&!a.includes(h)&&(h=c,r&&(h=za(r,h))),(r&&r!==this.type||void 0!==h&&_n(h)!==this.type)&&(h=za(this.type.kind,h)),h}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Ba(e){if(e instanceof In){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof $n)return!1;if(e instanceof La)return!1;let t=!0;return e.eachChild((e=>{t&&!Ba(e)&&(t=!1)})),t}function Na(e){if(e instanceof In&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild((e=>{t&&!Na(e)&&(t=!1)})),t}function Va(e){if(e instanceof Oa)return!1;let t=!0;return e.eachChild((e=>{t&&!Va(e)&&(t=!1)})),t}function ja(e,t){if(e instanceof In&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild((e=>{i&&!ja(e,t)&&(i=!1)})),i}class Ua{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const i=e[1];return t.scope.has(i)?new Ua(i,t.scope.get(i)):t.error('Unknown variable "'.concat(i,'". Make sure "').concat(i,'" has been bound in an enclosing "let" expression before using it.'),1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ga{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Zr,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;this.registry=e,this.path=t,this.key=t.map((e=>"[".concat(e,"]"))).join(""),this.scope=r,this.errors=n,this.expectedType=i,this._scope=a,this.options=o}parse(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return t||i?this.concat(t,i,r)._parse(e,n):this._parse(e,n)}_parse(e,t){function i(e,t,i){return"assert"===i?new wn(t,[e]):"coerce"===i?new An(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r="string"==typeof e[0]?this.registry[e[0]]:void 0;if(r){let n=r.parse(e,this);if(!n)return null;if(this.expectedType){const e=this.expectedType,r=n.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==r.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==r.kind&&"string"!==r.kind){if(this.checkSubtype(e,r))return null}else n=i(n,e,t.typeAnnotation||"coerce");else n=i(n,e,t.typeAnnotation||"assert")}if(!(n instanceof vn)&&"resolvedImage"!==n.type.kind&&qa(n)){const t=new Cn(this._scope,this.options);try{n=new vn(n.type,n.evaluate(t))}catch(e){return this.error(e.message),null}}return n}return An.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found ".concat(typeof e," instead."))}concat(e,t,i){const r="number"==typeof e?this.path.concat(e):this.path,n=i?this.scope.concat(i):this.scope;return new Ga(this.registry,r,t||null,n,this.errors,this._scope,this.options)}error(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];const n="".concat(this.key).concat(i.map((e=>"[".concat(e,"]"))).join(""));this.errors.push(new Wr(n,e))}checkSubtype(e,t){const i=ln(e,t);return i&&this.error(i),i}}function qa(e){if(e instanceof Ua)return qa(e.boundExpression);if(e instanceof In&&"error"===e.name)return!1;if(e instanceof Dn)return!1;if(e instanceof $n)return!1;if(e instanceof La)return!1;if(e instanceof Oa)return!1;const t=e instanceof An||e instanceof wn;let i=!0;return e.eachChild((e=>{i=t?i&&qa(e):i&&e instanceof vn})),!!i&&Ba(e)&&ja(e,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Ha(e,t){const i=e.length-1;let r,n,a=0,o=i,s=0;for(;a<=o;)if(s=Math.floor((a+o)/2),r=e[s],n=e[s+1],r<=t){if(s===i||t<n)return s;a=s+1}else{if(!(r>t))throw new xn("Input is not a number.");o=s-1}return 0}class Wa{constructor(e,t,i){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[r,n]of i)this.labels.push(r),this.outputs.push(n)}static parse(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const i=t.parse(e[1],1,Xr);if(!i)return null;const r=[];let n=null;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);for(let a=1;a<e.length;a+=2){const i=1===a?-1/0:e[a],o=e[a+1],s=a,l=a+1;if("number"!=typeof i)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(r.length&&r[r.length-1][0]>=i)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);const c=t.parse(o,l,n);if(!c)return null;n=n||c.type,r.push([i,c])}return new Wa(n,i,r)}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const n=t.length;return r>=t[n-1]?i[n-1].evaluate(e):i[Ha(t,r)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}const Za=.95047,Qa=1.08883,Xa=4/29,Ya=6/29,Ja=3*Ya*Ya,Ka=Ya*Ya*Ya,$a=Math.PI/180,eo=180/Math.PI;function to(e){return e>Ka?Math.pow(e,1/3):e/Ja+Xa}function io(e){return e>Ya?e*e*e:Ja*(e-Xa)}function ro(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function no(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function ao(e){const t=no(e.r),i=no(e.g),r=no(e.b),n=to((.4124564*t+.3575761*i+.1804375*r)/Za),a=to((.2126729*t+.7151522*i+.072175*r)/1);return{l:116*a-16,a:500*(n-a),b:200*(a-to((.0193339*t+.119192*i+.9503041*r)/Qa)),alpha:e.a}}function oo(e){let t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,r=isNaN(e.b)?t:t-e.b/200;return t=1*io(t),i=Za*io(i),r=Qa*io(r),new jr(ro(3.2404542*i-1.5371385*t-.4985314*r),ro(-.969266*i+1.8760108*t+.041556*r),ro(.0556434*i-.2040259*t+1.0572252*r),e.alpha)}function so(e,t,i){const r=t-e;return e+i*(r>180||r<-180?r-360*Math.round(r/360):r)}const lo={forward:ao,reverse:oo,interpolate:function(e,t,i){return{l:Ur(e.l,t.l,i),a:Ur(e.a,t.a,i),b:Ur(e.b,t.b,i),alpha:Ur(e.alpha,t.alpha,i)}}},co={forward:function(e){const{l:t,a:i,b:r}=ao(e),n=Math.atan2(r,i)*eo;return{h:n<0?n+360:n,c:Math.sqrt(i*i+r*r),l:t,alpha:e.a}},reverse:function(e){const t=e.h*$a,i=e.c;return oo({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return{h:so(e.h,t.h,i),c:Ur(e.c,t.c,i),l:Ur(e.l,t.l,i),alpha:Ur(e.alpha,t.alpha,i)}}};var ho=Object.freeze({__proto__:null,hcl:co,lab:lo});class uo{constructor(e,t,i,r,n){this.type=e,this.operator=t,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];for(const[a,o]of n)this.labels.push(a),this.outputs.push(o)}static interpolationFactor(e,t,i,r){let n=0;if("exponential"===e.name)n=po(t,e.base,i,r);else if("linear"===e.name)n=po(t,1,i,r);else if("cubic-bezier"===e.name){const a=e.controlPoints;n=new Ot(a[0],a[1],a[2],a[3]).solve(po(t,1,i,r))}return n}static parse(e,t){let[i,r,n,...a]=e;if(!Array.isArray(r)||0===r.length)return t.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const e=r[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:e}}else{if("cubic-bezier"!==r[0])return t.error("Unknown interpolation type ".concat(String(r[0])),1,0);{const e=r.slice(1);if(4!==e.length||e.some((e=>"number"!=typeof e||e<0||e>1)))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(n=t.parse(n,2,Xr),!n)return null;const o=[];let s=null;"interpolate-hcl"===i||"interpolate-lab"===i?s=Kr:t.expectedType&&"value"!==t.expectedType.kind&&(s=t.expectedType);for(let l=0;l<a.length;l+=2){const e=a[l],i=a[l+1],r=l+3,n=l+4;if("number"!=typeof e)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(o.length&&o[o.length-1][0]>=e)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',r);const c=t.parse(i,n,s);if(!c)return null;s=s||c.type,o.push([e,c])}return"number"===s.kind||"color"===s.kind||"array"===s.kind&&"number"===s.itemType.kind&&"number"==typeof s.N?new uo(s,i,r,n,o):t.error("Type ".concat(on(s)," is not interpolatable."))}evaluate(e){const t=this.labels,i=this.outputs;if(1===t.length)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const n=t.length;if(r>=t[n-1])return i[n-1].evaluate(e);const a=Ha(t,r),o=uo.interpolationFactor(this.interpolation,r,t[a],t[a+1]),s=i[a].evaluate(e),l=i[a+1].evaluate(e);return"interpolate"===this.operator?qr[this.type.kind.toLowerCase()](s,l,o):"interpolate-hcl"===this.operator?co.reverse(co.interpolate(co.forward(s),co.forward(l),o)):lo.reverse(lo.interpolate(lo.forward(s),lo.forward(l),o))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let i=0;i<this.labels.length;i++)t.push(this.labels[i],this.outputs[i].serialize());return t}}function po(e,t,i,r){const n=r-i,a=e-i;return 0===n?0:1===t?a/n:(Math.pow(t,a)-1)/(Math.pow(t,n)-1)}class fo{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let i=null;const r=t.expectedType;r&&"value"!==r.kind&&(i=r);const n=[];for(const o of e.slice(1)){const e=t.parse(o,1+n.length,i,void 0,{typeAnnotation:"omit"});if(!e)return null;i=i||e.type,n.push(e)}const a=r&&n.some((e=>ln(r,e.type)));return new fo(a?en:i,n)}evaluate(e){let t,i=null,r=0;for(const n of this.args){if(r++,i=n.evaluate(e),i&&i instanceof fn&&!i.available&&(t||(t=i),i=null,r===this.args.length))return t;if(null!==i)break}return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class mo{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found ".concat(e.length-1," instead."));const i=[];for(let n=1;n<e.length-1;n+=2){const r=e[n];if("string"!=typeof r)return t.error("Expected string, but found ".concat(typeof r," instead."),n);if(/[^a-zA-Z0-9_]/.test(r))return t.error("Variable names must contain only alphanumeric characters or '_'.",n);const a=t.parse(e[n+1],n+1);if(!a)return null;i.push([r,a])}const r=t.parse(e[e.length-1],e.length-1,t.expectedType,i);return r?new mo(i,r):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,i]of this.bindings)e.push(t,i.serialize());return e.push(this.result.serialize()),e}}class go{constructor(e,t,i){this.type=e,this.index=t,this.input=i}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const i=t.parse(e[1],1,Xr),r=t.parse(e[2],2,an(t.expectedType||en));return i&&r?new go(r.type.itemType,i,r):null}evaluate(e){const t=this.index.evaluate(e),i=this.input.evaluate(e);if(t<0)throw new xn("Array index out of bounds: ".concat(t," < 0."));if(t>=i.length)throw new xn("Array index out of bounds: ".concat(t," > ").concat(i.length-1,"."));if(t!==Math.floor(t))throw new xn("Array index must be an integer, but found ".concat(t," instead."));return i[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class _o{constructor(e,t){this.type=Jr,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const i=t.parse(e[1],1,en),r=t.parse(e[2],2,en);return i&&r?cn(i.type,[Jr,Yr,Xr,Qr,en])?new _o(i,r):t.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(on(i.type)," instead")):null}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(null==i)return!1;if(!hn(t,["boolean","string","number","null"]))throw new xn("Expected first argument to be of type boolean, string, number or null, but found ".concat(on(_n(t))," instead."));if(!hn(i,["string","array"]))throw new xn("Expected second argument to be of type array or string, but found ".concat(on(_n(i))," instead."));return i.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class yo{constructor(e,t,i){this.type=Xr,this.needle=e,this.haystack=t,this.fromIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found ".concat(e.length-1," instead."));const i=t.parse(e[1],1,en),r=t.parse(e[2],2,en);if(!i||!r)return null;if(!cn(i.type,[Jr,Yr,Xr,Qr,en]))return t.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(on(i.type)," instead"));if(4===e.length){const n=t.parse(e[3],3,Xr);return n?new yo(i,r,n):null}return new yo(i,r)}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!hn(t,["boolean","string","number","null"]))throw new xn("Expected first argument to be of type boolean, string, number or null, but found ".concat(on(_n(t))," instead."));if(!hn(i,["string","array"]))throw new xn("Expected second argument to be of type array or string, but found ".concat(on(_n(i))," instead."));if(this.fromIndex){const r=this.fromIndex.evaluate(e);return i.indexOf(t,r)}return i.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class vo{constructor(e,t,i,r,n,a){this.inputType=e,this.type=t,this.input=i,this.cases=r,this.outputs=n,this.otherwise=a}static parse(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if(e.length%2!=1)return t.error("Expected an even number of arguments.");let i,r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const n={},a=[];for(let l=2;l<e.length-1;l+=2){let o=e[l];const s=e[l+1];Array.isArray(o)||(o=[o]);const c=t.concat(l);if(0===o.length)return c.error("Expected at least one branch label.");for(const e of o){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error("Branch labels must be integers no larger than ".concat(Number.MAX_SAFE_INTEGER,"."));if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(i){if(c.checkSubtype(i,_n(e)))return null}else i=_n(e);if(void 0!==n[String(e)])return c.error("Branch labels must be unique.");n[String(e)]=a.length}const h=t.parse(s,l,r);if(!h)return null;r=r||h.type,a.push(h)}const o=t.parse(e[1],1,en);if(!o)return null;const s=t.parse(e[e.length-1],e.length-1,r);return s?"value"!==o.type.kind&&t.concat(1).checkSubtype(i,o.type)?null:new vo(i,r,o,n,a,s):null}evaluate(e){const t=this.input.evaluate(e);return(_n(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),i=[],r={};for(const a of t){const e=r[this.cases[a]];void 0===e?(r[this.cases[a]]=i.length,i.push([this.cases[a],[a]])):i[e][1].push(a)}const n=e=>"number"===this.inputType.kind?Number(e):e;for(const[a,o]of i)e.push(1===o.length?n(o[0]):o.map(n)),e.push(this.outputs[a].serialize());return e.push(this.otherwise.serialize()),e}}class xo{constructor(e,t,i){this.type=e,this.branches=t,this.otherwise=i}static parse(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only ".concat(e.length-1,"."));if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const r=[];for(let a=1;a<e.length-1;a+=2){const n=t.parse(e[a],a,Jr);if(!n)return null;const o=t.parse(e[a+1],a+1,i);if(!o)return null;r.push([n,o]),i=i||o.type}const n=t.parse(e[e.length-1],e.length-1,i);return n?new xo(i,r,n):null}evaluate(e){for(const[t,i]of this.branches)if(t.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,i]of this.branches)e(t),e(i);e(this.otherwise)}outputDefined(){return this.branches.every((e=>{let[t,i]=e;return i.outputDefined()}))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((t=>{e.push(t.serialize())})),e}}class bo{constructor(e,t,i,r){this.type=e,this.input=t,this.beginIndex=i,this.endIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found ".concat(e.length-1," instead."));const i=t.parse(e[1],1,en),r=t.parse(e[2],2,Xr);if(!i||!r)return null;if(!cn(i.type,[an(en),Yr,en]))return t.error("Expected first argument to be of type array or string, but found ".concat(on(i.type)," instead"));if(4===e.length){const n=t.parse(e[3],3,Xr);return n?new bo(i.type,i,r,n):null}return new bo(i.type,i,r)}evaluate(e){const t=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!hn(t,["string","array"]))throw new xn("Expected first argument to be of type array or string, but found ".concat(on(_n(t))," instead."));if(this.endIndex){const r=this.endIndex.evaluate(e);return t.slice(i,r)}return t.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function wo(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function So(e,t,i,r){return 0===r.compare(t,i)}function To(e,t,i){const r="=="!==e&&"!="!==e;return class n{constructor(e,t,i){this.type=Jr,this.lhs=e,this.rhs=t,this.collator=i,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const i=e[0];let a=t.parse(e[1],1,en);if(!a)return null;if(!wo(i,a.type))return t.concat(1).error('"'.concat(i,"\" comparisons are not supported for type '").concat(on(a.type),"'."));let o=t.parse(e[2],2,en);if(!o)return null;if(!wo(i,o.type))return t.concat(2).error('"'.concat(i,"\" comparisons are not supported for type '").concat(on(o.type),"'."));if(a.type.kind!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return t.error("Cannot compare types '".concat(on(a.type),"' and '").concat(on(o.type),"'."));r&&("value"===a.type.kind&&"value"!==o.type.kind?a=new wn(o.type,[a]):"value"!==a.type.kind&&"value"===o.type.kind&&(o=new wn(a.type,[o])));let s=null;if(4===e.length){if("string"!==a.type.kind&&"string"!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return t.error("Cannot use collator to compare non-string types.");if(s=t.parse(e[3],3,tn),!s)return null}return new n(a,o,s)}evaluate(n){const a=this.lhs.evaluate(n),o=this.rhs.evaluate(n);if(r&&this.hasUntypedArgument){const t=_n(a),i=_n(o);if(t.kind!==i.kind||"string"!==t.kind&&"number"!==t.kind)throw new xn('Expected arguments for "'.concat(e,'" to be (string, string) or (number, number), but found (').concat(t.kind,", ").concat(i.kind,") instead."))}if(this.collator&&!r&&this.hasUntypedArgument){const e=_n(a),i=_n(o);if("string"!==e.kind||"string"!==i.kind)return t(n,a,o)}return this.collator?i(n,a,o,this.collator.evaluate(n)):t(n,a,o)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild((e=>{t.push(e.serialize())})),t}}}const Eo=To("==",(function(e,t,i){return t===i}),So),Mo=To("!=",(function(e,t,i){return t!==i}),(function(e,t,i,r){return!So(0,t,i,r)})),Ao=To("<",(function(e,t,i){return t<i}),(function(e,t,i,r){return r.compare(t,i)<0})),Po=To(">",(function(e,t,i){return t>i}),(function(e,t,i,r){return r.compare(t,i)>0})),Co=To("<=",(function(e,t,i){return t<=i}),(function(e,t,i,r){return r.compare(t,i)<=0})),Io=To(">=",(function(e,t,i){return t>=i}),(function(e,t,i,r){return r.compare(t,i)>=0}));class ko{constructor(e,t,i,r,n,a){this.type=Yr,this.number=e,this.locale=t,this.currency=i,this.unit=r,this.minFractionDigits=n,this.maxFractionDigits=a}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const i=t.parse(e[1],1,Xr);if(!i)return null;const r=e[2];if("object"!=typeof r||Array.isArray(r))return t.error("NumberFormat options argument must be an object.");let n=null;if(r.locale&&(n=t.parse(r.locale,1,Yr),!n))return null;let a=null;if(r.currency&&(a=t.parse(r.currency,1,Yr),!a))return null;let o=null;if(r.unit&&(o=t.parse(r.unit,1,Yr),!o))return null;let s=null;if(r["min-fraction-digits"]&&(s=t.parse(r["min-fraction-digits"],1,Xr),!s))return null;let l=null;return r["max-fraction-digits"]&&(l=t.parse(r["max-fraction-digits"],1,Xr),!l)?null:new ko(i,n,a,o,s,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Do{constructor(e){this.type=Xr,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected 1 argument, but found ".concat(e.length-1," instead."));const i=t.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?t.error("Expected argument of type string or array, but found ".concat(on(i.type)," instead.")):new Do(i):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new xn("Expected value to be of type string or array, but found ".concat(on(_n(t))," instead."))}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((t=>{e.push(t.serialize())})),e}}function Ro(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const Lo={"==":Eo,"!=":Mo,">":Po,"<":Ao,">=":Io,"<=":Co,array:wn,at:go,boolean:wn,case:xo,coalesce:fo,collator:Dn,format:Sn,image:Tn,in:_o,"index-of":yo,interpolate:uo,"interpolate-hcl":uo,"interpolate-lab":uo,length:Do,let:mo,literal:vn,match:vo,number:wn,"number-format":ko,object:wn,slice:bo,step:Wa,string:wn,"to-boolean":An,"to-color":An,"to-number":An,"to-string":An,var:Ua,within:$n,distance:La,config:Oa};function zo(e,t){let[i,r,n,a]=t;i=i.evaluate(e),r=r.evaluate(e),n=n.evaluate(e);const o=a?a.evaluate(e):1,s=mn(i,r,n,o);if(s)throw new xn(s);return new jr(i/255*o,r/255*o,n/255*o,o)}function Fo(e,t){let[i,r,n,a]=t;i=i.evaluate(e),r=r.evaluate(e),n=n.evaluate(e);const o=a?a.evaluate(e):1,s=function(e,t,i,r){return"number"==typeof e&&e>=0&&e<=360?"number"==typeof t&&t>=0&&t<=100&&"number"==typeof i&&i>=0&&i<=100?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:"Invalid hsla value [".concat([e,t,i,r].join(", "),"]: 'a' must be between 0 and 1."):"Invalid hsla value [".concat(("number"==typeof r?[e,t,i,r]:[e,t,i]).join(", "),"]: 's', and 'l' must be between 0 and 100."):"Invalid hsla value [".concat(("number"==typeof r?[e,t,i,r]:[e,t,i]).join(", "),"]: 'h' must be between 0 and 360.")}(i,r,n,o);if(s)throw new xn(s);const l="hsla(".concat(i,", ").concat(r,"%, ").concat(n,"%, ").concat(o,")"),c=jr.parse(l);if(!c)throw new xn("Failed to parse HSLA color: ".concat(l));return c}function Oo(e,t){return e in t}function Bo(e,t){const i=t[e];return void 0===i?null:i}function No(e){return{type:e}}function Vo(e){return{result:"success",value:e}}function jo(e){return{result:"error",value:e}}function Uo(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function Go(e){return"data-driven"===e["property-type"]}function qo(e){return Uo(e.expression,"measure-light")}function Ho(e){return Uo(e.expression,"zoom")}function Wo(e){return!!e.expression&&e.expression.interpolated}function Zo(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Qo(e){return e}function Xo(e,t){const i="color"===t.type,r=e.stops&&"object"==typeof e.stops[0][0],n=r||!(r||void 0!==e.property),a=e.type||(Wo(t)?"exponential":"interval");if(i&&((e=Hr({},e)).stops&&(e.stops=e.stops.map((e=>[e[0],jr.parse(e[1])]))),e.default=jr.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!ho[e.colorSpace])throw new Error("Unknown color space: ".concat(e.colorSpace));let o,s,l;if("exponential"===a)o=$o;else if("interval"===a)o=Ko;else if("categorical"===a){o=Jo,s=Object.create(null);for(const t of e.stops)s[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==a)throw new Error('Unknown function type "'.concat(a,'"'));o=es}if(r){const i={},r=[];for(let t=0;t<e.stops.length;t++){const n=e.stops[t],a=n[0].zoom;void 0===i[a]&&(i[a]={zoom:a,type:e.type,property:e.property,default:e.default,stops:[]},r.push(a)),i[a].stops.push([n[0].value,n[1]])}const n=[];for(const e of r)n.push([i[e].zoom,Xo(i[e],t)]);const a={name:"linear"};return{kind:"composite",interpolationType:a,interpolationFactor:uo.interpolationFactor.bind(void 0,a),zoomStops:n.map((e=>e[0])),evaluate:(i,r)=>{let{zoom:a}=i;return $o({stops:n,base:e.base},t,a).evaluate(a,r)}}}if(n){const i="exponential"===a?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:i,interpolationFactor:uo.interpolationFactor.bind(void 0,i),zoomStops:e.stops.map((e=>e[0])),evaluate:i=>{let{zoom:r}=i;return o(e,t,r,s,l)}}}return{kind:"source",evaluate(i,r){const n=r&&r.properties?r.properties[e.property]:void 0;return void 0===n?Yo(e.default,t.default):o(e,t,n,s,l)}}}function Yo(e,t,i){return void 0!==e?e:void 0!==t?t:void 0!==i?i:void 0}function Jo(e,t,i,r,n){return Yo(typeof i===n?r[i]:void 0,e.default,t.default)}function Ko(e,t,i){if("number"!==En(i))return Yo(e.default,t.default);const r=e.stops.length;if(1===r)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[r-1][0])return e.stops[r-1][1];const n=Ha(e.stops.map((e=>e[0])),i);return e.stops[n][1]}function $o(e,t,i){const r=void 0!==e.base?e.base:1;if("number"!==En(i))return Yo(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[n-1][0])return e.stops[n-1][1];const a=Ha(e.stops.map((e=>e[0])),i),o=function(e,t,i,r){const n=r-i,a=e-i;return 0===n?0:1===t?a/n:(Math.pow(t,a)-1)/(Math.pow(t,n)-1)}(i,r,e.stops[a][0],e.stops[a+1][0]),s=e.stops[a][1],l=e.stops[a+1][1];let c=qr[t.type]||Qo;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=ho[e.colorSpace];c=(e,i)=>t.reverse(t.interpolate(t.forward(e),t.forward(i),o))}return"function"==typeof s.evaluate?{evaluate(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];const r=s.evaluate.apply(void 0,t),n=l.evaluate.apply(void 0,t);if(void 0!==r&&void 0!==n)return c(r,n,o)}}:c(s,l,o)}function es(e,t,i){return"color"===t.type?i=jr.parse(i):"formatted"===t.type?i=pn.fromString(i.toString()):"resolvedImage"===t.type?i=fn.fromString(i.toString()):En(i)===t.type||"enum"===t.type&&t.values[i]||(i=void 0),Yo(i,e.default,t.default)}In.register(Lo,{error:[{kind:"error"},[Yr],(e,t)=>{let[i]=t;throw new xn(i.evaluate(e))}],typeof:[Yr,[en],(e,t)=>{let[i]=t;return on(_n(i.evaluate(e)))}],"to-rgba":[an(Xr,4),[Kr],(e,t)=>{let[i]=t;return i.evaluate(e).toArray()}],rgb:[Kr,[Xr,Xr,Xr],zo],rgba:[Kr,[Xr,Xr,Xr,Xr],zo],hsl:[Kr,[Xr,Xr,Xr],Fo],hsla:[Kr,[Xr,Xr,Xr,Xr],Fo],has:{type:Jr,overloads:[[[Yr],(e,t)=>{let[i]=t;return Oo(i.evaluate(e),e.properties())}],[[Yr,$r],(e,t)=>{let[i,r]=t;return Oo(i.evaluate(e),r.evaluate(e))}]]},get:{type:en,overloads:[[[Yr],(e,t)=>{let[i]=t;return Bo(i.evaluate(e),e.properties())}],[[Yr,$r],(e,t)=>{let[i,r]=t;return Bo(i.evaluate(e),r.evaluate(e))}]]},"feature-state":[en,[Yr],(e,t)=>{let[i]=t;return Bo(i.evaluate(e),e.featureState||{})}],properties:[$r,[],e=>e.properties()],"geometry-type":[Yr,[],e=>e.geometryType()],id:[en,[],e=>e.id()],zoom:[Xr,[],e=>e.globals.zoom],pitch:[Xr,[],e=>e.globals.pitch||0],"distance-from-center":[Xr,[],e=>e.distanceFromCenter()],"measure-light":[Xr,[Yr],(e,t)=>{let[i]=t;return e.measureLight(i.evaluate(e))}],"heatmap-density":[Xr,[],e=>e.globals.heatmapDensity||0],"line-progress":[Xr,[],e=>e.globals.lineProgress||0],"raster-value":[Xr,[],e=>e.globals.rasterValue||0],"raster-particle-speed":[Xr,[],e=>e.globals.rasterParticleSpeed||0],"sky-radial-progress":[Xr,[],e=>e.globals.skyRadialProgress||0],accumulated:[en,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[Xr,No(Xr),(e,t)=>{let i=0;for(const r of t)i+=r.evaluate(e);return i}],"*":[Xr,No(Xr),(e,t)=>{let i=1;for(const r of t)i*=r.evaluate(e);return i}],"-":{type:Xr,overloads:[[[Xr,Xr],(e,t)=>{let[i,r]=t;return i.evaluate(e)-r.evaluate(e)}],[[Xr],(e,t)=>{let[i]=t;return-i.evaluate(e)}]]},"/":[Xr,[Xr,Xr],(e,t)=>{let[i,r]=t;return i.evaluate(e)/r.evaluate(e)}],"%":[Xr,[Xr,Xr],(e,t)=>{let[i,r]=t;return i.evaluate(e)%r.evaluate(e)}],ln2:[Xr,[],()=>Math.LN2],pi:[Xr,[],()=>Math.PI],e:[Xr,[],()=>Math.E],"^":[Xr,[Xr,Xr],(e,t)=>{let[i,r]=t;return Math.pow(i.evaluate(e),r.evaluate(e))}],sqrt:[Xr,[Xr],(e,t)=>{let[i]=t;return Math.sqrt(i.evaluate(e))}],log10:[Xr,[Xr],(e,t)=>{let[i]=t;return Math.log(i.evaluate(e))/Math.LN10}],ln:[Xr,[Xr],(e,t)=>{let[i]=t;return Math.log(i.evaluate(e))}],log2:[Xr,[Xr],(e,t)=>{let[i]=t;return Math.log(i.evaluate(e))/Math.LN2}],sin:[Xr,[Xr],(e,t)=>{let[i]=t;return Math.sin(i.evaluate(e))}],cos:[Xr,[Xr],(e,t)=>{let[i]=t;return Math.cos(i.evaluate(e))}],tan:[Xr,[Xr],(e,t)=>{let[i]=t;return Math.tan(i.evaluate(e))}],asin:[Xr,[Xr],(e,t)=>{let[i]=t;return Math.asin(i.evaluate(e))}],acos:[Xr,[Xr],(e,t)=>{let[i]=t;return Math.acos(i.evaluate(e))}],atan:[Xr,[Xr],(e,t)=>{let[i]=t;return Math.atan(i.evaluate(e))}],min:[Xr,No(Xr),(e,t)=>Math.min(...t.map((t=>t.evaluate(e))))],max:[Xr,No(Xr),(e,t)=>Math.max(...t.map((t=>t.evaluate(e))))],abs:[Xr,[Xr],(e,t)=>{let[i]=t;return Math.abs(i.evaluate(e))}],round:[Xr,[Xr],(e,t)=>{let[i]=t;const r=i.evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[Xr,[Xr],(e,t)=>{let[i]=t;return Math.floor(i.evaluate(e))}],ceil:[Xr,[Xr],(e,t)=>{let[i]=t;return Math.ceil(i.evaluate(e))}],"filter-==":[Jr,[Yr,en],(e,t)=>{let[i,r]=t;return e.properties()[i.value]===r.value}],"filter-id-==":[Jr,[en],(e,t)=>{let[i]=t;return e.id()===i.value}],"filter-type-==":[Jr,[Yr],(e,t)=>{let[i]=t;return e.geometryType()===i.value}],"filter-<":[Jr,[Yr,en],(e,t)=>{let[i,r]=t;const n=e.properties()[i.value],a=r.value;return typeof n==typeof a&&n<a}],"filter-id-<":[Jr,[en],(e,t)=>{let[i]=t;const r=e.id(),n=i.value;return typeof r==typeof n&&r<n}],"filter->":[Jr,[Yr,en],(e,t)=>{let[i,r]=t;const n=e.properties()[i.value],a=r.value;return typeof n==typeof a&&n>a}],"filter-id->":[Jr,[en],(e,t)=>{let[i]=t;const r=e.id(),n=i.value;return typeof r==typeof n&&r>n}],"filter-<=":[Jr,[Yr,en],(e,t)=>{let[i,r]=t;const n=e.properties()[i.value],a=r.value;return typeof n==typeof a&&n<=a}],"filter-id-<=":[Jr,[en],(e,t)=>{let[i]=t;const r=e.id(),n=i.value;return typeof r==typeof n&&r<=n}],"filter->=":[Jr,[Yr,en],(e,t)=>{let[i,r]=t;const n=e.properties()[i.value],a=r.value;return typeof n==typeof a&&n>=a}],"filter-id->=":[Jr,[en],(e,t)=>{let[i]=t;const r=e.id(),n=i.value;return typeof r==typeof n&&r>=n}],"filter-has":[Jr,[en],(e,t)=>{let[i]=t;return i.value in e.properties()}],"filter-has-id":[Jr,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[Jr,[an(Yr)],(e,t)=>{let[i]=t;return i.value.indexOf(e.geometryType())>=0}],"filter-id-in":[Jr,[an(en)],(e,t)=>{let[i]=t;return i.value.indexOf(e.id())>=0}],"filter-in-small":[Jr,[Yr,an(en)],(e,t)=>{let[i,r]=t;return r.value.indexOf(e.properties()[i.value])>=0}],"filter-in-large":[Jr,[Yr,an(en)],(e,t)=>{let[i,r]=t;return function(e,t,i,r){for(;i<=r;){const n=i+r>>1;if(t[n]===e)return!0;t[n]>e?r=n-1:i=n+1}return!1}(e.properties()[i.value],r.value,0,r.value.length-1)}],all:{type:Jr,overloads:[[[Jr,Jr],(e,t)=>{let[i,r]=t;return i.evaluate(e)&&r.evaluate(e)}],[No(Jr),(e,t)=>{for(const i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:Jr,overloads:[[[Jr,Jr],(e,t)=>{let[i,r]=t;return i.evaluate(e)||r.evaluate(e)}],[No(Jr),(e,t)=>{for(const i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[Jr,[Jr],(e,t)=>{let[i]=t;return!i.evaluate(e)}],"is-supported-script":[Jr,[Yr],(e,t)=>{let[i]=t;const r=e.globals&&e.globals.isSupportedScript;return!r||r(i.evaluate(e))}],upcase:[Yr,[Yr],(e,t)=>{let[i]=t;return i.evaluate(e).toUpperCase()}],downcase:[Yr,[Yr],(e,t)=>{let[i]=t;return i.evaluate(e).toLowerCase()}],concat:[Yr,No(en),(e,t)=>t.map((t=>yn(t.evaluate(e)))).join("")],"resolved-locale":[Yr,[tn],(e,t)=>{let[i]=t;return i.evaluate(e).resolvedLocale()}],random:[Xr,[Xr,Xr,en],(e,t)=>{const[i,r,n]=t.map((t=>t.evaluate(e)));if(i>r)return i;if(i===r)return i;let a;if("string"==typeof n)a=function(e){let t=0;if(0===e.length)return t;for(let i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}(n);else{if("number"!=typeof n)throw new xn("Invalid seed input: ".concat(n));a=n}return i+Ro(a)()*(r-i)}]});class ts{constructor(e,t,i,r){this.expression=e,this._warningHistory={},this._evaluator=new Cn(i,r),this._defaultValue=t?function(e){return"color"===e.type&&(Zo(e.default)||Array.isArray(e.default))?new jr(0,0,0,0):"color"===e.type?jr.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,i,r,n,a,o,s){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this._evaluator.canonical=r||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=a,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=s||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,i,r,n,a,o,s){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=i||null,this._evaluator.canonical=r||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=a||null,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=s||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new xn("Expected value to be one of ".concat(Object.keys(this._enumValues).map((e=>JSON.stringify(e))).join(", "),", but found ").concat(JSON.stringify(e)," instead."));return e}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function is(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Lo}function rs(e,t,i,r){const n=new Ga(Lo,[],t?function(e){const t={color:Kr,string:Yr,number:Xr,enum:Yr,boolean:Jr,formatted:rn,resolvedImage:nn};return"array"===e.type?an(t[e.value]||en,e.length):t[e.type]}(t):void 0,void 0,void 0,i,r),a=n.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return a?Vo(new ts(a,t,i,r)):jo(n.errors)}class ns{constructor(e,t,i){this.kind=e,this._styleExpression=t,this.isLightConstant=i,this.isStateDependent="constant"!==e&&!Na(t.expression),this.isConfigDependent=!Va(t.expression)}evaluateWithoutErrorHandling(e,t,i,r,n,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,a)}evaluate(e,t,i,r,n,a){return this._styleExpression.evaluate(e,t,i,r,n,a)}}class as{constructor(e,t,i,r,n){this.kind=e,this.zoomStops=i,this._styleExpression=t,this.isStateDependent="camera"!==e&&!Na(t.expression),this.isLightConstant=n,this.isConfigDependent=!Va(t.expression),this.interpolationType=r}evaluateWithoutErrorHandling(e,t,i,r,n,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,n,a)}evaluate(e,t,i,r,n,a){return this._styleExpression.evaluate(e,t,i,r,n,a)}interpolationFactor(e,t,i){return this.interpolationType?uo.interpolationFactor(this.interpolationType,e,t,i):0}}function os(e,t,i,r){if("error"===(e=rs(e,t,i,r)).result)return e;const n=e.value.expression,a=Ba(n);if(!a&&!Go(t))return jo([new Wr("","data expressions not supported")]);const o=ja(n,["zoom","pitch","distance-from-center"]);if(!o&&!Ho(t))return jo([new Wr("","zoom expressions not supported")]);const s=ja(n,["measure-light"]);if(!s&&!qo(t))return jo([new Wr("","measure-light expression not supported")]);const l=t.expression&&t.expression.relaxZoomRestriction,c=ls(n);return c||o||l?c instanceof Wr?jo([c]):c instanceof uo&&!Wo(t)?jo([new Wr("",'"interpolate" expressions cannot be used with this property')]):Vo(c?new as(a?"camera":"composite",e.value,c.labels,c instanceof uo?c.interpolation:void 0,s):new ns(a?"constant":"source",e.value,s)):jo([new Wr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ss{constructor(e,t){this._parameters=e,this._specification=t,Hr(this,Xo(this._parameters,this._specification))}static deserialize(e){return new ss(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ls(e){let t=null;if(e instanceof mo)t=ls(e.result);else if(e instanceof fo){for(const i of e.args)if(t=ls(i),t)break}else(e instanceof Wa||e instanceof uo)&&e.input instanceof In&&"zoom"===e.input.name&&(t=e);return t instanceof Wr||e.eachChild((e=>{const i=ls(e);i instanceof Wr?t=i:t&&i&&t!==i&&(t=new Wr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}var cs=us,hs=3;function us(e,t,i){var r=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var n=new Int32Array(this.arrayBuffer);e=n[0],this.d=(t=n[1])+2*(i=n[2]);for(var a=0;a<this.d*this.d;a++){var o=n[hs+a],s=n[hs+a+1];r.push(o===s?null:n.subarray(o,s))}var l=n[hs+r.length+1];this.keys=n.subarray(n[hs+r.length],l),this.bboxes=n.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*i;for(var c=0;c<this.d*this.d;c++)r.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=i,this.scale=t/e,this.uid=0;var h=i/t*e;this.min=-h,this.max=e+h}us.prototype.insert=function(e,t,i,r,n){this._forEachCell(t,i,r,n,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)},us.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},us.prototype._insertCell=function(e,t,i,r,n,a){this.cells[n].push(a)},us.prototype.query=function(e,t,i,r,n){var a=this.min,o=this.max;if(e<=a&&t<=a&&o<=i&&o<=r&&!n)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(e,t,i,r,this._queryCell,s,{},n),s},us.prototype._queryCell=function(e,t,i,r,n,a,o,s){var l=this.cells[n];if(null!==l)for(var c=this.keys,h=this.bboxes,u=0;u<l.length;u++){var d=l[u];if(void 0===o[d]){var p=4*d;(s?s(h[p+0],h[p+1],h[p+2],h[p+3]):e<=h[p+2]&&t<=h[p+3]&&i>=h[p+0]&&r>=h[p+1])?(o[d]=!0,a.push(c[d])):o[d]=!1}}},us.prototype._forEachCell=function(e,t,i,r,n,a,o,s){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),h=this._convertToCellCoord(i),u=this._convertToCellCoord(r),d=l;d<=h;d++)for(var p=c;p<=u;p++){var f=this.d*p+d;if((!s||s(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&n.call(this,e,t,i,r,f,a,o,s))return}},us.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},us.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},us.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=hs+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var n=new Int32Array(t+i+this.keys.length+this.bboxes.length);n[0]=this.extent,n[1]=this.n,n[2]=this.padding;for(var a=t,o=0;o<e.length;o++){var s=e[o];n[hs+o]=a,n.set(s,a),a+=s.length}return n[hs+e.length]=a,n.set(this.keys,a),n[hs+e.length+1]=a+=this.keys.length,n.set(this.bboxes,a),a+=this.bboxes.length,n.buffer};var ds=u(cs);const ps={};function fs(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),ps[t]={klass:e,omit:i.omit||[]}}fs(Object,"Object"),ds.serialize=function(e,t){const i=e.toArrayBuffer();return t&&t.add(i),{buffer:i}},ds.deserialize=function(e){return new ds(e.buffer)},Object.defineProperty(ds,"name",{value:"Grid"}),fs(ds,"Grid"),fs(jr,"Color"),fs(Error,"Error"),fs(pn,"Formatted"),fs(dn,"FormattedSection"),fs(Yi,"AJAXError"),fs(fn,"ResolvedImage"),fs(ss,"StylePropertyFunction"),fs(ts,"StyleExpression",{omit:["_evaluator"]}),fs(as,"ZoomDependentExpression"),fs(ns,"ZoomConstantExpression"),fs(In,"CompoundExpression",{omit:["_evaluate"]});for(const mx in Lo)ps[Lo[mx]._classRegistryKey]||fs(Lo[mx],"Expression".concat(mx));function ms(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function gs(e){return self.ImageBitmap&&e instanceof ImageBitmap}function _s(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(ms(e)||gs(e))return t&&t.add(e),e;if(ArrayBuffer.isView(e)){const i=e;return t&&t.add(i.buffer),i}if(e instanceof ImageData)return t&&t.add(e.data.buffer),e;if(Array.isArray(e)){const i=[];for(const r of e)i.push(_s(r,t));return i}if(e instanceof Map){const t={$name:"Map"};for(const[i,r]of e.entries())t[i]=_s(r);return t}if("object"==typeof e){const i=e.constructor,r=i._classRegistryKey;if(!r)throw new Error("can't serialize object of unregistered class ".concat(r));const n=i.serialize?i.serialize(e,t):{};if(!i.serialize){for(const i in e)e.hasOwnProperty(i)&&(ps[r].omit.indexOf(i)>=0||(n[i]=_s(e[i],t)));e instanceof Error&&(n.message=e.message)}if(n.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==r&&(n.$name=r),n}throw new Error("can't serialize object of type "+typeof e)}function ys(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||ms(e)||gs(e)||ArrayBuffer.isView(e)||e instanceof ImageData)return e;if(Array.isArray(e))return e.map(ys);if("object"==typeof e){const t=e.$name||"Object";if("Map"===t){const t=new Map;for(const i of Object.keys(e))"$name"!==i&&t.set(i,ys(e[i]));return t}const{klass:i}=ps[t];if(!i)throw new Error("can't deserialize unregistered class ".concat(t));if(i.deserialize)return i.deserialize(e);const r=Object.create(i.prototype);for(const n of Object.keys(e))"$name"!==n&&(r[n]=ys(e[n]));return r}throw new Error("can't deserialize object of type "+typeof e)}const vs={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function xs(e){for(const t of e)if(Ss(t.charCodeAt(0)))return!0;return!1}function bs(e){for(const t of e)if(!ws(t.charCodeAt(0)))return!1;return!0}function ws(e){return!(vs.Arabic(e)||vs["Arabic Supplement"](e)||vs["Arabic Extended-A"](e)||vs["Arabic Presentation Forms-A"](e)||vs["Arabic Presentation Forms-B"](e))}function Ss(e){return!(746!==e&&747!==e&&(e<4352||!(vs["Bopomofo Extended"](e)||vs.Bopomofo(e)||vs["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||vs["CJK Compatibility Ideographs"](e)||vs["CJK Compatibility"](e)||vs["CJK Radicals Supplement"](e)||vs["CJK Strokes"](e)||!(!vs["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||vs["CJK Unified Ideographs Extension A"](e)||vs["CJK Unified Ideographs"](e)||vs["Enclosed CJK Letters and Months"](e)||vs["Hangul Compatibility Jamo"](e)||vs["Hangul Jamo Extended-A"](e)||vs["Hangul Jamo Extended-B"](e)||vs["Hangul Jamo"](e)||vs["Hangul Syllables"](e)||vs.Hiragana(e)||vs["Ideographic Description Characters"](e)||vs.Kanbun(e)||vs["Kangxi Radicals"](e)||vs["Katakana Phonetic Extensions"](e)||vs.Katakana(e)&&12540!==e||!(!vs["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!vs["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||vs["Unified Canadian Aboriginal Syllabics"](e)||vs["Unified Canadian Aboriginal Syllabics Extended"](e)||vs["Vertical Forms"](e)||vs["Yijing Hexagram Symbols"](e)||vs["Yi Syllables"](e)||vs["Yi Radicals"](e))))}function Ts(e){return!(Ss(e)||function(e){return!!(vs["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||vs["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||vs["Letterlike Symbols"](e)||vs["Number Forms"](e)||vs["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||vs["Control Pictures"](e)&&9251!==e||vs["Optical Character Recognition"](e)||vs["Enclosed Alphanumerics"](e)||vs["Geometric Shapes"](e)||vs["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||vs["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||vs["CJK Symbols and Punctuation"](e)||vs.Katakana(e)||vs["Private Use Area"](e)||vs["CJK Compatibility Forms"](e)||vs["Small Form Variants"](e)||vs["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function Es(e){return e>=1424&&e<=2303||vs["Arabic Presentation Forms-A"](e)||vs["Arabic Presentation Forms-B"](e)}function Ms(e,t){return!(!t&&Es(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||vs.Khmer(e))}function As(e){for(const t of e)if(Es(t.charCodeAt(0)))return!0;return!1}const Ps="deferred",Cs="loading",Is="loaded";let ks=null,Ds="unavailable",Rs=null;const Ls=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(Ds="error"),ks&&ks(e)};function zs(){Fs.fire(new Rr("pluginStateChange",{pluginStatus:Ds,pluginURL:Rs}))}const Fs=new zr,Os=function(){return Ds},Bs=function(){if(Ds!==Ps||!Rs)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ds=Cs,zs(),Rs&&$i({url:Rs},(e=>{e?Ls(e):(Ds=Is,zs())}))},Ns={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ds===Is||null!=Ns.applyArabicShaping,isLoading:()=>Ds===Cs,setState(e){Ds=e.pluginStatus,Rs=e.pluginURL},isParsed:()=>null!=Ns.applyArabicShaping&&null!=Ns.processBidirectionalText&&null!=Ns.processStyledBidirectionalText,getPluginURL:()=>Rs};class Vs{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.transition=t.transition,this.pitch=t.pitch,this.brightness=t.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(e,t){for(const i of e)if(!Ms(i.charCodeAt(0),t))return!1;return!0}(e,Ns.isLoaded())}}class js{constructor(e,t,i,r){this.property=e,this.value=t,this.expression=function(e,t,i,r){if(Zo(e))return new ss(e,t);if(is(e)||Array.isArray(e)&&e.length>0){const n=os(e,t,i,r);if("error"===n.result)throw new Error(n.value.map((e=>"".concat(e.key,": ").concat(e.message))).join(", "));return n.value}{let i=e;return"string"==typeof e&&"color"===t.type&&(i=jr.parse(e)),{kind:"constant",isConfigDependent:!1,evaluate:()=>i}}}(void 0===t?e.specification.default:t,e.specification,i,r)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,i){return this.property.possiblyEvaluate(this,e,t,i)}}class Us{constructor(e,t,i){this.property=e,this.value=new js(e,void 0,t,i)}transitioned(e,t){return new qs(this.property,this.value,t,$t({},e.transition,this.transition),e.now)}untransitioned(){return new qs(this.property,this.value,null,{},0)}}class Gs{constructor(e,t,i){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=t,this._options=i,this.isConfigDependent=!1}getValue(e){return ci(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Us(this._values[e].property,this._scope,this._options)),this._values[e].value=new js(this._values[e].property,null===t?void 0:ci(t),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,t){t&&(this._options=t);const i=this._properties.properties;if(e)for(const r in e){const t=e[r];if(oi(r,"-transition")){const e=r.slice(0,-11);i[e]&&this.setTransition(e,t)}else i[r]&&this.setValue(r,t)}}getTransition(e){return ci(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Us(this._values[e].property)),this._values[e].transition=ci(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i);const r=this.getTransition(t);void 0!==r&&(e["".concat(t,"-transition")]=r)}return e}transitioned(e,t){const i=new Hs(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].transitioned(e,t._values[r]);return i}untransitioned(){const e=new Hs(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class qs{constructor(e,t,i,r,n){const a=r.delay||0,o=r.duration||0;n=n||0,this.property=e,this.value=t,this.begin=n+a,this.end=this.begin+o,e.specification.transition&&(r.delay||r.duration)&&(this.prior=i)}possiblyEvaluate(e,t,i){const r=e.now||0,n=this.value.possiblyEvaluate(e,t,i),a=this.prior;if(a){if(r>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(r<this.begin)return a.possiblyEvaluate(e,t,i);{const o=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(e,t,i),n,Wt(o))}}return n}}class Hs{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,i){const r=new Qs(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(e,t,i);return r}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ws{constructor(e,t,i){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=t,this._options=i,this.isConfigDependent=!1}getValue(e){return ci(this._values[e].value)}setValue(e,t){this._values[e]=new js(this._values[e].property,null===t?void 0:ci(t),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const t of Object.keys(this._values)){const i=this.getValue(t);void 0!==i&&(e[t]=i)}return e}possiblyEvaluate(e,t,i){const r=new Qs(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].possiblyEvaluate(e,t,i);return r}}class Zs{constructor(e,t,i){this.property=e,this.value=t,this.parameters=i}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,i,r){return this.property.evaluate(this.value,this.parameters,e,t,i,r)}}class Qs{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Xs{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,i){const r=qr[this.specification.type];return r?r(e,t,i):e}}class Ys{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,i,r){return new Zs(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},i,r)}:e.expression,t)}interpolate(e,t,i){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Zs(this,{kind:"constant",value:void 0},e.parameters);const r=qr[this.specification.type];return r?new Zs(this,{kind:"constant",value:r(e.value.value,t.value.value,i)},e.parameters):e}evaluate(e,t,i,r,n,a){return"constant"===e.kind?e.value:e.evaluate(t,i,r,n,a)}}class Js{constructor(e){this.specification=e}possiblyEvaluate(e,t,i,r){return!!e.expression.evaluate(t,null,{},i,r)}interpolate(){return!1}}class Ks{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new Vs(0,{});for(const i in e){const r=e[i];r.specification.overridable&&this.overridableProperties.push(i);const n=this.defaultPropertyValues[i]=new js(r,void 0),a=this.defaultTransitionablePropertyValues[i]=new Us(r);this.defaultTransitioningPropertyValues[i]=a.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=n.possiblyEvaluate(t)}}}function $s(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function el(e){if(Array.isArray(e))return e.map(el);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const i in e)t[i]=el(e[i]);return t}return $s(e)}fs(Ys,"DataDrivenProperty"),fs(Xs,"DataConstantProperty"),fs(Js,"ColorRampProperty");var tl=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function il(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!il(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function rl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fill";if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};il(e)||(e=hl(e));const i=e;let r=!0;try{r=function(e){if(!ol(e))return e;let t=el(e);return al(t),t=nl(t),t}(i)}catch(e){console.warn("Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n".concat(JSON.stringify(i,null,2),"\n        "))}const n=tl["filter_".concat(t)],a=rs(r,n);let o=null;if("error"===a.result)throw new Error(a.value.map((e=>"".concat(e.key,": ").concat(e.message))).join(", "));o=(e,t,i)=>a.value.evaluate(e,t,{},i);let s=null,l=null;if(r!==i){const e=rs(i,n);if("error"===e.result)throw new Error(e.value.map((e=>"".concat(e.key,": ").concat(e.message))).join(", "));s=(t,i,r,n,a)=>e.value.evaluate(t,i,{},r,void 0,void 0,n,a),l=!Ba(e.value.expression)}return{filter:o,dynamicFilter:s||void 0,needGeometry:cl(r),needFeature:!!l}}function nl(e){if(!Array.isArray(e))return e;const t=function(e){if(sl.has(e[0]))for(let t=1;t<e.length;t++)if(ol(e[t]))return!0;return e}(e);return!0===t?t:t.map((e=>nl(e)))}function al(e){let t=!1;const i=[];if("case"===e[0]){for(let r=1;r<e.length-1;r+=2)t=t||ol(e[r]),i.push(e[r+1]);i.push(e[e.length-1])}else if("match"===e[0]){t=t||ol(e[1]);for(let t=2;t<e.length-1;t+=2)i.push(e[t+1]);i.push(e[e.length-1])}else if("step"===e[0]){t=t||ol(e[1]);for(let t=1;t<e.length-1;t+=2)i.push(e[t+1])}t&&(e.length=0,e.push("any",...i));for(let r=1;r<e.length;r++)al(e[r])}function ol(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let i=1;i<e.length;i++)if(ol(e[i]))return!0;return!1}const sl=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ll(e,t){return e<t?-1:e>t?1:0}function cl(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(cl(e[t]))return!0;return!1}function hl(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?ul(e[1],e[2],"=="):"!="===t?fl(ul(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?ul(e[1],e[2],t):"any"===t?(i=e.slice(1),["any"].concat(i.map(hl))):"all"===t?["all"].concat(e.slice(1).map(hl)):"none"===t?["all"].concat(e.slice(1).map(hl).map(fl)):"in"===t?dl(e[1],e.slice(2)):"!in"===t?fl(dl(e[1],e.slice(2))):"has"===t?pl(e[1]):"!has"!==t||fl(pl(e[1]));var i}function ul(e,t,i){switch(e){case"$type":return["filter-type-".concat(i),t];case"$id":return["filter-id-".concat(i),t];default:return["filter-".concat(i),e,t]}}function dl(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((e=>typeof e!=typeof t[0]))?["filter-in-large",e,["literal",t.sort(ll)]]:["filter-in-small",e,["literal",t]]}}function pl(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function fl(e){return["!",e]}const ml="\x1f";function gl(e,t){return t?"".concat(e).concat(ml).concat(t):e}const _l="-transition",yl=new Set(["fill","line","background","hillshade","raster"]);class vl extends zr{constructor(e,t,i,r){if(super(),this.id=e.id,this.fqid=gl(this.id,i),this.type=e.type,this.scope=i,this.options=r,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),t.layout&&(this._unevaluatedLayout=new Ws(t.layout,this.scope,r),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),t.paint)){this._transitionablePaint=new Gs(t.paint,this.scope,r);for(const t in e.paint)this.setPaintProperty(t,e.paint[t]);for(const t in e.layout)this.setLayoutProperty(t,e.layout[t]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Qs(t.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return yl.has(this.type)}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t){if("custom"===this.type&&"visibility"===e)return void(this.visibility=t);const i=this._unevaluatedLayout;i._properties.properties[e]&&(i.setValue(e,t),this.isConfigDependent=this.isConfigDependent||i.isConfigDependent,"visibility"===e&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return oi(e,_l)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t){const i=this._transitionablePaint,r=i._properties.properties;if(oi(e,_l)){const n=e.slice(0,-11);return r[n]&&i.setTransition(n,t||void 0),!1}if(!r[e])return!1;const n=i._values[e],a=n.value.isDataDriven(),o=n.value;i.setValue(e,t),this.isConfigDependent=this.isConfigDependent||i.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const s=i._values[e].value,l=s.isDataDriven(),c=oi(e,"pattern")||"line-dasharray"===e;return l||a||c||this._handleOverridablePaintPropertyUpdate(e,o,s)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,t){return null}_handleOverridablePaintPropertyUpdate(e,t,i){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){return li({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},((e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof Zs&&Go(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=rl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&("shadow"===e.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,t,i,r,n,a,o,s,l){}queryIntersectsMatchingFeature(e,t,i,r){}}const xl={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class bl{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class wl{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Sl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=0,r=0;return{members:e.map((e=>{const n=xl[e.type].BYTES_PER_ELEMENT,a=i=Tl(i,Math.max(t,n)),o=e.components||1;return r=Math.max(r,n),i+=n*o,{name:e.name,type:e.type,components:o,offset:a}})),size:Tl(i,Math.max(r,t)),alignment:t}}function Tl(e,t){return Math.ceil(e/t)*t}class El extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const r=2*e;return this.int16[r+0]=t,this.int16[r+1]=i,e}}El.prototype.bytesPerElement=4,fs(El,"StructArrayLayout2i4");class Ml extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=3*e;return this.int16[n+0]=t,this.int16[n+1]=i,this.int16[n+2]=r,e}}Ml.prototype.bytesPerElement=6,fs(Ml,"StructArrayLayout3i6");class Al extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const a=4*e;return this.int16[a+0]=t,this.int16[a+1]=i,this.int16[a+2]=r,this.int16[a+3]=n,e}}Al.prototype.bytesPerElement=8,fs(Al,"StructArrayLayout4i8");class Pl extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,r,n)}emplace(e,t,i,r,n,a){const o=5*e;return this.int16[o+0]=t,this.int16[o+1]=i,this.int16[o+2]=r,this.int16[o+3]=n,this.int16[o+4]=a,e}}Pl.prototype.bytesPerElement=10,fs(Pl,"StructArrayLayout5i10");class Cl extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,a,o)}emplace(e,t,i,r,n,a,o,s){const l=6*e,c=12*e,h=3*e;return this.int16[l+0]=t,this.int16[l+1]=i,this.uint8[c+4]=r,this.uint8[c+5]=n,this.uint8[c+6]=a,this.uint8[c+7]=o,this.float32[h+2]=s,e}}Cl.prototype.bytesPerElement=12,fs(Cl,"StructArrayLayout2i4ub1f12");class Il extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const a=4*e;return this.float32[a+0]=t,this.float32[a+1]=i,this.float32[a+2]=r,this.float32[a+3]=n,e}}Il.prototype.bytesPerElement=16,fs(Il,"StructArrayLayout4f16");class kl extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const r=2*e;return this.float32[r+0]=t,this.float32[r+1]=i,e}}kl.prototype.bytesPerElement=8,fs(kl,"StructArrayLayout2f8");class Dl extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,r,n)}emplace(e,t,i,r,n,a){const o=6*e,s=3*e;return this.uint16[o+0]=t,this.uint16[o+1]=i,this.uint16[o+2]=r,this.uint16[o+3]=n,this.float32[s+2]=a,e}}Dl.prototype.bytesPerElement=12,fs(Dl,"StructArrayLayout4ui1f12");class Rl extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const a=4*e;return this.uint16[a+0]=t,this.uint16[a+1]=i,this.uint16[a+2]=r,this.uint16[a+3]=n,e}}Rl.prototype.bytesPerElement=8,fs(Rl,"StructArrayLayout4ui8");class Ll extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,r,n,a)}emplace(e,t,i,r,n,a,o){const s=6*e;return this.int16[s+0]=t,this.int16[s+1]=i,this.int16[s+2]=r,this.int16[s+3]=n,this.int16[s+4]=a,this.int16[s+5]=o,e}}Ll.prototype.bytesPerElement=12,fs(Ll,"StructArrayLayout6i12");class zl extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o,s,l,c,h,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,i,r,n,a,o,s,l,c,h,u)}emplace(e,t,i,r,n,a,o,s,l,c,h,u,d){const p=12*e;return this.int16[p+0]=t,this.int16[p+1]=i,this.int16[p+2]=r,this.int16[p+3]=n,this.uint16[p+4]=a,this.uint16[p+5]=o,this.uint16[p+6]=s,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=h,this.int16[p+10]=u,this.int16[p+11]=d,e}}zl.prototype.bytesPerElement=24,fs(zl,"StructArrayLayout4i4ui4i24");class Fl extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,i,r,n,a)}emplace(e,t,i,r,n,a,o){const s=10*e,l=5*e;return this.int16[s+0]=t,this.int16[s+1]=i,this.int16[s+2]=r,this.float32[l+2]=n,this.float32[l+3]=a,this.float32[l+4]=o,e}}Fl.prototype.bytesPerElement=20,fs(Fl,"StructArrayLayout3i3f20");class Ol extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}Ol.prototype.bytesPerElement=4,fs(Ol,"StructArrayLayout1ul4");class Bl extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const i=this.length;return this.resize(i+1),this.emplace(i,e,t)}emplace(e,t,i){const r=2*e;return this.uint16[r+0]=t,this.uint16[r+1]=i,e}}Bl.prototype.bytesPerElement=4,fs(Bl,"StructArrayLayout2ui4");class Nl extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o,s,l,c,h,u,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,i,r,n,a,o,s,l,c,h,u,d)}emplace(e,t,i,r,n,a,o,s,l,c,h,u,d,p){const f=20*e,m=10*e;return this.int16[f+0]=t,this.int16[f+1]=i,this.int16[f+2]=r,this.int16[f+3]=n,this.int16[f+4]=a,this.float32[m+3]=o,this.float32[m+4]=s,this.float32[m+5]=l,this.float32[m+6]=c,this.int16[f+14]=h,this.uint32[m+8]=u,this.uint16[f+18]=d,this.uint16[f+19]=p,e}}Nl.prototype.bytesPerElement=40,fs(Nl,"StructArrayLayout5i4f1i1ul2ui40");class Vl extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,a,o)}emplace(e,t,i,r,n,a,o,s){const l=8*e;return this.int16[l+0]=t,this.int16[l+1]=i,this.int16[l+2]=r,this.int16[l+4]=n,this.int16[l+5]=a,this.int16[l+6]=o,this.int16[l+7]=s,e}}Vl.prototype.bytesPerElement=16,fs(Vl,"StructArrayLayout3i2i2i16");class jl extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,r,n)}emplace(e,t,i,r,n,a){const o=4*e,s=8*e;return this.float32[o+0]=t,this.float32[o+1]=i,this.float32[o+2]=r,this.int16[s+6]=n,this.int16[s+7]=a,e}}jl.prototype.bytesPerElement=16,fs(jl,"StructArrayLayout2f1f2i16");class Ul extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const a=12*e,o=3*e;return this.uint8[a+0]=t,this.uint8[a+1]=i,this.float32[o+1]=r,this.float32[o+2]=n,e}}Ul.prototype.bytesPerElement=12,fs(Ul,"StructArrayLayout2ub2f12");class Gl extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=3*e;return this.uint16[n+0]=t,this.uint16[n+1]=i,this.uint16[n+2]=r,e}}Gl.prototype.bytesPerElement=6,fs(Gl,"StructArrayLayout3ui6");class ql extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,v,x)}emplace(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,v,x,b){const w=30*e,S=15*e,T=60*e;return this.int16[w+0]=t,this.int16[w+1]=i,this.int16[w+2]=r,this.float32[S+2]=n,this.float32[S+3]=a,this.uint16[w+8]=o,this.uint16[w+9]=s,this.uint32[S+5]=l,this.uint32[S+6]=c,this.uint32[S+7]=h,this.uint16[w+16]=u,this.uint16[w+17]=d,this.uint16[w+18]=p,this.float32[S+10]=f,this.float32[S+11]=m,this.uint8[T+48]=g,this.uint8[T+49]=_,this.uint8[T+50]=y,this.uint32[S+13]=v,this.int16[w+28]=x,this.uint8[T+58]=b,e}}ql.prototype.bytesPerElement=60,fs(ql,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Hl extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,v,x,b,w,S,T,E,M,A,P,C,I,k){const D=this.length;return this.resize(D+1),this.emplace(D,e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,v,x,b,w,S,T,E,M,A,P,C,I,k)}emplace(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,v,x,b,w,S,T,E,M,A,P,C,I,k,D){const R=20*e,L=40*e,z=80*e;return this.float32[R+0]=t,this.float32[R+1]=i,this.int16[L+4]=r,this.int16[L+5]=n,this.int16[L+6]=a,this.int16[L+7]=o,this.int16[L+8]=s,this.int16[L+9]=l,this.int16[L+10]=c,this.int16[L+11]=h,this.int16[L+12]=u,this.uint16[L+13]=d,this.uint16[L+14]=p,this.uint16[L+15]=f,this.uint16[L+16]=m,this.uint16[L+17]=g,this.uint16[L+18]=_,this.uint16[L+19]=y,this.uint16[L+20]=v,this.uint16[L+21]=x,this.uint16[L+22]=b,this.uint16[L+23]=w,this.uint16[L+24]=S,this.uint16[L+25]=T,this.uint16[L+26]=E,this.uint16[L+27]=M,this.uint32[R+14]=A,this.float32[R+15]=P,this.float32[R+16]=C,this.float32[R+17]=I,this.float32[R+18]=k,this.uint8[z+76]=D,e}}Hl.prototype.bytesPerElement=80,fs(Hl,"StructArrayLayout2f9i15ui1ul4f1ub80");class Wl extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}Wl.prototype.bytesPerElement=4,fs(Wl,"StructArrayLayout1f4");class Zl extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,i,r,n)}emplace(e,t,i,r,n,a){const o=5*e;return this.float32[o+0]=t,this.float32[o+1]=i,this.float32[o+2]=r,this.float32[o+3]=n,this.float32[o+4]=a,e}}Zl.prototype.bytesPerElement=20,fs(Zl,"StructArrayLayout5f20");class Ql extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,a,o)}emplace(e,t,i,r,n,a,o,s){const l=7*e;return this.float32[l+0]=t,this.float32[l+1]=i,this.float32[l+2]=r,this.float32[l+3]=n,this.float32[l+4]=a,this.float32[l+5]=o,this.float32[l+6]=s,e}}Ql.prototype.bytesPerElement=28,fs(Ql,"StructArrayLayout7f28");class Xl extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,i,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,i,r)}emplace(e,t,i,r,n){const a=6*e;return this.uint32[3*e+0]=t,this.uint16[a+2]=i,this.uint16[a+3]=r,this.uint16[a+4]=n,e}}Xl.prototype.bytesPerElement=12,fs(Xl,"StructArrayLayout1ul3ui12");class Yl extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}Yl.prototype.bytesPerElement=2,fs(Yl,"StructArrayLayout1ui2");class Jl extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,t,i)}emplace(e,t,i,r){const n=3*e;return this.float32[n+0]=t,this.float32[n+1]=i,this.float32[n+2]=r,e}}Jl.prototype.bytesPerElement=12,fs(Jl,"StructArrayLayout3f12");class Kl extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m)}emplace(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g){const _=16*e;return this.float32[_+0]=t,this.float32[_+1]=i,this.float32[_+2]=r,this.float32[_+3]=n,this.float32[_+4]=a,this.float32[_+5]=o,this.float32[_+6]=s,this.float32[_+7]=l,this.float32[_+8]=c,this.float32[_+9]=h,this.float32[_+10]=u,this.float32[_+11]=d,this.float32[_+12]=p,this.float32[_+13]=f,this.float32[_+14]=m,this.float32[_+15]=g,e}}Kl.prototype.bytesPerElement=64,fs(Kl,"StructArrayLayout16f64");class $l extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,i,r,n,a,o){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,i,r,n,a,o)}emplace(e,t,i,r,n,a,o,s){const l=10*e,c=5*e;return this.uint16[l+0]=t,this.uint16[l+1]=i,this.uint16[l+2]=r,this.uint16[l+3]=n,this.float32[c+2]=a,this.float32[c+3]=o,this.float32[c+4]=s,e}}$l.prototype.bytesPerElement=20,fs($l,"StructArrayLayout4ui3f20");class ec extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.int16[1*e+0]=t,e}}ec.prototype.bytesPerElement=2,fs(ec,"StructArrayLayout1i2");class tc extends wl{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint8[1*e+0]=t,e}}tc.prototype.bytesPerElement=1,fs(tc,"StructArrayLayout1ub1");class ic extends bl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}ic.prototype.size=40;class rc extends Nl{get(e){return new ic(this,e)}}fs(rc,"CollisionBoxArray");class nc extends bl{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}nc.prototype.size=60;class ac extends ql{get(e){return new nc(this,e)}}fs(ac,"PlacedSymbolArray");class oc extends bl{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}oc.prototype.size=80;class sc extends Hl{get(e){return new oc(this,e)}}fs(sc,"SymbolInstanceArray");class lc extends Wl{getoffsetX(e){return this.float32[1*e+0]}}fs(lc,"GlyphOffsetArray");class cc extends El{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}fs(cc,"SymbolLineVertexArray");class hc extends bl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}hc.prototype.size=12;class uc extends Xl{get(e){return new hc(this,e)}}fs(uc,"FeatureIndexArray");class dc extends Bl{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}fs(dc,"FillExtrusionCentroidArray");const pc=Sl([{name:"a_pos",components:2,type:"Int16"}],4),fc=Sl([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class mc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.segments=e}_prepareSegment(e,t,i,r){let n=this.segments[this.segments.length-1];return e>mc.MAX_VERTEX_ARRAY_LENGTH&&ui("Max vertices per segment is ".concat(mc.MAX_VERTEX_ARRAY_LENGTH,": bucket requested ").concat(e)),(!n||n.vertexLength+e>mc.MAX_VERTEX_ARRAY_LENGTH||n.sortKey!==r)&&(n={vertexOffset:t,primitiveOffset:i,vertexLength:0,primitiveLength:0},void 0!==r&&(n.sortKey=r),this.segments.push(n)),n}prepareSegment(e,t,i,r){return this._prepareSegment(e,t.length,i.length,r)}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,i,r){return new mc([{vertexOffset:e,primitiveOffset:t,vertexLength:i,primitiveLength:r,vaos:{},sortKey:0}])}}function gc(e,t){return 256*(e=Xt(Math.floor(e),0,255))+Xt(Math.floor(t),0,255)}mc.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,fs(mc,"SegmentVector");const _c=Sl([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),yc=Sl([{name:"a_dash",components:4,type:"Uint16"}]);class vc{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,t,i,r){this.ids.push(xc(e)),this.positions.push(t,i,r)}eachPosition(e,t){const i=xc(e);let r=0,n=this.ids.length-1;for(;r<n;){const e=r+n>>1;this.ids[e]>=i?n=e:r=e+1}for(;this.ids[r]===i;)t(this.positions[3*r],this.positions[3*r+1],this.positions[3*r+2]),r++}static serialize(e,t){const i=new Float64Array(e.ids),r=new Uint32Array(e.positions);return bc(i,r,0,i.length-1),t&&(t.add(i.buffer),t.add(r.buffer)),{ids:i,positions:r}}static deserialize(e){const t=new vc;let i;t.ids=e.ids,t.positions=e.positions;for(const r of t.ids)r!==i&&t.uniqueIds.push(r),i=r;return t.indexed=!0,t}}function xc(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:Ir(String(e))}function bc(e,t,i,r){for(;i<r;){const n=e[i+r>>1];let a=i-1,o=r+1;for(;;){do{a++}while(e[a]<n);do{o--}while(e[o]>n);if(a>=o)break;wc(e,a,o),wc(t,3*a,3*o),wc(t,3*a+1,3*o+1),wc(t,3*a+2,3*o+2)}o-i<r-o?(bc(e,t,i,o),i=o+1):(bc(e,t,o+1,r),r=o)}}function wc(e,t,i){const r=e[t];e[t]=e[i],e[i]=r}fs(vc,"FeaturePositionMap");class Sc{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}set(e,t,i){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Tc extends Sc{constructor(e){super(e),this.current=0}set(e,t,i){this.fetchUniformLocation(e,t)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}}class Ec extends Sc{constructor(e){super(e),this.current=0}set(e,t,i){this.fetchUniformLocation(e,t)&&this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Mc extends Sc{constructor(e){super(e),this.current=[0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}}class Ac extends Sc{constructor(e){super(e),this.current=[0,0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}}class Pc extends Sc{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3])))}}class Cc extends Sc{constructor(e){super(e),this.current=jr.transparent}set(e,t,i){this.fetchUniformLocation(e,t)&&(i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a)))}}const Ic=new Float32Array(16);class kc extends Sc{constructor(e){super(e),this.current=Ic}set(e,t,i){if(this.fetchUniformLocation(e,t)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}}const Dc=new Float32Array(9),Rc=new Float32Array(4);class Lc extends Sc{constructor(e){super(e),this.current=Rc}set(e,t,i){if(this.fetchUniformLocation(e,t))for(let r=0;r<4;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}function zc(e){return[gc(255*e.r,255*e.g),gc(255*e.b,255*e.a)]}class Fc{constructor(e,t,i){this.value=e,this.uniformNames=t.map((e=>"u_".concat(e))),this.type=i}setUniform(e,t,i,r,n){t.set(e,n,r.constantOr(this.value))}getBinding(e,t){return"color"===this.type?new Cc(e):new Ec(e)}}class Oc{constructor(e,t){this.uniformNames=t.map((e=>"u_".concat(e))),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,t,i,r,n){const a="u_pattern"===n||"u_dash"===n?this.pattern:"u_pixel_ratio"===n?this.pixelRatio:null;a&&t.set(e,n,a)}getBinding(e,t){return"u_pattern"===t||"u_dash"===t?new Pc(e):new Ec(e)}}class Bc{constructor(e,t,i,r){this.expression=e,this.type=i,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:"a_".concat(e),type:"Float32",components:"color"===i?2:1,offset:0}))),this.paintVertexArray=new r}populatePaintArray(e,t,i,r,n,a,o){const s=this.paintVertexArray.length,l=this.expression.evaluate(new Vs(0,{brightness:a}),t,{},n,r,o);this.paintVertexArray.resize(e),this._setPaintValue(s,e,l)}updatePaintArray(e,t,i,r,n,a,o){const s=this.expression.evaluate({zoom:0,brightness:o},i,r,void 0,n);this._setPaintValue(e,t,s)}_setPaintValue(e,t,i){if("color"===this.type){const r=zc(i);for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,r[0],r[1])}else{for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Nc{constructor(e,t,i,r,n,a){this.expression=e,this.uniformNames=t.map((e=>"u_".concat(e,"_t"))),this.type=i,this.useIntegerZoom=r,this.zoom=n,this.maxValue=0,this.paintVertexAttributes=t.map((e=>({name:"a_".concat(e),type:"Float32",components:"color"===i?4:2,offset:0}))),this.paintVertexArray=new a}populatePaintArray(e,t,i,r,n,a,o){const s=this.expression.evaluate(new Vs(this.zoom,{brightness:a}),t,{},n,r,o),l=this.expression.evaluate(new Vs(this.zoom+1,{brightness:a}),t,{},n,r,o),c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(c,e,s,l)}updatePaintArray(e,t,i,r,n,a,o){const s=this.expression.evaluate({zoom:this.zoom,brightness:o},i,r,void 0,n),l=this.expression.evaluate({zoom:this.zoom+1,brightness:o},i,r,void 0,n);this._setPaintValue(e,t,s,l)}_setPaintValue(e,t,i,r){if("color"===this.type){const n=zc(i),a=zc(r);for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n[0],n[1],a[0],a[1])}else{for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,i,r);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,i,r,n){const a=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,o=Xt(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(e,n,o)}getBinding(e,t){return new Ec(e)}}class Vc{constructor(e,t,i,r,n){this.expression=e,this.layerId=n,this.paintVertexAttributes=("array"===i?yc:_c).members;for(let a=0;a<t.length;++a);this.paintVertexArray=new r}populatePaintArray(e,t,i){const r=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(r,e,t.patterns&&t.patterns[this.layerId],i)}updatePaintArray(e,t,i,r,n,a,o){this._setPaintValues(e,t,i.patterns&&i.patterns[this.layerId],a)}_setPaintValues(e,t,i,r){if(!r||!i)return;const n=r[i];if(!n)return;const{tl:a,br:o,pixelRatio:s}=n;for(let l=e;l<t;l++)this.paintVertexArray.emplace(l,a[0],a[1],o[0],o[1],s)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class jc{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.binders={},this._buffers=[];const r=[];for(const n in e.paint._values){const a=e.paint.get(n);if(!i(n))continue;if(!(a instanceof Zs&&Go(a.property.specification)))continue;const o=qc(n,e.type),s=a.value,l=a.property.specification.type,c=!!a.property.useIntegerZoom,h="line-dasharray"===n||n.endsWith("pattern"),u="line-dasharray"===n&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==s.kind||u)if("source"===s.kind||u||h){const t=Zc(n,l,"source");this.binders[n]=h?new Vc(s,o,l,t,e.id):new Bc(s,o,l,t),r.push("/a_".concat(n))}else{const e=Zc(n,l,"composite");this.binders[n]=new Nc(s,o,l,c,t,e),r.push("/z_".concat(n))}else this.binders[n]=h?new Oc(s.value,o):new Fc(s.value,o,l),r.push("/u_".concat(n))}this.cacheKey=r.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Bc||t instanceof Nc?t.maxValue:0}populatePaintArrays(e,t,i,r,n,a,o){for(const s in this.binders){const l=this.binders[s];(l instanceof Bc||l instanceof Nc||l instanceof Vc)&&l.populatePaintArray(e,t,i,r,n,a,o)}}setConstantPatternPositions(e){for(const t in this.binders){const i=this.binders[t];i instanceof Oc&&i.setConstantPatternPositions(e)}}updatePaintArrays(e,t,i,r,n,a,o,s){let l=!1;const c=Object.keys(e),h=0!==c.length,u=h?c:t.uniqueIds;for(const d in this.binders){const c=this.binders[d];if((c instanceof Bc||c instanceof Nc||c instanceof Vc)&&(!0===c.expression.isStateDependent||!1===c.expression.isLightConstant)){const p=n.paint.get(d);c.expression=p.value;for(const i of u){const n=e[i.toString()];t.eachPosition(i,((e,t,i)=>{const l=r.feature(e);c.updatePaintArray(t,i,l,n,a,o,s)}))}if(!h)for(const t of i.uniqueIds){const n=e[t.toString()];i.eachPosition(t,((e,t,i)=>{const l=r.feature(e);c.updatePaintArray(t,i,l,n,a,o,s)}))}l=!0}}return l}defines(){const e=[];for(const t in this.binders){const i=this.binders[t];(i instanceof Fc||i instanceof Oc)&&e.push(...i.uniformNames.map((e=>"#define HAS_UNIFORM_".concat(e))))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof Bc||i instanceof Nc||i instanceof Vc)for(let t=0;t<i.paintVertexAttributes.length;t++)e.push(i.paintVertexAttributes[t].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const i=this.binders[t];if(i instanceof Fc||i instanceof Oc||i instanceof Nc)for(const t of i.uniformNames)e.push(t)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof Fc||r instanceof Oc||r instanceof Nc)for(const n of r.uniformNames)t.push({name:n,property:i,binding:r.getBinding(e,n)})}return t}setUniforms(e,t,i,r,n){for(const{name:a,property:o,binding:s}of i)this.binders[o].setUniform(e,s,n,r.get(o),a)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const t=this.binders[e];(t instanceof Bc||t instanceof Nc||t instanceof Vc)&&t.paintVertexBuffer&&this._buffers.push(t.paintVertexBuffer)}}upload(e){for(const t in this.binders){const i=this.binders[t];(i instanceof Bc||i instanceof Nc||i instanceof Vc)&&i.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Bc||t instanceof Nc||t instanceof Vc)&&t.destroy()}}}class Uc{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.programConfigurations={};for(const r of e)this.programConfigurations[r.id]=new jc(r,t,i);this.needsUpload=!1,this._featureMap=new vc,this._featureMapWithoutIds=new vc,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,t,i,r,n,a,o,s){for(const l in this.programConfigurations)this.programConfigurations[l].populatePaintArrays(e,t,r,n,a,o,s);void 0!==t.id?this._featureMap.add(t.id,i,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,i,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,i,r,n,a){for(const o of i)this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,t,o,r,n,a||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Gc={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function qc(e,t){return Gc[e]||[e.replace("".concat(t,"-"),"").replace(/-/g,"_")]}const Hc={"line-pattern":{source:Dl,composite:Dl},"fill-pattern":{source:Dl,composite:Dl},"fill-extrusion-pattern":{source:Dl,composite:Dl},"line-dasharray":{source:Rl,composite:Rl}},Wc={color:{source:kl,composite:Il},number:{source:Wl,composite:kl}};function Zc(e,t,i){const r=Hc[e];return r&&r[i]||Wc[t][i]}fs(Fc,"ConstantBinder"),fs(Oc,"PatternConstantBinder"),fs(Bc,"SourceExpressionBinder"),fs(Vc,"PatternCompositeBinder"),fs(Nc,"CompositeExpressionBinder"),fs(jc,"ProgramConfiguration",{omit:["_buffers"]}),fs(Uc,"ProgramConfigurationSet");const Qc=na/Math.PI/2,Xc=5,Yc=6,Jc=16383,Kc=64,$c=[Kc,32,16],eh=-Qc,th=Qc;function ih(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Qc;return i=Gt(i),[e*Math.sin(i)*r,-t*r,e*Math.cos(i)*r]}function rh(e,t,i){return ih(Math.cos(Gt(e)),Math.sin(Gt(e)),t,i)}const nh=6371008.8,ah=2*Math.PI*nh;class oh{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: (".concat(e,", ").concat(t,")"));if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new oh(Jt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}distanceTo(e){const t=Math.PI/180,i=this.lat*t,r=e.lat*t,n=Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return nh*Math.acos(Math.min(n,1))}toBounds(){const e=360*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)/40075017,t=e/Math.cos(Math.PI/180*this.lat);return new sh({lng:this.lng-t,lat:this.lat-e},{lng:this.lng+t,lat:this.lat+e})}toEcef(e){return rh(this.lat,this.lng,Qc+e*Qc/nh)}static convert(e){if(e instanceof oh)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new oh(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new oh(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class sh{constructor(e,t){if(e)if(t)this.setSouthWest(e).setNorthEast(t);else if(4===e.length){const t=e;this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]])}else{const t=e;this.setSouthWest(t[0]).setNorthEast(t[1])}}setNorthEast(e){return this._ne=e instanceof oh?new oh(e.lng,e.lat):oh.convert(e),this}setSouthWest(e){return this._sw=e instanceof oh?new oh(e.lng,e.lat):oh.convert(e),this}extend(e){const t=this._sw,i=this._ne;let r,n;if(e instanceof oh)r=e,n=e;else{if(!(e instanceof sh))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(sh.convert(e)):this.extend(oh.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(oh.convert(e)):this;if(r=e._sw,n=e._ne,!r||!n)return this}return t||i?(t.lng=Math.min(r.lng,t.lng),t.lat=Math.min(r.lat,t.lat),i.lng=Math.max(n.lng,i.lng),i.lat=Math.max(n.lat,i.lat)):(this._sw=new oh(r.lng,r.lat),this._ne=new oh(n.lng,n.lat)),this}getCenter(){return new oh((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new oh(this.getWest(),this.getNorth())}getSouthEast(){return new oh(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return"LngLatBounds(".concat(this._sw.toString(),", ").concat(this._ne.toString(),")")}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:i}=oh.convert(e);let r=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&r}static convert(e){return!e||e instanceof sh?e:new sh(e)}}var lh={};!function(e,t){!function(e){function t(e,t,r){var n=i(256*e,256*(t=Math.pow(2,r)-t-1),r),a=i(256*(e+1),256*(t+1),r);return n[0]+","+n[1]+","+a[0]+","+a[1]}function i(e,t,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[e*r-2*Math.PI*6378137/2,t*r-2*Math.PI*6378137/2]}e.getURL=function(e,i,r,n,a,o){return o=o||{},e+"?"+["bbox="+t(r,n,a),"format="+(o.format||"image/png"),"service="+(o.service||"WMS"),"version="+(o.version||"1.1.1"),"request="+(o.request||"GetMap"),"srs="+(o.srs||"EPSG:3857"),"width="+(o.width||256),"height="+(o.height||256),"layers="+i].join("&")},e.getTileBBox=t,e.getMercCoords=i,Object.defineProperty(e,"__esModule",{value:!0})}(t)}(0,lh);var ch=lh;class hh{constructor(e,t,i){this.z=e,this.x=t,this.y=i,this.key=ph(0,e,e,t,i)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const i=ch.getTileBBox(this.x,this.y,this.z),r=function(e,t,i){let r,n="";for(let a=e;a>0;a--)r=1<<a-1,n+=(t&r?1:0)+(i&r?2:0);return n}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",r).replace("{bbox-epsg-3857}",i)}toString(){return"".concat(this.z,"/").concat(this.x,"/").concat(this.y)}}class uh{constructor(e,t){this.wrap=e,this.canonical=t,this.key=ph(e,t.z,t.z,t.x,t.y)}}class dh{constructor(e,t,i,r,n){this.overscaledZ=e,this.wrap=t,this.canonical=new hh(i,+r,+n),this.key=0===t&&e===i?this.canonical.key:ph(t,e,i,r,n)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new dh(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new dh(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return ph(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const i=this.canonical.z-e;return ph(this.wrap*+t,e,e,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new dh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,i=2*this.canonical.x,r=2*this.canonical.y;return[new dh(t,this.wrap,t,i,r),new dh(t,this.wrap,t,i+1,r),new dh(t,this.wrap,t,i,r+1),new dh(t,this.wrap,t,i+1,r+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new dh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new dh(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new uh(this.wrap,this.canonical)}toString(){return"".concat(this.overscaledZ,"/").concat(this.canonical.x,"/").concat(this.canonical.y)}}function ph(e,t,i,r,n){const a=1<<Math.min(i,22);let o=a*(n%a)+r%a;return e&&i<22&&(o+=a*a*((e<0?-2*e-1:2*e)%(1<<2*(22-i)))),16*(32*o+i)+(t-i)}const fh=[e=>{let t=e.canonical.x-1,i=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,i--),new dh(e.overscaledZ,i,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,i=e.wrap;return t===1<<e.canonical.z&&(t=0,i++),new dh(e.overscaledZ,i,e.canonical.z,t,e.canonical.y)},e=>new dh(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new dh(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];fs(hh,"CanonicalTileID"),fs(dh,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const mh=0,gh=25.5;function _h(e){return ah*Math.cos(e*Math.PI/180)}function yh(e){return(180+e)/360}function vh(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function xh(e,t){return e/_h(t)}function bh(e){return 360*e-180}function wh(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function Sh(e,t){return e*_h(wh(t))}const Th=85.051129;function Eh(e){return Math.cos(Gt(Xt(e,-Th,Th)))}function Mh(e,t){const i=Xt(t,mh,gh),r=Math.pow(2,i);return Eh(e)*ah/(512*r)}function Ah(e){return 1/Math.cos(e*Math.PI/180)}function Ph(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=Math.exp(Math.PI*(1-(e.y+t/na)/(1<<e.z)*2));return 80150034*i/(i*i+1)/na/(1<<e.z)}class Ch{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=+e,this.y=+t,this.z=+i}static fromLngLat(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=oh.convert(e);return new Ch(yh(i.lng),vh(i.lat),xh(t,i.lat))}toLngLat(){return new oh(bh(this.x),wh(this.y))}toAltitude(){return Sh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ah*Ah(wh(this.y))}}function Ih(e,t,i,r,n,a,o,s,l){const c=(t+r)/2,h=(i+n)/2,u=new Vt(c,h);s(u),function(e,t,i,r,n,a){const o=i-n,s=r-a;return Math.abs((r-t)*o-(i-e)*s)/Math.hypot(o,s)}(u.x,u.y,a.x,a.y,o.x,o.y)>=l?(Ih(e,t,i,c,h,a,u,s,l),Ih(e,c,h,r,n,u,o,s,l)):e.push(o)}function kh(e,t,i){let r=e[0],n=r.x,a=r.y;t(r);const o=[r];for(let s=1;s<e.length;s++){const l=e[s],{x:c,y:h}=l;t(l),Ih(o,n,a,c,h,r,l,t,i),n=c,a=h,r=l}return o}function Dh(e,t,i,r){if(r(t,i)){const n=t.add(i)._mult(.5);Dh(e,t,n,r),Dh(e,n,i,r)}else e.push(i)}function Rh(e,t){let i=e[0];const r=[i];for(let n=1;n<e.length;n++){const a=e[n];Dh(r,i,a,t),i=a}return r}const Lh=Math.pow(2,14)-1,zh=-Lh-1;function Fh(e,t){const i=Math.round(e.x*t),r=Math.round(e.y*t);return e.x=Xt(i,zh,Lh),e.y=Xt(r,zh,Lh),(i<e.x||i>e.x+1||r<e.y||r>e.y+1)&&ui("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function Oh(e,t,i){const r=e.loadGeometry(),n=e.extent,a=na/n;if(t&&i&&i.projection.isReprojectedInTileSpace){const a=1<<t.z,{scale:o,x:s,y:l,projection:c}=i,h=e=>{const i=bh((t.x+e.x/n)/a),r=wh((t.y+e.y/n)/a),h=c.project(i,r);e.x=(h.x*o-s)*n,e.y=(h.y*o-l)*n};for(let t=0;t<r.length;t++)if(1!==e.type)r[t]=kh(r[t],h,1);else{const e=[];for(const i of r[t])i.x<0||i.x>=n||i.y<0||i.y>=n||(h(i),e.push(i));r[t]=e}}for(const o of r)for(const e of o)Fh(e,a);return r}function Bh(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Oh(e):[]}}function Nh(e,t,i,r,n){e.emplaceBack(2*t+(r+1)/2,2*i+(n+1)/2)}function Vh(e,t,i){const r=16384;e.emplaceBack(t.x,t.y,t.z,i[0]*r,i[1]*r,i[2]*r)}class jh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new El,this.indexArray=new Gl,this.segments=new mc,this.programConfigurations=new Uc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,i,r){const n=this.layers[0],a=[];let o=null;"circle"===n.type&&(o=n.layout.get("circle-sort-key"));for(const{feature:l,id:c,index:h,sourceLayerIndex:u}of e){const e=this.layers[0]._featureFilter.needGeometry,t=Bh(l,e);if(!this.layers[0]._featureFilter.filter(new Vs(this.zoom),t,i))continue;const n=o?o.evaluate(t,{},i):void 0,s={id:c,properties:l.properties,type:l.type,sourceLayerIndex:u,index:h,geometry:e?t.geometry:Oh(l,i,r),patterns:{},sortKey:n};a.push(s)}o&&a.sort(((e,t)=>e.sortKey-t.sortKey));let s=null;"globe"===r.projection.name&&(this.globeExtVertexArray=new Ll,s=r.projection);for(const l of a){const{geometry:r,index:n,sourceLayerIndex:a}=l,o=e[n].feature;this.addFeature(l,r,n,t.availableImages,i,s,t.brightness),t.featureIndex.insert(o,r,n,a,this.index)}}update(e,t,i,r,n){const a=0!==Object.keys(e).length;a&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,a?this.stateDependentLayers:this.layers,i,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pc.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,fc.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,i,r,n,a,o){for(const s of t)for(const t of s){const i=t.x,r=t.y;if(i<0||i>=na||r<0||r>=na)continue;if(a){const e=a.projectTilePoint(i,r,n),t=a.upVector(n,i,r),o=this.globeExtVertexArray;Vh(o,e,t),Vh(o,e,t),Vh(o,e,t),Vh(o,e,t)}const o=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),s=o.vertexLength;Nh(this.layoutVertexArray,i,r,-1,-1),Nh(this.layoutVertexArray,i,r,1,-1),Nh(this.layoutVertexArray,i,r,1,1),Nh(this.layoutVertexArray,i,r,-1,1),this.indexArray.emplaceBack(s,s+1,s+2),this.indexArray.emplaceBack(s,s+2,s+3),o.vertexLength+=4,o.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},r,n,o)}}function Uh(e,t){for(let i=0;i<e.length;i++)if(Jh(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(Jh(e,t[i]))return!0;return!!Wh(e,t)}function Gh(e,t,i){return!!Jh(e,t)||!!Qh(t,e,i)}function qh(e,t){if(1===e.length)return Yh(t,e[0]);for(let i=0;i<t.length;i++){const r=t[i];for(let t=0;t<r.length;t++)if(Jh(e,r[t]))return!0}for(let i=0;i<e.length;i++)if(Yh(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(Wh(e,t[i]))return!0;return!1}function Hh(e,t,i){if(e.length>1){if(Wh(e,t))return!0;for(let r=0;r<t.length;r++)if(Qh(t[r],e,i))return!0}for(let r=0;r<e.length;r++)if(Qh(e[r],t,i))return!0;return!1}function Wh(e,t){if(0===e.length||0===t.length)return!1;for(let i=0;i<e.length-1;i++){const r=e[i],n=e[i+1];for(let e=0;e<t.length-1;e++)if(Zh(r,n,t[e],t[e+1]))return!0}return!1}function Zh(e,t,i,r){return di(e,i,r)!==di(t,i,r)&&di(e,t,i)!==di(e,t,r)}function Qh(e,t,i){const r=i*i;if(1===t.length)return e.distSqr(t[0])<r;for(let n=1;n<t.length;n++)if(Xh(e,t[n-1],t[n])<r)return!0;return!1}function Xh(e,t,i){const r=t.distSqr(i);if(0===r)return e.distSqr(t);const n=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/r;return e.distSqr(n<0?t:n>1?i:i.sub(t)._mult(n)._add(t))}function Yh(e,t){let i,r,n,a=!1;for(let o=0;o<e.length;o++){i=e[o];for(let e=0,o=i.length-1;e<i.length;o=e++)r=i[e],n=i[o],r.y>t.y!=n.y>t.y&&t.x<(n.x-r.x)*(t.y-r.y)/(n.y-r.y)+r.x&&(a=!a)}return a}function Jh(e,t){let i=!1;for(let r=0,n=e.length-1;r<e.length;n=r++){const a=e[r],o=e[n];a.y>t.y!=o.y>t.y&&t.x<(o.x-a.x)*(t.y-a.y)/(o.y-a.y)+a.x&&(i=!i)}return i}function Kh(e,t,i,r,n){for(const o of e)if(t<=o.x&&i<=o.y&&r>=o.x&&n>=o.y)return!0;const a=[new Vt(t,i),new Vt(t,n),new Vt(r,n),new Vt(r,i)];if(e.length>2)for(const o of a)if(Jh(e,o))return!0;for(let o=0;o<e.length-1;o++)if($h(e[o],e[o+1],a))return!0;return!1}function $h(e,t,i){const r=i[0],n=i[2];if(e.x<r.x&&t.x<r.x||e.x>n.x&&t.x>n.x||e.y<r.y&&t.y<r.y||e.y>n.y&&t.y>n.y)return!1;const a=di(e,t,i[0]);return a!==di(e,t,i[1])||a!==di(e,t,i[2])||a!==di(e,t,i[3])}function eu(e,t,i,r,n,a){let o=t.y-e.y,s=e.x-t.x;if(a=a||0){const e=o*o+s*s;if(0===e)return!0;const t=Math.sqrt(e);o/=t,s/=t}return!((i.x-e.x)*o+(i.y-e.y)*s-a<0||(r.x-e.x)*o+(r.y-e.y)*s-a<0||(n.x-e.x)*o+(n.y-e.y)*s-a<0)}function tu(e,t,i,r,n,a,o){return!(eu(e,t,r,n,a,o)||eu(t,i,r,n,a,o)||eu(i,e,r,n,a,o)||eu(r,n,e,t,i,o)||eu(n,a,e,t,i,o)||eu(a,r,e,t,i,o))}function iu(e,t,i){const r=t.paint.get(e).value;return"constant"===r.kind?r.value:i.programConfigurations.get(t.id).getMaxValue(e)}function ru(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function nu(e,t,i,r,n){if(!t[0]&&!t[1])return e;const a=Vt.convert(t)._mult(n);"viewport"===i&&a._rotate(-r);const o=[];for(let s=0;s<e.length;s++)o.push(e[s].sub(a));return o}function au(e,t,i,r){const n=Vt.convert(e)._mult(r);return"viewport"===t&&n._rotate(-i),n}fs(jh,"CircleBucket",{omit:["layers"]});const ou=new Ks({"circle-sort-key":new Ys(tl.layout_circle["circle-sort-key"]),visibility:new Xs(tl.layout_circle.visibility)});var su={paint:new Ks({"circle-radius":new Ys(tl.paint_circle["circle-radius"]),"circle-color":new Ys(tl.paint_circle["circle-color"]),"circle-blur":new Ys(tl.paint_circle["circle-blur"]),"circle-opacity":new Ys(tl.paint_circle["circle-opacity"]),"circle-translate":new Xs(tl.paint_circle["circle-translate"]),"circle-translate-anchor":new Xs(tl.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Xs(tl.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Xs(tl.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ys(tl.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ys(tl.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ys(tl.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Xs(tl.paint_circle["circle-emissive-strength"])}),layout:ou};class lu{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(t,i,r){const n=e.Q.dot(i,this.dir);if(Math.abs(n)<1e-6)return!1;const a=((t[0]-this.pos[0])*i[0]+(t[1]-this.pos[1])*i[1]+(t[2]-this.pos[2])*i[2])/n;return r[0]=this.pos[0]+this.dir[0]*a,r[1]=this.pos[1]+this.dir[1]*a,r[2]=this.pos[2]+this.dir[2]*a,!0}closestPointOnSphere(t,i,r){if(e.Q.equals(this.pos,t)||0===i)return r[0]=r[1]=r[2]=0,!1;const[n,a,o]=this.dir,s=this.pos[0]-t[0],l=this.pos[1]-t[1],c=this.pos[2]-t[2],h=n*n+a*a+o*o,u=2*(s*n+l*a+c*o),d=u*u-4*h*(s*s+l*l+c*c-i*i);if(d<0){const e=Math.max(-u/2,0),t=s+n*e,h=l+a*e,d=c+o*e,p=Math.hypot(t,h,d);return r[0]=t*i/p,r[1]=h*i/p,r[2]=d*i/p,!1}{const e=(-u-Math.sqrt(d))/(2*h);if(e<0){const e=Math.hypot(s,l,c);return r[0]=s*i/e,r[1]=l*i/e,r[2]=c*i/e,!1}return r[0]=s+n*e,r[1]=l+a*e,r[2]=c+o*e,!0}}}class cu{constructor(e,t,i,r,n){this.TL=e,this.TR=t,this.BR=i,this.BL=r,this.horizon=n}static fromInvProjectionMatrix(t,i,r){const n=[-1,1,1],a=[1,1,1],o=[1,-1,1],s=[-1,-1,1],l=e.Q.transformMat4(n,n,t),c=e.Q.transformMat4(a,a,t),h=e.Q.transformMat4(o,o,t),u=e.Q.transformMat4(s,s,t);return new cu(l,c,h,u,i/r)}}function hu(t,i,r){let n=1/0,a=-1/0;const o=[];for(const s of t){e.Q.sub(o,s,i);const t=e.Q.dot(o,r);n=Math.min(n,t),a=Math.max(a,t)}return[n,a]}function uu(t,i){let r=!0;for(let n=0;n<t.planes.length;n++){const a=t.planes[n];let o=0;for(let t=0;t<i.length;t++)o+=e.Q.dot(a,i[t])+a[3]>=0;if(0===o)return 0;o!==i.length&&(r=!1)}return r?2:1}function du(e,t){for(const i of e.projections){const r=hu(t,e.points[0],i.axis);if(i.projection[1]<r[0]||i.projection[0]>r[1])return 0}return 1}function pu(t,i){let r=0;const n=[0,0,0,0];for(let a=0;a<t.length;a++)n[0]=t[a][0],n[1]=t[a][1],n[2]=t[a][2],n[3]=1,e.aa.dot(n,i)>=0&&r++;return r}class fu{constructor(t,i){this.points=t||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=mu.fromPoints(this.points),this.projections=[],this.frustumEdges=[e.Q.sub([],this.points[2],this.points[3]),e.Q.sub([],this.points[0],this.points[3]),e.Q.sub([],this.points[4],this.points[0]),e.Q.sub([],this.points[5],this.points[1]),e.Q.sub([],this.points[6],this.points[2]),e.Q.sub([],this.points[7],this.points[3])];for(const e of this.frustumEdges){const t=[0,-e[2],e[1]],i=[e[2],0,-e[0]];this.projections.push({axis:t,projection:hu(this.points,this.points[0],t)}),this.projections.push({axis:i,projection:hu(this.points,this.points[0],i)})}}static fromInvProjectionMatrix(t,i,r,n){const a=Math.pow(2,r),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((r=>{const o=e.aa.transformMat4([],r,t),s=1/o[3]/i*a;return e.aa.mul(o,o,[s,s,n?1/o[3]:s,s])})),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((t=>{const i=e.Q.sub([],o[t[0]],o[t[1]]),r=e.Q.sub([],o[t[2]],o[t[1]]),n=e.Q.normalize([],e.Q.cross([],i,r)),a=-e.Q.dot(n,o[t[1]]);return n.concat(a)})),l=[];for(let e=0;e<o.length;e++)l.push([o[e][0],o[e][1],o[e][2]]);return new fu(l,s)}intersectsPrecise(t,i,r){for(let e=0;e<i.length;e++)if(!pu(t,i[e]))return 0;for(let e=0;e<this.planes.length;e++)if(!pu(t,this.planes[e]))return 0;for(const n of r)for(const i of this.frustumEdges){const r=e.Q.cross([],n,i),a=e.Q.length(r);if(0===a)continue;e.Q.scale(r,r,1/a);const o=hu(this.points,this.points[0],r),s=hu(t,this.points[0],r);if(o[0]>s[1]||s[0]>o[1])return 0}return 1}}class mu{static fromPoints(t){const i=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(const n of t)e.Q.min(i,i,n),e.Q.max(r,r,n);return new mu(i,r)}static fromTileIdAndHeight(e,t,i){const r=1<<e.canonical.z,n=e.canonical.x,a=e.canonical.y;return new mu([n/r,a/r,t],[(n+1)/r,(a+1)/r,i])}static applyTransform(t,i){const r=t.getCorners();for(let n=0;n<r.length;++n)e.Q.transformMat4(r[n],r[n],i);return mu.fromPoints(r)}static projectAabbCorners(t,i){const r=t.getCorners();for(let n=0;n<r.length;++n)e.Q.transformMat4(r[n],r[n],i);return r}constructor(t,i){this.min=t,this.max=i,this.center=e.Q.scale([],e.Q.add([],this.min,this.max),.5)}quadrant(t){const i=[t%2==0,t<2],r=e.Q.clone(this.min),n=e.Q.clone(this.max);for(let e=0;e<i.length;e++)r[e]=i[e]?this.min[e]:this.center[e],n[e]=i[e]?this.center[e]:this.max[e];return n[2]=this.max[2],new mu(r,n)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?uu(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?uu(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,t){return t||this.intersects(e)?du(e,this.getCorners()):0}intersectsPreciseFlat(e,t){return t||this.intersectsFlat(e)?du(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let t=0;t<3;++t)if(this.min[t]>e.max[t]||e.min[t]>this.max[t])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e.min[t]),this.max[t]=Math.max(this.max[t],e.max[t])}encapsulatePoint(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e[t]),this.max[t]=Math.max(this.max[t],e[t])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}fs(mu,"Aabb");const gu=Sl([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:_u}=gu,yu=Sl([{name:"a_pos_3",components:3,type:"Int16"}]);var vu=Sl([{name:"a_pos",type:"Int16",components:2}]);function xu(e){return e*Qc/nh}const bu=[new mu([eh,eh,eh],[th,th,th]),new mu([eh,eh,eh],[0,0,th]),new mu([0,eh,eh],[th,0,th]),new mu([eh,0,eh],[0,th,th]),new mu([0,0,eh],[th,th,th])];function wu(t,i,r){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const a=e.Q.scale([],t._camera.position,t.worldSize),o=[i,r,1,1];e.aa.transformMat4(o,o,t.pixelMatrixInverse),e.aa.scale(o,o,1/o[3]);const s=e.Q.sub([],o,a),l=e.Q.normalize([],s),c=t.globeMatrix,h=[c[12],c[13],c[14]],u=e.Q.sub([],h,a),d=e.Q.length(u),p=e.Q.normalize([],u),f=t.worldSize/(2*Math.PI),m=e.Q.dot(p,l),g=Math.asin(f/d);if(g<Math.acos(m)){if(!n)return null;const t=[],i=[];e.Q.scale(t,l,d/m),e.Q.normalize(i,e.Q.sub(i,t,u)),e.Q.normalize(l,e.Q.add(l,u,e.Q.scale(l,i,Math.tan(g)*d)))}const _=[];new lu(a,l).closestPointOnSphere(h,f,_);const y=e.Q.normalize([],Ei(c,0)),v=e.Q.normalize([],Ei(c,1)),x=e.Q.normalize([],Ei(c,2)),b=e.Q.dot(y,_),w=e.Q.dot(v,_),S=e.Q.dot(x,_),T=qt(Math.asin(-w/f));let E=qt(Math.atan2(b,S));E=t.center.lng+function(e,t){const i=(t-e+180)%360-180;return i<-180?i+360:i}(t.center.lng,E);const M=yh(E),A=Xt(vh(T),0,1);return new Ch(M,A)}class Su{constructor(t,i,r){this.a=e.Q.sub([],t,r),this.b=e.Q.sub([],i,r),this.center=r;const n=e.Q.normalize([],this.a),a=e.Q.normalize([],this.b);this.angle=Math.acos(e.Q.dot(n,a))}}function Tu(e,t){if(0===e.angle)return null;let i;return i=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),i<0||i>1?null:function(e,t,i,r){const n=Math.sin(i);return e*(Math.sin((1-r)*i)/n)+t*(Math.sin(r*i)/n)}(e.a[t],e.b[t],e.angle,Xt(i,0,1))+e.center[t]}function Eu(e){if(e.z<=1)return bu[e.z+2*e.y+e.x];const t=Iu(Cu(e));return mu.fromPoints(t)}function Mu(t,i,r){return e.Q.scale(t,t,1-r),e.Q.scaleAndAdd(t,t,i,r)}function Au(t,i,r){for(const n of t)e.Q.transformMat4(n,n,i),e.Q.scale(n,n,r)}function Pu(t,i,r,n){const a=i/t.worldSize,o=t.globeMatrix;if(r.z<=1){const e=Eu(r).getCorners();return Au(e,o,a),mu.fromPoints(e)}const s=Cu(r,n),l=Iu(s,Qc+xu(t._tileCoverLift));Au(l,o,a);const c=Number.MAX_VALUE,h=[-c,-c,-c],u=[c,c,c];if(s.contains(t.center)){for(const t of l)e.Q.min(u,u,t),e.Q.max(h,h,t);h[2]=0;const i=t.point,r=[i.x*a,i.y*a,0];return e.Q.min(u,u,r),e.Q.max(h,h,r),new mu(u,h)}if(t._tileCoverLift>0){for(const t of l)e.Q.min(u,u,t),e.Q.max(h,h,t);return new mu(u,h)}const d=[o[12]*a,o[13]*a,o[14]*a],p=s.getCenter(),f=Xt(t.center.lat,-Th,Th),m=Xt(p.lat,-Th,Th),g=yh(t.center.lng),_=vh(f);let y=g-yh(p.lng);const v=_-vh(m);y>.5?y-=1:y<-.5&&(y+=1);let x=0;if(Math.abs(y)>Math.abs(v))x=y>=0?1:3;else{x=v>=0?0:2;const t=[o[4]*a,o[5]*a,o[6]*a],i=-Math.sin(Gt(v>=0?s.getSouth():s.getNorth()))*Qc;e.Q.scaleAndAdd(d,d,t,i)}const b=l[x],w=l[(x+1)%4],S=new Su(b,w,d),T=[Tu(S,0)||b[0],Tu(S,1)||b[1],Tu(S,2)||b[2]],E=Nu(t.zoom);if(E>0){const n=function(e,t,i,r,n){let{x:a,y:o,z:s}=e;const l=1/(1<<s);let c=a*l,h=c+l,u=o*l,d=u+l,p=0;const f=(c+h)/2-r;return f>.5?p=-1:f<-.5&&(p=1),c=((c+p)*t-(r*=t))*i+r,h=((h+p)*t-r)*i+r,u=(u*t-(n*=t))*i+n,d=(d*t-n)*i+n,[[c,d,0],[h,d,0],[h,u,0],[c,u,0]]}(r,i,t._pixelsPerMercatorPixel,g,_);for(let e=0;e<l.length;e++)Mu(l[e],n[e],E);const a=e.Q.add([],n[x],n[(x+1)%4]);e.Q.scale(a,a,.5),Mu(T,a,E)}for(const M of l)e.Q.min(u,u,M),e.Q.max(h,h,M);return u[2]=Math.min(b[2],w[2]),e.Q.min(u,u,T),e.Q.max(h,h,T),new mu(u,h)}function Cu(e){let{x:t,y:i,z:r}=e,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const a=1/(1<<r),o=new oh(bh(t*a),i===(1<<r)-1&&n?-90:wh((i+1)*a)),s=new oh(bh((t+1)*a),0===i&&n?90:wh(i*a));return new sh(o,s)}function Iu(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Qc;const i=Gt(e.getNorth()),r=Gt(e.getSouth()),n=Math.cos(i),a=Math.cos(r),o=Math.sin(i),s=Math.sin(r),l=e.getWest(),c=e.getEast();return[ih(a,s,l,t),ih(a,s,c,t),ih(n,o,c,t),ih(n,o,l,t)]}function ku(e,t,i,r){const n=1<<i.z,a=(e/na+i.x)/n;return rh(wh((t/na+i.y)/n),bh(a),r)}function Du(e){let{min:t,max:i}=e;return Jc/Math.max(i[0]-t[0],i[1]-t[1],i[2]-t[2])}const Ru=new Float64Array(16);function Lu(t){const i=Du(t),r=e.a9.fromScaling(Ru,[i,i,i]);return e.a9.translate(r,r,e.Q.negate([],t.min))}function zu(t){const i=e.a9.fromTranslation(Ru,t.min),r=1/Du(t);return e.a9.scale(i,i,[r,r,r])}function Fu(e){const t=na/(2*Math.PI);return e/(2*Math.PI)/t}function Ou(e,t){return na/(512*Math.pow(2,e))*Du(Eu(t))}function Bu(t,i,r,n,a){const o=Fu(r),s=[t,i,-r/(2*Math.PI)],l=e.a9.identity(new Float64Array(16));return e.a9.translate(l,l,s),e.a9.scale(l,l,[o,o,o]),e.a9.rotateX(l,l,Gt(-a)),e.a9.rotateY(l,l,Gt(-n)),l}function Nu(e){return Yt(Xc,Yc,e)}function Vu(t,i){const r=rh(i.lat,i.lng),n=function(t){const i=rh(t._center.lat,t._center.lng),r=e.Q.fromValues(0,1,0);let n=e.Q.cross([],r,i);const a=e.a9.fromRotation([],-t.angle,i);n=e.Q.transformMat4(n,n,a),e.a9.fromRotation(a,-t._pitch,n);const o=e.Q.normalize([],i);return e.Q.scale(o,o,xu(t.cameraToCenterDistance/t.pixelsPerMeter)),e.Q.transformMat4(o,o,a),e.Q.add([],i,o)}(t),a=e.Q.subtract([],n,r);return e.Q.angle(a,r)}function ju(e,t){return Vu(e,t)>Math.PI/2*1.01}const Uu=Gt(85),Gu=Math.cos(Uu),qu=Math.sin(Uu),Hu=e.a9.create(),Wu=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t};function Zu(t,i,r,n,a,o,s,l,c){if(o&&t.queryGeometry.isAboveHorizon)return!1;o&&(c*=t.pixelToTileUnitsFactor);const h=t.tileID.canonical,u=r.projection.upVectorScale(h,r.center.lat,r.worldSize).metersToTile;for(const d of i)for(const i of d){const d=i.add(l),p=a&&r.elevation?r.elevation.exaggeration()*a.getElevationAt(d.x,d.y,!0):0,f=r.projection.projectTilePoint(d.x,d.y,h);if(p>0){const e=r.projection.upVector(h,d.x,d.y);f.x+=e[0]*u*p,f.y+=e[1]*u*p,f.z+=e[2]*u*p}const m=o?d:Qu(f.x,f.y,f.z,n),g=o?t.tilespaceRays.map((e=>Ju(e,p))):t.queryGeometry.screenGeometry,_=e.aa.transformMat4([],[f.x,f.y,f.z,1],n);if(!s&&o?c*=_[3]/r.cameraToCenterDistance:s&&!o&&(c*=r.cameraToCenterDistance/_[3]),o){const e=wh((i.y/na+h.y)/(1<<h.z));c/=r.projection.pixelsPerMeter(e,1)/xh(1,e)}if(Gh(g,m,c))return!0}return!1}function Qu(t,i,r,n){const a=e.aa.transformMat4([],[t,i,r,1],n);return new Vt(a[0]/a[3],a[1]/a[3])}const Xu=e.Q.fromValues(0,0,0),Yu=e.Q.fromValues(0,0,1);function Ju(t,i){const r=e.Q.create();return Xu[2]=i,t.intersectsPlane(Xu,Yu,r),new Vt(r[0],r[1])}class Ku extends jh{}function $u(e,t,i,r){let{width:n,height:a}=t;if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==n*a*i)throw new RangeError("mismatched image size")}else r=new Uint8Array(n*a*i);return e.width=n,e.height=a,e.data=r,e}function ed(e,t,i){const{width:r,height:n}=t;r===e.width&&n===e.height||(td(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,r),height:Math.min(e.height,n)},i),e.width=r,e.height=n,e.data=t.data)}function td(e,t,i,r,n,a,o){if(0===n.width||0===n.height)return t;if(n.width>e.width||n.height>e.height||i.x>e.width-n.width||i.y>e.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>t.width||n.height>t.height||r.x>t.width-n.width||r.y>t.height-n.height)throw new RangeError("out of range destination coordinates for image copy");const s=e.data,l=t.data,c=4===a&&o;for(let h=0;h<n.height;h++){const o=((i.y+h)*e.width+i.x)*a,u=((r.y+h)*t.width+r.x)*a;if(c)for(let e=0;e<n.width;e++){const t=o+e*a+3,i=u+e*a;l[i+0]=255,l[i+1]=255,l[i+2]=255,l[i+3]=s[t]}else for(let e=0;e<n.width*a;e++)l[u+e]=s[o+e]}return t}fs(Ku,"HeatmapBucket",{omit:["layers"]});class id{constructor(e,t){$u(this,e,1,t)}resize(e){ed(this,new id(e),1)}clone(){return new id({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,r,n){td(e,t,i,r,n,1)}}class rd{constructor(e,t){$u(this,e,4,t)}resize(e){ed(this,new rd(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new rd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,i,r,n,a){td(e,t,i,r,n,4,a)}}class nd{constructor(e,t){this.width=e.width,this.height=e.height,this.data=t instanceof Uint8Array?new Float32Array(t.buffer):t}}fs(id,"AlphaImage"),fs(rd,"RGBAImage");const ad=new Ks({visibility:new Xs(tl.layout_heatmap.visibility)});var od={paint:new Ks({"heatmap-radius":new Ys(tl.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ys(tl.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Xs(tl.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Js(tl.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Xs(tl.paint_heatmap["heatmap-opacity"])}),layout:ad};function sd(e){const t={},i=e.resolution||256,r=e.clips?e.clips.length:1,n=e.image||new rd({width:i,height:r}),a=(i,r,a)=>{t[e.evaluationKey]=a;const o=e.expression.evaluate(t);o&&(n.data[i+r+0]=Math.floor(255*o.r/o.a),n.data[i+r+1]=Math.floor(255*o.g/o.a),n.data[i+r+2]=Math.floor(255*o.b/o.a),n.data[i+r+3]=Math.floor(255*o.a))};if(e.clips)for(let o=0,s=0;o<r;++o,s+=4*i)for(let t=0,r=0;t<i;t++,r+=4){const n=t/(i-1),{start:l,end:c}=e.clips[o];a(s,r,l*(1-n)+c*n)}else for(let o=0,s=0;o<i;o++,s+=4)a(0,s,o/(i-1));return n}const ld=new Ks({visibility:new Xs(tl.layout_hillshade.visibility)});var cd={paint:new Ks({"hillshade-illumination-direction":new Xs(tl.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Xs(tl.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Xs(tl.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Xs(tl.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Xs(tl.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Xs(tl.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Xs(tl.paint_hillshade["hillshade-emissive-strength"])}),layout:ld};const hd=Sl([{name:"a_pos",components:2,type:"Int16"}],4),{members:ud}=hd;var dd={exports:{}};function pd(e,t,i){i=i||2;var r,n,a,o,s,l,c,h=t&&t.length,u=h?t[0]*i:e.length,d=fd(e,0,u,i,!0),p=[];if(!d||d.next===d.prev)return p;if(h&&(d=function(e,t,i,r){var n,a,o,s=[];for(n=0,a=t.length;n<a;n++)(o=fd(e,t[n]*r,n<a-1?t[n+1]*r:e.length,r,!1))===o.next&&(o.steiner=!0),s.push(Ed(o));for(s.sort(bd),n=0;n<s.length;n++)i=wd(s[n],i);return i}(e,t,d,i)),e.length>80*i){r=a=e[0],n=o=e[1];for(var f=i;f<u;f+=i)(s=e[f])<r&&(r=s),(l=e[f+1])<n&&(n=l),s>a&&(a=s),l>o&&(o=l);c=0!==(c=Math.max(a-r,o-n))?32767/c:0}return gd(d,p,i,r,n,c,0),p}function fd(e,t,i,r,n){var a,o;if(n===Bd(e,t,i,r)>0)for(a=t;a<i;a+=r)o=zd(a,e[a],e[a+1],o);else for(a=i-r;a>=t;a-=r)o=zd(a,e[a],e[a+1],o);return o&&Cd(o,o.next)&&(Fd(o),o=o.next),o}function md(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!Cd(r,r.next)&&0!==Pd(r.prev,r,r.next))r=r.next;else{if(Fd(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function gd(e,t,i,r,n,a,o){if(e){!o&&a&&function(e,t,i,r){var n=e;do{0===n.z&&(n.z=Td(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,r,n,a,o,s,l,c=1;do{for(i=e,e=null,a=null,o=0;i;){for(o++,r=i,s=0,t=0;t<c&&(s++,r=r.nextZ);t++);for(l=c;s>0||l>0&&r;)0!==s&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,s--):(n=r,r=r.nextZ,l--),a?a.nextZ=n:e=n,n.prevZ=a,a=n;i=r}a.nextZ=null,c*=2}while(o>1)}(n)}(e,r,n,a);for(var s,l,c=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?yd(e,r,n,a):_d(e))t.push(s.i/i|0),t.push(e.i/i|0),t.push(l.i/i|0),Fd(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?gd(e=vd(md(e),t,i),t,i,r,n,a,2):2===o&&xd(e,t,i,r,n,a):gd(md(e),t,i,r,n,a,1);break}}}function _d(e){var t=e.prev,i=e,r=e.next;if(Pd(t,i,r)>=0)return!1;for(var n=t.x,a=i.x,o=r.x,s=t.y,l=i.y,c=r.y,h=n<a?n<o?n:o:a<o?a:o,u=s<l?s<c?s:c:l<c?l:c,d=n>a?n>o?n:o:a>o?a:o,p=s>l?s>c?s:c:l>c?l:c,f=r.next;f!==t;){if(f.x>=h&&f.x<=d&&f.y>=u&&f.y<=p&&Md(n,s,a,l,o,c,f.x,f.y)&&Pd(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function yd(e,t,i,r){var n=e.prev,a=e,o=e.next;if(Pd(n,a,o)>=0)return!1;for(var s=n.x,l=a.x,c=o.x,h=n.y,u=a.y,d=o.y,p=s<l?s<c?s:c:l<c?l:c,f=h<u?h<d?h:d:u<d?u:d,m=s>l?s>c?s:c:l>c?l:c,g=h>u?h>d?h:d:u>d?u:d,_=Td(p,f,t,i,r),y=Td(m,g,t,i,r),v=e.prevZ,x=e.nextZ;v&&v.z>=_&&x&&x.z<=y;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==n&&v!==o&&Md(s,h,l,u,c,d,v.x,v.y)&&Pd(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==n&&x!==o&&Md(s,h,l,u,c,d,x.x,x.y)&&Pd(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;v&&v.z>=_;){if(v.x>=p&&v.x<=m&&v.y>=f&&v.y<=g&&v!==n&&v!==o&&Md(s,h,l,u,c,d,v.x,v.y)&&Pd(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=y;){if(x.x>=p&&x.x<=m&&x.y>=f&&x.y<=g&&x!==n&&x!==o&&Md(s,h,l,u,c,d,x.x,x.y)&&Pd(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function vd(e,t,i){var r=e;do{var n=r.prev,a=r.next.next;!Cd(n,a)&&Id(n,r,r.next,a)&&Rd(n,a)&&Rd(a,n)&&(t.push(n.i/i|0),t.push(r.i/i|0),t.push(a.i/i|0),Fd(r),Fd(r.next),r=e=a),r=r.next}while(r!==e);return md(r)}function xd(e,t,i,r,n,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&Ad(o,s)){var l=Ld(o,s);return o=md(o,o.next),l=md(l,l.next),gd(o,t,i,r,n,a,0),void gd(l,t,i,r,n,a,0)}s=s.next}o=o.next}while(o!==e)}function bd(e,t){return e.x-t.x}function wd(e,t){var i=function(e,t){var i,r=t,n=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=n&&s>o&&(o=s,i=r.x<r.next.x?r:r.next,s===n))return i}r=r.next}while(r!==t);if(!i)return null;var l,c=i,h=i.x,u=i.y,d=1/0;r=i;do{n>=r.x&&r.x>=h&&n!==r.x&&Md(a<u?n:o,a,h,u,a<u?o:n,a,r.x,r.y)&&(l=Math.abs(a-r.y)/(n-r.x),Rd(r,e)&&(l<d||l===d&&(r.x>i.x||r.x===i.x&&Sd(i,r)))&&(i=r,d=l)),r=r.next}while(r!==c);return i}(e,t);if(!i)return t;var r=Ld(i,e);return md(r,r.next),md(i,i.next)}function Sd(e,t){return Pd(e.prev,e,t.prev)<0&&Pd(t.next,e,e.next)<0}function Td(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*n|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ed(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function Md(e,t,i,r,n,a,o,s){return(n-o)*(t-s)>=(e-o)*(a-s)&&(e-o)*(r-s)>=(i-o)*(t-s)&&(i-o)*(a-s)>=(n-o)*(r-s)}function Ad(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&Id(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(Rd(e,t)&&Rd(t,e)&&function(e,t){var i=e,r=!1,n=(e.x+t.x)/2,a=(e.y+t.y)/2;do{i.y>a!=i.next.y>a&&i.next.y!==i.y&&n<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(Pd(e.prev,e,t.prev)||Pd(e,t.prev,t))||Cd(e,t)&&Pd(e.prev,e,e.next)>0&&Pd(t.prev,t,t.next)>0)}function Pd(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function Cd(e,t){return e.x===t.x&&e.y===t.y}function Id(e,t,i,r){var n=Dd(Pd(e,t,i)),a=Dd(Pd(e,t,r)),o=Dd(Pd(i,r,e)),s=Dd(Pd(i,r,t));return n!==a&&o!==s||!(0!==n||!kd(e,i,t))||!(0!==a||!kd(e,r,t))||!(0!==o||!kd(i,e,r))||!(0!==s||!kd(i,t,r))}function kd(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Dd(e){return e>0?1:e<0?-1:0}function Rd(e,t){return Pd(e.prev,e,e.next)<0?Pd(e,t,e.next)>=0&&Pd(e,e.prev,t)>=0:Pd(e,t,e.prev)<0||Pd(e,e.next,t)<0}function Ld(e,t){var i=new Od(e.i,e.x,e.y),r=new Od(t.i,t.x,t.y),n=e.next,a=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,a.next=r,r.prev=a,r}function zd(e,t,i,r){var n=new Od(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function Fd(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Od(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Bd(e,t,i,r){for(var n=0,a=t,o=i-r;a<i;a+=r)n+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return n}dd.exports=pd,dd.exports.default=pd,pd.deviation=function(e,t,i,r){var n=t&&t.length,a=Math.abs(Bd(e,0,n?t[0]*i:e.length,i));if(n)for(var o=0,s=t.length;o<s;o++)a-=Math.abs(Bd(e,t[o]*i,o<s-1?t[o+1]*i:e.length,i));var l=0;for(o=0;o<r.length;o+=3){var c=r[o]*i,h=r[o+1]*i,u=r[o+2]*i;l+=Math.abs((e[c]-e[u])*(e[h+1]-e[c+1])-(e[c]-e[h])*(e[u+1]-e[c+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},pd.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var a=0;a<e[n].length;a++)for(var o=0;o<t;o++)i.vertices.push(e[n][a][o]);n>0&&i.holes.push(r+=e[n-1].length)}return i};var Nd=u(dd.exports);function Vd(e,t){const i=e.length;if(i<=1)return[e];const r=[];let n,a;for(let o=0;o<i;o++){const t=pi(e[o]);0!==t&&(e[o].area=Math.abs(t),void 0===a&&(a=t<0),a===t<0?(n&&r.push(n),n=[e[o]]):n.push(e[o]))}if(n&&r.push(n),t>1)for(let o=0;o<r.length;o++)r[o].length<=t||(Ln(r[o],t,1,r[o].length-1,jd),r[o]=r[o].slice(0,t));return r}function jd(e,t){return t.area-e.area}function Ud(e,t,i){const r=i.patternDependencies;let n=!1;for(const a of t){const t=a.paint.get("".concat(e,"-pattern"));t.isConstant()||(n=!0);const i=t.constantOr(null);i&&(n=!0,r[i]=!0)}return n}function Gd(e,t,i,r,n){const a=n.patternDependencies;for(const o of t){const t=o.paint.get("".concat(e,"-pattern")).value;if("constant"!==t.kind){let e=t.evaluate({zoom:r},i,{},n.availableImages);e=e&&e.name?e.name:e,a[e]=!0,i.patterns[o.id]=e}}return i}class qd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new El,this.indexArray=new Gl,this.indexArray2=new Bl,this.programConfigurations=new Uc(e.layers,e.zoom),this.segments=new mc,this.segments2=new mc,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.projection=e.projection}populate(e,t,i,r){this.hasPattern=Ud("fill",this.layers,t);const n=this.layers[0].layout.get("fill-sort-key"),a=[];for(const{feature:o,id:s,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,h=Bh(o,e);if(!this.layers[0]._featureFilter.filter(new Vs(this.zoom),h,i))continue;const u=n?n.evaluate(h,{},i,t.availableImages):void 0,d={id:s,properties:o.properties,type:o.type,sourceLayerIndex:c,index:l,geometry:e?h.geometry:Oh(o,i,r),patterns:{},sortKey:u};a.push(d)}n&&a.sort(((e,t)=>e.sortKey-t.sortKey));for(const o of a){const{geometry:r,index:n,sourceLayerIndex:a}=o;if(this.hasPattern){const e=Gd("fill",this.layers,o,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(o,r,n,i,{},t.availableImages,t.brightness);t.featureIndex.insert(e[n].feature,r,n,a,this.index)}}update(e,t,i,r,n){const a=0!==Object.keys(e).length;a&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,a?this.stateDependentLayers:this.layers,i,r,n)}addFeatures(e,t,i,r,n,a){for(const o of this.patternFeatures)this.addFeature(o,o.geometry,o.index,t,i,r,a)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ud),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,i,r,n){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],o=arguments.length>6?arguments[6]:void 0;for(const s of Vd(t,500)){let e=0;for(const o of s)e+=o.length;const t=this.segments.prepareSegment(e,this.layoutVertexArray,this.indexArray),i=t.vertexLength,r=[],n=[];for(const o of s){if(0===o.length)continue;o!==s[0]&&n.push(r.length/2);const e=this.segments2.prepareSegment(o.length,this.layoutVertexArray,this.indexArray2),t=e.vertexLength;this.layoutVertexArray.emplaceBack(o[0].x,o[0].y),this.indexArray2.emplaceBack(t+o.length-1,t),r.push(o[0].x),r.push(o[0].y);for(let i=1;i<o.length;i++)this.layoutVertexArray.emplaceBack(o[i].x,o[i].y),this.indexArray2.emplaceBack(t+i-1,t+i),r.push(o[i].x),r.push(o[i].y);e.vertexLength+=o.length,e.primitiveLength+=o.length}const a=Nd(r,n);for(let o=0;o<a.length;o+=3)this.indexArray.emplaceBack(i+a[o],i+a[o+1],i+a[o+2]);t.vertexLength+=e,t.primitiveLength+=a.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,n,a,r,o)}}fs(qd,"FillBucket",{omit:["layers","patternFeatures"]});const Hd=new Ks({"fill-sort-key":new Ys(tl.layout_fill["fill-sort-key"]),visibility:new Xs(tl.layout_fill.visibility)});var Wd={paint:new Ks({"fill-antialias":new Xs(tl.paint_fill["fill-antialias"]),"fill-opacity":new Ys(tl.paint_fill["fill-opacity"]),"fill-color":new Ys(tl.paint_fill["fill-color"]),"fill-outline-color":new Ys(tl.paint_fill["fill-outline-color"]),"fill-translate":new Xs(tl.paint_fill["fill-translate"]),"fill-translate-anchor":new Xs(tl.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ys(tl.paint_fill["fill-pattern"]),"fill-emissive-strength":new Xs(tl.paint_fill["fill-emissive-strength"])}),layout:Hd};const Zd=Sl([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Qd=Sl([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Xd=Sl([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Yd=Sl([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Jd=Sl([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Kd}=Zd;var $d={},ep=Bt,tp=ip;function ip(e,t,i,r,n){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=n,e.readFields(rp,this,t)}function rp(e,t,i){1==e?t.id=i.readVarint():2==e?function(e,t){for(var i=e.readVarint()+e.pos;e.pos<i;){var r=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[r]=n}}(i,t):3==e?t.type=i.readVarint():4==e&&(t._geometry=i.pos)}function np(e){for(var t,i,r=0,n=0,a=e.length,o=a-1;n<a;o=n++)r+=((i=e[o]).x-(t=e[n]).x)*(t.y+i.y);return r}ip.types=["Unknown","Point","LineString","Polygon"],ip.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,i=e.readVarint()+e.pos,r=1,n=0,a=0,o=0,s=[];e.pos<i;){if(n<=0){var l=e.readVarint();r=7&l,n=l>>3}if(n--,1===r||2===r)a+=e.readSVarint(),o+=e.readSVarint(),1===r&&(t&&s.push(t),t=[]),t.push(new ep(a,o));else{if(7!==r)throw new Error("unknown command "+r);t&&t.push(t[0].clone())}}return t&&s.push(t),s},ip.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,r=0,n=0,a=0,o=1/0,s=-1/0,l=1/0,c=-1/0;e.pos<t;){if(r<=0){var h=e.readVarint();i=7&h,r=h>>3}if(r--,1===i||2===i)(n+=e.readSVarint())<o&&(o=n),n>s&&(s=n),(a+=e.readSVarint())<l&&(l=a),a>c&&(c=a);else if(7!==i)throw new Error("unknown command "+i)}return[o,l,s,c]},ip.prototype.toGeoJSON=function(e,t,i){var r,n,a=this.extent*Math.pow(2,i),o=this.extent*e,s=this.extent*t,l=this.loadGeometry(),c=ip.types[this.type];function h(e){for(var t=0;t<e.length;t++){var i=e[t];e[t]=[360*(i.x+o)/a-180,360/Math.PI*Math.atan(Math.exp((180-360*(i.y+s)/a)*Math.PI/180))-90]}}switch(this.type){case 1:var u=[];for(r=0;r<l.length;r++)u[r]=l[r][0];h(l=u);break;case 2:for(r=0;r<l.length;r++)h(l[r]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var i,r,n=[],a=0;a<t;a++){var o=np(e[a]);0!==o&&(void 0===r&&(r=o<0),r===o<0?(i&&n.push(i),i=[e[a]]):i.push(e[a]))}return i&&n.push(i),n}(l),r=0;r<l.length;r++)for(n=0;n<l[r].length;n++)h(l[r][n])}1===l.length?l=l[0]:c="Multi"+c;var d={type:"Feature",geometry:{type:c,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d};var ap=tp,op=sp;function sp(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(lp,this,t),this.length=this._features.length}function lp(e,t,i){15===e?t.version=i.readVarint():1===e?t.name=i.readString():5===e?t.extent=i.readVarint():2===e?t._features.push(i.pos):3===e?t._keys.push(i.readString()):4===e&&t._values.push(function(e){for(var t=null,i=e.readVarint()+e.pos;e.pos<i;){var r=e.readVarint()>>3;t=1===r?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null}return t}(i))}sp.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new ap(this._pbf,t,this.extent,this._keys,this._values)};var cp=op;function hp(e,t,i){if(3===e){var r=new cp(i,i.readVarint()+i.pos);r.length&&(t[r.name]=r)}}var up=$d.VectorTile=function(e,t){this.layers=e.readFields(hp,{},t)},dp=$d.VectorTileFeature=tp;function pp(e,t,i,r){const n=[],a=0===r?(e,t,i,r,n,a)=>{e.push(new Vt(a,i+(a-t)/(r-t)*(n-i)))}:(e,t,i,r,n,a)=>{e.push(new Vt(t+(a-i)/(n-i)*(r-t),a))};for(const o of e){const e=[];for(const n of o){if(n.length<=2)continue;const o=[];for(let e=0;e<n.length-1;e++){const s=n[e].x,l=n[e].y,c=n[e+1].x,h=n[e+1].y,u=0===r?s:l,d=0===r?c:h;u<t?d>t&&a(o,s,l,c,h,t):u>i?d<i&&a(o,s,l,c,h,i):o.push(n[e]),d<t&&u>=t&&a(o,s,l,c,h,t),d>i&&u<=i&&a(o,s,l,c,h,i)}let s=n[n.length-1];const l=0===r?s.x:s.y;l>=t&&l<=i&&o.push(s),o.length&&(s=o[o.length-1],o[0].x===s.x&&o[0].y===s.y||o.push(o[0]),e.push(o))}e.length&&n.push(e)}return n}function fp(e,t){return e.x-t.x||e.y-t.y}function mp(e,t){return 0===fp(e.min,t.min)&&0===fp(e.max,t.max)}function gp(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function _p(e,t,i){const r=1/na,n=1/(1<<i.canonical.z),a=(t.x*r+i.canonical.x)*n+i.wrap,o=(t.y*r+i.canonical.y)*n;return{min:new Vt((e.x*r+i.canonical.x)*n+i.wrap,(e.y*r+i.canonical.y)*n),max:new Vt(a,o)}}function yp(e,t,i){const r=1<<i.canonical.z,n=((t.x-i.wrap)*r-i.canonical.x)*na,a=(t.y*r-i.canonical.y)*na;return{min:new Vt(((e.x-i.wrap)*r-i.canonical.x)*na,(e.y*r-i.canonical.y)*na),max:new Vt(n,a)}}function vp(e,t,i,r,n,a,o){const s=e.indices,l=e.vertices,c=[];for(let h=r;h<r+n;h+=3){const r=t[i[h+0]+a],n=t[i[h+1]+a],u=t[i[h+2]+a],d=Math.min(r.x,n.x,u.x),p=Math.max(r.x,n.x,u.x),f=Math.min(r.y,n.y,u.y),m=Math.max(r.y,n.y,u.y);c.length=0,e.grid.query(new Vt(d,f),new Vt(p,m),c);for(let e=0;e<c.length;e++){const t=c[e];if(tu(l[s[3*t+0]],l[s[3*t+1]],l[s[3*t+2]],r,n,u,o))return!0}}return!1}function xp(e,t,i,r){if(!e||!i)return!1;let n=e.vertices;if(!t.canonical.equals(r.canonical)||t.wrap!==r.wrap){if(i.vertices.length<e.vertices.length)return xp(i,r,e,t);const a=t.canonical,o=r.canonical,s=Math.pow(2,o.z-a.z);n=e.vertices.map((e=>new Vt((e.x+a.x*na)*s-o.x*na,(e.y+a.y*na)*s-o.y*na)))}return vp(i,n,e.indices,0,e.indices.length,0,0)}$d.VectorTileLayer=op;class bp{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const i=this.toIdx(e,t);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function wp(e,t,i,r){let n=0,a=Number.MAX_VALUE;for(let o=0;o<3;o++)if(Math.abs(r[o])<1e-15){if(i[o]<e[o]||i[o]>t[o])return null}else{const s=1/r[o];let l=(e[o]-i[o])*s,c=(t[o]-i[o])*s;if(l>c){const e=l;l=c,c=e}if(l>n&&(n=l),c<a&&(a=c),n>a)return null}return n}function Sp(e,t,i,r,n,a,o,s,l,c,h){const u=r-e,d=n-t,p=a-i,f=o-e,m=s-t,g=l-i,_=h[1]*g-h[2]*m,y=h[2]*f-h[0]*g,v=h[0]*m-h[1]*f,x=u*_+d*y+p*v;if(Math.abs(x)<1e-15)return null;const b=1/x,w=c[0]-e,S=c[1]-t,T=c[2]-i,E=(w*_+S*y+T*v)*b;if(E<0||E>1)return null;const M=S*p-T*d,A=T*u-w*p,P=w*d-S*u,C=(h[0]*M+h[1]*A+h[2]*P)*b;return C<0||E+C>1?null:(f*M+m*A+g*P)*b}function Tp(e,t,i){return(e-t)/(i-t)}function Ep(e,t,i,r,n,a,o,s,l){const c=1<<i,h=a-r,u=o-n,d=(e+1)/c*h+r,p=(t+0)/c*u+n,f=(t+1)/c*u+n;s[0]=(e+0)/c*h+r,s[1]=p,l[0]=d,l[1]=f}class Mp{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),i=[];let r=Math.ceil(Math.pow(2,t));const n=1/r,a=(e,t,i,r,n)=>{const a=r?1:0,o=(e+1)*i-a,s=t*i,l=(t+1)*i-a;n[0]=e*i,n[1]=s,n[2]=o,n[3]=l};let o=new bp(r);const s=[];for(let l=0;l<r*r;l++){a(l%r,Math.floor(l/r),n,!1,s);const t=Pp(s[0],s[1],e),i=Pp(s[2],s[1],e),c=Pp(s[2],s[3],e),h=Pp(s[0],s[3],e);o.minimums.push(Math.min(t,i,c,h)),o.maximums.push(Math.max(t,i,c,h)),o.leaves.push(1)}for(i.push(o),r/=2;r>=1;r/=2){const e=i[i.length-1];o=new bp(r);for(let t=0;t<r*r;t++){a(t%r,Math.floor(t/r),2,!0,s);const i=e.getElevation(s[0],s[1]),n=e.getElevation(s[2],s[1]),l=e.getElevation(s[2],s[3]),c=e.getElevation(s[0],s[3]),h=e.isLeaf(s[0],s[1]),u=e.isLeaf(s[2],s[1]),d=e.isLeaf(s[2],s[3]),p=e.isLeaf(s[0],s[3]),f=Math.min(i.min,n.min,l.min,c.min),m=Math.max(i.max,n.max,l.max,c.max),g=h&&u&&d&&p;o.maximums.push(m),o.minimums.push(f),o.leaves.push(m-f<=5&&g?1:0)}i.push(o)}return i}(this.dem),i=t.length-1,r=t[i];this._addNode(r.minimums[0],r.maximums[0],r.leaves[0]),this._construct(t,0,0,i,0)}raycastRoot(e,t,i,r,n,a){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return wp([e,t,-100],[i,r,this.maximums[0]*o],n,a)}raycast(t,i,r,n,a,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(!this.nodeCount)return null;const l=this.raycastRoot(t,i,r,n,a,o,s);if(null==l)return null;const c=[],h=[],u=[],d=[],p=[{idx:0,t:l,nodex:0,nodey:0,depth:0}];for(;p.length>0;){const{idx:l,t:f,nodex:m,nodey:g,depth:_}=p.pop();if(this.leaves[l]){Ep(m,g,_,t,i,r,n,u,d);const l=1<<_,c=(m+0)/l,h=(m+1)/l,p=(g+0)/l,y=(g+1)/l,v=Pp(c,p,this.dem)*s,x=Pp(h,p,this.dem)*s,b=Pp(h,y,this.dem)*s,w=Pp(c,y,this.dem)*s,S=Sp(u[0],u[1],v,d[0],u[1],x,d[0],d[1],b,a,o),T=Sp(d[0],d[1],b,u[0],d[1],w,u[0],u[1],v,a,o),E=Math.min(null!==S?S:Number.MAX_VALUE,null!==T?T:Number.MAX_VALUE);if(E!==Number.MAX_VALUE)return E;{const t=e.Q.scaleAndAdd([],a,o,f);if(Ap(v,x,w,b,Tp(t[0],u[0],d[0]),Tp(t[1],u[1],d[1]))>=t[2])return f}continue}let y=0;for(let e=0;e<this._siblingOffset.length;e++){Ep((m<<1)+this._siblingOffset[e][0],(g<<1)+this._siblingOffset[e][1],_+1,t,i,r,n,u,d),u[2]=-100,d[2]=this.maximums[this.childOffsets[l]+e]*s;const p=wp(u,d,a,o);if(null!=p){const t=p;c[e]=t;let i=!1;for(let r=0;r<y&&!i;r++)t>=c[h[r]]&&(h.splice(r,0,e),i=!0);i||(h[y]=e),y++}}for(let e=0;e<y;e++){const t=h[e];p.push({idx:this.childOffsets[l]+t,t:c[t],nodex:(m<<1)+this._siblingOffset[t][0],nodey:(g<<1)+this._siblingOffset[t][1],depth:_+1})}}return null}_addNode(e,t,i){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,i,r,n){if(1===e[r].isLeaf(t,i))return;this.childOffsets[n]||(this.childOffsets[n]=this.nodeCount);const a=r-1,o=e[a];let s=0,l=0;for(let c=0;c<this._siblingOffset.length;c++){const e=2*t+this._siblingOffset[c][0],r=2*i+this._siblingOffset[c][1],n=o.getElevation(e,r),a=o.isLeaf(e,r),h=this._addNode(n.min,n.max,a);a&&(s|=1<<c),l||(l=h)}for(let c=0;c<this._siblingOffset.length;c++)s&1<<c||this._construct(e,2*t+this._siblingOffset[c][0],2*i+this._siblingOffset[c][1],a,l+c)}}function Ap(e,t,i,r,n,a){return Ur(Ur(e,i,a),Ur(t,r,a),n)}function Pp(e,t,i){const r=i.dim,n=Xt(e*r-.5,0,r-1),a=Xt(t*r-.5,0,r-1),o=Math.floor(n),s=Math.floor(a),l=Math.min(o+1,r-1),c=Math.min(s+1,r-1);return Ap(i.get(o,s),i.get(l,s),i.get(o,c),i.get(l,c),n-o,a-s)}const Cp={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Ip(e,t,i){return(256*e*256+256*t+i)/10-1e4}function kp(e,t,i){return 256*e+t+i/256-32768}class Dp{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(i&&"mapbox"!==i&&"terrarium"!==i)return ui('"'.concat(i,'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".'));this.stride=t.height;const n=this.dim=t.height-2,a=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.floatView=new Float32Array(t.data.buffer),this.borderReady=r,this._modifiedForSources={},!r){for(let e=0;e<n;e++)a[this._idx(-1,e)]=a[this._idx(0,e)],a[this._idx(n,e)]=a[this._idx(n-1,e)],a[this._idx(e,-1)]=a[this._idx(e,0)],a[this._idx(e,n)]=a[this._idx(e,n-1)];a[this._idx(-1,-1)]=a[this._idx(0,0)],a[this._idx(n,-1)]=a[this._idx(n-1,0)],a[this._idx(-1,n)]=a[this._idx(0,n-1)],a[this._idx(n,n)]=a[this._idx(n-1,n-1)]}const o="terrarium"===i?kp:Ip;for(let s=0;s<a.length;++s){const e=4*s;this.floatView[s]=o(this.pixels[e],this.pixels[e+1],this.pixels[e+2])}this._timestamp=ki.now()}_buildQuadTree(){this._tree=new Mp(this)}get(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&(e=Xt(e,-1,this.dim),t=Xt(t,-1,this.dim));const i=this._idx(e,t);return this.floatView[i]}set(e,t,i){const r=this._idx(e,t),n=this.floatView[r];return this.floatView[r]=i,i-n}static getUnpackVector(e){return Cp[e]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}static pack(e,t){const i=[0,0,0,0],r=Dp.getUnpackVector(t);let n=Math.floor((e+r[3])/r[2]);return i[2]=n%256,n=Math.floor(n/256),i[1]=n%256,n=Math.floor(n/256),i[0]=n,i}getPixels(){return new nd({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,i){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let r=t*this.dim,n=t*this.dim+this.dim,a=i*this.dim,o=i*this.dim+this.dim;switch(t){case-1:r=n-1;break;case 1:n=r+1}switch(i){case-1:a=o-1;break;case 1:o=a+1}const s=-t*this.dim,l=-i*this.dim;for(let c=a;c<o;c++)for(let t=r;t<n;t++){const i=4*this._idx(t,c),r=4*this._idx(t+s,c+l);this.pixels[i+0]=e.pixels[r+0],this.pixels[i+1]=e.pixels[r+1],this.pixels[i+2]=e.pixels[r+2],this.pixels[i+3]=e.pixels[r+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}fs(Dp,"DEMData"),fs(Mp,"DemMinMaxQuadTree",{omit:["dem"]});class Rp{constructor(e,t,i){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=i}static create(e,t,i){const r=i||e.findDEMTileFor(t);if(!r||!r.dem)return;const n=r.dem,a=r.tileID,o=1<<t.canonical.z-a.canonical.z;return new Rp(r,n.dim/na/o,[(t.canonical.x/o-a.canonical.x)*n.dim,(t.canonical.y/o-a.canonical.y)*n.dim])}tileCoordToPixel(e,t){const i=t*this._scale+this._offset[1],r=Math.floor(e*this._scale+this._offset[0]),n=Math.floor(i);return new Vt(r,n)}getElevationAt(e,t,i,r){const n=e*this._scale+this._offset[0],a=t*this._scale+this._offset[1],o=Math.floor(n),s=Math.floor(a),l=this._dem;return r=!!r,i?Ur(Ur(l.get(o,s,r),l.get(o,s+1,r),a-s),Ur(l.get(o+1,s,r),l.get(o+1,s+1,r),a-s),n-o):l.get(o,s,r)}getElevationAtPixel(e,t,i){return this._dem.get(e,t,!!i)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*xh(1,e)*this._dem.stride}}const Lp=dp.types,zp=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],Fp=["fill-extrusion-flood-light-ground-radius"],Op=Math.pow(2,13),Bp=Math.pow(2,15)-1,Np=new Vt(0,1),Vp=2147483648;function jp(e,t,i,r,n,a,o,s){e.emplaceBack((t<<1)+o,(i<<1)+a,(Math.floor(r*Op)<<1)+n,Math.round(s))}function Up(e,t,i,r,n,a){e.emplaceBack(t.x,t.y,(i.x<<1)+r,(i.y<<1)+n,a)}function Gp(e,t,i){const r=16384;e.emplaceBack(t.x,t.y,t.z,i[0]*r,i[1]*r,i[2]*r)}class qp{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Hp{constructor(){this.centroidXY=new Vt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Vt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Vt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Vt(this.max.x-this.min.x,this.max.y-this.min.y)}}class Wp{constructor(){this.acc=new Vt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,t){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=t.x,e.min.y=e.max.y=t.y)}appendEdge(e,t,i){this.accCount++,this.acc._add(t);let r=!!this.borders;t.x<e.min.x?(e.min.x=t.x,r=!0):t.x>e.max.x&&(e.max.x=t.x,r=!0),t.y<e.min.y?(e.min.y=t.y,r=!0):t.y>e.max.y&&(e.max.y=t.y,r=!0),((0===t.x||t.x===na)&&t.x===i.x)!=((0===t.y||t.y===na)&&t.y===i.y)&&this.processBorderOverlap(t,i),r&&this.checkBorderIntersection(t,i)}checkBorderIntersection(e,t){t.x<0!=e.x<0&&this.addBorderIntersection(0,Ur(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>na!=e.x>na&&this.addBorderIntersection(1,Ur(t.y,e.y,(na-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,Ur(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>na!=e.y>na&&this.addBorderIntersection(3,Ur(t.x,e.x,(na-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const i=this.borders[e];t<i[0]&&(i[0]=t),t>i[1]&&(i[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const i=0===e.x?0:1;this.addBorderIntersection(i,t.y),this.addBorderIntersection(i,e.y)}else{const i=0===e.y?2:3;this.addBorderIntersection(i,t.x),this.addBorderIntersection(i,e.x)}}centroid(){return 0===this.accCount?new Vt(0,0):new Vt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,t)=>e+ +(t[0]!==Number.MAX_VALUE)),0):0}}function Zp(e,t){const i=e.add(t)._unit(),r=Xt(e.x*i.x+e.y*i.y,-1,1);var n,a,o;return n=Math.acos(r),Math.min(4,Math.max(-4,Math.tan(n)))/4*Bp*((a=e).x*(o=t).y-a.y*o.x<0?-1:1)}const Qp=[e=>e.x<0,e=>e.x>na,e=>e.y<0,e=>e.y>na];function Xp(e,t,i,r){const n=[4];if(0===r)return n;i._mult(r);const a=e.sub(i),o=t.sub(i),s=[e,t,a,o];for(let l=0;l<4;l++)for(const e of s)if(Qp[l](e)){n.push(l);break}return n}class Yp{constructor(e){this.vertexArray=new Pl,this.indexArray=new Gl,this.programConfigurations=new Uc(e.layers,e.zoom,(e=>Fp.includes(e))),this._segments=new mc,this.hiddenByLandmarkVertexArray=new tc,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new mc}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const n=e.length;if(n>2){let a=Math.max(0,this._segments.get().length-1);const o=this._segments._prepareSegment(4*n,this.vertexArray.length,2*this._segmentToGroundQuads[a].length);let s;a!==this._segments.get().length-1&&(a++,this._segmentToGroundQuads[a]=[],this._segmentToRegionTriCounts[a]=[0,0,0,0,0]);{const t=e[0],i=e[1];s=Zp(t.sub(e[n-1])._perp()._unit(),i.sub(t)._perp()._unit())}for(let l=0;l<n;l++){const c=l===n-1?0:l+1,h=e[l],u=e[c],d=e[c===n-1?0:c+1],p=u.sub(h)._perp()._unit(),f=Zp(p,d.sub(u)._perp()._unit()),m=s,g=f;if(tf(h,u,t)||r&&rf(h,t)&&rf(u,t)){s=f;continue}const _=o.vertexLength;Up(this.vertexArray,h,u,1,1,m),Up(this.vertexArray,h,u,1,0,m),Up(this.vertexArray,h,u,0,1,g),Up(this.vertexArray,h,u,0,0,g),o.vertexLength+=4;const y=Xp(h,u,p,i);for(const e of y)this._segmentToGroundQuads[a].push({id:_,region:e}),this._segmentToRegionTriCounts[a][e]+=2,o.primitiveLength+=2;s=f}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),t=e.length;for(let i=0;i<t;i++)this._segmentToGroundQuads[i].sort(((e,t)=>e.region-t.region));for(let i=0;i<t;i++){const t=this._segmentToGroundQuads[i],r=e[i],n=this._segmentToRegionTriCounts[i];n.reduce(((e,t)=>e+t),0);let a=0;for(let e=0;e<=4;e++){const t=n[e];if(0!==t){let i=this.regionSegments[e];i||(i=this.regionSegments[e]=new mc);const n={vertexOffset:r.vertexOffset,primitiveOffset:r.primitiveOffset+a,vertexLength:r.vertexLength,primitiveLength:t};i.get().push(n)}a+=t}for(let e=0;e<t.length;e++){const i=t[e].id;this.indexArray.emplaceBack(i,i+1,i+3),this.indexArray.emplaceBack(i,i+3,i+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,t,i,r,n,a){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,t,i,r,n,a)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Qd.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,t,i,r,n,a){this.hasData()&&this.programConfigurations.updatePaintArrays(e,t,i,r,n,a)}updateHiddenByLandmark(e){if(!this.hasData())return;const t=e.groundVertexCount+e.groundVertexArrayOffset;if(0===e.groundVertexCount)return;const i=e.flags&Vp?1:0;for(let r=e.groundVertexArrayOffset;r<t;++r)this.hiddenByLandmarkVertexArray.emplace(r,i);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,Yd.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const t=this.regionSegments[e];t&&t.destroy()}}}}class Jp{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Gl,this.footprintVertices=new El,this.footprintSegments=[],this.layoutVertexArray=new Al,this.centroidVertexArray=new dc,this.indexArray=new Gl,this.programConfigurations=new Uc(e.layers,e.zoom,(e=>zp.includes(e))),this.segments=new mc,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.groundEffect=new Yp(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,t,i,r){this.features=[],this.hasPattern=Ud("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Ph(i),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:n,id:a,index:o,sourceLayerIndex:s}of e){const e=this.layers[0]._featureFilter.needGeometry,l=Bh(n,e);if(!this.layers[0]._featureFilter.filter(new Vs(this.zoom),l,i))continue;const c={id:a,sourceLayerIndex:s,index:o,geometry:e?l.geometry:Oh(n,i,r),properties:n.properties,type:n.type,patterns:{}},h=this.layoutVertexArray.length;this.hasPattern?this.features.push(Gd("fill-extrusion",this.layers,c,this.zoom,t)):this.addFeature(c,c.geometry,o,i,{},t.availableImages,r,t.brightness),t.featureIndex.insert(n,c.geometry,o,s,this.index,h)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,t,i,r,n,a){for(const o of this.features){const{geometry:e}=o;this.addFeature(o,e,o.index,t,i,r,n,a)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(e,t,i,r,n){const a=0!==Object.keys(e).length;if(a&&!this.stateDependentLayers.length)return;const o=a?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,t,o,i,r,n),this.groundEffect.update(e,t,o,i,r,n)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Kd),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Jd.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Xd.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,i,r,n,a,o,s){const l=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,c=[new Vt(0,0),new Vt(na,na)],h=o.projection,u="globe"===h.name,d="Polygon"===Lp[e.type],p=new Wp;p.centroidDataIndex=this.centroidData.length;const f=new Hp,m=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},r)<=0,g=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},r);f.height=g,f.vertexArrayOffset=this.layoutVertexArray.length,f.groundVertexArrayOffset=this.groundEffect.vertexArray.length,u&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ll);const _=Vd(t,500);for(let S=_.length-1;S>=0;S--){const e=_[S];(0===e.length||(y=e[0]).every((e=>e.x<=0))||y.every((e=>e.x>=na))||y.every((e=>e.y<=0))||y.every((e=>e.y>=na)))&&_.splice(S,1)}var y;let v;if(u)v=sf(_,c,r);else{v=[];for(const e of _)v.push({polygon:e,bounds:c})}const x=d?this.edgeRadius:0,b=x>0&&this.zoom<17,w=(e,t)=>{if(0===e.length)return!1;const i=e[e.length-1];return t.x===i.x&&t.y===i.y};for(const{polygon:S,bounds:T}of v){let e=0,t=0;for(const r of S)d&&!r[0].equals(r[r.length-1])&&r.push(r[0]),t+=d?r.length-1:r.length;const i=this.segments.prepareSegment((d?5:4)*t,this.layoutVertexArray,this.indexArray);f.footprintSegIdx<0&&(f.footprintSegIdx=this.footprintSegments.length),f.polygonSegIdx<0&&(f.polygonSegIdx=this.polygonSegments.length);const n={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},a=new qp;if(a.vertexOffset=this.footprintVertices.length,a.indexOffset=3*this.footprintIndices.length,a.ringIndices=[],d){const t=[],n=[];e=i.vertexLength;for(let e=0;e<S.length;e++){const o=S[e];o.length&&0!==e&&n.push(t.length/2);const s=[];let c,d;c=o[1].sub(o[0])._perp()._unit(),a.ringIndices.push(o.length-1);for(let e=1;e<o.length;e++){const n=o[e],a=o[e===o.length-1?1:e+1],l=n.clone();if(x){d=a.sub(n)._perp()._unit();const e=c.add(d)._unit(),t=x*Math.min(4,1/(c.x*e.x+c.y*e.y));l.x+=t*e.x,l.y+=t*e.y,l.x=Math.round(l.x),l.y=Math.round(l.y),c=d}!m||0!==x&&!b||w(s,l)||s.push(l),jp(this.layoutVertexArray,l.x,l.y,0,0,1,1,0),i.vertexLength++,this.footprintVertices.emplaceBack(n.x,n.y),t.push(n.x,n.y),u&&Gp(this.layoutVertexExtArray,h.projectTilePoint(l.x,l.y,r),h.upVector(r,l.x,l.y))}m&&(0===x||b)&&(0!==s.length&&w(s,s[0])&&s.pop(),this.groundEffect.addData(s,T,l))}const o=Nd(t,n);for(let r=0;r<o.length;r+=3)this.footprintIndices.emplaceBack(a.vertexOffset+o[r+0],a.vertexOffset+o[r+1],a.vertexOffset+o[r+2]),this.indexArray.emplaceBack(e+o[r],e+o[r+2],e+o[r+1]),i.primitiveLength++;a.indexCount+=o.length,a.vertexCount+=this.footprintVertices.length-a.vertexOffset}for(let o=0;o<S.length;o++){const t=S[o];p.startRing(f,t[0]);let n=t.length>4&&nf(t[t.length-2],t[0],t[1]),a=x?$p(t[t.length-2],t[0],t[1],x):0;const s=[];let c,g,_;g=t[1].sub(t[0])._perp()._unit();let y=!0;for(let o=1,l=0;o<t.length;o++){let d=t[o-1],v=t[o];const b=t[o===t.length-1?1:o+1];if(p.appendEdge(f,v,d),tf(v,d,T)){x&&(g=b.sub(v)._perp()._unit(),y=!y);continue}const S=v.sub(d)._perp(),E=S.x/(Math.abs(S.x)+Math.abs(S.y)),M=S.y>0?1:0,A=d.dist(v);if(l+A>32768&&(l=0),x){_=b.sub(v)._perp()._unit();let e=ef(d,v,b,Kp(g,_),x);isNaN(e)&&(e=0);const t=v.sub(d)._unit();d=d.add(t.mult(a))._round(),v=v.add(t.mult(-e))._round(),a=e,g=_,m&&this.zoom>=17&&(w(s,d)||s.push(d),w(s,v)||s.push(v))}const P=i.vertexLength,C=t.length>4&&nf(d,v,b);let I=af(l,n,y);if(jp(this.layoutVertexArray,d.x,d.y,E,M,0,0,I),jp(this.layoutVertexArray,d.x,d.y,E,M,0,1,I),l+=A,I=af(l,C,!y),n=C,jp(this.layoutVertexArray,v.x,v.y,E,M,0,0,I),jp(this.layoutVertexArray,v.x,v.y,E,M,0,1,I),i.vertexLength+=4,this.indexArray.emplaceBack(P+0,P+1,P+2),this.indexArray.emplaceBack(P+1,P+3,P+2),i.primitiveLength+=2,x){const r=e+(1===o?t.length-2:o-2),n=1===o?e:r+1;if(this.indexArray.emplaceBack(P+1,r,P+3),this.indexArray.emplaceBack(r,n,P+3),i.primitiveLength+=2,void 0===c&&(c=P),!tf(b,t[o],T)){const e=o===t.length-1?c:i.vertexLength;this.indexArray.emplaceBack(P+2,P+3,e),this.indexArray.emplaceBack(P+3,e+1,e),this.indexArray.emplaceBack(P+3,n,e+1),i.primitiveLength+=3}y=!y}if(u){const e=this.layoutVertexExtArray,t=h.projectTilePoint(d.x,d.y,r),i=h.projectTilePoint(v.x,v.y,r),n=h.upVector(r,d.x,d.y),a=h.upVector(r,v.x,v.y);Gp(e,t,n),Gp(e,t,n),Gp(e,i,a),Gp(e,i,a)}}d&&(e+=t.length-1),m&&x&&this.zoom>=17&&(0!==s.length&&w(s,s[0])&&s.pop(),this.groundEffect.addData(s,T,l,x>0))}this.footprintSegments.push(a),n.triangleCount=this.indexArray.length-n.triangleArrayOffset,this.polygonSegments.push(n),++f.footprintSegLen,++f.polygonSegLen}if(f.vertexCount=this.layoutVertexArray.length-f.vertexArrayOffset,f.groundVertexCount=this.groundEffect.vertexArray.length-f.groundVertexArrayOffset,0!==f.vertexCount){if(f.centroidXY=p.borders?Np:this.encodeCentroid(p,f),this.centroidData.push(f),p.borders){this.featuresOnBorder.push(p);const e=this.featuresOnBorder.length-1;for(let t=0;t<p.borders.length;t++)p.borders[t][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[t].push(e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,n,a,r,s),this.groundEffect.addPaintPropertiesData(e,i,n,a,r,s),this.maxHeight=Math.max(this.maxHeight,g)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((t,i)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[i].borders[e][0]))}splitToSubtiles(){const e=[];for(let o=0;o<this.centroidData.length;o++){const t=this.centroidData[o],i=+(t.min.y+t.max.y>na),r=2*i+(+(t.min.x+t.max.x>na)^i);for(let n=0;n<t.polygonSegLen;n++){const i=t.polygonSegIdx+n;e.push({centroidIdx:o,subtile:r,polygonSegmentIdx:i,triangleSegmentIdx:this.polygonSegments[i].triangleSegIdx})}}const t=new Gl;e.sort(((e,t)=>e.triangleSegmentIdx===t.triangleSegmentIdx?e.subtile-t.subtile:e.triangleSegmentIdx-t.triangleSegmentIdx));let i=0,r=0,n=0;for(const o of e){if(o.triangleSegmentIdx!==i)break;n++}const a=e.length;for(;r!==e.length;){i=e[r].triangleSegmentIdx;let o=0,s=r,l=r;for(let t=s;t<n&&e[t].subtile===o;t++)l++;for(;s!==n;){const r=e[s];o=r.subtile;const a=this.centroidData[r.centroidIdx].min.clone(),c=this.centroidData[r.centroidIdx].max.clone(),h={vertexOffset:this.segments.segments[i].vertexOffset,primitiveOffset:t.length,vertexLength:this.segments.segments[i].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let i=s;i<l;i++){const r=e[i],n=this.polygonSegments[r.polygonSegmentIdx],o=this.centroidData[r.centroidIdx].min,s=this.centroidData[r.centroidIdx].max,l=this.indexArray.uint16;for(let e=n.triangleArrayOffset;e<n.triangleArrayOffset+n.triangleCount;e++)t.emplaceBack(l[3*e],l[3*e+1],l[3*e+2]);h.primitiveLength+=n.triangleCount,a.x=Math.min(a.x,o.x),a.y=Math.min(a.y,o.y),c.x=Math.max(c.x,s.x),c.y=Math.max(c.y,s.y)}h.primitiveLength>0&&this.triangleSubSegments.push({segment:h,min:a,max:c}),s=l;for(let t=s;t<n&&e[t].subtile===e[s].subtile;t++)l++}r=n;for(let t=r;t<a&&e[t].triangleSegmentIdx===e[r].triangleSegmentIdx;t++)n++}t._trim(),this.indexArray=t}getVisibleSegments(e,t,i){let r=0,n=0;const a=1<<e.canonical.z;if(t){const i=t.getMinMaxForTile(e);i&&(r=i.min,n=i.max)}n+=this.maxHeight;const o=e.toUnwrapped();let s;const l=[o.canonical.x/a+o.wrap,o.canonical.y/a],c=[(o.canonical.x+1)/a+o.wrap,(o.canonical.y+1)/a],h=new mc,u=(e,t,i)=>[e[0]*(1-i[0])+t[0]*i[0],e[1]*(1-i[1])+t[1]*i[1]],d=[],p=[];for(const f of this.triangleSubSegments){d[0]=f.min.x/na,d[1]=f.min.y/na,p[0]=f.max.x/na,p[1]=f.max.y/na;const e=u(l,c,d),t=u(l,c,p);if(0===new mu([e[0],e[1],r],[t[0],t[1],n]).intersectsPrecise(i)){s&&(h.segments.push(s),s=void 0);continue}const a=f.segment;s&&s.vertexOffset!==a.vertexOffset&&(h.segments.push(s),s=void 0),s?(s.vertexLength+=a.vertexLength,s.primitiveLength+=a.primitiveLength):s={vertexOffset:a.vertexOffset,primitiveLength:a.primitiveLength,vertexLength:a.vertexLength,primitiveOffset:a.primitiveOffset,sortKey:void 0,vaos:{}}}return s&&h.segments.push(s),h}encodeCentroid(e,t){const i=e.centroid(),r=t.span(),n=Math.min(7,Math.round(r.x*this.tileToMeter/10)),a=Math.min(7,Math.round(r.y*this.tileToMeter/10));return new Vt(Xt(i.x,1,na-1)<<3|n,Xt(i.y,1,na-1)<<3|a)}encodeBorderCentroid(e){if(!e.borders)return new Vt(0,0);const t=e.borders,i=Number.MAX_VALUE;if(t[0][0]!==i||t[1][0]!==i){const e=t[0][0]!==i?0:1;return new Vt(6|(t[0][0]!==i?0:65528),(t[e][0]+t[e][1])/2<<3|6)}{const e=t[2][0]!==i?2:3;return new Vt((t[e][0]+t[e][1])/2<<3|6,6|(t[2][0]!==i?0:65528))}}showCentroid(e){const t=this.centroidData[e.centroidDataIndex];t.flags&=Vp,t.centroidXY.x=0,t.centroidXY.y=0,this.writeCentroidToBuffer(t)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const t=e.vertexArrayOffset,i=e.vertexCount+e.vertexArrayOffset,r=e.flags&Vp?Np:e.centroidXY,n=this.centroidVertexArray.geta_centroid_pos0(t);if(this.centroidVertexArray.geta_centroid_pos1(t)!==r.y||n!==r.x){for(let e=t;e<i;++e)this.centroidVertexArray.emplace(e,r.x,r.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const i=t.getReplacementRegionsForTile(e.toUnwrapped());if(function(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i].sourceId!==t[i].sourceId||!mp(e[i],t[i]))return!1;return!0}(this.activeReplacements,i))return;if(this.activeReplacements=i,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const n of this.centroidData)n.flags&=2147483647;const r=[];for(const n of this.activeReplacements){const t=Math.pow(2,n.footprintTileId.canonical.z-e.canonical.z);for(const i of this.centroidData)if(!(i.flags&Vp||n.min.x>i.max.x||i.min.x>n.max.x||n.min.y>i.max.y||i.min.y>n.max.y))for(let a=0;a<i.footprintSegLen;a++){const o=this.footprintSegments[i.footprintSegIdx+a];if(r.length=0,lf(this.footprintVertices,o.vertexOffset,o.vertexCount,n.footprintTileId.canonical,e.canonical,r),vp(n.footprint,r,this.footprintIndices.uint16,o.indexOffset,o.indexCount,-o.vertexOffset,-t)){i.flags|=Vp;break}}}for(const n of this.centroidData)this.writeCentroidToBuffer(n);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,t,i){let r=!1;for(let n=0;n<i.footprintSegLen;n++){const a=this.footprintSegments[i.footprintSegIdx+n];let o=0;for(const i of a.ringIndices){for(let n=o,s=i+o-1;n<i+o;s=n++){const i=this.footprintVertices.int16[2*(n+a.vertexOffset)+0],o=this.footprintVertices.int16[2*(n+a.vertexOffset)+1],l=this.footprintVertices.int16[2*(s+a.vertexOffset)+1];o>t!=l>t&&e<(this.footprintVertices.int16[2*(s+a.vertexOffset)+0]-i)*(t-o)/(l-o)+i&&(r=!r)}o=i}}return r}getHeightAtTileCoord(e,t){let i=Number.NEGATIVE_INFINITY,r=!0;const n=4*(e+na)*na+(t+na);if(this.partLookup.hasOwnProperty(n)){const e=this.partLookup[n];return e?{height:e.height,hidden:!!(e.flags&Vp)}:void 0}for(const a of this.centroidData)e>a.max.x||a.min.x>e||t>a.max.y||a.min.y>t||this.footprintContainsPoint(e,t,a)&&a&&a.height>i&&(i=a.height,this.partLookup[n]=a,r=!!(a.flags&Vp));if(i!==Number.NEGATIVE_INFINITY)return{height:i,hidden:r};this.partLookup[n]=void 0}}function Kp(e,t){const i=e.add(t)._unit();return e.x*i.x+e.y*i.y}function $p(e,t,i,r){const n=t.sub(e)._perp()._unit(),a=i.sub(t)._perp()._unit();return ef(e,t,i,Kp(n,a),r)}function ef(e,t,i,r,n){const a=Math.sqrt(1-r*r);return Math.min(e.dist(t)/3,t.dist(i)/3,n*a/r)}function tf(e,t,i){return e.x<i[0].x&&t.x<i[0].x||e.x>i[1].x&&t.x>i[1].x||e.y<i[0].y&&t.y<i[0].y||e.y>i[1].y&&t.y>i[1].y}function rf(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function nf(e,t,i){if(e.x<0||e.x>=na||t.x<0||t.x>=na||i.x<0||i.x>=na)return!1;const r=i.sub(t),n=r.perp(),a=e.sub(t);return(r.x*a.x+r.y*a.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(a.x*a.x+a.y*a.y))>-.866&&n.x*a.x+n.y*a.y<0}function af(e,t,i){const r=t?2|e:-3&e;return i?1|r:-2&r}function of(){const e=Math.PI/32,t=Math.tan(e),i=nh;return i*Math.sqrt(1+2*t*t)-i}function sf(e,t,i){const r=1<<i.z,n=bh(i.x/r),a=bh((i.x+1)/r),o=wh(i.y/r),s=wh((i.y+1)/r);return function(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5?arguments[5]:void 0;const o=[];if(!e.length||!i||!r)return o;const s=(e,t)=>{for(const i of e)o.push({polygon:i,bounds:t})},l=Math.ceil(Math.log2(i)),c=Math.ceil(Math.log2(r)),h=l-c,u=[];for(let f=0;f<Math.abs(h);f++)u.push(h>0?0:1);for(let f=0;f<Math.min(l,c);f++)u.push(0),u.push(1);let d=e;if(d=pp(d,t[0].y-n,t[1].y+n,1),d=pp(d,t[0].x-n,t[1].x+n,0),!d.length)return o;const p=[];for(u.length?p.push({polygons:d,bounds:t,depth:0}):s(d,t);p.length;){const e=p.pop(),t=e.depth,i=u[t],r=e.bounds[0],o=e.bounds[1],l=0===i?r.x:r.y,c=0===i?o.x:o.y,h=a?a(i,l,c):.5*(l+c),d=pp(e.polygons,l-n,h+n,i),f=pp(e.polygons,h-n,c+n,i);if(d.length){const e=[r,new Vt(0===i?h:o.x,1===i?h:o.y)];u.length>t+1?p.push({polygons:d,bounds:e,depth:t+1}):s(d,e)}if(f.length){const e=[new Vt(0===i?h:r.x,1===i?h:r.y),o];u.length>t+1?p.push({polygons:f,bounds:e,depth:t+1}):s(f,e)}}return o}(e,t,Math.ceil((a-n)/11.25),Math.ceil((o-s)/11.25),1,((e,t,n)=>{if(0===e)return.5*(t+n);{const e=wh((i.y+t/na)/r);return(vh(.5*(wh((i.y+n/na)/r)+e))*r-i.y)*na}}))}function lf(e,t,i,r,n,a){const o=Math.pow(2,r.z-n.z);for(let s=0;s<i;s++){let i=e.int16[2*(s+t)+0],l=e.int16[2*(s+t)+1];i=(i+n.x*na)*o-r.x*na,l=(l+n.y*na)*o-r.y*na,a.push(new Vt(i,l))}}fs(Jp,"FillExtrusionBucket",{omit:["layers","features"]}),fs(Hp,"PartData"),fs(qp,"FootprintSegment"),fs(Wp,"BorderCentroidData"),fs(Yp,"GroundEffect");const cf=new Ks({visibility:new Xs(tl["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Xs(tl["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var hf={paint:new Ks({"fill-extrusion-opacity":new Xs(tl["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ys(tl["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Xs(tl["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Xs(tl["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ys(tl["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ys(tl["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ys(tl["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Xs(tl["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Xs(tl["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Xs(tl["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Xs(tl["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Xs(tl["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Xs(tl["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Xs(tl["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Xs(tl["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Ys(tl["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Ys(tl["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Xs(tl["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Xs(tl["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Xs(tl["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Xs(tl["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Xs(tl["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:cf};class uf extends Vt{constructor(e,t,i){super(e,t),this.z=i}}function df(e,t){return e.x*t.x+e.y*t.y}function pf(e,t){if(1===e.length){let i=0;const r=t[i++];let n;for(;!n||r.equals(n);)if(n=t[i++],!n)return 1/0;for(;i<t.length;i++){const a=t[i],o=e[0],s=n.sub(r),l=a.sub(r),c=o.sub(r),h=df(s,s),u=df(s,l),d=df(l,l),p=df(c,s),f=df(c,l),m=h*d-u*u,g=(d*p-u*f)/m,_=(h*f-u*p)/m,y=r.z*(1-g-_)+n.z*g+a.z*_;if(isFinite(y))return y}return 1/0}{let e=1/0;for(const i of t)e=Math.min(e,i.z);return e}}function ff(e,t,i,r,n,a,o,s){const l=o*n.getElevationAt(e,t,!0,!0),c=0!==a[0],h=c?0===a[1]?o*(a[0]/7-450):o*function(e,t,i){const r=Math.floor(t[0]/8),n=Math.floor(t[1]/8),a=10*(t[0]-8*r),o=10*(t[1]-8*n),s=e.getElevationAt(r,n,!0,!0),l=e.getMeterToDEM(i),c=Math.floor(.5*(a*l-1)),h=Math.floor(.5*(o*l-1)),u=e.tileCoordToPixel(r,n),d=2*c+1,p=2*h+1,f=function(e,t,i,r,n){return[e.getElevationAtPixel(t,i,!0),e.getElevationAtPixel(t+n,i,!0),e.getElevationAtPixel(t,i+n,!0),e.getElevationAtPixel(t+r,i+n,!0)]}(e,u.x-c,u.y-h,d,p),m=Math.abs(f[0]-f[1]),g=Math.abs(f[2]-f[3]),_=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),y=Math.min(.25,.5*l*(m+g)/d),v=Math.min(.25,.5*l*_/p);return s+Math.max(y*a,v*o)}(n,a,s):l;return{base:l+(0===i)?-1:i,top:c?Math.max(h+r,l+i+2):l+r}}const mf=Sl([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:gf}=mf,_f=Sl([{name:"a_packed",components:4,type:"Float32"}]),{members:yf}=_f,vf=Sl([{name:"a_pattern_data",components:2,type:"Float32"}]),{members:xf}=vf;class bf{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new id({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const i=this.getKey(e,t);return this.positions[i]}trim(){const e=this.width,t=this.height=ri(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,i){const r=[];let n=e.length%2==1?-e[e.length-1]*i:0,a=e[0]*i,o=!0;r.push({left:n,right:a,isDash:o,zeroLength:0===e[0]});let s=e[0];for(let l=1;l<e.length;l++){o=!o;const t=e[l];n=s*i,s+=t,a=s*i,r.push({left:n,right:a,isDash:o,zeroLength:0===t})}return r}addRoundDash(e,t,i){const r=t/2;for(let n=-i;n<=i;n++){const t=this.width*(this.nextRow+i+n);let a=0,o=e[a];for(let s=0;s<this.width;s++){s/o.right>1&&(o=e[++a]);const l=Math.abs(s-o.left),c=Math.abs(s-o.right),h=Math.min(l,c);let u;const d=n/i*(r+1);if(o.isDash){const e=r-Math.abs(d);u=Math.sqrt(h*h+e*e)}else u=r-Math.sqrt(h*h+d*d);this.image.data[t+s]=Math.max(0,Math.min(255,u+128))}}}addRegularDash(e,t){for(let s=e.length-1;s>=0;--s){const t=e[s],i=e[s+1];t.zeroLength?e.splice(s,1):i&&i.isDash===t.isDash&&(i.left=t.left,e.splice(s,1))}const i=e[0],r=e[e.length-1];i.isDash===r.isDash&&(i.left=r.left-this.width,r.right=i.right+this.width);const n=this.width*this.nextRow;let a=0,o=e[a];for(let s=0;s<this.width;s++){s/o.right>1&&(o=e[++a]);const i=Math.abs(s-o.left),r=Math.abs(s-o.right),l=Math.min(i,r);this.image.data[n+s]=Math.max(0,Math.min(255,(o.isDash?l:-l)+t+128))}}addDash(e,t){const i=this.getKey(e,t);if(this.positions[i])return this.positions[i];const r="round"===t,n=r?7:0,a=2*n+1;if(this.nextRow+a>this.height)return ui("LineAtlas out of space"),null;0===e.length&&e.push(1);let o=0;for(let c=0;c<e.length;c++)e[c]<0&&(ui("Negative value is found in line dasharray, replacing values with 0"),e[c]=0),o+=e[c];if(0!==o){const i=this.width/o,a=this.getDashRanges(e,this.width,i);r?this.addRoundDash(a,i,n):this.addRegularDash(a,"square"===t?.5*i:0)}const s=this.nextRow+n;this.nextRow+=a;const l={tl:[s,n],br:[o,0]};return this.positions[i]=l,l}}fs(bf,"LineAtlas");const wf=dp.types,Sf=Math.cos(Math.PI/180*37.5),Tf=Math.cos(Math.PI/180*5);class Ef{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((e=>{this.gradients[e.id]={}})),this.layoutVertexArray=new Cl,this.layoutVertexArray2=new Il,this.patternVertexArray=new kl,this.indexArray=new Gl,this.programConfigurations=new Uc(e.layers,e.zoom),this.segments=new mc,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id))}populate(e,t,i,r){this.hasPattern=Ud("line",this.layers,t);const n=this.layers[0].layout.get("line-sort-key"),a=[];for(const{feature:c,id:h,index:u,sourceLayerIndex:d}of e){const e=this.layers[0]._featureFilter.needGeometry,t=Bh(c,e);if(!this.layers[0]._featureFilter.filter(new Vs(this.zoom),t,i))continue;const o=n?n.evaluate(t,{},i):void 0,s={id:h,properties:c.properties,type:c.type,sourceLayerIndex:d,index:u,geometry:e?t.geometry:Oh(c,i,r),patterns:{},sortKey:o};a.push(s)}n&&a.sort(((e,t)=>e.sortKey-t.sortKey));const{lineAtlas:o,featureIndex:s}=t,l=this.addConstantDashes(o);for(const c of a){const{geometry:r,index:n,sourceLayerIndex:a}=c;if(l&&this.addFeatureDashes(c,o),this.hasPattern){const e=Gd("line",this.layers,c,this.zoom,t);this.patternFeatures.push(e)}else this.addFeature(c,r,n,i,o.positions,t.availableImages,t.brightness);s.insert(e[n].feature,r,n,a,this.index)}}addConstantDashes(e){let t=!1;for(const i of this.layers){const r=i.paint.get("line-dasharray").value,n=i.layout.get("line-cap").value;if("constant"!==r.kind||"constant"!==n.kind)t=!0;else{const t=n.value,i=r.value;if(!i)continue;e.addDash(i,t)}}return t}addFeatureDashes(e,t){const i=this.zoom;for(const r of this.layers){const n=r.paint.get("line-dasharray").value,a=r.layout.get("line-cap").value;if("constant"===n.kind&&"constant"===a.kind)continue;let o,s;if("constant"===n.kind){if(o=n.value,!o)continue}else o=n.evaluate({zoom:i},e);s="constant"===a.kind?a.value:a.evaluate({zoom:i},e),t.addDash(o,s),e.patterns[r.id]=t.getKey(o,s)}}update(e,t,i,r,n){const a=0!==Object.keys(e).length;a&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,t,a?this.stateDependentLayers:this.layers,i,r,n)}addFeatures(e,t,i,r,n,a){for(const o of this.patternFeatures)this.addFeature(o,o.geometry,o.index,t,i,r,a)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,yf)),0!==this.patternVertexArray.length&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,xf)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gf),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,i,r,n,a,o){const s=this.layers[0].layout,l=s.get("line-join").evaluate(e,{}),c=s.get("line-cap").evaluate(e,{}),h=s.get("line-miter-limit"),u=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const d of t)this.addLine(d,e,l,c,h,u);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,n,a,r,o)}addLine(e,t,i,r,n,a){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0;const o="none"===i;if(this.patternJoinNone=this.hasPattern&&o,this.segmentStart=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let t=0;t<e.length-1;t++)this.totalDistance+=e[t].dist(e[t+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===wf[t.type];let l=e.length;for(;l>=2&&e[l-1].equals(e[l-2]);)l--;let c=0;for(;c<l-1&&e[c].equals(e[c+1]);)c++;if(l<(s?3:2))return;"bevel"===i&&(n=1.05);const h=this.overscaling<=16?15*na/(512*this.overscaling):0,u=this.segments.prepareSegment(10*l,this.layoutVertexArray,this.indexArray);let d,p,f,m,g;this.e1=this.e2=-1,s&&(d=e[l-2],g=e[c].sub(d)._unit()._perp());for(let _=c;_<l;_++){if(f=_===l-1?s?e[c+1]:void 0:e[_+1],f&&e[_].equals(f))continue;g&&(m=g),d&&(p=d),d=e[_],g=f?f.sub(d)._unit()._perp():m,m=m||g;const t=p&&f;let y=t?i:s||o?"butt":r;const v=m.x*g.x+m.y*g.y;if(o){const e=function(e){if(e.patternJoinNone){const t=e.segmentPoints.length/2,i=e.lineSoFar-e.segmentStart;for(let r=0;r<t;++r){const t=e.segmentPoints[2*r+1],n=Math.round(e.segmentPoints[2*r])+.5+.25*t;e.patternVertexArray.emplaceBack(n,i),e.patternVertexArray.emplaceBack(n,i)}e.segmentPoints=[],e.segmentStart=e.lineSoFar}e.e1=e.e2=-1};if(t&&v<Tf){this.updateDistance(p,d),this.addCurrentVertex(d,m,1,1,u),e(this),this.addCurrentVertex(d,g,-1,-1,u);continue}if(p){if(!f){this.updateDistance(p,d),this.addCurrentVertex(d,m,1,1,u),e(this);continue}y="miter"}}let x=m.add(g);0===x.x&&0===x.y||x._unit();const b=x.x*g.x+x.y*g.y,w=0!==b?1/b:1/0,S=2*Math.sqrt(2-2*b),T=b<Sf&&p&&f,E=m.x*g.y-m.y*g.x>0;if(T&&_>c){const e=d.dist(p);if(e>2*h){const t=d.sub(d.sub(p)._mult(h/e)._round());this.updateDistance(p,t),this.addCurrentVertex(t,m,0,0,u),p=t}}if(t&&"round"===y&&(w<a?y="miter":w<=2&&(y="fakeround")),"miter"===y&&w>n&&(y="bevel"),"bevel"===y&&(w>2&&(y="flipbevel"),w<n&&(y="miter")),p&&this.updateDistance(p,d),"miter"===y)x._mult(w),this.addCurrentVertex(d,x,0,0,u);else if("flipbevel"===y){if(w>100)x=g.mult(-1);else{const e=w*m.add(g).mag()/m.sub(g).mag();x._perp()._mult(e*(E?-1:1))}this.addCurrentVertex(d,x,0,0,u),this.addCurrentVertex(d,x.mult(-1),0,0,u)}else if("bevel"===y||"fakeround"===y){const e=-Math.sqrt(w*w-1),t=E?e:0,i=E?0:e;if(p&&this.addCurrentVertex(d,m,t,i,u),"fakeround"===y){const e=Math.round(180*S/Math.PI/20);for(let t=1;t<e;t++){let i=t/e;if(.5!==i){const e=i-.5;i+=i*e*(i-1)*((1.0904+v*(v*(3.55645-1.43519*v)-3.2452))*e*e+(.848013+v*(.215638*v-1.06021)))}const r=g.sub(m)._mult(i)._add(m)._unit()._mult(E?-1:1);this.addHalfVertex(d,r.x,r.y,!1,E,0,u)}}f&&this.addCurrentVertex(d,g,-t,-i,u)}else"butt"===y?this.addCurrentVertex(d,x,0,0,u):"square"===y?(p||this.addCurrentVertex(d,x,-1,-1,u),this.addCurrentVertex(d,x,0,0,u),p&&this.addCurrentVertex(d,x,1,1,u)):"round"===y&&(p&&(this.addCurrentVertex(d,m,0,0,u),this.addCurrentVertex(d,m,1,1,u,!0)),f&&(this.addCurrentVertex(d,g,-1,-1,u,!0),this.addCurrentVertex(d,g,0,0,u)));if(T&&_<l-1){const e=d.dist(f);if(e>2*h){const t=d.add(f.sub(d)._mult(h/e)._round());this.updateDistance(d,t),this.addCurrentVertex(t,g,0,0,u),d=t}}}}addCurrentVertex(e,t,i,r,n){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const o=t.y*r-t.x,s=-t.y-t.x*r;this.addHalfVertex(e,t.x+t.y*i,t.y-t.x*i,a,!1,i,n),this.addHalfVertex(e,o,s,a,!0,-r,n),this.patternJoinNone&&this.segmentPoints.push(this.lineSoFar-this.segmentStart,i)}addHalfVertex(e,t,i,r,n,a,o){let{x:s,y:l}=e;this.layoutVertexArray.emplaceBack((s<<1)+(r?1:0),(l<<1)+(n?1:0),Math.round(63*t)+128,Math.round(63*i)+128,1+(0===a?0:a<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const c=o.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),o.primitiveLength++),n?this.e2=c:this.e1=c}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}fs(Ef,"LineBucket",{omit:["layers","patternFeatures"]});const Mf=new Ks({"line-cap":new Ys(tl.layout_line["line-cap"]),"line-join":new Ys(tl.layout_line["line-join"]),"line-miter-limit":new Xs(tl.layout_line["line-miter-limit"]),"line-round-limit":new Xs(tl.layout_line["line-round-limit"]),"line-sort-key":new Ys(tl.layout_line["line-sort-key"]),visibility:new Xs(tl.layout_line.visibility)});var Af={paint:new Ks({"line-opacity":new Ys(tl.paint_line["line-opacity"]),"line-color":new Ys(tl.paint_line["line-color"]),"line-translate":new Xs(tl.paint_line["line-translate"]),"line-translate-anchor":new Xs(tl.paint_line["line-translate-anchor"]),"line-width":new Ys(tl.paint_line["line-width"]),"line-gap-width":new Ys(tl.paint_line["line-gap-width"]),"line-offset":new Ys(tl.paint_line["line-offset"]),"line-blur":new Ys(tl.paint_line["line-blur"]),"line-dasharray":new Ys(tl.paint_line["line-dasharray"]),"line-pattern":new Ys(tl.paint_line["line-pattern"]),"line-gradient":new Js(tl.paint_line["line-gradient"]),"line-trim-offset":new Xs(tl.paint_line["line-trim-offset"]),"line-emissive-strength":new Xs(tl.paint_line["line-emissive-strength"]),"line-border-width":new Ys(tl.paint_line["line-border-width"]),"line-border-color":new Ys(tl.paint_line["line-border-color"])}),layout:Mf};function Pf(e,t,i){return t*(na/(e.tileSize*Math.pow(2,i-e.tileID.overscaledZ)))}function Cf(e,t){return 1/Pf(e,1,t.tileZoom)}function If(e,t,i,r){return e.translatePosMatrix(r||t.tileID.projMatrix,t,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const kf=e=>{const t=[];Df(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const i=e.paint.get("line-trim-offset");0===i[0]&&0===i[1]||t.push("RENDER_LINE_TRIM_OFFSET"),0!==e.paint.get("line-border-width").constantOr(1)&&t.push("RENDER_LINE_BORDER");const r="none"===e.layout.get("line-join").constantOr("miter"),n=!!e.paint.get("line-pattern").constantOr(1);return r&&n&&t.push("LINE_JOIN_NONE"),t};function Df(e){const t=e.paint.get("line-dasharray").value;return t.value||"constant"!==t.kind}const Rf=new class extends Ys{possiblyEvaluate(e,t){return t=new Vs(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,r){return t=$t({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,r)}}(Af.paint.properties["line-width"].specification);function Lf(e,t){return t>0?t+2*e:e}Rf.useIntegerZoom=!0;const zf=Sl([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ff=Sl([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Of=Sl([{name:"a_projected_pos",components:4,type:"Float32"}],4);Sl([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Bf=Sl([{name:"a_z_offset",components:1,type:"Float32"}],4),Nf=Sl([{name:"a_texb",components:2,type:"Uint16"}]),Vf=Sl([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),jf=Sl([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Sl([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Uf=Sl([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Gf=Sl([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Sl([{name:"triangle",components:3,type:"Uint16"}]),Sl([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Sl([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Sl([{type:"Float32",name:"offsetX"}]),Sl([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var qf=24;const Hf=128;function Wf(e,t){const{expression:i}=t;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new Vs(e+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:r}=i;let n=0;for(;n<t.length&&t[n]<=e;)n++;n=Math.max(0,n-1);let a=n;for(;a<t.length&&t[a]<e+1;)a++;a=Math.min(t.length-1,a);const o=t[n],s=t[a];return"composite"===i.kind?{kind:"composite",minZoom:o,maxZoom:s,interpolationType:r}:{kind:"camera",minZoom:o,maxZoom:s,minSize:i.evaluate(new Vs(o)),maxSize:i.evaluate(new Vs(s)),interpolationType:r}}}function Zf(e,t,i){let{uSize:r,uSizeT:n}=t,{lowerSize:a,upperSize:o}=i;return"source"===e.kind?a/Hf:"composite"===e.kind?Ur(a/Hf,o/Hf,n):r}function Qf(e,t){let i=0,r=0;if("constant"===e.kind)r=e.layoutSize;else if("source"!==e.kind){const{interpolationType:n,minZoom:a,maxZoom:o}=e,s=n?Xt(uo.interpolationFactor(n,t,a,o),0,1):0;"camera"===e.kind?r=Ur(e.minSize,e.maxSize,s):i=s}return{uSizeT:i,uSize:r}}var Xf=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Hf,evaluateSizeForFeature:Zf,evaluateSizeForZoom:Qf,getSizeData:Wf});function Yf(e,t,i){return e.sections.forEach((e=>{e.text=function(e,t,i){const r=t.layout.get("text-transform").evaluate(i,{});return"uppercase"===r?e=e.toLocaleUpperCase():"lowercase"===r&&(e=e.toLocaleLowerCase()),Ns.applyArabicShaping&&(e=Ns.applyArabicShaping(e)),e}(e.text,t,i)})),e}const Jf={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function Kf(e){return"\ufe36"===e||"\ufe48"===e||"\ufe38"===e||"\ufe44"===e||"\ufe42"===e||"\ufe3e"===e||"\ufe3c"===e||"\ufe3a"===e||"\ufe18"===e||"\ufe40"===e||"\ufe10"===e||"\ufe13"===e||"\ufe14"===e||"\uff40"===e||"\uffe3"===e||"\ufe11"===e||"\ufe12"===e}function $f(e){return"\ufe35"===e||"\ufe47"===e||"\ufe37"===e||"\ufe43"===e||"\ufe41"===e||"\ufe3d"===e||"\ufe3b"===e||"\ufe39"===e||"\ufe17"===e||"\ufe3f"===e}var em={read:function(e,t,i,r,n){var a,o,s=8*n-r-1,l=(1<<s)-1,c=l>>1,h=-7,u=i?n-1:0,d=i?-1:1,p=e[t+u];for(u+=d,a=p&(1<<-h)-1,p>>=-h,h+=s;h>0;a=256*a+e[t+u],u+=d,h-=8);for(o=a&(1<<-h)-1,a>>=-h,h+=r;h>0;o=256*o+e[t+u],u+=d,h-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,r),a-=c}return(p?-1:1)*o*Math.pow(2,a-r)},write:function(e,t,i,r,n,a){var o,s,l,c=8*a-n-1,h=(1<<c)-1,u=h>>1,d=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:a-1,f=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=h):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+u>=1?d/l:d*Math.pow(2,1-u))*l>=2&&(o++,l/=2),o+u>=h?(s=0,o=h):o+u>=1?(s=(t*l-1)*Math.pow(2,n),o+=u):(s=t*Math.pow(2,u-1)*Math.pow(2,n),o=0));n>=8;e[i+p]=255&s,p+=f,s/=256,n-=8);for(o=o<<n|s,c+=n;c>0;e[i+p]=255&o,p+=f,o/=256,c-=8);e[i+p-f]|=128*m}},tm=rm,im=em;function rm(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}rm.Varint=0,rm.Fixed64=1,rm.Bytes=2,rm.Fixed32=5;var nm=4294967296,am=1/nm,om="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function sm(e){return e.type===rm.Bytes?e.readVarint()+e.pos:e.pos+1}function lm(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function cm(e,t,i){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;n>=e;n--)i.buf[n+r]=i.buf[n]}function hm(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function um(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function dm(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function pm(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function fm(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function mm(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function gm(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function _m(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function ym(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function vm(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function xm(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function bm(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}rm.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),n=r>>3,a=this.pos;this.type=7&r,e(n,t,this),this.pos===a&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=vm(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=bm(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=vm(this.buf,this.pos)+vm(this.buf,this.pos+4)*nm;return this.pos+=8,e},readSFixed64:function(){var e=vm(this.buf,this.pos)+bm(this.buf,this.pos+4)*nm;return this.pos+=8,e},readFloat:function(){var e=im.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=im.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,r=this.buf;return t=127&(i=r[this.pos++]),i<128?t:(t|=(127&(i=r[this.pos++]))<<7,i<128?t:(t|=(127&(i=r[this.pos++]))<<14,i<128?t:(t|=(127&(i=r[this.pos++]))<<21,i<128?t:function(e,t,i){var r,n,a=i.buf;if(r=(112&(n=a[i.pos++]))>>4,n<128)return lm(e,r,t);if(r|=(127&(n=a[i.pos++]))<<3,n<128)return lm(e,r,t);if(r|=(127&(n=a[i.pos++]))<<10,n<128)return lm(e,r,t);if(r|=(127&(n=a[i.pos++]))<<17,n<128)return lm(e,r,t);if(r|=(127&(n=a[i.pos++]))<<24,n<128)return lm(e,r,t);if(r|=(1&(n=a[i.pos++]))<<31,n<128)return lm(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&om?function(e,t,i){return om.decode(e.subarray(t,i))}(this.buf,t,e):function(e,t,i){for(var r="",n=t;n<i;){var a,o,s,l=e[n],c=null,h=l>239?4:l>223?3:l>191?2:1;if(n+h>i)break;1===h?l<128&&(c=l):2===h?128==(192&(a=e[n+1]))&&(c=(31&l)<<6|63&a)<=127&&(c=null):3===h?(o=e[n+2],128==(192&(a=e[n+1]))&&128==(192&o)&&((c=(15&l)<<12|(63&a)<<6|63&o)<=2047||c>=55296&&c<=57343)&&(c=null)):4===h&&(o=e[n+2],s=e[n+3],128==(192&(a=e[n+1]))&&128==(192&o)&&128==(192&s)&&((c=(15&l)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,h=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),n+=h}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==rm.Bytes)return e.push(this.readVarint(t));var i=sm(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==rm.Bytes)return e.push(this.readSVarint());var t=sm(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==rm.Bytes)return e.push(this.readBoolean());var t=sm(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==rm.Bytes)return e.push(this.readFloat());var t=sm(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==rm.Bytes)return e.push(this.readDouble());var t=sm(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==rm.Bytes)return e.push(this.readFixed32());var t=sm(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==rm.Bytes)return e.push(this.readSFixed32());var t=sm(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==rm.Bytes)return e.push(this.readFixed64());var t=sm(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==rm.Bytes)return e.push(this.readSFixed64());var t=sm(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===rm.Varint)for(;this.buf[this.pos++]>127;);else if(t===rm.Bytes)this.pos=this.readVarint()+this.pos;else if(t===rm.Fixed32)this.pos+=4;else{if(t!==rm.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),xm(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),xm(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),xm(this.buf,-1&e,this.pos),xm(this.buf,Math.floor(e*am),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),xm(this.buf,-1&e,this.pos),xm(this.buf,Math.floor(e*am),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var i,r;if(e>=0?(i=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,r=r+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,i){i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,e>>>=7,i.buf[i.pos++]=127&e|128,i.buf[i.pos]=127&(e>>>=7)}(i,0,t),function(e,t){var i=(7&e)<<4;t.buf[t.pos++]|=i|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,i){for(var r,n,a=0;a<t.length;a++){if((r=t.charCodeAt(a))>55295&&r<57344){if(!n){r>56319||a+1===t.length?(e[i++]=239,e[i++]=191,e[i++]=189):n=r;continue}if(r<56320){e[i++]=239,e[i++]=191,e[i++]=189,n=r;continue}r=n-55296<<10|r-56320|65536,n=null}else n&&(e[i++]=239,e[i++]=191,e[i++]=189,n=null);r<128?e[i++]=r:(r<2048?e[i++]=r>>6|192:(r<65536?e[i++]=r>>12|224:(e[i++]=r>>18|240,e[i++]=r>>12&63|128),e[i++]=r>>6&63|128),e[i++]=63&r|128)}return i}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&cm(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),im.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),im.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var r=this.pos-i;r>=128&&cm(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,i){this.writeTag(e,rm.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,hm,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,um,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,fm,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,dm,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,pm,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,mm,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,gm,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,_m,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,ym,t)},writeBytesField:function(e,t){this.writeTag(e,rm.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,rm.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,rm.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,rm.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,rm.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,rm.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,rm.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,rm.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,rm.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,rm.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var wm=u(tm);const Sm=3;function Tm(e,t,i){t.glyphs=[],1===e&&i.readMessage(Em,t)}function Em(e,t,i){if(3===e){const{id:e,bitmap:r,width:n,height:a,left:o,top:s,advance:l}=i.readMessage(Mm,{});t.glyphs.push({id:e,bitmap:new id({width:n+2*Sm,height:a+2*Sm},r),metrics:{width:n,height:a,left:o,top:s,advance:l}})}else 4===e?t.ascender=i.readSVarint():5===e&&(t.descender=i.readSVarint())}function Mm(e,t,i){1===e?t.id=i.readVarint():2===e?t.bitmap=i.readBytes():3===e?t.width=i.readVarint():4===e?t.height=i.readVarint():5===e?t.left=i.readSVarint():6===e?t.top=i.readSVarint():7===e&&(t.advance=i.readVarint())}const Am=Sm,Pm={horizontal:1,vertical:2,horizontalOnly:3};class Cm{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const i=new Cm;return i.scale=e||1,i.fontStack=t,i}static forImage(e){const t=new Cm;return t.imageName=e,t}}class Im{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const i=new Im;for(let r=0;r<e.sections.length;r++){const n=e.sections[r];n.image?i.addImageSection(n):i.addTextSection(n,t)}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(e,t){let i="";for(let r=0;r<e.length;r++){const n=e.charCodeAt(r+1)||null,a=e.charCodeAt(r-1)||null;i+=!t&&(n&&Ts(n)&&!Jf[e[r+1]]||a&&Ts(a)&&!Jf[e[r-1]])||!Jf[e[r]]?e[r]:Jf[e[r]]}return i}(this.text,e)}trim(){let e=0;for(let i=0;i<this.text.length&&Dm[this.text.charCodeAt(i)];i++)e++;let t=this.text.length;for(let i=this.text.length-1;i>=0&&i>=e&&Dm[this.text.charCodeAt(i)];i--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const i=new Im;return i.text=this.text.substring(e,t),i.sectionIndex=this.sectionIndex.slice(e,t),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,t)=>Math.max(e,this.sections[t].scale)),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Cm.forText(e.scale,e.fontStack||t));const i=this.sections.length-1;for(let r=0;r<e.text.length;++r)this.sectionIndex.push(i)}addImageSection(e){const t=e.image?e.image.namePrimary:"";if(0===t.length)return void ui("Can't add FormattedSection with an empty image.");const i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCodePoint(i),this.sections.push(Cm.forImage(t)),this.sectionIndex.push(this.sections.length-1)):ui("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function km(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f){const m=Im.fromFeature(e,n);u===Pm.vertical&&m.verticalizePunctuation(d);let g=[];const _=function(e,t,i,r,n,a){if(!e)return[];const o=[],s=function(e,t,i,r,n,a){let o=0;for(let s=0;s<e.length();s++){const i=e.getSection(s);o+=Lm(e.getCodePoint(s),i,r,n,t,a)}return o/Math.max(1,Math.ceil(o/i))}(e,t,i,r,n,a),l=e.text.indexOf("\u200b")>=0;let c=0;for(let u=0;u<e.length();u++){const i=e.getSection(u),d=e.getCodePoint(u);if(Dm[d]||(c+=Lm(d,i,r,n,t,a)),u<e.length()-1){const t=!((h=d)<11904||!(vs["Bopomofo Extended"](h)||vs.Bopomofo(h)||vs["CJK Compatibility Forms"](h)||vs["CJK Compatibility Ideographs"](h)||vs["CJK Compatibility"](h)||vs["CJK Radicals Supplement"](h)||vs["CJK Strokes"](h)||vs["CJK Symbols and Punctuation"](h)||vs["CJK Unified Ideographs Extension A"](h)||vs["CJK Unified Ideographs"](h)||vs["Enclosed CJK Letters and Months"](h)||vs["Halfwidth and Fullwidth Forms"](h)||vs.Hiragana(h)||vs["Ideographic Description Characters"](h)||vs["Kangxi Radicals"](h)||vs["Katakana Phonetic Extensions"](h)||vs.Katakana(h)||vs["Vertical Forms"](h)||vs["Yi Radicals"](h)||vs["Yi Syllables"](h)));(Rm[d]||t||i.imageName)&&o.push(Om(u+1,c,s,o,Fm(d,e.getCodePoint(u+1),t&&l),!1))}}var h;return Bm(Om(e.length(),c,s,o,0,!0))}(m,c,a,t,r,p),{processBidirectionalText:y,processStyledBidirectionalText:v}=Ns;if(y&&1===m.sections.length){const e=y(m.toString(),_);for(const t of e){const e=new Im;e.text=t,e.sections=m.sections;for(let i=0;i<t.length;i++)e.sectionIndex.push(0);g.push(e)}}else if(v){const e=v(m.text,m.sectionIndex,_);for(const t of e){const e=new Im;e.text=t[0],e.sectionIndex=t[1],e.sections=m.sections,g.push(e)}}else g=function(e,t){const i=[],r=e.text;let n=0;for(const a of t)i.push(e.substring(n,a)),n=a;return n<r.length&&i.push(e.substring(n,r.length)),i}(m,_);const x=[],b={positionedLines:x,text:m.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:u,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(e,t,i,r,n,a,o,s,l,c,h,u){let d=0,p=0,f=0;const m="right"===s?1:"left"===s?0:.5;let g=!1;for(const w of n){const e=w.getSections();for(const i of e){if(i.imageName)continue;const e=t[i.fontStack];if(e&&(g=void 0!==e.ascender&&void 0!==e.descender,!g))break}if(!g)break}let _=0;for(const w of n){w.trim();const n=w.getMaxScale(),o=(n-1)*qf,s={positionedGlyphs:[],lineOffset:0};e.positionedLines[_]=s;const v=s.positionedGlyphs;let x=0;if(!w.length()){p+=a,++_;continue}let b=0,S=0;for(let a=0;a<w.length();a++){const o=w.getSection(a),s=w.getSectionIndex(a),f=w.getCodePoint(a);let m=o.scale,_=null,T=null,E=null,M=qf,A=0;const P=!(l===Pm.horizontal||!h&&!Ss(f)||h&&(Dm[f]||(y=f,vs.Arabic(y)||vs["Arabic Supplement"](y)||vs["Arabic Extended-A"](y)||vs["Arabic Presentation Forms-A"](y)||vs["Arabic Presentation Forms-B"](y))));if(o.imageName){const t=r[o.imageName];if(!t)continue;E=o.imageName,e.iconsInText=e.iconsInText||!0,T=t.paddedRect;const i=t.displaySize;m=m*qf/u,_={width:i[0],height:i[1],left:0,top:-Am,advance:P?i[1]:i[0],localGlyph:!1},A=g?-_.height*m:n*qf-17-i[1]*m,M=_.advance;const a=(P?i[0]:i[1])*m-qf*n;a>0&&a>x&&(x=a)}else{const e=i[o.fontStack];if(!e)continue;e[f]&&(T=e[f]);const r=t[o.fontStack];if(!r)continue;const a=r.glyphs[f];if(!a)continue;if(_=a.metrics,M=8203!==f?qf:0,g){const e=void 0!==r.ascender?Math.abs(r.ascender):0,t=void 0!==r.descender?Math.abs(r.descender):0,i=(e+t)*m;b<i&&(b=i,S=(e-t)/2*m),A=-e*m}else A=(n-m)*qf-17}P?(e.verticalizable=!0,v.push({glyph:f,imageName:E,x:d,y:p+A,vertical:P,scale:m,localGlyph:_.localGlyph,fontStack:o.fontStack,sectionIndex:s,metrics:_,rect:T}),d+=M*m+c):(v.push({glyph:f,imageName:E,x:d,y:p+A,vertical:P,scale:m,localGlyph:_.localGlyph,fontStack:o.fontStack,sectionIndex:s,metrics:_,rect:T}),d+=_.advance*m+c)}0!==v.length&&(f=Math.max(d-c,f),g?Vm(v,m,x,S,a*n/2):Vm(v,m,x,0,a/2)),d=0;const T=a*n+x;s.lineOffset=Math.max(x,o),p+=T,++_}var y;const v=p,{horizontalAlign:x,verticalAlign:b}=Nm(o);(function(e,t,i,r,n,a){const o=(t-i)*n,s=-a*r;for(const l of e)for(const e of l.positionedGlyphs)e.x+=o,e.y+=s})(e.positionedLines,m,x,b,f,v),e.top+=-b*v,e.bottom=e.top+v,e.left+=-x*f,e.right=e.left+f,e.hasBaseline=g}(b,t,i,r,g,o,s,l,u,c,d,f),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(x)&&b}const Dm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Rm={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Lm(e,t,i,r,n,a){if(t.imageName){const e=r[t.imageName];return e?e.displaySize[0]*t.scale*qf/a+n:0}{const r=i[t.fontStack],a=r&&r.glyphs[e];return a?a.metrics.advance*t.scale+n:0}}function zm(e,t,i,r){const n=Math.pow(e-t,2);return r?e<t?n/2:2*n:n+Math.abs(i)*i}function Fm(e,t,i){let r=0;return 10===e&&(r-=1e4),i&&(r+=150),40!==e&&65288!==e||(r+=50),41!==t&&65289!==t||(r+=50),r}function Om(e,t,i,r,n,a){let o=null,s=zm(t,i,n,a);for(const l of r){const e=zm(t-l.x,i,n,a)+l.badness;e<=s&&(o=l,s=e)}return{index:e,x:t,priorBreak:o,badness:s}}function Bm(e){return e?Bm(e.priorBreak).concat(e.index):[]}function Nm(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function Vm(e,t,i,r,n){if(!(t||i||r||n))return;const a=e.length-1,o=e[a],s=(o.x+o.metrics.advance*o.scale)*t;for(let l=0;l<=a;l++)e[l].x-=s,e[l].y+=i+r+n}function jm(e,t,i,r){const{horizontalAlign:n,verticalAlign:a}=Nm(r),o=i[0]-e.displaySize[0]*n,s=i[1]-e.displaySize[1]*a;return{imagePrimary:e,imageSecondary:t,top:s,bottom:s+e.displaySize[1],left:o,right:o+e.displaySize[0]}}function Um(e,t,i,r,n,a){const o=e.imagePrimary;let s;if(o.content){const e=o.content,t=o.pixelRatio||1;s=[e[0]/t,e[1]/t,o.displaySize[0]-e[2]/t,o.displaySize[1]-e[3]/t]}const l=t.left*a,c=t.right*a;let h,u,d,p;"width"===i||"both"===i?(p=n[0]+l-r[3],u=n[0]+c+r[1]):(p=n[0]+(l+c-o.displaySize[0])/2,u=p+o.displaySize[0]);const f=t.top*a,m=t.bottom*a;return"height"===i||"both"===i?(h=n[1]+f-r[0],d=n[1]+m+r[2]):(h=n[1]+(f+m-o.displaySize[1])/2,d=h+o.displaySize[1]),{imagePrimary:o,imageSecondary:void 0,top:h,right:u,bottom:d,left:p,collisionPadding:s}}class Gm extends Vt{constructor(e,t,i,r,n){super(e,t),this.angle=r,this.z=i,void 0!==n&&(this.segment=n)}clone(){return new Gm(this.x,this.y,this.z,this.angle,this.segment)}}function qm(e,t,i,r,n){if(void 0===t.segment)return!0;let a=t,o=t.segment+1,s=0;for(;s>-i/2;){if(o--,o<0)return!1;s-=e[o].dist(a),a=e[o]}s+=e[o].dist(e[o+1]),o++;const l=[];let c=0;for(;s<i/2;){const t=e[o],i=e[o+1];if(!i)return!1;let a=e[o-1].angleTo(t)-t.angleTo(i);for(a=Math.abs((a+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:a}),c+=a;s-l[0].distance>r;)c-=l.shift().angleDelta;if(c>n)return!1;o++,s+=t.dist(i)}return!0}function Hm(e){let t=0;for(let i=0;i<e.length-1;i++)t+=e[i].dist(e[i+1]);return t}function Wm(e,t,i){return e?.6*t*i:0}function Zm(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Qm(e,t,i,r,n,a){const o=Wm(i,n,a),s=Zm(i,r)*a;let l=0;const c=Hm(e)/2;for(let h=0;h<e.length-1;h++){const i=e[h],r=e[h+1],n=i.dist(r);if(l+n>c){const a=(c-l)/n,u=Ur(i.x,r.x,a),d=Ur(i.y,r.y,a),p=new Gm(u,d,0,r.angleTo(i),h);return!o||qm(e,p,s,o,t)?p:void 0}l+=n}}function Xm(e,t,i,r,n,a,o,s,l){const c=Wm(r,a,o),h=Zm(r,n),u=h*o,d=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-u<t/4&&(t=u+t/4),Ym(e,d?t/2*s%t:(h/2+2*a)*o*s%t,t,c,i,u,d,!1,l)}function Ym(e,t,i,r,n,a,o,s,l){const c=a/2,h=Hm(e);let u=0,d=t-i,p=[];for(let f=0;f<e.length-1;f++){const t=e[f],o=e[f+1],s=t.dist(o),m=o.angleTo(t);for(;d+i<u+s;){d+=i;const g=(d-u)/s,_=Ur(t.x,o.x,g),y=Ur(t.y,o.y,g);if(_>=0&&_<l&&y>=0&&y<l&&d-c>=0&&d+c<=h){const t=new Gm(_,y,0,m,f);r&&!qm(e,t,a,r,n)||p.push(t)}}u+=s}return s||p.length||o||(p=Ym(e,u/2,i,r,n,a,o,!0,l)),p}function Jm(e,t,i,r,n){const a=[];for(let o=0;o<e.length;o++){const s=e[o];let l;for(let e=0;e<s.length-1;e++){let o=s[e],c=s[e+1];o.x<t&&c.x<t||(o.x<t?o=new Vt(t,o.y+(t-o.x)/(c.x-o.x)*(c.y-o.y))._round():c.x<t&&(c=new Vt(t,o.y+(t-o.x)/(c.x-o.x)*(c.y-o.y))._round()),o.y<i&&c.y<i||(o.y<i?o=new Vt(o.x+(i-o.y)/(c.y-o.y)*(c.x-o.x),i)._round():c.y<i&&(c=new Vt(o.x+(i-o.y)/(c.y-o.y)*(c.x-o.x),i)._round()),o.x>=r&&c.x>=r||(o.x>=r?o=new Vt(r,o.y+(r-o.x)/(c.x-o.x)*(c.y-o.y))._round():c.x>=r&&(c=new Vt(r,o.y+(r-o.x)/(c.x-o.x)*(c.y-o.y))._round()),o.y>=n&&c.y>=n||(o.y>=n?o=new Vt(o.x+(n-o.y)/(c.y-o.y)*(c.x-o.x),n)._round():c.y>=n&&(c=new Vt(o.x+(n-o.y)/(c.y-o.y)*(c.x-o.x),n)._round()),l&&o.equals(l[l.length-1])||(l=[o],a.push(l)),l.push(c)))))}}return a}function Km(e){let t=0,i=0;for(const o of e)t+=o.w*o.h,i=Math.max(i,o.w);e.sort(((e,t)=>t.h-e.h));const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let n=0,a=0;for(const o of e)for(let e=r.length-1;e>=0;e--){const t=r[e];if(!(o.w>t.w||o.h>t.h)){if(o.x=t.x,o.y=t.y,a=Math.max(a,o.y+o.h),n=Math.max(n,o.x+o.w),o.w===t.w&&o.h===t.h){const t=r.pop();e<r.length&&(r[e]=t)}else o.h===t.h?(t.x+=o.w,t.w-=o.w):o.w===t.w?(t.y+=o.h,t.h-=o.h):(r.push({x:t.x+o.w,y:t.y,w:t.w-o.w,h:o.h}),t.y+=o.h,t.h-=o.h);break}}return{w:n,h:a,fill:t/(n*a)||0}}fs(Gm,"Anchor");const $m=1;class eg{constructor(e,t){let{pixelRatio:i,version:r,stretchX:n,stretchY:a,content:o}=t;this.paddedRect=e,this.pixelRatio=i,this.stretchX=n,this.stretchY=a,this.content=o,this.version=r}get tl(){return[this.paddedRect.x+$m,this.paddedRect.y+$m]}get br(){return[this.paddedRect.x+this.paddedRect.w-$m,this.paddedRect.y+this.paddedRect.h-$m]}get displaySize(){return[(this.paddedRect.w-2*$m)/this.pixelRatio,(this.paddedRect.h-2*$m)/this.pixelRatio]}}class tg{constructor(e,t){const i={},r={};this.haveRenderCallbacks=[];const n=[];this.addImages(e,i,n),this.addImages(t,r,n);const{w:a,h:o}=Km(n),s=new rd({width:a||1,height:o||1});for(const l in e){const t=e[l],r=i[l].paddedRect;rd.copy(t.data,s,{x:0,y:0},{x:r.x+$m,y:r.y+$m},t.data,t.sdf)}for(const l in t){const e=t[l],i=r[l].paddedRect,n=i.x+$m,a=i.y+$m,o=e.data.width,c=e.data.height;rd.copy(e.data,s,{x:0,y:0},{x:n,y:a},e.data),rd.copy(e.data,s,{x:0,y:c-1},{x:n,y:a-1},{width:o,height:1}),rd.copy(e.data,s,{x:0,y:0},{x:n,y:a+c},{width:o,height:1}),rd.copy(e.data,s,{x:o-1,y:0},{x:n-1,y:a},{width:1,height:c}),rd.copy(e.data,s,{x:0,y:0},{x:n+o,y:a},{width:1,height:c})}this.image=s,this.iconPositions=i,this.patternPositions=r}addImages(e,t,i){for(const r in e){const n=e[r],a={x:0,y:0,w:n.data.width+2*$m,h:n.data.height+2*$m};i.push(a),t[r]=new eg(a,n),n.hasRenderCallback&&this.haveRenderCallbacks.push(r)}}patchUpdatedImages(e,t,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((t=>e.hasImage(t,i))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,i);for(const r in e.getUpdatedImages(i))this.patchUpdatedImage(this.iconPositions[r],e.getImage(r,i),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r,i),t)}patchUpdatedImage(e,t,i){if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[r,n]=e.tl,a=!!Object.keys(this.patternPositions).length;i.update(t.data,{useMipmap:a},{x:r,y:n})}}fs(eg,"ImagePosition"),fs(tg,"ImageAtlas");const ig=1e20;function rg(e,t,i,r,n,a,o,s,l){for(let c=t;c<t+r;c++)ng(e,i*a+c,a,n,o,s,l);for(let c=i;c<i+n;c++)ng(e,c*a+t,1,r,o,s,l)}function ng(e,t,i,r,n,a,o){a[0]=0,o[0]=-ig,o[1]=ig,n[0]=e[t];for(let s=1,l=0,c=0;s<r;s++){n[s]=e[t+s*i];const r=s*s;do{const e=a[l];c=(n[s]-n[e]+r-e*e)/(s-e)/2}while(c<=o[l]&&--l>-1);l++,a[l]=s,o[l]=c,o[l+1]=ig}for(let s=0,l=0;s<r;s++){for(;o[l+1]<s;)l++;const r=a[l],c=s-r;e[t+s*i]=n[r]+c*c}}const ag=2,og={none:0,ideographs:1,all:2};class sg{constructor(e,t,i){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=i,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,t){this.urls[t]=e}getGlyphs(e,t,i){const n=[],a=this.urls[t]||r.GLYPHS_URL;for(const r in e)for(const t of e[r])n.push({stack:r,id:t});Kt(n,((e,t)=>{let{stack:i,id:r}=e,n=this.entries[i];n||(n=this.entries[i]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let o=n.glyphs[r];if(void 0!==o)return void t(null,{stack:i,id:r,glyph:o});if(o=this._tinySDF(n,i,r),o)return n.glyphs[r]=o,void t(null,{stack:i,id:r,glyph:o});const s=Math.floor(r/256);if(256*s>65535)return void t(new Error("glyphs > 65535 not supported"));if(n.ranges[s])return void t(null,{stack:i,id:r,glyph:o});let l=n.requests[s];l||(l=n.requests[s]=[],sg.loadGlyphRange(i,s,a,this.requestManager,((e,t)=>{if(t){n.ascender=t.ascender,n.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(n.glyphs[+e]=t.glyphs[+e]);n.ranges[s]=!0}for(const i of l)i(e,t);delete n.requests[s]}))),l.push(((e,n)=>{e?t(e):n&&t(null,{stack:i,id:r,glyph:n.glyphs[r]||null})}))}),((e,t)=>{if(e)i(e);else if(t){const e={};for(const{stack:i,id:r,glyph:n}of t)void 0===e[i]&&(e[i]={}),void 0===e[i].glyphs&&(e[i].glyphs={}),e[i].glyphs[r]=n&&{id:n.id,bitmap:n.bitmap.clone(),metrics:n.metrics},e[i].ascender=this.entries[i].ascender,e[i].descender=this.entries[i].descender;i(null,e)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==og.none&&(this.localGlyphMode===og.all?!!this.localFontFamily:!!this.localFontFamily&&(vs["CJK Unified Ideographs"](e)||vs["Hangul Syllables"](e)||vs.Hiragana(e)||vs.Katakana(e)||vs["CJK Symbols and Punctuation"](e)||vs["CJK Unified Ideographs Extension A"](e)||vs["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,t,i){const r=this.localFontFamily;if(!r||!this._doesCharSupportLocalGlyph(i))return;let n=e.tinySDF;if(!n){let i="400";/bold/i.test(t)?i="900":/medium/i.test(t)?i="500":/light/i.test(t)&&(i="200"),n=e.tinySDF=new sg.TinySDF({fontFamily:r,fontWeight:i,fontSize:24*ag,buffer:3*ag,radius:8*ag}),n.fontWeight=i}if(this.localGlyphs[n.fontWeight][i])return this.localGlyphs[n.fontWeight][i];const a=String.fromCodePoint(i),{data:o,width:s,height:l,glyphWidth:c,glyphHeight:h,glyphLeft:u,glyphTop:d,glyphAdvance:p}=n.draw(a);return this.localGlyphs[n.fontWeight][i]={id:i,bitmap:new id({width:s,height:l},o),metrics:{width:c/ag,height:h/ag,left:u/ag,top:d/ag-27,advance:p/ag,localGlyph:!0}}}}sg.loadGlyphRange=function(e,t,i,r,n){const a=256*t,o=a+255,s=r.transformRequest(r.normalizeGlyphsURL(i).replace("{fontstack}",e).replace("{range}","".concat(a,"-").concat(o)),Xi.Glyphs);$i(s,((e,t)=>{if(e)n(e);else if(t){const e={},i=function(e){return new wm(e).readFields(Tm,{})}(t);for(const t of i.glyphs)e[t.id]=t;n(null,{glyphs:e,ascender:i.ascender,descender:i.descender})}}))},sg.TinySDF=class{constructor(){let{fontSize:e=24,buffer:t=3,radius:i=8,cutoff:r=.25,fontFamily:n="sans-serif",fontWeight:a="normal",fontStyle:o="normal"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.buffer=t,this.cutoff=r,this.radius=i;const s=this.size=e+4*t,l=this._createCanvas(s),c=this.ctx=l.getContext("2d",{willReadFrequently:!0});c.font="".concat(o," ").concat(a," ").concat(e,"px ").concat(n),c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:n,actualBoundingBoxRight:a}=this.ctx.measureText(e),o=Math.ceil(i),s=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(a-n))),l=Math.min(this.size-this.buffer,o+Math.ceil(r)),c=s+2*this.buffer,h=l+2*this.buffer,u=Math.max(c*h,0),d=new Uint8ClampedArray(u),p={data:d,width:c,height:h,glyphWidth:s,glyphHeight:l,glyphTop:o,glyphLeft:0,glyphAdvance:t};if(0===s||0===l)return p;const{ctx:f,buffer:m,gridInner:g,gridOuter:_}=this;f.clearRect(m,m,s,l),f.fillText(e,m,m+o);const y=f.getImageData(m,m,s,l);_.fill(ig,0,u),g.fill(0,0,u);for(let v=0;v<l;v++)for(let e=0;e<s;e++){const t=y.data[4*(v*s+e)+3]/255;if(0===t)continue;const i=(v+m)*c+e+m;if(1===t)_[i]=0,g[i]=ig;else{const e=.5-t;_[i]=e>0?e*e:0,g[i]=e<0?e*e:0}}rg(_,0,0,c,h,c,this.f,this.v,this.z),rg(g,m,m,s,l,c,this.f,this.v,this.z);for(let v=0;v<u;v++){const e=Math.sqrt(_[v])-Math.sqrt(g[v]);d[v]=Math.round(255-255*(e/this.radius+this.cutoff))}return p}};const lg=$m;function cg(e,t,i,r){const n=[],a=e.imagePrimary,o=a.pixelRatio,s=a.paddedRect.w-2*lg,l=a.paddedRect.h-2*lg,c=e.right-e.left,h=e.bottom-e.top,u=a.stretchX||[[0,s]],d=a.stretchY||[[0,l]],p=(e,t)=>e+t[1]-t[0],f=u.reduce(p,0),m=d.reduce(p,0),g=s-f,_=l-m;let y=0,v=f,x=0,b=m,w=0,S=g,T=0,E=_;if(a.content&&r){const e=a.content;y=hg(u,0,e[0]),x=hg(d,0,e[1]),v=hg(u,e[0],e[2]),b=hg(d,e[1],e[3]),w=e[0]-y,T=e[1]-x,S=e[2]-e[0]-v,E=e[3]-e[1]-b}const M=(r,n,s,l)=>{const u=dg(r.stretch-y,v,c,e.left),d=pg(r.fixed-w,S,r.stretch,f),p=dg(n.stretch-x,b,h,e.top),g=pg(n.fixed-T,E,n.stretch,m),_=dg(s.stretch-y,v,c,e.left),M=pg(s.fixed-w,S,s.stretch,f),A=dg(l.stretch-x,b,h,e.top),P=pg(l.fixed-T,E,l.stretch,m),C=new Vt(u,p),I=new Vt(_,p),k=new Vt(_,A),D=new Vt(u,A),R=new Vt(d/o,g/o),L=new Vt(M/o,P/o),z=t*Math.PI/180;if(z){const e=Math.sin(z),t=Math.cos(z),i=[t,-e,e,t];C._matMult(i),I._matMult(i),D._matMult(i),k._matMult(i)}const F=r.stretch+r.fixed,O=s.stretch+s.fixed,B=n.stretch+n.fixed,N=l.stretch+l.fixed,V=e.imageSecondary;return{tl:C,tr:I,bl:D,br:k,texPrimary:{x:a.paddedRect.x+lg+F,y:a.paddedRect.y+lg+B,w:O-F,h:N-B},texSecondary:V?{x:V.paddedRect.x+lg+F,y:V.paddedRect.y+lg+B,w:O-F,h:N-B}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:R,pixelOffsetBR:L,minFontScaleX:S/o/c,minFontScaleY:E/o/h,isSDF:i}};if(r&&(a.stretchX||a.stretchY)){const e=ug(u,g,f),t=ug(d,_,m);for(let i=0;i<e.length-1;i++){const r=e[i],a=e[i+1];for(let e=0;e<t.length-1;e++)n.push(M(r,t[e],a,t[e+1]))}}else n.push(M({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:s+1},{fixed:0,stretch:l+1}));return n}function hg(e,t,i){let r=0;for(const n of e)r+=Math.max(t,Math.min(i,n[1]))-Math.max(t,Math.min(i,n[0]));return r}function ug(e,t,i){const r=[{fixed:-lg,stretch:0}];for(const[n,a]of e){const e=r[r.length-1];r.push({fixed:n-e.stretch,stretch:e.stretch}),r.push({fixed:n-e.stretch,stretch:e.stretch+(a-n)})}return r.push({fixed:t+lg,stretch:i}),r}function dg(e,t,i,r){return e/t*i+r}function pg(e,t,i,r){return e-t*i/r}function fg(e,t,i,r){const n=t+e.positionedLines[r].lineOffset;return 0===r?i+n/2:i+(n+(t+e.positionedLines[r-1].lineOffset))/2}function mg(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=1/0,n=1/0,a=-1/0,o=-1/0;const s=e[0];for(let p=0;p<s.length;p++){const e=s[p];(!p||e.x<r)&&(r=e.x),(!p||e.y<n)&&(n=e.y),(!p||e.x>a)&&(a=e.x),(!p||e.y>o)&&(o=e.y)}const l=Math.min(a-r,o-n);let c=l/2;const h=new ra([],gg);if(0===l)return new Vt(r,n);for(let p=r;p<a;p+=l)for(let t=n;t<o;t+=l)h.push(new _g(p+c,t+c,c,e));let u=function(e){let t=0,i=0,r=0;const n=e[0];for(let a=0,o=n.length,s=o-1;a<o;s=a++){const e=n[a],o=n[s],l=e.x*o.y-o.x*e.y;i+=(e.x+o.x)*l,r+=(e.y+o.y)*l,t+=3*l}return new _g(i/t,r/t,0,e)}(e),d=h.length;for(;h.length;){const r=h.pop();(r.d>u.d||!u.d)&&(u=r,i&&console.log("found best %d after %d probes",Math.round(1e4*r.d)/1e4,d)),r.max-u.d<=t||(c=r.h/2,h.push(new _g(r.p.x-c,r.p.y-c,c,e)),h.push(new _g(r.p.x+c,r.p.y-c,c,e)),h.push(new _g(r.p.x-c,r.p.y+c,c,e)),h.push(new _g(r.p.x+c,r.p.y+c,c,e)),d+=4)}return i&&(console.log("num probes: ".concat(d)),console.log("best distance: ".concat(u.d))),u.p}function gg(e,t){return t.max-e.max}class _g{constructor(e,t,i,r){this.p=new Vt(e,t),this.h=i,this.d=function(e,t){let i=!1,r=1/0;for(let n=0;n<t.length;n++){const a=t[n];for(let t=0,n=a.length,o=n-1;t<n;o=t++){const n=a[t],s=a[o];n.y>e.y!=s.y>e.y&&e.x<(s.x-n.x)*(e.y-n.y)/(s.y-n.y)+n.x&&(i=!i),r=Math.min(r,Xh(e,n,s))}}return(i?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}}const yg=Number.POSITIVE_INFINITY,vg=Math.sqrt(2);function xg(e,t){let[i,r]=t,n=0,a=0;if(r===yg){i<0&&(i=0);const t=i/vg;switch(e){case"top-right":case"top-left":a=t-7;break;case"bottom-right":case"bottom-left":a=7-t;break;case"bottom":a=7-i;break;case"top":a=i-7}switch(e){case"top-right":case"bottom-right":n=-t;break;case"top-left":case"bottom-left":n=t;break;case"left":n=i;break;case"right":n=-i}}else{switch(i=Math.abs(i),r=Math.abs(r),e){case"top-right":case"top-left":case"top":a=r-7;break;case"bottom-right":case"bottom-left":case"bottom":a=7-r}switch(e){case"top-right":case"bottom-right":case"right":n=-i;break;case"top-left":case"bottom-left":case"left":n=i}}return[n,a]}function bg(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function wg(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f){let m=a.textMaxSize.evaluate(t,{},u);void 0===m&&(m=o);const g=e.layers[0].layout,_=g.get("icon-offset").evaluate(t,{},u),y=Mg(i.horizontal)||i.vertical,v="globe"===d.name,x=qf,b=o/x,w=e.tilePixelRatio*m/x,S=(k=e.overscaling,e.zoom>18&&k>2&&(k>>=1),Math.max(na/(512*k),1)*g.get("symbol-spacing")),T=g.get("text-padding")*e.tilePixelRatio,E=g.get("icon-padding")*e.tilePixelRatio,M=Gt(g.get("text-max-angle")),A="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement"),P="map"===g.get("icon-rotation-alignment")&&"point"!==g.get("symbol-placement"),C=g.get("symbol-placement"),I=S/2;var k;const D=g.get("icon-text-fit").evaluate(t,{},u),R=g.get("icon-text-fit-padding").evaluate(t,{},u),L="none"!==D;let z;!1===e.hasAnyIconTextFit&&L&&(e.hasAnyIconTextFit=!0),r&&L&&(e.allowVerticalPlacement&&i.vertical&&(z=Um(r,i.vertical,D,R,_,b)),y&&(r=Um(r,y,D,R,_,b)));const F=(o,s,m)=>{if(s.x<0||s.x>=na||s.y<0||s.y>=na)return;let g=null;if(v){const{x:e,y:t,z:i}=d.projectTilePoint(s.x,s.y,m);g={anchor:new Gm(e,t,i,0,void 0),up:d.upVector(m,s.x,s.y)}}!function(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,v,x,b,w,S,T,E,M){const A=e.addToLineVertexArray(t,r);let P,C,I,k,D,R,L,z=0,F=0,O=0,B=0,N=-1,V=-1;const j={};let U=Ir("");const G=i?i.anchor:t,q="none"!==l.layout.get("icon-text-fit").evaluate(x,{},T);let H=0,W=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")?[H,W]=l.layout.get("text-offset").evaluate(x,{},T).map((e=>e*qf)):(H=l.layout.get("text-radial-offset").evaluate(x,{},T)*qf,W=yg),e.allowVerticalPlacement&&n.vertical){const e=n.vertical;if(f)R=Pg(e),s&&(L=Pg(s));else{const i=l.layout.get("text-rotate").evaluate(x,{},T)+90;I=Ag(c,G,t,h,u,d,e,p,i,m),s&&(k=Ag(c,G,t,h,u,d,s,_,i))}}if(a){const r=l.layout.get("icon-rotate").evaluate(x,{},T),n=cg(a,r,w,q),o=s?cg(s,r,w,q):void 0;C=Ag(c,G,t,h,u,d,a,_,r),z=4*n.length;const p=e.iconSizeData;let f=null;"source"===p.kind?(f=[Hf*l.layout.get("icon-size").evaluate(x,{},T)],f[0]>Tg&&ui("".concat(e.layerIds[0],': Value for "icon-size" is >= ').concat(Sg,'. Reduce your "icon-size".'))):"composite"===p.kind&&(f=[Hf*b.compositeIconSizes[0].evaluate(x,{},T),Hf*b.compositeIconSizes[1].evaluate(x,{},T)],(f[0]>Tg||f[1]>Tg)&&ui("".concat(e.layerIds[0],': Value for "icon-size" is >= ').concat(Sg,'. Reduce your "icon-size".'))),e.addSymbols(e.icon,n,f,v,y,x,!1,i,t,A.lineStartIndex,A.lineLength,-1,S,T,E,M),N=e.icon.placedSymbolArray.length-1,o&&(F=4*o.length,e.addSymbols(e.icon,o,f,v,y,x,Pm.vertical,i,t,A.lineStartIndex,A.lineLength,-1,S,T,E,M),V=e.icon.placedSymbolArray.length-1)}for(const Y in n.horizontal){const r=n.horizontal[Y];P||(U=Ir(r.text),f?D=Pg(r):P=Ag(c,G,t,h,u,d,r,p,l.layout.get("text-rotate").evaluate(x,{},T),m));const a=1===r.positionedLines.length;if(O+=Eg(e,i,t,r,o,l,f,x,m,A,n.vertical?Pm.horizontal:Pm.horizontalOnly,a?Object.keys(n.horizontal):[Y],j,N,b,S,T,E),a)break}n.vertical&&(B+=Eg(e,i,t,n.vertical,o,l,f,x,m,A,Pm.vertical,["vertical"],j,V,b,S,T,E));let Z=-1;const Q=(e,t)=>e?Math.max(e,t):t;Z=Q(D,Z),Z=Q(R,Z),Z=Q(L,Z);const X=Z>-1?1:0;e.glyphOffsetArray.length>=65535&&ui("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,x.sortKey),e.symbolInstances.emplaceBack(t.x,t.y,G.x,G.y,G.z,j.right>=0?j.right:-1,j.center>=0?j.center:-1,j.left>=0?j.left:-1,j.vertical>=0?j.vertical:-1,N,V,U,void 0!==P?P:e.collisionBoxArray.length,void 0!==P?P+1:e.collisionBoxArray.length,void 0!==I?I:e.collisionBoxArray.length,void 0!==I?I+1:e.collisionBoxArray.length,void 0!==C?C:e.collisionBoxArray.length,void 0!==C?C+1:e.collisionBoxArray.length,k||e.collisionBoxArray.length,k?k+1:e.collisionBoxArray.length,h,O,B,z,F,X,0,H,W,Z,0,q?1:0)}(e,s,g,o,i,r,n,z,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,T,A,l,0,E,P,_,t,a,c,h,u,p,f)};if("line"===C)for(const O of Jm(t.geometry,0,0,na,na)){const t=Xm(O,S,M,i.vertical||y,r,x,w,e.overscaling,na);for(const i of t)y&&Cg(e,y.text,I,i)||F(O,i,u)}else if("line-center"===C){for(const O of t.geometry)if(O.length>1){const e=Qm(O,M,i.vertical||y,r,x,w);e&&F(O,e,u)}}else if("Polygon"===t.type)for(const O of Vd(t.geometry,0)){const e=mg(O,16);F(O[0],new Gm(e.x,e.y,0,0,void 0),u)}else if("LineString"===t.type)for(const O of t.geometry)F(O,new Gm(O[0].x,O[0].y,0,0,void 0),u);else if("Point"===t.type)for(const O of t.geometry)for(const e of O)F([e],new Gm(e.x,e.y,0,0,void 0),u)}const Sg=255,Tg=Sg*Hf;function Eg(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_){const y=function(e,t,i,r,n,a,o,s){const l=[];if(0===t.positionedLines.length)return l;const c=r.layout.get("text-rotate").evaluate(a,{})*Math.PI/180,h=function(e){const t=e[0],i=e[1],r=t*i;return r>0?[t,-i]:r<0?[-t,i]:0===t?[i,t]:[i,-t]}(i);let u=Math.abs(t.top-t.bottom);for(const m of t.positionedLines)u-=m.lineOffset;const d=t.positionedLines.length,p=u/d;let f=t.top-i[1];for(let m=0;m<d;++m){const e=t.positionedLines[m];f=fg(t,p,f,m);for(const r of e.positionedGlyphs){if(!r.rect)continue;const e=r.rect||{};let a=Am+1,u=!0,d=1,p=0;if(r.imageName){const e=o[r.imageName];if(!e)continue;if(e.sdf){ui("SDF images are not supported in formatted text and will be ignored.");continue}u=!1,d=e.pixelRatio,a=$m/d}const m=(n||s)&&r.vertical,g=r.metrics.advance*r.scale/2,_=r.metrics,y=r.rect;if(null===y)continue;s&&t.verticalizable&&(p=r.imageName?g-r.metrics.width*r.scale/2:0);const v=n?[r.x+g,r.y]:[0,0];let x=[0,0],b=[0,0],w=!1;n||(m?(b=[r.x+g+h[0],r.y+h[1]-p],w=!0):x=[r.x+g+i[0],r.y+i[1]-p]);const S=y.w*r.scale/(d*(r.localGlyph?ag:1)),T=y.h*r.scale/(d*(r.localGlyph?ag:1));let E,M,A,P;if(m){const e=r.y-f,t=new Vt(-g,g-e),i=-Math.PI/2,n=new Vt(...b);E=new Vt(-g+x[0],x[1]),E._rotateAround(i,t)._add(n),E.x+=-e+g,E.y-=(_.left-a)*r.scale;const o=r.imageName?_.advance*r.scale:qf*r.scale,s=String.fromCodePoint(r.glyph);Kf(s)?E.x+=(1-a)*r.scale:$f(s)?E.x+=o-_.height*r.scale+(-a-1)*r.scale:E.x+=r.imageName||_.width+2*a===y.w&&_.height+2*a===y.h?(o-T)/2:(o-(_.height+2*a)*r.scale)/2,M=new Vt(E.x,E.y-S),A=new Vt(E.x+T,E.y),P=new Vt(E.x+T,E.y-S)}else{const e=(_.left-a)*r.scale-g+x[0],t=(-_.top-a)*r.scale+x[1],i=e+S,n=t+T;E=new Vt(e,t),M=new Vt(i,t),A=new Vt(e,n),P=new Vt(i,n)}if(c){let e;e=n?new Vt(0,0):w?new Vt(h[0],h[1]):new Vt(i[0],i[1]),E._rotateAround(c,e),M._rotateAround(c,e),A._rotateAround(c,e),P._rotateAround(c,e)}const C=new Vt(0,0),I=new Vt(0,0);l.push({tl:E,tr:M,bl:A,br:P,texPrimary:e,texSecondary:void 0,writingMode:t.writingMode,glyphOffset:v,sectionIndex:r.sectionIndex,isSDF:u,pixelOffsetTL:C,pixelOffsetBR:I,minFontScaleX:0,minFontScaleY:0})}}return l}(0,r,l,a,o,s,n,e.allowVerticalPlacement),v=e.textSizeData;let x=null;"source"===v.kind?(x=[Hf*a.layout.get("text-size").evaluate(s,{},g)],x[0]>Tg&&ui("".concat(e.layerIds[0],': Value for "text-size" is >= ').concat(Sg,'. Reduce your "text-size".'))):"composite"===v.kind&&(x=[Hf*f.compositeTextSizes[0].evaluate(s,{},g),Hf*f.compositeTextSizes[1].evaluate(s,{},g)],(x[0]>Tg||x[1]>Tg)&&ui("".concat(e.layerIds[0],': Value for "text-size" is >= ').concat(Sg,'. Reduce your "text-size".'))),e.addSymbols(e.text,y,x,l,o,s,h,t,i,c.lineStartIndex,c.lineLength,p,m,g,_,!1);for(const b of u)d[b]=e.text.placedSymbolArray.length-1;return 4*y.length}function Mg(e){for(const t in e)return e[t];return null}function Ag(e,t,i,r,n,a,o,s,l,c){let h=o.top,u=o.bottom,d=o.left,p=o.right;const f=o.collisionPadding;if(f&&(d-=f[0],h-=f[1],p+=f[2],u+=f[3]),l){const e=new Vt(d,h),t=new Vt(p,h),i=new Vt(d,u),r=new Vt(p,u),n=Gt(l);let a=new Vt(0,0);c&&(a=new Vt(c[0],c[1])),e._rotateAround(n,a),t._rotateAround(n,a),i._rotateAround(n,a),r._rotateAround(n,a),d=Math.min(e.x,t.x,i.x,r.x),p=Math.max(e.x,t.x,i.x,r.x),h=Math.min(e.y,t.y,i.y,r.y),u=Math.max(e.y,t.y,i.y,r.y)}return e.emplaceBack(t.x,t.y,t.z,i.x,i.y,d,h,p,u,s,r,n,a),e.length-1}function Pg(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function Cg(e,t,i,r){const n=e.compareText;if(t in n){const e=n[t];for(let t=e.length-1;t>=0;t--)if(r.dist(e[t])<i)return!0}else n[t]=[];return n[t].push(r),!1}function Ig(e,t){const i=e.fovAboveCenter,r=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,n=(e._camera.position[2]*e.worldSize-r)/Math.cos(e._pitch),a=Math.sin(i)*n/Math.sin(Math.max(Math.PI/2-e._pitch-i,.01)),o=Math.sin(e._pitch)*a+n;return Math.min(1.01*o,n*(1/e._horizonShift))}function kg(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const i=Math.pow(2,-e.z),r=e.x*i,n=(e.x+1)*i,a=e.y*i,o=(e.y+1)*i,s=bh(r),l=bh(n),c=wh(a),h=wh(o),u=t.project(s,c),d=t.project(l,c),p=t.project(l,h),f=t.project(s,h);let m=Math.min(u.x,d.x,p.x,f.x),g=Math.min(u.y,d.y,p.y,f.y),_=Math.max(u.x,d.x,p.x,f.x),y=Math.max(u.y,d.y,p.y,f.y);const v=i/16;function x(e,i,r,n,a,o){const s=(r+a)/2,l=(n+o)/2,c=t.project(bh(s),wh(l)),h=Math.max(0,m-c.x,g-c.y,c.x-_,c.y-y);m=Math.min(m,c.x),_=Math.max(_,c.x),g=Math.min(g,c.y),y=Math.max(y,c.y),h>v&&(x(e,c,r,n,s,l),x(c,i,s,l,a,o))}x(u,d,r,a,n,a),x(d,p,n,a,n,o),x(p,f,n,o,r,o),x(f,u,r,o,r,a),m-=v,g-=v,_+=v,y+=v;const b=1/Math.max(_-m,y-g);return{scale:b,x:m*b,y:g*b,x2:_*b,y2:y*b,projection:t}}function Dg(e,t){let{x:i,y:r}=t;return new Vt(((i-(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0))*e.scale-e.x)*na,(r*e.scale-e.y)*na)}const Rg=e.a9.identity(new Float32Array(16));class Lg{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new oh(0,0)}projectTilePoint(e,t,i){return{x:e,y:t,z:0}}locationPoint(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e._coordinatePoint(e.locationCoordinate(t),i)}pixelsPerMeter(e,t){return xh(1,e)*t}pixelSpaceConversion(e,t,i){return 1}farthestPixelDistance(e){return Ig(e,e.pixelsPerMeter)}pointCoordinate(e,t,i,r){const n=e.horizonLineFromTop(!1),a=new Vt(t,Math.max(n,i));return e.rayIntersectionCoordinate(e.pointRayIntersection(a,r))}pointCoordinate3D(e,t,i){const r=new Vt(t,i);if(e.elevation)return e.elevation.pointCoordinate(r);{const t=this.pointCoordinate(e,r.x,r.y,0);return[t.x,t.y,t.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const i=e.horizonLineFromTop();return t.y<i}createInversionMatrix(e,t){return Rg}createTileMatrix(t,i,r){let n,a,o;const s=r.canonical,l=e.a9.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const c=kg(s,this);n=1,a=c.x+r.wrap*c.scale,o=c.y,e.a9.scale(l,l,[n/c.scale,n/c.scale,t.pixelsPerMeter/i])}else n=i/t.zoomScale(s.z),a=(s.x+Math.pow(2,s.z)*r.wrap)*n,o=s.y*n;return e.a9.translate(l,l,[a,o,0]),e.a9.scale(l,l,[n/na,n/na,1]),l}upVector(e,t,i){return[0,0,1]}upVectorScale(e,t,i){return{metersToTile:1}}}class zg extends Lg{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,i]=this.parallels=e.parallels||[29.5,45.5],r=Math.sin(Gt(t));this.n=(r+Math.sin(Gt(i)))/2,this.c=1+r*(2*this.n-r),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:i,c:r,r0:n}=this,a=Gt(e-this.center[0]),o=Gt(t),s=Math.sqrt(r-2*i*Math.sin(o))/i;return{x:s*Math.sin(a*i),y:s*Math.cos(a*i)-n,z:0}}unproject(e,t){const{n:i,c:r,r0:n}=this,a=n+t;let o=Math.atan2(e,Math.abs(a))*Math.sign(a);a*i<0&&(o-=Math.PI*Math.sign(e)*Math.sign(a));const s=Gt(this.center[0])*i;o=Jt(o,-Math.PI-s,Math.PI-s);const l=Xt(qt(o/i)+this.center[0],-180,180),c=Math.asin(Xt((r-(e*e+a*a)*i*i)/(2*i),-1,1)),h=Xt(qt(c),-Th,Th);return new oh(l,h)}}const Fg=1.340264,Og=-.081106,Bg=893e-6,Ng=.003796,Vg=Math.sqrt(3)/2;class jg extends Lg{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const i=Math.asin(Vg*Math.sin(t)),r=i*i,n=r*r*r;return{x:.5*(e*Math.cos(i)/(Vg*(Fg+3*Og*r+n*(7*Bg+9*Ng*r)))/Math.PI+.5),y:1-.5*(i*(Fg+Og*r+n*(Bg+Ng*r))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let i=t=(2*(1-t)-1)*Math.PI,r=i*i,n=r*r*r;for(let c,h,u,d=0;d<12&&(h=i*(Fg+Og*r+n*(Bg+Ng*r))-t,u=Fg+3*Og*r+n*(7*Bg+9*Ng*r),c=h/u,i=Xt(i-c,-Math.PI/3,Math.PI/3),r=i*i,n=r*r*r,!(Math.abs(c)<1e-12));++d);const a=Vg*e*(Fg+3*Og*r+n*(7*Bg+9*Ng*r))/Math.cos(i),o=Math.asin(Math.sin(i)/Vg),s=Xt(180*a/Math.PI,-180,180),l=Xt(180*o/Math.PI,-Th,Th);return new oh(s,l)}}class Ug extends Lg{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const i=360*(e-.5),r=Xt(360*(.5-t),-Th,Th);return new oh(i,r)}}const Gg=Math.PI/2;function qg(e){return Math.tan((Gg+e)/2)}class Hg extends Lg{constructor(e){super(e),this.center=e.center||[0,30];const[t,i]=this.parallels=e.parallels||[30,30];let r=Gt(t),n=Gt(i);this.southernCenter=r+n<0,this.southernCenter&&(r=-r,n=-n);const a=Math.cos(r),o=qg(r);this.n=r===n?Math.sin(r):Math.log(a/Math.cos(n))/Math.log(qg(n)/o),this.f=a*Math.pow(qg(r),this.n)/this.n}project(e,t){t=Gt(t),this.southernCenter&&(t=-t),e=Gt(e-this.center[0]);const i=1e-6,{n:r,f:n}=this;n>0?t<-Gg+i&&(t=-Gg+i):t>Gg-i&&(t=Gg-i);const a=n/Math.pow(qg(t),r);let o=a*Math.sin(r*e),s=n-a*Math.cos(r*e);return o=.5*(o/Math.PI+.5),s=.5*(s/Math.PI+.5),{x:o,y:this.southernCenter?s:1-s,z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,this.southernCenter&&(t=1-t),t=(2*(1-t)-.5)*Math.PI;const{n:i,f:r}=this,n=r-t,a=Math.sign(n),o=Math.sign(i)*Math.sqrt(e*e+n*n);let s=Math.atan2(e,Math.abs(n))*a;n*i<0&&(s-=Math.PI*Math.sign(e)*a);const l=Xt(qt(s/i)+this.center[0],-180,180),c=Xt(qt(2*Math.atan(Math.pow(r/o,1/i))-Gg),-Th,Th);return new oh(l,this.southernCenter?-c:c)}}class Wg extends Lg{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:yh(e),y:vh(t),z:0}}unproject(e,t){const i=bh(e),r=wh(t);return new oh(i,r)}}const Zg=Gt(Th);class Qg extends Lg{project(e,t){const i=(t=Gt(t))*t,r=i*i;return{x:.5*((e=Gt(e))*(.8707-.131979*i+r*(r*(.003971*i-.001529*r)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+i*(.015085+r*(.028874*i-.044475-.005916*r)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let i=t=(2*(1-t)-1)*Math.PI,r=25,n=0,a=i*i;do{a=i*i;const e=a*a;n=(i*(1.007226+a*(.015085+e*(.028874*a-.044475-.005916*e)))-t)/(1.007226+a*(.045255+e*(.259866*a-.311325-.005916*11*e))),i=Xt(i-n,-Zg,Zg)}while(Math.abs(n)>1e-6&&--r>0);a=i*i;const o=Xt(qt(e/(.8707+a*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979))),-180,180),s=qt(i);return new oh(o,s)}}const Xg=Gt(Th);class Yg extends Lg{project(e,t){t=Gt(t),e=Gt(e);const i=Math.cos(t),r=2/Math.PI,n=Math.acos(i*Math.cos(e/2)),a=Math.sin(n)/n,o=.5*(e*r+2*i*Math.sin(e/2)/a)||0,s=.5*(t+Math.sin(t)/a)||0;return{x:.5*(o/Math.PI+.5),y:1-.5*(s/Math.PI+1),z:0}}unproject(e,t){let i=e=(2*e-.5)*Math.PI,r=t=(2*(1-t)-1)*Math.PI,n=25;const a=1e-6;let o=0,s=0;do{const n=Math.cos(r),a=Math.sin(r),l=2*a*n,c=a*a,h=n*n,u=Math.cos(i/2),d=Math.sin(i/2),p=2*u*d,f=d*d,m=1-h*u*u,g=m?1/m:0,_=m?Math.acos(n*u)*Math.sqrt(1/m):0,y=.5*(2*_*n*d+2*i/Math.PI)-e,v=.5*(_*a+r)-t,x=.5*g*(h*f+_*n*u*c)+1/Math.PI,b=g*(p*l/4-_*a*d),w=.125*g*(l*d-_*a*h*p),S=.5*g*(c*u+_*f*n)+.5,T=b*w-S*x;o=(v*b-y*S)/T,s=(y*w-v*x)/T,i=Xt(i-o,-Math.PI,Math.PI),r=Xt(r-s,-Xg,Xg)}while((Math.abs(o)>a||Math.abs(s)>a)&&--n>0);return new oh(qt(i),qt(r))}}class Jg extends Lg{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Gt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:i,cosPhi:r}=this;return{x:Gt(e)*r*i+.5,y:-Math.sin(Gt(t))/r*i+.5,z:0}}unproject(e,t){const{scale:i,cosPhi:r}=this,n=-(t-.5)/i,a=Xt(qt((e-.5)/i)/r,-180,180),o=Math.asin(Xt(n*r,-1,1)),s=Xt(qt(o),-Th,Th);return new oh(a,s)}}class Kg extends Wg{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,i,r){const n=ku(t,i,r),a=Lu(Eu(r));return e.Q.transformMat4(n,n,a),{x:n[0],y:n[1],z:n[2]}}locationPoint(t,i){const r=rh(i.lat,i.lng),n=e.Q.normalize([],r),a=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(i),t._centerAltitude):t._centerAltitude,o=xh(1,0)*na*a;e.Q.scaleAndAdd(r,r,n,o);const s=e.a9.identity(new Float64Array(16));return e.a9.multiply(s,t.pixelMatrix,t.globeMatrix),e.Q.transformMat4(r,r,s),new Vt(r[0],r[1])}pixelsPerMeter(e,t){return xh(1,0)*t}pixelSpaceConversion(e,t,i){const r=xh(1,e)*t,n=Ur(xh(1,45)*t,r,i);return this.pixelsPerMeter(e,t)/n}createTileMatrix(t,i,r){const n=zu(Eu(r.canonical));return e.a9.multiply(new Float64Array(16),t.globeMatrix,n)}createInversionMatrix(t,i){const{center:r}=t,n=Lu(Eu(i));return e.a9.rotateY(n,n,Gt(r.lng)),e.a9.rotateX(n,n,Gt(r.lat)),e.a9.scale(n,n,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(n)}pointCoordinate(e,t,i,r){return wu(e,t,i,!0)||new Ch(0,0)}pointCoordinate3D(e,t,i){const r=this.pointCoordinate(e,t,i,0);return[r.x,r.y,r.z]}isPointAboveHorizon(e,t){return!wu(e,t.x,t.y,!1)}farthestPixelDistance(t){const i=function(t,i){const r=t.cameraToCenterDistance,n=t._centerAltitude*i,a=t._camera,o=t._camera.forward(),s=e.Q.add([],e.Q.scale([],o,-r),[0,0,n]),l=t.worldSize/(2*Math.PI),c=[0,0,-l],h=t.width/t.height,u=Math.tan(t.fovAboveCenter),d=e.Q.scale([],a.up(),u),p=e.Q.scale([],a.right(),u*h),f=e.Q.normalize([],e.Q.add([],e.Q.add([],o,d),p)),m=[];let g;if(new lu(s,f).closestPointOnSphere(c,l,m)){const i=e.Q.add([],m,c),r=e.Q.sub([],i,s);g=Math.cos(t.fovAboveCenter)*e.Q.length(r)}else{const t=e.Q.sub([],s,c),i=e.Q.sub([],c,s);e.Q.normalize(i,i);const r=e.Q.length(t)-l;g=Math.sqrt(r*(r+2*l));const n=Math.acos(g/(l+r))-Math.acos(e.Q.dot(o,i));g*=Math.cos(n)}return 1.01*g}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),r=Nu(t.zoom);if(r>0){const e=Ig(t,xh(1,t.center.lat)*t.worldSize),n=t.worldSize/(2*Math.PI),a=Math.max(t.width,t.height)/t.worldSize*Math.PI;return Ur(i,e+n*(1-Math.cos(a)),Math.pow(r,10))}return i}upVector(e,t,i){return ku(t,i,e,1)}upVectorScale(e){return{metersToTile:xu(Du(Eu(e)))}}}function $g(e){const t=e.parallels,i=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new Wg(e);case"equirectangular":return new Ug(e);case"naturalEarth":return new Qg(e);case"equalEarth":return new jg(e);case"winkelTripel":return new Yg(e);case"albers":return i?new Jg(e):new zg(e);case"lambertConformalConic":return i?new Jg(e):new Hg(e);case"globe":return new Kg(e)}throw new Error("Invalid projection name: ".concat(e.name))}const e_=dp.types,t_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function i_(e,t,i,r,n,a,o,s,l,c,h,u,d){const p=s?Math.min(Tg,Math.round(s[0])):0,f=s?Math.min(Tg,Math.round(s[1])):0;e.emplaceBack(t,i,Math.round(32*r),Math.round(32*n),a,o,(p<<1)+(l?1:0),f,16*c,16*h,256*u,256*d)}function r_(e,t,i){e.emplaceBack(t,i)}function n_(e,t,i,r,n,a,o){e.emplaceBack(t,i,r,n,a,o)}function a_(e,t,i,r,n){e.emplaceBack(t,i,r,n),e.emplaceBack(t,i,r,n),e.emplaceBack(t,i,r,n),e.emplaceBack(t,i,r,n)}function o_(e){for(const t of e.sections)if(As(t.text))return!0;return!1}class s_{constructor(e){this.layoutVertexArray=new zl,this.indexArray=new Gl,this.programConfigurations=e,this.segments=new mc,this.dynamicLayoutVertexArray=new Il,this.opacityVertexArray=new Ol,this.placedSymbolArray=new ac,this.iconTransitioningVertexArray=new Bl,this.globeExtVertexArray=new Fl,this.zOffsetVertexArray=new Wl}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}upload(e,t,i,r,n){this.isEmpty()||(i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Of.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,t_,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Nf.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Ff.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||n)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Bf.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||r)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}fs(s_,"SymbolBuffers");class l_{constructor(e,t,i){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new i,this.segments=new mc,this.collisionVertexArray=new Ul,this.collisionVertexArrayExt=new Il}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Vf.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,jf.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}fs(l_,"CollisionBuffers");class c_{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=e.a9.identity([]),this.placementViewportMatrix=e.a9.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Wf(this.zoom,i["text-size"]),this.iconSizeData=Wf(this.zoom,i["icon-size"]);const r=this.layers[0].layout,n=r.get("symbol-sort-key"),a=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==a&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===a||"auto"===a&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map((e=>Pm[e])),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=r.get("symbol-z-elevate")}createArrays(){this.text=new s_(new Uc(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new s_(new Uc(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new lc,this.lineVertexArray=new cc,this.symbolInstances=new sc}calculateGlyphDependencies(e,t,i,r,n){for(let a=0;a<e.length;a++){const i=e.codePointAt(a);if(void 0===i)break;if(t[i]=!0,r&&n&&i<=65535){const i=Jf[e.charAt(a)];i&&(t[i.charCodeAt(0)]=!0)}}}populate(t,i,r,n){const a=this.layers[0],o=a.layout,s="globe"===this.projection.name,l=o.get("text-font"),c=o.get("text-field"),h=o.get("icon-image"),u=("constant"!==c.value.kind||c.value.value instanceof pn&&!c.value.value.isEmpty()||c.value.value.toString().length>0)&&("constant"!==l.value.kind||l.value.value.length>0),d="constant"!==h.value.kind||!!h.value.value||Object.keys(h.parameters).length>0,p=o.get("symbol-sort-key");if(this.features=[],!u&&!d)return;const f=i.iconDependencies,m=i.glyphDependencies,g=i.availableImages,_=new Vs(this.zoom);for(const{feature:y,id:v,index:x,sourceLayerIndex:b}of t){const t=a._featureFilter.needGeometry,i=Bh(y,t);if(!a._featureFilter.filter(_,i,r))continue;if(t||(i.geometry=Oh(y,r,n)),s&&1!==y.type&&r.z<=5){const t=i.geometry,n=.98078528056,a=(t,i)=>{const a=ku(t.x,t.y,r,1),o=ku(i.x,i.y,r,1);return e.Q.dot(a,o)<n};for(let e=0;e<t.length;e++)t[e]=Rh(t[e],a)}let c,h;if(u){const e=a.getValueAndResolveTokens("text-field",i,r,g),t=pn.factory(e);o_(t)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Os()||this.hasRTLText&&Ns.isParsed())&&(c=Yf(t,a,i))}if(d){const e=a.getValueAndResolveTokens("icon-image",i,r,g);h=e instanceof fn?e:fn.fromString(e)}if(!c&&!h)continue;const w=this.sortFeaturesByKey?p.evaluate(i,{},r):void 0;if(this.features.push({id:v,text:c,icon:h,index:x,sourceLayerIndex:b,geometry:i.geometry,properties:y.properties,type:e_[y.type],sortKey:w}),h&&(f[h.namePrimary]=!0,h.nameSecondary&&(f[h.nameSecondary]=!0)),c){const e=l.evaluate(i,{},r).join(","),t="map"===o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Pm.vertical)>=0;for(const i of c.sections)if(i.image)f[i.image.namePrimary]=!0;else{const r=xs(c.toString()),n=i.fontStack||e,a=m[n]=m[n]||{};this.calculateGlyphDependencies(i.text,a,t,this.allowVerticalPlacement,r)}}}"line"===o.get("symbol-placement")&&(this.features=function(e){const t={},i={},r=[];let n=0;function a(t){r.push(e[t]),n++}function o(e,t,n){const a=i[e];return delete i[e],i[t]=a,r[a].geometry[0].pop(),r[a].geometry[0]=r[a].geometry[0].concat(n[0]),a}function s(e,i,n){const a=t[i];return delete t[i],t[e]=a,r[a].geometry[0].shift(),r[a].geometry[0]=n[0].concat(r[a].geometry[0]),a}function l(e,t,i){const r=i?t[0][t[0].length-1]:t[0][0];return"".concat(e,":").concat(r.x,":").concat(r.y)}for(let c=0;c<e.length;c++){const h=e[c],u=h.geometry,d=h.text?h.text.toString():null;if(!d){a(c);continue}const p=l(d,u),f=l(d,u,!0);if(p in i&&f in t&&i[p]!==t[f]){const e=s(p,f,u),n=o(p,f,r[e].geometry);delete t[p],delete i[f],i[l(d,r[n].geometry,!0)]=n,r[e].geometry=null}else p in i?o(p,f,u):f in t?s(p,f,u):(a(c),t[p]=n-1,i[f]=n-1)}return r.filter((e=>e.geometry))}(this.features)),this.sortFeaturesByKey&&this.features.sort(((e,t)=>e.sortKey-t.sortKey))}update(e,t,i,r,n){const a=0!==Object.keys(e).length;if(a&&!this.stateDependentLayers.length)return;const o=a?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,t,o,i,r,n),this.icon.programConfigurations.updatePaintArrays(e,t,o,i,r,n)}updateZOffset(){const e=(e,t,r)=>{i+=t,i>e.length&&e.resize(i);for(let n=-t;n<0;n++)e.emplace(n+i,r)},t=(e,t,i)=>{r+=t,r>e.length&&e.resize(r);for(let n=-t;n<0;n++)e.emplace(n+r,i)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let i=0,r=0;for(let n=0;n<this.symbolInstances.length;n++){const i=this.symbolInstances.get(n),{numHorizontalGlyphVertices:r,numVerticalGlyphVertices:a,numIconVertices:o}=i,s=i.zOffset,l=o>0;if((r>0||a>0)&&(e(this.text.zOffsetVertexArray,r,s),e(this.text.zOffsetVertexArray,a,s)),l){const{placedIconSymbolIndex:e,verticalPlacedIconSymbolIndex:r}=i;e>=0&&t(this.icon.zOffsetVertexArray,o,s),r>=0&&t(this.icon.zOffsetVertexArray,i.numVerticalIconVertices,s)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=$g(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const i=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:r,y:n}of t)this.lineVertexArray.emplaceBack(r,n);return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m){const g=e.indexArray,_=e.layoutVertexArray,y=e.globeExtVertexArray,v=e.segments.prepareSegment(4*t.length,_,g,this.canOverlap?a.sortKey:void 0),x=this.glyphOffsetArray.length,b=v.vertexLength,w=this.allowVerticalPlacement&&o===Pm.vertical?Math.PI/2:0,S=a.text&&a.text.sections;for(let E=0;E<t.length;E++){const{tl:r,tr:n,bl:o,br:c,texPrimary:h,texSecondary:u,pixelOffsetTL:x,pixelOffsetBR:b,minFontScaleX:T,minFontScaleY:M,glyphOffset:A,isSDF:P,sectionIndex:C}=t[E],I=v.vertexLength,k=A[1];if(i_(_,l.x,l.y,r.x,k+r.y,h.x,h.y,i,P,x.x,x.y,T,M),i_(_,l.x,l.y,n.x,k+n.y,h.x+h.w,h.y,i,P,b.x,x.y,T,M),i_(_,l.x,l.y,o.x,k+o.y,h.x,h.y+h.h,i,P,x.x,b.y,T,M),i_(_,l.x,l.y,c.x,k+c.y,h.x+h.w,h.y+h.h,i,P,b.x,b.y,T,M),s){const{x:t,y:i,z:r}=s.anchor,[n,a,o]=s.up;n_(y,t,i,r,n,a,o),n_(y,t,i,r,n,a,o),n_(y,t,i,r,n,a,o),n_(y,t,i,r,n,a,o),a_(e.dynamicLayoutVertexArray,t,i,r,w)}else a_(e.dynamicLayoutVertexArray,l.x,l.y,l.z,w);if(m){const t=u||h;r_(e.iconTransitioningVertexArray,t.x,t.y),r_(e.iconTransitioningVertexArray,t.x+t.w,t.y),r_(e.iconTransitioningVertexArray,t.x,t.y+t.h),r_(e.iconTransitioningVertexArray,t.x+t.w,t.y+t.h)}g.emplaceBack(I,I+1,I+2),g.emplaceBack(I+1,I+2,I+3),v.vertexLength+=4,v.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(A[0]),E!==t.length-1&&C===t[E+1].sectionIndex||e.programConfigurations.populatePaintArrays(_.length,a,a.index,{},d,p,f,S&&S[C])}const T=s?s.anchor:l;e.placedSymbolArray.emplaceBack(T.x,T.y,T.z,l.x,l.y,x,this.glyphOffsetArray.length-x,b,c,h,l.segment,i?i[0]:0,i?i[1]:0,r[0],r[1],o,0,!1,0,u,0)}_commitLayoutVertex(e,t,i,r,n,a,o){e.emplaceBack(t,i,r,n,a,Math.round(o.x),Math.round(o.y))}_addCollisionDebugVertices(e,t,i,r,n,a,o){const s=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),l=s.vertexLength,c=o.tileAnchorX,h=o.tileAnchorY;for(let d=0;d<4;d++)i.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(i.collisionVertexArrayExt,t,e.padding,o.zOffset),this._commitLayoutVertex(i.layoutVertexArray,r,n,a,c,h,new Vt(e.x1,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,r,n,a,c,h,new Vt(e.x2,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,r,n,a,c,h,new Vt(e.x2,e.y2)),this._commitLayoutVertex(i.layoutVertexArray,r,n,a,c,h,new Vt(e.x1,e.y2)),s.vertexLength+=4;const u=i.indexArray;u.emplaceBack(l,l+1),u.emplaceBack(l+1,l+2),u.emplaceBack(l+2,l+3),u.emplaceBack(l+3,l),s.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,i,r,n,a){for(let o=r;o<n;o++){const r=i.get(o),n=this.getSymbolInstanceTextSize(e,a,t,o);this._addCollisionDebugVertices(r,n,this.textCollisionBox,r.projectedAnchorX,r.projectedAnchorY,r.projectedAnchorZ,a)}}_addIconDebugCollisionBoxes(e,t,i,r,n,a){for(let o=r;o<n;o++){const r=i.get(o),n=this.getSymbolInstanceIconSize(e,t,a.placedIconSymbolIndex);this._addCollisionDebugVertices(r,n,this.iconCollisionBox,r.projectedAnchorX,r.projectedAnchorY,r.projectedAnchorZ,a)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new l_(Vl,Uf.members,Bl),this.iconCollisionBox=new l_(Vl,Uf.members,Bl);const i=Qf(this.iconSizeData,e),r=Qf(this.textSizeData,e);for(let n=0;n<this.symbolInstances.length;n++){const a=this.symbolInstances.get(n);this._addTextDebugCollisionBoxes(r,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a),this._addTextDebugCollisionBoxes(r,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._addIconDebugCollisionBoxes(i,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex,a),this._addIconDebugCollisionBoxes(i,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a)}}getSymbolInstanceTextSize(e,t,i,r){const n=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:r),a=Zf(this.textSizeData,e,n)/qf;return this.tilePixelRatio*a}getSymbolInstanceIconSize(e,t,i){const r=this.icon.placedSymbolArray.get(i),n=Zf(this.iconSizeData,e,r);return this.tilePixelRatio*n}_commitDebugCollisionVertexUpdate(e,t,i,r){e.emplaceBack(t,-i,-i,r),e.emplaceBack(t,i,-i,r),e.emplaceBack(t,i,i,r),e.emplaceBack(t,-i,i,r)}_updateTextDebugCollisionBoxes(e,t,i,r,n,a){for(let o=r;o<n;o++){const r=i.get(o),n=this.getSymbolInstanceTextSize(e,a,t,o);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,n,r.padding,a.zOffset)}}_updateIconDebugCollisionBoxes(e,t,i,r,n,a){for(let o=r;o<n;o++){const r=i.get(o),n=this.getSymbolInstanceIconSize(e,t,a.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,n,r.padding,a.zOffset)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=Qf(this.iconSizeData,e),r=Qf(this.textSizeData,e);for(let n=0;n<this.symbolInstances.length;n++){const a=this.symbolInstances.get(n);this._updateTextDebugCollisionBoxes(r,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a),this._updateTextDebugCollisionBoxes(r,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._updateIconDebugCollisionBoxes(i,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex,a),this._updateIconDebugCollisionBoxes(i,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,i,r,n,a,o,s,l){const c={};if(t<i){const{x1:i,y1:r,x2:n,y2:a,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:h,tileAnchorX:u,tileAnchorY:d,featureIndex:p}=e.get(t);c.textBox={x1:i,y1:r,x2:n,y2:a,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:h,tileAnchorX:u,tileAnchorY:d},c.textFeatureIndex=p}if(r<n){const{x1:t,y1:i,x2:n,y2:a,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:h,tileAnchorX:u,tileAnchorY:d,featureIndex:p}=e.get(r);c.verticalTextBox={x1:t,y1:i,x2:n,y2:a,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:h,tileAnchorX:u,tileAnchorY:d},c.verticalTextFeatureIndex=p}if(a<o){const{x1:t,y1:i,x2:r,y2:n,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:h,tileAnchorX:u,tileAnchorY:d,featureIndex:p}=e.get(a);c.iconBox={x1:t,y1:i,x2:r,y2:n,padding:o,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:h,tileAnchorX:u,tileAnchorY:d},c.iconFeatureIndex=p}if(s<l){const{x1:t,y1:i,x2:r,y2:n,padding:a,projectedAnchorX:o,projectedAnchorY:l,projectedAnchorZ:h,tileAnchorX:u,tileAnchorY:d,featureIndex:p}=e.get(s);c.verticalIconBox={x1:t,y1:i,x2:r,y2:n,padding:a,projectedAnchorX:o,projectedAnchorY:l,projectedAnchorZ:h,tileAnchorX:u,tileAnchorY:d},c.verticalIconFeatureIndex=p}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const i=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,t){const i=e.placedSymbolArray.get(t),r=i.vertexStartIndex+4*i.numGlyphs;for(let n=i.vertexStartIndex;n<r;n+=4)e.indexArray.emplaceBack(n,n+1,n+2),e.indexArray.emplaceBack(n+1,n+2,n+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),i=Math.cos(e),r=[],n=[],a=[];for(let o=0;o<this.symbolInstances.length;++o){a.push(o);const e=this.symbolInstances.get(o);r.push(0|Math.round(t*e.tileAnchorX+i*e.tileAnchorY)),n.push(e.featureIndex)}return a.sort(((e,t)=>r[e]-r[t]||n[t]-n[e])),a}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,t)=>this.symbolInstances.get(t).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,t){const i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===t?i.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex);const{rightJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:r,leftJustifiedTextSymbolIndex:n,verticalPlacedTextSymbolIndex:a,placedIconSymbolIndex:o,verticalPlacedIconSymbolIndex:s}=t;i>=0&&this.addIndicesForPlacedSymbol(this.text,i),r>=0&&r!==i&&this.addIndicesForPlacedSymbol(this.text,r),n>=0&&n!==r&&n!==i&&this.addIndicesForPlacedSymbol(this.text,n),a>=0&&this.addIndicesForPlacedSymbol(this.text,a),o>=0&&this.addIndicesForPlacedSymbol(this.icon,o),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}fs(c_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),c_.addDynamicAttributes=a_;const h_=new Ks({"symbol-placement":new Xs(tl.layout_symbol["symbol-placement"]),"symbol-spacing":new Xs(tl.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Xs(tl.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ys(tl.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Xs(tl.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Xs(tl.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Xs(tl.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Xs(tl.layout_symbol["icon-ignore-placement"]),"icon-optional":new Xs(tl.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Xs(tl.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ys(tl.layout_symbol["icon-size"]),"icon-text-fit":new Ys(tl.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ys(tl.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ys(tl.layout_symbol["icon-image"]),"icon-rotate":new Ys(tl.layout_symbol["icon-rotate"]),"icon-padding":new Xs(tl.layout_symbol["icon-padding"]),"icon-keep-upright":new Xs(tl.layout_symbol["icon-keep-upright"]),"icon-offset":new Ys(tl.layout_symbol["icon-offset"]),"icon-anchor":new Ys(tl.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Xs(tl.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Xs(tl.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Xs(tl.layout_symbol["text-rotation-alignment"]),"text-field":new Ys(tl.layout_symbol["text-field"]),"text-font":new Ys(tl.layout_symbol["text-font"]),"text-size":new Ys(tl.layout_symbol["text-size"]),"text-max-width":new Ys(tl.layout_symbol["text-max-width"]),"text-line-height":new Ys(tl.layout_symbol["text-line-height"]),"text-letter-spacing":new Ys(tl.layout_symbol["text-letter-spacing"]),"text-justify":new Ys(tl.layout_symbol["text-justify"]),"text-radial-offset":new Ys(tl.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Xs(tl.layout_symbol["text-variable-anchor"]),"text-anchor":new Ys(tl.layout_symbol["text-anchor"]),"text-max-angle":new Xs(tl.layout_symbol["text-max-angle"]),"text-writing-mode":new Xs(tl.layout_symbol["text-writing-mode"]),"text-rotate":new Ys(tl.layout_symbol["text-rotate"]),"text-padding":new Xs(tl.layout_symbol["text-padding"]),"text-keep-upright":new Xs(tl.layout_symbol["text-keep-upright"]),"text-transform":new Ys(tl.layout_symbol["text-transform"]),"text-offset":new Ys(tl.layout_symbol["text-offset"]),"text-allow-overlap":new Xs(tl.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Xs(tl.layout_symbol["text-ignore-placement"]),"text-optional":new Xs(tl.layout_symbol["text-optional"]),visibility:new Xs(tl.layout_symbol.visibility)});var u_={paint:new Ks({"icon-opacity":new Ys(tl.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Ys(tl.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Ys(tl.paint_symbol["text-emissive-strength"]),"icon-color":new Ys(tl.paint_symbol["icon-color"]),"icon-halo-color":new Ys(tl.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ys(tl.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ys(tl.paint_symbol["icon-halo-blur"]),"icon-translate":new Xs(tl.paint_symbol["icon-translate"]),"icon-translate-anchor":new Xs(tl.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Ys(tl.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Ys(tl.paint_symbol["text-opacity"]),"text-color":new Ys(tl.paint_symbol["text-color"],{runtimeType:Kr,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Ys(tl.paint_symbol["text-halo-color"]),"text-halo-width":new Ys(tl.paint_symbol["text-halo-width"]),"text-halo-blur":new Ys(tl.paint_symbol["text-halo-blur"]),"text-translate":new Xs(tl.paint_symbol["text-translate"]),"text-translate-anchor":new Xs(tl.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Xs(tl.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Xs(tl.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Xs(tl.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Xs(tl.paint_symbol["icon-color-brightness-max"])}),layout:h_};class d_{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Qr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}fs(d_,"FormatSectionOverride",{omit:["defaultValue"]});class p_ extends vl{constructor(t,i,r){super(t,u_,i,r),this._colorAdjustmentMatrix=e.a9.identity([])}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const i=this.layout.get("text-writing-mode");if(i){const e=[];for(const t of i)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(t,i,r,n){return this._saturation===t&&this._contrast===i&&this._brightnessMin===r&&this._brightnessMax===n||(this._colorAdjustmentMatrix=function(t,i,r,n){t=Ci(t),i=Pi(i);const a=e.a9.create(),o=t/3,s=1-2*o,l=[s,o,o,0,o,s,o,0,o,o,s,0,0,0,0,1],c=.5-.5*i,h=n-r;return e.a9.multiply(a,[h,0,0,0,0,h,0,0,0,0,h,0,r,r,r,1],[i,0,0,0,0,i,0,0,0,0,i,0,c,c,c,1]),e.a9.multiply(a,a,l),a}(t,i,r,n),this._saturation=t,this._contrast=i,this._brightnessMin=r,this._brightnessMax=n),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,t,i,r){const n=this.layout.get(e).evaluate(t,{},i,r),a=this._unevaluatedLayout._values[e];return a.isDataDriven()||is(a.value)||!n?n:function(e,t){return t.replace(/{([^{}]+)}/g,((t,i)=>i in e?String(e[i]):""))}(t.properties,n)}createBucket(e){return new c_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of u_.paint.overridableProperties){if(!p_.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),i=new d_(t),r=new ts(i,t.property.specification,this.scope,this.options);let n=null;n="constant"===t.value.kind||"source"===t.value.kind?new ns("source",r):new as("composite",r,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new Zs(t.property,n,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven())&&p_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const i=e.get("text-field"),r=u_.paint.properties[t];let n=!1;const a=e=>{for(const t of e)if(r.overrides&&r.overrides.hasOverride(t))return void(n=!0)};if("constant"===i.value.kind&&i.value.value instanceof pn)a(i.value.value.sections);else if("source"===i.value.kind){const e=t=>{n||(t instanceof vn&&_n(t.value)===rn?a(t.value.sections):t instanceof Sn?a(t.sections):t.eachChild(e))},t=i.value;t._styleExpression&&e(t._styleExpression.expression)}return n}getProgramIds(){const e=0!==this.paint.get("icon-opacity").constantOr(1),t=0!==this.paint.get("text-opacity").constantOr(1),i=[];return e&&i.push("symbolIcon"),t&&i.push("symbolSDF"),i}getDefaultProgramParams(e,t){return{config:new jc(this,t),overrideFog:!1}}}const f_=new Ks({visibility:new Xs(tl.layout_background.visibility)});var m_={paint:new Ks({"background-color":new Xs(tl.paint_background["background-color"]),"background-pattern":new Xs(tl.paint_background["background-pattern"]),"background-opacity":new Xs(tl.paint_background["background-opacity"]),"background-emissive-strength":new Xs(tl.paint_background["background-emissive-strength"])}),layout:f_};const g_=new Ks({visibility:new Xs(tl.layout_raster.visibility)});var __={paint:new Ks({"raster-opacity":new Xs(tl.paint_raster["raster-opacity"]),"raster-color":new Js(tl.paint_raster["raster-color"]),"raster-color-mix":new Xs(tl.paint_raster["raster-color-mix"]),"raster-color-range":new Xs(tl.paint_raster["raster-color-range"]),"raster-hue-rotate":new Xs(tl.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Xs(tl.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Xs(tl.paint_raster["raster-brightness-max"]),"raster-saturation":new Xs(tl.paint_raster["raster-saturation"]),"raster-contrast":new Xs(tl.paint_raster["raster-contrast"]),"raster-resampling":new Xs(tl.paint_raster["raster-resampling"]),"raster-fade-duration":new Xs(tl.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Xs(tl.paint_raster["raster-emissive-strength"]),"raster-array-band":new Xs(tl.paint_raster["raster-array-band"]),"raster-elevation":new Xs(tl.paint_raster["raster-elevation"])}),layout:g_},y_=Sl([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class v_{constructor(e,t,i,r){this.context=e,this.format=i,this.texture=e.gl.createTexture(),this.update(t,r)}update(e,t,i){const{width:r,height:n}=e,{context:a}=this,{gl:o}=a;if(o.bindTexture(o.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===o.RGBA&&(!t||!1!==t.premultiply)),i||this.size&&this.size[0]===r&&this.size[1]===n){const{x:t,y:a}=i||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)o.texSubImage2D(o.TEXTURE_2D,0,t,a,o.RGBA,o.UNSIGNED_BYTE,e);else{let i=this.format,s=o.UNSIGNED_BYTE;this.format===o.R32F&&(i=o.RED,s=o.FLOAT),o.texSubImage2D(o.TEXTURE_2D,0,t,a,r,n,i,s,e.data)}}else if(this.size=[r,n],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let t=this.format;this.format===o.R8&&(t=o.RED),o.texImage2D(o.TEXTURE_2D,0,this.format,t,o.UNSIGNED_BYTE,e)}else{let t=this.format,i=this.format,a=o.UNSIGNED_BYTE;this.format===o.DEPTH_COMPONENT&&(t=o.DEPTH_COMPONENT16,a=o.UNSIGNED_SHORT),this.format===o.R8&&(i=o.RED),this.format===o.R32F&&(a=o.FLOAT,i=o.RED),o.texImage2D(o.TEXTURE_2D,0,t,r,n,0,i,a,e.data)}this.useMipmap=Boolean(t&&t.useMipmap),this.useMipmap&&o.generateMipmap(o.TEXTURE_2D)}bind(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_2D,this.texture),e!==this.minFilter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,this.useMipmap&&!i?e===n.NEAREST?n.NEAREST_MIPMAP_NEAREST:n.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),t!==this.wrapS&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,t),this.wrapS=t)}bindExtraParam(e,t,i,r){const{context:n}=this,{gl:a}=n;a.bindTexture(a.TEXTURE_2D,this.texture),t!==this.magFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,t),this.magFilter=t),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap?e===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,i),this.wrapS=i),r!==this.wrapT&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,r),this.wrapT=r)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class x_{constructor(e,t){this.context=e,this.texture=t}bind(e,t){const{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_2D,this.texture),e!==this.minFilter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t),this.wrapS=t)}}function b_(t,i,r,n,a,o,s,l){const c=[t,i,1,r,n,1,a,o,1],h=[s,l,1],u=e.ct.adjoint([],c),[d,p,f]=e.Q.transformMat3(h,h,u);return e.ct.multiply(c,c,[d,0,0,0,p,0,0,0,f])}function w_(t,i,r,n,a,o,s,l){const c=function(t,i,r,n,a,o,s,l){const c=b_(0,0,1,0,1,1,0,1),h=b_(t,i,r,n,a,o,s,l),u=e.ct.adjoint([],c);return e.ct.multiply(h,h,u)}(t,i,r,n,a,o,s,l);return[c[2]/c[8]/na,c[5]/c[8]/na]}function S_(e){return[e[0],Math.min(Math.max(e[1],-Th),Th)]}class T_ extends zr{constructor(e,t,i,r){super(),this.id=e,this.dispatcher=i,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(r),this.options=t,this._dirty=!1}load(e,t){if(this._loaded=t||!1,this.fire(new Rr("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=nr(this.map._requestManager.transformRequest(this.url,Xi.Image),((t,i)=>{this._imageRequest=null,this._loaded=!0,t?this.fire(new Lr(t)):i&&(this.image=i instanceof HTMLImageElement?ki.getImageData(i):i,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new x_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Rr("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof x_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let t=e[0][1],i=e[0][1];for(const n of e)n[1]>i&&(i=n[1]),n[1]<t&&(t=n[1]);const r=(i+t)/2;if(r>Th?this.onNorthPole=!0:r<-Th&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const t=e.map(Ch.fromLngLat);this.tileID=function(e){let t=1/0,i=1/0,r=-1/0,n=-1/0;for(const c of e)t=Math.min(t,c.x),i=Math.min(i,c.y),r=Math.max(r,c.x),n=Math.max(n,c.y);const a=Math.max(r-t,n-i),o=Math.max(0,Math.floor(-Math.log(a)/Math.LN2)),s=Math.pow(2,o);let l=Math.floor((t+r)/2*s);return l>1&&(l-=1),new hh(o,l,Math.floor((i+n)/2*s))}(t),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Rr("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const e in this.tiles){const t=this.tiles[e];"loaded"!==t.state&&(t.state="loaded",t.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=kg(new hh(0,0,0),this.map.transform.projection),r=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(e){const t=e[1].x-e[0].x,i=e[1].y-e[0].y,r=e[2].x-e[1].x,n=e[2].y-e[1].y,a=e[3].x-e[2].x,o=e[3].y-e[2].y,s=e[0].x-e[3].x,l=e[0].y-e[3].y,c=t*n-r*i,h=r*o-a*n,u=a*l-s*o,d=s*i-t*l;return c>0&&h>0&&u>0&&d>0||c<0&&h<0&&u<0&&d<0}(r))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const n=kg(this.tileID,this.map.transform.projection),[a,o,s,l]=this.coordinates.map((e=>{const t=n.projection.project(e[0],e[1]);return Dg(n,t)._round()}));this.perspectiveTransform=w_(a.x,a.y,o.x,o.y,s.x,s.y,l.x,l.y);const c=this._boundsArray=new Al;c.emplaceBack(a.x,a.y,0,0),c.emplaceBack(o.x,o.y,na,0),c.emplaceBack(l.x,l.y,0,na),c.emplaceBack(s.x,s.y,na,na),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(c,y_.members),this.boundsSegments=mc.simpleSegment(0,0,4,2);const h=[],u=[S_((d=this.coordinates)[0]),S_(d[1]),S_(d[2]),S_(d[3])];var d;const[p,f,m,g]=function(e){let t=e[0][0],i=t,r=e[0][1],n=r;for(let a=1;a<e.length;a++)e[a][0]<t?t=e[a][0]:e[a][0]>i&&(i=e[a][0]),e[a][1]<r?r=e[a][1]:e[a][1]>n&&(n=e[a][1]);return[t,r,i-t,n-r]}(u);{const n=new Al,[a,o,s,l]=function(e){let t=e[0].x,i=t,r=e[0].y,n=r;for(let a=1;a<e.length;a++)e[a].x<t?t=e[a].x:e[a].x>i&&(i=e[a].x),e[a].y<r?r=e[a].y:e[a].y>n&&(n=e[a].y);return[t,r,i-t,n-r]}(r),c=e=>[(e.x-a)/s,(e.y-o)/l],[u,d,_,y]=r.map(c),v=function(t,i,r,n,a,o,s,l){const c=b_(0,0,1,0,1,1,0,1),h=b_(t,i,r,n,a,o,s,l),u=e.ct.adjoint([],h);return e.ct.multiply(c,c,u)}(u[0],u[1],d[0],d[1],_[0],_[1],y[0],y[1]);this.elevatedGlobePerspectiveTransform=w_(u[0],u[1],d[0],d[1],_[0],_[1],y[0],y[1]);const x=(t,i)=>{h.push(t.lng);const r=Math.round((t.lng-p)/m*na),a=Math.round((t.lat-f)/g*na),o=c(i),s=e.Q.transformMat3([],[o[0],o[1],1],v),l=Math.round(s[0]/s[2]*na),u=Math.round(s[1]/s[2]*na);n.emplaceBack(r,a,l,u)},b=r[3].x-r[0].x,w=r[3].y-r[0].y,S=r[2].x-r[1].x,T=r[2].y-r[1].y;for(let e=0;e<65;e++){const t=e/64,n=[r[0].x+t*b,r[0].y+t*w],a=[r[1].x+t*S,r[1].y+t*T],o=a[0]-n[0],s=a[1]-n[1];for(let e=0;e<65;e++){const t=e/64,r={x:n[0]+o*t,y:n[1]+s*t,z:0};x(i.projection.unproject(r.x,r.y),r)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(n,y_.members)}{this.maxLongitudeTriangleSize=0;let e=[],i=new Gl;const r=(t,r,n)=>{i.emplaceBack(t,r,n);const a=h[t],o=h[r],s=h[n],l=Math.min(Math.min(a,o),s),c=Math.max(Math.max(a,o),s)-l;c>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=c),e.push(l+c/2)};for(let t=0;t<64;t++)for(let e=0;e<64;e++){const i=65*t+e,n=i+1,a=i+65,o=a+1;r(i,a,n),r(n,a,o)}[e,i]=function(e,t){const i=Array.from({length:e.length},((e,t)=>t));i.sort(((t,i)=>e[t]-e[i]));const r=[],n=new Gl;for(let a=0;a<i.length;a++){const o=i[a];r.push(e[o]);const s=3*o,l=s+1;n.emplaceBack(t.uint16[s],t.uint16[l],t.uint16[l+1])}return[r,n]}(e,i),this.elevatedGlobeTrianglesCenterLongitudes=e,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(i)}this.elevatedGlobeSegments=mc.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,m/na,0,g/na,0,0,f,p,0])}prepare(){const e=0!==Object.keys(this.tiles).length;if(this.tileID&&!e)return;const t=this.map.painter.context,i=t.gl;!this._dirty||this.texture instanceof x_||(this.texture?this.texture.update(this.image):(this.texture=new v_(t,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(t)}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const t=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!t)return null;const i=this.elevatedGlobeTrianglesCenterLongitudes;let r=((e,t)=>e+360*Math.round((t-e)/360))(e+180,i[0]);const n=new mc,a=(e,i)=>{n.segments.push({vertexOffset:0,primitiveOffset:e,vertexLength:t.segments[0].vertexLength,primitiveLength:i,sortKey:void 0,vaos:{}})},o=.51*this.maxLongitudeTriangleSize;if(Math.abs(i[0]-r)<=o){const e=Ai(i,0,i.length,r+o);return e===i.length||a(e,Mi(i,e+1,i.length,r+360-o)-e),n}r<i[0]&&(r+=360);const s=Mi(i,0,i.length,r-o);if(s===i.length)return a(0,i.length),n;a(0,s-0);const l=Ai(i,s+1,i.length,r+o);return l!==i.length&&a(l,i.length-l),n}}const E_=(Math.pow(256,2)-1)/16907520;class M_ extends vl{constructor(e,t,i){super(e,__,t,i),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof T_&&(e._source.onNorthPole||e._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(e){"raster-color"!==e&&"raster-color-range"!==e||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap())return;if(!this._curRampRange)return;const t=this._transitionablePaint._values["raster-color"].value.expression,[i,r]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(i)&&isNaN(r)||i===this._curRampRange[0]&&r===this._curRampRange[1]||(this.colorRamp=sd({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:i,end:r}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[i,r])}}const A_=new Ks({visibility:new Xs(tl["layout_raster-particle"].visibility)});var P_={paint:new Ks({"raster-particle-array-band":new Xs(tl["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Xs(tl["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Js(tl["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Xs(tl["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Xs(tl["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Xs(tl["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Xs(tl["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:A_};class C_ extends vl{constructor(e,t,i){super(e,P_,t,i),this._updateColorRamp(),this.lastInvalidatedAt=ki.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){"raster-particle-color"!==e&&"raster-particle-max-speed"!==e||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===e&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,t=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=sd({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:t}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ki.now()}}class I_ extends vl{constructor(e,t){super(e,{},t),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const k_=new Ks({visibility:new Xs(tl.layout_sky.visibility)});var D_={paint:new Ks({"sky-type":new Xs(tl.paint_sky["sky-type"]),"sky-atmosphere-sun":new Xs(tl.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Xs(tl.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Xs(tl.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Xs(tl.paint_sky["sky-gradient-radius"]),"sky-gradient":new Js(tl.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Xs(tl.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Xs(tl.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Xs(tl.paint_sky["sky-opacity"])}),layout:k_};function R_(t,i,r){const n=[0,0,1],a=e.bl.identity([]);return e.bl.rotateY(a,a,r?-Gt(t)+Math.PI:Gt(t)),e.bl.rotateX(a,a,-Gt(i)),e.Q.transformQuat(n,n,a),e.Q.normalize(n,n)}var L_={paint:new Ks({})};function z_(t,i){const r=O_(t.projection,t.zoom,t.width,t.height),n=function(t,i,r,n,a){const o=new oh(r.lng-180*B_,r.lat),s=new oh(r.lng+180*B_,r.lat),l=t.project(o.lng,o.lat),c=t.project(s.lng,s.lat),h=-Math.atan2(c.y-l.y,c.x-l.x),u=Ch.fromLngLat(r);u.y=Xt(u.y,-1+B_,1-B_);const d=u.toLngLat(),p=t.project(d.lng,d.lat),f=Ch.fromLngLat(d);f.x+=B_;const m=f.toLngLat(),g=t.project(m.lng,m.lat),_=V_(g.x-p.x,g.y-p.y,h),y=Ch.fromLngLat(d);y.y+=B_;const v=y.toLngLat(),x=t.project(v.lng,v.lat),b=V_(x.x-p.x,x.y-p.y,h),w=Math.abs(_.x)/Math.abs(b.y),S=e.a9.identity([]);e.a9.rotateZ(S,S,-h*(1-(a?0:n)));const T=e.a9.identity([]);return e.a9.scale(T,T,[1,1-(1-w)*n,1]),T[4]=-b.x/b.y*n,e.a9.rotateZ(T,T,h),e.a9.multiply(T,S,T),T}(t.projection,0,t.center,r,i),a=F_(t);return e.a9.scale(n,n,[a,a,1]),n}function F_(e){const t=e.projection,i=O_(e.projection,e.zoom,e.width,e.height),r=N_(t,e.center),n=N_(t,oh.convert(t.center));return Math.pow(2,r*i+(1-i)*n)}function O_(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const a=e.range;if(!a)return 0;const o=Math.min(n,Math.max(i,r)),s=Math.log(o/1024)/Math.LN2;return Yt(a[0]+s,a[1]+s,t)}const B_=1/4e4;function N_(e,t){const i=Xt(t.lat,-Th,Th),r=new oh(t.lng-180*B_,i),n=new oh(t.lng+180*B_,i),a=e.project(r.lng,i),o=e.project(n.lng,i),s=Ch.fromLngLat(r),l=Ch.fromLngLat(n),c=o.x-a.x,h=o.y-a.y,u=l.x-s.x,d=l.y-s.y,p=Math.sqrt((u*u+d*d)/(c*c+h*h));return Math.log(p)/Math.LN2}function V_(e,t,i){const r=Math.cos(i),n=Math.sin(i);return{x:e*r-t*n,y:e*n+t*r}}function j_(t,i,r){e.a9.identity(t),e.a9.rotateZ(t,t,Gt(i[2])),e.a9.rotateX(t,t,Gt(i[0])),e.a9.rotateY(t,t,Gt(i[1])),e.a9.scale(t,t,r),e.a9.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function U_(t,i,r,n,a,o,s,l){const c=[r[0]-i[0],r[1]-i[1],0],h=[n[0]-i[0],n[1]-i[1],0];if(e.Q.length(c)<1e-12||e.Q.length(h)<1e-12)return e.bl.identity(t);const u=e.Q.cross([],c,h);e.Q.normalize(u,u),e.Q.subtract(h,n,i),c[2]=(o-a)*l,h[2]=(s-a)*l;const d=c;return e.Q.cross(d,c,h),e.Q.normalize(d,d),e.bl.rotationTo(t,u,d)}function G_(t,i){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=Nu(i.zoom),a=function(t,i,r){const n=i.worldSize,a=[t[12],t[13],t[14]],o=wh(a[1]/n),s=bh(a[0]/n),l=e.a9.identity([]),c=xh(1,o)*n,h=xh(1,0)*n*Mh(o,i.zoom),u=1/Fu(n);let d=h*u;if(r){const e=O_(i.projection,i.zoom,i.width,i.height,1024);d=u*i.projection.pixelSpaceConversion(i.center.lat,n,e)}const p=rh(o,s);e.Q.add(p,p,e.Q.scale([],e.Q.normalize([],p),c*d*a[2]));const f=function(t){const i=[t[0],t[1],t[2]];let r=[0,1,0];const n=e.Q.cross([],r,i);return e.Q.cross(r,i,n),0===e.Q.squaredLength(r)&&(r=[0,1,0],e.Q.cross(n,i,r)),e.Q.normalize(n,n),e.Q.normalize(r,r),e.Q.normalize(i,i),[n[0],n[1],n[2],0,r[0],r[1],r[2],0,i[0],i[1],i[2],0,t[0],t[1],t[2],1]}(p);e.a9.scale(l,l,[d,d,d*c]),e.a9.translate(l,l,[-a[0],-a[1],-a[2]]);const m=e.a9.multiply([],i.globeMatrix,f);return e.a9.multiply(m,m,l),e.a9.multiply(m,m,t),m}(t,i,r);if(n>0){const r=function(t,i){const r=i.worldSize,n=xh(1,0)*r*Mh(i.center.lat,i.zoom)/Fu(r),a=xh(1,i.center.lat)*r,o=e.a9.identity([]);return e.a9.rotateY(o,o,Gt(i.center.lng)),e.a9.rotateX(o,o,Gt(i.center.lat)),e.a9.translate(o,o,[0,0,Qc]),e.a9.scale(o,o,[n,n,n*a]),e.a9.translate(o,o,[i.point.x-.5*r,i.point.y-.5*r,0]),e.a9.multiply(o,o,t),e.a9.multiply(o,i.globeMatrix,o)}(t,i);return function(t,i,r){const n=(t,i,r)=>{const n=e.Q.length(t),a=e.Q.length(i),o=Mu(t,i,r);return e.Q.scale(o,o,1/e.Q.length(o)*Ur(n,a,r))},a=n([t[0],t[1],t[2]],[i[0],i[1],i[2]],r),o=n([t[4],t[5],t[6]],[i[4],i[5],i[6]],r),s=n([t[8],t[9],t[10]],[i[8],i[9],i[10]],r),l=Mu([t[12],t[13],t[14]],[i[12],i[13],i[14]],r);return[a[0],a[1],a[2],0,o[0],o[1],o[2],0,s[0],s[1],s[2],0,l[0],l[1],l[2],1]}(a,r,n)}return a}function q_(e,t,i,r){const n=mu.projectAabbCorners(r,i);let a=Number.MAX_VALUE,o=-1;for(let c=0;c<n.length;++c){const e=n[c];e[0]=(.5*e[0]+.5)*t.width,e[1]=(.5-.5*e[1])*t.height,e[2]<a&&(o=c,a=e[2])}const s=e=>new Vt(n[e][0],n[e][1]);let l;switch(o){case 0:case 6:l=[s(1),s(5),s(4),s(7),s(3),s(2),s(1)];break;case 1:case 7:l=[s(0),s(4),s(5),s(6),s(2),s(3),s(0)];break;case 3:case 5:l=[s(1),s(0),s(4),s(7),s(6),s(2),s(1)];break;default:l=[s(1),s(5),s(6),s(7),s(3),s(0),s(1)]}if(Uh(e,l))return a}const H_=Sl([{name:"a_pos_3f",components:3,type:"Float32"}]),W_=Sl([{name:"a_color_3f",components:3,type:"Float32"}]),Z_=Sl([{name:"a_color_4f",components:4,type:"Float32"}]),Q_=Sl([{name:"a_uv_2f",components:2,type:"Float32"}]),X_=Sl([{name:"a_normal_3f",components:3,type:"Float32"}]),Y_=Sl([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),J_=Sl([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class K_{constructor(e,t,i,r){this.message=(e?"".concat(e,": "):"")+i,r&&(this.identifier=r),null!=t&&t.__line__&&(this.line=t.__line__)}}function $_(e,t){const i=-1===e.indexOf("://");try{return new URL(e,i&&t?"http://example.com":void 0),!0}catch(e){return!1}}class ey{constructor(e,t){this.feature=e,this.instancedDataOffset=t,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class ty{constructor(){this.instancedDataArray=new Kl,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class iy{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((e=>e.fqid)),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((e=>e.isStateDependent())).map((e=>e.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1}populate(e,t,i,r){this.tileToMeter=Ph(i);const n=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:a,id:o,index:s,sourceLayerIndex:l}of e){const e=null!=o?o:a.properties&&a.properties.hasOwnProperty("id")?a.properties.id:void 0,c=Bh(a,n);if(!this.layers[0]._featureFilter.filter(new Vs(this.zoom),c,i))continue;const h={id:e,sourceLayerIndex:l,index:s,geometry:n?c.geometry:Oh(a,i,r),properties:a.properties,type:a.type,patterns:{}},u=this.addFeature(h,h.geometry,c);u&&t.featureIndex.insert(a,h.geometry,s,l,this.index,this.instancesPerModel[u].instancedDataArray.length,na/32)}this.lookup=null}update(e,t,i,r){for(const n in this.instancesPerModel){const t=this.instancesPerModel[n];for(const i in e)t.idToFeaturesIndex.hasOwnProperty(i)&&(this.evaluate(t.features[t.idToFeaturesIndex[i]],e[i],t,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const i in this.instancesPerModel){const r=this.instancesPerModel[i];for(const i of r.features){const n=this.layers[0],a=i.feature,o=this.canonical,s=n.paint.get("model-rotation").evaluate(a,{},o),l=n.paint.get("model-scale").evaluate(a,{},o),c=n.paint.get("model-translation").evaluate(a,{},o);e.Q.exactEquals(i.rotation,s)&&e.Q.exactEquals(i.scale,l)&&e.Q.exactEquals(i.translation,c)||(this.evaluate(i,i.featureStates,r,!0),t=!0)}}return t}isEmpty(){for(const e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const t in this.instancesPerModel){const i=this.instancesPerModel[t];i.instancedDataArray.length<0||0===i.instancedDataArray.length||(i.instancedDataBuffer?i.instancedDataBuffer.updateData(i.instancedDataArray):i.instancedDataBuffer=e.createVertexBuffer(i.instancedDataArray,Y_.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const t in this.instancesPerModel){const e=this.instancesPerModel[t];0!==e.instancedDataArray.length&&e.instancedDataBuffer&&e.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const t of this.modelUris)e.removeModel(t,"")}addFeature(e,t,i){const r=this.layers[0],n=r.layout.get("model-id").evaluate(i,{},this.canonical);if(!n)return ui("modelId is not evaluated for layer ".concat(r.id," and it is not going to get rendered.")),n;$_(n,!1)&&(this.modelUris.includes(n)||this.modelUris.push(n)),this.instancesPerModel[n]||(this.instancesPerModel[n]=new ty);const a=this.instancesPerModel[n],o=a.instancedDataArray,s=new ey(i,o.length);for(const l of t)for(const e of l){if(e.x<0||e.x>=na||e.y<0||e.y>=na)continue;const t=(this.lookupDim-1)/na,i=this.lookupDim*(e.y*t|0)+e.x*t|0;if(this.lookup){if(0!==this.lookup[i])continue;this.lookup[i]=1}this.instanceCount++;const r=o.length;o.resize(r+1),a.instancesEvaluatedElevation.push(0),o.float32[16*r]=e.x,o.float32[16*r+1]=e.y}return s.instancedDataCount=a.instancedDataArray.length-s.instancedDataOffset,s.instancedDataCount>0&&(e.id&&(a.idToFeaturesIndex[e.id]=a.features.length),a.features.push(s),this.evaluate(s,{},a,!1)),n}getModelUris(){return this.modelUris}evaluate(e,t,i,r){const n=this.layers[0],a=e.feature,o=this.canonical,s=e.rotation=n.paint.get("model-rotation").evaluate(a,t,o),l=e.scale=n.paint.get("model-scale").evaluate(a,t,o),c=e.translation=n.paint.get("model-translation").evaluate(a,t,o),h=n.paint.get("model-color").evaluate(a,t,o);h.a=n.paint.get("model-color-mix-intensity").evaluate(a,t,o);const u=[];this.maxVerticalOffset<c[2]&&(this.maxVerticalOffset=c[2]),this.maxScale=Math.max(Math.max(this.maxScale,l[0]),Math.max(l[1],l[2])),j_(u,s,l);const d=Math.round(100*h.a)+h.b/1.05;for(let p=0;p<e.instancedDataCount;++p){const t=e.instancedDataOffset+p,n=16*t,a=i.instancedDataArray.float32;let s=0;r&&(s=a[n+6]-i.instancesEvaluatedElevation[t]);const l=0|a[n+1];a[n]=(0|a[n])+h.r/1.05,a[n+1]=l+h.g/1.05,a[n+2]=d,a[n+3]=1/(o.z>10?this.tileToMeter:Ph(o,l)),a[n+4]=c[0],a[n+5]=c[1],a[n+6]=c[2]+s,a[n+7]=u[0],a[n+8]=u[1],a[n+9]=u[2],a[n+10]=u[4],a[n+11]=u[5],a[n+12]=u[6],a[n+13]=u[8],a[n+14]=u[9],a[n+15]=u[10],i.instancesEvaluatedElevation[t]=c[2]}}}fs(iy,"ModelBucket",{omit:["layers"]}),fs(ty,"PerModelAttributes"),fs(ey,"ModelFeature");const ry=new Ks({visibility:new Xs(tl.layout_model.visibility),"model-id":new Ys(tl.layout_model["model-id"])});var ny={paint:new Ks({"model-opacity":new Xs(tl.paint_model["model-opacity"]),"model-rotation":new Ys(tl.paint_model["model-rotation"]),"model-scale":new Ys(tl.paint_model["model-scale"]),"model-translation":new Ys(tl.paint_model["model-translation"]),"model-color":new Ys(tl.paint_model["model-color"]),"model-color-mix-intensity":new Ys(tl.paint_model["model-color-mix-intensity"]),"model-type":new Xs(tl.paint_model["model-type"]),"model-cast-shadows":new Xs(tl.paint_model["model-cast-shadows"]),"model-receive-shadows":new Xs(tl.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Xs(tl.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Ys(tl.paint_model["model-emissive-strength"]),"model-roughness":new Ys(tl.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Ys(tl.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Xs(tl.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Xs(tl.paint_model["model-front-cutoff"])}),layout:ry};const ay=64,oy={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function sy(t,i,r,n,a,o,s,l,c){let h=arguments.length>9&&void 0!==arguments[9]&&arguments[9];const u=r.zoom,d=r.project(n),p=Mh(n.lat,u),f=1/p;e.a9.identity(t),e.a9.translate(t,t,[d.x+s[0]*f,d.y+s[1]*f,s[2]]);let m=1,g=1;const _=r.worldSize;if(h){if("mercator"===r.projection.name){let t=0;r.elevation&&(t=r.elevation.getAtPointOrZero(new Ch(d.x/_,d.y/_),0));const i=e.aa.transformMat4([],[d.x,d.y,t,1],r.projMatrix)[3]/r.cameraToCenterDistance;m=i,g=i*Mh(r.center.lat,u)}else if("globe"===r.projection.name){const i=G_(t,r),a=e.a9.multiply([],r.projMatrix,i),o=[0,0,0,1];e.aa.transformMat4(o,o,a);const s=o[3]/r.cameraToCenterDistance,l=Nu(u),c=r.projection.pixelsPerMeter(n.lat,_)*Mh(n.lat,u),h=r.projection.pixelsPerMeter(r.center.lat,_)*Mh(r.center.lat,u);m=s/Ur(c,Eh(r.center.lat),l),g=s*p/c,m*=h,g*=h}}else m=f;e.a9.scale(t,t,[m,m,g]);const y=[...t],v=i.orientation,x=[];if(j_(x,[v[0]+a[0],v[1]+a[1],v[2]+a[2]],o),e.a9.multiply(t,y,x),l&&r.elevation){let a=0;const o=[];if(c&&r.elevation){a=function(t,i,r,n,a){const o=i.elevation;if(!o)return 0;const s=mu.projectAabbCorners(r,n),l=xh(1,a.lat)*i.worldSize,c=function(t,i){const r=[0,0,1],n=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const a of n){const n=t[a.corners[0]],o=t[a.corners[1]],s=t[a.corners[2]],l=[o[0]-n[0],o[1]-n[1],i*(o[2]-n[2])],c=e.Q.cross(l,l,[s[0]-n[0],s[1]-n[1],i*(s[2]-n[2])]);e.Q.normalize(c,c),a.dotProductWithUp=e.Q.dot(c,r)}return n.sort(((e,t)=>e.dotProductWithUp-t.dotProductWithUp)),n[0].corners}(s,l),h=s[c[0]],u=s[c[1]],d=s[c[2]],p=s[c[3]],f=o.getAtPointOrZero(new Ch(h[0]/i.worldSize,h[1]/i.worldSize),0),m=o.getAtPointOrZero(new Ch(u[0]/i.worldSize,u[1]/i.worldSize),0),g=o.getAtPointOrZero(new Ch(d[0]/i.worldSize,d[1]/i.worldSize),0),_=o.getAtPointOrZero(new Ch(p[0]/i.worldSize,p[1]/i.worldSize),0),y=(f+_)/2,v=(m+g)/2;return y>v?m<g?U_(t,u,p,h,m,_,f,l):U_(t,d,h,p,g,f,_,l):f<_?U_(t,h,u,d,f,m,g,l):U_(t,p,d,u,_,g,m,l),Math.max(y,v)}(o,r,i.aabb,t,n);const s=e.a9.fromQuat([],o),l=e.a9.multiply([],s,x);e.a9.multiply(t,y,l)}else a=r.elevation.getAtPointOrZero(new Ch(d.x/_,d.y/_),0);0!==a&&(t[14]+=a)}}function ly(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.uploaded||(e.gfxTexture=new v_(t,e.image,i?t.gl.R8:t.gl.RGBA,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function cy(e,t,i){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,H_.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,X_.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,Q_.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(12===e.colorArray.bytesPerElement?W_:Z_).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,J_.members,!0)),e.segments=mc.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);const r=e.material;r.pbrMetallicRoughness.baseColorTexture&&ly(r.pbrMetallicRoughness.baseColorTexture,t),r.pbrMetallicRoughness.metallicRoughnessTexture&&ly(r.pbrMetallicRoughness.metallicRoughnessTexture,t),r.normalTexture&&ly(r.normalTexture,t),r.occlusionTexture&&ly(r.occlusionTexture,t,i),r.emissionTexture&&ly(r.emissionTexture,t)}function hy(e,t,i){if(e.meshes)for(const r of e.meshes)cy(r,t,i);if(e.children)for(const r of e.children)hy(r,t,i)}function uy(e){if(e.meshes)for(const t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(const t of e.children)uy(t)}function dy(e){if(e.meshes)for(const i of e.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((t=i.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(const i of e.children)dy(i)}class py{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class fy{constructor(){this.tasks={},this.taskQueue=[],ai(["process"],this),this.invoker=new py(this.process),this.nextId=0}add(e,t){const i=this.nextId++,r=function(e){let{type:t,isSymbolTile:i,zoom:r}=e;return r=r||0,"message"===t?0:"maybePrepare"!==t||i?"parseTile"!==t||i?"parseTile"===t&&i?300-r:"maybePrepare"===t&&i?400-r:500:200-r:100-r}(t);if(0===r){mi();try{e()}finally{}return null}return this.tasks[i]={fn:e,metadata:t,priority:r,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){mi();try{if(this.taskQueue=this.taskQueue.filter((e=>!!this.tasks[e])),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let r=0;r<this.taskQueue.length;r++){const i=this.tasks[this.taskQueue[r]];i.priority<t&&(t=i.priority,e=r)}if(null===e)return null;const i=this.taskQueue[e];return this.taskQueue.splice(e,1),i}remove(){this.invoker.remove()}}class my{constructor(e,t,i){this.target=e,this.parent=t,this.mapId=i,this.callbacks={},this.cancelCallbacks={},ai(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new fy}send(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5?arguments[5]:void 0;const o=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=a,this.callbacks[o]=i);const s=new Set;return this.target.postMessage({id:o,type:e,hasCallback:!!i,targetMapId:r,mustQueue:n,sourceMapId:this.mapId,data:_s(t,s)},s),{cancel:()=>{i&&delete this.callbacks[o],this.target.postMessage({id:o,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(e){const t=e.data,i=t.id;if(i&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[i];delete this.cancelCallbacks[i],e&&e.cancel()}else if(t.mustQueue||mi()){const e=this.callbacks[i],r=this.scheduler.add((()=>this.processTask(i,t)),e&&e.metadata||{type:"message"});r&&(this.cancelCallbacks[i]=r)}else this.processTask(i,t)}processTask(e,t){if(delete this.cancelCallbacks[e],"<response>"===t.type){const i=this.callbacks[e];delete this.callbacks[e],i&&(t.error?i(ys(t.error)):i(null,ys(t.data)))}else{const i=new Set,r=t.hasCallback?(t,r)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?_s(t):null,data:_s(r,i)},i)}:e=>{},n=ys(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,n,r);else if(this.parent.getWorkerSource){const e=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,e[0],n.source,n.scope)[e[1]](n,r)}else r(new Error("Could not find function ".concat(t.type)))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class gy{constructor(e,t){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=ti();const i=this.workerPool.acquire(this.id);for(let r=0;r<i.length;r++){const e=new gy.Actor(i[r],t,this.id);e.name="Worker ".concat(r),this.actors.push(e)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,t,i){Kt(this.actors,((i,r)=>{i.send(e,t,r)}),i=i||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}gy.Actor=my;var _y={workerUrl:"",workerClass:null,workerParams:void 0};function yy(){return null!=_y.workerClass?new _y.workerClass:new self.Worker(_y.workerUrl,_y.workerParams)}const vy="mapboxgl_preloaded_worker_pool";class xy{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<xy.workerCount;)this.workers.push(new yy);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach((e=>{e.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[vy]}numActive(){return Object.keys(this.active).length}}let by;function wy(){return by||(by=new xy),by}xy.workerCount=2;let Sy,Ty,Ey,My,Ay,Py=null;function Cy(){return mi()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Ty||r.DRACO_URL}function Iy(){if(mi()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(My)return My;const e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return My=WebAssembly.validate(e)?r.MESHOPT_SIMD_URL:r.MESHOPT_URL,My}const ky={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Dy={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Ry={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Ly(e,t,i){const r=i.json.bufferViews.length,n=i.buffers.length;t.bufferView=r,i.json.bufferViews[r]={buffer:n,byteLength:e.byteLength},i.buffers[n]=e}const zy="KHR_draco_mesh_compression";function Fy(e,t){const i=e.extensions&&e.extensions[zy];if(!i)return;const r=new Ey.Decoder,n=Gy(t,i.bufferView),a=new Ey.Mesh;if(!r.DecodeArrayToMesh(n,n.byteLength,a))throw new Error("Failed to decode Draco mesh");const o=t.json.accessors[e.indices],s=ky[o.componentType],l=o.count*s.BYTES_PER_ELEMENT,c=Ey._malloc(l);s===Uint16Array?r.GetTrianglesUInt16Array(a,l,c):r.GetTrianglesUInt32Array(a,l,c),Ly(Ey.memory.buffer.slice(c,c+l),o,t),Ey._free(c);for(const h of Object.keys(i.attributes)){const n=r.GetAttributeByUniqueId(a,i.attributes[h]),o=t.json.accessors[e.attributes[h]],s=Dy[o.componentType],l=o.count*Ry[o.type]*ky[o.componentType].BYTES_PER_ELEMENT,c=Ey._malloc(l);r.GetAttributeDataArrayForAllPoints(a,n,Ey[s],l,c),Ly(Ey.memory.buffer.slice(c,c+l),o,t),Ey._free(c)}r.destroy(),a.destroy(),delete e.extensions[zy]}const Oy="EXT_meshopt_compression";function By(e,t){if(!e.extensions||!e.extensions[Oy])return;const i=e.extensions[Oy],r=new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),n=new Uint8Array(i.count*i.byteStride);Ay.decodeGltfBuffer(n,i.count,i.byteStride,r,i.mode,i.filter),e.buffer=t.buffers.length,e.byteOffset=0,t.buffers[e.buffer]=n.buffer,delete e.extensions[Oy]}const Ny=1179937895,Vy=new TextDecoder("utf8");function jy(e,t){return new URL(e,t).href}function Uy(e,t,i,r){return fetch(jy(e.uri,r)).then((e=>e.arrayBuffer())).then((e=>{t.buffers[i]=e}))}function Gy(e,t){const i=e.json.bufferViews[t];return new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function qy(e,t,i,r){if(e.uri){const n=jy(e.uri,r);return fetch(n).then((e=>e.blob())).then((e=>createImageBitmap(e))).then((e=>{t.images[i]=e}))}if(void 0!==e.bufferView){const r=Gy(t,e.bufferView),n=new Blob([r],{type:e.mimeType});return createImageBitmap(n).then((e=>{t.images[i]=e}))}}function Hy(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;const r={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===Ny){const i=new Uint32Array(e,t);let n=2;const a=(i[n++]>>2)-3,o=i[n++]>>2;if(n++,r.json=JSON.parse(Vy.decode(i.subarray(n,n+o))),n+=o,n<a){const a=i[n++];n++;const o=t+(n<<2);r.buffers[0]=e.slice(o,o+a)}}else r.json=JSON.parse(Vy.decode(new Uint8Array(e,t)));const{buffers:n,images:a,meshes:o,extensionsUsed:s,bufferViews:l}=r.json;let c=Promise.resolve();if(n){const e=[];for(let t=0;t<n.length;t++){const a=n[t];a.uri?e.push(Uy(a,r,t,i)):r.buffers[t]||(r.buffers[t]=null)}c=Promise.all(e)}return c.then((()=>{const e=[],t=s&&s.includes(zy),n=s&&s.includes(Oy);if(t&&e.push(function(){if(!Ey)return Sy||(Sy=function(e){let t,i=null;function r(){t=new Uint8Array(i.buffer)}function n(){throw new Error("Unexpected Draco error.")}const a={a:{a:n,d:function(e,i,r){return t.copyWithin(e,i,i+r)},c:function(e){const n=t.length,a=Math.max(e>>>0,Math.ceil(1.2*n)),o=Math.ceil((a-n)/65536);try{return i.grow(o),r(),!0}catch(e){return!1}},b:n}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,a):e.then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,a)))).then((e=>{const{Rb:n,Qb:a,P:o,T:s,X:l,Ja:c,La:h,Qa:u,Va:d,Wa:p,eb:f,jb:m,f:g,e:_,yb:y,zb:v,Ab:x,Bb:b,Db:w,Gb:S}=e.instance.exports;i=_;const T=(()=>{let e=0,i=0,r=0,o=0;return s=>{r&&(n(o),n(e),i+=r,r=e=0),e||(i+=128,e=a(i));const l=s.length+7&-8;let c=e;l>=i&&(r=l,c=o=a(l));for(let e=0;e<s.length;e++)t[c+e]=s[e];return c}})();return r(),g(),{memory:_,_free:n,_malloc:a,Mesh:class{constructor(){this.ptr=o()}destroy(){s(this.ptr)}},Decoder:class{constructor(){this.ptr=c()}destroy(){m(this.ptr)}DecodeArrayToMesh(e,t,i){const r=T(e),n=h(this.ptr,r,t,i.ptr);return!!l(n)}GetAttributeByUniqueId(e,t){return{ptr:u(this.ptr,e.ptr,t)}}GetTrianglesUInt16Array(e,t,i){d(this.ptr,e.ptr,t,i)}GetTrianglesUInt32Array(e,t,i){p(this.ptr,e.ptr,t,i)}GetAttributeDataArrayForAllPoints(e,t,i,r,n){f(this.ptr,e.ptr,t.ptr,i,r,n)}},DT_INT8:y(),DT_UINT8:v(),DT_INT16:x(),DT_UINT16:b(),DT_UINT32:w(),DT_FLOAT32:S()}}))}(fetch(Cy())),Sy.then((e=>{Ey=e,Sy=void 0})))}()),n&&e.push(function(){if(Ay)return;const e=function(e){let t;const i=WebAssembly.instantiateStreaming(e,{}).then((e=>{t=e.instance,t.exports.__wasm_call_ctors()})),r={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},n={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:i,supported:!0,decodeGltfBuffer(e,i,a,o,s,l){!function(e,t,i,r,n,a,o){const s=e.exports.sbrk,l=r+3&-4,c=s(l*n),h=s(a.length),u=new Uint8Array(e.exports.memory.buffer);u.set(a,h);const d=t(c,r,n,h,a.length);if(0===d&&o&&o(c,l,n),i.set(u.subarray(c,c+r*n)),s(c-s(0)),0!==d)throw new Error("Malformed buffer data: ".concat(d))}(t,t.exports[n[s]],e,i,a,o,t.exports[r[l]])}}}(fetch(Iy()));return e.ready.then((()=>{Ay=e}))}()),a)for(let o=0;o<a.length;o++)e.push(qy(a[o],r,o,i));return(e.length?Promise.all(e):Promise.resolve()).then((()=>{if(t&&o)for(const{primitives:e}of o)for(const t of e)Fy(t,r);if(n&&o&&l)for(const e of l)By(e,r);return r}))}))}class Wy{constructor(e,t,i,r){if(this.triangleCount=t.length/3,this.min=new Vt(0,0),this.max=new Vt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===e.length)return;const[n,a]=[e[0].clone(),e[0].clone()];for(let h=1;h<e.length;++h){const t=e[h];n.x=Math.min(n.x,t.x),n.y=Math.min(n.y,t.y),a.x=Math.max(a.x,t.x),a.y=Math.max(a.y,t.y)}if(r){const e=Math.ceil(Math.max(a.x-n.x,a.y-n.y)/r);i=Math.max(i,e)}if(0===i)return;this.min=n,this.max=a;const o=this.max.sub(this.min);o.x=Math.max(o.x,1),o.y=Math.max(o.y,1);const s=Math.max(o.x,o.y)/i;this.cellsX=Math.max(1,Math.ceil(o.x/s)),this.cellsY=Math.max(1,Math.ceil(o.y/s)),this.xScale=1/s,this.yScale=1/s;const l=[];for(let h=0;h<this.triangleCount;h++){const i=e[t[3*h+0]].sub(this.min),r=e[t[3*h+1]].sub(this.min),n=e[t[3*h+2]].sub(this.min),a=Zy(Math.floor(Math.min(i.x,r.x,n.x)),this.xScale,this.cellsX),o=Zy(Math.floor(Math.max(i.x,r.x,n.x)),this.xScale,this.cellsX),c=Zy(Math.floor(Math.min(i.y,r.y,n.y)),this.yScale,this.cellsY),u=Zy(Math.floor(Math.max(i.y,r.y,n.y)),this.yScale,this.cellsY),d=new Vt(0,0),p=new Vt(0,0),f=new Vt(0,0),m=new Vt(0,0);for(let e=c;e<=u;++e){d.y=p.y=e*s,f.y=m.y=(e+1)*s;for(let t=a;t<=o;++t)d.x=f.x=t*s,p.x=m.x=(t+1)*s,(tu(i,r,n,d,p,m)||tu(i,r,n,d,m,f))&&l.push({cellIdx:e*this.cellsX+t,triIdx:h})}}if(0===l.length)return;l.sort(((e,t)=>e.cellIdx-t.cellIdx||e.triIdx-t.triIdx));let c=0;for(;c<l.length;){const e=l[c].cellIdx,t={start:this.payload.length,len:0};for(;c<l.length&&l[c].cellIdx===e;)++t.len,this.payload.push(l[c++].triIdx);this.cells[e]=t}}query(e,t,i){if(0===this.triangleCount||0===this.cells.length)return;if(e.x>this.max.x||this.min.x>t.x)return;if(e.y>this.max.y||this.min.y>t.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let s=0;s<this.lookup.length;s++)this.lookup[s]=0;const r=Zy(e.x-this.min.x,this.xScale,this.cellsX),n=Zy(t.x-this.min.x,this.xScale,this.cellsX),a=Zy(e.y-this.min.y,this.yScale,this.cellsY),o=Zy(t.y-this.min.y,this.yScale,this.cellsY);for(let s=a;s<=o;s++)for(let e=r;e<=n;e++){const t=this.cells[s*this.cellsX+e];if(t)for(let e=0;e<t.len;e++){const r=this.payload[t.start+e],n=Math.floor(r/8),a=1<<r%8;if(!(this.lookup[n]&a)&&(this.lookup[n]|=a,i.push(r),i.length===this.triangleCount))return}}}}function Zy(e,t,i){return Math.max(0,Math.min(i-1,Math.floor(e*t)))}function Qy(e,t){const i=e.json.bufferViews[t.bufferView],r=ky[t.componentType];return new r(e.buffers[i.buffer],(t.byteOffset||0)+(i.byteOffset||0),t.count*(i.byteStride&&i.byteStride!==Ry[t.type]*r.BYTES_PER_ELEMENT?i.byteStride/r.BYTES_PER_ELEMENT:Ry[t.type]))}function Xy(e,t,i,r){const n=ky[t.componentType],a=function(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(n),o=e.json.bufferViews[t.bufferView],s=o.byteStride?o.byteStride/n.BYTES_PER_ELEMENT:Ry[t.type],l=i.float32,c=l.length/i.capacity;for(let h=0,u=0;h<t.count*s;h+=s,u+=c)for(let e=0;e<c;e++)l[u+e]=r[h+e]*a;i._trim()}function Yy(e,t,i){const r=e.indices,n=e.attributes,a={};a.indexArray=new Gl;const o=t.json.accessors[r],s=o.count/3;a.indexArray.reserve(s);const l=Qy(t,o);for(let d=0;d<s;d++)a.indexArray.emplaceBack(l[3*d],l[3*d+1],l[3*d+2]);a.indexArray._trim(),a.vertexArray=new Jl;const c=t.json.accessors[n.POSITION];a.vertexArray.reserve(c.count);const h=Qy(t,c);for(let d=0;d<c.count;d++)a.vertexArray.emplaceBack(h[3*d],h[3*d+1],h[3*d+2]);if(a.vertexArray._trim(),a.aabb=new mu(c.min,c.max),a.centroid=function(e,t){const i=[0,0,0],r=e.length;if(r>0){for(let n=0;n<r;n++){const r=3*e[n];i[0]+=t[r],i[1]+=t[r+1],i[2]+=t[r+2]}i[0]/=r,i[1]/=r,i[2]/=r}return i}(l,h),void 0!==n.COLOR_0){const e=t.json.accessors[n.COLOR_0],i=Ry[e.type],r=Qy(t,e);a.colorArray=3===i?new Jl:new Il,a.colorArray.resize(e.count),Xy(t,e,a.colorArray,r)}if(void 0!==n.NORMAL){a.normalArray=new Jl;const e=t.json.accessors[n.NORMAL];a.normalArray.resize(e.count);const i=Qy(t,e);Xy(t,e,a.normalArray,i)}if(void 0!==n.TEXCOORD_0&&i.length>0){a.texcoordArray=new kl;const e=t.json.accessors[n.TEXCOORD_0];a.texcoordArray.resize(e.count);const i=Qy(t,e);Xy(t,e,a.texcoordArray,i)}if(void 0!==n._FEATURE_ID_RGBA4444){const e=t.json.accessors[n._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(a.featureData=Qy(t,e))}void 0!==n._FEATURE_RGBA4444&&(a.featureData=new Uint32Array(Qy(t,t.json.accessors[n._FEATURE_RGBA4444]).buffer));const u=e.material;return a.material=function(e,t){const{emissiveFactor:i=[0,0,0],alphaMode:r="OPAQUE",alphaCutoff:n=.5,normalTexture:a,occlusionTexture:o,emissiveTexture:s,doubleSided:l}=e,{baseColorFactor:c=[1,1,1,1],metallicFactor:h=1,roughnessFactor:u=1,baseColorTexture:d,metallicRoughnessTexture:p}=e.pbrMetallicRoughness||{},f=o?t[o.index]:void 0;if(o&&o.extensions&&o.extensions.KHR_texture_transform&&f){const e=o.extensions.KHR_texture_transform;f.offsetScale=[e.offset[0],e.offset[1],e.scale[0],e.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new jr(...c),metallicFactor:h,roughnessFactor:u,baseColorTexture:d?t[d.index]:void 0,metallicRoughnessTexture:p?t[p.index]:void 0},doubleSided:l,emissiveFactor:i,alphaMode:r,alphaCutoff:n,normalTexture:a?t[a.index]:void 0,occlusionTexture:f,emissionTexture:s?t[s.index]:void 0,defined:void 0===e.defined}}(void 0!==u?t.json.materials[u]:{defined:!1},i),a}function Jy(t,i,r){const{matrix:n,rotation:a,translation:o,scale:s,mesh:l,extras:c,children:h}=t,u={};if(u.matrix=n||e.a9.fromRotationTranslationScale([],a||[0,0,0,1],o||[0,0,0],s||[1,1,1]),void 0!==l){u.meshes=r[l];const e=u.anchor=[0,0];for(const t of u.meshes){const{min:i,max:r}=t.aabb;e[0]+=i[0]+r[0],e[1]+=i[1]+r[1]}e[0]=Math.floor(e[0]/u.meshes.length/2),e[1]=Math.floor(e[1]/u.meshes.length/2)}if(c&&(c.id&&(u.id=c.id),c.lights&&(u.lights=function(e){if(!e.length)return[];const t=function(e){const t=atob(e),i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=t.codePointAt(r);return i}(e),i=[],r=t.length/24,n=new Uint16Array(t.buffer),a=new Float32Array(t.buffer);for(let o=0;o<r;o++){const e=n[2*o*6]/30,t=n[2*o*6+1]/30,r=n[2*o*6+10]/100,s=a[6*o+1],l=a[6*o+2],c=a[6*o+3],h=a[6*o+4],u=c-s,d=h-l,p=Math.hypot(u,d);i.push({pos:[s+.5*u,l+.5*d,t],normal:[d/p,-u/p,0],width:p,height:e,depth:r,points:[s,l,c,h]})}return i}(c.lights))),h){const e=[];for(const t of h)e.push(Jy(i.json.nodes[t],i,r));u.children=e}return u}function Ky(e){if(0===e.vertices.length||0===e.indices.length)return null;const t=new Wy(e.vertices,e.indices,8,256),[i,r]=[t.min.clone(),t.max.clone()];return{vertices:e.vertices,indices:e.indices,grid:t,min:i,max:r}}function $y(e){if(!e.extras||!e.extras.ground)return null;const t=e.extras.ground;if(!t||!Array.isArray(t)||0===t.length)return null;const i=t[0];if(!i||!Array.isArray(i)||0===i.length)return null;const r=[];for(const o of i){if(!Array.isArray(o)||2!==o.length)continue;const e=o[0],t=o[1];"number"==typeof e&&"number"==typeof t&&r.push(new Vt(e,t))}if(r.length<3)return null;r.length>1&&r[r.length-1].equals(r[0])&&r.pop();let n=0;for(let o=0;o<r.length;o++){const e=r[o],t=r[(o+1)%r.length],i=r[(o+2)%r.length];n+=(e.x-t.x)*(i.y-t.y)-(i.x-t.x)*(e.y-t.y)}n>0&&r.reverse();const a=Nd(r.flatMap((e=>[e.x,e.y])),[]);return 0===a.length?null:{vertices:r,indices:a}}function ev(t,i){const r=[],n=[];let a=0;const o=[];for(const s of t){a=r.length;const t=s.vertexArray.float32,l=s.indexArray.uint16;for(let n=0;n<s.vertexArray.length;n++)o[0]=t[3*n+0],o[1]=t[3*n+1],o[2]=t[3*n+2],e.Q.transformMat4(o,o,i),r.push(new Vt(o[0],o[1]));for(let e=0;e<3*s.indexArray.length;e++)n.push(l[e]+a)}if(n.length%3!=0)return null;for(let e=0;e<n.length;e+=3){const t=r[n[e+0]],i=r[n[e+1]],a=r[n[e+2]];(t.x-i.x)*(a.y-i.y)-(a.x-i.x)*(t.y-i.y)>0&&([n[e+1],n[e+2]]=[n[e+2],n[e+1]])}return{vertices:r,indices:n}}function tv(e){const t=function(e,t){const i=[],r=WebGL2RenderingContext;if(e.json.textures)for(const n of e.json.textures){const a={magFilter:r.LINEAR,minFilter:r.NEAREST,wrapS:r.REPEAT,wrapT:r.REPEAT};void 0!==n.sampler&&Object.assign(a,e.json.samplers[n.sampler]),i.push({image:t[n.source],sampler:a,uploaded:!1})}return i}(e,e.images),i=function(e,t){const i=[];for(const r of e.json.meshes){const n=[];for(const i of r.primitives)n.push(Yy(i,e,t));i.push(n)}return i}(e,t),{scenes:r,scene:n,nodes:a}=e.json,o=r?r[n||0].nodes:a,s=[];for(const l of o)s.push(Jy(a[l],e,i));return function(e,t,i){const r={},n=new Set;for(let a=0;a<e.length;a++){const e=i[t[a]];if(!e.extras)continue;const o=e.extras["mapbox:footprint:version"],s=e.extras["mapbox:footprint:id"];(o||s)&&n.add(a),"1.0.0"===o&&s&&(r[s]=a)}for(let a=0;a<e.length;a++){if(n.has(a))continue;const o=e[a],s=i[t[a]];if(!s.extras)continue;let l=null;o.id in r&&(l=ev(e[r[o.id]].meshes,o.matrix)),l||(l=$y(s)),l&&(o.footprint=Ky(l))}if(n.size>0){const t=Array.from(n.values()).sort(((e,t)=>e-t));for(let i=t.length-1;i>=0;i--)e.splice(t[i],1)}}(s,o,e.json.nodes),s}function iv(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);const t=e.vertexArray.float32,i=e.aabb.min[0]-1,r=e.aabb.min[1]-1,n=ay/(e.aabb.max[0]-i+2),a=ay/(e.aabb.max[1]-r+2);for(let o=0;o<t.length;o+=3){const s=t[o+2],l=(t[o+0]-i)*n|0,c=(t[o+1]-r)*a|0;s>e.heightmap[c*ay+l]&&(e.heightmap[c*ay+l]=s)}}function rv(t,i){const r={};r.indexArray=new Gl,r.indexArray.reserve(4*t.length),r.vertexArray=new Jl,r.vertexArray.reserve(10*t.length),r.colorArray=new Il,r.vertexArray.reserve(10*t.length);let n=0;for(const s of t){const t=Math.min(10,Math.max(4,1.3*s.height))*i,a=[-s.normal[1],s.normal[0],0],o=Math.min(.29,.1*s.width/s.depth),l=s.width-2*s.depth*i*(o+.01),c=e.Q.scaleAndAdd([],s.pos,a,l/2),h=e.Q.scaleAndAdd([],s.pos,a,-l/2),u=[c[0],c[1],c[2]+s.height],d=[h[0],h[1],h[2]+s.height],p=e.Q.scaleAndAdd([],s.normal,a,o);e.Q.scale(p,p,t);const f=e.Q.scaleAndAdd([],s.normal,a,-o);e.Q.scale(f,f,t),e.Q.add(p,c,p),e.Q.add(f,h,f),c[2]+=.1,h[2]+=.1,r.vertexArray.emplaceBack(p[0],p[1],p[2]),r.vertexArray.emplaceBack(f[0],f[1],f[2]),r.vertexArray.emplaceBack(c[0],c[1],c[2]),r.vertexArray.emplaceBack(h[0],h[1],h[2]),r.vertexArray.emplaceBack(u[0],u[1],u[2]),r.vertexArray.emplaceBack(d[0],d[1],d[2]),r.vertexArray.emplaceBack(c[0],c[1],c[2]),r.vertexArray.emplaceBack(h[0],h[1],h[2]),r.vertexArray.emplaceBack(p[0],p[1],p[2]),r.vertexArray.emplaceBack(f[0],f[1],f[2]);const m=l/t/2;r.colorArray.emplaceBack(-m-o,-1,m,.8),r.colorArray.emplaceBack(m+o,-1,m,.8),r.colorArray.emplaceBack(-m,0,m,1.3),r.colorArray.emplaceBack(m,0,m,1.3),r.colorArray.emplaceBack(m+o,-.8,m,.7),r.colorArray.emplaceBack(m+o,-.8,m,.7),r.colorArray.emplaceBack(0,0,m,1.3),r.colorArray.emplaceBack(0,0,m,1.3),r.colorArray.emplaceBack(m+o,-1.2,m,.8),r.colorArray.emplaceBack(m+o,-1.2,m,.8),r.indexArray.emplaceBack(6+n,4+n,8+n),r.indexArray.emplaceBack(7+n,9+n,5+n),r.indexArray.emplaceBack(0+n,1+n,2+n),r.indexArray.emplaceBack(1+n,3+n,2+n),n+=10}const a={defined:!0,emissiveFactor:[0,0,0]},o={};return o.baseColorFactor=jr.white,a.pbrMetallicRoughness=o,r.material=a,r.aabb=new mu([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}fs(Wy,"TriangleGridIndex");class nv{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const i=e[t];this._stringToNumber[i]=t,this._numberToString[t]=i}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const av=["tile","layer","source","sourceLayer","state"];class ov{constructor(e,t,i,r,n){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=i,this._y=r,this.properties=e.properties,this.id=n}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const t of av)void 0!==this[t]&&(e[t]=this[t]);return e}}class sv{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ds(na,16,0),this.featureIndexArray=new uc,this.promoteId=t,this.is3DTile=!1}insert(e,t,i,r,n){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,r,n,a);const l=this.grid;for(let c=0;c<t.length;c++){const e=t[c],i=[1/0,1/0,-1/0,-1/0];for(let t=0;t<e.length;t++){const r=e[t];i[0]=Math.min(i[0],r.x),i[1]=Math.min(i[1],r.y),i[2]=Math.max(i[2],r.x),i[3]=Math.max(i[3],r.y)}0!==o&&(i[0]-=o,i[1]-=o,i[2]+=o,i[3]+=o),i[0]<na&&i[1]<na&&i[2]>=0&&i[3]>=0&&l.insert(s,i[0],i[1],i[2],i[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new up(new wm(this.rawTileData)).layers,this.sourceLayerCoder=new nv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,i,r){var n=this;this.loadVTLayers();const a=e.params||{},o=rl(a.filter),s=e.tileResult,l=e.transform,c=s.bufferedTilespaceBounds,h=this.grid.query(c.min.x,c.min.y,c.max.x,c.max.y,((e,t,i,r)=>Kh(s.bufferedTilespaceGeometry,e,t,i,r)));h.sort(cv);let u=null;l.elevation&&h.length>0&&(u=Rp.create(l.elevation,this.tileID));const d={};let p;for(let f=0;f<h.length;f++){const c=h[f];if(c===p)continue;p=c;const m=this.featureIndexArray.get(c);let g=null;if(this.is3DTile){const e=this.bucketLayerIDs[0][0],i=t[e];if("model"!==i.type)continue;const{queryFeature:r,intersectionZ:n}=i.queryIntersectsMatchingFeature(s,m.featureIndex,o,l);r&&this.appendToResult(d,e,m.featureIndex,r,n)}else this.loadMatchingFeature(d,m,o,a.layers,a.availableImages,t,i,r,(function(t,i,r){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return g||(g=Oh(t,n.tileID.canonical,e.tileTransform)),i.queryIntersectsFeature(s,t,r,g,n.z,e.transform,e.pixelPosMatrix,u,a)}))}return d}loadMatchingFeature(e,t,i,r,n,a,o,s,l){const{featureIndex:c,bucketIndex:h,sourceLayerIndex:u,layoutVertexArrayOffset:d}=t,p=this.bucketLayerIDs[h];if(r&&!function(e,t){for(let i=0;i<e.length;i++)if(t.indexOf(e[i])>=0)return!0;return!1}(r,p))return;const f=this.sourceLayerCoder.decode(u),m=this.vtLayers[f].feature(c);if(i.needGeometry){const e=Bh(m,!0);if(!i.filter(new Vs(this.tileID.overscaledZ),e,this.tileID.canonical))return}else if(!i.filter(new Vs(this.tileID.overscaledZ),m))return;const g=this.getId(m,f);for(let _=0;_<p.length;_++){const t=p[_];if(r&&r.indexOf(t)<0)continue;const i=a[t];if(!i)continue;let h={};void 0!==g&&s&&(h=s.getState(i.sourceLayer||"_geojsonTileLayer",g));const u=!l||l(m,i,h,d);if(!u)continue;const f=new ov(m,this.z,this.x,this.y,g),y=$t({},o[t]);y.paint=lv(y.paint,i.paint,m,h,n),y.layout=lv(y.layout,i.layout,m,h,n),f.layer=y,this.appendToResult(e,t,c,f,u)}}appendToResult(e,t,i,r,n){let a=e[t];void 0===a&&(a=e[t]=[]),a.push({featureIndex:i,feature:r,intersectionZ:n})}lookupSymbolFeatures(e,t,i,r,n,a,o,s){const l={};this.loadVTLayers();const c=rl(n);for(const h of e)this.loadMatchingFeature(l,{bucketIndex:i,sourceLayerIndex:r,featureIndex:h,layoutVertexArrayOffset:0},c,a,o,s,t);return l}loadFeature(e){const{featureIndex:t,sourceLayerIndex:i}=e;this.loadVTLayers();const r=this.sourceLayerCoder.decode(i),n=this.vtFeatures[r];if(n[t])return n[t];const a=this.vtLayers[r].feature(t);return n[t]=a,a}hasLayer(e){for(const t of this.bucketLayerIDs)for(const i of t)if(e===i)return!0;return!1}getId(e,t){let i=e.id;if(this.promoteId){const r="string"==typeof this.promoteId?this.promoteId:this.promoteId[t];null!=r&&(i=e.properties[r]),"boolean"==typeof i&&(i=Number(i))}return i}}function lv(e,t,i,r,n){return si(e,((e,a)=>{const o=t instanceof Qs?t.get(a):null;return o&&o.evaluate?o.evaluate(i,r,n):o}))}function cv(e,t){return t-e}fs(sv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const hv=new Float32Array(262144),uv=new Uint8Array(262144);function dv(e){let t=0;if(e.meshes)for(const i of e.meshes)t=Math.max(t,i.aabb.max[2]);if(e.children)for(const i of e.children)t=Math.max(t,dv(i));return t}function pv(e,t,i){if(e.meshes)for(const r of e.meshes)r.aabb.min[0]!==1/0&&i.insert(t,r.aabb.min[0],r.aabb.min[1],r.aabb.max[0],r.aabb.max[1]);if(e.children)for(const r of e.children)pv(r,t,i)}const fv=["","wall","door","roof","window","lamp","logo"];class mv{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:dv(e)}}}getLocalBounds(){if(!this.node.meshes)return new mu([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const t=new mu([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const i of this.node.meshes)this.node.lightMeshIndex!==e&&t.encapsulate(i.aabb),e++;this.aabb=mu.applyTransform(t,this.node.matrix)}return this.aabb}}class gv{constructor(e,t,i,r,n,a){this.id=t,this.modelTraits|=oy.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,i&&(this.modelTraits|=oy.HasMapboxMeshFeatures),r&&(this.modelTraits|=oy.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=n,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const o of e)this.nodesInfo.push(new mv(o)),pv(o,a.featureIndexArray.length,a.grid),a.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,a.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const t=this.getNodesInfo();for(const i of t){const t=i.node;this.uploaded?this.updatePbrBuffer(t):hy(t,e,!0)}for(const i of t)uy(i.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let t=!1;if(!e.meshes)return t;for(const i of e.meshes)i.pbrBuffer&&(i.pbrBuffer.updateData(i.featureArray),t=!0);return t}needsReEvaluation(e,t,i){const r=e.transform.projectionOptions,n=e.style.getBrightness(),a=this.brightness!==n;return!!(!this.uploaded||this.dirty||r.name!==this.projection.name||_v(i.paint.get("model-color").value,a)||_v(i.paint.get("model-color-mix-intensity").value,a)||_v(i.paint.get("model-roughness").value,a)||_v(i.paint.get("model-emissive-strength").value,a)||_v(i.paint.get("model-height-based-emissive-strength-multiplier").value,a))&&(this.projection=r,this.brightness=n,!0)}evaluateScale(e,t){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const i=this.getNodesInfo(),r=this.id.canonical;for(const n of i){const e=n.feature;n.evaluatedScale=t.paint.get("model-scale").evaluate(e,{},r)}}evaluate(e){const t=this.getNodesInfo();for(const i of t){if(!i.node.meshes)continue;const t=i.feature,r=i.node.meshes&&i.node.meshes[0].featureData,n=i.evaluatedColor[2],a=i.evaluatedRMEA[2],o=this.id.canonical;if(i.hasTranslucentParts=!1,r){for(let r=0;r<fv.length;r++){const n=fv[r];n.length&&(t.properties.part=n);const a=e.paint.get("model-color").evaluate(t,{},o),s=e.paint.get("model-color-mix-intensity").evaluate(t,{},o);i.evaluatedColor[r]=[a.r,a.g,a.b,s],i.evaluatedRMEA[r][0]=e.paint.get("model-roughness").evaluate(t,{},o),i.evaluatedRMEA[r][2]=e.paint.get("model-emissive-strength").evaluate(t,{},o),i.evaluatedRMEA[r][3]=a.a,i.emissionHeightBasedParams[r]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(t,{},o),!i.hasTranslucentParts&&a.a<1&&(i.hasTranslucentParts=!0)}delete t.properties.part,vv(i,n!==i.evaluatedColor[2]||a!==i.evaluatedRMEA[2],this.modelTraits)}else i.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(t,{},o);i.evaluatedScale=e.paint.get("model-scale").evaluate(t,{},o),this.updatePbrBuffer(i.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,t,i,r){const n=e.findDEMTileFor(i);if(n&&(n.tileID.canonical!==this.terrainTile||t!==this.terrainExaggeration)){if(n.dem&&n.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=n.tileID.overscaledZ;const t=Rp.create(e,i,n);if(!t)return;this.modelTraits&oy.HasMapboxMeshFeatures&&this.updateDEM(e,t,i,r);for(const e of this.getNodesInfo()){const i=e.node;if(!i.footprint||!i.footprint.vertices||!i.footprint.vertices.length)continue;const r=i.footprint.vertices;let n=t.getElevationAt(r[0].x,r[0].y,!0,!0);for(let e=1;e<r.length;e++)n=Math.min(n,t.getElevationAt(r[e].x,r[e].y,!0,!0));i.elevation=n}}this.terrainTile=n.tileID.canonical,this.terrainExaggeration=t}}updateDEM(e,t,i,r){let n=t._dem._modifiedForSources[r];if(void 0===n&&(t._dem._modifiedForSources[r]=[],n=t._dem._modifiedForSources[r]),n.includes(i.canonical))return;const a=t._dem.dim;n.push(i.canonical);let o=!1;for(const s of this.getNodesInfo()){const e=s.node;if(!e.footprint||!e.footprint.grid)continue;const i=e.footprint.grid,r=t.tileCoordToPixel(i.min.x,i.min.y),n=t.tileCoordToPixel(i.max.x,i.max.y),l=Math.min(Math.min(a-n.y,r.x),Math.min(r.y,a-n.x));if(l<0)continue;const c=Xt(l,2,5);let h=Math.max(0,r.x-c),u=Math.max(0,r.y-c),d=Math.min(n.x+c,a-1),p=Math.min(n.y+c,a-1);for(let t=u;t<=p;++t)for(let e=h;e<=d;++e)uv[t*a+e]=255;let f=0,m=0;for(let o=0;o<i.cellsY;++o)for(let e=0;e<i.cellsX;++e){if(!i.cells[o*i.cellsX+e])continue;const r=t.tileCoordToPixel(i.min.x+e/i.xScale,i.min.y+o/i.yScale),n=t.tileCoordToPixel(i.min.x+(e+1)/i.xScale,i.min.y+(o+1)/i.yScale);for(let e=r.y;e<=Math.min(n.y+1,a-1);++e)for(let i=r.x;i<=Math.min(n.x+1,a-1);++i)255===uv[e*a+i]&&(uv[e*a+i]=0,f+=t.getElevationAtPixel(i,e),m++)}const g=f/m;h=Math.max(1,r.x-c),u=Math.max(1,r.y-c),d=Math.min(n.x+c,a-2),p=Math.min(n.y+c,a-2),o=!0;for(let o=u;o<=p;++o)for(let e=h;e<=d;++e)0===uv[o*a+e]&&(hv[o*a+e]=t._dem.set(e,o,g));for(let o=1;o<c;++o){h=Math.max(1,r.x-o),u=Math.max(1,r.y-o),d=Math.min(n.x+o,a-2),p=Math.min(n.y+o,a-2);for(let e=u;e<=p;++e)for(let i=h;i<=d;++i){const r=e*a+i;if(255===uv[r]){let n=0,s=0,l=-1,h=-1;for(let t=-1;t<=1;++t)for(let r=-1;r<=1;++r){const c=(e+t)*a+i+r;if(uv[c]>=o)continue;const u=hv[c],d=Math.abs(u);d>s&&(n=u,s=d,l=r,h=t)}if(s>.1){const a=1-(o+.5*Math.abs(l*h))/c;let s=t._dem.get(i,e)+n*a;const u=t._dem.get(i+l,e+h),d=t._dem.get(i-l,e-h,!0);(s-u)*(s-d)>0&&(s=(u+d)/2),hv[r]=t._dem.set(i,e,s),uv[r]=o}}}}}o&&(t._demTile.needsDEMTextureUpload=!0,t._dem._timestamp=ki.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const t of e)uy(t.node),dy(t.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const i=t.getReplacementRegionsForTile(e.toUnwrapped()),r=this.getNodesInfo();for(let n=0;n<this.nodesInfo.length;n++){const e=r[n].node;r[n].hiddenByReplacement=!!e.footprint&&!i.find((t=>t.footprint===e.footprint))}}getHeightAtTileCoord(t,i){const r=this.getNodesInfo(),n=[],a=[0,0,0];for(let o=0;o<this.nodesInfo.length;o++){const s=r[o],l=s.node.meshes[0],c=mu.applyTransform(l.aabb,s.node.matrix);if(t<c.min[0]||i<c.min[1]||t>c.max[0]||i>c.max[1])continue;const h=(t-l.aabb.min[0])/(l.aabb.max[0]-l.aabb.min[0])*ay|0,u=Math.min(63,(i-l.aabb.min[1])/(l.aabb.max[1]-l.aabb.min[1])*ay|0)*ay+Math.min(63,h);if(a[2]=l.heightmap[u],e.Q.transformMat4(a,a,s.node.matrix),!(l.heightmap[u]<0&&s.node.footprint)){if(s.hiddenByReplacement)return;return{height:a[2],maxHeight:s.feature.properties.height,hidden:!1,verticalScale:s.evaluatedScale[2]}}if(s.node.footprint.grid.query(new Vt(t,i),new Vt(t,i),n),n.length>0)return{height:void 0,maxHeight:s.feature.properties.height,hidden:s.hiddenByReplacement,verticalScale:s.evaluatedScale[2]}}}}function _v(e,t){return!e.isLightConstant&&t}function yv(e,t,i,r,n,a,o,s){let l=(61440&t|(61440&t)>>4)>>8,c=(3840&t|(3840&t)>>4)>>4,h=240&t|(240&t)>>4;i[3]>0&&(l=Ur(l,255*i[0],i[3]),c=Ur(c,255*i[1],i[3]),h=Ur(h,255*i[2],i[3]));const u=l<<8|c,d=h<<8|Math.floor(255*r[3]),p=function(e){const t=Xt(e,0,2);return Math.min(Math.round(.5*t*255),255)}(r[2])<<8|15*r[0]<<4|15*r[1],f=Xt(n[0],0,1),m=Xt(n[1],0,1),g=Xt(n[2],0,1),_=Xt(n[3],0,1);let y,v,x,b;if(f!==m&&o!==a&&m!==f){const e=o-a;v=1/(e*(m-f)),x=-(a+e*f)/(e*(m-f));const t=Xt(n[4],-1,1);b=Math.pow(10,t),y=255*g<<8|255*_}else y=65535,v=0,x=1,b=1;if(e.emplaceBack(u,d,p,y,v,x,b),s){const e=s.length;s.clear();for(let t=0;t<e;t++)s.emplaceBack(u,d,p,y,v,x,b)}}function vv(e,t,i){const r=e.node;let n=0;const a=i&oy.HasMeshoptCompression;for(const o of r.meshes){if(r.lights&&r.lightMeshIndex===n)continue;if(!o.featureData)continue;o.featureArray=new $l,o.featureArray.reserve(o.featureData.length);let i=t;for(const t of o.featureData){const n=a?65535&t:t>>16&65535,s=a?t>>16&65535:65535&t,l=(15&s)<8?15&s:0,c=e.evaluatedRMEA[l],h=e.evaluatedColor[l],u=e.emissionHeightBasedParams[l];let d;if(i&&2===l&&r.lights&&(d=new $l,d.resize(10*r.lights.length)),yv(o.featureArray,n,h,c,u,o.aabb.min[2],o.aabb.max[2],d),d&&i){i=!1;const e=r.meshes[r.lightMeshIndex];e.featureArray=d,e.featureArray._trim()}}o.featureArray._trim(),n++}}function xv(e,t,i,r){const n=1<<e.z;t.lat=wh((r/na+e.y)/n),t.lng=bh((i/na+e.x)/n)}fs(gv,"Tiled3dModelBucket",{omit:["layers"]}),fs(mv,"Tiled3dModelFeature");const bv={circle:class extends vl{constructor(e,t,i){super(e,su,t,i)}createBucket(e){return new jh(e)}queryRadius(e){const t=e;return iu("circle-radius",this,t)+iu("circle-stroke-width",this,t)+ru(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,i,r,n,a,o,s){const l=au(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i);return Zu(e,r,a,o,s,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t){const i=Wu(this);return{config:new jc(this,t),defines:i,overrideFog:!1}}},heatmap:class extends vl{createBucket(e){return new Ku(e)}constructor(e,t,i){super(e,od,t,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=sd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return iu("heatmap-radius",this,e)}queryIntersectsFeature(e,t,i,r,n,a,o,s){const l=this.paint.get("heatmap-radius").evaluate(t,i);return Zu(e,r,a,o,s,!0,!0,new Vt(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t){return"heatmap"===e?{config:new jc(this,t),overrideFog:!1}:{}}},hillshade:class extends vl{constructor(e,t,i){super(e,cd,t,i)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},fill:class extends vl{constructor(e,t,i){super(e,Wd,t,i)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),i=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(e,t){return{config:new jc(this,t),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new qd(e)}queryRadius(){return ru(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,i,r,n,a){return!e.queryGeometry.isAboveHorizon&&qh(nu(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends vl{constructor(e,t,i){super(e,hf,t,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new Jp(e)}queryRadius(){return ru(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,i,r,n,a,o,s,l,c){const h=au(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),u=this.paint.get("fill-extrusion-height").evaluate(i,r),d=this.paint.get("fill-extrusion-base").evaluate(i,r),p=[0,0],f=l&&o.elevation,m=o.elevation?o.elevation.exaggeration():1,g=t.tile.getBucket(this);if(f&&g instanceof Jp){const e=g.centroidVertexArray,t=c+1;t<e.length&&(p[0]=e.geta_centroid_pos0(t),p[1]=e.geta_centroid_pos1(t))}if(0===p[0]&&1===p[1])return!1;"globe"===o.projection.name&&(n=sf([n],[new Vt(0,0),new Vt(na,na)],t.tileID.canonical).map((e=>e.polygon)).flat());const _=f?l:null,[y,v]=function(t,i,r,n,a,o,s,l,c,h,u){return"globe"===t.projection.name?function(t,i,r,n,a,o,s,l,c,h,u){const d=[],p=[],f=t.projection.upVectorScale(u,t.center.lat,t.worldSize).metersToTile,m=[0,0,0,1],g=[0,0,0,1],_=(e,t,i,r)=>{e[0]=t,e[1]=i,e[2]=r,e[3]=1},y=of();r>0&&(r+=y),n+=y;for(const v of i){const i=[],y=[];for(const d of v){const p=d.x+a.x,v=d.y+a.y,x=t.projection.projectTilePoint(p,v,u),b=t.projection.upVector(u,d.x,d.y);let w=r,S=n;if(s){const e=ff(p,v,r,n,s,l,c,h);w+=e.base,S+=e.top}0!==r?_(m,x.x+b[0]*f*w,x.y+b[1]*f*w,x.z+b[2]*f*w):_(m,x.x,x.y,x.z),_(g,x.x+b[0]*f*S,x.y+b[1]*f*S,x.z+b[2]*f*S),e.Q.transformMat4(m,m,o),e.Q.transformMat4(g,g,o),i.push(new uf(m[0],m[1],m[2])),y.push(new uf(g[0],g[1],g[2]))}d.push(i),p.push(y)}return[d,p]}(t,i,r,n,a,o,s,l,c,h,u):s?function(t,i,r,n,a,o,s,l,c){const h=[],u=[],d=[0,0,0,1];for(const p of t){const t=[],f=[];for(const h of p){const u=h.x+n.x,p=h.y+n.y,m=ff(u,p,i,r,o,s,l,c);d[0]=u,d[1]=p,d[2]=m.base,d[3]=1,e.aa.transformMat4(d,d,a),d[3]=Math.max(d[3],1e-5);const g=new uf(d[0]/d[3],d[1]/d[3],d[2]/d[3]);d[0]=u,d[1]=p,d[2]=m.top,d[3]=1,e.aa.transformMat4(d,d,a),d[3]=Math.max(d[3],1e-5);const _=new uf(d[0]/d[3],d[1]/d[3],d[2]/d[3]);t.push(g),f.push(_)}h.push(t),u.push(f)}return[h,u]}(i,r,n,a,o,s,l,c,h):function(e,t,i,r,n){const a=[],o=[],s=n[8]*t,l=n[9]*t,c=n[10]*t,h=n[11]*t,u=n[8]*i,d=n[9]*i,p=n[10]*i,f=n[11]*i;for(const m of e){const e=[],t=[];for(const i of m){const a=i.x+r.x,o=i.y+r.y,m=n[0]*a+n[4]*o+n[12],g=n[1]*a+n[5]*o+n[13],_=n[2]*a+n[6]*o+n[14],y=n[3]*a+n[7]*o+n[15],v=m+s,x=g+l,b=_+c,w=Math.max(y+h,1e-5),S=m+u,T=g+d,E=_+p,M=Math.max(y+f,1e-5);e.push(new uf(v/w,x/w,b/w)),t.push(new uf(S/M,T/M,E/M))}a.push(e),o.push(t)}return[a,o]}(i,r,n,a,o)}(o,n,d,u,h,s,_,p,m,o.center.lat,t.tileID.canonical),x=t.queryGeometry;return function(e,t,i){let r=1/0;qh(i,t)&&(r=pf(i,t[0]));for(let n=0;n<t.length;n++){const a=t[n],o=e[n];for(let e=0;e<a.length-1;e++){const t=a[e],n=[t,a[e+1],o[e+1],o[e],t];Uh(i,n)&&(r=Math.min(r,pf(i,n)))}}return r!==1/0&&r}(y,v,x.isPointQuery()?x.screenBounds:x.screenGeometry)}},line:class extends vl{constructor(e,t,i){super(e,Af,t,i),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Wa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Rf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Ef(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t){const i=kf(this);return{config:new jc(this,t),defines:i,overrideFog:!1}}queryRadius(e){const t=e,i=Lf(iu("line-width",this,t),iu("line-gap-width",this,t)),r=iu("line-offset",this,t);return i/2+Math.abs(r)+ru(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,i,r,n,a){if(e.queryGeometry.isAboveHorizon)return!1;const o=nu(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),s=e.pixelToTileUnitsFactor/2*Lf(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),l=this.paint.get("line-offset").evaluate(t,i);return l&&(r=function(e,t){const i=[],r=new Vt(0,0);for(let n=0;n<e.length;n++){const a=e[n],o=[];for(let e=0;e<a.length;e++){const i=a[e],n=a[e+1],s=0===e?r:i.sub(a[e-1])._unit()._perp(),l=e===a.length-1?r:n.sub(i)._unit()._perp(),c=s._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),o.push(c._mult(t)._add(i))}i.push(o)}return i}(r,l*e.pixelToTileUnitsFactor)),function(e,t,i){for(let r=0;r<t.length;r++){const n=t[r];if(e.length>=3)for(let t=0;t<n.length;t++)if(Jh(e,n[t]))return!0;if(Hh(e,n,i))return!0}return!1}(o,r,s)}isTileClipped(){return!0}},symbol:p_,background:class extends vl{constructor(e,t,i){super(e,m_,t,i)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t){return{overrideFog:!1}}},raster:M_,"raster-particle":C_,sky:class extends vl{constructor(e,t,i){super(e,D_,t,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=sd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const i=this.paint.get("sky-atmosphere-sun"),r=!i,n=e.style.light,a=n.properties.get("position");return r&&"viewport"===n.properties.get("anchor")&&ui("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),r?R_(a.azimuthal,90-a.polar,t):R_(i[0],90-i[1],t)}const i=this.paint.get("sky-gradient-center");return R_(i[0],90-i[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}},slot:class extends vl{constructor(e,t,i){super(e,L_,t)}},model:class extends vl{constructor(e,t,i){super(e,ny,t,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new iy(e)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(e){return e instanceof gv?na-1:0}queryIntersectsFeature(t,i,r,n,a,o){if(!this.modelManager)return!1;const s=this.modelManager,l=t.tile.getBucket(this);if(!(l&&l instanceof iy))return!1;const c=l;for(const h in c.instancesPerModel){const r=c.instancesPerModel[h],n=void 0!==i.id?i.id:i.properties&&i.properties.hasOwnProperty("id")?i.properties.id:void 0;if(r.idToFeaturesIndex.hasOwnProperty(n)){const i=r.features[r.idToFeaturesIndex[n]],a=s.getModel(h,this.scope);if(!a)return!1;let l=e.a9.create();const u=new oh(0,0),d=c.canonical;let p=Number.MAX_VALUE;for(let n=0;n<i.instancedDataCount;++n){const s=16*(i.instancedDataOffset+n),c=r.instancedDataArray.float32,h=[c[s+4],c[s+5],c[s+6]];xv(d,u,c[s],0|c[s+1]),sy(l,a,o,u,i.rotation,i.scale,h,!1,!1,!1),"globe"===o.projection.name&&(l=G_(l,o));const f=e.a9.multiply([],o.projMatrix,l),m=t.queryGeometry,g=q_(m.isPointQuery()?m.screenBounds:m.screenGeometry,o,f,a.aabb);null!=g&&(p=Math.min(g,p))}return p!==Number.MAX_VALUE&&p}}return!1}_handleOverridablePaintPropertyUpdate(e,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven()||"model-color"!==e&&"model-color-mix-intensity"!==e&&"model-rotation"!==e&&"model-scale"!==e&&"model-translation"!==e&&"model-emissive-strength"!==e)}_isPropertyZoomDependent(e){const t=this._transitionablePaint._values[e];return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof as}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,i,r,n){const a=t.tile,o=a.getBucket(this);let s=null,l=Number.MAX_VALUE;if(!(o&&o instanceof gv))return{queryFeature:s,intersectionZ:l};const c=o.getNodesInfo()[i];if(c.hiddenByReplacement||!c.node.meshes||!r.filter(new Vs(a.tileID.overscaledZ),c.feature,a.tileID.canonical))return{queryFeature:s,intersectionZ:l};const h=c.node,u=n.calculatePosMatrix(a.tileID.toUnwrapped(),n.worldSize),d=c.evaluatedScale;let p=0;n.elevation&&h.elevation&&(p=h.elevation*n.elevation.exaggeration()),e.a9.translate(u,u,[(h.anchor?h.anchor[0]:0)*(d[0]-1),(h.anchor?h.anchor[1]:0)*(d[1]-1),p]),e.a9.scale(u,u,d),e.a9.multiply(u,u,h.matrix);const f=t.queryGeometry,m=f.isPointQuery()?f.screenBounds:f.screenGeometry,g=function(t){const i=e.a9.multiply([],u,t.matrix),r=e.a9.multiply(i,n.expandedFarZProjMatrix,i);for(let e=0;e<t.meshes.length;++e){const i=t.meshes[e];if(e===t.lightMeshIndex)continue;const a=q_(m,n,r,i.aabb);null!=a&&(l=Math.min(a,l))}if(t.children)for(const e of t.children)g(e)};if(g(h),l===Number.MAX_VALUE)return{queryFeature:s,intersectionZ:l};const _=new oh(0,0);return xv(a.tileID.canonical,_,c.node.anchor[0],c.node.anchor[1]),s={type:"Feature",geometry:{type:"Point",coordinates:[_.lng,_.lat]},properties:c.feature.properties,id:c.feature.id,state:{},layer:this.serialize()},{queryFeature:s,intersectionZ:l}}}},wv={read:function(e,t){return e.readFields(wv._readField,{header_length:0,x:0,y:0,z:0,layers:[]},t)},_readField:function(e,t,i){1===e?t.header_length=i.readFixed32():2===e?t.x=i.readVarint():3===e?t.y=i.readVarint():4===e?t.z=i.readVarint():5===e&&t.layers.push(wv.Layer.read(i,i.readVarint()+i.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};wv.Filter.read=function(e,t){return e.readFields(wv.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},t)},wv.Filter._readField=function(e,t,i){1===e?(t.delta_filter=wv.Filter.Delta.read(i,i.readVarint()+i.pos),t.filter="delta_filter"):2===e?(t.zigzag_filter=wv.Filter.Zigzag.read(i,i.readVarint()+i.pos),t.filter="zigzag_filter"):3===e?(t.bitshuffle_filter=wv.Filter.BitShuffle.read(i,i.readVarint()+i.pos),t.filter="bitshuffle_filter"):4===e&&(t.byteshuffle_filter=wv.Filter.ByteShuffle.read(i,i.readVarint()+i.pos),t.filter="byteshuffle_filter")},wv.Filter.Delta={},wv.Filter.Delta.read=function(e,t){return e.readFields(wv.Filter.Delta._readField,{block_size:0},t)},wv.Filter.Delta._readField=function(e,t,i){1===e&&(t.block_size=i.readVarint())},wv.Filter.Zigzag={},wv.Filter.Zigzag.read=function(e,t){return e.readFields(wv.Filter.Zigzag._readField,{},t)},wv.Filter.Zigzag._readField=function(e,t,i){},wv.Filter.BitShuffle={},wv.Filter.BitShuffle.read=function(e,t){return e.readFields(wv.Filter.BitShuffle._readField,{},t)},wv.Filter.BitShuffle._readField=function(e,t,i){},wv.Filter.ByteShuffle={},wv.Filter.ByteShuffle.read=function(e,t){return e.readFields(wv.Filter.ByteShuffle._readField,{},t)},wv.Filter.ByteShuffle._readField=function(e,t,i){},wv.Codec={},wv.Codec.read=function(e,t){return e.readFields(wv.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},t)},wv.Codec._readField=function(e,t,i){1===e?(t.gzip_data=wv.Codec.GzipData.read(i,i.readVarint()+i.pos),t.codec="gzip_data"):2===e?(t.jpeg_image=wv.Codec.JpegImage.read(i,i.readVarint()+i.pos),t.codec="jpeg_image"):3===e?(t.webp_image=wv.Codec.WebpImage.read(i,i.readVarint()+i.pos),t.codec="webp_image"):4===e&&(t.png_image=wv.Codec.PngImage.read(i,i.readVarint()+i.pos),t.codec="png_image")},wv.Codec.GzipData={},wv.Codec.GzipData.read=function(e,t){return e.readFields(wv.Codec.GzipData._readField,{},t)},wv.Codec.GzipData._readField=function(e,t,i){},wv.Codec.JpegImage={},wv.Codec.JpegImage.read=function(e,t){return e.readFields(wv.Codec.JpegImage._readField,{},t)},wv.Codec.JpegImage._readField=function(e,t,i){},wv.Codec.WebpImage={},wv.Codec.WebpImage.read=function(e,t){return e.readFields(wv.Codec.WebpImage._readField,{},t)},wv.Codec.WebpImage._readField=function(e,t,i){},wv.Codec.PngImage={},wv.Codec.PngImage.read=function(e,t){return e.readFields(wv.Codec.PngImage._readField,{},t)},wv.Codec.PngImage._readField=function(e,t,i){},wv.DataIndexEntry={},wv.DataIndexEntry.read=function(e,t){return e.readFields(wv.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},t)},wv.DataIndexEntry._readField=function(e,t,i){1===e?t.first_byte=i.readFixed64():2===e?t.last_byte=i.readFixed64():3===e?t.filters.push(wv.Filter.read(i,i.readVarint()+i.pos)):4===e?t.codec=wv.Codec.read(i,i.readVarint()+i.pos):5===e?t.offset=i.readFloat():6===e?t.scale=i.readFloat():7===e&&t.bands.push(i.readString())},wv.Layer={},wv.Layer.read=function(e,t){return e.readFields(wv.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},t)},wv.Layer._readField=function(e,t,i){1===e?t.version=i.readVarint():2===e?t.name=i.readString():3===e?t.units=i.readString():4===e?t.tilesize=i.readVarint():5===e?t.buffer=i.readVarint():6===e?t.pixel_format=i.readVarint():7===e&&t.data_index.push(wv.DataIndexEntry.read(i,i.readVarint()+i.pos))};const Sv={read:function(e,t){return e.readFields(Sv._readField,{uint32_values:null,values:null,fixed32_values:null},t)},_readField:function(e,t,i){2===e?(t.uint32_values=Sv.Uint32Values.read(i,i.readVarint()+i.pos),t.values="uint32_values"):3===e&&(t.fixed32_values=Sv.Fixed32Values.read(i,i.readVarint()+i.pos),t.values="fixed32_values")},Uint32Values:{}};Sv.Uint32Values.read=function(e,t){return e.readFields(Sv.Uint32Values._readField,{values:[]},t)},Sv.Uint32Values._readField=function(e,t,i){1===e&&(t.readValuesInto=function(e){if(2!==e.type)throw new Error('Unsupported pbf type "'.concat(e.type,'"'));const t=function(e){return 2===e.type?e.readVarint()+e.pos:e.pos+1}(e),i=e.pos;return e.pos=t,function(r){e.pos=i;let n=0;for(;e.pos<t;){const t=e.readVarint();r[n++]=t}return r}}(i))},Sv.Fixed32Values={},Sv.Fixed32Values.read=function(e,t){return e.readFields(Sv.Fixed32Values._readField,{values:[]},t)},Sv.Fixed32Values._readField=function(e,t,i){throw new Error("Not implemented")};class Tv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=i,this.size=0,this.ttl=t}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){const t=this.items[e];delete this.items[e],this.size--,null!==t.prev&&(t.prev.next=t.next),null!==t.next&&(t.next.prev=t.prev),this.first===t&&(this.first=t.next),this.last===t&&(this.last=t.prev)}return this}entries(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.keys()).map((e=>[e,this.get(e)]))}evict(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.size>0){const e=this.first;delete this.items[e.key],0==--this.size?(this.first=null,this.last=null):(this.first=e.next,this.first.prev=null)}return this}expiresAt(e){let t;return this.has(e)&&(t=this.items[e].expiry),t}get(e){let t;if(this.has(e)){const i=this.items[e];this.ttl>0&&i.expiry<=Date.now()?this.delete(e):(t=i.value,this.set(e,t,!0))}return t}has(e){return e in this.items}keys(){const e=[];let t=this.first;for(;null!==t;)e.push(t.key),t=t.next;return e}set(e,t){let i,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.resetTtl;if(r||this.has(e)){if(i=this.items[e],i.value=t,!1===r&&n&&(i.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==i){const e=this.last,t=i.next,r=i.prev;this.first===i&&(this.first=i.next),i.next=null,i.prev=this.last,e.next=i,null!==r&&(r.next=t),null!==t&&(t.prev=r)}}else this.max>0&&this.size===this.max&&this.evict(!0),i=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:t},1==++this.size?this.first=i:this.last.next=i;return this.last=i,this}values(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.keys()).map((e=>this.get(e)))}}function Ev(e,t){if(4!==t.length)throw new Error("Expected data of dimension 4 but got ".concat(t.length,"."));let i=t[3];for(let r=2;r>=1;r--){const n=1===r?1:0,a=2===r?1:0;for(let r=0;r<t[0];r++){const o=t[1]*r;for(let r=n;r<t[1];r++){const n=t[2]*(r+o);for(let r=a;r<t[2];r++){const a=t[3]*(r+n);for(let r=0;r<t[3];r++){const t=a+r;e[t]+=e[t-i]}}}}i*=t[r]}return e}function Mv(e){for(let t=0,i=e.length;t<i;t++)e[t]=e[t]>>>1^-(1&e[t]);return e}function Av(e,t){switch(t){case"uint32":return e;case"uint16":for(let t=0;t<e.length;t+=2){const i=e[t],r=e[t+1];e[t]=(240&i)>>4|(61440&i)>>8|(240&r)<<4|61440&r,e[t+1]=15&i|(3840&i)>>4|(15&r)<<8|(3840&r)<<4}return e;case"uint8":for(let t=0;t<e.length;t+=4){const i=e[t],r=e[t+1],n=e[t+2],a=e[t+3];e[t+0]=(192&i)>>6|(192&r)>>4|(192&n)>>2|192&a,e[t+1]=(48&i)>>4|(48&r)>>2|48&n|(48&a)<<2,e[t+2]=(12&i)>>2|12&r|(12&n)<<2|(12&a)<<4,e[t+3]=3&i|(3&r)<<2|(3&n)<<4|(3&a)<<6}return e;default:throw new Error('Invalid pixel format, "'.concat(t,'"'))}}class Pv extends Error{constructor(e){super(e),this.name="MRTError"}}var Cv=Uint8Array,Iv=Uint16Array,kv=Int32Array,Dv=new Cv([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Rv=new Cv([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Lv=new Cv([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zv=function(e,t){for(var i=new Iv(31),r=0;r<31;++r)i[r]=t+=1<<e[r-1];var n=new kv(i[30]);for(r=1;r<30;++r)for(var a=i[r];a<i[r+1];++a)n[a]=a-i[r]<<5|r;return{b:i,r:n}},Fv=zv(Dv,2),Ov=Fv.b,Bv=Fv.r;Ov[28]=258,Bv[258]=28;for(var Nv=zv(Rv,0).b,Vv=new Iv(32768),jv=0;jv<32768;++jv){var Uv=(43690&jv)>>1|(21845&jv)<<1;Vv[jv]=((65280&(Uv=(61680&(Uv=(52428&Uv)>>2|(13107&Uv)<<2))>>4|(3855&Uv)<<4))>>8|(255&Uv)<<8)>>1}var Gv=function(e,t,i){for(var r=e.length,n=0,a=new Iv(t);n<r;++n)e[n]&&++a[e[n]-1];var o,s=new Iv(t);for(n=1;n<t;++n)s[n]=s[n-1]+a[n-1]<<1;if(i){o=new Iv(1<<t);var l=15-t;for(n=0;n<r;++n)if(e[n])for(var c=n<<4|e[n],h=t-e[n],u=s[e[n]-1]++<<h,d=u|(1<<h)-1;u<=d;++u)o[Vv[u]>>l]=c}else for(o=new Iv(r),n=0;n<r;++n)e[n]&&(o[n]=Vv[s[e[n]-1]++]>>15-e[n]);return o},qv=new Cv(288);for(jv=0;jv<144;++jv)qv[jv]=8;for(jv=144;jv<256;++jv)qv[jv]=9;for(jv=256;jv<280;++jv)qv[jv]=7;for(jv=280;jv<288;++jv)qv[jv]=8;var Hv=new Cv(32);for(jv=0;jv<32;++jv)Hv[jv]=5;var Wv=Gv(qv,9,1),Zv=Gv(Hv,5,1),Qv=function(e){for(var t=e[0],i=1;i<e.length;++i)e[i]>t&&(t=e[i]);return t},Xv=function(e,t,i){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&i},Yv=function(e,t){var i=t/8|0;return(e[i]|e[i+1]<<8|e[i+2]<<16)>>(7&t)},Jv=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Kv=function(e,t,i){var r=new Error(t||Jv[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,Kv),!i)throw r;return r},$v=new Cv(0),ex="undefined"!=typeof TextDecoder&&new TextDecoder;try{ex.decode($v,{stream:!0})}catch(e){}const tx={gzip_data:"gzip"},ix={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},rx={uint32:1,uint16:2,uint8:4},nx={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class ax{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){const t=new Uint8Array(e),i=new DataView(e);if(13!==t[0])throw new Pv("File is not a valid MRT.");return i.getUint32(1,!0)}parseHeader(e){const t=new Uint8Array(e),i=this.getHeaderLength(e);if(t.length<i)throw new Pv("Expected header with length >= ".concat(i," but got buffer of length ").concat(t.length));const r=new wm(t.subarray(0,i)),n=wv.read(r);if(!isNaN(this.x)&&(this.x!==n.x||this.y!==n.y||this.z!==n.z))throw new Pv("Invalid attempt to parse header ".concat(n.z,"/").concat(n.x,"/").concat(n.y," for tile ").concat(this.z,"/").concat(this.x,"/").concat(this.y));this.x=n.x,this.y=n.y,this.z=n.z;for(const a of n.layers)this.layers[a.name]=new ox(a,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const t=[],i=this.getLayer(e.layerName);for(let r=0;r<i.dataIndex.length;r++){const n=i.dataIndex[r],a=n.first_byte-e.firstByte,o=n.last_byte+1-e.firstByte;if(r<e.firstBlock||r>e.lastBlock)continue;if(i._blocksInProgress.has(r))continue;const s={layerName:i.name,firstByte:a,lastByte:o,pixelFormat:i.pixelFormat,blockIndex:r,blockShape:[n.bands.length].concat(i.bandShape),buffer:i.buffer,codec:n.codec.codec,filters:n.filters.map((e=>e.filter))};i._blocksInProgress.add(r),t.push(s)}return new sx(t,(()=>{t.forEach((e=>i._blocksInProgress.delete(e.blockIndex)))}),((e,r)=>{if(t.forEach((e=>i._blocksInProgress.delete(e.blockIndex))),e)throw e;r.forEach((e=>{this.getLayer(e.layerName).processDecodedData(e)}))}))}}class ox{constructor(e,t){let{version:i,name:r,units:n,tilesize:a,pixel_format:o,buffer:s,data_index:l}=e;if(this.version=i,1!==this.version)throw new Pv("Cannot parse raster layer encoded with MRT version ".concat(i));this.name=r,this.units=n,this.tileSize=a,this.buffer=s,this.pixelFormat=ix[o],this.dataIndex=l,this.bandShape=[a+2*s,a+2*s,rx[this.pixelFormat]],this._decodedBlocks=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(isNaN(e)||e<0)throw new TypeError("Invalid max value");if(isNaN(t)||t<0)throw new TypeError("Invalid ttl value");if("boolean"!=typeof i)throw new TypeError("Invalid resetTtl value");return new Tv(e,t,i)}(t?t.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){const t=e.blockIndex.toString();this._decodedBlocks.get(t)||this._decodedBlocks.set(t,e.data)}getBlockForBand(e){let t=0;switch(typeof e){case"string":for(const[i,r]of this.dataIndex.entries()){for(const[n,a]of r.bands.entries())if(a===e)return{bandIndex:t+n,blockIndex:i,blockBandIndex:n};t+=r.bands.length}break;case"number":for(const[i,r]of this.dataIndex.entries()){if(e>=t&&e<t+r.bands.length)return{bandIndex:e,blockIndex:i,blockBandIndex:e-t};t+=r.bands.length}break;default:throw new Pv("Invalid band `".concat(JSON.stringify(e),"`. Expected string or integer."))}throw new Pv("Band not found: ".concat(JSON.stringify(e)))}getDataRange(e){let t=1/0,i=-1/0,r=1/0,n=-1/0;for(const a of e){const{blockIndex:e}=this.getBlockForBand(a);if(e<0)throw new Pv("Invalid band: ".concat(JSON.stringify(a)));const o=this.dataIndex[e];r=Math.min(r,e),n=Math.max(n,e),t=Math.min(t,o.first_byte),i=Math.max(i,o.last_byte)}return{layerName:this.name,firstByte:t,lastByte:i,firstBlock:r,lastBlock:n}}hasBand(e){const{blockIndex:t}=this.getBlockForBand(e);return t>=0}hasDataForBand(e){const{blockIndex:t}=this.getBlockForBand(e);return t>=0&&!!this._decodedBlocks.get(t.toString())}getBandView(e){const{blockIndex:t,blockBandIndex:i}=this.getBlockForBand(e),r=this._decodedBlocks.get(t.toString());if(!r)throw new Pv("Data for band ".concat(JSON.stringify(e),' of layer "').concat(this.name,'" not decoded.'));const n=this.dataIndex[t],a=this.bandShape.reduce(((e,t)=>e*t),1),o=i*a,s=r.subarray(o,o+a);return{data:s,bytes:new Uint8Array(s.buffer).subarray(s.byteOffset,s.byteOffset+s.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:n.offset,scale:n.scale}}}class sx{constructor(e,t,i){this.tasks=e,this._onCancel=t,this._onComplete=i,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,t){this._finalized||(this._onComplete(e,t),this._finalized=!0)}}ax.performDecoding=function(e,t){return Promise.all(t.tasks.map((t=>{const{layerName:i,firstByte:r,lastByte:n,pixelFormat:a,blockShape:o,blockIndex:s,filters:l,codec:c}=t,h=new Uint8Array(e).subarray(r,n+1),u=new Uint32Array(o[0]*o[1]*o[2]);let d;if("gzip_data"!==c)throw new Error("Unhandled codec: ".concat(c));return d=function(e,t){if(!globalThis.DecompressionStream&&"gzip_data"===t)return Promise.resolve(((a=function(e){31==e[0]&&139==e[1]&&8==e[2]||Kv(6,"invalid gzip data");var t=e[3],i=10;4&t&&(i+=2+(e[10]|e[11]<<8));for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[i++]);return i+(2&t)}(n=e))+8>n.length&&Kv(6,"invalid gzip data"),function(e,t,i,r){var n=e.length;if(!n||t.f&&!t.l)return i||new Cv(0);var a=!i,o=a||2!=t.i,s=t.i;a&&(i=new Cv(3*n));var l,c,h=function(e){var t=i.length;if(e>t){var r=new Cv(Math.max(2*t,e));r.set(i),i=r}},u=t.f||0,d=t.p||0,p=t.b||0,f=t.l,m=t.d,g=t.m,_=t.n,y=8*n;do{if(!f){u=Xv(e,d,1);var v=Xv(e,d+1,3);if(d+=3,!v){var x=e[(k=4+((d+7)/8|0))-4]|e[k-3]<<8,b=k+x;if(b>n){s&&Kv(0);break}o&&h(p+x),i.set(e.subarray(k,b),p),t.b=p+=x,t.p=d=8*b,t.f=u;continue}if(1==v)f=Wv,m=Zv,g=9,_=5;else if(2==v){var w=Xv(e,d,31)+257,S=Xv(e,d+10,15)+4,T=w+Xv(e,d+5,31)+1;d+=14;for(var E=new Cv(T),M=new Cv(19),A=0;A<S;++A)M[Lv[A]]=Xv(e,d+3*A,7);d+=3*S;var P=Qv(M),C=(1<<P)-1,I=Gv(M,P,1);for(A=0;A<T;){var k,D=I[Xv(e,d,C)];if(d+=15&D,(k=D>>4)<16)E[A++]=k;else{var R=0,L=0;for(16==k?(L=3+Xv(e,d,3),d+=2,R=E[A-1]):17==k?(L=3+Xv(e,d,7),d+=3):18==k&&(L=11+Xv(e,d,127),d+=7);L--;)E[A++]=R}}var z=E.subarray(0,w),F=E.subarray(w);g=Qv(z),_=Qv(F),f=Gv(z,g,1),m=Gv(F,_,1)}else Kv(1);if(d>y){s&&Kv(0);break}}o&&h(p+131072);for(var O=(1<<g)-1,B=(1<<_)-1,N=d;;N=d){var V=(R=f[Yv(e,d)&O])>>4;if((d+=15&R)>y){s&&Kv(0);break}if(R||Kv(2),V<256)i[p++]=V;else{if(256==V){N=d,f=null;break}var j=V-254;V>264&&(j=Xv(e,d,(1<<(q=Dv[A=V-257]))-1)+Ov[A],d+=q);var U=m[Yv(e,d)&B],G=U>>4;if(U||Kv(3),d+=15&U,F=Nv[G],G>3){var q=Rv[G];F+=Yv(e,d)&(1<<q)-1,d+=q}if(d>y){s&&Kv(0);break}o&&h(p+131072);var H=p+j;if(p<F){var W=0-F,Z=Math.min(F,H);for(W+p<0&&Kv(3);p<Z;++p)i[p]=(void 0)[W+p]}for(;p<H;++p)i[p]=i[p-F]}}t.l=f,t.p=N,t.b=p,t.f=u,f&&(u=1,t.m=g,t.d=m,t.n=_)}while(!u);return p!=i.length&&a?(l=i,(null==(c=p)||c>l.length)&&(c=l.length),new Cv(l.subarray(0,c))):i.subarray(0,p)}(n.subarray(a,-8),{i:2},new Cv(((i=n)[(r=i.length)-4]|i[r-3]<<8|i[r-2]<<16|i[r-1]<<24)>>>0))));var i,r,n,a;const o=tx[t];if(!o)throw new Error("Unhandled codec: ".concat(t));const s=new globalThis.DecompressionStream(o);return new Response(new Blob([e]).stream().pipeThrough(s)).arrayBuffer().then((e=>new Uint8Array(e)))}(h,c).then((e=>{const t=Sv.read(new wm(e));if("uint32_values"===t.values)return t.uint32_values.readValuesInto(u),new(0,nx[a])(u.buffer);throw new Error('Unhandled numeric data "'.concat(t.values,'"'))})),d.then((e=>{for(let t=l.length-1;t>=0;t--)switch(l[t]){case"delta_filter":Ev(e,o);break;case"zigzag_filter":Mv(e);break;case"bitshuffle_filter":Av(e,a);break;default:throw new Error('Unhandled filter "'.concat(l[t],'"'))}return{layerName:i,blockIndex:s,data:e}})).catch((e=>{throw e}))})))},fs(sx,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const lx=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class cx{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,i]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const r=i>>4;if(1!==r)throw new Error("Got v".concat(r," data when expected v1."));const n=lx[15&i];if(!n)throw new Error("Unrecognized array type.");const[a]=new Uint16Array(e,2,1),[o]=new Uint32Array(e,4,1);return new cx(o,a,n,e)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Float64Array,r=arguments.length>3?arguments[3]:void 0;if(isNaN(e)||e<0)throw new Error("Unpexpected numItems value: ".concat(e,"."));this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=i,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const n=lx.indexOf(this.ArrayType),a=2*e*this.ArrayType.BYTES_PER_ELEMENT,o=e*this.IndexArrayType.BYTES_PER_ELEMENT,s=(8-o%8)%8;if(n<0)throw new Error("Unexpected typed array class: ".concat(i,"."));r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+o+s,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+a+o+s),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+o+s,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+n]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=e,this.coords[this._pos++]=t,i}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error("Added ".concat(e," items when expected ").concat(this.numItems,"."));return hx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,i,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:a,nodeSize:o}=this,s=[0,n.length-1,0],l=[];for(;s.length;){const c=s.pop()||0,h=s.pop()||0,u=s.pop()||0;if(h-u<=o){for(let o=u;o<=h;o++){const s=a[2*o],c=a[2*o+1];s>=e&&s<=i&&c>=t&&c<=r&&l.push(n[o])}continue}const d=u+h>>1,p=a[2*d],f=a[2*d+1];p>=e&&p<=i&&f>=t&&f<=r&&l.push(n[d]),(0===c?e<=p:t<=f)&&(s.push(u),s.push(d-1),s.push(1-c)),(0===c?i>=p:r>=f)&&(s.push(d+1),s.push(h),s.push(1-c))}return l}within(e,t,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:n,nodeSize:a}=this,o=[0,r.length-1,0],s=[],l=i*i;for(;o.length;){const c=o.pop()||0,h=o.pop()||0,u=o.pop()||0;if(h-u<=a){for(let i=u;i<=h;i++)fx(n[2*i],n[2*i+1],e,t)<=l&&s.push(r[i]);continue}const d=u+h>>1,p=n[2*d],f=n[2*d+1];fx(p,f,e,t)<=l&&s.push(r[d]),(0===c?e-i<=p:t-i<=f)&&(o.push(u),o.push(d-1),o.push(1-c)),(0===c?e+i>=p:t+i>=f)&&(o.push(d+1),o.push(h),o.push(1-c))}return s}}function hx(e,t,i,r,n,a){if(n-r<=i)return;const o=r+n>>1;ux(e,t,o,r,n,a),hx(e,t,i,r,o-1,1-a),hx(e,t,i,o+1,n,1-a)}function ux(e,t,i,r,n,a){for(;n>r;){if(n-r>600){const o=n-r+1,s=i-r+1,l=Math.log(o),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(o-c)/o)*(s-o/2<0?-1:1);ux(e,t,i,Math.max(r,Math.floor(i-s*c/o+h)),Math.min(n,Math.floor(i+(o-s)*c/o+h)),a)}const o=t[2*i+a];let s=r,l=n;for(dx(e,t,r,i),t[2*n+a]>o&&dx(e,t,r,n);s<l;){for(dx(e,t,s,l),s++,l--;t[2*s+a]<o;)s++;for(;t[2*l+a]>o;)l--}t[2*r+a]===o?dx(e,t,r,l):(l++,dx(e,t,l,n)),l<=i&&(r=l+1),i<=l&&(n=l-1)}}function dx(e,t,i,r){px(e,i,r),px(t,2*i,2*r),px(t,2*i+1,2*r+1)}function px(e,t,i){const r=e[t];e[t]=e[i],e[i]=r}function fx(e,t,i,r){const n=e-i,a=t-r;return n*n+a*a}e.$=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function(e){let[t,i]=e;const r=fi([1,t,i]);return{x:r.x,y:r.y,z:r.z}}(e.expression.evaluate(t))}interpolate(e,t,i){return{x:Ur(e.x,t.x,i),y:Ur(e.y,t.y,i),z:Ur(e.z,t.z,i)}}},e.A=il,e.B=Zo,e.C=In,e.D=qo,e.E=zr,e.F=function(e){const t=e.value;let i=[];if(!t)return i;const r=En(t);return"string"!==r?(i=i.concat([new K_(e.key,t,'string expected, "'.concat(r,'" found'))]),i):($_(t,!0)||(i=i.concat([new K_(e.key,t,'invalid url "'.concat(t,'"'))])),i)},e.G=tl,e.H=Ks,e.I=eg,e.J=Xs,e.K=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return fi(e.expression.evaluate(t))}interpolate(e,t,i){return{x:Ur(e.x,t.x,i),y:Ur(e.y,t.y,i),z:Ur(e.z,t.z,i),azimuthal:Ur(e.azimuthal,t.azimuthal,i),polar:Ur(e.polar,t.polar,i)}}},e.L=Gs,e.M=class{constructor(e,t,i,r){this.id=e,this.position=null!=t?new oh(t[0],t[1]):new oh(0,0),this.orientation=null!=i?i:[0,0,0],this.nodes=r,this.uploaded=!1,this.aabb=new mu([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,i){if(e.a9.multiply(t.matrix,i,t.matrix),t.meshes)for(const e of t.meshes){const i=mu.applyTransform(e.aabb,t.matrix);this.aabb.encapsulate(i)}if(t.children)for(const e of t.children)this._applyTransformations(e,t.matrix)}computeBoundsAndApplyParent(){const t=e.a9.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(e,t,i,r,n,a){let o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];sy(this.matrix,this,e.transform,this.position,t,i,r,n,a,o)}upload(e){if(!this.uploaded){for(const t of this.nodes)hy(t,e);for(const e of this.nodes)uy(e);this.uploaded=!0}}destroy(){for(const e of this.nodes)dy(e)}},e.N=Vs,e.O=Ch,e.P=Vt,e.R=Xi,e.S=Yt,e.T=v_,e.U=Qs,e.V=K_,e.W=Nu,e.X=Ur,e.Y=na,e.Z=as,e._=Gr,e.a=Lr,e.a$=ai,e.a0=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const n=new Vt(i,i),a=e.sub(n),o=t.add(n),s=[a,new Vt(o.x,a.y),o,new Vt(a.x,o.y)];return r&&s.push(a.clone()),s},e.a1=function(e,t){const i=[];for(let r=0;r<e.length;r++){const n=Jt(r-1,-1,e.length-1),a=Jt(r+1,-1,e.length-1),o=e[r],s=e[a],l=e[n].sub(o).unit(),c=s.sub(o).unit(),h=c.angleWithSep(l.x,l.y),u=l.add(c).unit().mult(-1*t/Math.sin(h/2));i.push(o.add(u))}return i},e.a2=Dg,e.a3=Kh,e.a4=function(t,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e.Q.fromValues(((i.x-r)*t.scale-t.x)*na,(i.y*t.scale-t.y)*na,Sh(i.z,i.y))},e.a5=lu,e.a6=Pf,e.a7=function(e){let t=1/0,i=1/0,r=-1/0,n=-1/0;for(const a of e)t=Math.min(t,a.x),i=Math.min(i,a.y),r=Math.max(r,a.x),n=Math.max(n,a.y);return{min:new Vt(t,i),max:new Vt(r,n)}},e.a8=yh,e.aA=jr,e.aB=Sl,e.aC=Ro,e.aD=ec,e.aE=mc,e.aF=ti,e.aG=rc,e.aH=c_,e.aI=function(){Ns.isLoading()||Ns.isLoaded()||"deferred"!==Os()||Bs()},e.aJ=rl,e.aK=Bh,e.aL=ov,e.aM=gi,e.aN=Ef,e.aO=qd,e.aP=Oh,e.aQ=El,e.aR=Yl,e.aS=vu,e.aT=Nd,e.aU=y_,e.aV=function(t,i){const r=Nu(i.zoom);if(0===r)return Eu(t);const n=Cu(t),a=Iu(n),o=yh(n.getWest())*i.worldSize,s=yh(n.getEast())*i.worldSize,l=vh(n.getNorth())*i.worldSize,c=vh(n.getSouth())*i.worldSize,h=[o,l,0],u=[s,l,0],d=[o,c,0],p=[s,c,0],f=e.a9.invert([],i.globeMatrix);return e.Q.transformMat4(h,h,f),e.Q.transformMat4(u,u,f),e.Q.transformMat4(d,d,f),e.Q.transformMat4(p,p,f),a[0]=Mu(a[0],d,r),a[1]=Mu(a[1],p,r),a[2]=Mu(a[2],u,r),a[3]=Mu(a[3],h,r),mu.fromPoints(a)},e.aW=Lu,e.aX=ku,e.aY=Mu,e.aZ=Ml,e.a_=yu,e.ab=Jh,e.ac=kh,e.ad=Xt,e.ae=Qc,e.af=function(e,t){const i={};for(let r=0;r<t.length;r++){const n=t[r];n in e&&(i[n]=e[n])}return i},e.ag=sh,e.ah=vh,e.ai=class{constructor(e){this.entries={},this.scheduler=e}request(e,t,i,r){const n=this.entries[e]=this.entries[e]||{callbacks:[]};if(n.result){const[e,i]=n.result;return this.scheduler?this.scheduler.add((()=>{r(e,i)}),t):r(e,i),()=>{}}return n.callbacks.push(r),n.cancel||(n.cancel=i(((i,r)=>{n.result=[i,r];for(const e of n.callbacks)this.scheduler?this.scheduler.add((()=>{e(i,r)}),t):e(i,r);setTimeout((()=>delete this.entries[e]),3e3)}))),()=>{n.result||(n.callbacks=n.callbacks.filter((e=>e!==r)),n.callbacks.length||(n.cancel(),delete this.entries[e]))}}},e.aj=gl,e.ak=function(e,t,i){const r=JSON.stringify(e.request);return e.data&&(this.deduped.entries[r]={result:[null,e.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},(t=>{const r=$i(e.request,((e,r,n,a)=>{e?t(e):r&&t(null,{vectorTile:i?void 0:new up(new wm(r)),rawData:r,cacheControl:n,expires:a})}));return()=>{r.cancel(),t()}}),t)},e.al=function(e){ji++,ji>Bi&&(e.getActor().send("enforceCacheSizeLimit",Oi),ji=0)},e.am=fr,e.an=Ii,e.ao=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.ap=dh,e.aq=M_,e.ar=C_,e.as=T_,e.at=function(e,t){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){t(null,i)};for(let r=0;r<e.length;r++){const t=document.createElement("source");er(e[r])||(i.crossOrigin="Anonymous"),t.src=e[r],i.appendChild(t)}return{cancel:()=>{}}},e.au=x_,e.av=kg,e.aw=bh,e.ax=wh,e.ay=Al,e.az=Gl,e.b=Rr,e.b$=sg,e.b0=ax,e.b1=$i,e.b2=function(e){const t=[];for(const i in e)t.push(e[i]);return t},e.b3=function(e,t){const i=[];for(const r in e)r in t||i.push(r);return i},e.b4=Kt,e.b5=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.b6=function(t,i){const{x:r,y:n}=t.point,a=Bu(r,n,t.worldSize/t._pixelsPerMercatorPixel,0,0);return e.a9.multiply(a,a,zu(Eu(i)))},e.b8=Qf,e.b9=Pm,e.bA=Yc,e.bB=function(t){const i=e.a9.identity(new Float64Array(16));e.a9.multiply(i,t.pixelMatrix,t.globeMatrix);const r=[0,eh,0],n=[0,th,0];return e.Q.transformMat4(r,r,i),e.Q.transformMat4(n,n,i),[r[0]>0&&r[0]<=t.width&&r[1]>0&&r[1]<=t.height&&!ju(t,new oh(t.center.lat,90)),n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!ju(t,new oh(t.center.lat,-90))]},e.bC=function(t,i){const{scale:r}=t.tileTransform,n=r*na/(t.tileSize*Math.pow(2,i.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return e.b7.scale(new Float32Array(4),i.inverseAdjustmentMatrix,[n,n])},e.bD=O_,e.bE=z_,e.bF=function(t){const i=z_(t,!0);return e.b7.invert([],[i[0],i[1],i[4],i[5]])},e.bG=cu,e.bH=function(e){const{x:t,y:i}=e.point,{lng:r,lat:n}=e._center;return Bu(t,i,e.worldSize,r,n)},e.bI=qt,e.bJ=Xc,e.bK=function(e){const t=Math.round((e+45+360)%360/90)%4;return Ht[t]},e.bL=45,e.bM=_h,e.bN=kc,e.bO=Mc,e.bP=Ac,e.bQ=Ec,e.bR=Tc,e.bS=Pc,e.bT=function(e,t,i){const r=Math.sqrt(e*e+t*t+i*i),n=r>0?Math.acos(i/r)*Ut:0;let a=0!==e||0!==t?Math.atan2(-t,-e)*Ut+90:0;return a<0&&(a+=360),[r,a,n]},e.bU=Ph,e.bV=mu,e.bW=fi,e.bX=function(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]},e.bY=function(e){return e({pluginStatus:Ds,pluginURL:Rs}),Fs.on("pluginStateChange",e),e},e.bZ=gy,e.b_=wy,e.ba=Zf,e.bb=function(e,t,i,r,n){const a=5*t+2;e.float32[a+0]=i,e.float32[a+1]=r,e.float32[a+2]=n},e.bc=a_,e.bd=Jm,e.be=Uh,e.bf=qf,e.bg=bg,e.bh=xg,e.bi=Nm,e.bj=cx,e.bk=Jt,e.bm=Gt,e.bn=Ei,e.bo=xh,e.bp=function(e,t,i){e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]},e.bq=oh,e.br=$g,e.bs=uh,e.bt=fu,e.bu=F_,e.bv=hh,e.bw=Pu,e.bx=function(e,t,i,r,n,a,o,s,l){if("globe"===l.name)return Pu(e,t,new hh(i,r,n),!1);const c=kg({z:i,x:r,y:n},l);return new mu([(a+c.x/c.scale)*t,t*(c.y/c.scale),o],[(a+c.x2/c.scale)*t,t*(c.y2/c.scale),s])},e.by=function(e,t,i){let r=0;for(let n=0;n<2;++n){const i=0;e[n]>i&&(r+=(e[n]-i)*(e[n]-i)),t[n]<i&&(r+=(i-t[n])*(i-t[n]))}return r},e.bz=Th,e.c=tv,e.c$=[1,1,1],e.c0=og,e.c1=Ji,e.c2=Ls,e.c3=a,e.c4=Ri,e.c5=Ir,e.c6=ci,e.c7=function(e,t,i){return"custom"===e.type?new I_(e,t):new bv[e.type](e,t,i)},e.c8=function(e){const t=e.indexOf(ml);return t>=0?e.slice(0,t):e},e.c9=function(e){return e.indexOf(ml)>=0},e.cA=e=>({u_matrix:new kc(e),u_pixels_to_tile_units:new Lc(e),u_device_pixel_ratio:new Ec(e),u_units_to_pixels:new Mc(e),u_dash_image:new Tc(e),u_gradient_image:new Tc(e),u_image_height:new Ec(e),u_texsize:new Mc(e),u_tile_units_to_pixels:new Ec(e),u_alpha_discard_threshold:new Ec(e),u_trim_offset:new Mc(e),u_emissive_strength:new Ec(e)}),e.cB=e=>({u_matrix:new kc(e),u_texsize:new Mc(e),u_pixels_to_tile_units:new Lc(e),u_device_pixel_ratio:new Ec(e),u_image:new Tc(e),u_units_to_pixels:new Mc(e),u_tile_units_to_pixels:new Ec(e),u_alpha_discard_threshold:new Ec(e),u_trim_offset:new Mc(e)}),e.cC=jl,e.cD=Gf,e.cE=Xf,e.cF=Wu,e.cG=(e,t,i,r,n,a)=>{const o=e.transform,s="globe"===o.projection.name;let l;if("map"===a.paint.get("circle-pitch-alignment"))if(s){const e=Ou(o.zoom,t.canonical)*o._pixelsPerMercatorPixel;l=Float32Array.from([e,0,0,e])}else l=o.calculatePixelsToTileUnitsMatrix(i);else l=new Float32Array([o.pixelsToGLUnits[0],0,0,o.pixelsToGLUnits[1]]);const c={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(o.projection),u_matrix:e.translatePosMatrix(t.projMatrix,i,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ki.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:Hu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:a.paint.get("circle-emissive-strength")};if(s){c.u_inv_rot_matrix=r,c.u_merc_center=n,c.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],c.u_zoom_transition=Nu(o.zoom);const e=n[0]*na,i=n[1]*na;c.u_up_dir=o.projection.upVector(new hh(0,0,0),e,i)}return c},e.cH=kf,e.cI=(e,t,i,r,n,a)=>{const o=e.transform;return{u_matrix:If(e,t,i,r),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:o.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:n,u_image:0,u_tile_units_to_pixels:Cf(t,o),u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:a}},e.cJ=(e,t,i,r,n,a,o)=>{const s=e.transform,l=s.calculatePixelsToTileUnitsMatrix(t);return{u_matrix:If(e,t,i,r),u_pixels_to_tile_units:l,u_device_pixel_ratio:a,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:n,u_texsize:Df(i)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Cf(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:o,u_emissive_strength:i.paint.get("line-emissive-strength")}},e.cK=ri,e.cL=sd,e.cM=of,e.cN=fh,e.cO=Jp,e.cP=Vp,e.cQ=450,e.cR=7,e.cS=E_,e.cT=256,e.cU=zu,e.cV=Jl,e.cW=Zl,e.cX=Ql,e.cY=function(e,t,i,r,n){return Xt((e-t)/(i-t)*(n-r)+r,r,n)},e.cZ=Mh,e.c_=G_,e.ca=function(e){const t=e.indexOf(ml);return t>=0?e.slice(t+1):""},e.cb=function(e){const t=[],i=e.id;return void 0===i&&t.push({message:"layers.".concat(i,': missing required property "id"')}),void 0===e.render&&t.push({message:"layers.".concat(i,': missing required method "render"')}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:"layers.".concat(i,': property "renderingMode" must be either "2d" or "3d"')}),t},e.cc=li,e.cd=Fs,e.ce=Ki,e.cf=Cc,e.cg=class extends Sc{constructor(e){super(e),this.current=Dc}set(e,t,i){if(this.fetchUniformLocation(e,t))for(let r=0;r<9;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},e.ch=Wt,e.ci=function(e,t,i){const r=Nu(i.zoom),n=e.style.map._antialias,a=t.options.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return 0===r&&!n&&!a},e.cj=function(t){const i=t.pixelsPerMeter,r=i/xh(1,t.center.lat),n=e.a9.identity(new Float64Array(16));return e.a9.translate(n,n,[t.point.x,t.point.y,0]),e.a9.scale(n,n,[r,r,i]),Float32Array.from(n)},e.ck=Cu,e.cl=function(e){const t=Th-5;e=Xt(e,-t,t)/t*90;const i=Math.pow(Math.abs(Math.sin(Gt(e))),3);return Math.round(i*($c.length-1))},e.cm=function(t,i,r,n){const a=i.getNorth(),o=i.getSouth(),s=i.getWest(),l=i.getEast(),c=1<<t.z,h=l-s,u=a-o,d=h/Kc,p=-u/$c[r],f=[0,d,0,p,0,0,a,s,0];if(t.z>0){const t=180/n;e.ct.multiply(f,f,[t/h+1,0,0,0,t/u+1,0,-.5*t/d,.5*t/p,1])}return f[2]=c,f[5]=t.x,f[8]=t.y,f},e.cn=Eu,e.co=function(t,i,r){const n=e.a9.identity(new Float64Array(16)),a=(i/(1<<t)-.5)*Math.PI*2;return e.a9.rotateY(n,r.globeMatrix,a),Float32Array.from(n)},e.cp=class{isDataAvailableAtPoint(e){const t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;const i=t.getSource().maxzoom,r=1<<i,n=Math.floor(e.x),a=Math.floor((e.x-n)*r),o=Math.floor(e.y*r),s=this.findDEMTileFor(new dh(i,n,i,a,o));return!(!s||!s.dem)}getAtPointOrZero(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getAtPoint(e,t)||0}getAtPoint(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.isUsingMockSource())return null;null==t&&(t=null);const r=this._source();if(!r)return t;if(e.y<0||e.y>1)return t;const n=r.getSource().maxzoom,a=1<<n,o=Math.floor(e.x),s=e.x-o,l=new dh(n,o,n,Math.floor(s*a),Math.floor(e.y*a)),c=this.findDEMTileFor(l);if(!c||!c.dem)return t;const h=c.dem,u=1<<c.tileID.canonical.z,d=(s*u-c.tileID.canonical.x)*h.dim,p=(e.y*u-c.tileID.canonical.y)*h.dim,f=Math.floor(d),m=Math.floor(p);return(i?this.exaggeration():1)*Ur(Ur(h.get(f,m),h.get(f,m+1),p-m),Ur(h.get(f+1,m),h.get(f+1,m+1),p-m),d-f)}getAtTileOffset(e,t,i){const r=1<<e.canonical.z;return this.getAtPointOrZero(new Ch(e.wrap+(e.canonical.x+t/na)/r,(e.canonical.y+i/na)/r))}getAtTileOffsetFunc(t,i,r,n){return a=>{const o=this.getAtTileOffset(t,a.x,a.y),s=n.upVector(t.canonical,a.x,a.y),l=n.upVectorScale(t.canonical,i,r).metersToTile;return e.Q.scale(s,s,o*l),s}}getForTilePoints(e,t,i,r){if(this.isUsingMockSource())return!1;const n=Rp.create(this,e,r);return!!n&&(t.forEach((e=>{e[2]=this.exaggeration()*n.getElevationAt(e[0],e[1],i)})),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const i=t.dem.tree,r=t.tileID,n=1<<e.canonical.z-r.canonical.z;let a=e.canonical.x/n-r.canonical.x,o=e.canonical.y/n-r.canonical.y,s=0;for(let l=0;l<e.canonical.z-r.canonical.z&&!i.leaves[s];l++){a*=2,o*=2;const e=2*Math.floor(o)+Math.floor(a);s=i.childOffsets[s]+e,a%=1,o%=1}return{min:this.exaggeration()*i.minimums[s],max:this.exaggeration()*i.maximums[s]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,i){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const e=this.visibleDemTiles;if(0===e.length)return null;let t=!1,i=Number.MAX_VALUE,r=Number.MIN_VALUE;for(const n of e){const e=this.getMinMaxForTile(n.tileID);e&&(i=Math.min(i,e.min),r=Math.max(r,e.max),t=!0)}return t?{min:i,max:r}:null}},e.cq=xu,e.cr=nd,e.cs=function(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]},e.cu=Ou,e.cv=Ci,e.cw=Pi,e.cx=256,e.cy=function(t,i){const r=[0,0,0],n=Lu(Eu(i.canonical));return e.Q.transformMat4(r,r,n),e.Q.transformMat4(r,r,t),r},e.cz=e=>({u_camera_to_center_distance:new Ec(e),u_extrude_scale:new Lc(e),u_device_pixel_ratio:new Ec(e),u_matrix:new kc(e),u_inv_rot_matrix:new kc(e),u_merc_center:new Mc(e),u_tile_id:new Ac(e),u_zoom_transition:new Ec(e),u_up_dir:new Ac(e),u_emissive_strength:new Ec(e)}),e.d=nr,e.d$=my,e.d0=Rp,e.d1=oy,e.d2=Bl,e.d3=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){const t=_p(new Vt(0,0),new Vt(na,na),e),i=[];for(const r of this._activeRegions){if(r.hiddenByOverlap)continue;if(!gp(t,r))continue;const n=yp(r.min,r.max,e);i.push({min:n.min,max:n.max,sourceId:this._sourceIds[r.priority],footprint:r.footprint,footprintTileId:r.tileId})}return i}setSources(e){this._setSources(e.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const t=[];for(const i of e.cache.getVisibleCoordinates()){const r=e.cache.getTile(i).buckets[e.layer];if(r)for(const e of r.getNodesInfo()){const r=e.node;r.footprint&&t.push({footprint:r.footprint,id:i.toUnwrapped()})}}return t}}))))}_addSource(e){const t=e.getFootprints();if(0!==t.length){for(const e of t){if(!e.footprint)continue;const t=_p(e.footprint.min,e.footprint.max,e.id);this._activeRegions.push({min:t.min,max:t.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:e.id,footprint:e.footprint})}this._sourceIds.push(e.getSourceId())}}_computeReplacement(){this._activeRegions.sort(((e,t)=>e.priority-t.priority||fp(e.min,t.min)||fp(e.max,t.max)));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let t=0,i=0;for(;!e&&t!==this._activeRegions.length;){const r=this._activeRegions[t],n=this._prevRegions[i];e=r.priority!==n.priority||!mp(r,n),++t,++i}}if(e){++this._updateTime;const e=e=>{const t=this._activeRegions;if(e>=t.length)return e;const i=t[e].priority;for(;e<t.length&&t[e].priority===i;)++e;return e};if(this._sourceIds.length>1){let t=0,i=e(t);for(;t!==i;){let r=t;const n=t;for(;r!==i;){const e=this._activeRegions[r];e.hiddenByOverlap=!1;for(let t=0;t<n;t++){const i=this._activeRegions[t];if(!i.hiddenByOverlap&&gp(e,i)&&(e.hiddenByOverlap=xp(e.footprint,e.tileId,i.footprint,i.tileId),e.hiddenByOverlap))break}++r}t=i,i=e(t)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=e.length-1;t>=0;t--)this._addSource(e[t]);this._computeReplacement()}},e.d4=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,t){const i=new El,r=new Gl,n=[],a=e+1+2,o=t[0]+1,s=t[0]+1+(1+t.length),l=(e,t,i)=>{let r=e===a-1?e-2:0===e?e:e-1;return r+=i?24575:0,[r,t]};for(let c=0;c<a;++c)i.emplaceBack(...l(c,0,!0));for(let c=0;c<o;++c)for(let e=0;e<a;++e)i.emplaceBack(...l(e,c,(0===e||e===a-1)&&!0));for(let c=0;c<t.length;++c){const e=t[c];for(let t=0;t<a;++t)i.emplaceBack(...l(t,e,!0))}for(let c=0;c<t.length;++c){const e=r.length,o=t[c]+1+2,l=new Gl;for(let i=0;i<o-1;i++){const e=i===o-2,n=e?a*(s-t.length+c-i):a;for(let t=0;t<a-1;t++){const o=i*a+t;0===i||e||0===t||t===a-2?(l.emplaceBack(o+1,o,o+n),l.emplaceBack(o+n,o+n+1,o+1)):(r.emplaceBack(o+1,o,o+n),r.emplaceBack(o+n,o+n+1,o+1))}}const h=mc.simpleSegment(0,e,i.length,r.length-e);for(let t=0;t<l.uint16.length;t+=3)r.emplaceBack(l.uint16[t],l.uint16[t+1],l.uint16[t+2]);const u=mc.simpleSegment(0,e,i.length,r.length-e);n.push({withoutSkirts:h,withSkirts:u})}return{vertices:i,indices:r,segments:n}}_createGrid(e){const t=this._fillGridMeshWithLods(Kc,$c);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,vu.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const t=new Gl;for(let o=0;o<=Kc;o++)t.emplaceBack(0,o+1,o+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const i=new Zl,r=new Zl,n=new Zl,a=new Zl;this._poleSegments=[];for(let o=0,s=0;o<Xc;o++){const e=360/(1<<o);i.emplaceBack(0,-Qc,0,.5,0),r.emplaceBack(0,-Qc,0,.5,1),n.emplaceBack(0,-Qc,0,.5,.5),a.emplaceBack(0,-Qc,0,.5,.5);for(let t=0;t<=Kc;t++){let o=t/Kc,s=0;const l=Ur(0,e,o),[c,h,u]=ih(Gu,qu,l,Qc);i.emplaceBack(c,h,u,o,s),r.emplaceBack(c,h,u,o,1-s);const d=Gt(l);o=.5+.5*Math.sin(d),s=.5+.5*Math.cos(d),n.emplaceBack(c,h,u,o,s),a.emplaceBack(c,h,u,o,1-s)}this._poleSegments.push(mc.simpleSegment(s,0,66,64)),s+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(i,_u,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(r,_u,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(n,_u,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(a,_u,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}},e.d5=function(e){return Sr.has(e)},e.d6=Zt,e.d7=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},e.d8=Qt,e.d9=Ah,e.dA=xy,e.dB=function(e){const t=Ni();if(!t)return;const i=t.delete(Li);e&&i.catch(e).then((()=>e()))},e.dC=_y,e.dD=Cy,e.dE=function(e){Ty=ki.resolveURL(e),Py||(Py=new gy(wy(),new zr)),Py.broadcast("setDracoUrl",Ty)},e.dF=Iy,e.dG=function(e){My=ki.resolveURL(e),Py||(Py=new gy(wy(),new zr)),Py.broadcast("setMeshoptUrl",My)},e.dH=fs,e.dI=id,e.dJ=ag,e.dK=nv,e.dL=sv,e.dM=bf,e.dN=si,e.dO=tg,e.dP=function(e,t,i,r,n,a,o,s,l,c,h){e.createArrays(),e.tilePixelRatio=na/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const u=e.layers[0].layout,d=e.layers[0]._unevaluatedLayout._values,p={};if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:i}=e.textSizeData;p.compositeTextSizes=[d["text-size"].possiblyEvaluate(new Vs(t),s),d["text-size"].possiblyEvaluate(new Vs(i),s)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:i}=e.iconSizeData;p.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new Vs(t),s),d["icon-size"].possiblyEvaluate(new Vs(i),s)]}p.layoutTextSize=d["text-size"].possiblyEvaluate(new Vs(l+1),s),p.layoutIconSize=d["icon-size"].possiblyEvaluate(new Vs(l+1),s),p.textMaxSize=d["text-size"].possiblyEvaluate(new Vs(18),s);const f="map"===u.get("text-rotation-alignment")&&"point"!==u.get("symbol-placement"),m=u.get("text-size");let g=!1;for(const _ of e.features)if(_.icon&&_.icon.nameSecondary){g=!0;break}for(const _ of e.features){const a=u.get("text-font").evaluate(_,{},s).join(","),l=m.evaluate(_,{},s),d=p.layoutTextSize.evaluate(_,{},s),y=(p.layoutIconSize.evaluate(_,{},s),{horizontal:{},vertical:void 0}),v=_.text;let x,b=[0,0];if(v){const r=v.toString(),o=u.get("text-letter-spacing").evaluate(_,{},s)*qf,c=u.get("text-line-height").evaluate(_,{},s)*qf,h=bs(r)?o:0,p=u.get("text-anchor").evaluate(_,{},s),m=u.get("text-variable-anchor");if(!m){const e=u.get("text-radial-offset").evaluate(_,{},s);b=e?xg(p,[e*qf,yg]):u.get("text-offset").evaluate(_,{},s).map((e=>e*qf))}let g=f?"center":u.get("text-justify").evaluate(_,{},s);const x="point"===u.get("symbol-placement"),w=x?u.get("text-max-width").evaluate(_,{},s)*qf:1/0,S=o=>{e.allowVerticalPlacement&&xs(r)&&(y.vertical=km(v,t,i,n,a,w,c,p,o,h,b,Pm.vertical,!0,d,l))};if(!f&&m){const e="auto"===g?m.map((e=>bg(e))):[g];let r=!1;for(let o=0;o<e.length;o++){const s=e[o];if(!y.horizontal[s])if(r)y.horizontal[s]=y.horizontal[0];else{const e=km(v,t,i,n,a,w,c,"center",s,h,b,Pm.horizontal,!1,d,l);e&&(y.horizontal[s]=e,r=1===e.positionedLines.length)}}S("left")}else{if("auto"===g&&(g=bg(p)),x||u.get("text-writing-mode").indexOf("horizontal")>=0||!xs(r)){const e=km(v,t,i,n,a,w,c,p,g,h,b,Pm.horizontal,!1,d,l);e&&(y.horizontal[g]=e)}S(x?"left":g)}}let w=!1;if(_.icon&&_.icon.namePrimary){const t=r[_.icon.namePrimary];t&&(x=jm(n[_.icon.namePrimary],_.icon.nameSecondary?n[_.icon.nameSecondary]:void 0,u.get("icon-offset").evaluate(_,{},s),u.get("icon-anchor").evaluate(_,{},s)),w=t.sdf,void 0===e.sdfIcons?e.sdfIcons=t.sdf:e.sdfIcons!==t.sdf&&ui("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(t.pixelRatio!==e.pixelRatio||0!==u.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}const S=Mg(y.horizontal)||y.vertical;e.iconsInText||(e.iconsInText=!!S&&S.iconsInText),(S||x)&&wg(e,_,y,x,r,p,d,0,b,w,o,s,c,h,g)}a&&e.generateCollisionDebugBuffers(l,e.collisionBoxArray)},e.dQ=up,e.dR=wm,e.dS=Dp,e.dT=dp,e.dU=$d,e.dV=Bt,e.dW=tm,e.dX=u,e.dY=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==Ny){const i=new Uint32Array(e,0,7),[,,r,n,a,o]=i;t=i.byteLength+n+a+o+a,(r!==e.byteLength||t>=e.byteLength)&&ui("Invalid b3dm header information.")}return Hy(e,t)},e.dZ=function(e,t){const i=tv(e);for(const r of i){for(const e of r.meshes)iv(e);r.lights&&(r.lightMeshIndex=r.meshes.length,r.meshes.push(rv(r.lights,t)))}return i},e.d_=gv,e.da=rh,e.db=function(e){let[t,i,r]=e;const n=Math.hypot(t,i,r),a=Math.atan2(t,r),o=.5*Math.PI-Math.acos(-i/n);return new oh(qt(a),qt(o))},e.dc=nh,e.dd=r,e.de=ju,e.df=Vu,e.dg=function(t){const i=[0,0,0],r=e.a9.identity(new Float64Array(16));return e.a9.multiply(r,t.pixelMatrix,t.globeMatrix),e.Q.transformMat4(i,i,r),new Vt(i[0],i[1])},e.dh=function(e){const t=e.navigator?e.navigator.userAgent:null;return!!function(e){if(null==Si){const t=e.navigator?e.navigator.userAgent:null;Si=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Si}(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},e.di=class{constructor(e,t,i){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ar,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,i){if(!a(e))return e;const r=lr(e);return r.params.push("sdk=js-".concat(t)),r.path="/styles/v1".concat(r.path),this._makeAPIURL(r,this._customAccessToken||i)}normalizeGlyphsURL(e,t){if(!a(e))return e;const i=lr(e);return i.path="/fonts/v1".concat(i.path),this._makeAPIURL(i,this._customAccessToken||t)}normalizeModelURL(e,t){if(!a(e))return e;const i=lr(e);return i.path="/models/v1".concat(i.path),this._makeAPIURL(i,this._customAccessToken||t)}normalizeSourceURL(e,t,i,r){if(!a(e))return e;const n=lr(e);return n.path="/v4/".concat(n.authority,".json"),n.params.push("secure"),i&&n.params.push("language=".concat(i)),r&&n.params.push("worldview=".concat(r)),this._makeAPIURL(n,this._customAccessToken||t)}normalizeSpriteURL(e,t,i,r){const n=lr(e);return a(e)?(n.path="/styles/v1".concat(n.path,"/sprite").concat(t).concat(i),this._makeAPIURL(n,this._customAccessToken||r)):(n.path+="".concat(t).concat(i),cr(n))}normalizeTileURL(e,t,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!a(e))return e;const n=lr(e);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,"".concat(t||i&&"raster"!==n.authority&&512===i?"@2x":"").concat(Ui.supported?".webp":"$1")),"raster"===n.authority?n.path="/".concat(r.RASTER_URL_PREFIX).concat(n.path):"rasterarrays"===n.authority?n.path="/".concat(r.RASTERARRAYS_URL_PREFIX).concat(n.path):(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path="/".concat(r.TILE_URL_VERSION).concat(n.path));const o=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(n.params)||r.ACCESS_TOKEN;return r.REQUIRE_ACCESS_TOKEN&&o&&this._skuToken&&n.params.push("sku=".concat(this._skuToken)),this._makeAPIURL(n,o)}canonicalizeTileURL(e,t){const i=lr(e);if(!i.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!i.path.match(/\.[\w]+$/))return e;let n="mapbox://";i.path.match(/^\/raster\/v1\//)?n+="raster/".concat(i.path.replace("/".concat(r.RASTER_URL_PREFIX,"/"),"")):i.path.match(/^\/rasterarrays\/v1\//)?n+="rasterarrays/".concat(i.path.replace("/".concat(r.RASTERARRAYS_URL_PREFIX,"/"),"")):n+="tiles/".concat(i.path.replace("/".concat(r.TILE_URL_VERSION,"/"),""));let a=i.params;return t&&(a=a.filter((e=>!e.match(/^access_token=/)))),a.length&&(n+="?".concat(a.join("&"))),n}canonicalizeTileset(e,t){const i=!!t&&a(t),r=[];for(const a of e.tiles||[])n(a)?r.push(this.canonicalizeTileURL(a,i)):r.push(a);return r}_makeAPIURL(e,t){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",n=lr(r.API_URL);if(e.protocol=n.protocol,e.authority=n.authority,"http"===e.protocol){const t=e.params.indexOf("secure");t>=0&&e.params.splice(t,1)}if("/"!==n.path&&(e.path="".concat(n.path).concat(e.path)),!r.REQUIRE_ACCESS_TOKEN)return cr(e);if(t=t||r.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error("An API access token is required to use Mapbox GL. ".concat(i));if("s"===t[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ".concat(i))}return e.params=e.params.filter((e=>-1===e.indexOf("access_token"))),e.params.push("access_token=".concat(t||"")),cr(e)}},e.dj=function(e,t){t?Sr.add(e):Sr.delete(e)},e.dk=Ui,e.dl=xr,e.dm=wr,e.dn=or,e.dp=gr,e.dq=yr,e.dr=function(e){Sr.delete(e)},e.ds=br,e.dt=mr,e.du=t,e.dv=function(e,t){Oi=e,Bi=t},e.dw=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Ds===Ps||Ds===Cs||Ds===Is)throw new Error("setRTLTextPlugin cannot be called multiple times.");Rs=ki.resolveURL(e),Ds=Ps,ks=t,zs(),i||Bs()},e.dx=Os,e.dy=function(){wy().acquire(vy)},e.dz=function(){const e=by;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(vy),by=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},e.e=$t,e.e0=Ns,e.e1=function(e){Vi(),zi&&zi.then((t=>{t.keys().then((i=>{for(let r=0;r<i.length-e;r++)t.delete(i[r])}))}))},e.f=ki,e.g=function(e,t){return Ki($t(e,{type:"json"}),t)},e.h=rd,e.i=class extends K_{},e.j=En,e.k=Hr,e.l=function(e){return fetch(e).then((e=>e.arrayBuffer())).then((t=>Hy(t,0,e)))},e.m=Go,e.n=Ho,e.o=is,e.p=Km,e.q=el,e.r=os,e.s=Wo,e.t=rs,e.u=$s,e.v=Na,e.w=ui,e.x=ja,e.y=Ba})),r(["./shared"],(function(e){function t(e){const t=e?e.url.toString():void 0;return t?performance.getEntriesByName(t):[]}function i(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let t="[";for(const r of e)t+="".concat(i(r),",");return"".concat(t,"]")}let t="{";for(const r of Object.keys(e).sort())t+="".concat(r,":").concat(i(e[r]),",");return"".concat(t,"}")}function r(t){let r="";for(const n of e.b5)r+="/".concat(i(t[n]));return r}class n{constructor(e){this.keyCache={},this._layers={},this._layerConfigs={},e&&this.replace(e)}replace(e,t){this._layerConfigs={},this._layers={},this.update(e,[],t)}update(t,i,n){this._options=n;for(const r of t)this._layerConfigs[r.id]=r,(this._layers[r.id]=e.c7(r,this.scope,this._options)).compileFilter(),this.keyCache[r.id]&&delete this.keyCache[r.id];for(const e of i)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const a=function(e,t){const i={};for(let a=0;a<e.length;a++){const n=t&&t[e[a].id]||r(e[a]);t&&(t[e[a].id]=n);let o=i[n];o||(o=i[n]=[]),o.push(e[a])}const n=[];for(const r in i)n.push(i[r]);return n}(e.b2(this._layerConfigs),this.keyCache);for(const e of a){const t=e.map((e=>this._layers[e.id])),i=t[0];if("none"===i.visibility)continue;const r=i.source||"";let n=this.familiesBySource[r];n||(n=this.familiesBySource[r]={});const a=i.sourceLayer||"_geojsonTileLayer";let o=n[a];o||(o=n[a]=[]),o.push(t)}}}const a=1*e.dJ;class o{constructor(t){const i={},r=[];for(const e in t){const n=t[e],o=i[e]={};for(const e in n.glyphs){const t=n.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const i=t.metrics.localGlyph?a:1,s={x:0,y:0,w:t.bitmap.width+2*i,h:t.bitmap.height+2*i};r.push(s),o[e]=s}}const{w:n,h:o}=e.p(r),s=new e.dI({width:n||1,height:o||1});for(const l in t){const r=t[l];for(const t in r.glyphs){const n=r.glyphs[+t];if(!n||0===n.bitmap.width||0===n.bitmap.height)continue;const o=i[l][t],c=n.metrics.localGlyph?a:1;e.dI.copy(n.bitmap,s,{x:0,y:0},{x:o.x+c,y:o.y+c},n.bitmap)}}this.image=s,this.positions=i}}e.dH(o,"GlyphAtlas");class s{constructor(t){this.tileID=new e.ap(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=e.av(t.tileID.canonical,t.projection),this.projection=t.projection,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster}parse(t,i,r,n,a){this.status="parsing",this.data=t,this.collisionBoxArray=new e.aG;const s=new e.dK(Object.keys(t.layers).sort()),c=new e.dL(this.tileID,this.promoteId);c.bucketLayerIDs=[];const h={},u=new e.dM(256,256),d={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:u,availableImages:r,brightness:this.brightness},p=i.familiesBySource[this.source];for(const o in p){const i=t.layers[o];if(!i)continue;let n=!1,a=!1,u=!1;for(const e of p[o])"symbol"===e[0].type?n=!0:a=!0,e[0].is3D()&&"model"!==e[0].type&&(u=!0);if(this.extraShadowCaster&&!u)continue;if(!0===this.isSymbolTile&&!n)continue;if(!1===this.isSymbolTile&&!a)continue;1===i.version&&e.w('Vector tile source "'.concat(this.source,'" layer "').concat(o,'" does not use vector tile spec v2 and therefore may have some rendering errors.'));const f=s.encode(o),m=[];for(let e=0;e<i.length;e++){const t=i.feature(e),r=c.getId(t,o);m.push({feature:t,id:r,index:e,sourceLayerIndex:f})}for(const e of p[o]){const t=e[0];(!this.extraShadowCaster||t.is3D()&&"model"!==t.type)&&(void 0!==this.isSymbolTile&&"symbol"===t.type!==this.isSymbolTile||t.minzoom&&this.zoom<Math.floor(t.minzoom)||t.maxzoom&&this.zoom>=t.maxzoom||"none"!==t.visibility&&(l(e,this.zoom,d.brightness,r),(h[t.id]=t.createBucket({index:c.bucketLayerIDs.length,layers:e,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:f,sourceID:this.source,projection:this.projection.spec})).populate(m,d,this.tileID.canonical,this.tileTransform),c.bucketLayerIDs.push(e.map((e=>e.id)))))}}let f,m,g,_;u.trim();const y={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},v=()=>{if(f)return this.status="done",a(f);if(this.extraShadowCaster)this.status="done",a(null,{buckets:e.b2(h).filter((e=>!e.isEmpty())),featureIndex:c,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:d.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(m&&g&&_){const t=new o(m),i=new e.dO(g,_);for(const n in h){const a=h[n];a instanceof e.aH?(l(a.layers,this.zoom,d.brightness,r),e.dP(a,m,t.positions,g,i.iconPositions,this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):a.hasPattern&&(a instanceof e.aN||a instanceof e.aO||a instanceof e.cO)&&(l(a.layers,this.zoom,d.brightness,r),a.addFeatures(d,this.tileID.canonical,i.patternPositions,r,this.tileTransform,this.brightness))}this.status="done",a(null,{buckets:e.b2(h).filter((e=>!e.isEmpty())),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,lineAtlas:u,imageAtlas:i,brightness:d.brightness})}};if(!this.extraShadowCaster){const t=e.dN(d.glyphDependencies,(e=>Object.keys(e).map(Number)));Object.keys(t).length?n.send("getGlyphs",{uid:this.uid,stacks:t,scope:this.scope},((e,t)=>{f||(f=e,m=t,v())}),void 0,!1,y):m={};const i=Object.keys(d.iconDependencies);i.length?n.send("getImages",{icons:i,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((e,t)=>{f||(f=e,g=t,v())}),void 0,!1,y):g={};const r=Object.keys(d.patternDependencies);r.length?n.send("getImages",{icons:r,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((e,t)=>{f||(f=e,_=t,v())}),void 0,!1,y):_={}}v()}}function l(t,i,r,n){const a=new e.N(i,{brightness:r});for(const e of t)e.recalculate(a,n)}class c extends e.E{constructor(t,i,r,n,a,o){super(),this.actor=t,this.layerIndex=i,this.availableImages=r,this.loadVectorData=a||e.ak,this.loading={},this.loaded={},this.deduped=new e.ai(t.scheduler),this.isSpriteLoaded=n,this.scheduler=t.scheduler,this.brightness=o}loadTile(i,r){const n=i.uid,a=i&&i.request,o=a&&a.collectResourceTiming,l=this.loading[n]=new s(i);l.abort=this.loadVectorData(i,((s,c)=>{const h=!this.loading[n];if(delete this.loading[n],h||s||!c)return l.status="done",h||(this.loaded[n]=l),r(s);const u=c.rawData,d={};c.expires&&(d.expires=c.expires),c.cacheControl&&(d.cacheControl=c.cacheControl),l.vectorTile=c.vectorTile||new e.dQ(new e.dR(u));const p=()=>{l.parse(l.vectorTile,this.layerIndex,this.availableImages,this.actor,((i,n)=>{if(i||!n)return r(i);const s={};if(o){const e=t(a);e.length>0&&(s.resourceTiming=JSON.parse(JSON.stringify(e)))}r(null,e.e({rawTileData:u.slice(0)},n,d,s))}))};this.isSpriteLoaded?p():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(p,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):p()})),this.loaded=this.loaded||{},this.loaded[n]=l}))}reloadTile(t,i){const r=this.loaded,n=t.uid,a=this;if(r&&r[n]){const o=r[n];o.showCollisionBoxes=t.showCollisionBoxes,o.projection=t.projection,o.brightness=t.brightness,o.tileTransform=e.av(t.tileID.canonical,t.projection),o.extraShadowCaster=t.extraShadowCaster;const s=(e,t)=>{const r=o.reloadCallback;r&&(delete o.reloadCallback,o.parse(o.vectorTile,a.layerIndex,this.availableImages,a.actor,r)),i(e,t)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}else i(null,void 0)}abortTile(e,t){const i=e.uid,r=this.loading[i];r&&(r.abort&&r.abort(),delete this.loading[i]),t()}removeTile(e,t){const i=this.loaded,r=e.uid;i&&i[r]&&delete i[r],t()}}class h{loadTile(t,i){const{uid:r,encoding:n,rawImageData:a,padding:o}=t,s=ImageBitmap&&a instanceof ImageBitmap?this.getImageData(a,o):a;i(null,new e.dS(r,s,n,o<1))}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const i=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),i}}class u{decodeRasterArray(t,i){let{task:r,buffer:n}=t;e.b0.performDecoding(n,r).then((e=>{i(null,e)}),(e=>{i(e)}))}}const d=e.dT.prototype.toGeoJSON;let p=class{constructor(t){this._feature=t,this.extent=e.Y,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const i of this._feature.geometry)t.push([new e.P(i[0],i[1])]);return t}{const t=[];for(const i of this._feature.geometry){const r=[];for(const t of i)r.push(new e.P(t[0],t[1]));t.push(r)}return t}}toGeoJSON(e,t,i){return d.call(this,e,t,i)}},f=class{constructor(t){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.Y,this.length=t.length,this._features=t}feature(e){return new p(this._features[e])}};var m={exports:{}},g=e.dV,_=e.dU.VectorTileFeature,y=v;function v(e,t){this.options=t||{},this.features=e,this.length=e.length}function x(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}v.prototype.feature=function(e){return new x(this.features[e],this.options.extent)},x.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var i=e[t],r=[],n=0;n<i.length;n++)r.push(new g(i[n][0],i[n][1]));this.geometry.push(r)}return this.geometry},x.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,i=-1/0,r=1/0,n=-1/0,a=0;a<e.length;a++)for(var o=e[a],s=0;s<o.length;s++){var l=o[s];t=Math.min(t,l.x),i=Math.max(i,l.x),r=Math.min(r,l.y),n=Math.max(n,l.y)}return[t,r,i,n]},x.prototype.toGeoJSON=_.prototype.toGeoJSON;var b=e.dW,w=y;function S(e){var t=new b;return function(e,t){for(var i in e.layers)t.writeMessage(3,T,e.layers[i])}(e,t),t.finish()}function T(e,t){var i;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(i=0;i<e.length;i++)r.feature=e.feature(i),t.writeMessage(2,E,r);var n=r.keys;for(i=0;i<n.length;i++)t.writeStringField(3,n[i]);var a=r.values;for(i=0;i<a.length;i++)t.writeMessage(4,I,a[i])}function E(e,t){var i=e.feature;void 0!==i.id&&t.writeVarintField(1,i.id),t.writeMessage(2,M,e),t.writeVarintField(3,i.type),t.writeMessage(4,C,i)}function M(e,t){var i=e.feature,r=e.keys,n=e.values,a=e.keycache,o=e.valuecache;for(var s in i.properties){var l=i.properties[s],c=a[s];if(null!==l){void 0===c&&(r.push(s),a[s]=c=r.length-1),t.writeVarint(c);var h=typeof l;"string"!==h&&"boolean"!==h&&"number"!==h&&(l=JSON.stringify(l));var u=h+":"+l,d=o[u];void 0===d&&(n.push(l),o[u]=d=n.length-1),t.writeVarint(d)}}}function A(e,t){return(t<<3)+(7&e)}function P(e){return e<<1^e>>31}function C(e,t){for(var i=e.loadGeometry(),r=e.type,n=0,a=0,o=i.length,s=0;s<o;s++){var l=i[s],c=1;1===r&&(c=l.length),t.writeVarint(A(1,c));for(var h=3===r?l.length-1:l.length,u=0;u<h;u++){1===u&&1!==r&&t.writeVarint(A(2,h-1));var d=l[u].x-n,p=l[u].y-a;t.writeVarint(P(d)),t.writeVarint(P(p)),n+=d,a+=p}3===r&&t.writeVarint(A(7,1))}}function I(e,t){var i=typeof e;"string"===i?t.writeStringField(1,e):"boolean"===i?t.writeBooleanField(7,e):"number"===i&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}m.exports=S,m.exports.fromVectorTileJs=S,m.exports.fromGeojsonVt=function(e,t){t=t||{};var i={};for(var r in e)i[r]=new w(e[r].features,t),i[r].name=r,i[r].version=t.version,i[r].extent=t.extent;return S({layers:i})},m.exports.GeoJSONWrapper=w;var k=e.dX(m.exports);const D={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},R=Math.fround||(L=new Float32Array(1),e=>(L[0]=+e,L[0]));var L;const z=3,F=5,O=6;class B{constructor(e){this.options=Object.assign(Object.create(D),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:i,maxZoom:r}=this.options;t&&console.time("total time");const n="prepare ".concat(e.length," points");t&&console.time(n),this.points=e;const a=[];for(let s=0;s<e.length;s++){const t=e[s];if(!t.geometry)continue;const[i,r]=t.geometry.coordinates,n=R(j(i)),o=R(U(r));a.push(n,o,1/0,s,-1,1),this.options.reduce&&a.push(0)}let o=this.trees[r+1]=this._createTree(a);t&&console.timeEnd(n);for(let s=r;s>=i;s--){const e=+Date.now();o=this.trees[s]=this._createTree(this._cluster(o,s)),t&&console.log("z%d: %d clusters in %dms",s,o.numItems,+Date.now()-e)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let i=((e[0]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,e[1]));let n=180===e[2]?180:((e[2]+180)%360+360)%360-180;const a=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)i=-180,n=180;else if(i>n){const e=this.getClusters([i,r,180,a],t),o=this.getClusters([-180,r,n,a],t);return e.concat(o)}const o=this.trees[this._limitZoom(t)],s=o.range(j(i),U(a),j(n),U(r)),l=o.data,c=[];for(const h of s){const e=this.stride*h;c.push(l[e+F]>1?N(l,e,this.clusterProps):this.points[l[e+z]])}return c}getChildren(e){const t=this._getOriginId(e),i=this._getOriginZoom(e),r="No cluster with the specified id.",n=this.trees[i];if(!n)throw new Error(r);const a=n.data;if(t*this.stride>=a.length)throw new Error(r);const o=this.options.radius/(this.options.extent*Math.pow(2,i-1)),s=n.within(a[t*this.stride],a[t*this.stride+1],o),l=[];for(const c of s){const t=c*this.stride;a[t+4]===e&&l.push(a[t+F]>1?N(a,t,this.clusterProps):this.points[a[t+z]])}if(0===l.length)throw new Error(r);return l}getLeaves(e,t,i){const r=[];return this._appendLeaves(r,e,t=t||10,i=i||0,0),r}getTile(e,t,i){const r=this.trees[this._limitZoom(e)],n=Math.pow(2,e),{extent:a,radius:o}=this.options,s=o/a,l=(i-s)/n,c=(i+1+s)/n,h={features:[]};return this._addTileFeatures(r.range((t-s)/n,l,(t+1+s)/n,c),r.data,t,i,n,h),0===t&&this._addTileFeatures(r.range(1-s/n,l,1,c),r.data,n,i,n,h),t===n-1&&this._addTileFeatures(r.range(0,l,s/n,c),r.data,-1,i,n,h),h.features.length?h:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const i=this.getChildren(e);if(t++,1!==i.length)break;e=i[0].properties.cluster_id}return t}_appendLeaves(e,t,i,r,n){const a=this.getChildren(t);for(const o of a){const t=o.properties;if(t&&t.cluster?n+t.point_count<=r?n+=t.point_count:n=this._appendLeaves(e,t.cluster_id,i,r,n):n<r?n++:e.push(o),e.length===i)break}return n}_createTree(t){const i=new e.bj(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)i.add(t[e],t[e+1]);return i.finish(),i.data=t,i}_addTileFeatures(e,t,i,r,n,a){for(const o of e){const e=o*this.stride,s=t[e+F]>1;let l,c,h;if(s)l=V(t,e,this.clusterProps),c=t[e],h=t[e+1];else{const i=this.points[t[e+z]];l=i.properties;const[r,n]=i.geometry.coordinates;c=j(r),h=U(n)}const u={type:1,geometry:[[Math.round(this.options.extent*(c*n-i)),Math.round(this.options.extent*(h*n-r))]],tags:l};let d;d=s||this.options.generateId?t[e+z]:this.points[t[e+z]].id,void 0!==d&&(u.id=d),a.features.push(u)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:i,extent:r,reduce:n,minPoints:a}=this.options,o=i/(r*Math.pow(2,t)),s=e.data,l=[],c=this.stride;for(let h=0;h<s.length;h+=c){if(s[h+2]<=t)continue;s[h+2]=t;const i=s[h],r=s[h+1],u=e.within(s[h],s[h+1],o),d=s[h+F];let p=d;for(const e of u){const i=e*c;s[i+2]>t&&(p+=s[i+F])}if(p>d&&p>=a){let e,a=i*d,o=r*d,f=-1;const m=(h/c<<5)+(t+1)+this.points.length;for(const i of u){const r=i*c;if(s[r+2]<=t)continue;s[r+2]=t;const l=s[r+F];a+=s[r]*l,o+=s[r+1]*l,s[r+4]=m,n&&(e||(e=this._map(s,h,!0),f=this.clusterProps.length,this.clusterProps.push(e)),n(e,this._map(s,r)))}s[h+4]=m,l.push(a/p,o/p,1/0,m,-1,p),n&&l.push(f)}else{for(let e=0;e<c;e++)l.push(s[h+e]);if(p>1)for(const e of u){const i=e*c;if(!(s[i+2]<=t)){s[i+2]=t;for(let e=0;e<c;e++)l.push(s[i+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,i){if(e[t+F]>1){const r=this.clusterProps[e[t+O]];return i?Object.assign({},r):r}const r=this.points[e[t+z]].properties,n=this.options.map(r);return i&&n===r?Object.assign({},n):n}}function N(e,t,i){return{type:"Feature",id:e[t+z],properties:V(e,t,i),geometry:{type:"Point",coordinates:[(r=e[t],360*(r-.5)),G(e[t+1])]}};var r}function V(e,t,i){const r=e[t+F],n=r>=1e4?"".concat(Math.round(r/1e3),"k"):r>=1e3?Math.round(r/100)/10+"k":r,a=e[t+O],o=-1===a?{}:Object.assign({},i[a]);return Object.assign(o,{cluster:!0,cluster_id:e[t+z],point_count:r,point_count_abbreviated:n})}function j(e){return e/360+.5}function U(e){const t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function G(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}var q={exports:{}};q.exports=function(){function e(i,r,n,a){for(var o,s=a,l=n-r>>1,c=n-r,h=i[r],u=i[r+1],d=i[n],p=i[n+1],f=r+3;f<n;f+=3){var m=t(i[f],i[f+1],h,u,d,p);if(m>s)o=f,s=m;else if(m===s){var g=Math.abs(f-l);g<c&&(o=f,c=g)}}s>a&&(o-r>3&&e(i,r,o,a),i[o+2]=s,n-o>3&&e(i,o,n,a))}function t(e,t,i,r,n,a){var o=n-i,s=a-r;if(0!==o||0!==s){var l=((e-i)*o+(t-r)*s)/(o*o+s*s);l>1?(i=n,r=a):l>0&&(i+=o*l,r+=s*l)}return(o=e-i)*o+(s=t-r)*s}function i(e,t,i,n){var a={id:void 0===e?null:e,type:t,geometry:i,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,i=e.type;if("Point"===i||"MultiPoint"===i||"LineString"===i)r(e,t);else if("Polygon"===i||"MultiLineString"===i)for(var n=0;n<t.length;n++)r(e,t[n]);else if("MultiPolygon"===i)for(n=0;n<t.length;n++)for(var a=0;a<t[n].length;a++)r(e,t[n][a])}(a),a}function r(e,t){for(var i=0;i<t.length;i+=3)e.minX=Math.min(e.minX,t[i]),e.minY=Math.min(e.minY,t[i+1]),e.maxX=Math.max(e.maxX,t[i]),e.maxY=Math.max(e.maxY,t[i+1])}function n(e,t,r,l){if(t.geometry){var c=t.geometry.coordinates,h=t.geometry.type,u=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),d=[],p=t.id;if(r.promoteId?p=t.properties[r.promoteId]:r.generateId&&(p=l||0),"Point"===h)a(c,d);else if("MultiPoint"===h)for(var f=0;f<c.length;f++)a(c[f],d);else if("LineString"===h)o(c,d,u,!1);else if("MultiLineString"===h){if(r.lineMetrics){for(f=0;f<c.length;f++)o(c[f],d=[],u,!1),e.push(i(p,"LineString",d,t.properties));return}s(c,d,u,!1)}else if("Polygon"===h)s(c,d,u,!0);else{if("MultiPolygon"!==h){if("GeometryCollection"===h){for(f=0;f<t.geometry.geometries.length;f++)n(e,{id:p,geometry:t.geometry.geometries[f],properties:t.properties},r,l);return}throw new Error("Input data is not a valid GeoJSON object.")}for(f=0;f<c.length;f++){var m=[];s(c[f],m,u,!0),d.push(m)}}e.push(i(p,h,d,t.properties))}}function a(e,t){t.push(l(e[0])),t.push(c(e[1])),t.push(0)}function o(t,i,r,n){for(var a,o,s=0,h=0;h<t.length;h++){var u=l(t[h][0]),d=c(t[h][1]);i.push(u),i.push(d),i.push(0),h>0&&(s+=n?(a*d-u*o)/2:Math.sqrt(Math.pow(u-a,2)+Math.pow(d-o,2))),a=u,o=d}var p=i.length-3;i[2]=1,e(i,0,p,r),i[p+2]=1,i.size=Math.abs(s),i.start=0,i.end=i.size}function s(e,t,i,r){for(var n=0;n<e.length;n++){var a=[];o(e[n],a,i,r),t.push(a)}}function l(e){return e/360+.5}function c(e){var t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function h(e,t,r,n,a,o,s,l){if(n/=t,o>=(r/=t)&&s<n)return e;if(s<r||o>=n)return null;for(var c=[],h=0;h<e.length;h++){var p=e[h],m=p.geometry,g=p.type,_=0===a?p.minX:p.minY,y=0===a?p.maxX:p.maxY;if(_>=r&&y<n)c.push(p);else if(!(y<r||_>=n)){var v=[];if("Point"===g||"MultiPoint"===g)u(m,v,r,n,a);else if("LineString"===g)d(m,v,r,n,a,!1,l.lineMetrics);else if("MultiLineString"===g)f(m,v,r,n,a,!1);else if("Polygon"===g)f(m,v,r,n,a,!0);else if("MultiPolygon"===g)for(var x=0;x<m.length;x++){var b=[];f(m[x],b,r,n,a,!0),b.length&&v.push(b)}if(v.length){if(l.lineMetrics&&"LineString"===g){for(x=0;x<v.length;x++)c.push(i(p.id,g,v[x],p.tags));continue}"LineString"!==g&&"MultiLineString"!==g||(1===v.length?(g="LineString",v=v[0]):g="MultiLineString"),"Point"!==g&&"MultiPoint"!==g||(g=3===v.length?"Point":"MultiPoint"),c.push(i(p.id,g,v,p.tags))}}}return c.length?c:null}function u(e,t,i,r,n){for(var a=0;a<e.length;a+=3){var o=e[a+n];o>=i&&o<=r&&(t.push(e[a]),t.push(e[a+1]),t.push(e[a+2]))}}function d(e,t,i,r,n,a,o){for(var s,l,c=p(e),h=0===n?g:_,u=e.start,d=0;d<e.length-3;d+=3){var f=e[d],y=e[d+1],v=e[d+2],x=e[d+3],b=e[d+4],w=0===n?f:y,S=0===n?x:b,T=!1;o&&(s=Math.sqrt(Math.pow(f-x,2)+Math.pow(y-b,2))),w<i?S>i&&(l=h(c,f,y,x,b,i),o&&(c.start=u+s*l)):w>r?S<r&&(l=h(c,f,y,x,b,r),o&&(c.start=u+s*l)):m(c,f,y,v),S<i&&w>=i&&(l=h(c,f,y,x,b,i),T=!0),S>r&&w<=r&&(l=h(c,f,y,x,b,r),T=!0),!a&&T&&(o&&(c.end=u+s*l),t.push(c),c=p(e)),o&&(u+=s)}var E=e.length-3;f=e[E],y=e[E+1],v=e[E+2],(w=0===n?f:y)>=i&&w<=r&&m(c,f,y,v),E=c.length-3,a&&E>=3&&(c[E]!==c[0]||c[E+1]!==c[1])&&m(c,c[0],c[1],c[2]),c.length&&t.push(c)}function p(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function f(e,t,i,r,n,a){for(var o=0;o<e.length;o++)d(e[o],t,i,r,n,a,!1)}function m(e,t,i,r){e.push(t),e.push(i),e.push(r)}function g(e,t,i,r,n,a){var o=(a-t)/(r-t);return e.push(a),e.push(i+(n-i)*o),e.push(1),o}function _(e,t,i,r,n,a){var o=(a-i)/(n-i);return e.push(t+(r-t)*o),e.push(a),e.push(1),o}function y(e,t){for(var r=[],n=0;n<e.length;n++){var a,o=e[n],s=o.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)a=v(o.geometry,t);else if("MultiLineString"===s||"Polygon"===s){a=[];for(var l=0;l<o.geometry.length;l++)a.push(v(o.geometry[l],t))}else if("MultiPolygon"===s)for(a=[],l=0;l<o.geometry.length;l++){for(var c=[],h=0;h<o.geometry[l].length;h++)c.push(v(o.geometry[l][h],t));a.push(c)}r.push(i(o.id,s,a,o.tags))}return r}function v(e,t){var i=[];i.size=e.size,void 0!==e.start&&(i.start=e.start,i.end=e.end);for(var r=0;r<e.length;r+=3)i.push(e[r]+t,e[r+1],e[r+2]);return i}function x(e,t){if(e.transformed)return e;var i,r,n,a=1<<e.z,o=e.x,s=e.y;for(i=0;i<e.features.length;i++){var l=e.features[i],c=l.geometry,h=l.type;if(l.geometry=[],1===h)for(r=0;r<c.length;r+=2)l.geometry.push(b(c[r],c[r+1],t,a,o,s));else for(r=0;r<c.length;r++){var u=[];for(n=0;n<c[r].length;n+=2)u.push(b(c[r][n],c[r][n+1],t,a,o,s));l.geometry.push(u)}}return e.transformed=!0,e}function b(e,t,i,r,n,a){return[Math.round(i*(e*r-n)),Math.round(i*(t*r-a))]}function w(e,t,i,r,n){for(var a=t===n.maxZoom?0:n.tolerance/((1<<t)*n.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){o.numFeatures++,S(o,e[s],a,n);var l=e[s].minX,c=e[s].minY,h=e[s].maxX,u=e[s].maxY;l<o.minX&&(o.minX=l),c<o.minY&&(o.minY=c),h>o.maxX&&(o.maxX=h),u>o.maxY&&(o.maxY=u)}return o}function S(e,t,i,r){var n=t.geometry,a=t.type,o=[];if("Point"===a||"MultiPoint"===a)for(var s=0;s<n.length;s+=3)o.push(n[s]),o.push(n[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===a)T(o,n,e,i,!1,!1);else if("MultiLineString"===a||"Polygon"===a)for(s=0;s<n.length;s++)T(o,n[s],e,i,"Polygon"===a,0===s);else if("MultiPolygon"===a)for(var l=0;l<n.length;l++){var c=n[l];for(s=0;s<c.length;s++)T(o,c[s],e,i,!0,0===s)}if(o.length){var h=t.tags||null;if("LineString"===a&&r.lineMetrics){for(var u in h={},t.tags)h[u]=t.tags[u];h.mapbox_clip_start=n.start/n.size,h.mapbox_clip_end=n.end/n.size}var d={geometry:o,type:"Polygon"===a||"MultiPolygon"===a?3:"LineString"===a||"MultiLineString"===a?2:1,tags:h};null!==t.id&&(d.id=t.id),e.features.push(d)}}function T(e,t,i,r,n,a){var o=r*r;if(r>0&&t.size<(n?o:r))i.numPoints+=t.length/3;else{for(var s=[],l=0;l<t.length;l+=3)(0===r||t[l+2]>o)&&(i.numSimplified++,s.push(t[l]),s.push(t[l+1])),i.numPoints++;n&&function(e,t){for(var i=0,r=0,n=e.length,a=n-2;r<n;a=r,r+=2)i+=(e[r]-e[a])*(e[r+1]+e[a+1]);if(i>0===t)for(r=0,n=e.length;r<n/2;r+=2){var o=e[r],s=e[r+1];e[r]=e[n-2-r],e[r+1]=e[n-1-r],e[n-2-r]=o,e[n-1-r]=s}}(s,a),e.push(s)}}function E(e,t){var i=(t=this.options=function(e,t){for(var i in t)e[i]=t[i];return e}(Object.create(this.options),t)).debug;if(i&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(e,t){var i=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)n(i,e.features[r],t,r);else n(i,"Feature"===e.type?e:{geometry:e},t);return i}(e,t);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(e,t){var i=t.buffer/t.extent,r=e,n=h(e,1,-1-i,i,0,-1,2,t),a=h(e,1,1-i,2+i,0,-1,2,t);return(n||a)&&(r=h(e,1,-i,1+i,0,-1,2,t)||[],n&&(r=y(n,1).concat(r)),a&&(r=r.concat(y(a,-1)))),r}(r,t)).length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function M(e,t,i){return 32*((1<<e)*i+t)+e}return E.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},E.prototype.splitTile=function(e,t,i,r,n,a,o){for(var s=[e,t,i,r],l=this.options,c=l.debug;s.length;){r=s.pop(),i=s.pop(),t=s.pop(),e=s.pop();var u=1<<t,d=M(t,i,r),p=this.tiles[d];if(!p&&(c>1&&console.time("creation"),p=this.tiles[d]=w(e,t,i,r,l),this.tileCoords.push({z:t,x:i,y:r}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,i,r,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+t;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=e,n){if(t===l.maxZoom||t===n)continue;var m=1<<n-t;if(i!==Math.floor(a/m)||r!==Math.floor(o/m))continue}else if(t===l.indexMaxZoom||p.numPoints<=l.indexMaxPoints)continue;if(p.source=null,0!==e.length){c>1&&console.time("clipping");var g,_,y,v,x,b,S=.5*l.buffer/l.extent,T=.5-S,E=.5+S,A=1+S;g=_=y=v=null,x=h(e,u,i-S,i+E,0,p.minX,p.maxX,l),b=h(e,u,i+T,i+A,0,p.minX,p.maxX,l),e=null,x&&(g=h(x,u,r-S,r+E,1,p.minY,p.maxY,l),_=h(x,u,r+T,r+A,1,p.minY,p.maxY,l),x=null),b&&(y=h(b,u,r-S,r+E,1,p.minY,p.maxY,l),v=h(b,u,r+T,r+A,1,p.minY,p.maxY,l),b=null),c>1&&console.timeEnd("clipping"),s.push(g||[],t+1,2*i,2*r),s.push(_||[],t+1,2*i,2*r+1),s.push(y||[],t+1,2*i+1,2*r),s.push(v||[],t+1,2*i+1,2*r+1)}}},E.prototype.getTile=function(e,t,i){var r=this.options,n=r.extent,a=r.debug;if(e<0||e>24)return null;var o=1<<e,s=M(e,t=(t%o+o)%o,i);if(this.tiles[s])return x(this.tiles[s],n);a>1&&console.log("drilling down to z%d-%d-%d",e,t,i);for(var l,c=e,h=t,u=i;!l&&c>0;)c--,h=Math.floor(h/2),u=Math.floor(u/2),l=this.tiles[M(c,h,u)];return l&&l.source?(a>1&&console.log("found parent tile z%d-%d-%d",c,h,u),a>1&&console.time("drilling down"),this.splitTile(l.source,c,h,u,e,t,i),a>1&&console.timeEnd("drilling down"),this.tiles[s]?x(this.tiles[s],n):null):null},function(e,t){return new E(e,t)}}();var H=e.dX(q.exports);function W(e,t){const i=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);const r=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!r)return t(null,null);const n=new f(r.features);let a=k(n);0===a.byteOffset&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),t(null,{vectorTile:n,rawData:a.buffer})}class Z extends c{constructor(e,t,i,r,n,a){super(e,t,i,r,W,a),n&&(this.loadGeoJSON=n),this._featureMap=new Map}loadData(i,r){const n=i&&i.request,a=n&&n.collectResourceTiming;this.loadGeoJSON(i,((o,s)=>{if(o||!s)return r(o);if("object"!=typeof s)return r(new Error("Input data given to '".concat(i.source,"' is not a valid GeoJSON object.")));{try{if(i.filter){const t=e.t(i.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===t.result)throw new Error(t.value.map((e=>"".concat(e.key,": ").concat(e.message))).join(", "));s.features=s.features.filter((e=>t.value.evaluate({zoom:0},e)))}if(i.dynamic){"Feature"===s.type&&(s={type:"FeatureCollection",features:[s]}),i.append||this._featureMap.clear();for(const e of s.features||[]){const t=e.id;void 0!==t&&(e.geometry?this._featureMap.set(t,e):this._featureMap.delete(t))}s.features=[...this._featureMap.values()]}this._geoJSONIndex=i.cluster?new B(function(t){let{superclusterOptions:i,clusterProperties:r}=t;if(!r||!i)return i;const n={},a={},o={accumulated:null,zoom:0},s={properties:null},l=Object.keys(r);for(const c of l){const[t,i]=r[c],o=e.t(i),s=e.t("string"==typeof t?[t,["accumulated"],["get",c]]:t);n[c]=o.value,a[c]=s.value}return i.map=e=>{s.properties=e;const t={};for(const i of l)t[i]=n[i].evaluate(o,s);return t},i.reduce=(e,t)=>{s.properties=t;for(const i of l)o.accumulated=e[i],e[i]=a[i].evaluate(o,s)},i}(i)).load(s.features):H(s,i.geojsonVtOptions)}catch(o){return r(o)}this.loaded={};const l={};if(a){const e=t(n);e&&(l.resourceTiming={},l.resourceTiming[i.source]=JSON.parse(JSON.stringify(e)))}r(null,l)}}))}reloadTile(e,t){const i=this.loaded;return i&&i[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,i){if(t.request)e.g(t.request,i);else{if("string"!=typeof t.data)return i(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")));try{return i(null,JSON.parse(t.data))}catch(e){return i(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")))}}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class Q{constructor(t,i){this.tileID=new e.ap(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=t.projection,this.brightness=i}parse(t,i,r,n){this.status="parsing";const a=new e.ap(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),o={},s=i.familiesBySource[r.source],l=new e.dL(a,r.promoteId);return l.bucketLayerIDs=[],l.is3DTile=!0,e.dY(t).then((t=>{if(!t)return n(new Error("Could not parse tile"));const i=e.dZ(t,1/e.bU(r.tileID.canonical)),c=t.json.extensionsUsed&&t.json.extensionsUsed.includes("MAPBOX_mesh_features")||t.json.asset.extras&&t.json.asset.extras.MAPBOX_mesh_features,h=t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression"),u=new e.N(this.zoom,{brightness:this.brightness});for(const r in s)for(const t of s[r]){const r=t[0];l.bucketLayerIDs.push(t.map((e=>e.id))),r.recalculate(u,[]);const n=new e.d_(i,a,c,h,this.brightness,l);c||(n.needsUpload=!0),o[r.fqid]=n,n.evaluate(r)}this.status="done",n(null,{buckets:o,featureIndex:l})})).catch((e=>n(new Error(e.message))))}}class X{constructor(e,t,i,r,n,a){this.actor=e,this.layerIndex=t,this.brightness=a,this.loading={},this.loaded={}}loadTile(t,i){const r=t.uid,n=this.loading[r]=new Q(t,this.brightness);e.b1(t.request,((e,a)=>{const o=!this.loading[r];return delete this.loading[r],o||e?(n.status="done",o||(this.loaded[r]=n),i(e)):a&&0!==a.byteLength?void n.parse(a,this.layerIndex,t,((e,t)=>{n.status="done",this.loaded=this.loaded||{},this.loaded[r]=n,e||!t?i(e):i(null,t)})):(n.status="done",this.loaded[r]=n,i())}))}reloadTile(e,t){const i=this.loaded,r=e.uid;if(i&&i[r]){const n=i[r];n.projection=e.projection,n.brightness=e.brightness;const a=(i,r)=>{n.reloadCallback&&(delete n.reloadCallback,this.loadTile(e,t)),t(i,r)};"parsing"===n.status?n.reloadCallback=a:"done"===n.status&&this.loadTile(e,t)}}abortTile(e,t){const i=e.uid;this.loading[i]&&delete this.loading[i],t()}removeTile(e,t){const i=this.loaded,r=e.uid;i&&i[r]&&delete i[r],t()}}class Y{constructor(t){this.self=t,this.actor=new e.d$(t,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=e.br({name:"mercator"}),this.workerSourceTypes={vector:c,geojson:Z,"batched-model":X},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error('Worker source with name "'.concat(e,'" already registered.'));this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.e0.isParsed())throw new Error("RTL text plugin already registered.");e.e0.applyArabicShaping=t.applyArabicShaping,e.e0.processBidirectionalText=t.processBidirectionalText,e.e0.processStyledBidirectionalText=t.processStyledBidirectionalText}}clearCaches(e,t,i){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e],delete this.rasterArrayWorkerSource,i()}checkIfReady(e,t,i){i()}setReferrer(e,t){this.referrer=t}spriteLoaded(t,i){let{scope:r,isLoaded:n}=i;if(this.isSpriteLoaded[t]||(this.isSpriteLoaded[t]={}),this.isSpriteLoaded[t][r]=n,this.workerSources[t]&&this.workerSources[t][r])for(const a in this.workerSources[t][r]){const i=this.workerSources[t][r][a];for(const t in i)i[t]instanceof c&&(i[t].isSpriteLoaded=n,i[t].fire(new e.b("isSpriteLoaded")))}}setImages(e,t,i){let{scope:r,images:n}=t;if(this.availableImages[e]||(this.availableImages[e]={}),this.availableImages[e][r]=n,this.workerSources[e]&&this.workerSources[e][r]){for(const t in this.workerSources[e][r]){const i=this.workerSources[e][r][t];for(const e in i)i[e].availableImages=n}i()}else i()}setProjection(t,i){this.projections[t]=e.br(i)}setBrightness(e,t,i){this.brightness=t,i()}setLayers(e,t,i){this.getLayerIndex(e,t.scope).replace(t.layers,t.options),i()}updateLayers(e,t,i){this.getLayerIndex(e,t.scope).update(t.layers,t.removedIds,t.options),i()}loadTile(e,t,i){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).loadTile(t,i)}loadDEMTile(e,t,i){this.getDEMWorkerSource(e,t.source,t.scope).loadTile(t,i)}decodeRasterArray(e,t,i){this.getRasterArrayWorkerSource().decodeRasterArray(t,i)}reloadTile(e,t,i){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).reloadTile(t,i)}abortTile(e,t,i){this.getWorkerSource(e,t.type,t.source,t.scope).abortTile(t,i)}removeTile(e,t,i){this.getWorkerSource(e,t.type,t.source,t.scope).removeTile(t,i)}removeSource(e,t,i){if(!(this.workerSources[e]&&this.workerSources[e][t.scope]&&this.workerSources[e][t.scope][t.type]&&this.workerSources[e][t.scope][t.type][t.source]))return;const r=this.workerSources[e][t.scope][t.type][t.source];delete this.workerSources[e][t.scope][t.type][t.source],void 0!==r.removeSource?r.removeSource(t,i):i()}loadWorkerSource(e,t,i){try{this.self.importScripts(t.url),i()}catch(e){i(e.toString())}}syncRTLPluginState(t,i,r){try{e.e0.setState(i);const t=e.e0.getPluginURL();if(e.e0.isLoaded()&&!e.e0.isParsed()&&null!=t){this.self.importScripts(t);const i=e.e0.isParsed();r(i?void 0:new Error("RTL Text Plugin failed to import scripts from ".concat(t)),i)}}catch(e){r(e.toString())}}setDracoUrl(e,t){this.dracoUrl=t}getAvailableImages(e,t){this.availableImages[e]||(this.availableImages[e]={});let i=this.availableImages[e][t];return i||(i=[]),i}getLayerIndex(e,t){this.layerIndexes[e]||(this.layerIndexes[e]={});let i=this.layerIndexes[e][t];return i||(i=this.layerIndexes[e][t]=new n,i.scope=t),i}getWorkerSource(e,t,i,r){if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][r]||(this.workerSources[e][r]={}),this.workerSources[e][r][t]||(this.workerSources[e][r][t]={}),this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),!this.workerSources[e][r][t][i]){const n={send:(t,i,r,n,a,o)=>{this.actor.send(t,i,r,e,a,o)},scheduler:this.actor.scheduler};this.workerSources[e][r][t][i]=new this.workerSourceTypes[t](n,this.getLayerIndex(e,r),this.getAvailableImages(e,r),this.isSpriteLoaded[e][r],void 0,this.brightness)}return this.workerSources[e][r][t][i]}getDEMWorkerSource(e,t,i){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][i]||(this.demWorkerSources[e][i]={}),this.demWorkerSources[e][i][t]||(this.demWorkerSources[e][i][t]=new h),this.demWorkerSources[e][i][t]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new u),this.rasterArrayWorkerSource}enforceCacheSizeLimit(t,i){e.e1(i)}getWorkerPerformanceMetrics(e,t,i){i(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Y(self)),Y})),r(["./shared"],(function(e){function t(e,i){if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(let r=0;r<e.length;r++)if(!t(e[r],i[r]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==i){if("object"!=typeof i)return!1;if(Object.keys(e).length!==Object.keys(i).length)return!1;for(const r in e)if(!t(e[r],i[r]))return!1;return!0}return e===i}var i=r;function r(e){return!function(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,i=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(i);try{t=new Worker(r),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(r),e}()?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var i=t.getImageData(0,0,1,1);return i&&i.width===e.width}()?(void 0===n[t=e&&e.failIfMajorPerformanceCaveat]&&(n[t]=function(e){var t,i=function(e){var t=document.createElement("canvas"),i=Object.create(r.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=e,t.getContext("webgl2",i)}(e);if(!i)return!1;try{t=i.createShader(i.VERTEX_SHADER)}catch(e){return!1}return!(!t||i.isContextLost())&&(i.shaderSource(t,"void main() {}"),i.compileShader(t),!0===i.getShaderParameter(t,i.COMPILE_STATUS))}(t)),n[t]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var t}(e)}var n={};function a(e,t,i){const r=document.createElement(e);return null!=t&&(r.className=t),i&&i.appendChild(r),r}function o(e,t,i){const r=document.createElementNS("http://www.w3.org/2000/svg",e);for(const n of Object.keys(t))r.setAttributeNS(null,n,String(t[n]));return i&&i.appendChild(r),r}r.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const s="undefined"!=typeof document?document.documentElement&&document.documentElement.style:null,l=s&&void 0!==s.userSelect?"userSelect":"WebkitUserSelect";let c;function h(){s&&l&&(c=s[l],s[l]="none")}function u(){s&&l&&(s[l]=c)}function d(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",d,!0)}function p(){window.addEventListener("click",d,!0),window.setTimeout((()=>{window.removeEventListener("click",d,!0)}),0)}function f(e,t){const i=e.getBoundingClientRect();return _(e,i,t)}function m(e,t){const i=e.getBoundingClientRect(),r=[];for(let n=0;n<t.length;n++)r.push(_(e,i,t[n]));return r}function g(e){return void 0!==window.InstallTrigger&&2===e.button&&e.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}function _(t,i,r){const n=t.offsetWidth===i.width?1:t.offsetWidth/i.width;return new e.P((r.clientX-i.left)*n,(r.clientY-i.top)*n)}class y{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(e,t){this._updatedSourceCaches[e]=t,this.setDirty()}discardSourceCacheUpdate(e){delete this._updatedSourceCaches[e]}updateLayer(e){const t=e.scope;this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._updatedLayers[t].add(e.id),this.setDirty()}removeLayer(e){const t=e.scope;this._removedLayers[t]=this._removedLayers[t]||{},this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._removedLayers[t][e.id]=e,this._updatedLayers[t].delete(e.id),this._updatedPaintProps.delete(e.fqid),this.setDirty()}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){const e={};for(const t in this._updatedLayers)e[t]=e[t]||{},e[t].updatedIds=Array.from(this._updatedLayers[t].values());for(const t in this._removedLayers)e[t]=e[t]||{},e[t].removedIds=Object.keys(this._removedLayers[t]);return e}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(e){this._updatedPaintProps.add(e.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(e){this._updatedImages.add(e),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class v extends e.E{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.numModelsLoading={}}loadModel(t,i){return e.l(this.requestManager.transformRequest(i,e.R.Model).url).then((i=>{if(!i)return;const r=e.c(i),n=new e.M(t,void 0,void 0,r);return n.computeBoundsAndApplyParent(),n})).catch((r=>{if(r&&404===r.status)return null;this.fire(new e.a(new Error("Could not load model ".concat(t," from ").concat(i,": ").concat(r.message))))}))}load(t,i){this.models[i]||(this.models[i]={});const r=Object.keys(t);this.numModelsLoading[i]=(this.numModelsLoading[i]||0)+r.length;const n=[];for(const e of r)n.push(this.loadModel(e,t[e]));Promise.allSettled(n).then((t=>{for(let e=0;e<t.length;e++){const{status:n,value:a}=t[e];"fulfilled"===n&&a&&(this.models[i][r[e]]={model:a,numReferences:1})}this.numModelsLoading[i]-=r.length,this.fire(new e.b("data",{dataType:"style"}))})).catch((t=>{this.fire(new e.a(new Error("Could not load models: ".concat(t.message))))}))}isLoaded(){for(const e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,t){return!!this.getModel(e,t)}getModel(e,t){return this.models[t]||(this.models[t]={}),this.models[t][e]?this.models[t][e].model:void 0}addModel(e,t,i){this.models[i]||(this.models[i]={}),this.hasModel(e,i)&&this.models[i][e].numReferences++,this.load({[e]:this.requestManager.normalizeModelURL(t)},i)}addModels(e,t){this.models[t]||(this.models[t]={});const i={};for(const r in e)this.models[t][r]={},i[r]=this.requestManager.normalizeModelURL(e[r]);this.load(i,t)}addModelsFromBucket(e,t){this.models[t]||(this.models[t]={});const i={};for(const r of e)this.hasModel(r,t)?this.models[t][r].numReferences++:i[r]=this.requestManager.normalizeModelURL(r);this.load(i,t)}removeModel(e,t){if(this.models[t]&&this.models[t][e]&&(this.models[t][e].numReferences--,0===this.models[t][e].numReferences)){const i=this.models[t][e].model;delete this.models[t][e],i.destroy()}}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,t){this.models[t]||(this.models[t]={});for(const i in this.models[t])this.models[t][i].model&&this.models[t][i].model.upload(e.context)}}class x{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,i,r){const n=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][n]=this.stateChanges[t][n]||{},e.e(this.stateChanges[t][n],r),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==n&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][n]){this.deletedStates[t][n]={};for(const e in this.state[t][n])r[e]||(this.deletedStates[t][n][e]=null)}else for(const e in r)this.deletedStates[t]&&this.deletedStates[t][n]&&null===this.deletedStates[t][n][e]&&delete this.deletedStates[t][n][e]}removeFeatureState(e,t,i){if(null===this.deletedStates[e])return;const r=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&void 0!==t)null!==this.deletedStates[e][r]&&(this.deletedStates[e][r]=this.deletedStates[e][r]||{},this.deletedStates[e][r][i]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][r])for(i in this.deletedStates[e][r]={},this.stateChanges[e][r])this.deletedStates[e][r][i]=null;else this.deletedStates[e][r]=null;else this.deletedStates[e]=null}getState(t,i){const r=String(i),n=e.e({},(this.state[t]||{})[r],(this.stateChanges[t]||{})[r]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const e=this.deletedStates[t][i];if(null===e)return{};for(const t in e)delete n[t]}return n}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(t,i){const r={};for(const n in this.stateChanges){this.state[n]=this.state[n]||{};const t={};for(const i in this.stateChanges[n])this.state[n][i]||(this.state[n][i]={}),e.e(this.state[n][i],this.stateChanges[n][i]),t[i]=this.state[n][i];r[n]=t}for(const n in this.deletedStates){this.state[n]=this.state[n]||{};const t={};if(null===this.deletedStates[n])for(const e in this.state[n])t[e]={},this.state[n][e]={};else for(const e in this.deletedStates[n]){if(null===this.deletedStates[n][e])this.state[n][e]={};else if(this.state[n][e])for(const t of Object.keys(this.deletedStates[n][e]))delete this.state[n][e][t];t[e]=this.state[n][e]}r[n]=r[n]||{},e.e(r[n],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const e in t)t[e].setFeatureState(r,i)}}function b(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class w extends e.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(t){this.images[t]={},this.loaded[t]=!1,this.updatedImages[t]={},this.patterns[t]={},this.callbackDispatchedThisFrame[t]={},this.atlasImage[t]=new e.h({width:1,height:1})}isLoaded(){for(const e in this.loaded)if(!this.loaded[e])return!1;return!0}setLoaded(e,t){if(this.loaded[t]!==e&&(this.loaded[t]=e,e)){for(const{ids:e,callback:i}of this.requestors)this._notify(e,t,i);this.requestors=[]}}hasImage(e,t){return!!this.getImage(e,t)}getImage(e,t){return this.images[t][e]}addImage(e,t,i){this._validate(e,i)&&(this.images[t][e]=i)}_validate(t,i){let r=!0;return this._validateStretch(i.stretchX,i.data&&i.data.width)||(this.fire(new e.a(new Error('Image "'.concat(t,'" has invalid "stretchX" value')))),r=!1),this._validateStretch(i.stretchY,i.data&&i.data.height)||(this.fire(new e.a(new Error('Image "'.concat(t,'" has invalid "stretchY" value')))),r=!1),this._validateContent(i.content,i)||(this.fire(new e.a(new Error('Image "'.concat(t,'" has invalid "content" value')))),r=!1),r}_validateStretch(e,t){if(!e)return!0;let i=0;for(const r of e){if(r[0]<i||r[1]<r[0]||t<r[1])return!1;i=r[1]}return!0}_validateContent(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,t,i){i.version=this.images[t][e].version+1,this.images[t][e]=i,this.updatedImages[t][e]=!0}removeImage(e,t){const i=this.images[t][e];delete this.images[t][e],delete this.patterns[t][e],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(e){return Object.keys(this.images[e])}getImages(e,t,i){let r=!0;const n=!!this.loaded[t];if(!n)for(const a of e)this.images[t][a]||(r=!1);n||r?this._notify(e,t,i):this.requestors.push({ids:e,scope:t,callback:i})}getUpdatedImages(e){return this.updatedImages[e]}_notify(t,i,r){const n={};for(const a of t){this.images[i][a]||this.fire(new e.b("styleimagemissing",{id:a}));const t=this.images[i][a];t?n[a]={data:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)}:e.w('Image "'.concat(a,'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.'))}r(null,n)}getPixelSize(e){const{width:t,height:i}=this.atlasImage[e];return{width:t,height:i}}getPattern(t,i){const r=this.patterns[i][t],n=this.getImage(t,i);if(!n)return null;if(r&&r.position.version===n.version)return r.position;if(r)r.position.version=n.version;else{const r={w:n.data.width+2,h:n.data.height+2,x:0,y:0},a=new e.I(r,n);this.patterns[i][t]={bin:r,position:a}}return this._updatePatternAtlas(i),this.patterns[i][t].position}bind(t,i){const r=t.gl;let n=this.atlasTexture[i];n?this.dirty&&(n.update(this.atlasImage[i]),this.dirty=!1):(n=new e.T(t,this.atlasImage[i],r.RGBA),this.atlasTexture[i]=n),n.bind(r.LINEAR,r.CLAMP_TO_EDGE)}_updatePatternAtlas(t){const i=[];for(const e in this.patterns[t])i.push(this.patterns[t][e].bin);const{w:r,h:n}=e.p(i),a=this.atlasImage[t];a.resize({width:r||1,height:n||1});for(const o in this.patterns[t]){const{bin:i}=this.patterns[t][o],r=i.x+1,n=i.y+1,s=this.images[t][o].data,l=s.width,c=s.height;e.h.copy(s,a,{x:0,y:0},{x:r,y:n},{width:l,height:c}),e.h.copy(s,a,{x:0,y:c-1},{x:r,y:n-1},{width:l,height:1}),e.h.copy(s,a,{x:0,y:0},{x:r,y:n+c},{width:l,height:1}),e.h.copy(s,a,{x:l-1,y:0},{x:r-1,y:n},{width:1,height:c}),e.h.copy(s,a,{x:0,y:0},{x:r+l,y:n},{width:1,height:c})}this.dirty=!0}beginFrame(){for(const e in this.images)this.callbackDispatchedThisFrame[e]={}}dispatchRenderCallbacks(e,t){for(const i of e){if(this.callbackDispatchedThisFrame[t][i])continue;this.callbackDispatchedThisFrame[t][i]=!0;const e=this.images[t][i];b(e)&&this.updateImage(i,t,e)}}}function S(t){const i=t.key,r=t.value,n=t.valueSpec||{},a=t.objectElementValidators||{},o=t.style,s=t.styleSpec;let l=[];const c=e.j(r);if("object"!==c)return[new e.V(i,r,"object expected, ".concat(c," found"))];for(const h in r){const t=h.split(".")[0];let c;a[t]?c=a[t]:n[t]?c=H:a["*"]?c=a["*"]:n["*"]&&(c=H),c?l=l.concat(c({key:(i?"".concat(i,"."):i)+h,value:r[h],valueSpec:n[t]||n["*"],style:o,styleSpec:s,object:r,objectKey:h},r)):l.push(new e.i(i,r[h],'unknown property "'.concat(h,'"')))}for(const h in n)a[h]||n[h].required&&void 0===n[h].default&&void 0===r[h]&&l.push(new e.V(i,r,'missing required property "'.concat(h,'"')));return l}function T(t){const i=t.value,r=t.valueSpec,n=t.style,a=t.styleSpec,o=t.key,s=t.arrayElementValidator||H;if("array"!==e.j(i))return[new e.V(o,i,"array expected, ".concat(e.j(i)," found"))];if(r.length&&i.length!==r.length)return[new e.V(o,i,"array length ".concat(r.length," expected, length ").concat(i.length," found"))];if(r["min-length"]&&i.length<r["min-length"])return[new e.V(o,i,"array length at least ".concat(r["min-length"]," expected, length ").concat(i.length," found"))];let l={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};a.$version<7&&(l.function=r.function),"object"===e.j(r.value)&&(l=r.value);let c=[];for(let e=0;e<i.length;e++)c=c.concat(s({array:i,arrayIndex:e,value:i[e],valueSpec:l,style:n,styleSpec:a,key:"".concat(o,"[").concat(e,"]")},!0));return c}function E(t){const i=t.key,r=t.value,n=t.valueSpec;let a=e.j(r);if("number"===a&&r!=r&&(a="NaN"),"number"!==a)return[new e.V(i,r,"number expected, ".concat(a," found"))];if("minimum"in n){let a=n.minimum;if("array"===e.j(n.minimum)&&(a=n.minimum[t.arrayIndex]),r<a)return[new e.V(i,r,"".concat(r," is less than the minimum value ").concat(a))]}if("maximum"in n){let a=n.maximum;if("array"===e.j(n.maximum)&&(a=n.maximum[t.arrayIndex]),r>a)return[new e.V(i,r,"".concat(r," is greater than the maximum value ").concat(a))]}return[]}function M(t){const i=t.valueSpec,r=e.u(t.value.type);let n,a,o,s={};const l="categorical"!==r&&void 0===t.value.property,c=!l,h="array"===e.j(t.value.stops)&&"array"===e.j(t.value.stops[0])&&"object"===e.j(t.value.stops[0][0]),u=S({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===r)return[new e.V(t.key,t.value,'identity function may not have a "stops" property')];let i=[];const n=t.value;return i=i.concat(T({key:t.key,value:n,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:d})),"array"===e.j(n)&&0===n.length&&i.push(new e.V(t.key,n,"array must have at least one stop")),i},default:function(e){return H({key:e.key,value:e.value,valueSpec:i,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===r&&l&&u.push(new e.V(t.key,t.value,'missing required property "property"')),"identity"===r||t.value.stops||u.push(new e.V(t.key,t.value,'missing required property "stops"')),"exponential"===r&&t.valueSpec.expression&&!e.s(t.valueSpec)&&u.push(new e.V(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(c&&!e.m(t.valueSpec)?u.push(new e.V(t.key,t.value,"property functions not supported")):l&&!e.n(t.valueSpec)&&u.push(new e.V(t.key,t.value,"zoom functions not supported"))),"categorical"!==r&&!h||void 0!==t.value.property||u.push(new e.V(t.key,t.value,'"property" property is required')),u;function d(t){let r=[];const n=t.value,l=t.key;if("array"!==e.j(n))return[new e.V(l,n,"array expected, ".concat(e.j(n)," found"))];if(2!==n.length)return[new e.V(l,n,"array length 2 expected, length ".concat(n.length," found"))];if(h){if("object"!==e.j(n[0]))return[new e.V(l,n,"object expected, ".concat(e.j(n[0])," found"))];if(void 0===n[0].zoom)return[new e.V(l,n,"object stop key must have zoom")];if(void 0===n[0].value)return[new e.V(l,n,"object stop key must have value")];const i=e.u(n[0].zoom);if("number"!=typeof i)return[new e.V(l,n[0].zoom,"stop zoom values must be numbers")];if(o&&o>i)return[new e.V(l,n[0].zoom,"stop zoom values must appear in ascending order")];i!==o&&(o=i,a=void 0,s={}),r=r.concat(S({key:"".concat(l,"[0]"),value:n[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:E,value:p}}))}else r=r.concat(p({key:"".concat(l,"[0]"),value:n[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},n));return e.o(e.q(n[1]))?r.concat([new e.V("".concat(l,"[1]"),n[1],"expressions are not allowed in function stops.")]):r.concat(H({key:"".concat(l,"[1]"),value:n[1],valueSpec:i,style:t.style,styleSpec:t.styleSpec}))}function p(t,o){const l=e.j(t.value),c=e.u(t.value),h=null!==t.value?t.value:o;if(n){if(l!==n)return[new e.V(t.key,h,"".concat(l," stop domain type must match previous stop domain type ").concat(n))]}else n=l;if("number"!==l&&"string"!==l&&"boolean"!==l&&"number"!=typeof c&&"string"!=typeof c&&"boolean"!=typeof c)return[new e.V(t.key,h,"stop domain value must be a number, string, or boolean")];if("number"!==l&&"categorical"!==r){let n="number expected, ".concat(l," found");return e.m(i)&&void 0===r&&(n+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new e.V(t.key,h,n)]}return"categorical"!==r||"number"!==l||"number"==typeof c&&isFinite(c)&&Math.floor(c)===c?"categorical"!==r&&"number"===l&&"number"==typeof c&&"number"==typeof a&&void 0!==a&&c<a?[new e.V(t.key,h,"stop domain values must appear in ascending order")]:(a=c,"categorical"===r&&c in s?[new e.V(t.key,h,"stop domain values must be unique")]:(s[c]=!0,[])):[new e.V(t.key,h,"integer expected, found ".concat(String(c)))]}}function A(t){const i=("property"===t.expressionContext?e.r:e.t)(e.q(t.value),t.valueSpec);if("error"===i.result)return i.value.map((i=>new e.V("".concat(t.key).concat(i.key),t.value,i.message)));const r=i.value.expression||i.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!r.outputDefined())return[new e.V(t.key,t.value,'Invalid data expression for "'.concat(t.propertyKey,'". Output values must be contained as literals within the expression.'))];if("property"===t.expressionContext&&"layout"===t.propertyType&&!e.v(r))return[new e.V(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return P(r,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!e.x(r,["zoom","feature-state"]))return[new e.V(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!e.y(r))return[new e.V(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function P(t,i){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const e of i.valueSpec.expression.parameters)r.delete(e);if(0===r.size)return[];const n=[];return t instanceof e.C&&r.has(t.name)?[new e.V(i.key,i.value,'["'.concat(t.name,'"] expression is not supported in a filter for a ').concat(i.object.type," layer with id: ").concat(i.object.id))]:(t.eachChild((e=>{n.push(...P(e,i))})),n)}function C(t){const i=t.key,r=t.value,n=t.valueSpec,a=[];return Array.isArray(n.values)?-1===n.values.indexOf(e.u(r))&&a.push(new e.V(i,r,"expected one of [".concat(n.values.join(", "),"], ").concat(JSON.stringify(r)," found"))):-1===Object.keys(n.values).indexOf(e.u(r))&&a.push(new e.V(i,r,"expected one of [".concat(Object.keys(n.values).join(", "),"], ").concat(JSON.stringify(r)," found"))),a}function I(t){return e.A(e.q(t.value))?A(e.k({},t,{expressionContext:"filter",valueSpec:t.styleSpec["filter_".concat(t.layerType||"fill")]})):k(t)}function k(t){const i=t.value,r=t.key;if("array"!==e.j(i))return[new e.V(r,i,"array expected, ".concat(e.j(i)," found"))];const n=t.styleSpec;let a,o=[];if(i.length<1)return[new e.V(r,i,"filter array must have at least 1 element")];switch(o=o.concat(C({key:"".concat(r,"[0]"),value:i[0],valueSpec:n.filter_operator,style:t.style,styleSpec:t.styleSpec})),e.u(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===e.u(i[1])&&o.push(new e.V(r,i,'"$type" cannot be use with operator "'.concat(i[0],'"')));case"==":case"!=":3!==i.length&&o.push(new e.V(r,i,'filter array for operator "'.concat(i[0],'" must have 3 elements')));case"in":case"!in":i.length>=2&&(a=e.j(i[1]),"string"!==a&&o.push(new e.V("".concat(r,"[1]"),i[1],"string expected, ".concat(a," found"))));for(let s=2;s<i.length;s++)a=e.j(i[s]),"$type"===e.u(i[1])?o=o.concat(C({key:"".concat(r,"[").concat(s,"]"),value:i[s],valueSpec:n.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==a&&"number"!==a&&"boolean"!==a&&o.push(new e.V("".concat(r,"[").concat(s,"]"),i[s],"string, number, or boolean expected, ".concat(a," found")));break;case"any":case"all":case"none":for(let e=1;e<i.length;e++)o=o.concat(k({key:"".concat(r,"[").concat(e,"]"),value:i[e],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":a=e.j(i[1]),2!==i.length?o.push(new e.V(r,i,'filter array for "'.concat(i[0],'" operator must have 2 elements'))):"string"!==a&&o.push(new e.V("".concat(r,"[1]"),i[1],"string expected, ".concat(a," found")))}return o}function D(t,i){const r=t.key,n=t.style,a=t.layer,o=t.styleSpec,s=t.value,l=t.objectKey,c=o["".concat(i,"_").concat(t.layerType)];if(!c)return[];const h=l.match(/^(.*)-transition$/);if("paint"===i&&h&&c[h[1]]&&c[h[1]].transition)return H({key:r,value:s,valueSpec:o.transition,style:n,styleSpec:o});const u=t.valueSpec||c[l];if(!u)return[new e.i(r,s,'unknown property "'.concat(l,'"'))];let d;if("string"===e.j(s)&&e.m(u)&&!u.tokens&&(d=/^{([^}]+)}$/.exec(s))){const t='`{ "type": "identity", "property": '.concat(d?JSON.stringify(d[1]):'"_"'," }`");return[new e.V(r,s,'"'.concat(l,'" does not support interpolation syntax\nUse an identity property function instead: ').concat(t,"."))]}const p=[];if("symbol"===t.layerType)"text-field"!==l||!n||n.glyphs||n.imports||p.push(new e.V(r,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===l&&e.B(e.q(s))&&"identity"===e.u(s.type)&&p.push(new e.V(r,s,'"text-font" does not support identity functions'));else if("model"===t.layerType&&"paint"===i&&a&&a.layout&&a.layout.hasOwnProperty("model-id")&&e.m(u)&&(e.D(u)||e.n(u))){const t=e.r(e.q(s),u),i=t.value.expression||t.value._styleExpression.expression;i&&!e.x(i,["measure-light"])&&("model-emissive-strength"===l&&e.y(i)&&e.v(i)||p.push(new e.V(r,s,"".concat(l," does not support measure-light expressions when the model layer source is vector tile or GeoJSON."))))}return p.concat(H({key:t.key,value:s,valueSpec:u,style:n,styleSpec:o,expressionContext:"property",propertyType:i,propertyKey:l}))}function R(e){return D(e,"paint")}function L(e){return D(e,"layout")}function z(t){let i=[];const r=t.value,n=t.key,a=t.style,o=t.styleSpec;r.type||r.ref||i.push(new e.V(n,r,'either "type" or "ref" is required'));let s=e.u(r.type);const l=e.u(r.ref);if(r.id){const o=e.u(r.id);for(let s=0;s<t.arrayIndex;s++){const t=a.layers[s];e.u(t.id)===o&&i.push(new e.V(n,r.id,'duplicate layer id "'.concat(r.id,'", previously used at line ').concat(t.id.__line__)))}}if("ref"in r){let t;["type","source","source-layer","filter","layout"].forEach((t=>{t in r&&i.push(new e.V(n,r[t],'"'.concat(t,'" is prohibited for ref layers')))})),a.layers.forEach((i=>{e.u(i.id)===l&&(t=i)})),t?t.ref?i.push(new e.V(n,r.ref,"ref cannot reference another ref layer")):s=e.u(t.type):"string"==typeof l&&i.push(new e.V(n,r.ref,'ref layer "'.concat(l,'" not found')))}else if("background"!==s&&"sky"!==s&&"slot"!==s)if(r.source){const t=a.sources&&a.sources[r.source],o=t&&e.u(t.type);t?"vector"===o&&"raster"===s?i.push(new e.V(n,r.source,'layer "'.concat(r.id,'" requires a raster source'))):"raster"===o&&"raster"!==s?i.push(new e.V(n,r.source,'layer "'.concat(r.id,'" requires a vector source'))):"vector"!==o||r["source-layer"]?"raster-dem"===o&&"hillshade"!==s?i.push(new e.V(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==o||["raster","raster-particle"].includes(s)?"line"!==s||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||"geojson"===o&&t.lineMetrics?"raster-particle"===s&&"raster-array"!==o&&i.push(new e.V(n,r.source,'layer "'.concat(r.id,"\" requires a 'raster-array' source."))):i.push(new e.V(n,r,'layer "'.concat(r.id,'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.'))):i.push(new e.V(n,r.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new e.V(n,r,'layer "'.concat(r.id,'" must specify a "source-layer"'))):i.push(new e.V(n,r.source,'source "'.concat(r.source,'" not found')))}else i.push(new e.V(n,r,'missing required property "source"'));return i=i.concat(S({key:n,value:r,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>H({key:"".concat(n,".type"),value:r.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"}),filter:t=>I(e.k({layerType:s},t)),layout:t=>S({layer:r,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>L(e.k({layerType:s},t))}}),paint:t=>S({layer:r,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>R(e.k({layerType:s,layer:r},t))}})}})),i}function F(t){const i=t.value,r=t.key,n=e.j(i);return"string"!==n?[new e.V(r,i,"string expected, ".concat(n," found"))]:[]}const O={promoteId:function(t){let{key:i,value:r}=t;if("string"===e.j(r))return F({key:i,value:r});{const e=[];for(const t in r)e.push(...F({key:"".concat(i,".").concat(t),value:r[t]}));return e}}};function B(t){const i=t.value,r=t.key,n=t.styleSpec,a=t.style;if(!i.type)return[new e.V(r,i,'"type" is required')];const o=e.u(i.type);let s=[];switch(["vector","raster","raster-dem","raster-array"].includes(o)&&(i.url||i.tiles||s.push(new e.i(r,i,'Either "url" or "tiles" is required.'))),o){case"vector":case"raster":case"raster-dem":case"raster-array":return s=s.concat(S({key:r,value:i,valueSpec:n["source_".concat(o.replace("-","_"))],style:t.style,styleSpec:n,objectElementValidators:O})),s;case"geojson":if(s=S({key:r,value:i,valueSpec:n.source_geojson,style:a,styleSpec:n,objectElementValidators:O}),i.cluster)for(const e in i.clusterProperties){const[t,n]=i.clusterProperties[e],a="string"==typeof t?[t,["accumulated"],["get",e]]:t;s.push(...A({key:"".concat(r,".").concat(e,".map"),value:n,expressionContext:"cluster-map"})),s.push(...A({key:"".concat(r,".").concat(e,".reduce"),value:a,expressionContext:"cluster-reduce"}))}return s;case"video":return S({key:r,value:i,valueSpec:n.source_video,style:a,styleSpec:n});case"image":return S({key:r,value:i,valueSpec:n.source_image,style:a,styleSpec:n});case"canvas":return[new e.V(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return C({key:"".concat(r,".type"),value:i.type,valueSpec:{values:N(n)},style:a,styleSpec:n})}}function N(e){return e.source.reduce(((t,i)=>{const r=e[i];return"enum"===r.type.type&&(t=t.concat(Object.keys(r.type.values))),t}),[])}function V(t){const i=t.value,r=t.styleSpec,n=r.light,a=t.style;let o=[];const s=e.j(i);if(void 0===i)return o;if("object"!==s)return o=o.concat([new e.V("light",i,"object expected, ".concat(s," found"))]),o;for(const l in i){const t=l.match(/^(.*)-transition$/);o=o.concat(t&&n[t[1]]&&n[t[1]].transition?H({key:l,value:i[l],valueSpec:r.transition,style:a,styleSpec:r}):n[l]?H({key:l,value:i[l],valueSpec:n[l],style:a,styleSpec:r}):[new e.V(l,i[l],'unknown property "'.concat(l,'"'))])}return o}function j(t){const i=t.value;let r=[];if(!i)return r;const n=e.j(i);if("object"!==n)return r=r.concat([new e.V("light-3d",i,"object expected, ".concat(n," found"))]),r;const a=t.styleSpec,o=a["light-3d"],s=t.key,l=t.style,c=t.style.lights;for(const d of["type","id"])if(!(d in i))return r=r.concat([new e.V("light-3d",i,"missing property ".concat(d," on light"))]),r;if(i.type&&c)for(let d=0;d<t.arrayIndex;d++){const t=e.u(i.type),n=c[d];e.u(n.type)===t&&r.push(new e.V(s,i.id,'duplicate light type "'.concat(i.type,'", previously defined at line ').concat(n.id.__line__)))}const h="properties_light_".concat(i.type);if(!(h in a))return r=r.concat([new e.V("light-3d",i,"Invalid light type ".concat(i.type))]),r;const u=a[h];for(const d in i)if("properties"===d){const n=i[d],o=e.j(n);if("object"!==o)return r=r.concat([new e.V("properties",n,"object expected, ".concat(o," found"))]),r;for(const i in n)r=r.concat(u[i]?H({key:i,value:n[i],valueSpec:u[i],style:l,styleSpec:a}):[new e.i(t.key,n[i],'unknown property "'.concat(i,'"'))])}else{const t=d.match(/^(.*)-transition$/);r=r.concat(t&&o[t[1]]&&o[t[1]].transition?H({key:d,value:i[d],valueSpec:a.transition,style:l,styleSpec:a}):o[d]?H({key:d,value:i[d],valueSpec:o[d],style:l,styleSpec:a}):[new e.i(d,i[d],'unknown property "'.concat(d,'"'))])}return r}function U(t){const i=t.value,r=t.key,n=t.style,a=t.styleSpec,o=a.terrain;let s=[];const l=e.j(i);if(void 0===i)return s;if("null"===l)return s;if("object"!==l)return s=s.concat([new e.V("terrain",i,"object expected, ".concat(l," found"))]),s;for(const c in i){const t=c.match(/^(.*)-transition$/);s=s.concat(t&&o[t[1]]&&o[t[1]].transition?H({key:c,value:i[c],valueSpec:a.transition,style:n,styleSpec:a}):o[c]?H({key:c,value:i[c],valueSpec:o[c],style:n,styleSpec:a}):[new e.i(c,i[c],'unknown property "'.concat(c,'"'))])}if(i.source){const t=n.sources&&n.sources[i.source],a=t&&e.u(t.type);t?"raster-dem"!==a&&s.push(new e.V(r,i.source,"terrain cannot be used with a source of type ".concat(String(a),', it only be used with a "raster-dem" source type'))):s.push(new e.V(r,i.source,'source "'.concat(i.source,'" not found')))}else s.push(new e.V(r,i,'terrain is missing required property "source"'));return s}function G(t){const i=t.value,r=t.style,n=t.styleSpec,a=n.fog;let o=[];const s=e.j(i);if(void 0===i)return o;if("object"!==s)return o=o.concat([new e.V("fog",i,"object expected, ".concat(s," found"))]),o;for(const l in i){const t=l.match(/^(.*)-transition$/);o=o.concat(t&&a[t[1]]&&a[t[1]].transition?H({key:l,value:i[l],valueSpec:n.transition,style:r,styleSpec:n}):a[l]?H({key:l,value:i[l],valueSpec:a[l],style:r,styleSpec:n}):[new e.i(l,i[l],'unknown property "'.concat(l,'"'))])}return o}const q={"*":()=>[],array:T,boolean:function(t){const i=t.value,r=t.key,n=e.j(i);return"boolean"!==n?[new e.V(r,i,"boolean expected, ".concat(n," found"))]:[]},number:E,color:function(t){const i=t.key,r=t.value,n=e.j(r);return"string"!==n?[new e.V(i,r,"color expected, ".concat(n," found"))]:null===e.z(r)?[new e.V(i,r,'color expected, "'.concat(r,'" found'))]:[]},enum:C,filter:I,function:M,layer:z,object:S,source:B,model:e.F,light:V,"light-3d":j,terrain:U,fog:G,string:F,formatted:function(e){return 0===F(e).length?[]:A(e)},resolvedImage:function(e){return 0===F(e).length?[]:A(e)},projection:function(t){const i=t.value,r=t.styleSpec,n=r.projection,a=t.style;let o=[];const s=e.j(i);if("object"===s)for(const e in i)o=o.concat(H({key:e,value:i[e],valueSpec:n[e],style:a,styleSpec:r}));else"string"!==s&&(o=o.concat([new e.V("projection",i,"object or string expected, ".concat(s," found"))]));return o},import:function(t){const{value:i,styleSpec:r}=t,{data:n,...a}=i;Object.defineProperty(a,"__line__",{value:i.__line__,enumerable:!1});let o=S(e.k({},t,{value:a,valueSpec:r.import}));return""===e.u(a.id)&&o.push(new e.V("".concat(t.key,".id"),a,"import id can't be an empty string")),n&&(o=o.concat(Z(n,r,{key:"".concat(t.key,".data")}))),o}};function H(t){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=t.value,n=t.valueSpec,a=t.styleSpec;if(n.expression&&e.B(e.u(r)))return M(t);if(n.expression&&e.o(e.q(r)))return A(t);if(n.type&&q[n.type]){const r=q[n.type](t);return!0===i&&r.length>0&&"array"===e.j(t.value)?A(t):r}return S(e.k({},t,{valueSpec:n.type?a[n.type]:n}))}function W(t){const i=t.value,r=t.key,n=F(t);return n.length||(-1===i.indexOf("{fontstack}")&&n.push(new e.V(r,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&n.push(new e.V(r,i,'"glyphs" url must include a "{range}" token'))),n}function Z(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.G;return H({key:(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).key||"",value:t,valueSpec:i.$root,styleSpec:i,style:t,objectElementValidators:{glyphs:W,"*":()=>[]}})}function Q(t){return ae(Z(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.G))}const X=e=>ae(B(e)),Y=e=>ae(V(e)),J=e=>ae(j(e)),K=e=>ae(U(e)),$=e=>ae(G(e)),ee=e=>ae(z(e)),te=e=>ae(I(e)),ie=e=>ae(R(e)),re=e=>ae(L(e)),ne=t=>ae(e.F(t));function ae(e){return e.slice().sort(((e,t)=>e.line&&t.line?e.line-t.line:0))}function oe(t,i){let r=!1;if(i&&i.length)for(const n of i)n instanceof e.i?e.w(n.message):(t.fire(new e.a(new Error(n.message))),r=!0);return r}const se=new e.H({anchor:new e.J(e.G.light.anchor),position:new e.K(e.G.light.position),color:new e.J(e.G.light.color),intensity:new e.J(e.G.light.intensity)});class le extends e.E{constructor(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flat";super(),this._transitionable=new e.L(se),this.setLight(t,i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._validate(Y,e,i)||(this._transitionable.setTransitionOrValue(e),this.id=t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,i,r){return(!r||!1!==r.validate)&&oe(this,t.call(Q,e.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.G})))}}const ce=new e.H({source:new e.J(e.G.terrain.source),exaggeration:new e.J(e.G.terrain.exaggeration)});let he=class extends e.E{constructor(t,i,r,n){super(),this.scope=r,this._transitionable=new e.L(ce,r,n),this._transitionable.setTransitionOrValue(t,n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(e,t){this._transitionable.setTransitionOrValue(e,t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(t){return this._transitioning.possiblyEvaluate(new e.N(t)).get("exaggeration")}isZoomDependent(){const t=this._transitionable._values.exaggeration;return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof e.Z}};const ue=45,de=65,pe=.05;function fe(t,i,r,n){const a=e.S(ue,de,r),[o,s]=me(t,n);let l=1-Math.min(1,Math.exp((i-o)/(s-o)*-6));return l*=l*l,l=Math.min(1,1.00747*l),l*a*t.alpha}function me(e,t){const i=.5/Math.tan(.5*t);return[e.range[0]+i,e.range[1]+i]}function ge(t,i,r,n,a){const o=e.Q.transformMat4([],[i,r,n],a.mercatorFogMatrix);return fe(t,e.Q.length(o),a.pitch,a._fov)}function _e(t,i,r,n,a,o,s){const l=[[r,n,0],[a,n,0],[a,o,0],[r,o,0]];let c=Number.MAX_VALUE,h=-Number.MAX_VALUE;for(const u of l){const t=e.Q.transformMat4([],u,i),r=e.Q.length(t);c=Math.min(c,r),h=Math.max(h,r)}return[fe(t,c,s.pitch,s._fov),fe(t,h,s.pitch,s._fov)]}const ye=new e.H({range:new e.J(e.G.fog.range),color:new e.J(e.G.fog.color),"high-color":new e.J(e.G.fog["high-color"]),"space-color":new e.J(e.G.fog["space-color"]),"horizon-blend":new e.J(e.G.fog["horizon-blend"]),"star-intensity":new e.J(e.G.fog["star-intensity"]),"vertical-range":new e.J(e.G.fog["vertical-range"])});class ve extends e.E{constructor(t,i,r,n){super(),this._transitionable=new e.L(ye,r,new Map(n)),this.set(t,n),this._transitioning=this._transitionable.untransitioned(),this._transform=i,this.properties=new e.U(ye)}get state(){const t=this._transform,i="globe"===t.projection.name,r=e.W(t.zoom),n=this.properties.get("range"),a=[.5,3];return{range:i?[e.X(a[0],n[0],r),e.X(a[1],n[1],r)]:n,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._validate($,t,r))return;const n=e.e({},t);for(const a of Object.keys(e.G.fog))void 0===n[a]&&(n[a]=e.G.fog[a].default);this._options=n,this._transitionable.setTransitionOrValue(this._options,i)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const i=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:e.S(ue,de,t))*i.a}getOpacityAtLatLng(t,i){return this._transform.projection.supportsFog?function(t,i,r){const n=e.O.fromLngLat(i),a=r.elevation?r.elevation.getAtPointOrZero(n):0;return ge(t,n.x,n.y,a,r)}(this.state,t,i):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const i=this._transform.calculateFogTileMatrix(t.toUnwrapped());return _e(this.state,i,0,0,e.Y,e.Y,this._transform)}getOpacityForBounds(e,t,i,r,n){return this._transform.projection.supportsFog?_e(this.state,e,t,i,r,n,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?me(this.state,e):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const i=[4,5,6,7];for(const r of i){const i=t.points[r];let n;if(i[2]>=0)n=i;else{const a=t.points[r-4];n=e._(a,i,a[2]/(a[2]-i[2]))}if(ge(this.state,n[0],n[1],0,this._transform)>=pe)return!0}return!1}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,i,r){return(!r||!1!==r.validate)&&oe(this,t.call(Q,e.e({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.G})))}}class xe extends e.E{constructor(t,i,r,n){super(),this.scope=r,this._options=t,this.properties=new e.U(i),this._transitionable=new e.L(i,r,new Map(n)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,t){this._options=e,this._transitionable.setTransitionOrValue(e.properties,t)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}const be=new e.H({color:new e.J(e.G.properties_light_ambient.color),intensity:new e.J(e.G.properties_light_ambient.intensity)}),we=new e.H({direction:new e.$(e.G.properties_light_directional.direction),color:new e.J(e.G.properties_light_directional.color),intensity:new e.J(e.G.properties_light_directional.intensity),"cast-shadows":new e.J(e.G.properties_light_directional["cast-shadows"]),"shadow-intensity":new e.J(e.G.properties_light_directional["shadow-intensity"])});class Se{constructor(e,t,i,r){this.screenBounds=e,this.cameraPoint=t,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,r)}static createFromScreenPoints(t,i){let r,n;if(t instanceof e.P||"number"==typeof t[0]){const a=e.P.convert(t);r=[a],n=i.isPointAboveHorizon(a)}else{const a=e.P.convert(t[0]),o=e.P.convert(t[1]);r=[a,o],n=e.a0(a,o).every((e=>i.isPointAboveHorizon(e)))}return new Se(r,i.getCameraPoint(),n,i)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return e.a0(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const i=this.screenBounds[0],r=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],n=e.a0(i,r,0,!1);return this.cameraPoint.y>r.y&&(this.cameraPoint.x>i.x&&this.cameraPoint.x<r.x?n.splice(3,0,this.cameraPoint):this.cameraPoint.x>=r.x?n[2]=this.cameraPoint:this.cameraPoint.x<=i.x&&(n[3]=this.cameraPoint)),e.a1(n,t)}bufferedCameraGeometryGlobe(t){const i=this.screenBounds[0],r=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],n=e.a0(i,r,t),a=this.cameraPoint.clone();switch(3*((a.y>i.y)+(a.y>r.y))+((a.x>i.x)+(a.x>r.x))){case 0:n[0]=a,n[4]=a.clone();break;case 1:n.splice(1,0,a);break;case 2:n[1]=a;break;case 3:n.splice(4,0,a);break;case 5:n.splice(2,0,a);break;case 6:n[3]=a;break;case 7:n.splice(3,0,a);break;case 8:n[2]=a}return n}containsTile(t,i,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const a=t.queryPadding/i._pixelsPerMercatorPixel+1,o=r?this._bufferedCameraMercator(a,i):this._bufferedScreenMercator(a,i);let s=t.tileID.wrap+(o.unwrapped?n:0);const l=o.polygon.map((i=>e.a2(t.tileTransform,i,s)));if(!e.a3(l,0,0,e.Y,e.Y))return;s=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?n:0);const c=this.screenGeometryMercator.polygon.map((i=>e.a4(t.tileTransform,i,s))),h=c.map((t=>new e.P(t[0],t[1]))),u=i.getFreeCameraOptions().position||new e.O(0,0,0),d=e.a4(t.tileTransform,u,s),p=c.map((t=>{const i=e.Q.sub(t,t,d);return e.Q.normalize(i,i),new e.a5(d,i)})),f=e.a6(t,1,i.zoom)*i._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:h,tilespaceRays:p,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(m=e.a7(l),m.min.x=e.ad(m.min.x,0,e.Y),m.min.y=e.ad(m.min.y,0,e.Y),m.max.x=e.ad(m.max.x,0,e.Y),m.max.y=e.ad(m.max.y,0,e.Y),m),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:f};var m}_bufferedScreenMercator(e,t){const i=Me(e);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{let r;return r="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._screenRaycastCache[i]=r,r}}_bufferedCameraMercator(e,t){const i=Me(e);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{let r;return r="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map((e=>t.pointCoordinate3D(e))),unwrapped:!0},this._cameraRaycastCache[i]=r,r}}_projectAndResample(t,i){const r=function(t,i){const r=e.a9.multiply([],i.pixelMatrix,i.globeMatrix),n=[0,-e.ae,0,1],a=[0,e.ae,0,1],o=[0,0,0,1];e.aa.transformMat4(n,n,r),e.aa.transformMat4(a,a,r),e.aa.transformMat4(o,o,r);const s=new e.P(n[0]/n[3],n[1]/n[3]),l=new e.P(a[0]/a[3],a[1]/a[3]),c=e.ab(t,s)&&n[3]<o[3],h=e.ab(t,l)&&a[3]<o[3];if(!c&&!h)return null;const u=function(e,t,i){for(let r=1;r<e.length;r++){const n=Ee(t.pointCoordinate3D(e[r-1]).x),a=Ee(t.pointCoordinate3D(e[r]).x);if(i<0){if(n<a)return{idx:r,t:-n/(a-1-n)}}else if(a<n)return{idx:r,t:(1-n)/(a+1-n)}}return null}(t,i,c?-1:1);if(!u)return null;const{idx:d,t:p}=u;let f=d>1?Te(t.slice(0,d),i):[],m=d<t.length?Te(t.slice(d),i):[];f=f.map((t=>new e.P(Ee(t.x),t.y))),m=m.map((t=>new e.P(Ee(t.x),t.y)));const g=[...f];0===g.length&&g.push(m[m.length-1]);const _=e.X(g[g.length-1].y,(0===m.length?f[0]:m[0]).y,p);let y;return y=c?[new e.P(0,_),new e.P(0,0),new e.P(1,0),new e.P(1,_)]:[new e.P(1,_),new e.P(1,1),new e.P(0,1),new e.P(0,_)],g.push(...y),0===m.length?g.push(f[0]):g.push(...m),{polygon:g.map((t=>new e.O(t.x,t.y))),unwrapped:!1}}(t,i);if(r)return r;const n=function(t,i){let r=!1,n=-1/0,a=0;for(let e=0;e<t.length-1;e++)t[e].x>n&&(n=t[e].x,a=e);for(let e=0;e<t.length-1;e++){const i=(a+e)%(t.length-1),n=t[i],o=t[i+1];Math.abs(n.x-o.x)>.5&&(n.x<o.x?(n.x+=1,0===i&&(t[t.length-1].x+=1)):(o.x+=1,i+1===t.length-1&&(t[0].x+=1)),r=!0)}const o=e.a8(i.center.lng);return r&&o<Math.abs(o-1)&&t.forEach((e=>{e.x-=1})),{polygon:t,unwrapped:r}}(Te(t,i).map((t=>new e.P(Ee(t.x),t.y))),i);return{polygon:n.polygon.map((t=>new e.O(t.x,t.y))),unwrapped:n.unwrapped}}}function Te(t,i){return e.ac(t,(e=>{const t=i.pointCoordinate3D(e);e.x=t.x,e.y=t.y}),1/256)}function Ee(e){return e<0?1+e%1:e%1}function Me(e){return 100*e|0}function Ae(t,i,r,n,a){const o=function(r,n){if(r)return a(r);if(n){t.url&&n.tiles&&t.tiles&&delete t.tiles;const r=e.af(e.e(n,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);n.vector_layers&&(r.vectorLayers=n.vector_layers,r.vectorLayerIds=r.vectorLayers.map((e=>e.id))),n.raster_layers&&(r.rasterLayers=n.raster_layers,r.rasterLayerIds=r.rasterLayers.map((e=>e.id))),r.tiles=i.canonicalizeTileset(r,t.url),a(null,r)}};return t.url?e.g(i.transformRequest(i.normalizeSourceURL(t.url,null,r,n),e.R.Source),o):e.f.frame((()=>o(null,t)))}class Pe{constructor(t,i,r){this.bounds=e.ag.convert(this.validateBounds(t)),this.minzoom=i||0,this.maxzoom=r||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(t){const i=Math.pow(2,t.z),r=Math.floor(e.a8(this.bounds.getWest())*i),n=Math.floor(e.ah(this.bounds.getNorth())*i),a=Math.ceil(e.a8(this.bounds.getEast())*i),o=Math.ceil(e.ah(this.bounds.getSouth())*i);return t.x>=r&&t.x<a&&t.y>=n&&t.y<o}}class Ce extends e.E{constructor(t,i,r,n){if(super(),this.id=t,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,e.e(this,e.af(i,["url","scheme","tileSize","promoteId"])),this._options=e.e({type:"vector"},i),this._collectResourceTiming=!!i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(n),this._tileWorkers={},this._deduped=new e.ai}load(t){this._loaded=!1,this.fire(new e.b("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map._worldview;this._tileJSONRequest=Ae(this._options,this.map._requestManager,i,r,((n,a)=>{this._tileJSONRequest=null,this._loaded=!0,n?(i&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ".concat(i)),r&&2!==r.length&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: ".concat(r)),this.fire(new e.a(n))):a&&(e.e(this,a),a.bounds&&(this.tileBounds=new Pe(a.bounds,this.minzoom,this.maxzoom)),e.am(a.tiles,this.map._requestManager._customAccessToken),this.fire(new e.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.b("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.aj(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return e.e({},this._options)}loadTile(t,i){const r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(r,e.R.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:e.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster};if(n.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=i:t.request=t.actor.send("reloadTile",n,a.bind(this));else if(t.actor=this._tileWorkers[r]=this._tileWorkers[r]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",n,a.bind(this),void 0,!0);else{const i=e.ak.call({deduped:this._deduped},n,((e,i)=>{e||!i?a.call(this,e):(n.data={cacheControl:i.cacheControl,expires:i.expires,rawData:i.rawData.slice(0)},t.actor&&t.actor.send("loadTile",n,a.bind(this),void 0,!0))}),!0);t.request={cancel:i}}function a(r,n){return delete t.request,t.aborted?i(null):r&&404!==r.status?i(r):(n&&n.resourceTiming&&(t.resourceTiming=n.resourceTiming),this.map._refreshExpiredTiles&&n&&t.setExpiryData(n),t.loadVectorData(n,this.map.painter),e.al(this.dispatcher),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e){e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ie extends e.E{constructor(t,i,r,n){super(),this.id=t,this.dispatcher=r,this.setEventedParent(n),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=e.e({type:"raster"},i),e.e(this,e.af(i,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new e.b("dataloading",{dataType:"source"})),this._tileJSONRequest=Ae(this._options,this.map._requestManager,null,null,((i,r)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new e.a(i)):r&&(e.e(this,r),r.bounds&&(this.tileBounds=new Pe(r.bounds,this.minzoom,this.maxzoom)),e.am(r.tiles),this.fire(new e.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.b("data",{dataType:"source",sourceDataType:"content"}))),t&&t(i)}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.aj(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return e.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,i){const r=e.f.devicePixelRatio>=2,n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),r,this.tileSize);t.request=e.d(this.map._requestManager.transformRequest(n,e.R.Tile),((r,n,a,o)=>(delete t.request,t.aborted?(t.state="unloaded",i(null)):r?(t.state="errored",i(r)):n?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:a,expires:o}),t.setTexture(n,this.map.painter),t.state="loaded",e.al(this.dispatcher),void i(null)):i(null))))}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t()}unloadTile(t,i){t.texture&&t.texture instanceof e.T?(t.destroy(!0),t.texture&&t.texture instanceof e.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),i()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ke extends Ie{constructor(t,i,r,n){super(t,i,r,n),this.type="raster-array",this.maxzoom=22,this._options=e.e({type:"raster-array"},i)}triggerRepaint(e){const t=this.map.painter._terrain,i=this.map.style.getSourceCache(this.id);t&&t.enabled&&i&&t._clearRenderCacheForTile(i.id,e.tileID),this.map.triggerRepaint()}loadTile(t,i){const r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),n=this.map._requestManager.transformRequest(r,e.R.Tile);t.requestParams=n,t.actor||(t.actor=this.dispatcher.getActor()),t.request=t.fetchHeader(void 0,((e,r,n,a)=>{if(delete t.request,t.aborted)return t.state="unloaded",i(null);if(e){if(20===e.code)return;return t.state="errored",i(e)}this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:n,expires:a}),t.state="empty",i(null)}))}unloadTile(t){const i=t.texture;i&&i instanceof e.T?(t.destroy(!0),this.map.painter.saveTileTexture(i)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,i,r){t._isHeaderLoaded&&("empty"!==t.state&&(t.state="reloading"),t.fetchBand(i,r,((i,r)=>{if(i)return t.state="errored",this.fire(new e.a(i)),void this.triggerRepaint(t);r&&(t.setTexture(r,this.map.painter),t.state="loaded",this.triggerRepaint(t))})))}getInitialBand(e){if(!this.rasterLayers)return 0;const t=this.rasterLayers.find((t=>{let{id:i}=t;return i===e})),i=t&&t.fields,r=i&&i.bands&&i.bands;return r?r[0]:0}getTextureDescriptor(t,i,r){if(!t)return;const n=i.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!n)return;let a=null;i instanceof e.aq?a=i.paint.get("raster-array-band"):i instanceof e.ar&&(a=i.paint.get("raster-particle-array-band"));const o=a||this.getInitialBand(n);if(null!=o)if(t.textureDescriptor){if(!t.updateNeeded(n,o)||r)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,n,o)}}const De=32,Re=33,Le=new Uint16Array(8184);for(let ys=0;ys<2046;ys++){let e=ys+2,t=0,i=0,r=0,n=0,a=0,o=0;for(1&e?r=n=a=De:t=i=o=De;(e>>=1)>1;){const s=t+r>>1,l=i+n>>1;1&e?(r=t,n=i,t=a,i=o):(t=r,i=n,r=a,n=o),a=s,o=l}const s=4*ys;Le[s+0]=t,Le[s+1]=i,Le[s+2]=r,Le[s+3]=n}const ze=new Uint16Array(2178),Fe=new Uint8Array(1089),Oe=new Uint16Array(1089);function Be(e){return 0===e?-.03125:32===e?.03125:0}class Ne{constructor(e,t,i,r){this.id=Ne.uniqueIdxCounter,Ne.uniqueIdxCounter++,this.context=e;const n=e.gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(i),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||r||t.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=Ne.uniqueIdxCounter,Ne.uniqueIdxCounter++;const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Ne.uniqueIdxCounter=0;const Ve={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class je{constructor(e,t,i,r,n,a){this.length=t.length,this.attributes=i,this.itemSize=t.bytesPerElement,this.dynamicDraw=r,this.instanceCount=a,this.context=e;const o=e.gl;this.buffer=o.createBuffer(),e.bindVertexBuffer.set(this.buffer),o.bufferData(o.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?o.DYNAMIC_DRAW:o.STATIC_DRAW),this.dynamicDraw||n||t.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let i=0;i<this.attributes.length;i++){const r=t.attributes[this.attributes[i].name];void 0!==r&&e.enableVertexAttribArray(r)}}setVertexAttribPointers(e,t,i){for(let r=0;r<this.attributes.length;r++){const n=this.attributes[r],a=t.attributes[n.name];void 0!==a&&e.vertexAttribPointer(a,n.components,e[Ve[n.type]],!1,this.itemSize,n.offset+this.itemSize*(i||0))}}setVertexAttribDivisor(e,t,i){for(let r=0;r<this.attributes.length;r++){const n=t.attributes[this.attributes[r].name];void 0!==n&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(n,i)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ue{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ge extends Ue{getDefault(){return e.aA.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class qe extends Ue{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class He extends Ue{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class We extends Ue{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ze extends Ue{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Qe extends Ue{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Xe extends Ue{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Ye extends Ue{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Je extends Ue{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class Ke extends Ue{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class $e extends Ue{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class et extends Ue{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class tt extends Ue{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class it extends Ue{getDefault(){const e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class rt extends Ue{getDefault(){return e.aA.transparent}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class nt extends Ue{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class at extends Ue{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class ot extends Ue{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class st extends Ue{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let lt=class extends Ue{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class ct extends Ue{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class ht extends Ue{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ut extends Ue{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class dt extends Ue{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class pt extends Ue{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class ft extends Ue{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class mt extends Ue{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class gt extends Ue{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class _t extends Ue{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class yt extends Ue{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class vt extends Ue{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class xt extends Ue{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class bt extends xt{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class wt extends xt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class St extends xt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,this.attachment(),t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Tt extends wt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Et{constructor(e,t,i,r,n){this.context=e,this.width=t,this.height=i;const a=this.framebuffer=e.gl.createFramebuffer();r&&(this.colorAttachment=new bt(e,a)),n&&(this.depthAttachmentType=n,this.depthAttachment="renderbuffer"===n?new wt(e,a):new St(e,a))}destroy(){const e=this.context.gl;if(this.colorAttachment){const t=this.colorAttachment.get();t&&e.deleteTexture(t)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}else{const t=this.depthAttachment.get();t&&e.deleteTexture(t)}e.deleteFramebuffer(this.framebuffer)}}class Mt{constructor(e,t,i){this.func=e,this.mask=t,this.range=i}}Mt.ReadOnly=!1,Mt.ReadWrite=!0,Mt.disabled=new Mt(519,Mt.ReadOnly,[0,1]);const At=7680;class Pt{constructor(e,t,i,r,n,a){this.test=e,this.ref=t,this.mask=i,this.fail=r,this.depthFail=n,this.pass=a}}Pt.disabled=new Pt({func:519,mask:0},0,0,At,At,At);const Ct=771;class It{constructor(e,t,i,r){this.blendFunction=e,this.blendColor=t,this.mask=i,this.blendEquation=r}}It.Replace=[1,0,1,0],It.disabled=new It(It.Replace,e.aA.transparent,[!1,!1,!1,!1]),It.unblended=new It(It.Replace,e.aA.transparent,[!0,!0,!0,!0]),It.alphaBlended=new It([1,Ct,1,Ct],e.aA.transparent,[!0,!0,!0,!0]),It.multiply=new It([774,0,774,0],e.aA.transparent,[!0,!0,!0,!0]);const kt=1029,Dt=2305;class Rt{constructor(e,t,i){this.enable=e,this.mode=t,this.frontFace=i}}Rt.disabled=new Rt(!1,kt,Dt),Rt.backCCW=new Rt(!0,kt,Dt),Rt.backCW=new Rt(!0,kt,2304),Rt.frontCW=new Rt(!0,1028,2304),Rt.frontCCW=new Rt(!0,1028,Dt);class Lt{constructor(e,t){this.gl=e,this.clearColor=new Ge(this),this.clearDepth=new qe(this),this.clearStencil=new He(this),this.colorMask=new We(this),this.depthMask=new Ze(this),this.stencilMask=new Qe(this),this.stencilFunc=new Xe(this),this.stencilOp=new Ye(this),this.stencilTest=new Je(this),this.depthRange=new Ke(this),this.depthTest=new $e(this),this.depthFunc=new et(this),this.blend=new tt(this),this.blendFunc=new it(this),this.blendColor=new rt(this),this.blendEquation=new nt(this),this.cullFace=new at(this),this.cullFaceSide=new ot(this),this.frontFace=new st(this),this.program=new lt(this),this.activeTexture=new ct(this),this.viewport=new ht(this),this.bindFramebuffer=new ut(this),this.bindRenderbuffer=new dt(this),this.bindTexture=new pt(this),this.bindVertexBuffer=new ft(this),this.bindElementBuffer=new mt(this),this.bindVertexArrayOES=new gt(this),this.pixelStoreUnpack=new _t(this),this.pixelStoreUnpackPremultiplyAlpha=new yt(this),this.pixelStoreUnpackFlipY=new vt(this),this.options=t?{...t}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxPointSize=e.getParameter(e.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t,i){return new Ne(this,e,t,i)}createVertexBuffer(e,t,i,r,n){return new je(this,e,t,i,r,n)}createRenderbuffer(e,t,i){const r=this.gl,n=r.createRenderbuffer();return this.bindRenderbuffer.set(n),r.renderbufferStorage(r.RENDERBUFFER,e,t,i),this.bindRenderbuffer.set(null),n}createFramebuffer(e,t,i,r){return new Et(this,e,t,i,r)}clear(e){let{color:t,depth:i,stencil:r,colorMask:n}=e;const a=this.gl;let o=0;t&&(o|=a.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(n||[!0,!0,!0,!0])),void 0!==i&&(o|=a.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(i),this.depthMask.set(!0)),void 0!==r&&(o|=a.STENCIL_BUFFER_BIT,this.clearStencil.set(r),this.stencilMask.set(255)),a.clear(o)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){t(e.blendFunction,It.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor),e.blendEquation?this.blendEquation.set(e.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(e.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var zt=e.aB([{name:"a_index",type:"Int16",components:1}]);const Ft=.15000000000000002;class Ot{constructor(t,i,r,n){const a={width:r[0],height:r[1],data:null},o=t.gl;this.targetColorTexture=new e.T(t,a,o.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new e.T(t,a,o.RGBA,{useMipmap:!1}),this.context=t,this.setParticleTextureDimension(i,n),this.lastInvalidatedAt=0}setParticleTextureDimension(t,i){if(this.particleTextureDimension===i)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const r=this.context.gl,n=i*i,a=new Uint8Array(4*n),o=.7692307692307692,s=e.aC(t.key);for(let e=0;e<a.length;e+=4){const t=o*(s()+Ft),i=o*(s()+Ft),r=255*t%1,n=255*i%1,l=r,c=i-n/255,h=n;a[e+0]=Math.floor(255*(t-r/255)),a[e+1]=Math.floor(255*l),a[e+2]=Math.floor(255*c),a[e+3]=Math.floor(255*h)}const l=new e.h({width:i,height:i},a);this.particleTexture0=new e.T(this.context,l,r.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new e.T(this.context,l,r.RGBA,{premultiply:!1,useMipmap:!1});const c=new e.aD;c.reserve(n);for(let e=0;e<n;e++)c.emplaceBack(e);this.particleIndexBuffer=this.context.createVertexBuffer(c,zt.members,!0),this.particleSegment=e.aE.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=i}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=e.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}const Bt={type:2,extent:e.Y,loadGeometry:()=>[[new e.P(0,0),new e.P(e.Y+1,0),new e.P(e.Y+1,e.Y+1),new e.P(0,e.Y+1),new e.P(0,0)]]};class Nt{constructor(t,i,r,n,a){this.tileID=t,this.uid=e.aF(),this.uses=0,this.tileSize=i,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=a,n&&n.style&&(this._lastUpdatedBrightness=n.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",n&&n.transform&&(this.projection=n.transform.projection)}registerFadeDuration(t){const i=t+this.timeAdded;i<e.f.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=e.av(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,i,r){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(e,t){const i={};if(!t)return i;for(const r of e){const e=r.layerIds.map((e=>t.getLayer(e))).filter(Boolean);if(0!==e.length){r.layers=e,r.stateDependentLayerIds&&(r.stateDependentLayers=r.stateDependentLayerIds.map((t=>e.filter((e=>e.id===t))[0])));for(const t of e)i[t.fqid]=r}}return i}(t.buckets,i.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const i=this.buckets[t];if(i instanceof e.aH){if(this.hasSymbolBuckets=!0,!r)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const i=this.buckets[t];if(i instanceof e.aH&&i.hasRTLText){this.hasRTLText=!0,e.aI();break}}this.queryPadding=0;for(const e in this.buckets){const t=this.buckets[e],r=i.style.getOwnLayer(e);if(!r)continue;const n=r.queryRadius(t);this.queryPadding=Math.max(this.queryPadding,n)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new e.aG}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(t){for(const e in this.buckets){const i=this.buckets[e];i.uploadPending()&&i.upload(t)}const i=t.gl,r=this.imageAtlas;if(r&&!r.uploaded){const n=!!Object.keys(r.patternPositions).length;this.imageAtlasTexture=new e.T(t,r.image,i.RGBA,{useMipmap:n}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new e.T(t,this.glyphAtlasImage,i.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new e.T(t,this.lineAtlas.image,i.R8),this.lineAtlas.uploaded=!0)}prepare(e,t,i){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,i),!t||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const r=t.style.getBrightness();(this._lastUpdatedBrightness||r)&&(this._lastUpdatedBrightness&&r&&Math.abs(this._lastUpdatedBrightness-r)<.001||(this._lastUpdatedBrightness=r,this.updateBuckets(void 0,t)))}queryRenderedFeatures(e,t,i,r,n,a,o,s){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:r,pixelPosMatrix:o,transform:a,params:n,tileTransform:this.tileTransform},e,t,i):{}}querySourceFeatures(t,i){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const n=r.loadVTLayers(),a=i?i.sourceLayer:"",o=n._geojsonTileLayer||n[a];if(!o)return;const s=e.aJ(i&&i.filter),{z:l,x:c,y:h}=this.tileID.canonical,u={z:l,x:c,y:h};for(let d=0;d<o.length;d++){const i=o.feature(d);if(s.needGeometry){const t=e.aK(i,!0);if(!s.filter(new e.N(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!s.filter(new e.N(this.tileID.overscaledZ),i))continue;const n=r.getId(i,a),p=new e.aL(i,l,c,h,n);p.tile=u,t.push(p)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const i=this.expirationTime;if(t.cacheControl){const i=e.aM(t.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const e=Date.now();let t=!1;if(this.expirationTime>e)t=!1;else if(i)if(this.expirationTime<i)t=!0;else{const r=this.expirationTime-i;r?this.expirationTime=e+Math.max(r,3e4):t=!0}else t=!0;t?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length&&t&&this.updateBuckets(e,t)}updateBuckets(t,i){if(!this.latestFeatureIndex)return;const r=this.latestFeatureIndex.loadVTLayers(),n=i.style.listImages(),a=i.style.getBrightness();for(const o in this.buckets){if(!i.style.hasLayer(o))continue;const s=this.buckets[o],l=s.layers[0].sourceLayer||"_geojsonTileLayer",c=r[l];let h={};if(t&&(h=t[l],!c||!h||0===Object.keys(h).length))continue;if(s.update(h,c,n,this.imageAtlas&&this.imageAtlas.patternPositions||{},a),s instanceof e.aN||s instanceof e.aO){const e=i.style.getOwnSourceCache(s.layers[0].source);i._terrain&&i._terrain.enabled&&e&&s.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(e.id,this.tileID)}const u=i&&i.style&&i.style.getOwnLayer(o);u&&(this.queryPadding=Math.max(this.queryPadding,u.queryRadius(s)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<e.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=e.f.now()+t}setTexture(t,i){const r=i.context,n=r.gl;this.texture=this.texture||i.getTileTexture(t.width),this.texture&&this.texture instanceof e.T?this.texture.update(t,{useMipmap:!0}):(this.texture=new e.T(r,t,n.RGBA,{useMipmap:!0}),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE))}setDependencies(e,t){const i={};for(const r of t)i[r]=!0;this.dependencies[e]=i}hasDependency(e,t){for(const i of e){const e=this.dependencies[i];if(e)for(const i of t)if(e[i])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,i){if(!i||"mercator"===i.name||this._tileDebugBuffer)return;const r=e.aP(Bt,this.tileID.canonical,this.tileTransform)[0],n=new e.aQ,a=new e.aR;for(let e=0;e<r.length;e++){const{x:t,y:i}=r[e];n.emplaceBack(t,i),a.emplaceBack(e)}a.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(a),this._tileDebugBuffer=t.createVertexBuffer(n,e.aS.members),this._tileDebugSegments=e.aE.simpleSegment(0,0,n.length,a.length)}_makeTileBoundsBuffers(t,i){if(this._tileBoundsBuffer||!i||"mercator"===i.name)return;const r=e.aP(Bt,this.tileID.canonical,this.tileTransform)[0];let n,a;if(this.isRaster){const t=function(t,i){const r=e.av(t,i),n=Math.pow(2,t.z);for(let h=0;h<Re;h++)for(let a=0;a<Re;a++){const o=e.aw((t.x+(a+Be(a))/De)/n),s=e.ax((t.y+(h+Be(h))/De)/n),l=i.project(o,s),c=h*Re+a;ze[2*c+0]=Math.round((l.x*r.scale-r.x)*e.Y),ze[2*c+1]=Math.round((l.y*r.scale-r.y)*e.Y)}Fe.fill(0),Oe.fill(0);for(let e=2045;e>=0;e--){const t=4*e,i=Le[t+0],r=Le[t+1],n=Le[t+2],a=Le[t+3],o=i+n>>1,s=r+a>>1,l=o+s-r,c=s+i-o,h=r*Re+i,u=a*Re+n,d=s*Re+o,p=Math.hypot((ze[2*h+0]+ze[2*u+0])/2-ze[2*d+0],(ze[2*h+1]+ze[2*u+1])/2-ze[2*d+1])>=16;Fe[d]=Fe[d]||(p?1:0),e<1022&&(Fe[d]=Fe[d]||Fe[(r+c>>1)*Re+(i+l>>1)]||Fe[(a+c>>1)*Re+(n+l>>1)])}const a=new e.ay,o=new e.az;let s=0;function l(t,i){const r=i*Re+t;return 0===Oe[r]&&(a.emplaceBack(ze[2*r+0],ze[2*r+1],t*e.Y/De,i*e.Y/De),Oe[r]=++s),Oe[r]-1}function c(e,t,i,r,n,a){const s=e+i>>1,h=t+r>>1;if(Math.abs(e-n)+Math.abs(t-a)>1&&Fe[h*Re+s])c(n,a,e,t,s,h),c(i,r,n,a,s,h);else{const s=l(e,t),c=l(i,r),h=l(n,a);o.emplaceBack(s,c,h)}}return c(0,0,De,De,De,0),c(De,De,0,0,0,De),{vertices:a,indices:o}}(this.tileID.canonical,i);n=t.vertices,a=t.indices}else{n=new e.ay,a=new e.az;for(const{x:e,y:i}of r)n.emplaceBack(e,i,0,0);const t=e.aT(n.int16,void 0,4);for(let e=0;e<t.length;e+=3)a.emplaceBack(t[e],t[e+1],t[e+2])}this._tileBoundsBuffer=t.createVertexBuffer(n,e.aU.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(a),this._tileBoundsSegments=e.aE.simpleSegment(0,0,n.length,a.length)}_makeGlobeTileDebugBuffers(t,i){const r=i.projection;if(!r||"globe"!==r.name||i.freezeTileCoverage)return;const n=this.tileID.canonical,a=e.aV(n,i),o=e.aW(a),s=e.W(i.zoom);let l;s>0&&(l=e.a9.invert(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,n,i,o,l,s),this._makeGlobeTileDebugTextBuffer(t,n,i,o,l,s)}_globePoint(t,i,r,n,a,o,s){let l=e.aX(t,i,r);if(o){const a=1<<r.z,c=e.a8(n.center.lng),h=e.ah(n.center.lat),u=(r.x+.5)/a-c;let d=0;u>.5?d=-1:u<-.5&&(d=1);let p=(t/e.Y+r.x)/a+d,f=(i/e.Y+r.y)/a;p=(p-c)*n._pixelsPerMercatorPixel+c,f=(f-h)*n._pixelsPerMercatorPixel+h;const m=[p*n.worldSize,f*n.worldSize,0];e.Q.transformMat4(m,m,o),l=e.aY(l,m,s)}return e.Q.transformMat4(l,l,a)}_makeGlobeTileDebugBorderBuffer(t,i,r,n,a,o){const s=new e.aQ,l=new e.aR,c=new e.aZ,h=(e,t,h,u,d)=>{const p=(h-e)/(d-1),f=(u-t)/(d-1),m=s.length;for(let g=0;g<d;g++){const h=e+g*p,u=t+g*f;s.emplaceBack(h,u);const d=this._globePoint(h,u,i,r,n,a,o);c.emplaceBack(d[0],d[1],d[2]),l.emplaceBack(m+g)}},u=e.Y;h(0,0,u,0,16),h(u,0,u,u,16),h(u,u,0,u,16),h(0,u,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(l),this._tileDebugBuffer=t.createVertexBuffer(s,e.aS.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(c,e.a_.members),this._tileDebugSegments=e.aE.simpleSegment(0,0,s.length,l.length)}_makeGlobeTileDebugTextBuffer(t,i,r,n,a,o){const s=e.Y/4,l=new e.aQ,c=new e.az,h=new e.aZ,u=25;c.reserve(32),l.reserve(u),h.reserve(u);const d=(e,t)=>u*e+t;for(let e=0;e<u;e++){const t=e*s;for(let e=0;e<u;e++){const c=e*s;l.emplaceBack(c,t);const u=this._globePoint(c,t,i,r,n,a,o);h.emplaceBack(u[0],u[1],u[2])}}for(let e=0;e<4;e++)for(let t=0;t<4;t++){const i=d(e,t),r=d(e,t+1),n=d(e+1,t),a=d(e+1,t+1);c.emplaceBack(i,r,n),c.emplaceBack(n,r,a)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(c),this._tileDebugTextBuffer=t.createVertexBuffer(l,e.aS.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(h,e.a_.members),this._tileDebugTextSegments=e.aE.simpleSegment(0,0,u,32)}destroy(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof e.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}const Vt={vector:Ce,raster:Ie,"raster-dem":class extends Ie{constructor(t,i,r,n){super(t,i,r,n),this.type="raster-dem",this.maxzoom=22,this._options=e.e({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(t,i){const r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function n(e,r){e&&(t.state="errored",i(e)),r&&(t.dem=r,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",i(null))}t.request=e.d(this.map._requestManager.transformRequest(r,e.R.Tile),function(r,a,o,s){if(delete t.request,t.aborted)t.state="unloaded",i(null);else if(r)t.state="errored",i(r);else if(a){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:o,expires:s});const i=ImageBitmap&&a instanceof ImageBitmap&&e.an(),r=1-(a.width-e.ao(a.width))/2;r<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const l=i?a:e.f.getImageData(a,r),c={uid:t.uid,coord:t.tileID,source:this.id,scope:this.scope,rawImageData:l,encoding:this.encoding,padding:r};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",c,n.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(t){const i=t.canonical,r=Math.pow(2,i.z),n=(i.x-1+r)%r,a=0===i.x?t.wrap-1:t.wrap,o=(i.x+1+r)%r,s=i.x+1===r?t.wrap+1:t.wrap,l={};return l[new e.ap(t.overscaledZ,a,i.z,n,i.y).key]={backfilled:!1},l[new e.ap(t.overscaledZ,s,i.z,o,i.y).key]={backfilled:!1},i.y>0&&(l[new e.ap(t.overscaledZ,a,i.z,n,i.y-1).key]={backfilled:!1},l[new e.ap(t.overscaledZ,t.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},l[new e.ap(t.overscaledZ,s,i.z,o,i.y-1).key]={backfilled:!1}),i.y+1<r&&(l[new e.ap(t.overscaledZ,a,i.z,n,i.y+1).key]={backfilled:!1},l[new e.ap(t.overscaledZ,t.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},l[new e.ap(t.overscaledZ,s,i.z,o,i.y+1).key]={backfilled:!1}),l}},"raster-array":ke,geojson:class extends e.E{constructor(t,i,r,n){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(n),this._data=i.data,this._options=e.e({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),void 0!==i.minzoom&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const a=e.Y/this.tileSize;this.workerOptions=e.e({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*a,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*a,extent:e.Y,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:e.Y,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*a,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(t){return this._options.dynamic?(this._data=t,this._updateWorkerData(!0),this):this.fire(new e.a(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,i,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:i},r),this}_updateWorkerData(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new e.b("dataloading",{dataType:"source"})),this._loaded=!1;const i=e.e({append:t},this.workerOptions);i.scope=this.scope;const r=this._data;"string"==typeof r?(i.request=this.map._requestManager.transformRequest(e.f.resolveURL(r),e.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(r),this._pendingLoad=this.actor.send("".concat(this.type,".loadData"),i,((i,r)=>{if(this._loaded=!0,this._pendingLoad=null,i)this.fire(new e.a(i));else{const t={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&r&&r.resourceTiming&&r.resourceTiming[this.id]&&(t.resourceTiming=r.resourceTiming[this.id]),this.fire(new e.b("data",t)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(t),this._coalesce=!1)}))}loaded(){return this._loaded}loadTile(t,i){const r=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const n={type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:e.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};t.request=this.actor.send(r,n,((e,n)=>(delete t.request,t.destroy(),t.aborted?i(null):e?i(e):(t.loadVectorData(n,this.map.painter,"reloadTile"===r),i(null)))),void 0,"loadTile"===r)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e){this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return e.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends e.as{constructor(e,t,i,r){super(e,t,i,r),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const i of t.urls)this.urls.push(this.map._requestManager.transformRequest(i,e.R.Source).url);e.at(this.urls,((t,i)=>{this._loaded=!0,t?this.fire(new e.a(t)):i&&(this.video=i,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const i=this.video.seekable;t<i.start(0)||t>i.end(0)?this.fire(new e.a(new e.V("sources.".concat(this.id),null,"Playback for this video can be set only between the ".concat(i.start(0)," and ").concat(i.end(0),"-second mark.")))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,i=t.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new e.T(t,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:e.as,model:class extends e.E{constructor(e,t,i,r){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const t=[];for(const i in this._options.models){const r=this._options.models[i],n=e.l(this.map._requestManager.transformRequest(r.uri,e.R.Model).url).then((t=>{if(!t)return;const n=e.c(t),a=new e.M(i,r.position,r.orientation,n);a.computeBoundsAndApplyParent(),this.models.push(a)})).catch((t=>{this.fire(new e.a(new Error("Could not load model ".concat(i," from ").concat(r.uri,": ").concat(t.message))))}));t.push(n)}return Promise.allSettled(t).then((()=>{this._loaded=!0,this.fire(new e.b("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((t=>{this.fire(new e.a(new Error("Could not load models: ".concat(t.message))))}))}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return{type:"model"}}},"batched-model":class extends e.E{constructor(e,t,i,r){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=i,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(r)}onAdd(e){this.map=e,this.load()}load(t){this._loaded=!1,this.fire(new e.b("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map._worldview;this._tileJSONRequest=Ae(this._options,this.map._requestManager,i,r,((n,a)=>{this._tileJSONRequest=null,this._loaded=!0,n?(i&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ".concat(i)),r&&2!==r.length&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: ".concat(r)),this.fire(new e.a(n))):a&&(e.e(this,a),a.bounds&&(this.tileBounds=new Pe(a.bounds,this.minzoom,this.maxzoom)),e.am(a.tiles,this.map._requestManager._customAccessToken),this.fire(new e.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.b("data",{dataType:"source",sourceDataType:"content"}))),t&&t(n)}))}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(t,i){const r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),n={request:this.map._requestManager.transformRequest(r,e.R.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(t.actor&&"expired"!==t.state)if("loading"===t.state)t.reloadCallback=i;else{if(t.buckets){const e=Object.values(t.buckets);for(const t of e)t.dirty=!0;return void(t.state="loaded")}t.request=t.actor.send("reloadTile",n,a.bind(this))}else t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",n,a.bind(this),void 0,!0);function a(e,r){return t.aborted?i(null):e&&404!==e.status?i(e):(r&&(r.resourceTiming&&(t.resourceTiming=r.resourceTiming),this.map._refreshExpiredTiles&&t.setExpiryData(r),t.buckets={...t.buckets,...r.buckets},r.featureIndex&&(t.latestFeatureIndex=r.featureIndex)),t.state="loaded",void i(null))}}serialize(){return e.e({},this._options)}},canvas:class extends e.as{constructor(t,i,r,n){super(t,i,r,n),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((e=>!Array.isArray(e)||2!==e.length||e.some((e=>"number"!=typeof e))))||this.fire(new e.a(new e.V("sources.".concat(t),null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.a(new e.V("sources.".concat(t),null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new e.a(new e.V("sources.".concat(t),null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof HTMLCanvasElement||this.fire(new e.a(new e.V("sources.".concat(t),null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.a(new e.V("sources.".concat(t),null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?!t&&!this._playing||this.texture instanceof e.au||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.T(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends e.E{constructor(t,i,r,n){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=i,this.setEventedParent(n),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new e.a(new Error("Missing implementation for ".concat(this.id," custom source")))),this._implementation.loadTile||this.fire(new e.a(new Error("Missing loadTile implementation for ".concat(this.id," custom source")))),this._implementation.bounds&&(this.tileBounds=new Pe(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),e.e(this,e.af(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return e.af(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new e.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this._map=t,this._loaded=!1,this.fire(new e.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:i,z:r}=e.canonical;return this._implementation.hasTile({x:t,y:i,z:r})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){const{x:i,y:r,z:n}=e.tileID.canonical,a=new AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:i,y:r,z:n},{signal:a.signal})).then(function(i){return delete e.request,e.aborted?(e.state="unloaded",t(null)):void 0===i?(e.state="errored",t(null)):null===i?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",t(null)):function(e){return e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof ImageBitmap||e instanceof HTMLImageElement}(i)?(this.loadTileData(e,i),e.state="loaded",void t(null)):(e.state="errored",t(new Error("Can't infer data type for ".concat(this.id,", only raster data supported at the moment"))))}.bind(this)).catch((i=>{20!==i.code&&(e.state="errored",t(i))})),e.request.cancel=()=>a.abort()}loadTileData(e,t){e.setTexture(t,this._map.painter)}unloadTile(t,i){if(t.texture&&t.texture instanceof e.T?(t.destroy(!0),t.texture&&t.texture instanceof e.T&&this._map.painter.saveTileTexture(t.texture)):t.destroy(),this._implementation.unloadTile){const{x:e,y:i,z:r}=t.tileID.canonical;this._implementation.unloadTile({x:e,y:i,z:r})}i()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z})))}_clearTiles(){const t=e.aj(this.id,this.scope);this._map.style.clearSource(t)}_update(){this.fire(new e.b("data",{dataType:"source",sourceDataType:"content"}))}}},jt=function(t,i,r,n){const a=new Vt[i.type](t,i,r,n);if(a.id!==t)throw new Error("Expected Source id to be ".concat(t," instead of ").concat(a.id));return e.a$(["load","abort","unload","serialize","prepare"],a),a};function Ut(t,i){const r=e.a9.identity([]);return e.a9.scale(r,r,[.5*t.width,.5*-t.height,1]),e.a9.translate(r,r,[1,-1,0]),e.a9.multiply(r,r,t.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(r)}function Gt(e,t,i,r,n,a,o){let s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=e.tilesIn(r,o,s);l.sort(Ht);const c=[];for(const u of l)c.push({wrappedTileID:u.tile.tileID.wrapped().key,queryResults:u.tile.queryRenderedFeatures(t,i,e._state,u,n,a,Ut(e.transform,u.tile.tileID),s)});const h=function(e){const t={},i={};for(const r of e){const e=r.queryResults,n=r.wrappedTileID,a=i[n]=i[n]||{};for(const i in e){const r=e[i],n=a[i]=a[i]||{},o=t[i]=t[i]||[];for(const e of r)n[e.featureIndex]||(n[e.featureIndex]=!0,o.push(e))}}return t}(c);for(const u in h)h[u].forEach((t=>{const i=t.feature,r=i.layer;r&&"background"!==r.type&&"sky"!==r.type&&"slot"!==r.type&&(i.source=r.source,r["source-layer"]&&(i.sourceLayer=r["source-layer"]),i.state=void 0!==i.id?e.getFeatureState(r["source-layer"],i.id):{})}));return h}function qt(e,t){const i=e.getRenderableIds().map((t=>e.getTileByID(t))),r=[],n={};for(let a=0;a<i.length;a++){const e=i[a],o=e.tileID.canonical.key;n[o]||(n[o]=!0,e.querySourceFeatures(r,t))}return r}function Ht(e,t){const i=e.tileID,r=t.tileID;return i.overscaledZ-r.overscaledZ||i.canonical.y-r.canonical.y||i.wrap-r.wrap||i.canonical.x-r.canonical.x}class Wt extends Nt{constructor(e,t,i,r,n){super(e,t,i,r,n),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(t,i){const r=i.context,n=r.gl;this.texture=this.texture||i.getTileTexture(t.width),this.texture&&this.texture instanceof e.T?this.texture.update(t,{useMipmap:!1,premultiply:!1}):this.texture=new e.T(r,t,n.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16384,i=arguments.length>1?arguments[1]:void 0;const r=this._mrt=new e.b0(30),n=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=e.b1(n,((e,n,a,o)=>{if(e)i(e);else try{const e=r.getHeaderLength(n);if(e>t)return void(this.request=this.fetchHeader(e,i));r.parseHeader(n),this._isHeaderLoaded=!0;let s=0;for(const t of Object.values(r.layers))s=Math.max(s,t.dataIndex[t.dataIndex.length-1].last_byte);n.byteLength>=s&&(this.entireBuffer=n),i(null,this.entireBuffer||n,a,o)}catch(e){i(e)}})),this.request}fetchBand(t,i,r){const n=this._mrt;if(!this._isHeaderLoaded||!n)return void r(new Error("Tile header is not ready"));const a=this.actor;if(!a)return void r(new Error("Can't fetch tile band without an actor"));let o;const s=(e,n)=>{o.complete(e,n),e?r(e):(this.updateTextureDescriptor(t,i),r(null,this.textureDescriptor&&this.textureDescriptor.img))},l=(e,t)=>{if(e)return r(e);const i=a.send("decodeRasterArray",{buffer:t,task:o},s,void 0,!0);this._workQueue.push((()=>{i&&i.cancel(),o.cancel()}))},c=n.getLayer(t);if(!c)return void r(new Error('Unknown sourceLayer "'.concat(t,'"')));if(c.hasDataForBand(i))return this.updateTextureDescriptor(t,i),void r(null,this.textureDescriptor?this.textureDescriptor.img:null);const h=c.getDataRange([i]);if(o=n.createDecodingTask(h),!o||o.tasks.length)if(this.flushQueues(),this.entireBuffer)l(null,this.entireBuffer.slice(h.firstByte,h.lastByte+1));else{const t=Object.assign({},this.requestParams,{headers:{Range:"bytes=".concat(h.firstByte,"-").concat(h.lastByte)}}),i=e.b1(t,l);this._fetchQueue.push((()=>{i.cancel(),o.cancel()}))}else r(null)}updateNeeded(e,t){return(!this.textureDescriptor||this.textureDescriptor.band!==t||this.textureDescriptor.layer!==e)&&"errored"!==this.state}updateTextureDescriptor(t,i){if(!this._mrt)return;const r=this._mrt.getLayer(t);if(!r||!r.hasBand(i)||!r.hasDataForBand(i))return;const{bytes:n,tileSize:a,buffer:o,offset:s,scale:l}=r.getBandView(i),c=a+2*o,h={data:n,width:c,height:c},u=this.texture;u&&u instanceof e.T&&u.update(h,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:t,band:i,img:h,buffer:o,offset:s,tileSize:a,format:r.pixelFormat,mix:[l,256*l,65536*l,16777216*l]}}}class Zt{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,i){const r=e.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);const n={value:t,timeout:void 0};if(void 0!==i&&(n.timeout=setTimeout((()=>{this.remove(e,n)}),i)),this.data[r].push(n),this.order.push(r),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const i=e.wrapped().key,r=void 0===t?0:this.data[i].indexOf(t),n=this.data[i][r];return this.data[i].splice(r,1),n.timeout&&clearTimeout(n.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(n.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const i in this.data)for(const r of this.data[i])e(r.value)||t.push(r);for(const i of t)this.remove(i.value.tileID,i)}}class Qt extends e.E{constructor(e,t,i){super(),this.id=e,this._onlySymbols=i,t.on("data",(e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))})),t.on("error",(()=>{this._sourceErrored=!0})),this._source=t,this._tiles={},this._cache=new Zt(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new x,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if("errored"!==t.state&&("loaded"!==t.state||!t.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,(()=>{}))}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,(()=>{}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const i=this._tiles[t];i.upload(e),i.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return e.b2(this._tiles).map((e=>e.tileID)).sort(Xt).map((e=>e.key))}getRenderableIds(t,i){const r=[];for(const e in this._tiles)this._isIdRenderable(+e,t,i)&&r.push(this._tiles[e]);return t?r.sort(((t,i)=>{const r=t.tileID,n=i.tileID,a=new e.P(r.canonical.x,r.canonical.y)._rotate(this.transform.angle),o=new e.P(n.canonical.x,n.canonical.y)._rotate(this.transform.angle);return r.overscaledZ-n.overscaledZ||o.y-a.y||o.x-a.x})).map((e=>e.tileID.key)):r.map((e=>e.tileID)).sort(Xt).map((e=>e.key))}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())&&(i||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const i=this._tiles[e];i&&("loading"!==i.state&&(i.state=t),this._loadTile(i,this._tileLoaded.bind(this,i,e,t)))}_tileLoaded(t,i,r,n){if(n)if(t.state="errored",404!==n.status)this._source.fire(new e.a(n,{tile:t}));else{if(!(t.tileID.key in this._loadedParentTiles))return void this._source.fire(new e.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=e.f.now(),"expired"===r&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new e.b("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let r=0;r<t.length;r++){const n=t[r];if(e.neighboringTiles&&e.neighboringTiles[n]){const t=this.getTileByID(n);i(e,t),i(t,e)}}function i(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let i=t.tileID.canonical.x-e.tileID.canonical.x;const r=t.tileID.canonical.y-e.tileID.canonical.y,n=Math.pow(2,e.tileID.canonical.z),a=t.tileID.key;0===i&&0===r||Math.abs(r)>1||(Math.abs(i)>1&&(1===Math.abs(i+n)?i+=n:1===Math.abs(i-n)&&(i-=n)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,i,r),e.neighboringTiles&&e.neighboringTiles[a]&&(e.neighboringTiles[a].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,i,r){for(const n in this._tiles){let a=this._tiles[n];if(r[n]||!a.hasData()||a.tileID.overscaledZ<=t||a.tileID.overscaledZ>i)continue;let o=a.tileID;for(;a&&a.tileID.overscaledZ>t+1;){const e=a.tileID.scaledTo(a.tileID.overscaledZ-1);a=this._tiles[e.key],a&&a.hasData()&&(o=e)}let s=o;for(;s.overscaledZ>t;)if(s=s.scaledTo(s.overscaledZ-1),e[s.key]){r[o.key]=o;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const i=this._loadedParentTiles[e.key];return i&&i.tileID.overscaledZ>=t?i:null}for(let i=e.overscaledZ-1;i>=t;i--){const t=e.scaledTo(i),r=this._getLoadedTile(t);if(r)return r}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const i=Math.ceil(e.width/t)+1,r=Math.ceil(e.height/t)+1,n=Math.floor(i*r*5),a="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,n):n,o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,a):a;this._cache.setMaxSize(o)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const i in this._tiles){const r=this._tiles[i];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+t),e[r.tileID.key]=r}this._tiles=e;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(+t,this._tiles[t])}}update(t,i,r,n){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!r)return;let a;if(this.updateCacheSize(t,i),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)a=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((t=>new e.ap(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)));else if(0!==this.tileCoverLift){const n=t.clone();n.tileCoverLift=this.tileCoverLift,a=n.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&"globe"===t.projection.name&&(a.push(new e.ap(1,0,1,0,0)),a.push(new e.ap(1,0,1,1,0)),a.push(new e.ap(1,0,1,0,1)),a.push(new e.ap(1,0,1,1,1)))}else a=t.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(a=a.filter((e=>this._source.hasTile(e))));else a=[];if(a.length>0&&this.castsShadows&&n&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!Yt(this._source.type)){const e=t.coveringZoomLevel({tileSize:i||this._source.tileSize,roundZoom:this._source.roundZoom&&!r}),o=Math.min(e,this._source.maxzoom),s=t.extendTileCoverForShadows(a,n,o);for(const t of s)this._shadowCasterTiles[t.key]=!0,a.push(t)}const o=this._updateRetainedTiles(a);if(Yt(this._source.type)&&0!==a.length){const t={},i={},r=Object.keys(o);for(const a of r){const r=o[a],n=this._tiles[a];if(!n||n.fadeEndTime&&n.fadeEndTime<=e.f.now())continue;const s=this.findLoadedParent(r,Math.max(r.overscaledZ-Qt.maxOverzooming,this._source.minzoom));s&&(this._addTile(s.tileID),t[s.tileID.key]=s.tileID),i[a]=r}const n=a[a.length-1].overscaledZ;for(const e in this._tiles){const t=this._tiles[e];if(o[e]||!t.hasData())continue;let r=t.tileID;for(;r.overscaledZ>n;){r=r.scaledTo(r.overscaledZ-1);const n=this._tiles[r.key];if(n&&n.hasData()&&i[r.key]){o[e]=t.tileID;break}}}for(const e in t)o[e]||(this._coveredTiles[e]=!0,o[e]=t[e])}for(const e in o)this._tiles[e].clearFadeHold();const s=e.b3(this._tiles,o);for(const e of s){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+e)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const i={},r=e.reduce(((e,t)=>Math.min(e,t.overscaledZ)),1/0),n=e[0].overscaledZ,a=Math.max(n-Qt.maxOverzooming,this._source.minzoom),o=Math.max(n+Qt.maxUnderzooming,this._source.minzoom),s={};for(const l of e){const e=this._addTile(l);t[l.key]=l,e.hasData()||r<this._source.maxzoom&&(s[l.key]=l)}this._retainLoadedChildren(s,r,o,t);for(const l of e){let e=this._tiles[l.key];if(e.hasData())continue;if(l.canonical.z>=this._source.maxzoom){const e=l.children(this._source.maxzoom)[0],i=this.getTile(e);if(i&&i.hasData()){t[e.key]=e;continue}}else{const e=l.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let r=e.wasRequested();for(let n=l.overscaledZ-1;n>=a;--n){const a=l.scaledTo(n);if(i[a.key])break;if(i[a.key]=!0,e=this.getTile(a),!e&&r&&(e=this._addTile(a)),e&&(t[a.key]=a,r=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let i,r=this._tiles[e].tileID;for(;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){i=this._loadedParentTiles[r.key];break}t.push(r.key);const e=r.scaledTo(r.overscaledZ-1);if(i=this._getLoadedTile(e),i)break;r=e}for(const e of t)this._loadedParentTiles[e]=i}}_addTile(t){let i=this._tiles[t.key];if(i)return!0!==i.isExtraShadowCaster||!!this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),i;i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));const r=Boolean(i);if(!r){const e=this.map?this.map.painter:null,r=this._source.tileSize*t.overscaleFactor();i="raster-array"===this._source.type?new Wt(t,r,this.transform.tileZoom,e,this._isRaster):new Nt(t,r,this.transform.tileZoom,e,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,t.key,i.state))}return i?(i.uses++,this._tiles[t.key]=i,r||this._source.fire(new e.b("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const i=t.getExpiryTimeout();i&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),i))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state||"empty"===t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,i,r){const n=[],a=this.transform;if(!a)return n;const o="globe"===a.projection.name,s=e.a8(a.center.lng);for(const l in this._tiles){const c=this._tiles[l];if(r&&c.clearQueryDebugViz(),c.holdingForFade())continue;let h;if(o){const t=c.tileID.canonical;if(0===t.z){const i=[Math.abs(e.ad(s,...Jt(t,-1))-s),Math.abs(e.ad(s,...Jt(t,1))-s)];h=[0,2*i.indexOf(Math.min(...i))-1]}else{const i=[Math.abs(e.ad(s,...Jt(t,-1))-s),Math.abs(e.ad(s,...Jt(t,0))-s),Math.abs(e.ad(s,...Jt(t,1))-s)];h=[i.indexOf(Math.min(...i))-1]}}else h=[0];for(const e of h){const r=t.containsTile(c,a,i,e);r&&n.push(r)}}return n}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,t){const i=this.getRenderableIds(e,t).map((e=>this._tiles[e].tileID)),r="globe"===this.transform.projection.name;for(const n of i)n.projMatrix=this.transform.calculateProjMatrix(n.toUnwrapped()),n.expandedProjMatrix=r?this.transform.calculateProjMatrix(n.toUnwrapped(),!1,!0):n.projMatrix;return i}sortCoordinatesByDistance(e){const t=e.slice(),i=this.transform._camera.position,r=this.transform._camera.forward(),n={};for(const a of t){const e=1/(1<<a.canonical.z);n[a.key]=((a.canonical.x+.5)*e+a.wrap-i[0])*r[0]+((a.canonical.y+.5)*e-i[1])*r[1]-i[2]*r[2]}return t.sort(((e,t)=>n[e.key]-n[t.key])),t}hasTransition(){if(this._source.hasTransition())return!0;if(Yt(this._source.type))for(const t in this._tiles){const i=this._tiles[t];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=e.f.now())return!0}return!1}setFeatureState(e,t,i){this._state.updateState(e=e||"_geojsonTileLayer",t,i)}removeFeatureState(e,t,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,i)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,i){const r=this._tiles[e];r&&r.setDependencies(t,i)}reloadTilesForDependencies(e,t){for(const i in this._tiles)this._tiles[i].hasDependency(e,t)&&this._reloadTile(+i,"reloading");this._cache.filter((i=>!i.hasDependency(e,t)))}_preloadTiles(t,i){if(!this._sourceLoaded){const e=()=>{this._sourceLoaded&&(this._source.off("data",e),this._preloadTiles(t,i))};return void this._source.on("data",e)}const r=new Map,n=Array.isArray(t)?t:[t],a=this.map.painter.terrain,o=this.usedForTerrain&&a?a.getScaledDemTileSize():this._source.tileSize;for(const e of n){const t=e.coveringTiles({tileSize:o,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const e of t)r.set(e.key,e);this.usedForTerrain&&e.updateElevation(!1)}const s=Array.from(r.values());e.b4(s,((e,t)=>{const i=new Nt(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(i,(e=>{"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),t(e,i)}))}),i)}}function Xt(e,t){const i=Math.abs(2*e.wrap)-+(e.wrap<0),r=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||r-i||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Yt(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function Jt(e,t){const i=1<<e.z;return[e.x/i+t,(e.x+1)/i+t]}Qt.maxOverzooming=10,Qt.maxUnderzooming=3;class Kt{constructor(e){this.style=e,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const e=!1,t=!1;for(const i in this.style._mergedLayers){const r=this.style._mergedLayers[i];if("fill-extrusion"===r.type)this.layers.push({layer:r,visible:e,visibilityChanged:t});else if("model"===r.type){const i=this.style.getLayerSource(r);i&&"batched-model"===i.type&&this.layers.push({layer:r,visible:e,visibilityChanged:t})}}}onNewFrame(e){this.layersGotHidden=!1;for(const t of this.layers){const i=t.layer;let r=!1;"fill-extrusion"===i.type?r=!i.isHidden(e)&&i.paint.get("fill-extrusion-opacity")>0:"model"===i.type&&(r=!i.isHidden(e)&&i.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!r&&t.visible,t.visible=r}}updateZOffset(e,t){this.currentBuildingBuckets=[];for(const r of this.layers){const e=r.layer,i=this.style.getLayerSourceCache(e);let n=1;"fill-extrusion"===e.type&&(n=r.visible?e.paint.get("fill-extrusion-vertical-scale"):0);let a=i?i.getTile(t):null;if(!a&&i&&t.canonical.z>i.getSource().minzoom){let e=t.scaledTo(Math.min(i.getSource().maxzoom,t.overscaledZ-1));for(;e.overscaledZ>=i.getSource().minzoom&&(a=i.getTile(e),!a&&0!==e.overscaledZ);)e=e.scaledTo(e.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:a?a.getBucket(e):null,tileID:a?a.tileID:t,verticalScale:n})}e.hasAnyZOffset=!1;let i=!1;for(let r=0;r<e.symbolInstances.length;r++){const n=e.symbolInstances.get(r),a=n.zOffset,o=this._getHeightAtTileOffset(t,n.tileAnchorX,n.tileAnchorY);n.zOffset=o!==Number.NEGATIVE_INFINITY?o:a,i||a===n.zOffset||(i=!0),e.hasAnyZOffset||0===n.zOffset||(e.hasAnyZOffset=!0)}i&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,i,r,n){let a=i,o=r;if(t.canonical.z!==n.canonical.z){const s=n.canonical,l=1/(1<<t.canonical.z-s.z);a=(i+t.canonical.x*e.Y)*l-s.x*e.Y|0,o=(r+t.canonical.y*e.Y)*l-s.y*e.Y|0}return{tileX:a,tileY:o}}_getHeightAtTileOffset(e,t,i){let r,n;for(let a=0;a<this.layers.length;++a){if("fill-extrusion"!==this.layers[a].layer.type)continue;const{bucket:o,tileID:s,verticalScale:l}=this.currentBuildingBuckets[a];if(!o)continue;const{tileX:c,tileY:h}=this._mapCoordToOverlappingTile(e,t,i,s),u=o.getHeightAtTileCoord(c,h);u&&void 0!==u.height&&(u.hidden?r=u.height:n=Math.max(u.height*l,n||0))}if(void 0!==n)return n;for(let a=0;a<this.layers.length;++a){const n=this.layers[a];if("model"!==n.layer.type||!n.visible)continue;const{bucket:o,tileID:s}=this.currentBuildingBuckets[a];if(!o)continue;const{tileX:l,tileY:c}=this._mapCoordToOverlappingTile(e,t,i,s),h=o.getHeightAtTileCoord(l,c);if(h&&!h.hidden)return void 0===h.height&&void 0!==r?Math.min(h.maxHeight,r)*h.verticalScale:h.height?h.height*h.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function $t(t,i){const r={};for(const e in t)"ref"!==e&&(r[e]=t[e]);return e.b5.forEach((e=>{e in i&&(r[e]=i[e])})),r}function ei(e){e=e.slice();const t=Object.create(null);for(let i=0;i<e.length;i++)t[e[i].id]=e[i];for(let i=0;i<e.length;i++)"ref"in e[i]&&(e[i]=$t(e[i],t[e[i].ref]));return e}const ti={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function ii(e,t,i){i.push({command:ti.addSource,args:[e,t[e]]})}function ri(e,t,i){t.push({command:ti.removeSource,args:[e]}),i[e]=!0}function ni(e,t,i,r){ri(e,i,r),ii(e,t,i)}function ai(e,i,r){let n;for(n in e[r])if(e[r].hasOwnProperty(n)&&"data"!==n&&!t(e[r][n],i[r][n]))return!1;for(n in i[r])if(i[r].hasOwnProperty(n)&&"data"!==n&&!t(e[r][n],i[r][n]))return!1;return!0}function oi(e,i,r,n,a,o){let s;for(s in i=i||{},e=e||{})e.hasOwnProperty(s)&&(t(e[s],i[s])||r.push({command:o,args:[n,s,i[s],a]}));for(s in i)i.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t(e[s],i[s])||r.push({command:o,args:[n,s,i[s],a]}))}function si(e){return e.id}function li(e,t){return e[t.id]=t,e}class ci{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let i=1;i<this.points.length;i++)this._distances[i]=this._distances[i-1]+this.points[i].dist(this.points[i-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.ad(t,0,1);let i=1,r=this._distances[i];const n=t*this.paddedLength+this.padding;for(;r<n&&i<this._distances.length;)r=this._distances[++i];const a=i-1,o=this._distances[a],s=r-o,l=s>0?(n-o)/s:0;return this.points[a].mult(1-l).add(this.points[i].mult(l))}}class hi{constructor(e,t,i){const r=this.boxCells=[],n=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(t/i);for(let a=0;a<this.xCellCount*this.yCellCount;a++)r.push([]),n.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,i,r,n){this._forEachCell(t,i,r,n,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(n)}insertCircle(e,t,i,r){this._forEachCell(t-r,i-r,t+r,i+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(i),this.circles.push(r)}_insertBoxCell(e,t,i,r,n,a){this.boxCells[n].push(a)}_insertCircleCell(e,t,i,r,n,a){this.circleCells[n].push(a)}_query(e,t,i,r,n,a){if(i<0||e>this.width||r<0||t>this.height)return!n&&[];const o=[];if(e<=0&&t<=0&&this.width<=i&&this.height<=r){if(n)return!0;for(let e=0;e<this.boxKeys.length;e++)o.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],i=this.circles[3*e+1],r=this.circles[3*e+2];o.push({key:this.circleKeys[e],x1:t-r,y1:i-r,x2:t+r,y2:i+r})}return a?o.filter(a):o}return this._forEachCell(e,t,i,r,this._queryCell,o,{hitTest:n,seenUids:{box:{},circle:{}}},a),n?o.length>0:o}_queryCircle(e,t,i,r,n){const a=e-i,o=e+i,s=t-i,l=t+i;if(o<0||a>this.width||l<0||s>this.height)return!r&&[];const c=[];return this._forEachCell(a,s,o,l,this._queryCellCircle,c,{hitTest:r,circle:{x:e,y:t,radius:i},seenUids:{box:{},circle:{}}},n),r?c.length>0:c}query(e,t,i,r,n){return this._query(e,t,i,r,!1,n)}hitTest(e,t,i,r,n){return this._query(e,t,i,r,!0,n)}hitTestCircle(e,t,i,r){return this._queryCircle(e,t,i,!0,r)}_queryCell(e,t,i,r,n,a,o,s){const l=o.seenUids,c=this.boxCells[n];if(null!==c){const n=this.bboxes;for(const h of c)if(!l.box[h]){l.box[h]=!0;const c=4*h;if(e<=n[c+2]&&t<=n[c+3]&&i>=n[c+0]&&r>=n[c+1]&&(!s||s(this.boxKeys[h]))){if(o.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[h],x1:n[c],y1:n[c+1],x2:n[c+2],y2:n[c+3]})}}}const h=this.circleCells[n];if(null!==h){const n=this.circles;for(const c of h)if(!l.circle[c]){l.circle[c]=!0;const h=3*c;if(this._circleAndRectCollide(n[h],n[h+1],n[h+2],e,t,i,r)&&(!s||s(this.circleKeys[c]))){if(o.hitTest)return a.push(!0),!0;{const e=n[h],t=n[h+1],i=n[h+2];a.push({key:this.circleKeys[c],x1:e-i,y1:t-i,x2:e+i,y2:t+i})}}}}}_queryCellCircle(e,t,i,r,n,a,o,s){const l=o.circle,c=o.seenUids,h=this.boxCells[n];if(null!==h){const e=this.bboxes;for(const t of h)if(!c.box[t]){c.box[t]=!0;const i=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[i+0],e[i+1],e[i+2],e[i+3])&&(!s||s(this.boxKeys[t])))return a.push(!0),!0}}const u=this.circleCells[n];if(null!==u){const e=this.circles;for(const t of u)if(!c.circle[t]){c.circle[t]=!0;const i=3*t;if(this._circlesCollide(e[i],e[i+1],e[i+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[t])))return a.push(!0),!0}}}_forEachCell(e,t,i,r,n,a,o,s){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),h=this._convertToXCellCoord(i),u=this._convertToYCellCoord(r);for(let d=l;d<=h;d++)for(let l=c;l<=u;l++)if(n.call(this,e,t,i,r,this.xCellCount*l+d,a,o,s))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,i,r,n,a){const o=r-e,s=n-t,l=i+a;return l*l>o*o+s*s}_circleAndRectCollide(e,t,i,r,n,a,o){const s=(a-r)/2,l=Math.abs(e-(r+s));if(l>s+i)return!1;const c=(o-n)/2,h=Math.abs(t-(n+c));if(h>c+i)return!1;if(l<=s||h<=c)return!0;const u=l-s,d=h-c;return u*u+d*d<=i*i}}const ui={unknown:0,flipRequired:1,flipNotRequired:2},di=Math.tan(85*Math.PI/180);function pi(t,i,r,n,a,o,s){const l=e.a9.create();if(r)if("globe"===o.name){const t=e.b6(a,i);e.a9.multiply(l,l,t)}else{const t=e.b7.invert([],s);l[0]=t[0],l[1]=t[1],l[4]=t[2],l[5]=t[3],n||e.a9.rotateZ(l,l,a.angle)}else e.a9.multiply(l,a.labelPlaneMatrix,t);return l}function fi(e,t,i,r,n,a,o){const s=pi(e,t,i,r,n,a,o);return"globe"===a.name&&i||(s[2]=s[6]=s[10]=s[14]=0),s}function mi(t,i,r,n,a,o,s){if(r){if("globe"===o.name){const l=pi(t,i,r,n,a,o,s);return e.a9.invert(l,l),e.a9.multiply(l,t,l),l}{const i=e.a9.clone(t),r=e.a9.identity([]);return r[0]=s[0],r[1]=s[1],r[4]=s[2],r[5]=s[3],e.a9.multiply(i,i,r),n||e.a9.rotateZ(i,i,-a.angle),i}}return a.glCoordMatrix}function gi(t,i,r,n){const a=[t,i,r,1];r?e.aa.transformMat4(a,a,n):Ai(a,a,n);const o=a[3];return a[0]/=o,a[1]/=o,a[2]/=o,a}function _i(e,t){return Math.min(.5+e/t*.5,1.5)}function yi(e,t){const i=e[0]/e[3],r=e[1]/e[3];return i>=-t[0]&&i<=t[0]&&r>=-t[1]&&r<=t[1]}function vi(t,i,r,n,a,o,s,l,c,h){const u=r.transform,d=n?t.textSizeData:t.iconSizeData,p=e.b8(d,r.transform.zoom),f="globe"===u.projection.name,m=[256/r.width*2+1,256/r.height*2+1],g=n?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;g.clear();let _=null;f&&(_=n?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const y=t.lineVertexArray,v=n?t.text.placedSymbolArray:t.icon.placedSymbolArray,x=r.transform.width/r.transform.height;let b,w=!1;for(let S=0;S<v.length;S++){const n=v.get(S),{numGlyphs:f,writingMode:T}=n;if(T!==e.b9.vertical||w||b===e.b9.horizontal||(w=!0),b=T,(n.hidden||T===e.b9.vertical)&&!w){Mi(f,g);continue}w=!1;const E=new e.P(n.tileAnchorX,n.tileAnchorY);let{x:M,y:A,z:P}=u.projection.projectTilePoint(E.x,E.y,h.canonical);if(c){const[e,t,i]=c(E);M+=e,A+=t,P+=i}const C=[M,A,P,1];if(e.aa.transformMat4(C,C,i),!yi(C,m)){Mi(f,g);continue}const I=C[3],k=_i(r.transform.getCameraToCenterDistance(u.projection),I),D=e.ba(d,p,n),R=s?D/k:D*k,L=gi(M,A,P,a);if(L[3]<=0){Mi(f,g);continue}let z={};const F=s?null:c,O=wi(n,R,!1,l,i,a,o,t.glyphOffsetArray,y,g,_,L,E,z,x,F,u.projection,h,s);w=O.useVertical,F&&O.needsFlipping&&(z={}),(O.notEnoughRoom||w||O.needsFlipping&&wi(n,R,!0,l,i,a,o,t.glyphOffsetArray,y,g,_,L,E,z,x,F,u.projection,h,s).notEnoughRoom)&&Mi(f,g)}n?(t.text.dynamicLayoutVertexBuffer.updateData(g),_&&t.text.globeExtVertexBuffer&&t.text.globeExtVertexBuffer.updateData(_)):(t.icon.dynamicLayoutVertexBuffer.updateData(g),_&&t.icon.globeExtVertexBuffer&&t.icon.globeExtVertexBuffer.updateData(_))}function xi(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m){const{lineStartIndex:g,glyphStartIndex:_,segment:y}=s,v=_+s.numGlyphs,x=g+s.lineLength,b=t.getoffsetX(_),w=t.getoffsetX(v-1),S=Ei(e*b,i,r,n,a,o,y,g,x,l,c,h,u,d,!0,p,f,m);if(!S)return null;const T=Ei(e*w,i,r,n,a,o,y,g,x,l,c,h,u,d,!0,p,f,m);return T?{first:S,last:T}:null}function bi(t,i,r,n){return t===e.b9.horizontal&&Math.abs(n)>Math.abs(r)?{useVertical:!0}:t===e.b9.vertical?n>0?{needsFlipping:!0}:null:i!==ui.unknown&&function(e,t){return 0===e||Math.abs(t/e)>di}(r,n)?i===ui.flipRequired?{needsFlipping:!0}:null:r<0?{needsFlipping:!0}:null}function wi(t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,v){const x=i/24,b=t.lineOffsetX*x,w=t.lineOffsetY*x,{lineStartIndex:S,glyphStartIndex:T,numGlyphs:E,segment:M,writingMode:A,flipState:P}=t,C=S+t.lineLength,I=t=>{if(u){const[i,r,n]=t.up,a=h.length;e.bb(u,a+0,i,r,n),e.bb(u,a+1,i,r,n),e.bb(u,a+2,i,r,n),e.bb(u,a+3,i,r,n)}const[i,r,n]=t.point;e.bc(h,i,r,n,t.angle)};if(E>1){const e=xi(x,l,b,w,r,d,p,t,c,o,f,g,!1,_,y,v);if(!e)return{notEnoughRoom:!0};if(n&&!r){let[i,r,n]=e.first.point,[a,o,l]=e.last.point;[i,r]=gi(i,r,n,s),[a,o]=gi(a,o,l,s);const c=bi(A,P,(a-i)*m,o-r);if(t.flipState=c&&c.needsFlipping?ui.flipRequired:ui.flipNotRequired,c)return c}I(e.first);for(let t=T+1;t<T+E-1;t++){const e=Ei(x*l.getoffsetX(t),b,w,r,d,p,M,S,C,c,o,f,g,!1,!1,_,y,v);if(!e)return h.length-=4*(t-T),{notEnoughRoom:!0};I(e)}I(e.last)}else{if(n&&!r){const i=gi(p.x,p.y,0,a),r=S+M+1,n=new e.P(c.getx(r),c.gety(r)),o=gi(n.x,n.y,0,a),s=o[3]>0?o:Ti(p,n,i,1,a,void 0,_,y.canonical),l=bi(A,P,(s[0]-i[0])*m,s[1]-i[1]);if(t.flipState=l&&l.needsFlipping?ui.flipRequired:ui.flipNotRequired,l)return l}const i=Ei(x*l.getoffsetX(T),b,w,r,d,p,M,S,C,c,o,f,g,!1,!1,_,y,v);if(!i)return{notEnoughRoom:!0};I(i)}return{}}function Si(e,t,i,r,n){const{x:a,y:o,z:s}=r.projectTilePoint(e.x,e.y,t);if(!n)return gi(a,o,s,i);const[l,c,h]=n(e);return gi(a+l,o+c,s+h,i)}function Ti(t,i,r,n,a,o,s,l){const c=Si(t.sub(i)._unit()._add(t),l,a,s,o);return e.Q.sub(c,r,c),e.Q.normalize(c,c),e.Q.scaleAndAdd(c,r,c,n)}function Ei(t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y){const v=n?t-i:t+i;let x=v>0?1:-1,b=0;n&&(x*=-1,b=Math.PI),x<0&&(b+=Math.PI);let w=l+s+(x>0?0:1)|0,S=a,T=a,E=0,M=0;const A=Math.abs(v),P=[],C=[];let I=o,k=I;const D=()=>Ti(k,I,T,A-E+1,u,p,g,_.canonical);for(;E+M<=A;){if(w+=x,w<l||w>=c)return null;if(T=S,k=I,P.push(T),f&&C.push(k),I=new e.P(h.getx(w),h.gety(w)),S=d[w],!S){const e=Si(I,_.canonical,u,g,p);S=e[3]>0?d[w]=e:D()}E+=M,M=e.Q.distance(T,S)}m&&p&&(d[w]&&(S=D(),M=e.Q.distance(T,S)),d[w]=S);const R=(A-E)/M,L=I.sub(k)._mult(R)._add(k),z=e.Q.sub([],S,T),F=e.Q.scaleAndAdd([],T,z,R);let O=[0,0,1],B=z[0],N=z[1];if(y&&(O=g.upVector(_.canonical,L.x,L.y),0!==O[0]||0!==O[1]||1!==O[2])){const t=[O[2],0,-O[0]],i=e.Q.cross([],O,t);e.Q.normalize(t,t),e.Q.normalize(i,i),B=e.Q.dot(z,t),N=e.Q.dot(z,i)}if(r){const t=e.Q.cross([],O,z);e.Q.normalize(t,t),e.Q.scaleAndAdd(F,F,t,r*x)}const V=b+Math.atan2(N,B);return P.push(F),f&&C.push(L),{point:F,angle:V,path:P,tilePath:C,up:O}}function Mi(e,t){const i=t.length,r=i+4*e;t.resize(r),t.float32.fill(-1/0,4*i,4*r)}function Ai(e,t,i){const r=t[0],n=t[1];return e[0]=i[0]*r+i[4]*n+i[12],e[1]=i[1]*r+i[5]*n+i[13],e[3]=i[3]*r+i[7]*n+i[15],e}const Pi=100;class Ci{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new hi(e.width+200,e.height+200,25),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new hi(e.width+200,e.height+200,25);this.transform=e,this.grid=i,this.ignoredGrid=r,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Pi,this.screenBottomBoundary=e.height+Pi,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(e,t,i,r,n,a,o,s){let l=i.projectedAnchorX,c=i.projectedAnchorY,h=i.projectedAnchorZ;const u=i.elevation,d=i.tileID,p=e.getProjection();if(u&&d){const[e,t,r]=p.upVector(d.canonical,i.tileAnchorX,i.tileAnchorY),n=p.upVectorScale(d.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;l+=e*u*n,c+=t*u*n,h+=r*u*n}const f=this.projectAndGetPerspectiveRatio(o,l,c,h,i.tileID,"globe"===p.name||!!u||this.transform.pitch>0,p),m=a*f.perspectiveRatio,g=(i.x1*t+r.x-i.padding)*m+f.point.x,_=(i.y1*t+r.y-i.padding)*m+f.point.y,y=(i.x2*t+r.x+i.padding)*m+f.point.x,v=(i.y2*t+r.y+i.padding)*m+f.point.y,x=f.perspectiveRatio<=.55||f.occluded;return!this.isInsideGrid(g,_,y,v)||!n&&this.grid.hitTest(g,_,y,v,s)||x?{box:[],offscreen:!1,occluded:f.occluded}:{box:[g,_,y,v],offscreen:this.isOffscreen(g,_,y,v),occluded:!1}}placeCollisionCircles(t,i,r,n,a,o,s,l,c,h,u,d,p,f,m){const g=[],_=this.transform.elevation,y=t.getProjection(),v=_?_.getAtTileOffsetFunc(m,this.transform.center.lat,this.transform.worldSize,y):null,x=new e.P(r.tileAnchorX,r.tileAnchorY);let{x:b,y:w,z:S}=y.projectTilePoint(x.x,x.y,m.canonical);if(v){const[e,t,i]=v(x);b+=e,w+=t,S+=i}const T="globe"===y.name,E=this.projectAndGetPerspectiveRatio(s,b,w,S,m,T||!!_||this.transform.pitch>0,y),{perspectiveRatio:M}=E,A=(u?o/M:o*M)/e.bf,P=gi(b,w,S,l),C=E.signedDistanceFromCamera>0?xi(A,a,r.lineOffsetX*A,r.lineOffsetY*A,!1,P,x,r,n,l,{},_&&!u?v:null,u&&!!_,y,m,u):null;let I=!1,k=!1,D=!0;if(C&&!E.occluded){const t=.5*p*M+f,r=new e.P(-100,-100),n=new e.P(this.screenRightBoundary,this.screenBottomBoundary),a=new ci,{first:o,last:s}=C,l=o.path.length;let u=[];for(let e=l-1;e>=1;e--)u.push(o.path[e]);for(let e=1;e<s.path.length;e++)u.push(s.path[e]);const m=2.5*t;c&&(u=u.map(((e,t)=>{let[i,r,n]=e;return v&&!T&&(n=v(t<l-1?o.tilePath[l-1-t]:s.tilePath[t-l+2])[2]),gi(i,r,n,c)})),u.some((e=>e[3]<=0))&&(u=[]));let _=[];if(u.length>0){let t=1/0,i=-1/0,a=1/0,o=-1/0;for(const e of u)t=Math.min(t,e[0]),a=Math.min(a,e[1]),i=Math.max(i,e[0]),o=Math.max(o,e[1]);i>=r.x&&t<=n.x&&o>=r.y&&a<=n.y&&(_=[u.map((t=>new e.P(t[0],t[1])))],(t<r.x||i>n.x||a<r.y||o>n.y)&&(_=e.bd(_,r.x,r.y,n.x,n.y)))}for(const e of _){a.reset(e,.25*t);let r=0;r=a.length<=.5*t?1:Math.ceil(a.paddedLength/m)+1;for(let e=0;e<r;e++){const n=e/Math.max(r-1,1),o=a.lerp(n),s=o.x+Pi,l=o.y+Pi;g.push(s,l,t,0);const c=s-t,u=l-t,p=s+t,f=l+t;if(D=D&&this.isOffscreen(c,u,p,f),k=k||this.isInsideGrid(c,u,p,f),!i&&this.grid.hitTestCircle(s,l,t,d)&&(I=!0,!h))return{circles:[],offscreen:!1,collisionDetected:I,occluded:!1}}}}return{circles:!h&&I||!k?[]:g,offscreen:D,collisionDetected:I,occluded:E.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const i=[];let r=1/0,n=1/0,a=-1/0,o=-1/0;for(const h of t){const t=new e.P(h.x+Pi,h.y+Pi);r=Math.min(r,t.x),n=Math.min(n,t.y),a=Math.max(a,t.x),o=Math.max(o,t.y),i.push(t)}const s=this.grid.query(r,n,a,o).concat(this.ignoredGrid.query(r,n,a,o)),l={},c={};for(const h of s){const t=h.key;if(void 0===l[t.bucketInstanceId]&&(l[t.bucketInstanceId]={}),l[t.bucketInstanceId][t.featureIndex])continue;const r=[new e.P(h.x1,h.y1),new e.P(h.x2,h.y1),new e.P(h.x2,h.y2),new e.P(h.x1,h.y2)];e.be(i,r)&&(l[t.bucketInstanceId][t.featureIndex]=!0,void 0===c[t.bucketInstanceId]&&(c[t.bucketInstanceId]=[]),c[t.bucketInstanceId].push(t.featureIndex))}return c}insertCollisionBox(e,t,i,r,n){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:r,collisionGroupID:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,i,r,n){const a=t?this.ignoredGrid:this.grid,o={bucketInstanceId:i,featureIndex:r,collisionGroupID:n};for(let s=0;s<e.length;s+=4)a.insertCircle(o,e[s],e[s+1],e[s+2])}projectAndGetPerspectiveRatio(t,i,r,n,a,o,s){const l=[i,r,n,1];let c=!1;if(n||this.transform.pitch>0){if(e.aa.transformMat4(l,l,t),this.fogState&&a&&"globe"!==s.name){const t=function(t,i,r,n,a,o){const s=o.calculateFogTileMatrix(a),l=[i,r,n];return e.Q.transformMat4(l,l,s),fe(t,e.Q.length(l),o.pitch,o._fov)}(this.fogState,i,r,n,a.toUnwrapped(),this.transform);c=t>.9}}else Ai(l,l,t);const h=l[3];return{point:new e.P((l[0]/h+1)/2*this.transform.width+Pi,(-l[1]/h+1)/2*this.transform.height+Pi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(s)/h*.5,1.5),signedDistanceFromCamera:h,occluded:o&&l[2]>h||c}}isOffscreen(e,t,i,r){return i<Pi||e>=this.screenRightBoundary||r<Pi||t>this.screenBottomBoundary}isInsideGrid(e,t,i,r){return i>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const t=e.a9.identity([]);return e.a9.translate(t,t,[-100,-100,0]),t}}function Ii(t,i,r){const n=i.createTileMatrix(t,t.worldSize,r.toUnwrapped());return e.a9.multiply(new Float32Array(16),t.projMatrix,n)}function ki(e,t,i){if(t.projection.name===i.projection.name)return e.projMatrix;const r=i.clone();return r.setProjection(t.projection),Ii(r,t.getProjection(),e)}function Di(e,t,i){return t.name===i.projection.name?e.projMatrix:Ii(i,t,e)}class Ri{constructor(e,t,i,r){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):r&&i?1:0,this.placed=i}isHidden(){return 0===this.opacity&&!this.placed}}class Li{constructor(e,t,i,r,n){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.text=new Ri(e?e.text:null,t,i,n),this.icon=new Ri(e?e.icon:null,t,r,n),this.clipped=a}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class zi{constructor(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.text=e,this.icon=t,this.skipFade=i,this.clipped=r}}class Fi{constructor(){this.invProjMatrix=e.a9.create(),this.viewportMatrix=e.a9.create(),this.circles=[]}}class Oi{constructor(e,t,i,r,n){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=i,this.bucketIndex=r,this.tileID=n}}class Bi{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function Ni(t,i,r,n,a){const{horizontalAlign:o,verticalAlign:s}=e.bi(t),l=-(o-.5)*i,c=-(s-.5)*r,h=e.bh(t,n);return new e.P(l+h[0]*a,c+h[1]*a)}function Vi(t,i,r,n,a){const o=new e.P(t,i);return r&&o._rotate(n?a:-a),o}class ji{constructor(e,t,i,r,n,a){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new Ci(this.transform,n),this.buildingIndex=a,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new Bi(i),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,i,r,n){const a=r.getBucket(i),o=r.latestFeatureIndex;if(!a||!o||i.fqid!==a.layerIds[0])return;const s=a.layers[0].layout,l=r.collisionBoxArray,c=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),h=r.tileSize/e.Y,u=r.tileID.toUnwrapped();this.transform.setProjection(a.projection);const d=(p=r.tileID,f=a.getProjection(),m=this.transform,f.name===this.projection?m.calculateProjMatrix(p.toUnwrapped()):Ii(m,f,p));var p,f,m;const g="map"===s.get("text-pitch-alignment"),_="map"===s.get("text-rotation-alignment");i.compileFilter();const y=i.dynamicFilter(),v=i.dynamicFilterNeedsFeature(),x=this.transform.calculatePixelsToTileUnitsMatrix(r),b=fi(d,r.tileID.canonical,g,_,this.transform,a.getProjection(),x);let w=null;if(g){const t=mi(d,r.tileID.canonical,g,_,this.transform,a.getProjection(),x);w=e.a9.multiply([],this.transform.labelPlaneMatrix,t)}let S=null;y&&r.latestFeatureIndex&&(S={unwrappedTileID:u,dynamicFilter:y,dynamicFilterNeedsFeature:v,featureIndex:r.latestFeatureIndex}),this.retainedQueryData[a.bucketInstanceId]=new Oi(a.bucketInstanceId,o,a.sourceLayerIndex,a.index,r.tileID);const T={bucket:a,layout:s,posMatrix:d,textLabelPlaneMatrix:b,labelToScreenMatrix:w,clippingData:S,scale:c,textPixelRatio:h,holdingForFade:r.holdingForFade(),collisionBoxArray:l,partiallyEvaluatedTextSize:e.b8(a.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:e.b8(a.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(a.sourceID)};if(n)for(const e of a.sortKeyRanges){const{sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n}=e;t.push({sortKey:i,symbolInstanceStart:r,symbolInstanceEnd:n,parameters:T})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:a.symbolInstances.length,parameters:T})}attemptAnchorPlacement(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_){const{textOffset0:y,textOffset1:v,crossTileID:x}=u,b=[y,v],w=Ni(e,i,r,b,n),S=this.collisionIndex.placeCollisionBox(p,n,t,Vi(w.x,w.y,a,o,this.transform.angle),h,s,l,c.predicate);if(m){const e=p.getSymbolInstanceIconSize(_,this.transform.zoom,u.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(p,e,m,Vi(w.x,w.y,a,o,this.transform.angle),h,s,l,c.predicate).box.length)return}if(S.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[x]&&this.prevPlacement.placements[x]&&this.prevPlacement.placements[x].text&&(t=this.prevPlacement.variableOffsets[x].anchor),this.variableOffsets[x]={textOffset:b,width:i,height:r,anchor:e,textScale:n,prevAnchor:t},this.markUsedJustification(p,e,u,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,u),this.placedOrientations[x]=f),{shift:w,placedGlyphBoxes:S}}}placeLayerBucketPart(t,i,r,n){const{bucket:a,layout:o,posMatrix:s,textLabelPlaneMatrix:l,labelToScreenMatrix:c,clippingData:h,textPixelRatio:u,holdingForFade:d,collisionBoxArray:p,partiallyEvaluatedTextSize:f,partiallyEvaluatedIconSize:m,collisionGroup:g}=t.parameters,_=o.get("text-optional"),y=o.get("icon-optional"),v=o.get("text-allow-overlap"),x=o.get("icon-allow-overlap"),b="map"===o.get("text-rotation-alignment"),w="map"===o.get("text-pitch-alignment"),S="viewport-y"===o.get("symbol-z-order"),T=o.get("symbol-z-elevate");this.transform.setProjection(a.projection);let E=v&&(x||!a.hasIconData()||y),M=x&&(v||!a.hasTextData()||_);!a.collisionArrays&&p&&a.deserializeCollisionBoxes(p),r&&n&&a.updateCollisionDebugBuffers(this.transform.zoom,p);const A=(t,n,p)=>{const{crossTileID:S,numVerticalGlyphVertices:T}=t;if(h){const r={zoom:this.transform.zoom,pitch:this.transform.pitch};let n=null;if(h.dynamicFilterNeedsFeature){const e=this.retainedQueryData[a.bucketInstanceId];n=h.featureIndex.loadFeature({featureIndex:t.featureIndex,bucketIndex:e.bucketIndex,sourceLayerIndex:e.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,h.dynamicFilter)(r,n,this.retainedQueryData[a.bucketInstanceId].tileID.canonical,new e.P(t.tileAnchorX,t.tileAnchorY),this.transform.calculateDistanceTileData(h.unwrappedTileID)))return this.placements[S]=new zi(!1,!1,!1,!0),void i.add(S)}if(i.has(S))return;if(d)return void(this.placements[S]=new zi(!1,!1,!1));let A=!1,P=!1,C=!0,I=!1,k=!1,D=null,R={box:null,offscreen:null,occluded:null},L={box:null,offscreen:null,occluded:null},z=null,F=null,O=null,B=0,N=0,V=0;p.textFeatureIndex?B=p.textFeatureIndex:t.useRuntimeCollisionCircles&&(B=t.featureIndex),p.verticalTextFeatureIndex&&(N=p.verticalTextFeatureIndex);const j=e=>{e.tileID=this.retainedQueryData[a.bucketInstanceId].tileID;const i=this.transform.elevation;e.elevation=t.zOffset+(i?i.getAtTileOffset(e.tileID,e.tileAnchorX,e.tileAnchorY):0)},U=p.textBox;if(U){j(U);const i=i=>{let r=e.b9.horizontal;if(a.allowVerticalPlacement&&!i&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[S];e&&(this.placedOrientations[S]=e,r=e,this.markUsedOrientation(a,r,t))}return r},r=(t,i)=>{if(a.allowVerticalPlacement&&T>0&&p.verticalTextBox){for(const r of a.writingModes)if(r===e.b9.vertical?(R=i(),L=R):R=t(),R&&R.box&&R.box.length)break}else R=t()};if(o.get("text-variable-anchor")){let l=o.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[S]){const e=this.prevPlacement.variableOffsets[S];l.indexOf(e.anchor)>0&&(l=l.filter((t=>t!==e.anchor)),l.unshift(e.anchor))}const c=(e,i,r)=>{const o=a.getSymbolInstanceTextSize(f,t,this.transform.zoom,n),c=(e.x2-e.x1)*o+2*e.padding,h=(e.y2-e.y1)*o+2*e.padding,d=t.hasIconTextFit&&!x?i:null;d&&j(d);let p={box:[],offscreen:!1,occluded:!1};const _=v?2*l.length:l.length;for(let y=0;y<_;++y){const i=this.attemptAnchorPlacement(l[y%l.length],e,c,h,o,b,w,u,s,g,y>=l.length,t,n,a,r,d,f,m);if(i&&(p=i.placedGlyphBoxes,p&&p.box&&p.box.length)){A=!0,D=i.shift;break}}return p};r((()=>c(U,p.iconBox,e.b9.horizontal)),(()=>{const t=p.verticalTextBox;return t&&j(t),a.allowVerticalPlacement&&!(R&&R.box&&R.box.length)&&T>0&&t?c(t,p.verticalIconBox,e.b9.vertical):{box:null,offscreen:null,occluded:null}})),R&&(A=R.box,C=R.offscreen,I=R.occluded);const h=i(!(!R||!R.box));if(!A&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[S];e&&(this.variableOffsets[S]=e,this.markUsedJustification(a,e.anchor,t,h))}}else{const o=(i,r)=>{const o=a.getSymbolInstanceTextSize(f,t,this.transform.zoom,n),l=this.collisionIndex.placeCollisionBox(a,o,i,new e.P(0,0),v,u,s,g.predicate);return l&&l.box&&l.box.length&&(this.markUsedOrientation(a,r,t),this.placedOrientations[S]=r),l};r((()=>o(U,e.b9.horizontal)),(()=>{const t=p.verticalTextBox;return a.allowVerticalPlacement&&T>0&&t?(j(t),o(t,e.b9.vertical)):{box:null,offscreen:null,occluded:null}})),i(!!(R&&R.box&&R.box.length))}}if(z=R,A=z&&z.box&&z.box.length>0,C=z&&z.offscreen,I=z&&z.occluded,t.useRuntimeCollisionCircles){const i=a.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex),n=e.ba(a.textSizeData,f,i),h=o.get("text-padding");F=this.collisionIndex.placeCollisionCircles(a,v,i,a.lineVertexArray,a.glyphOffsetArray,n,s,l,c,r,w,g.predicate,t.collisionCircleDiameter*n/e.bf,h,this.retainedQueryData[a.bucketInstanceId].tileID),A=v||F.circles.length>0&&!F.collisionDetected,C=C&&F.offscreen,I=F.occluded}if(p.iconFeatureIndex&&(V=p.iconFeatureIndex),p.iconBox){const i=i=>{j(i);const r=t.hasIconTextFit&&D?Vi(D.x,D.y,b,w,this.transform.angle):new e.P(0,0),n=a.getSymbolInstanceIconSize(m,this.transform.zoom,t.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(a,n,i,r,x,u,s,g.predicate)};L&&L.box&&L.box.length&&p.verticalIconBox?(O=i(p.verticalIconBox),P=O.box.length>0):(O=i(p.iconBox),P=O.box.length>0),C=C&&O.offscreen,k=O.occluded}const G=_||0===t.numHorizontalGlyphVertices&&0===T,q=y||0===t.numIconVertices;if(G||q?q?G||(P=P&&A):A=P&&A:P=A=P&&A,A&&z&&z.box&&this.collisionIndex.insertCollisionBox(z.box,o.get("text-ignore-placement"),a.bucketInstanceId,L&&L.box&&N?N:B,g.ID),P&&O&&this.collisionIndex.insertCollisionBox(O.box,o.get("icon-ignore-placement"),a.bucketInstanceId,V,g.ID),F&&(A&&this.collisionIndex.insertCollisionCircles(F.circles,o.get("text-ignore-placement"),a.bucketInstanceId,B,g.ID),r)){const e=a.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new Fi);for(let i=0;i<F.circles.length;i+=4)t.circles.push(F.circles[i+0]),t.circles.push(F.circles[i+1]),t.circles.push(F.circles[i+2]),t.circles.push(F.collisionDetected?1:0)}const H="globe"!==a.projection.name;E=E&&(H||!I),M=M&&(H||!k),this.placements[S]=new zi(A||E,P||M,C||a.justReloaded),i.add(S)};if(T&&this.buildingIndex&&(this.buildingIndex.updateZOffset(a,this.retainedQueryData[a.bucketInstanceId].tileID),a.updateZOffset()),S){const t=a.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const i=t[e];A(a.symbolInstances.get(i),i,a.collisionArrays[i])}a.hasAnyZOffset&&e.w("".concat(a.layerIds[0]," layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y"))}else if(a.hasAnyZOffset){const e=a.getSortedIndexesByZOffset();for(let t=0;t<e.length;++t){const i=e[t];A(a.symbolInstances.get(i),i,a.collisionArrays[i])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)A(a.symbolInstances.get(e),e,a.collisionArrays[e]);if(r&&a.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[a.bucketInstanceId];e.a9.invert(t.invProjMatrix,s),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}a.justReloaded=!1}markUsedJustification(t,i,r,n){const{leftJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:l,crossTileID:c}=r,h=e.bg(i),u=n===e.b9.vertical?l:"left"===h?a:"center"===h?o:"right"===h?s:-1;a>=0&&(t.text.placedSymbolArray.get(a).crossTileID=u>=0&&a!==u?0:c),o>=0&&(t.text.placedSymbolArray.get(o).crossTileID=u>=0&&o!==u?0:c),s>=0&&(t.text.placedSymbolArray.get(s).crossTileID=u>=0&&s!==u?0:c),l>=0&&(t.text.placedSymbolArray.get(l).crossTileID=u>=0&&l!==u?0:c)}markUsedOrientation(t,i,r){const n=i===e.b9.horizontal||i===e.b9.horizontalOnly?i:0,a=i===e.b9.vertical?i:0,{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:c}=r,h=t.text.placedSymbolArray;o>=0&&(h.get(o).placedOrientation=n),s>=0&&(h.get(s).placedOrientation=n),l>=0&&(h.get(l).placedOrientation=n),c>=0&&(h.get(c).placedOrientation=a)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let i=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const r=t?t.symbolFadeChange(e):1,n=t?t.opacities:{},a=t?t.variableOffsets:{},o=t?t.placedOrientations:{};for(const s in this.placements){const e=this.placements[s],t=n[s];t?(this.opacities[s]=new Li(t,r,e.text,e.icon,null,e.clipped),i=i||e.text!==t.text.placed||e.icon!==t.icon.placed):(this.opacities[s]=new Li(null,r,e.text,e.icon,e.skipFade,e.clipped),i=i||e.text||e.icon)}for(const s in n){const e=n[s];if(!this.opacities[s]){const t=new Li(e,r,!1,!1);t.isHidden()||(this.opacities[s]=t,i=i||e.text.placed||e.icon.placed)}}for(const s in a)this.variableOffsets[s]||!this.opacities[s]||this.opacities[s].isHidden()||(this.variableOffsets[s]=a[s]);for(const s in o)this.placedOrientations[s]||!this.opacities[s]||this.opacities[s].isHidden()||(this.placedOrientations[s]=o[s]);i?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t){const i=new Set;for(const r of t){const t=r.getBucket(e);t&&r.latestFeatureIndex&&e.fqid===t.layerIds[0]&&(this.updateBucketOpacities(t,i,r.collisionBoxArray),t.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(t,r.tileID),t.updateZOffset()))}}updateBucketOpacities(t,i,r){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const n=t.layers[0].layout,a=!!t.layers[0].dynamicFilter(),o=new Li(null,0,!1,!1,!0),s=n.get("text-allow-overlap"),l=n.get("icon-allow-overlap"),c=n.get("text-variable-anchor"),h="map"===n.get("text-rotation-alignment"),u="map"===n.get("text-pitch-alignment"),d=new Li(null,0,s&&(l||!t.hasIconData()||n.get("icon-optional")),l&&(s||!t.hasTextData()||n.get("text-optional")),!0);!t.collisionArrays&&r&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(r);const p=(e,t,i)=>{for(let r=0;r<t/4;r++)e.opacityVertexArray.emplaceBack(i)};let f=0;for(let m=0;m<t.symbolInstances.length;m++){const r=t.symbolInstances.get(m),{numHorizontalGlyphVertices:n,numVerticalGlyphVertices:s,crossTileID:l,numIconVertices:g}=r,_=i.has(l);let y=this.opacities[l];_?y=o:y||(y=d,this.opacities[l]=y),i.add(l);const v=n>0||s>0,x=g>0,b=this.placedOrientations[l],w=b===e.b9.vertical,S=b===e.b9.horizontal||b===e.b9.horizontalOnly;if(!v&&!x||y.isHidden()||f++,v){const e=Yi(y.text);p(t.text,n,w?Ji:e),p(t.text,s,S?Ji:e);const i=y.text.isHidden(),{leftJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:c,verticalPlacedTextSymbolIndex:h}=r,u=t.text.placedSymbolArray,d=i||w?1:0;a>=0&&(u.get(a).hidden=d),o>=0&&(u.get(o).hidden=d),c>=0&&(u.get(c).hidden=d),h>=0&&(u.get(h).hidden=i||S?1:0);const f=this.variableOffsets[l];f&&this.markUsedJustification(t,f.anchor,r,b);const m=this.placedOrientations[l];m&&(this.markUsedJustification(t,"left",r,m),this.markUsedOrientation(t,m,r))}if(x){const e=Yi(y.icon),{placedIconSymbolIndex:i,verticalPlacedIconSymbolIndex:n}=r,a=t.icon.placedSymbolArray,o=y.icon.isHidden()?1:0;i>=0&&(p(t.icon,g,w?Ji:e),a.get(i).hidden=o),n>=0&&(p(t.icon,r.numVerticalIconVertices,S?Ji:e),a.get(n).hidden=o)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const i=t.collisionArrays[m];if(i){let n=new e.P(0,0),o=!0;if(i.textBox||i.verticalTextBox){if(c){const e=this.variableOffsets[l];e?(n=Ni(e.anchor,e.width,e.height,e.textOffset,e.textScale),h&&n._rotate(u?this.transform.angle:-this.transform.angle)):o=!1}a&&(o=!y.clipped),i.textBox&&Ui(t.textCollisionBox.collisionVertexArray,y.text.placed,!o||w,n.x,n.y),i.verticalTextBox&&Ui(t.textCollisionBox.collisionVertexArray,y.text.placed,!o||S,n.x,n.y)}const s=o&&Boolean(!S&&i.verticalIconBox);i.iconBox&&Ui(t.iconCollisionBox.collisionVertexArray,y.icon.placed,s,r.hasIconTextFit?n.x:0,r.hasIconTextFit?n.y:0),i.verticalIconBox&&Ui(t.iconCollisionBox.collisionVertexArray,y.icon.placed,!s,r.hasIconTextFit?n.x:0,r.hasIconTextFit?n.y:0)}}}if(t.fullyClipped=0===f,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const i=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*i>e}setStale(){this.stale=!0}}function Ui(e,t,i,r,n){e.emplaceBack(t?1:0,i?1:0,r||0,n||0),e.emplaceBack(t?1:0,i?1:0,r||0,n||0),e.emplaceBack(t?1:0,i?1:0,r||0,n||0),e.emplaceBack(t?1:0,i?1:0,r||0,n||0)}const Gi=Math.pow(2,25),qi=Math.pow(2,24),Hi=Math.pow(2,17),Wi=Math.pow(2,16),Zi=Math.pow(2,9),Qi=Math.pow(2,8),Xi=Math.pow(2,1);function Yi(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,i=Math.floor(127*e.opacity);return i*Gi+t*qi+i*Hi+t*Wi+i*Zi+t*Qi+i*Xi+t}const Ji=0;class Ki{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,t,i,r,n){const a=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(a,r,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,n())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort(((e,t)=>e.sortKey-t.sortKey)));this._currentPartIndex<a.length;){const e=a[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,i,0===e.symbolInstanceStart),this._currentPartIndex++,n())return!0}return!1}}class $i{constructor(e,t,i,r,n,a,o,s,l){this.placement=new ji(e,n,a,o,s,l),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=r,this._done=!1}isDone(){return this._done}continuePlacement(t,i,r,n){const a=e.f.now(),o=()=>{const t=e.f.now()-a;return!this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const a=i[t[this._currentPlacementIndex]],s=this.placement.collisionIndex.transform.zoom;if("symbol"===a.type&&(!a.minzoom||a.minzoom<=s)&&(!a.maxzoom||a.maxzoom>s)){const t=a,i=t.layout.get("symbol-z-elevate"),s=this._inProgressLayer=this._inProgressLayer||new Ki(t),l=e.aj(a.source,a.scope);if(s.continuePlacement(i?n[l]:r[l],this.placement,this._showCollisionBoxes,a,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const er=512/e.Y/2;class tr{constructor(t,i,r){this.tileID=t,this.bucketInstanceId=r,this.index=new e.bj(i.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const n=t.canonical.x*e.Y,a=t.canonical.y*e.Y;for(let e=0;e<i.length;e++){const{key:t,crossTileID:r,tileAnchorX:o,tileAnchorY:s}=i.get(e),l=Math.floor((n+o)*er),c=Math.floor((a+s)*er);this.index.add(l,c),this.keys.push(t),this.crossTileIDs.push(r)}this.index.finish()}findMatches(t,i,r){const n=this.tileID.canonical.z<i.canonical.z?1:Math.pow(2,this.tileID.canonical.z-i.canonical.z),a=er/Math.pow(2,i.canonical.z-this.tileID.canonical.z),o=i.canonical.x*e.Y,s=i.canonical.y*e.Y;for(let e=0;e<t.length;e++){const i=t.get(e);if(i.crossTileID)continue;const{key:l,tileAnchorX:c,tileAnchorY:h}=i,u=Math.floor((o+c)*a),d=Math.floor((s+h)*a),p=this.index.range(u-n,d-n,u+n,d+n);for(const e of p){const t=this.crossTileIDs[e];if(this.keys[e]===l&&!r.has(t)){r.add(t),i.crossTileID=t;break}}}}}class ir{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class rr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const i in this.indexes){const e=this.indexes[i],r={};for(const i in e){const n=e[i];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+t),r[n.tileID.key]=n}this.indexes[i]=r}this.lng=e}addBucket(e,t,i){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let n=0;n<t.symbolInstances.length;n++)t.symbolInstances.get(n).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);const r=this.usedCrossTileIDs[e.overscaledZ];for(const n in this.indexes){const i=this.indexes[n];if(Number(n)>e.overscaledZ)for(const n in i){const a=i[n];a.tileID.isChildOf(e)&&a.findMatches(t.symbolInstances,e,r)}else{const a=i[e.scaledTo(Number(n)).key];a&&a.findMatches(t.symbolInstances,e,r)}}for(let n=0;n<t.symbolInstances.length;n++){const e=t.symbolInstances.get(n);e.crossTileID||(e.crossTileID=i.generate(),r.add(e.crossTileID))}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new tr(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const i of t.crossTileIDs)this.usedCrossTileIDs[e].delete(i)}removeStaleBuckets(e){let t=!1;for(const i in this.indexes){const r=this.indexes[i];for(const n in r)e[r[n].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,r[n]),delete r[n],t=!0)}return t}}class nr{constructor(){this.layerIndexes={},this.crossTileIDs=new ir,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,i,r){let n=this.layerIndexes[e.fqid];void 0===n&&(n=this.layerIndexes[e.fqid]=new rr);let a=!1;const o={};"globe"!==r.name&&n.handleWrapJump(i);for(const s of t){const t=s.getBucket(e);t&&e.fqid===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(s.tileID,t,this.crossTileIDs)&&(a=!0),o[t.bucketInstanceId]=!0)}return n.removeStaleBuckets(o)&&(a=!0),a}pruneUnusedLayers(e){const t={};e.forEach((e=>{t[e]=!0}));for(const i in this.layerIndexes)t[i]||delete this.layerIndexes[i]}}class ar{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(i)||i<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=i,this.right=r}interpolate(t,i,r){return null!=i.top&&null!=t.top&&(this.top=e.X(t.top,i.top,r)),null!=i.bottom&&null!=t.bottom&&(this.bottom=e.X(t.bottom,i.bottom,r)),null!=i.left&&null!=t.left&&(this.left=e.X(t.left,i.left,r)),null!=i.right&&null!=t.right&&(this.right=e.X(t.right,i.right,r)),this}getCenter(t,i){const r=e.ad((this.left+t-this.right)/2,0,t),n=e.ad((this.top+i-this.bottom)/2,0,i);return new e.P(r,n)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new ar(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function or(t,i){const r=e.bn(t,3);e.a9.fromQuat(t,i),e.bp(t,3,r)}function sr(t,i){const r=e.bl.identity([]);return e.bl.rotateZ(r,r,-i),e.bl.rotateX(r,r,-t),r}function lr(t,i){const r=[t[0],t[1],0],n=[i[0],i[1],0];if(e.Q.length(r)>=1e-15){const t=e.Q.normalize([],r);e.Q.scale(n,t,e.Q.dot(n,t)),i[0]=n[0],i[1]=n[1]}const a=e.Q.cross([],i,t);if(e.Q.len(a)<1e-15)return null;const o=Math.atan2(-a[1],a[0]);return sr(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),o)}class cr{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(t){if(t){const i=t instanceof e.O?t:new e.O(t[0],t[1],t[2]);this._renderWorldCopies&&(i.x=e.bk(i.x,0,1)),this._position=i}else this._position=null}lookAtPoint(t,i){if(this.orientation=null,!this.position)return;const r=this.position,n=this._elevation?this._elevation.getAtPointOrZero(e.O.fromLngLat(t)):0,a=e.O.fromLngLat(t,n),o=[a.x-r.x,a.y-r.y,a.z-r.z];i||(i=[0,0,1]),i[2]=Math.abs(i[2]),this.orientation=lr(o,i)}setPitchBearing(t,i){this.orientation=sr(e.bm(t),e.bm(-i))}}class hr{constructor(t,i){this._transform=e.a9.identity([]),this.orientation=i,this.position=t}get mercatorPosition(){const t=this.position;return new e.O(t[0],t[1],t[2])}get position(){const t=e.bn(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var i;t&&e.bp(this._transform,3,[(i=t)[0],i[1],i[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||e.bl.identity([]),t&&or(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=sr(e,t),or(this._transform,this._orientation)}forward(){const t=e.bn(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=e.bn(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=e.bn(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,i){const r=new Float64Array(16);return e.a9.invert(r,this.getWorldToCamera(t,i)),r}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,i,r){const n=this.position;e.Q.scale(n,n,-t);const a=new Float64Array(16);return e.a9.fromScaling(a,[r,r,r]),e.a9.translate(a,a,n),a[10]*=i,a}getWorldToCamera(t,i){const r=new Float64Array(16),n=new Float64Array(4),a=this.position;return e.bl.conjugate(n,this._orientation),e.Q.scale(a,a,-t),e.a9.fromQuat(r,n),e.a9.translate(r,r,a),r[1]*=-1,r[5]*=-1,r[9]*=-1,r[13]*=-1,r[8]*=i,r[9]*=i,r[10]*=i,r[11]*=i,r}getCameraToClipPerspective(t,i,r,n){const a=new Float64Array(16);return e.a9.perspective(a,t,i,r,n),a}getCameraToClipOrthographic(t,i,r,n,a,o){const s=new Float64Array(16);return e.a9.ortho(s,t,i,r,n,a,o),s}getDistanceToElevation(t){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=0===t?0:e.bo(t,i?e.ax(this.position[1]):this.position[1]),n=this.forward();return(r-this.position[2])/n[2]}clone(){return new hr([...this.position],[...this.orientation])}}const ur=(e,t,i)=>(1-i)*e+i*t,dr=e=>e*e*e*e*e;class pr{constructor(t,i,r,n,a,o,s){this.tileSize=512,this._renderWorldCopies=void 0===a||a,this._minZoom=t||0,this._maxZoom=i||22,this._minPitch=null==r?0:r,this._maxPitch=null==n?60:n,this.setProjection(o),this.setMaxBounds(s),this.width=0,this.height=0,this._center=new e.bq(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ar,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new hr,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const e=new pr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||i)&&this._updateCameraOnTerrain(),(e||i)&&this._constrainCamera(t),this._calcMatrices()}getProjection(){return e.af(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const r=this.projection?this.getProjection():void 0;this.projection=e.br(this.projectionOptions);const n=!t(r,this.getProjection());return n&&this._calcMatrices(),this.mercatorFromTransition=!1,n}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=e.br({name:"mercator"});const i=t!==this.projection.name;return i&&this._calcMatrices(),i}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return e.bo(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.P(this.width,this.height)}get bearing(){return e.bk(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const i=-t*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=e.b7.create(),e.b7.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const i=e.ad(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=e.bm(t),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(e){this._tileCoverLift!==e&&(this._tileCoverLift=e)}_updateCameraOnTerrain(){const e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,t=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!t||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;t||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&i.exaggeration()&&this._centerAltitudeValidForExaggeration!==i.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*i.exaggeration(),this._centerAltitudeValidForExaggeration=i.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=i.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,i=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],r=this.horizonLineFromTop();let n=0,a=0;for(let o=0;o<i.length;o++){const s=new e.P(i[o][0]*this.width,r+i[o][1]*(this.height-r)),l=t.pointCoordinate(s);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);n+=l[3]*c,a+=c}return 0===a?NaN:n/a}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),i=this.pixelsPerMeter/this.worldSize*t,r=this._mercatorZfromZoom(e),n=this._mercatorZfromZoom(this._maxZoom),a=Math.max(r-i,n);this._setZoom(this._zoomFromMercatorZ(a))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(t){const i=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let r;r=t.z<this._camera.position[2]?[i.x,i.y,i.z]:[t.x,t.y,t.z];const n=e.Q.length(e.Q.sub([],this._camera.position,r));return e.ad(this._zoomFromMercatorZ(n),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height)return;if(!t.position&&!t.orientation)return;this._updateCameraState();let i=!1;if(t.orientation&&!e.bl.exactEquals(t.orientation,this._camera.orientation)&&(i=this._setCameraOrientation(t.orientation)),t.position){const r=[t.position.x,t.position.y,t.position.z];e.Q.exactEquals(r,this._camera.position)||(this._setCameraPosition(r),i=!0)}i&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,i=new cr;return i.position=new e.O(t[0],t[1],t[2]),i.orientation=this._camera.orientation,i._elevation=this.elevation,i._renderWorldCopies=this.renderWorldCopies,i}_setCameraOrientation(t){if(!e.bl.length(t))return!1;e.bl.normalize(t,t);const i=e.Q.transformQuat([],[0,0,-1],t),r=e.Q.transformQuat([],[0,-1,0],t);if(r[2]<0)return!1;const n=lr(i,r);return!!n&&(this._camera.orientation=n,!0)}_setCameraPosition(t){const i=this.zoomScale(this.minZoom)*this.tileSize,r=this.zoomScale(this.maxZoom)*this.tileSize,n=this.cameraToCenterDistance;t[2]=e.ad(t[2],n/r,n/i),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,i){this._unmodified=!1,this._edgeInsets.interpolate(e,t,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(t){const i=[new e.bs(0,t)];if(this.renderWorldCopies){const r=this.pointCoordinate(new e.P(0,0)),n=this.pointCoordinate(new e.P(this.width,0)),a=this.pointCoordinate(new e.P(this.width,this.height)),o=this.pointCoordinate(new e.P(0,this.height)),s=Math.floor(Math.min(r.x,n.x,a.x,o.x)),l=Math.floor(Math.max(r.x,n.x,a.x,o.x)),c=1;for(let h=s-c;h<=l+c;h++)0!==h&&i.push(new e.bs(h,t))}return i}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(t,i,r){let n=[];if(0===i[0]&&0===i[1])return n;for(const o of t){const t=o.canonical,r=o.overscaledZ,a=o.wrap,s=1<<t.z,l=t.x+1<s,c=t.x>0,h=t.y+1<s,u=t.y>0,d=o.wrap-(c?0:1),p=o.wrap+(l?0:1),f=c?t.x-1:s-1,m=l?t.x+1:0;i[0]<0?(n.push(new e.ap(r,p,t.z,m,t.y)),i[1]<0&&h&&(n.push(new e.ap(r,a,t.z,t.x,t.y+1)),n.push(new e.ap(r,p,t.z,m,t.y+1))),i[1]>0&&u&&(n.push(new e.ap(r,a,t.z,t.x,t.y-1)),n.push(new e.ap(r,p,t.z,m,t.y-1)))):i[0]>0?(n.push(new e.ap(r,d,t.z,f,t.y)),i[1]<0&&h&&(n.push(new e.ap(r,a,t.z,t.x,t.y+1)),n.push(new e.ap(r,d,t.z,f,t.y+1))),i[1]>0&&u&&(n.push(new e.ap(r,a,t.z,t.x,t.y-1)),n.push(new e.ap(r,d,t.z,f,t.y-1)))):i[1]<0&&h?n.push(new e.ap(r,a,t.z,t.x,t.y+1)):u&&n.push(new e.ap(r,a,t.z,t.x,t.y-1))}if(n.length>1){n.sort(((e,t)=>e.overscaledZ-t.overscaledZ||e.wrap-t.wrap||e.canonical.z-t.canonical.z||e.canonical.x-t.canonical.x||e.canonical.y-t.canonical.y));let e=0,t=0;for(;t<n.length;)n[t].equals(n[e])?++t:n[++e]=n[t++];n.length=e+1}const a=[];for(const e of n)n.some((t=>e.isChildOf(t)))||a.push(e);return n=a.filter((e=>!t.some((t=>!!(e.overscaledZ<r&&t.isChildOf(e))||e.equals(t)||e.isChildOf(t))))),n}coveringTiles(t){let i=this.coveringZoomLevel(t);const r=i,n=this.elevation&&this.elevation.exaggeration(),a=n&&!t.isTerrainDEM,o="mercator"===this.projection.name;if(void 0!==t.minzoom&&i<t.minzoom)return[];void 0!==t.maxzoom&&i>t.maxzoom&&(i=t.maxzoom);const s=this.locationCoordinate(this.center),l=this.center.lat,c=1<<i,h=[c*s.x,c*s.y,0],u="globe"===this.projection.name,d=!u,p=e.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,d),f=u?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),m=c*e.bo(1,this.center.lat),g=this._camera.position[2]/e.bo(1,this.center.lat),_=[c*f.x,c*f.y,g*(d?1:m)],y=u||n,v=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),x=this.isLODDisabled(!0)?i:0;let b;if(this._elevation&&t.isTerrainDEM)b=1e4*this._elevation.exaggeration();else if(this._elevation){const e=this._elevation.getMinMaxForVisibleTiles();b=e?e.max:this._centerAltitude}else b=this._centerAltitude;const w=t.isTerrainDEM?-b:this._elevation?this._elevation.getMinElevationBelowMSL():0,S=this.projection.isReprojectedInTileSpace?e.bu(this):1,T=t=>{const i=1/4e4,r=new e.O(t.x+i,t.y,t.z),n=new e.O(t.x,t.y+i,t.z),a=t.toLngLat(),o=r.toLngLat(),s=n.toLngLat(),l=this.locationCoordinate(a),c=this.locationCoordinate(o),h=this.locationCoordinate(s),u=Math.hypot(c.x-l.x,c.y-l.y),d=Math.hypot(h.x-l.x,h.y-l.y);return Math.sqrt(u*d)*S/i},E=t=>{const i=b,r=w;return{aabb:e.bx(this,c,0,0,0,t,r,i,this.projection),zoom:0,x:0,y:0,minZ:r,maxZ:i,wrap:t,fullyVisible:!1}},M=[];let A=[];const P=i,C=t.reparseOverscaled?r:i,I=e=>e*e,k=I((g-this._centerAltitude)*m),D=e=>{if(!this._elevation||!e.tileID||!o)return;const t=this._elevation.getMinMaxForTile(e.tileID),i=e.aabb;t?(i.min[2]=t.min,i.max[2]=t.max,i.center[2]=(i.min[2]+i.max[2])/2):(e.shouldSplit=R(e),e.shouldSplit||(i.min[2]=i.max[2]=i.center[2]=this._centerAltitude))},R=t=>{if(t.zoom<x)return!0;if(t.zoom===P)return!1;if(null!=t.shouldSplit)return t.shouldSplit;const i=t.aabb.distanceX(_),n=t.aabb.distanceY(_);let o=k,s=1;if(u){o=I(t.aabb.distanceZ(_));const i=Math.pow(2,t.zoom),r=e.ax((t.y+1)/i),n=e.ax(t.y/i),a=Math.min(Math.max(l,r),n),c=e.bM(a)/e.bM(l);if(s=a===l?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,c/this._mercatorScaleRatio),this.zoom<=e.bJ&&t.zoom===P-1&&c>=.9)return!0}else if(a&&(o=I(t.aabb.distanceZ(_)*m)),this.projection.isReprojectedInTileSpace&&r<=5){const i=Math.pow(2,t.zoom),r=T(new e.O((t.x+.5)/i,(t.y+.5)/i));s=r>.85?1:r}const c=i*i+n*n+o,h=I((1<<P-t.zoom)*v*s*((e,t)=>{if(t*I(.707)<e)return 1;const i=Math.sqrt(t/e);return i/(1.4144271570014144+(Math.pow(1.1,i-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(o,k),c));return c<h};if(this.renderWorldCopies)for(let e=1;e<=3;e++)M.push(E(-e)),M.push(E(e));for(M.push(E(0));M.length>0;){const r=M.pop(),n=r.x,s=r.y;let l=r.fullyVisible;const d=()=>"globe"===this.projection.name&&(0===r.y||r.y===(1<<r.zoom)-1);if(!l){let t=y?r.aabb.intersects(p):r.aabb.intersectsFlat(p);if(0===t&&d()){const i=new e.bv(r.zoom,n,s);t=e.bw(this,c,i,!0).intersects(p)}if(0===t)continue;l=2===t}if(r.zoom!==P&&R(r))for(let t=0;t<4;t++){const i=(n<<1)+t%2,h=(s<<1)+(t>>1),d={aabb:o?r.aabb.quadrant(t):e.bx(this,c,r.zoom+1,i,h,r.wrap,r.minZ,r.maxZ,this.projection),zoom:r.zoom+1,x:i,y:h,wrap:r.wrap,fullyVisible:l,tileID:void 0,shouldSplit:void 0,minZ:r.minZ,maxZ:r.maxZ};a&&!u&&(d.tileID=new e.ap(r.zoom+1===P?C:r.zoom+1,r.wrap,r.zoom+1,i,h),D(d)),M.push(d)}else{const a=r.zoom===P?C:r.zoom;if(t.minzoom&&t.minzoom>a)continue;if(!l){let t=y?r.aabb.intersectsPrecise(p):r.aabb.intersectsPreciseFlat(p);if(0===t&&d()){const i=new e.bv(r.zoom,n,s);t=e.bw(this,c,i,!0).intersectsPrecise(p)}if(0===t)continue}const o=h[0]-(.5+n+(r.wrap<<r.zoom))*(1<<i-r.zoom),u=h[1]-.5-s,f=r.tileID?r.tileID:new e.ap(a,r.wrap,r.zoom,n,s);A.push({tileID:f,distanceSq:o*o+u*u})}}if(this.fogCullDistSq){const i=this.fogCullDistSq,r=this.horizonLineFromTop();A=A.filter((n=>{const a=[0,0,0,1],o=[e.Y,e.Y,0,1],s=this.calculateFogTileMatrix(n.tileID.toUnwrapped());e.aa.transformMat4(a,a,s),e.aa.transformMat4(o,o,s);const l=e.aa.min([],a,o),c=e.aa.max([],a,o),h=e.by(l,c);if(0===h)return!0;let u=!1;const d=this._elevation;if(d&&h>i&&0!==r){const i=this.calculateProjMatrix(n.tileID.toUnwrapped());let a;t.isTerrainDEM||(a=d.getMinMaxForTile(n.tileID)),a||(a={min:w,max:b});const o=e.bK(this.rotation),s=[o[0]*e.Y,o[1]*e.Y,a.max];e.Q.transformMat4(s,s,i),u=(1-s[1])*this.height*.5<r}return h<i||u}))}return A.sort(((e,t)=>e.distanceSq-t.distanceSq)).map((e=>e.tileID))}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(t){const i=e.ad(t.lat,-e.bz,e.bz),r=this.projection.project(t.lng,i);return new e.P(r.x*this.worldSize,r.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/e.bo(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,i){let r,n;const a=this.centerPoint;if("globe"===this.projection.name){const e=this.worldSize;r=(i.x-a.x)/e,n=(i.y-a.y)/e}else{const e=this.pointCoordinate(i),t=this.pointCoordinate(a);r=e.x-t.x,n=e.y-t.y}const o=this.locationCoordinate(t);this.setLocation(new e.O(o.x-r,o.y-n))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(t,i){const r=i?e.bo(i,t.lat):void 0,n=this.projection.project(t.lng,t.lat);return new e.O(n.x,n.y,r)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(t,i){const r=null!=i?i:this._centerAltitude,n=[t.x,t.y,0,1],a=[t.x,t.y,1,1];e.aa.transformMat4(n,n,this.pixelMatrixInverse),e.aa.transformMat4(a,a,this.pixelMatrixInverse);const o=a[3];e.aa.scale(n,n,1/n[3]),e.aa.scale(a,a,1/o);const s=n[2],l=a[2];return{p0:n,p1:a,t:s===l?0:(r-s)/(l-s)}}screenPointToMercatorRay(t){const i=[t.x,t.y,0,1],r=[t.x,t.y,1,1];return e.aa.transformMat4(i,i,this.pixelMatrixInverse),e.aa.transformMat4(r,r,this.pixelMatrixInverse),e.aa.scale(i,i,1/i[3]),e.aa.scale(r,r,1/r[3]),i[2]=e.bo(i[2],this._center.lat)*this.worldSize,r[2]=e.bo(r[2],this._center.lat)*this.worldSize,e.aa.scale(i,i,1/this.worldSize),e.aa.scale(r,r,1/this.worldSize),new e.a5([i[0],i[1],i[2]],e.Q.normalize([],e.Q.sub([],r,i)))}rayIntersectionCoordinate(t){const{p0:i,p1:r,t:n}=t,a=e.bo(i[2],this._center.lat),o=e.bo(r[2],this._center.lat);return new e.O(e.X(i[0],r[0],n)/this.worldSize,e.X(i[1],r[1],n)/this.worldSize,e.X(a,o,n))}pointCoordinate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._centerAltitude;return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);let i=this.projection.pointCoordinate3D(this,t.x,t.y);if(i)return new e.O(i[0],i[1],i[2]);let r=0,n=this.horizonLineFromTop();if(t.y>n)return this.pointCoordinate(t);const a=.02*n,o=t.clone();for(let s=0;s<10&&n-r>a;s++){o.y=e.X(r,n,.66);const t=this.projection.pointCoordinate3D(this,o.x,o.y);t?(n=o.y,i=t):r=o.y}return i?new e.O(i[0],i[1],i[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=e.bA)return!this.isPointAboveHorizon(t);const i=this.pointCoordinate(t);return i.y>=0&&i.y<=1}_coordinatePoint(t,i){const r=i&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,n=[t.x*this.worldSize,t.y*this.worldSize,r+t.toAltitude(),1];return e.aa.transformMat4(n,n,this.pixelMatrix),n[3]>0?new e.P(n[0]/n[3],n[1]/n[3]):new e.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:i}=this._edgeInsets,r=this.height-this._edgeInsets.bottom,n=this.width-this._edgeInsets.right,a=this.pointLocation3D(new e.P(i,t)),o=this.pointLocation3D(new e.P(n,t)),s=this.pointLocation3D(new e.P(n,r)),l=this.pointLocation3D(new e.P(i,r));let c=Math.min(a.lng,o.lng,s.lng,l.lng),h=Math.max(a.lng,o.lng,s.lng,l.lng),u=Math.min(a.lat,o.lat,s.lat,l.lat),d=Math.max(a.lat,o.lat,s.lat,l.lat);const p=Math.pow(2,-this.zoom)/16*270,f="globe"===this.projection.name?1:4,m=(t,i,r,n,a)=>{const o=(t+r)/2,s=(i+n)/2,l=new e.P(o,s),{lng:g,lat:_}=this.pointLocation3D(l),y=Math.max(0,c-g,u-_,g-h,_-d);c=Math.min(c,g),h=Math.max(h,g),u=Math.min(u,_),d=Math.max(d,_),(a<f||y>p)&&(m(t,i,o,s,a+1),m(o,s,r,n,a+1))};if(m(i,t,n,t,1),m(n,t,n,r,1),m(n,r,i,r,1),m(i,r,i,t,1),"globe"===this.projection.name){const[t,i]=e.bB(this);t?(d=90,h=180,c=-180):i&&(u=-90,h=180,c=-180)}return new e.ag(new e.bq(c,u),new e.bq(h,d))}_getBoundsRectangular(t,i){const{top:r,left:n}=this._edgeInsets,a=this.height-this._edgeInsets.bottom,o=this.width-this._edgeInsets.right,s=new e.P(n,r),l=new e.P(o,r),c=new e.P(o,a),h=new e.P(n,a);let u=this.pointCoordinate(s,t),d=this.pointCoordinate(l,t);const p=this.pointCoordinate(c,i),f=this.pointCoordinate(h,i),m=(e,t)=>(t.y-e.y)/(t.x-e.x);return u.y>1&&d.y>=0?u=new e.O((1-f.y)/m(f,u)+f.x,1):u.y<0&&d.y<=1&&(u=new e.O(-f.y/m(f,u)+f.x,0)),d.y>1&&u.y>=0?d=new e.O((1-p.y)/m(p,d)+p.x,1):d.y<0&&u.y<=1&&(d=new e.O(-p.y/m(p,d)+p.x,0)),(new e.ag).extend(this.coordinateLocation(u)).extend(this.coordinateLocation(d)).extend(this.coordinateLocation(f)).extend(this.coordinateLocation(p))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const t=e.visibleDemTiles.reduce(((e,t)=>{if(t.dem){const i=t.dem.tree;e.min=Math.min(e.min,i.minimums[0]),e.max=Math.max(e.max,i.maximums[0])}return e}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,i=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,i):i}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-e.bz,this.maxLat=e.bz,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=e.a8(this.minLng)*this.tileSize,this.worldMaxX=e.a8(this.maxLng)*this.tileSize,this.worldMinY=e.ah(this.maxLat)*this.tileSize,this.worldMaxY=e.ah(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(t){const i=t.key,r=this._distanceTileDataCache;if(r[i])return r[i];const n=t.canonical,a=1/this.height,o=this.cameraWorldSize,s=o/this.zoomScale(n.z),l=(n.x+Math.pow(2,n.z)*t.wrap)*s,c=n.y*s,h=this.point;h.x*=o/this.worldSize,h.y*=o/this.worldSize;const u=this.angle,d=Math.sin(-u),p=-Math.cos(-u);return r[i]={bearing:[d,p],center:[(h.x-l)*a,(h.y-c)*a],scale:s/e.Y*a},r[i]}calculateFogTileMatrix(t){const i=t.key,r=this._fogTileMatrixCache;if(r[i])return r[i];const n=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return e.a9.multiply(n,this.worldToFogMatrix,n),r[i]=new Float32Array(n),r[i]}calculateProjMatrix(t){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=t.key;let a;if(a=r?this._expandedProjMatrixCache:i?this._alignedProjMatrixCache:this._projMatrixCache,a[n])return a[n];const o=this.calculatePosMatrix(t,this.worldSize);let s;return s=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:r?this.expandedFarZProjMatrix:i?this.alignedProjMatrix:this.projMatrix,e.a9.multiply(o,s,o),a[n]=new Float32Array(o),a[n]}calculatePixelsToTileUnitsMatrix(t){const i=t.tileID.key,r=this._pixelsToTileUnitsCache;if(r[i])return r[i];const n=e.bC(t,this);return r[i]=n,r[i]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const t=1/this.worldSize,i=e.a9.fromScaling([],[t,t,t]);return e.a9.multiply(i,i,this.globeMatrix),i}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const i=e.bo(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(i),n=this._camera.forward(),a=e.bo(1,this._center.lat);r[2]/=a,n[2]/=a,e.Q.normalize(n,n);const o=t.raycast(r,n,t.exaggeration());if(o){const t=e.Q.scaleAndAdd([],r,n,o),i=new e.O(t[0],t[1],e.bo(t[2],e.ax(t[1]))),s=(i.z+e.Q.length([i.x-r[0],i.y-r[1],i.z-r[2]*a]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(s),this._centerAltitude=i.toAltitude(),this._center=this.coordinateLocation(i),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._elevation)return;const i=this._elevation,r=e.bo(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(r),a=i.getAtPointOrZero(new e.O(...n)),o=this.pixelsPerMeter/this.worldSize*a,s=this._minimumHeightOverTerrain(),l=n[2]-o;if(l<=s)if(l<0||t){const t=this.locationCoordinate(this._center,this._centerAltitude),i=[n[0],n[1],t.z-n[2]],r=e.Q.length(i);i[2]-=(s-l)/this._pixelsPerMercatorPixel;const a=e.Q.length(i);if(0===a)return;e.Q.scale(i,i,r/a*this._pixelsPerMercatorPixel),this._camera.position=[n[0],n[1],t.z*this._pixelsPerMercatorPixel-i[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const i=this.center;return i.lat=e.ad(i.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(i.lng=e.ad(i.lng,this.minLng,this.maxLng)),this.center=i,void(this._constraining=!1)}const i=this._unmodified,{x:r,y:n}=this.point;let a=0,o=r,s=n;const l=this.width/2,c=this.height/2,h=this.worldMinY*this.scale,u=this.worldMaxY*this.scale;if(n-c<h&&(s=h+c),n+c>u&&(s=u-c),u-h<this.height&&(a=Math.max(a,this.height/(u-h)),s=(u+h)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const e=this.worldMinX*this.scale,t=this.worldMaxX*this.scale,i=this.worldSize/2-(e+t)/2;o=(r+i+this.worldSize)%this.worldSize-i,o-l<e&&(o=e+l),o+l>t&&(o=t-l),t-e<this.width&&(a=Math.max(a,this.width/(t-e)),o=(t+e)/2)}o===r&&s===n||(this.center=this.unproject(new e.P(o,s))),a&&(this.zoom+=this.scaleZoom(a)),this._constrainCamera(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,i="globe"===this.projection.name,r=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=e.bo(1,this.center.lat)/e.bo(1,e.bL));const n=e.bD(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,n),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const a="meters"===this.projection.zAxisUnit?r:1,o=this._camera.getWorldToCamera(this.worldSize,a);let s;const l=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(l[8]=2*-t.x/this.width,l[9]=2*t.y/this.height,this.isOrthographic){let e=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),i=e*this.aspect,r=-i,n=-e;i-=t.x,r-=t.x,e+=t.y,n+=t.y,s=this._camera.getCameraToClipOrthographic(r,i,n,e,this._nearZ,this._farZ),((e,t,i,r)=>{for(let n=0;n<16;n++)e[n]=ur(t[n],i[n],r)})(s,s,l,dr(this.pitch>=15?1:this.pitch/15))}else s=l;const c=e.a9.mul([],l,o);let h=e.a9.mul([],s,o);if(this.projection.isReprojectedInTileSpace){const t=this.locationCoordinate(this.center),i=e.a9.identity([]);e.a9.translate(i,i,[t.x*this.worldSize,t.y*this.worldSize,0]),e.a9.multiply(i,i,e.bE(this)),e.a9.translate(i,i,[-t.x*this.worldSize,-t.y*this.worldSize,0]),e.a9.multiply(h,h,i),e.a9.multiply(c,c,i),this.inverseAdjustmentMatrix=e.bF(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=e.a9.scale([],h,[this.worldSize,this.worldSize,this.worldSize/a,1]),this.projMatrix=h,this.invProjMatrix=e.a9.invert(new Float64Array(16),this.projMatrix),i){const i=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);i[8]=2*-t.x/this.width,i[9]=2*t.y/this.height,this.expandedFarZProjMatrix=e.a9.mul([],i,o)}else this.expandedFarZProjMatrix=this.projMatrix;const u=e.a9.invert([],s);this.frustumCorners=e.bG.fromInvProjectionMatrix(u,this.horizonLineFromTop(),this.height),this.cameraFrustum=e.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!i);const d=new Float32Array(16);e.a9.identity(d),e.a9.scale(d,d,[1,-1,1]),e.a9.rotateX(d,d,this._pitch),e.a9.rotateZ(d,d,this.angle);const p=e.a9.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=e.a9.clone(p);const f=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;p[8]=2*-t.x/this.width,p[9]=2*(t.y+f)/this.height,this.skyboxMatrix=e.a9.multiply(d,p,d);const m=this.point,g=m.x,_=m.y,y=this.width%2/2,v=this.height%2/2,x=Math.cos(this.angle),b=Math.sin(this.angle),w=g-Math.round(g)+x*y+b*v,S=_-Math.round(_)+x*v+b*y,T=new Float64Array(h);if(e.a9.translate(T,T,[w>.5?w-1:w,S>.5?S-1:S,0]),this.alignedProjMatrix=T,h=e.a9.create(),e.a9.scale(h,h,[this.width/2,-this.height/2,1]),e.a9.translate(h,h,[1,-1,0]),this.labelPlaneMatrix=h,h=e.a9.create(),e.a9.scale(h,h,[1,-1,1]),e.a9.translate(h,h,[-1,-1,0]),e.a9.scale(h,h,[2/this.width,2/this.height,1]),this.glCoordMatrix=h,this.pixelMatrix=e.a9.multiply(new Float64Array(16),this.labelPlaneMatrix,c),this._calcFogMatrices(),this._distanceTileDataCache={},h=e.a9.invert(new Float64Array(16),this.pixelMatrix),!h)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=h,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=e.bH(this);const t=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=e.Q.transformMat4(t,t,o),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=h;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,i=this.cameraPixelsPerMeter,r=this._camera.position,n=1/this.height/this._pixelsPerMercatorPixel,a=[t,t,i];e.Q.scale(a,a,n),e.Q.scale(r,r,-1),e.Q.multiply(r,r,a);const o=e.a9.create();e.a9.translate(o,o,r),e.a9.scale(o,o,a),this.mercatorFogMatrix=o,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,i,n)}_computeCameraPosition(e){const t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,i=this._camera.forward(),r=this.point,n=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*t-e/this.worldSize*this._centerAltitude;return[r.x/this.worldSize-i[0]*n,r.y/this.worldSize-i[1]*n,e/this.worldSize*this._centerAltitude-i[2]*n]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const i=this._maxCameraBoundsDistance()*Math.cos(this._pitch),r=this._camera.position[2],n=t[2];let a=1;this.projection.wrap&&(this.center=this.center.wrap()),n>0&&(a=Math.min((i-r)/n,1)),this._camera.position=e.Q.scaleAndAdd([],this._camera.position,t,a),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,i=this._camera.forward(),{pitch:r,bearing:n}=this._camera.getPitchBearing(),a=e.bo(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,o=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.bm(this._maxPitch)),s=Math.max((t[2]-a)/Math.cos(r),o),l=this._zoomFromMercatorZ(s);e.Q.scaleAndAdd(t,t,i,s),this._pitch=e.ad(r,e.bm(this.minPitch),e.bm(this.maxPitch)),this.angle=e.bk(n,-Math.PI,Math.PI),this._setZoom(e.ad(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new e.O(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}zoomFromMercatorZAdjusted(t){let i=0,r=e.bA,n=0,a=1/0;for(;r-i>1e-6&&r>i;){const e=i+.5*(r-i),o=this.tileSize*Math.pow(2,e),s=this.getCameraToCenterDistance(this.projection,e,o),l=this.scaleZoom(s/(t*this.tileSize)),c=Math.abs(e-l);c<a&&(a=c,n=e),e<l?i=e:r=e}return n}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(e.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,i){const r=Math.min(t.x,i.x),n=Math.max(t.x,i.x),a=Math.min(t.y,i.y),o=Math.max(t.y,i.y);if(a<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const s=[new e.P(r,a),new e.P(n,o),new e.P(r,o),new e.P(n,a)],l=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const e of s){const t=this.pointRayIntersection(e);if(t.t<0)return!0;const i=this.rayIntersectionCoordinate(t);if(i.x<l||i.y<0||i.x>c||i.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+e.bI(this.fovAboveCenter)>88||this.anyCornerOffEdge(new e.P(0,0),new e.P(this.width,this.height))}zoomDeltaToMovement(t,i){const r=e.Q.length(e.Q.sub([],this._camera.position,t)),n=this._zoomFromMercatorZ(r)+i;return r-this._mercatorZfromZoom(n)}getCameraPoint(){if("globe"===this.projection.name){const t=function(t,i){let[r,n,a]=t;const o=[r,n,a,1];e.aa.transformMat4(o,o,i);const s=o[3]=Math.max(o[3],1e-6);return o[0]/=s,o[1]/=s,o[2]/=s,o}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new e.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.P(0,t))}}getCameraToCenterDistance(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.zoom,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.worldSize;const n=e.bD(t,i,this.width,this.height,1024),a=t.pixelSpaceConversion(this.center.lat,r,n);let o=.5/Math.tan(.5*this._fov)*this.height*a;return this.isOrthographic&&(o=ur(1,o,dr(this.pitch>=15?1:this.pitch/15))),o}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&e.a9.multiply(t,t,this.globeMatrix),t}getFrustum(t){return e.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,"meters"===this.projection.zAxisUnit)}}const fr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},mr=(t,i)=>{if(i>0&&t.terrain&&e.w("Cutoff is currently disabled on terrain"),i<=0||t.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const r=t.transform,n=Math.max(Math.abs(r._zoom-(t.minCutoffZoom-1)),1),a=r.isLODDisabled(!1)?e.S(60,45,r.pitch):e.S(30,15,r.pitch),o=r._farZ-r._nearZ,s=i*r.height,l=((1-(c=a))*r.cameraToCenterDistance+c*(r._farZ+s))*n;var c;return{shouldRenderCutoff:a<1,uniformValues:{u_cutoff_params:[r._nearZ,r._farZ,(l-r._nearZ)/o,(l-s-r._nearZ)/o]}}},gr={cascadeCount:2,shadowMapResolution:2048};class _r{constructor(e,t){this.aabb=e,this.lastCascade=t}}class yr{add(e,t){const i=this.receivers[e.key];void 0!==i?(i.aabb.min[0]=Math.min(i.aabb.min[0],t.min[0]),i.aabb.min[1]=Math.min(i.aabb.min[1],t.min[1]),i.aabb.min[2]=Math.min(i.aabb.min[2],t.min[2]),i.aabb.max[0]=Math.max(i.aabb.max[0],t.max[0]),i.aabb.max[1]=Math.max(i.aabb.max[1],t.max[1]),i.aabb.max[2]=Math.max(i.aabb.max[2],t.max[2])):this.receivers[e.key]=new _r(t,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(t,i,r){const n=e.bV.fromPoints(t.points);let a=0;for(const o in this.receivers){const t=this.receivers[o];if(!t)continue;if(!n.intersectsAabb(t.aabb))continue;t.aabb.min=n.closestPoint(t.aabb.min),t.aabb.max=n.closestPoint(t.aabb.max);const s=t.aabb.getCorners();for(let n=0;n<r.length;n++){let o=!0;for(const t of s){const a=[t[0]*i,t[1]*i,t[2]];if(e.Q.transformMat4(a,a,r[n].matrix),a[0]<-1||a[0]>1||a[1]<-1||a[1]>1){o=!1;break}}if(t.lastCascade=n,a=Math.max(a,n),o)break}}return a+1}}class vr{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new yr,this._depthMode=new Mt(e.context.gl.LEQUAL,Mt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,e.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},(()=>{this.painter.style.map.triggerRepaint()})),e.tp.registerParameter(gr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),e.tp.registerParameter(gr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),e.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,i){const r=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!i||!i.properties)return;const n=i.properties.get("shadow-intensity");if(!i.shadowsEnabled()||n<=0)return;if(this._shadowLayerCount=r.style.order.reduce(((e,i)=>{const n=r.style._mergedLayers[i];return e+(n.hasShadowPass()&&!n.isHidden(t.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled)return;const a=r.context,o=gr.shadowMapResolution,s=gr.shadowMapResolution;if(0===this._cascades.length||gr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let t=0;t<gr.cascadeCount;++t){const t=r._shadowMapDebug,i=a.gl,n=a.createFramebuffer(o,s,t,"texture"),l=new e.T(a,{width:o,height:s,data:null},i.DEPTH_COMPONENT);if(n.depthAttachment.set(l.texture),t){const t=new e.T(a,{width:o,height:s,data:null},i.RGBA);n.colorAttachment.set(t.texture)}this._cascades.push({framebuffer:n,texture:l,matrix:[],far:0,boundingSphereRadius:0,frustum:new e.bt,scale:0})}}this.shadowDirection=br(i);let l=0;if(t.elevation){const e=t.elevation,i=[1e4,-1e4];e.visibleDemTiles.filter((e=>e.dem)).forEach((e=>{const t=e.dem.tree;i[0]=Math.min(i[0],t.minimums[0]),i[1]=Math.max(i[1],t.maximums[0])})),1e4!==i[0]&&(l=(i[1]-i[0])*e.exaggeration())}const c=1.5*t.cameraToCenterDistance,h=3*c,u=new Float64Array(16);for(let f=0;f<this._cascades.length;++f){const i=this._cascades[f];let r=t.height/50,n=1;1===gr.cascadeCount?n=h:0===f?n=c:(r=c,n=h);const[a,o]=Sr(t,this.shadowDirection,r,n,gr.shadowMapResolution,l);i.scale=t.scale,i.matrix=a,i.boundingSphereRadius=o,e.a9.invert(u,i.matrix),i.frustum=e.bt.fromInvProjectionMatrix(u,1,0,!0),i.far=n}const d=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[d].far,this._cascades[d].far],this._uniformValues.u_shadow_intensity=n,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/gr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=gr.shadowMapResolution,this._uniformValues.u_shadowmap_0=fr.ShadowMap0,this._uniformValues.u_shadowmap_1=fr.ShadowMap0+1,this._groundShadowTiles=r.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const p=r.transform.elevation;for(const e of this._groundShadowTiles){let t={min:0,max:0};if(p){const i=p.getMinMaxForTile(e);i&&(t=i)}this.addShadowReceiver(e.toUnwrapped(),t.min,t.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(e){this._enabled=e}drawShadowPass(t,i){if(!this.enabled)return;const r=this.painter,n=r.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(r.transform.getFrustum(0),r.transform.worldSize,this._cascades),n.viewport.set([0,0,gr.shadowMapResolution,gr.shadowMapResolution]);for(let a=0;a<this._numCascadesToRender;++a){r.currentShadowCascade=a,n.bindFramebuffer.set(this._cascades[a].framebuffer.framebuffer),n.clear({color:e.aA.white,depth:1});for(const e of t.order){const n=t._mergedLayers[e];if(!n.hasShadowPass()||n.isHidden(r.transform.zoom))continue;const a=t.getLayerSourceCache(n),o=a?i[a.id]:void 0;("model"===n.type||o&&o.length)&&r.renderLayer(r,a,n,o)}}r.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const e=this.painter,t=e.style,i=e.context,r=t.directionalLight,n=t.ambientLight;if(!r||!n)return;const a=[],o=mr(e,e.longestCutoffRange);o.shouldRenderCutoff&&a.push("RENDER_CUTOFF");const s=wr(r,n),l=new Mt(i.gl.LEQUAL,Mt.ReadOnly,e.depthRangeFor3D);for(const c of this._groundShadowTiles){const t=c.toUnwrapped(),r=e.isTileAffectedByFog(c),n=e.getOrCreateProgram("groundShadow",{defines:a,overrideFog:r});this.setupShadows(t,n),e.uploadCommonUniforms(i,n,t,null,o);const h={u_matrix:e.transform.calculateProjMatrix(t),u_ground_shadow_factor:s};n.draw(e,i.gl.TRIANGLES,l,Pt.disabled,It.multiply,Rt.disabled,h,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,{},e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?It.unblended:It.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const i=this.painter.transform,r=i.calculatePosMatrix(t,i.worldSize);return e.a9.multiply(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}calculateShadowPassMatrixFromMatrix(t){return e.a9.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,i,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!this.enabled)return;const a=this.painter.transform,o=this.painter.context,s=o.gl,l=this._uniformValues,c=new Float64Array(16),h=a.calculatePosMatrix(t,a.worldSize);for(let u=0;u<this._cascades.length;u++)e.a9.multiply(c,this._cascades[u].matrix,h),l[0===u?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(c),o.activeTexture.set(s.TEXTURE0+fr.ShadowMap0+u),this._cascades[u].texture.bind(s.NEAREST,s.CLAMP_TO_EDGE);if(this.useNormalOffset=!!r,this.useNormalOffset){const i=e.bU(t.canonical),o=2/a.tileSize*e.Y/gr.shadowMapResolution,s=o*this._cascades[0].boundingSphereRadius,c=o*this._cascades[this._cascades.length-1].boundingSphereRadius,h=("vector-tile"===r?1:3)/Math.pow(2,n-t.canonical.z-(1-a.zoom+Math.floor(a.zoom)));l.u_shadow_normal_offset=[i,s*h,c*h],l.u_shadow_bias=[6e-5,.0012,.012]}else l.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(o,l)}setupShadowsFromMatrix(t,i){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.enabled)return;const n=this.painter.context,a=n.gl,o=this._uniformValues,s=new Float64Array(16);for(let l=0;l<gr.cascadeCount;l++)e.a9.multiply(s,this._cascades[l].matrix,t),o[0===l?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(s),n.activeTexture.set(a.TEXTURE0+fr.ShadowMap0+l),this._cascades[l].texture.bind(a.NEAREST,a.CLAMP_TO_EDGE);if(this.useNormalOffset=r,r){const e=5;o.u_shadow_normal_offset=[1,e,e],o.u_shadow_bias=[6e-5,.0012,.012]}else o.u_shadow_bias=[36e-5,.0012,.012];i.setShadowUniformValues(n,o)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,i,r,n){if(n[2]>=0)return{};const a=function(t,i,r){const n=r/(1<<t.canonical.z);return new e.bV([t.canonical.x*n+t.wrap*r,t.canonical.y*n+t.wrap*r,0],[(t.canonical.x+1)*n+t.wrap*r,(t.canonical.y+1)*n+t.wrap*r,i])}(t,i,r).getCorners(),o=i/-n[2];n[0]<0?(e.Q.add(a[0],a[0],[n[0]*o,0,0]),e.Q.add(a[3],a[3],[n[0]*o,0,0])):n[0]>0&&(e.Q.add(a[1],a[1],[n[0]*o,0,0]),e.Q.add(a[2],a[2],[n[0]*o,0,0])),n[1]<0?(e.Q.add(a[0],a[0],[0,n[1]*o,0]),e.Q.add(a[1],a[1],[0,n[1]*o,0])):n[1]>0&&(e.Q.add(a[2],a[2],[0,n[1]*o,0]),e.Q.add(a[3],a[3],[0,n[1]*o,0]));const s={};return s.vertices=a,s.planes=[xr(a[1],a[0],a[4]),xr(a[2],a[1],a[5]),xr(a[3],a[2],a[6]),xr(a[0],a[3],a[7])],s}addShadowReceiver(t,i,r){this._receivers.add(t,e.bV.fromTileIdAndHeight(t,i,r))}getMaxCascadeForTile(e){const t=this._receivers.get(e);return t&&t.lastCascade?t.lastCascade:0}}function xr(t,i,r){const n=e.Q.sub([],r,i),a=e.Q.sub([],t,i),o=e.Q.cross([],n,a),s=e.Q.length(o);return 0===s?[0,0,1,0]:(e.Q.scale(o,o,1/s),[o[0],o[1],o[2],-e.Q.dot(o,i)])}function br(t){const i=t.properties.get("direction"),r=e.bT(i.x,i.y,i.z);r[2]=e.ad(r[2],0,75);const n=e.bW([r[0],r[1],r[2]]);return e.Q.fromValues(n.x,n.y,n.z)}function wr(t,i){const r=t.properties.get("color"),n=t.properties.get("intensity"),a=t.properties.get("direction"),o=[a.x,a.y,a.z],s=i.properties.get("color"),l=i.properties.get("intensity"),c=Math.max(e.Q.dot([0,0,1],o),0),h=[0,0,0];e.Q.scale(h,s.toArray01Linear().slice(0,3),l);const u=[0,0,0];return e.Q.scale(u,r.toArray01Linear().slice(0,3),c*n),e.bX([h[0]>0?h[0]/(h[0]+u[0]):0,h[1]>0?h[1]/(h[1]+u[1]):0,h[2]>0?h[2]/(h[2]+u[2]):0])}function Sr(t,i,r,n,a,o){const s=t.zoom,l=t.scale,c=t.worldSize,h=1/c,u=t.aspect,d=Math.sqrt(1+u*u)*Math.tan(.5*t.fovX),p=d*d,f=n-r,m=n+r;let g,_;p>f/m?(g=n,_=n*d):(g=.5*m*(1+p),_=.5*Math.sqrt(f*f+2*(n*n+r*r)*p+m*m*p*p));const y=t.projection.pixelsPerMeter(t.center.lat,c),v=t._camera.getCameraToWorldMercator(),x=[0,0,-g*h];e.Q.transformMat4(x,x,v);let b=_*h;const w=t._edgeInsets;if(!(0===w.left&&0===w.top&&0===w.right&&0===w.bottom||w.left===w.right&&w.top===w.bottom)){const i=t._camera.getWorldToCamera(t.worldSize,"meters"===t.projection.zAxisUnit?y:1),a=t._camera.getCameraToClipPerspective(t._fov,t.width/t.height,r,n);a[8]=2*-t.centerOffset.x/t.width,a[9]=2*t.centerOffset.y/t.height;const o=new Float64Array(16);e.a9.mul(o,a,i);const h=new Float64Array(16);e.a9.invert(h,o);const u=e.bt.fromInvProjectionMatrix(h,c,s,!0);for(const r of u.points){const i=((S=r)[0]/=l,S[1]/=l,S[2]=e.bo(S[2],t._center.lat),S);b=Math.max(b,e.Q.len(e.Q.subtract([],x,i)))}}var S;b*=a/(a-1);const T=Math.acos(i[2]),E=Math.atan2(-i[0],-i[1]),M=new hr;M.position=x,M.setPitchBearing(T,E);const A=M.getWorldToCamera(c,y),P=b*c,C=Math.min(t._mercatorZfromZoom(17)*c*-2,-2*P),I=M.getCameraToClipOrthographic(-P,P,-P,P,C,(P+o*y)/i[2]),k=new Float64Array(16);e.a9.multiply(k,I,A);const D=e.Q.fromValues(Math.floor(1e6*x[0])/1e6*c,Math.floor(1e6*x[1])/1e6*c,0),R=.5*a,L=[0,0,0];e.Q.transformMat4(L,D,k),e.Q.scale(L,L,R);const z=[Math.floor(L[0]),Math.floor(L[1]),Math.floor(L[2])],F=[0,0,0];e.Q.sub(F,L,z),e.Q.scale(F,F,-1/R);const O=new Float64Array(16);return e.a9.identity(O),e.a9.translate(O,O,F),e.a9.multiply(k,O,k),[k,P]}const Tr=(e,t)=>oe(e,t&&t.filter((e=>"source.canvas"!==e.identifier))),Er=e.af(ti,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Mr=e.af(ti,["setCenter","setZoom","setBearing","setPitch"]),Ar={version:8,layers:[],sources:{}},Pr={duration:300,delay:0};class Cr extends e.E{constructor(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.map=t,this.scope=i.scope||"",this.globalId=null,this.fragments=[],this.importDepth=i.importDepth||0,this.importsCache=i.importsCache||new Map,this.resolvedImports=i.resolvedImports||new Set,this.transition=e.e({},Pr),this._buildingIndex=new Kt(this),this.crossTileSymbolIndex=new nr,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=i.styleChanges||new y,this.dispatcher=i.dispatcher?i.dispatcher:new e.bZ(e.b_(),this),i.imageManager?this.imageManager=i.imageManager:(this.imageManager=new w,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=i.glyphManager?i.glyphManager:new e.b$(t._requestManager,i.localFontFamily?e.c0.all:i.localIdeographFontFamily?e.c0.ideographs:e.c0.none,i.localFontFamily||i.localIdeographFontFamily),i.modelManager?this.modelManager=i.modelManager:(this.modelManager=new v(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=i.configOptions?i.configOptions:new Map,this._configDependentLayers=i.configDependentLayers?i.configDependentLayers:new Set,this._config=i.config,this._initialConfig=i.initialConfig,this.dispatcher.broadcast("setReferrer",e.c1());const r=this;this._rtlTextPluginCallback=Cr.registerForPluginStateChange((t=>{r.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},((t,i)=>{if(e.c2(t),i&&i.every((e=>e)))for(const e in r._sourceCaches){const t=r._sourceCaches[e],i=t.getSource().type;"vector"!==i&&"geojson"!==i||t.reload()}}))})),this.on("data",(e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getOwnSource(e.sourceId);if(t&&t.vectorLayerIds)for(const i in this._layers){const e=this._layers[i];e.source===t.id&&this._validateLayer(e)}}))}load(e){return e?("string"==typeof e?this.loadURL(e):this.loadJSON(e),this):this}_getGlobalId(t){if(!t)return null;if("string"==typeof t){if(e.c3(t))return t;const i=e.c4(t);if(!i.startsWith("http"))try{return new URL(i,location.href).toString()}catch(e){return i}return i}return"json://".concat(e.c5(JSON.stringify(t)))}_diffStyle(t,i,r){this.globalId=this._getGlobalId(t);const n=(e,t)=>{try{t(null,this.setState(e,r))}catch(e){t(e,!1)}};if("string"==typeof t){const r=this.map._requestManager.normalizeStyleURL(t),a=this.map._requestManager.transformRequest(r,e.R.Style);e.g(a,((t,r)=>{t?this.fire(new e.a(t)):r&&n(r,i)}))}else"object"==typeof t&&n(t,i)}loadURL(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new e.b("dataloading",{dataType:"style"}));const r="boolean"==typeof i.validate?i.validate:!e.c3(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,i.accessToken),this.resolvedImports.add(t);const n=this.importsCache.get(t);if(n)return this._load(n,r);const a=this.map._requestManager.transformRequest(t,e.R.Style);this._request=e.g(a,((i,n)=>{if(this._request=null,i)this.fire(new e.a(i));else if(n)return this.importsCache.set(t,n),this._load(n,r)}))}loadJSON(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new e.b("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=e.f.frame((()=>{this._request=null,this._load(t,!1!==i.validate)}))}loadEmpty(){this.fire(new e.b("dataloading",{dataType:"style"})),this._load(Ar,!1)}_loadImports(t,i,r){if(this.importDepth>=4)return e.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const n=[];for(const e of t){const t=this._createFragmentStyle(e),a=new Promise((e=>{t.once("style.import.load",e),t.once("error",e)})).then((()=>this.mergeAll()));if(n.push(a),this.resolvedImports.has(e.url)){t.loadEmpty();continue}const o=e.data||this.importsCache.get(e.url);o?(t.loadJSON(o,{validate:i}),this._isInternalStyle(o)&&(t.globalId=null)):e.url?t.loadURL(e.url,{validate:i}):t.loadEmpty();const s={style:t,id:e.id,config:e.config};if(r){const e=this.fragments.findIndex((e=>{let{id:t}=e;return t===r}));this.fragments=this.fragments.slice(0,e).concat(s).concat(this.fragments.slice(e))}else this.fragments.push(s)}return Promise.allSettled(n)}getImportGlobalIds(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;for(const i of e.fragments)i.style.globalId&&t.add(i.style.globalId),this.getImportGlobalIds(i.style,t);return[...t.values()]}_createFragmentStyle(t){const i=this.scope?e.aj(t.id,this.scope):t.id;let r;const n=this._initialConfig&&this._initialConfig[i];(t.config||n)&&(r=e.e({},t.config,n));const a=new Cr(this.map,{scope:i,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:r,configOptions:this.options,configDependentLayers:this._configDependentLayers});return a.setEventedParent(this.map,{style:a}),a}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(e){return this.isRootStyle()&&(e.fragment||!!e.schema&&!1!==e.fragment)}_load(t,i){const r=t.schema;if(this._isInternalStyle(t)){const r=e.e({},Ar,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(r,i)}if(this.updateConfig(this._config,r),i&&Tr(this,Q(t)))return;this._loaded=!0,this.stylesheet=e.c6(t);for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1,isInitialLoad:!0});t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(t.glyphs,this.scope);const n=ei(this.stylesheet.layers);if(this._order=n.map((e=>e.id)),this.stylesheet.light&&e.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const e=this.stylesheet.lights[0];this.light=new le(e.properties,e.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new le(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const s of n){const t=e.c7(s,this.scope,this.options);t.isConfigDependent&&this._configDependentLayers.add(t.fqid),t.setEventedParent(this,{layer:{id:t.id}}),this._layers[t.id]=t,this._serializedLayers[t.id]=t.serialize();const i=this.getOwnLayerSourceCache(t),r=!!this.directionalLight&&this.directionalLight.shadowsEnabled();i&&t.canCastShadows()&&r&&(i.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const a=this.stylesheet.terrain;a&&(void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=e.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?e.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(a,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new e.b("data",{dataType:"style"}));const o=this.isRootStyle();t.imports?this._loadImports(t.imports,i).then((()=>{this._reloadImports(),this.fire(new e.b(o?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new e.b(o?"style.load":"style.import.load")))}isRootStyle(){return 0===this.importDepth}mergeAll(){let t,i,r,n,a,o,s,l;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((e=>{if(e.stylesheet){if(null!=e.light&&(t=e.light),e.stylesheet.lights)for(const t of e.stylesheet.lights)"ambient"===t.type&&null!=e.ambientLight&&(i=e.ambientLight),"directional"===t.type&&null!=e.directionalLight&&(r=e.directionalLight);n=this._prioritizeTerrain(n,e.terrain,e.stylesheet.terrain),e.stylesheet.fog&&null!=e.fog&&(a=e.fog),null!=e.stylesheet.camera&&(l=e.stylesheet.camera),null!=e.stylesheet.projection&&(o=e.stylesheet.projection),null!=e.stylesheet.transition&&(s=e.stylesheet.transition)}})),this.light=t,this.ambientLight=i,this.directionalLight=r,this.fog=a,null===n?delete this.terrain:this.terrain=n,this.camera=l||{"camera-projection":"perspective"},this.projection=o||{name:"mercator"},this.transition=e.e({},Pr,s),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(e){const t=i=>{for(const e of i.fragments)t(e.style);e(i)};t(this)}_prioritizeTerrain(e,t,i){const r=e&&0===e.drapeRenderMode;return null===i?t&&0===t.drapeRenderMode?t:r?e:null:null!=t&&(!e||r||t&&1===t.drapeRenderMode)?t:e}mergeTerrain(){let e;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((t=>{e=this._prioritizeTerrain(e,t.terrain,t.stylesheet.terrain)})),null===e?delete this.terrain:this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle((t=>{null!=t.stylesheet.projection&&(e=t.stylesheet.projection)})),this.projection=e||{name:"mercator"}}mergeSources(){const t={},i={},r={};this.forEachFragmentStyle((n=>{for(const i in n._sourceCaches){const r=e.aj(i,n.scope);t[r]=n._sourceCaches[i]}for(const t in n._otherSourceCaches){const r=e.aj(t,n.scope);i[r]=n._otherSourceCaches[t]}for(const t in n._symbolSourceCaches){const i=e.aj(t,n.scope);r[i]=n._symbolSourceCaches[t]}})),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=i,this._mergedSymbolSourceCaches=r}mergeLayers(){var t=this;const i={},r=[],n={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((t=>{for(const n of t._order){const a=t._layers[n];if("slot"===a.type){const t=e.c8(n);if(i[t])continue;i[t]=[]}a.slot&&i[a.slot]?i[a.slot].push(a):r.push(a)}})),this._mergedOrder=[];const a=function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(const o of r)if("slot"===o.type){const t=e.c8(o.id);i[t]&&a(i[t])}else{const i=e.aj(o.id,o.scope);t._mergedOrder.push(i),n[i]=o,o.is3D()&&(t._has3DLayers=!0),"circle"===o.type&&(t._hasCircleLayers=!0),"symbol"===o.type&&(t._hasSymbolLayers=!0)}};a(r),this._mergedLayers=n,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=e.e({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(t,i,r){let n,a,o;const s=e.f.devicePixelRatio>1?"@2x":"";let l=e.g(i.transformRequest(i.normalizeSpriteURL(t,s,".json"),e.R.SpriteJSON),((e,t)=>{l=null,o||(o=e,n=t,h())})),c=e.d(i.transformRequest(i.normalizeSpriteURL(t,s,".png"),e.R.SpriteImage),((e,t)=>{c=null,o||(o=e,a=t,h())}));function h(){if(o)r(o);else if(n&&a){const t=e.f.getImageData(a),i={};for(const r in n){const{width:a,height:o,x:s,y:l,sdf:c,pixelRatio:h,stretchX:u,stretchY:d,content:p}=n[r],f=new e.h({width:a,height:o});e.h.copy(t,f,{x:s,y:l},{x:0,y:0},{width:a,height:o}),i[r]={data:f,pixelRatio:h,sdf:c,stretchX:u,stretchY:d,content:p}}r(null,i)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(t,this.map._requestManager,((t,i)=>{if(this._spriteRequest=null,t)this.fire(new e.a(t));else if(i)for(const e in i)this.imageManager.addImage(e,this.scope,i[e]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new e.b("data",{dataType:"style"}))}))}_validateLayer(t){const i=this.getOwnSource(t.source);if(!i)return;const r=t.sourceLayer;r&&("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(r))&&this.fire(new e.a(new Error('Source layer "'.concat(r,'" does not exist on source "').concat(i.id,'" as specified by style layer "').concat(t.id,'"'))))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded())return!1;if(!this.modelManager.isLoaded())return!1;for(const{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((e,t)=>{const i=this.fragments[t];return i&&i.style&&(e.data=i.style.serialize()),e}))}_serializeSources(){const e={};for(const t in this._sourceCaches){const i=this._sourceCaches[t].getSource();e[i.id]||(e[i.id]=i.serialize())}return e}_serializeLayers(e){const t=[];for(const i of e){const e=this._layers[i];e&&"custom"!==e.type&&t.push(e.serialize())}return t}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return!0;if(this.hasFogTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&e.isDraped(this.getLayerSourceCache(e))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const i=this.getOwnLayer(t);if(i)return i;this.fire(new e.a(new Error("The layer '".concat(t,"' does not exist in the map's style."))))}_checkSource(t){const i=this.getOwnSource(t);if(i)return i;this.fire(new e.a(new Error("The source '".concat(t,"' does not exist in the map's style."))))}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const i=this.calculateLightsBrightness();t.brightness=i||0,i!==this._brightness&&(this._brightness=i,this.dispatcher.broadcast("setBrightness",i));const r=this._changes.isDirty();if(this._changes.isDirty()){const e=this._changes.getLayerUpdatesByScope();for(const t in e){const{updatedIds:i,removedIds:r}=e[t];(i||r)&&this._updateWorkerLayers(t,i,r)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._changes.reset()}const n={};for(const e in this._mergedSourceCaches){const t=this._mergedSourceCaches[e];n[e]=t.used,t.used=!1,t.tileCoverLift=0}for(const e of this._mergedOrder){const i=this._mergedLayers[e];if(i.recalculate(t,this._availableImages),!i.isHidden(t.zoom)){const e=this.getLayerSourceCache(i);e&&(e.used=!0,e.tileCoverLift=Math.max(e.tileCoverLift,i.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let e=i.minzoom||0;e<(i.maxzoom||25.5);e++){const e=this.map.painter;if(e){const r=i.getProgramIds();if(!r)continue;for(const n of r){const r=i.getDefaultProgramParams(n,t.zoom);r&&(e.style=this,this.fog&&(e._fogVisible=!0,r.overrideFog=!0,e.getOrCreateProgram(n,r)),e._fogVisible=!1,r.overrideFog=!1,e.getOrCreateProgram(n,r),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(r.overrideRtt=!0,e.getOrCreateProgram(n,r)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const a in n){const t=this._mergedSourceCaches[a];n[a]!==t.used&&t.getSource().fire(new e.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:t.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),r&&this.fire(new e.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=this._changes.getUpdatedImages();if(e.length){for(const t in this._sourceCaches)this._sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changes.resetUpdatedImages()}}_updateWorkerLayers(e,t,i){const r=this.getFragmentStyle(e);r&&this.dispatcher.broadcast("updateLayers",{layers:t?r._serializeLayers(t):[],scope:e,removedIds:i||[],options:r.options})}setState(i,r){if(this._checkLoaded(),Tr(this,Q(i)))return!1;(i=e.c6(i)).layers=ei(i.layers);const n=function(e,i){if(!e)return[{command:ti.setStyle,args:[i]}];let r=[];try{if(!t(e.version,i.version))return[{command:ti.setStyle,args:[i]}];t(e.center,i.center)||r.push({command:ti.setCenter,args:[i.center]}),t(e.zoom,i.zoom)||r.push({command:ti.setZoom,args:[i.zoom]}),t(e.bearing,i.bearing)||r.push({command:ti.setBearing,args:[i.bearing]}),t(e.pitch,i.pitch)||r.push({command:ti.setPitch,args:[i.pitch]}),t(e.sprite,i.sprite)||r.push({command:ti.setSprite,args:[i.sprite]}),t(e.glyphs,i.glyphs)||r.push({command:ti.setGlyphs,args:[i.glyphs]}),t(e.imports,i.imports)||function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0;i=i||[];const n=(e=e||[]).map(si),a=i.map(si),o=e.reduce(li,{}),s=i.reduce(li,{}),l=n.slice();let c,h,u,d;for(c=0,h=0;c<n.length;c++)u=n[c],s.hasOwnProperty(u)?h++:(r.push({command:ti.removeImport,args:[u]}),l.splice(l.indexOf(u,h),1));for(c=0,h=0;c<a.length;c++)u=a[a.length-1-c],l[l.length-1-c]!==u&&(o.hasOwnProperty(u)?(r.push({command:ti.removeImport,args:[u]}),l.splice(l.lastIndexOf(u,l.length-h),1)):h++,d=l[l.length-c],r.push({command:ti.addImport,args:[s[u],d]}),l.splice(l.length-c,0,u));for(const p of i){const e=o[p.id];e&&!t(e,p)&&r.push({command:ti.updateImport,args:[p.id,p]})}}(e.imports,i.imports,r),t(e.transition,i.transition)||r.push({command:ti.setTransition,args:[i.transition]}),t(e.light,i.light)||r.push({command:ti.setLight,args:[i.light]}),t(e.fog,i.fog)||r.push({command:ti.setFog,args:[i.fog]}),t(e.projection,i.projection)||r.push({command:ti.setProjection,args:[i.projection]}),t(e.lights,i.lights)||r.push({command:ti.setLights,args:[i.lights]}),t(e.camera,i.camera)||r.push({command:ti.setCamera,args:[i.camera]});const n={},a=[];!function(e,i,r,n){let a;for(a in i=i||{},e=e||{})e.hasOwnProperty(a)&&(i.hasOwnProperty(a)||ri(a,r,n));for(a in i){if(!i.hasOwnProperty(a))continue;const o=i[a];e.hasOwnProperty(a)?t(e[a],o)||("geojson"===e[a].type&&"geojson"===o.type&&ai(e,i,a)?r.push({command:ti.setGeoJSONSourceData,args:[a,o.data]}):ni(a,i,r,n)):ii(a,i,r)}}(e.sources,i.sources,a,n);const o=[];e.layers&&e.layers.forEach((e=>{e.source&&n[e.source]?r.push({command:ti.removeLayer,args:[e.id]}):o.push(e)}));let s=e.terrain;s&&n[s.source]&&(r.push({command:ti.setTerrain,args:[void 0]}),s=void 0),r=r.concat(a),t(s,i.terrain)||r.push({command:ti.setTerrain,args:[i.terrain]}),function(e,i,r){i=i||[];const n=(e=e||[]).map(si),a=i.map(si),o=e.reduce(li,{}),s=i.reduce(li,{}),l=n.slice(),c=Object.create(null);let h,u,d,p,f,m,g;for(h=0,u=0;h<n.length;h++)d=n[h],s.hasOwnProperty(d)?u++:(r.push({command:ti.removeLayer,args:[d]}),l.splice(l.indexOf(d,u),1));for(h=0,u=0;h<a.length;h++)d=a[a.length-1-h],l[l.length-1-h]!==d&&(o.hasOwnProperty(d)?(r.push({command:ti.removeLayer,args:[d]}),l.splice(l.lastIndexOf(d,l.length-u),1)):u++,m=l[l.length-h],r.push({command:ti.addLayer,args:[s[d],m]}),l.splice(l.length-h,0,d),c[d]=!0);for(h=0;h<a.length;h++)if(d=a[h],p=o[d],f=s[d],!c[d]&&!t(p,f))if(t(p.source,f.source)&&t(p["source-layer"],f["source-layer"])&&t(p.type,f.type)){for(g in oi(p.layout,f.layout,r,d,null,ti.setLayoutProperty),oi(p.paint,f.paint,r,d,null,ti.setPaintProperty),t(p.slot,f.slot)||r.push({command:ti.setSlot,args:[d,f.slot]}),t(p.filter,f.filter)||r.push({command:ti.setFilter,args:[d,f.filter]}),t(p.minzoom,f.minzoom)&&t(p.maxzoom,f.maxzoom)||r.push({command:ti.setLayerZoomRange,args:[d,f.minzoom,f.maxzoom]}),p)p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&"slot"!==g&&(0===g.indexOf("paint.")?oi(p[g],f[g],r,d,g.slice(6),ti.setPaintProperty):t(p[g],f[g])||r.push({command:ti.setLayerProperty,args:[d,g,f[g]]}));for(g in f)f.hasOwnProperty(g)&&!p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&"slot"!==g&&(0===g.indexOf("paint.")?oi(p[g],f[g],r,d,g.slice(6),ti.setPaintProperty):t(p[g],f[g])||r.push({command:ti.setLayerProperty,args:[d,g,f[g]]}))}else r.push({command:ti.removeLayer,args:[d]}),m=l[l.lastIndexOf(d)+1],r.push({command:ti.addLayer,args:[f,m]})}(o,i.layers,r)}catch(e){console.warn("Unable to compute style diff:",e),r=[{command:ti.setStyle,args:[i]}]}return r}(this.serialize(),i).filter((e=>!(e.command in Mr)));if(0===n.length)return!1;const a=n.filter((e=>!(e.command in Er)));if(a.length>0)throw new Error("Unimplemented: ".concat(a.map((e=>e.command)).join(", "),"."));const o=[];return n.forEach((e=>{o.push(this[e.command].apply(this,e.args))})),r&&Promise.all(o).then(r),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(t,i){return this.getImage(t)?this.fire(new e.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(t,this.scope,i),this._afterImageUpdated(t),this)}updateImage(e,t){this.imageManager.updateImage(e,this.scope,t)}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._afterImageUpdated(t),this):this.fire(new e.a(new Error("No image with this name exists.")))}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(t),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new e.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._checkLoaded(),this._validate(ne,"models.".concat(e),t,null,i)||(this.modelManager.addModel(e,t,this.scope),this._changes.setDirty()),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new e.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._checkLoaded(),void 0!==this.getOwnSource(t))throw new Error('There is already a source with ID "'.concat(t,'".'));if(!i.type)throw new Error("The type property must be defined, but only the following properties were given: ".concat(Object.keys(i).join(", "),"."));if(["vector","raster","geojson","video","image"].indexOf(i.type)>=0&&this._validate(X,"sources.".concat(t),i,null,r))return;this.map&&this.map._collectResourceTiming&&(i.collectResourceTiming=!0);const n=jt(t,i,this.dispatcher,this);n.scope=this.scope,n.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(n.id),source:n.serialize(),sourceId:n.id})));const a=t=>{const i=(t?"symbol:":"other:")+n.id,r=e.aj(i,this.scope),a=this._sourceCaches[i]=new Qt(r,n,t);(t?this._symbolSourceCaches:this._otherSourceCaches)[n.id]=a,a.onAdd(this.map)};a(!1),"vector"!==i.type&&"geojson"!==i.type||a(!0),n.onAdd&&n.onAdd(this.map),r.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const i=this.getOwnSource(t);if(!i)throw new Error("There is no source with this ID");for(const n in this._layers)if(this._layers[n].source===t)return this.fire(new e.a(new Error('Source "'.concat(t,'" cannot be removed while layer "').concat(n,'" is using it.'))));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new e.a(new Error('Source "'.concat(t,'" cannot be removed while terrain is using it.'))));const r=this.getOwnSourceCaches(t);for(const n of r){const t=e.c8(n.id);delete this._sourceCaches[t],this._changes.discardSourceCacheUpdate(n.id),n.fire(new e.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:n.getSource().id})),n.setEventedParent(null),n.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),i.setEventedParent(null),i.onRemove&&i.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getOwnSource(e).setData(t),this._changes.setDirty()}getOwnSource(e){const t=this.getOwnSourceCache(e);return t&&t.getSource()}getOwnSources(){const e=[];for(const t in this._otherSourceCaches){const i=this.getOwnSourceCache(t);i&&e.push(i.getSource())}return e}areTilesLoaded(){const e=this._mergedSourceCaches;for(const t in e){const i=e[t]._tiles;for(const e in i){const t=i[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const i=this._getTransitionParameters();for(const e of t){if(this._validate(J,"lights",e))return;switch(e.type){case"ambient":if(this.ambientLight){const t=this.ambientLight;t.set(e),t.updateTransitions(i)}else this.ambientLight=new xe(e,be,this.scope,this.options);break;case"directional":if(this.directionalLight){const t=this.directionalLight;t.set(e),t.updateTransitions(i)}else this.directionalLight=new xe(e,we,this.scope,this.options)}}const r=new e.N(this.z||0,i);this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,i=this.ambientLight;if(!t||!i)return;const r=e=>.2126*(e[0]<=.03928?e[0]/12.92:Math.pow((e[0]+.055)/1.055,2.4))+.7152*(e[1]<=.03928?e[1]/12.92:Math.pow((e[1]+.055)/1.055,2.4))+.0722*(e[2]<=.03928?e[2]/12.92:Math.pow((e[2]+.055)/1.055,2.4)),n=t.properties.get("color").toArray01(),a=t.properties.get("intensity"),o=t.properties.get("direction"),s=1-e.bT(o.x,o.y,o.z)[2]/90,l=r(n)*a*s,c=i.properties.get("color").toArray01(),h=i.properties.get("intensity");return(l+r(c)*h)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(e.c9(t)){const i=e.ca(t),r=this.fragments.find((e=>{let{id:t}=e;return t===i}));if(!r)throw new Error("Style import not found: ".concat(t));const n=e.c8(t);return r.style.getFragmentStyle(n)}{const e=this.fragments.find((e=>{let{id:i}=e;return i===t}));if(!e)throw new Error("Style import not found: ".concat(t));return e.style}}getConfigProperty(t,i){const r=this.getFragmentStyle(t);if(!r)return null;const n=e.aj(i,r.scope),a=r.options.get(n),o=a?a.value||a.default:null;return o?o.serialize():null}setConfigProperty(t,i,r){const n=this.getFragmentStyle(t);if(!n)return;const a=n.stylesheet.schema;if(!a||!a[i])return;const o=e.t(r);if("success"!==o.result)return void Tr(this,o.value);const s=o.value.expression,l=e.aj(i,n.scope),c=n.options.get(l);if(!c)return;let h;const{minValue:u,maxValue:d,stepValue:p,type:f,values:m}=a[i],g=e.t(a[i].default);"success"===g.result&&(h=g.value.expression),h?(this.options.set(l,{...c,value:s,default:h,minValue:u,maxValue:d,stepValue:p,type:f,values:m}),this.updateConfigDependencies()):this.fire(new e.a(new Error('No schema defined for the config option "'.concat(i,'" in the "').concat(t,'" fragment.'))))}getConfig(t){const i=this.getFragmentStyle(t);if(!i)return null;const r=i.stylesheet.schema;if(!r)return null;const n={};for(const a in r){const t=e.aj(a,i.scope),r=i.options.get(t),o=r?r.value||r.default:null;n[a]=o?o.serialize():null}return n}setConfig(e,t){const i=this.getFragmentStyle(e);i&&(i.updateConfig(t,i.stylesheet.schema),this.updateConfigDependencies())}getSchema(e){const t=this.getFragmentStyle(e);return t?t.stylesheet.schema:null}setSchema(e,t){const i=this.getFragmentStyle(e);i&&(i.stylesheet.schema=t,i.updateConfig(i._config,t),this.updateConfigDependencies())}updateConfig(t,i){if(this._config=t,t||i)if(i)for(const r in i){let n,a;const o=e.t(i[r].default);if("success"===o.result&&(n=o.value.expression),t&&void 0!==t[r]){const i=e.t(t[r]);"success"===i.result&&(a=i.value.expression)}const{minValue:s,maxValue:l,stepValue:c,type:h,values:u}=i[r];if(n){const t=e.aj(r,this.scope);this.options.set(t,{default:n,value:a,minValue:s,maxValue:l,stepValue:c,type:h,values:u})}else this.fire(new e.a(new Error('No schema defined for config option "'.concat(r,'".'))))}else this.fire(new e.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const e of this._configDependentLayers){const t=this.getLayer(e);t&&(t.possiblyEvaluateVisibility(),this._updateLayer(t))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(t,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const n=t.id;if(this._layers[n])return void this.fire(new e.a(new Error('Layer with id "'.concat(n,'" already exists on this map'))));let a;if("custom"===t.type){if(Tr(this,e.cb(t)))return;a=e.c7(t,this.scope,this.options)}else{if("object"==typeof t.source&&(this.addSource(n,t.source),t=e.c6(t),t=e.e(t,{source:n})),this._validate(ee,"layers.".concat(n),t,{arrayIndex:-1},r))return;a=e.c7(t,this.scope,this.options),this._validateLayer(a),a.setEventedParent(this,{layer:{id:n}}),this._serializedLayers[a.id]=a.serialize()}a.isConfigDependent&&this._configDependentLayers.add(a.fqid);let o=this._order.length;if(i){const t=this._order.indexOf(i);if(-1===t)return void this.fire(new e.a(new Error('Layer with id "'.concat(i,'" does not exist on this map.'))));a.slot===this._layers[i].slot?o=t:e.w('Layer with id "'.concat(i,'" has a different slot. Layers can only be rearranged within the same slot.'))}this._order.splice(o,0,n),this._layerOrderChanged=!0,this._layers[n]=a;const s=this.getOwnLayerSourceCache(a),l=!!this.directionalLight&&this.directionalLight.shadowsEnabled();s&&a.canCastShadows()&&l&&(s.castsShadows=!0);const c=this._changes.getRemovedLayer(a);if(c&&a.source&&s&&"custom"!==a.type){this._changes.discardLayerRemoval(a);const t=e.aj(a.source,a.scope);c.type!==a.type?this._changes.updateSourceCache(t,"clear"):(this._changes.updateSourceCache(t,"reload"),s.pause())}this._updateLayer(a),a.onAdd&&a.onAdd(this.map),a.scope=this.scope,this.mergeLayers()}moveLayer(t,i){this._checkLoaded();const r=this._checkLayer(t);if(!r)return;if(t===i)return;const n=this._order.indexOf(t);this._order.splice(n,1);let a=this._order.length;if(i){const t=this._order.indexOf(i);if(-1===t)return void this.fire(new e.a(new Error('Layer with id "'.concat(i,'" does not exist on this map.'))));r.slot===this._layers[i].slot?a=t:e.w('Layer with id "'.concat(i,'" has a different slot. Layers can only be rearranged within the same slot.'))}this._order.splice(a,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(e){this._checkLoaded();const t=this._checkLayer(e);if(!t)return;t.setEventedParent(null);const i=this._order.indexOf(e);this._order.splice(i,1),delete this._layers[e],delete this._serializedLayers[e],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(t.fqid),this._changes.removeLayer(t);const r=this.getOwnLayerSourceCache(t);if(r&&r.castsShadows){let e=!1;for(const i in this._layers)if(this._layers[i].source===t.source&&this._layers[i].canCastShadows()){e=!0;break}r.castsShadows=e}t.onRemove&&t.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(e,t,i){this._checkLoaded();const r=this._checkLayer(e);r&&(r.minzoom===t&&r.maxzoom===i||(null!=t&&(r.minzoom=t),null!=i&&(r.maxzoom=i),this._updateLayer(r)))}setSlot(e,t){this._checkLoaded();const i=this._checkLayer(e);i&&i.slot!==t&&(i.slot=t,this._updateLayer(i))}setFilter(i,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const a=this._checkLayer(i);if(a&&!t(a.filter,r))return null==r?(a.filter=void 0,void this._updateLayer(a)):void(this._validate(te,"layers.".concat(a.id,".filter"),r,{layerType:a.type},n)||(a.filter=e.c6(r),this._updateLayer(a)))}getFilter(t){const i=this._checkLayer(t);if(i)return e.c6(i.filter)}setLayoutProperty(i,r,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const o=this._checkLayer(i);if(o&&!t(o.getLayoutProperty(r),n)){if(null!=n&&(!a||!1!==a.validate)&&Tr(o,re.call(Q,{key:"layers.".concat(i,".layout.").concat(r),layerType:o.type,objectKey:r,value:n,styleSpec:e.G,style:{glyphs:!0,sprite:!0}})))return;o.setLayoutProperty(r,n),o.isConfigDependent&&this._configDependentLayers.add(o.fqid),this._updateLayer(o)}}getLayoutProperty(e,t){const i=this._checkLayer(e);if(i)return i.getLayoutProperty(t)}setPaintProperty(i,r,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const o=this._checkLayer(i);if(!o)return;if(t(o.getPaintProperty(r),n))return;if(null!=n&&(!a||!1!==a.validate)&&Tr(o,ie.call(Q,{key:"layers.".concat(i,".paint.").concat(r),layerType:o.type,objectKey:r,value:n,styleSpec:e.G})))return;const s=o.setPaintProperty(r,n);o.isConfigDependent&&this._configDependentLayers.add(o.fqid),s&&this._updateLayer(o),this._changes.updatePaintProperties(o)}getPaintProperty(e,t){const i=this._checkLayer(e);if(i)return i.getPaintProperty(t)}setFeatureState(t,i){this._checkLoaded();const r=t.source,n=t.sourceLayer,a=this._checkSource(r);if(!a)return;const o=a.type;if("geojson"===o&&n)return void this.fire(new e.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===o&&!n)return void this.fire(new e.a(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new e.a(new Error("The feature id parameter must be provided.")));const s=this.getOwnSourceCaches(r);for(const e of s)e.setFeatureState(n,t.id,i)}removeFeatureState(t,i){this._checkLoaded();const r=t.source,n=this._checkSource(r);if(!n)return;const a=n.type,o="vector"===a?t.sourceLayer:void 0;if("vector"===a&&!o)return void this.fire(new e.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(i&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new e.a(new Error("A feature id is required to remove its specific state property.")));const s=this.getOwnSourceCaches(r);for(const e of s)e.removeFeatureState(o,t.id,i)}getFeatureState(t){this._checkLoaded();const i=t.source,r=t.sourceLayer,n=this._checkSource(i);if(n){if("vector"!==n.type||r)return void 0===t.id&&this.fire(new e.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(i)[0].getFeatureState(r,t.id);this.fire(new e.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=e.e({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return e.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),i=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return e.cc({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:i,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(e=>void 0!==e))}_updateLayer(t){this._changes.updateLayer(t);const i=this.getLayerSourceCache(t),r=e.aj(t.source,t.scope),n=this._changes.getUpdatedSourceCaches();t.source&&!n[r]&&i&&"raster"!==i.getSource().type&&(this._changes.updateSourceCache(r,"reload"),i.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const t=e=>"fill-extrusion"===this._mergedLayers[e].type||"model"===this._mergedLayers[e].type,i=this.order,r={},n=[];for(let o=i.length-1;o>=0;o--){const a=i[o];if(t(a)){r[a]=o;for(const t of e){const e=t[a];if(e)for(const t of e)n.push(t)}}}n.sort(((e,t)=>t.intersectionZ-e.intersectionZ));const a=[];for(let o=i.length-1;o>=0;o--){const s=i[o];if(t(s))for(let e=n.length-1;e>=0;e--){const t=n[e].feature;if(r[t.layer.id]<o)break;a.push(t),n.pop()}else for(const t of e){const e=t[s];if(e)for(const t of e)a.push(t.feature)}}return a}queryRenderedFeatures(t,i,r){i&&i.filter&&this._validate(te,"queryRenderedFeatures.filter",i.filter,null,i),i.scope=this.scope,i.availableImages=this._availableImages,i.serializedLayers=this._serializedLayers;const n={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new e.a(new Error("parameters.layers must be an Array."))),[];for(const t of i.layers){const i=this._mergedLayers[t];if(!i)return this.fire(new e.a(new Error("The layer '".concat(t,"' does not exist in the map's style and cannot be queried for features.")))),[];n[i.source]=!0}}const a=[],o=i.serializedLayers||{},s=i&&i.layers?i.layers.some((e=>{const t=this.getLayer(e);return t&&t.is3D()})):this.has3DLayers(),l=Se.createFromScreenPoints(t,r);for(const e in this._mergedSourceCaches){const t=this._mergedSourceCaches[e].getSource();if(!t||t.scope!==i.scope)continue;const c=this._mergedSourceCaches[e].getSource().id;i.layers&&!n[c]||a.push(Gt(this._mergedSourceCaches[e],this._mergedLayers,o,l,i,r,s,!!this.map._showQueryGeometry))}return this.placement&&a.push(function(e,t,i,r,n,a,o){const s={},l=a.queryRenderedSymbols(r),c=[];for(const h of Object.keys(l).map(Number))c.push(o[h]);c.sort(Ht);for(const h of c){const i=h.featureIndex.lookupSymbolFeatures(l[h.bucketInstanceId],t,h.bucketIndex,h.sourceLayerIndex,n.filter,n.layers,n.availableImages,e);for(const e in i){const t=s[e]=s[e]||[],r=i[e];r.sort(((e,t)=>{const i=h.featureSortOrder;if(i){const r=i.indexOf(e.featureIndex);return i.indexOf(t.featureIndex)-r}return t.featureIndex-e.featureIndex}));for(const e of r)t.push(e)}}for(const h in s)s[h].forEach((t=>{const r=t.feature,n=i(e[h]);if(!n)return;const a=n.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=a}));return s}(this._mergedLayers,o,this.getLayerSourceCache.bind(this),l.screenGeometry,i,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(a)}querySourceFeatures(e,t){t&&t.filter&&this._validate(te,"querySourceFeatures.filter",t.filter,null,t);const i=this.getOwnSourceCaches(e);let r=[];for(const n of i)r=r.concat(qt(n,t));return r}addSourceType(e,t,i){return Cr.getSourceType(e)?i(new Error('A source type called "'.concat(e,'" already exists.'))):(Cr.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},i):i(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(e,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const n=this.light.getLight();let a=!1;for(const s in e)if(!t(e[s],n[s])){a=!0;break}if(!a)return;const o=this._getTransitionParameters();this.light.setLight(e,i,r),this.light.updateTransitions(o)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()&&0!==r||delete this.terrain,null===i?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let n=i;const a=null==i.source;if(1===r){if("object"==typeof n.source){const t="terrain-dem-src";this.addSource(t,n.source),n=e.c6(n),n=e.e(n,{source:t})}const t=e.e({},n),i={};if(this.terrain&&a){t.source=this.terrain.get().source;const e=this.terrain?this.getFragmentStyle(this.terrain.scope):null;e&&(i.style=e.serialize())}if(this._validate(K,"terrain",t,i))return}if(!this.terrain||this.terrain.scope!==this.scope&&!a||this.terrain&&r!==this.terrain.drapeRenderMode){if(!n)return;this._createTerrain(n,r),this.fire(new e.b("data",{dataType:"style"}))}else{const r=this.terrain,a=r.get();for(const t of Object.keys(e.G.terrain))!n.hasOwnProperty(t)&&e.G.terrain[t].default&&(n[t]=e.G.terrain[t].default);for(const n in i)if(!t(i[n],a[n])){r.set(i,this.options),this.stylesheet.terrain=i;const t=this._getTransitionParameters({duration:0});r.updateTransitions(t),this.fire(new e.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const t=this.fog=new ve(e,this.map.transform,this.scope,this.options);this.stylesheet.fog=t.get();const i=this._getTransitionParameters({duration:0});t.updateTransitions(i)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask((()=>{for(const e of this.map._markers)e._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const i=this.fog;if(!t(i.get(),e)){i.set(e,this.options),this.stylesheet.fog=i.get();const t=this._getTransitionParameters({duration:0});i.updateTransitions(t)}}else this._createFog(e);this._markersNeedUpdate=!0}_getTransitionParameters(t){return{now:e.f.now(),transition:e.e(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const e=[],t=[];for(const i in this._mergedLayers)this.isLayerDraped(this._mergedLayers[i])?e.push(i):t.push(i);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}_createTerrain(e,t){const i=this.terrain=new he(e,t,this.scope,this.options);1===t&&(this.stylesheet.terrain=e),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const r=this._getTransitionParameters({duration:0});i.updateTransitions(r)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"symbol"===t.type&&this._updateLayer(t)}}_validate(t,i,r,n){let a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(a&&!1===a.validate)return!1;const o=e.e({},this.serialize());return Tr(this,t.call(Q,e.e({key:i,style:o,value:r,styleSpec:e.G},n)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.cd.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(e){const t=this.getSourceCaches(e);for(const i of t)i.clearTiles()}clearSources(){for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}reloadSource(e){const t=this.getSourceCaches(e);for(const i of t)i.resume(),i.reload()}reloadSources(){for(const e of this.getSources())e.reload&&e.reload()}updateSources(e){let t;this.directionalLight&&(t=br(this.directionalLight));for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].update(e,void 0,void 0,t)}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(t,i,r,n){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=!1,s=!1;const l={},c={};for(const h of this._mergedOrder){const i=this._mergedLayers[h];if("symbol"!==i.type)continue;const r=e.aj(i.source,i.scope);let n=l[r];if(!n){const e=this.getLayerSourceCache(i);if(!e)continue;const t=e.getRenderableIds(!0).map((t=>e.getTileByID(t)));c[r]=t.slice(),n=l[r]=t.sort(((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)))}const a=this.crossTileSymbolIndex.addLayer(i,n,t.center.lng,t.projection);o=o||a}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),a=a||this._layerOrderChanged||0===r,this._layerOrderChanged&&this.fire(new e.b("neworder")),(a||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.f.now(),t.zoom))&&(this.pauseablePlacement=new $i(t,this._mergedOrder,a,i,r,n,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,l,c),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.f.now()),s=!0),o&&this.pauseablePlacement.placement.setStale()),s||o){this._buildingIndex.onNewFrame(t.zoom);for(const t of this._mergedOrder){const i=this._mergedLayers[t];"symbol"===i.type&&this.placement.updateLayerOpacities(i,l[e.aj(i.source,i.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.f.now())}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(t,i){this._checkLoaded();const r=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==r.findIndex((e=>{let{id:i}=e;return i===t.id})))return void this.fire(new e.a(new Error("Import with id '".concat(t.id,"' already exists in the map's style."))));if(!i)return r.push(t),this._loadImports([t],!0);const n=r.findIndex((e=>{let{id:t}=e;return t===i}));return-1===n&&this.fire(new e.a(new Error('Import with id "'.concat(i,'" does not exist on this map.')))),this.stylesheet.imports=r.slice(0,n).concat(t).concat(r.slice(n)),this._loadImports([t],!0,i)}updateImport(e,i){this._checkLoaded();const r=this.stylesheet.imports||[],n=this.getImportIndex(e);return-1===n?this:"string"==typeof i?(this.setImportUrl(e,i),this):(i.url&&i.url!==r[n].url&&this.setImportUrl(e,i.url),t(i.config,r[n].config)||this.setImportConfig(e,i.config),t(i.data,r[n].data)||this.setImportData(e,i.data),this)}moveImport(e,t){this._checkLoaded();let i=this.stylesheet.imports||[];const r=this.getImportIndex(e);if(-1===r)return this;const n=this.getImportIndex(t);if(-1===n)return this;const a=i[r],o=this.fragments[r];return i=i.filter((t=>{let{id:i}=t;return i!==e})),this.fragments=this.fragments.filter((t=>{let{id:i}=t;return i!==e})),this.stylesheet.imports=i.slice(0,n).concat(a).concat(i.slice(n)),this.fragments=this.fragments.slice(0,n).concat(o).concat(this.fragments.slice(n)),this.mergeLayers(),this}setImportUrl(e,t){this._checkLoaded();const i=this.stylesheet.imports||[],r=this.getImportIndex(e);if(-1===r)return this;i[r].url=t;const n=this.fragments[r];return n.style=this._createFragmentStyle(i[r]),n.style.on("style.import.load",(()=>this.mergeAll())),n.style.loadURL(t),this}setImportData(e,t){this._checkLoaded();const i=this.getImportIndex(e),r=this.stylesheet.imports||[];return-1===i?this:t?(this.fragments[i].style.setState(t),this._reloadImports(),this):(delete r[i].data,this.setImportUrl(e,r[i].url))}setImportConfig(e,t){this._checkLoaded();const i=this.getImportIndex(e),r=this.stylesheet.imports||[];if(-1===i)return this;t?r[i].config=t:delete r[i].config;const n=this.fragments[i],a=n.style.stylesheet&&n.style.stylesheet.schema;return n.config=t,n.style.updateConfig(t,a),this.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();const t=this.stylesheet.imports||[],i=this.getImportIndex(e);-1!==i&&(t.splice(i,1),this.fragments[i].style._remove(),this.fragments.splice(i,1),this._reloadImports())}getImportIndex(t){const i=(this.stylesheet.imports||[]).findIndex((e=>e.id===t));return-1===i&&this.fire(new e.a(new Error("Import '".concat(t,"' does not exist in the map's style and cannot be updated.")))),i}getLayer(e){return this._mergedLayers[e]}getSources(){const e=[];for(const t in this._mergedOtherSourceCaches){const i=this._mergedOtherSourceCaches[t];i&&e.push(i.getSource())}return e}getSource(e,t){const i=this.getSourceCache(e,t);return i&&i.getSource()}getLayerSource(e){const t=this.getLayerSourceCache(e);return t&&t.getSource()}getSourceCache(t,i){const r=e.aj(t,i);return this._mergedOtherSourceCaches[r]}getLayerSourceCache(t){const i=e.aj(t.source,t.scope);return"symbol"===t.type?this._mergedSymbolSourceCaches[i]:this._mergedOtherSourceCaches[i]}getSourceCaches(e){if(null==e)return Object.values(this._mergedSourceCaches);const t=[];return this._mergedOtherSourceCaches[e]&&t.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&t.push(this._mergedSymbolSourceCaches[e]),t}updateSourceCaches(){const e=this._changes.getUpdatedSourceCaches();for(const t in e){const i=e[t];"reload"===i?this.reloadSource(t):"clear"===i&&this.clearSource(t)}}updateLayers(e){const t=this._changes.getUpdatedPaintProperties();for(const i of t){const t=this.getLayer(i);t&&t.updateTransitions(e)}}getImages(e,t,i){this.imageManager.getImages(t.icons,t.scope,i),this._updateTilesForChangedImages();const r=e=>{e&&e.setDependencies(t.tileID.key,t.type,t.icons)};r(this._otherSourceCaches[t.source]),r(this._symbolSourceCaches[t.source])}getGlyphs(e,t,i){this.glyphManager.getGlyphs(t.stacks,t.scope,i)}getResource(t,i,r){return e.ce(i,r)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(t){const i=this.getOwnSourceCaches(t);return 0===i.length?(this.fire(new e.a(new Error("There is no source with ID '".concat(t,"'")))),!1):i.every((e=>e.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((e=>{e.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Cr.getSourceType=function(e){return Vt[e]},Cr.setSourceType=function(e,t){Vt[e]=t},Cr.registerForPluginStateChange=e.bY;var Ir="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",kr="\nout vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color) {\n#ifdef INDICATOR_CUTOUT\nfloat holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}",Dr="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}",Rr="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Lr="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",zr="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Fr="highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {\n#ifdef FOG_DITHERING\nvec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);\n#else\nreturn color;\n#endif\n}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",Or="#ifdef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",Br="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec4 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));velocity/=max(u_max_speed,length(velocity));return velocity;}\n#endif\nuniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}",Nr="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif//RENDER_SHADOWS",Vr="#ifdef RENDER_SHADOWS\n#ifdef DEPTH_TEXTURE\nuniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;\n#else\nuniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;\n#endif\nuniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_1,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;\n#ifdef DEPTH_TEXTURE\nshadow_depth=texture(u_shadowmap_0,uv).r;\n#else\nshadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\n#endif\nreturn step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;\n#ifdef NATIVE\nhighp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));\n#else\nhighp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(\nshadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\n);\n#endif\nvec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\n#ifdef SHADOWS_SINGLE_CASCADE\nlight_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);\n#else\nlight_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const jr=[];Zr(Ir,jr),Zr(Dr,jr),Zr(kr,jr);const Ur={"_prelude_fog.vertex.glsl":zr,"_prelude_terrain.vertex.glsl":Lr,"_prelude_shadow.vertex.glsl":Nr,"_prelude_fog.fragment.glsl":Fr,"_prelude_shadow.fragment.glsl":Vr,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif//LIGHTING_3D_MODE","_prelude_raster_array.glsl":Or,"_prelude_raster_particle.glsl":Br},Gr={};Qr("",Lr),Qr(Fr,zr),Qr(Vr,Nr),Qr(Or,""),Qr(Br,"");const qr=Qr(kr,Dr),Hr=Ir;var Wr={background:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),circle:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:Qr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Qr('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:Qr("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Qr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:Qr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Qr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),fill:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutline:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nuniform float u_emissive_strength;in float v_height;void main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:Qr("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\nout highp float v_depth;void main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\nin vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nout vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:Qr('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:Qr("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:Qr("precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    \nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),linePattern:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform mediump float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 v_uv;\n#endif\n#ifdef LINE_JOIN_NONE\nin vec2 v_pattern_data;\n#endif\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}\n#endif\n#ifdef LINE_JOIN_NONE\nfloat pattern_len=pattern_size.x/aspect;float segment_phase=pattern_len-mod((v_linesofar-v_pattern_data.x),pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_ground(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec4 a_packed;\n#endif\nin float a_linesofar;\n#ifdef LINE_JOIN_NONE\nin vec2 a_pattern_data;out vec2 v_pattern_data;\n#endif\nuniform mat4 u_matrix;uniform mediump float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec4 v_uv;\n#endif\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nfloat a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef LINE_JOIN_NONE\nv_width+=ANTIALIASING;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5/u_tile_units_to_pixels;v_linesofar+=line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),raster:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nuv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:Qr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'#include "_prelude_raster_particle.glsl"\nin float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(\nmod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);v_particle_speed=length(velocity);}gl_PointSize=1.0;}'),rasterParticleTexture:Qr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Qr('#include "_prelude_raster_particle.glsl"\nuniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp float speed=velocity==INVALID_VELOCITY ? 0.0 : length(velocity);highp float reset_rate_bump=speed*u_reset_rate;highp vec2 particle_pos_min=-u_particle_pos_offset;highp vec2 particle_pos_max=vec2(1.0)+u_particle_pos_offset;highp vec2 pos_drop_rate=vec2(1.0)-step(particle_pos_min,pos)+step(particle_pos_max,pos);highp float drop_rate=max(u_reset_rate+reset_rate_bump,length(pos_drop_rate));highp float drop=step(1.0-drop_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}',"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:Qr('#include "_prelude_lighting.glsl"\nuniform sampler2D u_texture;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\nin float v_fade_opacity;in vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\n#ifdef COLOR_ADJUSTMENT\nuniform mat4 u_color_adj_mat;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nlowp float alpha=opacity*v_fade_opacity;vec4 out_color;\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);\n#else\nout_color=texture(u_texture,v_tex_a);\n#endif\n#ifdef COLOR_ADJUSTMENT\nout_color=u_color_adj_mat*out_color;\n#endif\nout_color*=alpha;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nv_tex_a=a_tex/u_texsize;\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\nv_fade_opacity=out_fade_opacity;}'),symbolSDF:Qr('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec2 v_data0;out vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}'),symbolTextAndIcon:Qr('#include "_prelude_lighting.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout float v_draw_halo;out vec4 v_data0;out vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nfloat out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\n#endif\nfloat gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}'),terrainRaster:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;in vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nvec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:Qr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:Qr('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Rr),skyboxGradient:Qr('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Rr),skyboxCapture:Qr("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nraster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\ncolor=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:Qr('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;\n#ifndef NATIVE\nc=dither(c,gl_FragCoord.xy+u_temporal_offset);\n#endif\nglFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:Qr('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nreturn vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:Qr("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:Qr("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}")};function Zr(e,t){const i=e.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let r of i)if(r=r.trim(),"#"===r[0]&&r.includes("if")&&!r.includes("endif")){r=r.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const e=r.split(" ");for(const i of e)t.includes(i)||t.push(i)}}function Qr(e,t){const i=/#include\s+"([^"]+)"/g,r=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let n=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);n&&(n=n.map((e=>{const t=e.split(" ");return t[t.length-1]})),n=[...new Set(n)]);const a={},o=[],s=[];if(e=e.replace(i,((e,t)=>(s.push(t),""))),(t=t.replace(i,((e,t)=>(o.push(t),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let l=[...jr];Zr(e,l),Zr(t,l);for(const c of[...o,...s])Ur[c]||console.error("Undefined include: ".concat(c)),Gr[c]||(Gr[c]=[],Zr(Ur[c],Gr[c])),l=[...l,...Gr[c]];return{fragmentSource:e=e.replace(r,((e,t,i,r,n)=>(a[n]=!0,"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(n,"\nin ").concat(i," ").concat(r," ").concat(n,";\n#else\nuniform ").concat(i," ").concat(r," u_").concat(n,";\n#endif\n"):"initialize"===t?"\n#ifdef HAS_UNIFORM_u_".concat(n,"\n    ").concat(i," ").concat(r," ").concat(n," = u_").concat(n,";\n#endif\n"):"define-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(n,"\n    in ").concat(i," ").concat(r," ").concat(n,";\n#endif\n"):"initialize-attribute"===t?"":void 0))),vertexSource:t=t.replace(r,((e,t,i,r,n)=>{const o="float"===r?"vec2":r,s=n.match(/color/)?"color":o;return"define-attribute-vertex-shader-only"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(n,"\nin ").concat(i," ").concat(r," a_").concat(n,";\n#endif\n"):a[n]?"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(n,"\nuniform lowp float u_").concat(n,"_t;\nin ").concat(i," ").concat(o," a_").concat(n,";\nout ").concat(i," ").concat(r," ").concat(n,";\n#else\nuniform ").concat(i," ").concat(r," u_").concat(n,";\n#endif\n"):"initialize"===t?"vec4"===s?"\n#ifndef HAS_UNIFORM_u_".concat(n,"\n    ").concat(n," = a_").concat(n,";\n#else\n    ").concat(i," ").concat(r," ").concat(n," = u_").concat(n,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(n,"\n    ").concat(n," = unpack_mix_").concat(s,"(a_").concat(n,", u_").concat(n,"_t);\n#else\n    ").concat(i," ").concat(r," ").concat(n," = u_").concat(n,";\n#endif\n"):"define-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(n,"\n    in ").concat(i," ").concat(r," a_").concat(n,";\n    out ").concat(i," ").concat(r," ").concat(n,";\n#endif\n"):"initialize-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(n,"\n    ").concat(n," = a_").concat(n,";\n#endif\n"):void 0:"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(n,"\nuniform lowp float u_").concat(n,"_t;\nin ").concat(i," ").concat(o," a_").concat(n,";\n#else\nuniform ").concat(i," ").concat(r," u_").concat(n,";\n#endif\n"):"define-instanced"===t?"mat4"===s?"\n#ifdef INSTANCED_ARRAYS\nin vec4 a_".concat(n,"0;\nin vec4 a_").concat(n,"1;\nin vec4 a_").concat(n,"2;\nin vec4 a_").concat(n,"3;\n#else\nuniform ").concat(i," ").concat(r," u_").concat(n,";\n#endif\n"):"\n#ifdef INSTANCED_ARRAYS\nin ".concat(i," ").concat(o," a_").concat(n,";\n#else\nuniform ").concat(i," ").concat(r," u_").concat(n,";\n#endif\n"):"initialize-attribute-custom"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(n,"\n    ").concat(i," ").concat(r," ").concat(n," = a_").concat(n,";\n#endif\n"):"vec4"===s?"\n#ifndef HAS_UNIFORM_u_".concat(n,"\n    ").concat(i," ").concat(r," ").concat(n," = a_").concat(n,";\n#else\n    ").concat(i," ").concat(r," ").concat(n," = u_").concat(n,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(n,"\n    ").concat(i," ").concat(r," ").concat(n," = unpack_mix_").concat(s,"(a_").concat(n,", u_").concat(n,"_t);\n#else\n    ").concat(i," ").concat(r," ").concat(n," = u_").concat(n,";\n#endif\n")})),staticAttributes:n,usedDefines:l,vertexIncludes:o,fragmentIncludes:s}}class Xr{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,t,i,r,n,a,o,s){this.context=e;let l=this.boundPaintVertexBuffers.length!==r.length;for(let h=0;!l&&h<r.length;h++)this.boundPaintVertexBuffers[h]!==r[h]&&(l=!0);let c=this.boundDynamicVertexBuffers.length!==o.length;for(let h=0;!c&&h<o.length;h++)this.boundDynamicVertexBuffers[h]!==o[h]&&(c=!0);if(!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==i||l||c||this.boundIndexBuffer!==n||this.boundVertexOffset!==a)this.freshBind(t,i,r,n,a,o,s);else{e.bindVertexArrayOES.set(this.vao);for(const i of o)i&&(i.bind(),s&&i.instanceCount&&i.setVertexAttribDivisor(e.gl,t,s));n&&n.dynamicDraw&&n.bind()}}freshBind(e,t,i,r,n,a,o){const s=e.numAttributes,l=this.context,c=l.gl;this.vao&&this.destroy(),this.vao=l.gl.createVertexArray(),l.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=r,this.boundVertexOffset=n,this.boundDynamicVertexBuffers=a,t.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,n);for(const h of i)h.enableAttributes(c,e),h.bind(),h.setVertexAttribPointers(c,e,n);for(const h of a)h&&(h.enableAttributes(c,e),h.bind(),h.setVertexAttribPointers(c,e,n),o&&h.instanceCount&&h.setVertexAttribDivisor(c,e,o));r&&r.bind(),l.currentNumAttributes=s}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Yr(t,i){const r=Math.pow(2,i.canonical.z),n=i.canonical.y;return[new e.O(0,n/r).toLngLat().lat,new e.O(0,(n+1)/r).toLngLat().lat]}function Jr(t,i,r,n,a,o,s){const l=t.context,c=l.gl,h=r.hillshadeFBO;if(!h)return;t.prepareDrawTile();const u=t.isTileAffectedByFog(i),d=t.getOrCreateProgram("hillshade",{overrideFog:u});l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,h.colorAttachment.get());const p=((t,i,r,n)=>{const a=r.paint.get("hillshade-shadow-color"),o=r.paint.get("hillshade-highlight-color"),s=r.paint.get("hillshade-accent-color"),l=r.paint.get("hillshade-emissive-strength");let c=e.bm(r.paint.get("hillshade-illumination-direction"));if("viewport"===r.paint.get("hillshade-illumination-anchor"))c-=t.transform.angle;else if(t.style&&t.style.enable3dLights()&&t.style.directionalLight){const i=t.style.directionalLight.properties.get("direction"),r=e.bT(i.x,i.y,i.z);c=e.bm(r[1])}const h=!t.options.moving;return{u_matrix:n||t.transform.calculateProjMatrix(i.tileID.toUnwrapped(),h),u_image:0,u_latrange:Yr(0,i.tileID),u_light:[r.paint.get("hillshade-exaggeration"),c],u_shadow:a,u_highlight:o,u_emissive_strength:l,u_accent:s}})(t,r,n,t.terrain?i.projMatrix:null);t.uploadCommonUniforms(l,d,i.toUnwrapped());const{tileBoundsBuffer:f,tileBoundsIndexBuffer:m,tileBoundsSegments:g}=t.getTileBoundsBuffers(r);d.draw(t,c.TRIANGLES,a,o,s,Rt.disabled,p,n.id,f,m,g)}function Kr(t,i,r){if(!i.needsDEMTextureUpload)return;const n=t.context,a=n.gl;n.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||t.getTileTexture(r.stride);const o=r.getPixels();i.demTexture?i.demTexture.update(o,{premultiply:!1}):i.demTexture=new e.T(n,o,a.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function $r(t,i,r){const n=t.context,a=n.gl;if(!i.dem)return;const o=i.dem;if(n.activeTexture.set(a.TEXTURE1),Kr(t,i,o),!i.demTexture)return;i.demTexture.bind(a.NEAREST,a.CLAMP_TO_EDGE);const s=o.dim;n.activeTexture.set(a.TEXTURE0);let l=i.hillshadeFBO;if(!l){const t=new e.T(n,{width:s,height:s,data:null},a.RGBA);t.bind(a.LINEAR,a.CLAMP_TO_EDGE),l=i.hillshadeFBO=n.createFramebuffer(s,s,!0,"renderbuffer"),l.colorAttachment.set(t.texture)}n.bindFramebuffer.set(l.framebuffer),n.viewport.set([0,0,s,s]);const{tileBoundsBuffer:c,tileBoundsIndexBuffer:h,tileBoundsSegments:u}=t.getMercatorTileBoundsBuffers(),d=[];t.linearFloatFilteringSupported()&&d.push("TERRAIN_DEM_FLOAT_FORMAT"),t.getOrCreateProgram("hillshadePrepare",{defines:d}).draw(t,a.TRIANGLES,Mt.disabled,Pt.disabled,It.unblended,Rt.disabled,((t,i)=>{const r=i.stride,n=e.a9.create();return e.a9.ortho(n,0,e.Y,-e.Y,0,0,1),e.a9.translate(n,n,[0,-e.Y,0]),{u_matrix:n,u_image:1,u_dimension:[r,r],u_zoom:t.overscaledZ}})(i.tileID,o),r.id,c,h,u),i.needsHillshadePrepare=!1}const en=t=>({u_matrix:new e.bN(t),u_image0:new e.bR(t),u_skirt_height:new e.bQ(t),u_ground_shadow_factor:new e.bP(t)}),tn=(e,t,i)=>({u_matrix:e,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:i}),rn=(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(r),u_merc_matrix:i,u_zoom_transition:n,u_merc_center:a,u_image0:0,u_frustum_tl:o,u_frustum_tr:s,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:h,u_globe_radius:u,u_viewport:d,u_grid_matrix:m?Float32Array.from(m):new Float32Array(9),u_skirt_height:p,u_far_z_cutoff:f});function nn(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const an=new class{constructor(){this.operations={}}newMorphing(e,t,i,r,n){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==i.tileID.key&&(t.queued=i)}else this.operations[e]={startTime:r,phase:0,duration:n,from:t,to:i,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const i=this.operations[t];for(i.phase=(e-i.startTime)/i.duration;i.phase>=1||!this._validOp(i);)if(!this._nextOp(i,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},on={0:null,1:"TERRAIN_VERTEX_MORPHING"};function sn(e,t,i){if(0===t)return 0;const r=t<1&&514===i?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*r}function ln(e,t){const i=1<<e.z;return!t&&(0===e.x||e.x===i-1)||0===e.y||e.y===i-1}const cn=e=>({u_matrix:e});function hn(t,i,r,n,a){if(a>0){const o=e.f.now(),s=(o-t.timeAdded)/a,l=i?(o-i.timeAdded)/a:-1,c=r.getSource(),h=n.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),u=!i||Math.abs(i.tileID.overscaledZ-h)>Math.abs(t.tileID.overscaledZ-h),d=u&&t.refreshedUponExpiration?1:e.ad(u?s:1-l,0,1);return t.refreshedUponExpiration&&s>=1&&(t.refreshedUponExpiration=!1),i?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}class un extends Qt{constructor(t){const i={type:"raster-dem",maxzoom:t.transform.maxZoom},r=new e.bZ(e.b_(),null),n=jt("mock-dem",i,r,t.style);super("mock-dem",n,!1),n.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,t){e.state="loaded",t(null)}}class dn extends Qt{constructor(t){const i=jt("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new e.bZ(e.b_(),null),t.style);super("proxy",i,!1),i.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,t,i){if(e.freezeTileCoverage)return;this.transform=e;const r=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((t,i)=>{if(t[i.key]="",!this._tiles[i.key]){const t=new Nt(i,this._source.tileSize*i.overscaleFactor(),e.tileZoom);t.state="loaded",this._tiles[i.key]=t}return t}),{});for(const n in this._tiles)n in r||(this.freeFBO(n),this._tiles[n].unloadVectorData(),delete this._tiles[n])}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const i=Object.values(t);this.renderCachePool.push(...i),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach((e=>e.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class pn extends e.ap{constructor(e,t,i){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=i}}class fn extends e.cp{constructor(t,i){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[r,n,a]=function(t){const i=new e.aQ,r=new e.az,n=131;i.reserve(17161),r.reserve(33800);const a=e.Y/128,o=e.Y+a/2,s=o+a;for(let c=-a;c<s;c+=a)for(let t=-a;t<s;t+=a){const r=t<0||t>o||c<0||c>o?24575:0,n=e.ad(Math.round(t),0,e.Y),a=e.ad(Math.round(c),0,e.Y);i.emplaceBack(n+r,a)}const l=(e,t)=>{const i=t*n+e;r.emplaceBack(i+1,i,i+n),r.emplaceBack(i+n,i+n+1,i+1)};for(let e=1;e<129;e++)for(let t=1;t<129;t++)l(t,e);return[0,129].forEach((e=>{for(let t=0;t<130;t++)l(t,e),l(e,t)})),[i,r,32768]}(),o=t.context;this.gridBuffer=o.createVertexBuffer(r,e.aS.members),this.gridIndexBuffer=o.createIndexBuffer(n),this.gridSegments=e.aE.simpleSegment(0,0,r.length,n.length),this.gridNoSkirtSegments=e.aE.simpleSegment(0,0,r.length,a),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new dn(i.map),this.orthoMatrix=e.a9.create(),e.a9.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,e.Y,0,e.Y,0,1);const s=o.gl;this._overlapStencilMode=new Pt({func:s.GEQUAL,mask:255},0,255,s.KEEP,s.KEEP,s.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=i,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new un(i.map),this._pendingGroundEffectLayers=[]}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(t,i,r){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const n=t.terrain.properties,a=0===t.terrain.drapeRenderMode,o=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=e.f.now();const s=t.terrain&&t.terrain.scope,l=n.get("source"),c=a?this._mockSourceCache:t.getSourceCache(l,s);if(!c)return void e.w("Couldn't find terrain source \"".concat(l,'".'));if(this.sourceCache=c,this._exaggeration=o?this.calculateExaggeration(i):n.get("exaggeration"),!i.projection.requiresDraping&&o&&0===this._exaggeration)return void this._disable();this.enabled=!0;const h=()=>{this.sourceCache.used&&e.w("Raster DEM source '".concat(this.sourceCache.id,"' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source."));const t=this.getScaledDemTileSize();this.sourceCache.update(i,t,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,h(),this._initializing=!0),h(),i.updateElevation(!0,r),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(i),this._emptyDEMTextureDirty=!0,this._previousZoom=i.zoom}else this._disable()}calculateExaggeration(t){const i=this._previousCameraAltitude,r=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=r;const n=null!=i?r-i:Number.MAX_VALUE;if(Math.abs(n)<2)return this._exaggeration;const a=t.zoom,o=this._style.terrain;if(!this._previousUpdateTimestamp)return o.getExaggeration(a);let s=a-this._previousZoom;const l=this._previousUpdateTimestamp;let c=a;null!=this._evaluationZoom&&(c=this._evaluationZoom,Math.abs(a-c)>.5&&(s=.5*(a-c+s)),s*n<0&&(c+=s)),this._evaluationZoom=c;const h=o.getExaggeration(c),u=h===o.getExaggeration(Math.max(0,c-.1));if(u&&Math.abs(h-this._exaggeration)<.01)return h;let d=Math.min(.1,.00375*(this._updateTimestamp-l));return(u||h<.1||Math.abs(s)<1e-4)&&(d=Math.min(.2,4*d)),e.X(this._exaggeration,h,d)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach((e=>e.fb.destroy())),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const i=this.proxySourceCache,r=this.painter.transform;this._initializing&&(this._initializing=0===r._centerAltitude&&-1===this.getAtPointOrZero(e.O.fromLngLat(r.center),-1),this._emptyDEMTextureDirty=!this._initializing);const n=this.proxyCoords=i.getIds().map((e=>{const t=i.getTileByID(e).tileID;return t.projMatrix=r.calculateProjMatrix(t.toUnwrapped()),t}));!function(t,i){const r=i.transform.pointCoordinate(i.transform.getCameraPoint()),n=new e.P(r.x,r.y);t.sort(((t,i)=>{if(i.overscaledZ-t.overscaledZ)return i.overscaledZ-t.overscaledZ;const r=new e.P(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),a=new e.P(i.canonical.x+(1<<i.canonical.z)*i.wrap,i.canonical.y),o=n.mult(1<<t.canonical.z);return o.x-=.5,o.y-=.5,o.distSqr(r)-o.distSqr(a)}))}(n,this.painter);const a=this.proxyToSource||{};this.proxyToSource={},n.forEach((e=>{this.proxyToSource[e.key]={}})),this.terrainTileForTile={};const o=this._style._mergedSourceCaches;for(const e in o){const i=o[e];if(!i.used)continue;if(i!==this.sourceCache&&this.resetTileLookupCache(i.id),this._setupProxiedCoordsForOrtho(i,t[e],a),i.usedForTerrain)continue;const r=t[e];i.getSource().reparseOverscaled&&this._assignTerrainTiles(r)}this.proxiedCoords[i.id]=n.map((e=>new pn(e,e.key,this.orthoMatrix))),this._assignTerrainTiles(n),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(a),this.renderingToTexture=!1;const s={};this._visibleDemTiles=[];for(const e of this.proxyCoords){const t=this.terrainTileForTile[e.key];if(!t)continue;const i=t.tileID.key;i in s||(this._visibleDemTiles.push(t),s[i]=i)}}_assignTerrainTiles(e){this._initializing||e.forEach((e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)}))}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const i in this.terrainTileForTile){const r=this.terrainTileForTile[i],n=r.dem;!n||r.demTexture&&!r.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),Kr(this.painter,r,n))}}_prepareDemTileUniforms(e,t,i,r){if(!t||null==t.demTexture)return!1;const n=e.tileID.canonical,a=Math.pow(2,t.tileID.canonical.z-n.z),o=r||"";return i["u_dem_tl".concat(o)]=[n.x*a%1,n.y*a%1],i["u_dem_scale".concat(o)]=a,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const t=this.painter.context,i=t.gl;if(!this._emptyDepthBufferTexture){const r=new e.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new e.T(t,r,i.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let e=0;const t=this._visibleDemTiles.reduce(((t,i)=>{if(!i.dem)return t;const r=i.dem.tree.minimums[0];return r>0&&e++,t+r}),0);return e?t/e:0}_updateEmptyDEMTexture(){const t=this.painter.context,i=t.gl;t.activeTexture.set(i.TEXTURE2);const r=this._getLoadedAreaMinimum(),[n,a]=(()=>{const t=new e.cr({width:1,height:1},new Float32Array([r]));return[i.R32F,t]})();this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(a,{premultiply:!1}):o=this._emptyDEMTexture=new e.T(t,a,n,{premultiply:!1}),o}setupElevationDraw(t,i,r){const n=this.painter.context,a=n.gl,o={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};o.u_exaggeration=this.exaggeration();let s=null,l=null,c=1;if(r&&r.morphing&&this._useVertexMorphing){const e=r.morphing.srcDemTile,i=r.morphing.dstDemTile;c=r.morphing.phase,e&&i&&(this._prepareDemTileUniforms(t,e,o,"_prev")&&(l=e),this._prepareDemTileUniforms(t,i,o)&&(s=i))}const h=e=>e&&e.demTexture&&this.painter.linearFloatFilteringSupported()?a.LINEAR:a.NEAREST,u=e=>{o.u_dem_size=1===e.size[0]?1:e.size[0]-2};if(l&&s)n.activeTexture.set(a.TEXTURE2),s.demTexture.bind(h(s),a.CLAMP_TO_EDGE),n.activeTexture.set(a.TEXTURE4),l.demTexture.bind(h(l),a.CLAMP_TO_EDGE),s.demTexture&&u(s.demTexture),o.u_dem_lerp=c;else{s=this.terrainTileForTile[t.tileID.key],n.activeTexture.set(a.TEXTURE2);const e=this._prepareDemTileUniforms(t,s,o)?s.demTexture:this.emptyDEMTexture;e.bind(h(s),a.CLAMP_TO_EDGE),u(e)}if(n.activeTexture.set(a.TEXTURE3),r&&r.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(a.NEAREST,a.CLAMP_TO_EDGE),this._depthFBO&&(o.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(a.NEAREST,a.CLAMP_TO_EDGE),o.u_depth_size_inv=[1,1]),r&&r.useMeterToDem&&s){const t=(1<<s.tileID.canonical.z)*e.bo(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;o.u_meter_to_dem=t}if(r&&r.labelPlaneMatrixInv&&(o.u_label_plane_matrix_inv=r.labelPlaneMatrixInv),i.setTerrainUniformValues(n,o),"globe"===this.painter.transform.projection.name){const e=this.globeUniformValues(this.painter.transform,t.tileID.canonical,r&&r.useDenormalizedUpVectorScale);i.setGlobeUniformValues(n,e)}}globeUniformValues(t,i,r){const n=t.projection;return{u_tile_tl_up:n.upVector(i,0,0),u_tile_tr_up:n.upVector(i,e.Y,0),u_tile_br_up:n.upVector(i,e.Y,e.Y),u_tile_bl_up:n.upVector(i,0,e.Y),u_tile_up_scale:r?e.cq(1):n.upVectorScale(i,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const i=this.painter,r=this.painter.context;0!==t.length&&(r.bindFramebuffer.set(null),r.viewport.set([0,0,i.width,i.height]),i.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(t,i,r,n,a){if("globe"===t.transform.projection.name)!function(t,i,r,n,a){const o=t.context,s=o.gl;let l,c;const h=t.transform,u=e.ci(t,o,h),d=(e,i)=>{if(c===i)return;const r=[on[i],"PROJECTION_GLOBE_VIEW"];u&&r.push("CUSTOM_ANTIALIASING");const n=t.isTileAffectedByFog(e);l=t.getOrCreateProgram("globeRaster",{defines:r,overrideFog:n}),c=i},p=t.colorModeForRenderPass(),f=new Mt(s.LEQUAL,Mt.ReadWrite,t.depthRangeFor3D);an.update(a);const m=e.cj(h),g=[e.a8(h.center.lng),e.ah(h.center.lat)],_=t.globeSharedBuffers,y=[h.width*e.f.devicePixelRatio,h.height*e.f.devicePixelRatio],v=Float32Array.from(h.globeMatrix),x={useDenormalizedUpVectorScale:!0};{const h=t.transform,u=sn(h.zoom,i.exaggeration(),i.sourceCache._source.tileSize);c=-1;const b=s.TRIANGLES;for(const c of n){const n=r.getTile(c),w=Pt.disabled,S=i.prevTerrainTileForTile[c.key],T=i.terrainTileForTile[c.key];nn(S,T)&&an.newMorphing(c.key,S,T,a,250),o.activeTexture.set(s.TEXTURE0),n.texture&&n.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const E=an.getMorphValuesForProxy(c.key),M=E?1:0;E&&e.k(x,{morphing:{srcDemTile:E.from,dstDemTile:E.to,phase:e.ch(E.phase)}});const A=e.ck(c.canonical),P=e.cl(A.getCenter().lat),C=e.cm(c.canonical,A,P,h.worldSize/h._pixelsPerMercatorPixel),I=e.aW(e.cn(c.canonical)),k=rn(h.expandedFarZProjMatrix,v,m,I,e.W(h.zoom),g,h.frustumCorners.TL,h.frustumCorners.TR,h.frustumCorners.BR,h.frustumCorners.BL,h.globeCenterInViewSpace,h.globeRadius,y,u,h._farZ,C);if(d(c,M),l&&(i.setupElevationDraw(n,l,x),t.uploadCommonUniforms(o,l,c.toUnwrapped()),_)){const[e,i,r]=_.getGridBuffers(P,0!==u);l.draw(t,b,f,w,p,Rt.backCCW,k,"globe_raster",e,i,r)}}}if(_&&(t.renderDefaultNorthPole||t.renderDefaultSouthPole)){const a=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];u&&a.push("CUSTOM_ANTIALIASING"),l=t.getOrCreateProgram("globeRaster",{defines:a});for(const c of n){const{x:n,y:a,z:u}=c.canonical,d=0===a,m=a===(1<<u)-1,[v,b,w,S]=_.getPoleBuffers(u,!1);if(S&&(d||m)){const a=r.getTile(c);o.activeTexture.set(s.TEXTURE0),a.texture&&a.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);let _=e.co(u,n,h);const T=e.aW(e.cn(c.canonical)),E=(e,i)=>e.draw(t,s.TRIANGLES,f,Pt.disabled,p,Rt.disabled,rn(h.expandedFarZProjMatrix,_,_,T,0,g,h.frustumCorners.TL,h.frustumCorners.TR,h.frustumCorners.BR,h.frustumCorners.BL,h.globeCenterInViewSpace,h.globeRadius,y,0,h._farZ),"globe_pole_raster",i,w,S);i.setupElevationDraw(a,l,x),t.uploadCommonUniforms(o,l,c.toUnwrapped()),d&&t.renderDefaultNorthPole&&E(l,v),m&&t.renderDefaultSouthPole&&(_=e.a9.scale(e.a9.create(),_,[1,-1,1]),E(l,b))}}}}(t,i,r,n,a);else{const o=t.context,s=o.gl;let l,c;const h=t.shadowRenderer,u=mr(t,t.longestCutoffRange),d=e=>{if(c===e)return;const i=[];i.push(on[e]),u.shouldRenderCutoff&&i.push("RENDER_CUTOFF"),l=t.getOrCreateProgram("terrainRaster",{defines:i}),c=e},p=t.colorModeForRenderPass(),f=new Mt(s.LEQUAL,Mt.ReadWrite,t.depthRangeFor3D);an.update(a);const m=t.transform,g=sn(m.zoom,i.exaggeration(),i.sourceCache._source.tileSize);let _=[0,0,0];if(h){const e=t.style.directionalLight,i=t.style.ambientLight;e&&i&&(_=wr(e,i))}{c=-1;const y=s.TRIANGLES,[v,x]=[i.gridIndexBuffer,i.gridSegments];for(const c of n){const n=r.getTile(c),b=Pt.disabled,w=i.prevTerrainTileForTile[c.key],S=i.terrainTileForTile[c.key];nn(w,S)&&an.newMorphing(c.key,w,S,a,250),o.activeTexture.set(s.TEXTURE0),n.texture&&n.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const T=an.getMorphValuesForProxy(c.key),E=T?1:0;let M;T&&(M={morphing:{srcDemTile:T.from,dstDemTile:T.to,phase:e.ch(T.phase)}});const A=tn(c.projMatrix,ln(c.canonical,m.renderWorldCopies)?g/10:g,_);if(d(E),!l)continue;i.setupElevationDraw(n,l,M);const P=c.toUnwrapped();h&&h.setupShadows(P,l),t.uploadCommonUniforms(o,l,P,null,u),l.draw(t,y,f,b,p,Rt.backCCW,A,"terrain_raster",i.gridBuffer,v,x)}}}}(i,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,i.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const i=this.painter,r=this.painter.context,n=this.proxySourceCache,a=this.proxiedCoords[n.id],o=this._drapedRenderBatches.shift(),s=i.style.order,l=[];let c=0;for(const h of a){const a=n.getTileByID(h.proxyTileKey),u=n.proxyCachedFBO[h.key]?n.proxyCachedFBO[h.key][t]:void 0,d=void 0!==u?n.renderCache[u]:this.pool[c++],p=void 0!==u;if(a.texture=d.tex,p&&!d.dirty){l.push(a.tileID);continue}let f;r.bindFramebuffer.set(d.fb.framebuffer),this.renderedToTile=!1,d.dirty&&(r.clear({color:e.aA.transparent,stencil:0}),d.dirty=!1);for(let e=o.start;e<=o.end;++e){const t=i.style._mergedLayers[s[e]];if(t.isHidden(i.transform.zoom))continue;const n=i.style.getLayerSourceCache(t),a=n?this.proxyToSource[h.key][n.id]:[h];if(!a)continue;const o=a;r.viewport.set([0,0,d.fb.width,d.fb.height]),f!==(n?n.id:null)&&(this._setupStencil(d,a,t,n),f=n?n.id:null),i.renderLayer(i,n,t,o)}if(0===this._drapedRenderBatches.length)for(const e of this._pendingGroundEffectLayers){const t=i.style._mergedLayers[s[e]];if(t.isHidden(i.transform.zoom))continue;const n=i.style.getLayerSourceCache(t),a=n?this.proxyToSource[h.key][n.id]:[h];if(!a)continue;const o=a;r.viewport.set([0,0,d.fb.width,d.fb.height]),f!==(n?n.id:null)&&(this._setupStencil(d,a,t,n),f=n?n.id:null),i.renderLayer(i,n,t,o)}this.renderedToTile?(d.dirty=!0,l.push(a.tileID)):p||--c,5===c&&(c=0,this.renderToBackBuffer(l))}return this.renderToBackBuffer(l),this.renderingToTexture=!1,r.bindFramebuffer.set(null),r.viewport.set([0,0,i.width,i.height]),o.end+1}postRender(){}isLayerOrderingCorrect(e){const t=e.order.length;let i=-1,r=t;for(let n=0;n<t;++n)this._style.isLayerDraped(e._mergedLayers[e.order[n]])?i=Math.max(i,n):r=Math.min(r,n);return r>i}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter((e=>e.dem)).forEach((t=>{e=Math.min(e,t.dem.tree.minimums[0])})),0===e?e:(e-30)*this._exaggeration}raycast(e,t,i){if(!this._visibleDemTiles)return null;const r=this._visibleDemTiles.filter((e=>e.dem)).map((r=>{const n=r.tileID,a=1<<n.overscaledZ,{x:o,y:s}=n.canonical,l=o/a,c=(o+1)/a,h=s/a,u=(s+1)/a;return{minx:l,miny:h,maxx:c,maxy:u,t:r.dem.tree.raycastRoot(l,h,c,u,e,t,i),tile:r}}));r.sort(((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE)));for(const n of r){if(null==n.t)return null;const r=n.tile.dem.tree.raycast(n.minx,n.miny,n.maxx,n.maxy,e,t,i);if(null!=r)return r}return null}_createFBO(){const t=this.painter.context,i=t.gl,r=this.drapeBufferSize;t.activeTexture.set(i.TEXTURE0);const n=new e.T(t,{width:r[0],height:r[1],data:null},i.RGBA);n.bind(i.LINEAR,i.CLAMP_TO_EDGE);const a=t.createFramebuffer(r[0],r[1],!0,null);return a.colorAttachment.set(n.texture),a.depthAttachment=new Tt(t,a.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,r[0],r[1]),this._stencilRef=0,a.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):a.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&i.texParameterf(i.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:a,tex:n,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache)return!0;if(this._style.hasLightTransitions())return!0;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some((e=>{const t=this._style._mergedLayers[e],i=t.isHidden(this.painter.transform.zoom);return"custom"===t.type?!i&&t.shouldRedrape():!i&&t.hasTransition()}))}_clearLineLayersFromRenderCache(){let t=!1;for(const e of this._style.getSources())if(e instanceof Ce){t=!0;break}if(!t)return;const i={};for(let r=0;r<this._style.order.length;++r){const t=this._style._mergedLayers[this._style.order[r]],n=this._style.getLayerSourceCache(t);if(n&&!i[n.id]&&!t.isHidden(this.painter.transform.zoom)&&"line"===t.type&&t.widthExpression()instanceof e.Z){i[n.id]=!0;for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][n.id];if(t)for(const e of t)this._clearRenderCacheForTile(n.id,e)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i]._source instanceof Ie){e=!0;break}if(!e)return;const t={};for(let i=0;i<this._style.order.length;++i){const e=this._style._mergedLayers[this._style.order[i]],r=this._style.getLayerSourceCache(e);if(!r||t[r.id])continue;if(e.isHidden(this.painter.transform.zoom)||"raster"!==e.type)continue;const n=e.paint.get("raster-fade-duration");for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][r.id];if(e)for(const t of e){const e=hn(r.getTile(t),r.findLoadedParent(t,0),r,this.painter.transform,n);(1!==e.opacity||0!==e.mix)&&this._clearRenderCacheForTile(r.id,t)}}}}_setupDrapedRenderBatches(){const t=this._style.order,i=t.length;if(0===i)return;const r=[];this._pendingGroundEffectLayers=[];let n,a=0,o=this._style._mergedLayers[t[a]];for(;!this._style.isLayerDraped(o)&&o.isHidden(this.painter.transform.zoom)&&++a<i;)o=this._style._mergedLayers[t[a]];for(;a<i;++a){const e=this._style._mergedLayers[t[a]];e.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(e)?void 0===n&&(n=a):("fill-extrusion"===e.type&&this._pendingGroundEffectLayers.push(a),void 0!==n&&(r.push({start:n,end:a-1}),n=void 0)))}if(void 0!==n&&r.push({start:n,end:a-1}),0!==r.length){const t=r[r.length-1];this._pendingGroundEffectLayers.every((e=>e>t.end))||e.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=r}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let i=0;i<e.length;++i){const r=Object.values(e[i]);t.renderCachePool.push(...r)}}return}this._clearRasterLayersFromRenderCache();const i=this.proxyCoords,r=this._tilesDirty;for(let a=i.length-1;a>=0;a--){const n=i[a];if(t.getTileByID(n.key),void 0!==t.proxyCachedFBO[n.key]){const i=e[n.key],a=this.proxyToSource[n.key];let o=0;for(const e in a){const t=a[e],n=i[e];if(!n||n.length!==t.length||t.some(((t,i)=>t!==n[i]||r[e]&&r[e].hasOwnProperty(t.key)))){o=-1;break}++o}for(const e in t.proxyCachedFBO[n.key])t.renderCache[t.proxyCachedFBO[n.key][e]].dirty=o<0||o!==Object.values(i).length}}const n=[...this._drapedRenderBatches];n.sort(((e,t)=>t.end-t.start-(e.end-e.start)));for(const a of n)for(const e of i){if(t.proxyCachedFBO[e.key])continue;let i=t.renderCachePool.pop();void 0===i&&t.renderCache.length<50&&(i=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==i&&(t.proxyCachedFBO[e.key]={},t.proxyCachedFBO[e.key][a.start]=i,t.renderCache[i].dirty=!0)}this._tilesDirty={}}_setupStencil(e,t,i,r){if(!r||!this._sourceTilesOverlap[r.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const n=this.painter.context,a=n.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let o;if(i.isTileClipped())o=t.length,this._overlapStencilMode.test={func:a.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);o=1,this._overlapStencilMode.test={func:a.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+o>255&&(n.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=o,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):Pt.disabled}_renderTileClippingMasks(e,t){const i=this.painter,r=this.painter.context,n=r.gl;i._tileClippingMaskIDs={},r.setColorMode(It.disabled),r.setDepthMode(Mt.disabled);const a=i.getOrCreateProgram("clippingMask");for(const o of e){const e=i._tileClippingMaskIDs[o.key]=--t;a.draw(i,n.TRIANGLES,Mt.disabled,new Pt({func:n.ALWAYS,mask:0},e,255,n.KEEP,n.KEEP,n.REPLACE),It.disabled,Rt.disabled,cn(o.projMatrix),"$clipping",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}pointCoordinate(t){const i=this.painter.transform;if(t.x<0||t.x>i.width||t.y<0||t.y>i.height)return null;const r=[t.x,t.y,1,1];e.aa.transformMat4(r,r,i.pixelMatrixInverse),e.aa.scale(r,r,1/r[3]),r[0]/=i.worldSize,r[1]/=i.worldSize;const n=i._camera.position,a=e.bo(1,i.center.lat),o=[n[0],n[1],n[2]/a,0],s=e.Q.subtract([],r.slice(0,3),o);e.Q.normalize(s,s);const l=this.raycast(o,s,this._exaggeration);return null!==l&&l?(e.Q.scaleAndAdd(o,o,s,l),o[3]=o[2],o[2]*=a,o):null}drawDepth(){const t=this.painter,i=t.context,r=this.proxySourceCache,n=Math.ceil(t.width),a=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===n&&this._depthFBO.height===a||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const t=i.gl,r=i.createFramebuffer(n,a,!0,"renderbuffer");i.activeTexture.set(t.TEXTURE0);const o=new e.T(i,{width:n,height:a,data:null},t.RGBA);o.bind(t.NEAREST,t.CLAMP_TO_EDGE),r.colorAttachment.set(o.texture);const s=i.createRenderbuffer(i.gl.DEPTH_COMPONENT16,n,a);r.depthAttachment.set(s),this._depthFBO=r,this._depthTexture=o}i.bindFramebuffer.set(this._depthFBO.framebuffer),i.viewport.set([0,0,n,a]),function(e,t,i,r){if("globe"===e.transform.projection.name)return;const n=e.context,a=n.gl;n.clear({depth:1});const o=e.getOrCreateProgram("terrainDepth"),s=new Mt(a.LESS,Mt.ReadWrite,e.depthRangeFor3D);for(const l of r){const r=i.getTile(l),n=tn(l.projMatrix,0,[0,0,0]);t.setupElevationDraw(r,o),o.draw(e,a.TRIANGLES,s,Pt.disabled,It.unblended,Rt.backCCW,n,"terrain_depth",t.gridBuffer,t.gridIndexBuffer,t.gridNoSkirtSegments)}}(t,this,r,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,i,r){if(t.getSource()instanceof e.as)return this._setupProxiedCoordsForImageSource(t,i,r);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const n=this.proxiedCoords[t.id]=[],a=this.proxyCoords;for(let e=0;e<a.length;e++){const i=a[e],o=this._findTileCoveringTileID(i,t);if(o){const e=this._createProxiedId(i,o,r[i.key]&&r[i.key][t.id]);n.push(e),this.proxyToSource[i.key][t.id]=[e]}}let o=!1;const s=new Set;for(let e=0;e<i.length;e++){const a=t.getTile(i[e]);if(!a||!a.hasData())continue;const l=this._findTileCoveringTileID(a.tileID,this.proxySourceCache);if(l&&l.tileID.canonical.z!==a.tileID.canonical.z){const e=this.proxyToSource[l.tileID.key][t.id],i=this._createProxiedId(l.tileID,a,r[l.tileID.key]&&r[l.tileID.key][t.id]);e?e.splice(e.length-1,0,i):this.proxyToSource[l.tileID.key][t.id]=[i];const c=this.proxyToSource[l.tileID.key][t.id];s.has(c)||s.add(c),n.push(i),o=!0}}if(this._sourceTilesOverlap[t.id]=o,o&&this._debugParams.sortTilesHiZFirst)for(const e of s)e.sort(((e,t)=>t.overscaledZ-e.overscaledZ))}_setupProxiedCoordsForImageSource(t,i,r){if(!t.getSource().loaded())return;const n=this.proxiedCoords[t.id]=[],a=this.proxyCoords,o=t.getSource(),s=o.tileID;if(!s)return;const l=new e.P(s.x,s.y)._div(1<<s.z),c=o.coordinates.map(e.O.fromLngLat).reduce(((e,t)=>(e.min.x=Math.min(e.min.x,t.x-l.x),e.min.y=Math.min(e.min.y,t.y-l.y),e.max.x=Math.max(e.max.x,t.x-l.x),e.max.y=Math.max(e.max.y,t.y-l.y),e)),{min:new e.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),h=(t,i)=>{const r=t.wrap+t.canonical.x/(1<<t.canonical.z),n=t.canonical.y/(1<<t.canonical.z),a=e.Y/(1<<t.canonical.z),o=i.wrap+i.canonical.x/(1<<i.canonical.z),s=i.canonical.y/(1<<i.canonical.z);return r+a<o+c.min.x||r>o+c.max.x||n+a<s+c.min.y||n>s+c.max.y};for(let e=0;e<a.length;e++){const o=a[e];for(let e=0;e<i.length;e++){const a=t.getTile(i[e]);if(!a||!a.hasData())continue;if(h(o,a.tileID))continue;const s=this._createProxiedId(o,a,r[o.key]&&r[o.key][t.id]),l=this.proxyToSource[o.key][t.id];l?l.push(s):this.proxyToSource[o.key][t.id]=[s],n.push(s)}}}_createProxiedId(t,i,r){let n=this.orthoMatrix;if(r){const e=r.find((e=>e.key===i.tileID.key));if(e)return e}if(i.tileID.key!==t.key){const r=t.canonical.z-i.tileID.canonical.z;let a,o,s;n=e.a9.create();const l=i.tileID.wrap-t.wrap<<t.overscaledZ;r>0?(a=e.Y>>r,o=a*((i.tileID.canonical.x<<r)-t.canonical.x+l),s=a*((i.tileID.canonical.y<<r)-t.canonical.y)):(a=e.Y<<-r,o=e.Y*(i.tileID.canonical.x-(t.canonical.x+l<<-r)),s=e.Y*(i.tileID.canonical.y-(t.canonical.y<<-r))),e.a9.ortho(n,0,a,0,a,0,1),e.a9.translate(n,n,[o,s,0])}return new pn(i.tileID,t.key,n)}_findTileCoveringTileID(t,i){let r=i.getTile(t);if(r&&r.hasData())return r;const n=this._findCoveringTileCache[i.id],a=n[t.key];if(r=a?i.getTileByID(a):null,r&&r.hasData()||null===a)return r;let o=r?r.tileID:t,s=o.overscaledZ;const l=i.getSource().minzoom,c=[];if(!a){const n=i.getSource().maxzoom;if(t.canonical.z>=n){const r=t.canonical.z-n;i.getSource().reparseOverscaled?(s=Math.max(t.canonical.z+2,i.transform.tileZoom),o=new e.ap(s,t.wrap,n,t.canonical.x>>r,t.canonical.y>>r)):0!==r&&(s=n,o=new e.ap(s,t.wrap,n,t.canonical.x>>r,t.canonical.y>>r))}o.key!==t.key&&(c.push(o.key),r=i.getTile(o))}const h=e=>{c.forEach((t=>{n[t]=e})),c.length=0};for(s-=1;s>=l&&(!r||!r.hasData());s--){r&&h(r.tileID.key);const e=o.calculateScaledKey(s);if(r=i.getTileByID(e),r&&r.hasData())break;const t=n[e];if(null===t)break;void 0===t?c.push(e):r=i.getTileByID(t)}return h(r?r.tileID.key:null),r&&r.hasData()?r:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let i=this._tilesDirty[e];i||(i=this._tilesDirty[e]={}),i[t.key]=!0}}function mn(t,i,r){const n=function(t,i,r){const n=e.Q.dot(i,t),a=e.Q.dot(r,[.2126,.7152,.0722]),o=(e,t,i)=>(1-i)*e+i*t,s=o(1-.3*Math.min(a,1),1,Math.min(n+1,1));return o(.92,1,Math.asin(e.ad(i[2],-1,1))/Math.PI+.5)*s}(t,[0,0,1],i),a=[0,0,0];e.Q.scale(a,r.slice(0,3),n);const o=[0,0,0];e.Q.scale(o,i.slice(0,3),t[2]);const s=[0,0,0];return e.Q.add(s,a,o),e.bX(s)}const gn=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],_n=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class yn{static cacheKey(e,t,i,r){let n="".concat(t).concat(r?r.cacheKey:"");for(const a of i)e.usedDefines.includes(a)&&(n+="/".concat(a));return n}constructor(t,i,r,n,a,o){const s=t.gl;this.program=s.createProgram(),this.configuration=n,this.name=i,this.fixedDefines=[...o];const l=n?n.getBinderAttributes():[],c=(r.staticAttributes||[]).concat(l);let h=n?n.defines():[];h=h.concat(o.map((e=>"#define ".concat(e))));const u="#version 300 es\n";let d=u+h.concat("precision mediump float;",Hr,qr.fragmentSource).join("\n");for(const e of r.fragmentIncludes)d+="\n".concat(Ur[e]);d+="\n".concat(r.fragmentSource);let p=u+h.concat("precision highp float;",Hr,qr.vertexSource).join("\n");for(const e of r.vertexIncludes)p+="\n".concat(Ur[e]);p+="\n".concat(r.vertexSource);const f=s.createShader(s.FRAGMENT_SHADER);if(s.isContextLost())return void(this.failedToCreate=!0);s.shaderSource(f,d),s.compileShader(f),s.attachShader(this.program,f);const m=s.createShader(s.VERTEX_SHADER);if(s.isContextLost())this.failedToCreate=!0;else{s.shaderSource(m,p),s.compileShader(m),s.attachShader(this.program,m),this.attributes={},this.numAttributes=c.length;for(let e=0;e<this.numAttributes;e++)if(c[e]){const t=c[e].startsWith("a_")?c[e]:"a_".concat(c[e]);s.bindAttribLocation(this.program,e,t),this.attributes[t]=e}s.linkProgram(this.program),s.deleteShader(m),s.deleteShader(f),this.fixedUniforms=a(t),this.binderUniforms=n?n.getUniforms(t):[],o.includes("TERRAIN")&&(this.terrainUniforms=(t=>({u_dem:new e.bR(t),u_dem_prev:new e.bR(t),u_dem_tl:new e.bO(t),u_dem_scale:new e.bQ(t),u_dem_tl_prev:new e.bO(t),u_dem_scale_prev:new e.bQ(t),u_dem_size:new e.bQ(t),u_dem_lerp:new e.bQ(t),u_exaggeration:new e.bQ(t),u_depth:new e.bR(t),u_depth_size_inv:new e.bO(t),u_meter_to_dem:new e.bQ(t),u_label_plane_matrix_inv:new e.bN(t)}))(t)),o.includes("GLOBE")&&(this.globeUniforms=(t=>({u_tile_tl_up:new e.bP(t),u_tile_tr_up:new e.bP(t),u_tile_br_up:new e.bP(t),u_tile_bl_up:new e.bP(t),u_tile_up_scale:new e.bQ(t)}))(t)),o.includes("FOG")&&(this.fogUniforms=(t=>({u_fog_matrix:new e.bN(t),u_fog_range:new e.bO(t),u_fog_color:new e.bS(t),u_fog_horizon_blend:new e.bQ(t),u_fog_vertical_limit:new e.bO(t),u_fog_temporal_offset:new e.bQ(t),u_frustum_tl:new e.bP(t),u_frustum_tr:new e.bP(t),u_frustum_br:new e.bP(t),u_frustum_bl:new e.bP(t),u_globe_pos:new e.bP(t),u_globe_radius:new e.bQ(t),u_globe_transition:new e.bQ(t),u_is_globe:new e.bR(t),u_viewport:new e.bO(t)}))(t)),o.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(t=>({u_cutoff_params:new e.bS(t)}))(t)),o.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(t=>({u_lighting_ambient_color:new e.bP(t),u_lighting_directional_dir:new e.bP(t),u_lighting_directional_color:new e.bP(t),u_ground_radiance:new e.bP(t)}))(t)),o.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(t=>({u_light_matrix_0:new e.bN(t),u_light_matrix_1:new e.bN(t),u_fade_range:new e.bO(t),u_shadow_normal_offset:new e.bP(t),u_shadow_intensity:new e.bQ(t),u_shadow_texel_size:new e.bQ(t),u_shadow_map_resolution:new e.bQ(t),u_shadow_direction:new e.bP(t),u_shadow_bias:new e.bP(t),u_shadowmap_0:new e.bR(t),u_shadowmap_1:new e.bR(t)}))(t))}}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const i=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e]&&i[e].set(this.program,e,t[e])}}setGlobeUniformValues(e,t){if(!this.globeUniforms)return;const i=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e]&&i[e].set(this.program,e,t[e])}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const i=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e])}}setCutoffUniformValues(e,t){if(!this.cutoffUniforms)return;const i=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e])}}setLightsUniformValues(e,t){if(!this.lightsUniforms)return;const i=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)i[e].set(this.program,e,t[e])}}setShadowUniformValues(e,t){if(this.failedToCreate||!this.shadowUniforms)return;const i=this.shadowUniforms;e.program.set(this.program);for(const r in t)i[r].set(this.program,r,t[r])}_drawDebugWireframe(t,i,r,n,a,o,s,l,c,h){const u=t.options.wireframe;if(!1===u.terrain&&!1===u.layers2D&&!1===u.layers3D)return;const d=t.context;if(!(()=>!(!u.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!u.layers2D||t._terrain&&t._terrain.renderingToTexture||!gn.includes(this.name))||!(!u.layers3D||!_n.includes(this.name)))())return;const p=d.gl,f=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,a,d);if(!f)return;const m=[...this.fixedDefines];m.push("DEBUG_WIREFRAME");const g=t.getOrCreateProgram(this.name,{config:this.configuration,defines:m});d.program.set(g.program);const _=(e,t,i)=>{if(t[e]&&i[e])for(const r in t[e])i[e][r]&&i[e][r].set(i.program,r,t[e][r].current)};c&&c.setUniforms(g.program,d,g.binderUniforms,s,{zoom:l}),_("fixedUniforms",this,g),_("terrainUniforms",this,g),_("globeUniforms",this,g),_("fogUniforms",this,g),_("lightsUniforms",this,g),_("shadowUniforms",this,g),f.bind(),d.setColorMode(new It([p.ONE,p.ONE_MINUS_SRC_ALPHA,p.ZERO,p.ONE],e.aA.transparent,[!0,!0,!0,!1])),d.setDepthMode(new Mt(i.func===p.LESS?p.LEQUAL:i.func,Mt.ReadOnly,i.range)),d.setStencilMode(Pt.disabled);const y=3*o.primitiveLength*2,v=3*o.primitiveOffset*2*2;h&&h>1?p.drawElementsInstanced(p.LINES,y,p.UNSIGNED_SHORT,v,h):p.drawElements(p.LINES,y,p.UNSIGNED_SHORT,v),a.bind(),d.program.set(this.program),d.setDepthMode(i),d.setStencilMode(r),d.setColorMode(n)}draw(e,t,i,r,n,a,o,s,l,c,h,u,d,p,f,m){const g=e.context,_=g.gl;if(this.failedToCreate)return;g.program.set(this.program),g.setDepthMode(i),g.setStencilMode(r),g.setColorMode(n),g.setCullFace(a);for(const x of Object.keys(this.fixedUniforms))this.fixedUniforms[x].set(this.program,x,o[x]);p&&p.setUniforms(this.program,g,this.binderUniforms,u,{zoom:d});const y={[_.POINTS]:1,[_.LINES]:2,[_.TRIANGLES]:3,[_.LINE_STRIP]:1}[t],v=m&&m>0?1:void 0;for(const x of h.get()){const a=x.vaos||(x.vaos={});(a[s]||(a[s]=new Xr)).bind(g,this,l,p?p.getPaintVertexBuffers():[],c,x.vertexOffset,f||[],v),m&&m>1?_.drawElementsInstanced(t,x.primitiveLength*y,_.UNSIGNED_SHORT,x.primitiveOffset*y*2,m):c?_.drawElements(t,x.primitiveLength*y,_.UNSIGNED_SHORT,x.primitiveOffset*y*2):_.drawArrays(t,x.vertexOffset,x.vertexLength),t===_.TRIANGLES&&c&&this._drawDebugWireframe(e,i,r,n,c,x,u,d,p,m)}}}function vn(t,i){const r=Math.pow(2,i.tileID.overscaledZ),n=i.tileSize*Math.pow(2,t.transform.tileZoom)/r,a=n*(i.tileID.canonical.x+i.tileID.wrap*r),o=n*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/e.a6(i,1,t.transform.tileZoom),u_pixel_coord_upper:[a>>16,o>>16],u_pixel_coord_lower:[65535&a,65535&o]}}const xn=e.a9.create(),bn=(t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g)=>{const _=i.style.light,y=_.properties.get("position"),v=[y.x,y.y,y.z],x=e.ct.create();"viewport"===_.properties.get("anchor")&&(e.ct.fromRotation(x,-i.transform.angle),e.Q.transformMat3(v,v,x));const b=_.properties.get("color"),w=i.transform,S={u_matrix:t,u_lightpos:v,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_vertical_gradient:+r,u_opacity:n,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:xn,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:a,u_edge_radius:o,u_flood_light_color:d,u_vertical_scale:p,u_flood_light_intensity:f,u_ground_shadow_factor:m,u_emissive_strength:g};return"globe"===w.projection.name&&(S.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],S.u_zoom_transition=c,S.u_inv_rot_matrix=u,S.u_merc_center=h,S.u_up_dir=w.projection.upVector(new e.bv(0,0,0),h[0]*e.Y,h[1]*e.Y),S.u_height_lift=l),S},wn=(e,t,i)=>({u_matrix:e,u_edge_radius:t,u_vertical_scale:i}),Sn=(t,i,r,n,a,o,s,l,c,h,u,d,p,f)=>{const m=bn(t,i,r,n,a,o,s,c,h,u,d,p,f,1,[0,0,0],0),g={u_height_factor:-Math.pow(2,s.overscaledZ)/l.tileSize/8};return e.e(m,vn(i,l),g)},Tn=(e,t)=>({u_matrix:e,u_emissive_strength:t}),En=(t,i,r,n)=>e.e(Tn(t,i),vn(r,n)),Mn=(e,t,i)=>({u_matrix:e,u_world:i,u_emissive_strength:t}),An=(t,i,r,n,a)=>e.e(En(t,i,r,n),{u_world:a}),Pn=(t,i,r,n)=>{const a=e.Y/r.tileSize;return{u_matrix:t,u_camera_to_center_distance:i.getCameraToCenterDistance(n),u_extrude_scale:[i.pixelsToGLUnits[0]/a,i.pixelsToGLUnits[1]/a]}},Cn=function(e,t){return{u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1}},In=e.a9.create(),kn=(t,i,r,n,a,o,s)=>{const l=t.transform,c="globe"===l.projection.name,h=c?e.cu(l.zoom,i.canonical)*l._pixelsPerMercatorPixel:e.a6(r,1,o),u={u_matrix:i.projMatrix,u_extrude_scale:h,u_intensity:s,u_inv_rot_matrix:In,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){u.u_inv_rot_matrix=n,u.u_merc_center=a,u.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],u.u_zoom_transition=e.W(l.zoom);const t=a[0]*e.Y,r=a[1]*e.Y;u.u_up_dir=l.projection.upVector(new e.bv(0,0,0),t,r)}return u};function Dn(e,t,i){let[r,n,a,o]=t,[s,l]=i;if(s===l)return[0,0,0,0];const c=255*(e-1)/(e*(l-s));return[r*c,n*c,a*c,o*c]}function Rn(e,t,i){let[r,n]=i;return r===n?0:.5/e+(t-r)*(e-1)/(e*(n-r))}const Ln=(t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,v,x,b)=>({u_matrix:t,u_normalize_matrix:i,u_globe_matrix:r,u_merc_matrix:n,u_grid_matrix:a,u_tl_parent:o,u_scale_parent:h,u_fade_t:u.mix,u_opacity:u.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:e.cv(d.paint.get("raster-saturation")),u_contrast_factor:e.cw(d.paint.get("raster-contrast")),u_spin_weights:zn(d.paint.get("raster-hue-rotate")),u_perspective_transform:p,u_raster_elevation:f,u_zoom_transition:s,u_merc_center:l,u_cutoff_params:c,u_colorization_mix:Dn(e.cx,g,y),u_colorization_offset:Rn(e.cx,_,y),u_color_ramp:m,u_texture_offset:[x/(v+2*x),v/(v+2*x)],u_texture_res:[v+2*x,v+2*x],u_emissive_strength:b});function zn(e){e*=Math.PI/180;const t=Math.sin(e),i=Math.cos(e);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}const Fn=(e,t,i,r,n,a,o,s,l,c,h,u)=>({u_matrix:e,u_normalize_matrix:t,u_globe_matrix:i,u_merc_matrix:r,u_grid_matrix:n,u_tl_parent:a,u_scale_parent:c,u_fade_t:h.mix,u_opacity:h.opacity,u_image0:0,u_image1:1,u_raster_elevation:u,u_zoom_transition:o,u_merc_center:s,u_cutoff_params:l}),On=(e,t,i,r,n,a,o,s,l,c)=>({u_particle_texture:e,u_particle_texture_side_len:t,u_tile_offset:i,u_velocity:r,u_color_ramp:a,u_velocity_res:n,u_max_speed:o,u_uv_offset:s,u_data_scale:l,u_data_offset:c,u_particle_pos_scale:1.3,u_particle_pos_offset:[Ft,Ft]}),Bn=(e,t,i,r,n,a,o,s,l,c)=>({u_particle_texture:e,u_particle_texture_side_len:t,u_velocity:i,u_velocity_res:r,u_max_speed:n,u_speed_factor:a,u_reset_rate:o,u_rand_seed:Math.random(),u_uv_offset:s,u_data_scale:l,u_data_offset:c,u_particle_pos_scale:1.3,u_particle_pos_offset:[Ft,Ft]}),Nn=e.a9.create(),Vn=(t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y)=>{const v=a.transform,x={u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:v.getCameraToCenterDistance(g),u_rotate_symbol:+r,u_aspect_ratio:v.width/v.height,u_fade_change:a.options.fadeDuration?a.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:s,u_coord_matrix:l,u_is_text:+c,u_pitch_with_map:+n,u_texsize:h,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Nn,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Nn,u_up_vector:[0,-1,0],u_color_adj_mat:_,u_icon_transition:y||0};return"globe"===g.name&&(x.u_tile_id=[u.canonical.x,u.canonical.y,1<<u.canonical.z],x.u_zoom_transition=d,x.u_inv_rot_matrix=f,x.u_merc_center=p,x.u_camera_forward=v._camera.forward(),x.u_ecef_origin=e.cy(v.globeMatrix,u.toUnwrapped()),x.u_tile_matrix=Float32Array.from(v.globeMatrix),x.u_up_vector=m),x},jn=(t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_)=>e.e(Vn(t,i,r,n,a,o,s,l,c,h,d,p,f,m,g,_),{u_gamma_scale:n?a.transform.getCameraToCenterDistance(_)*Math.cos(a.terrain?0:a.transform._pitch):1,u_device_pixel_ratio:e.f.devicePixelRatio,u_is_halo:+u,undefined:void 0}),Un=(t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g)=>e.e(jn(t,i,r,n,a,o,s,l,!0,c,!0,u,d,p,f,m,g),{u_texsize_icon:h,u_texture_icon:1}),Gn=(e,t,i,r)=>({u_matrix:e,u_emissive_strength:t,u_opacity:i,u_color:r}),qn=(t,i,r,n,a,o,s)=>e.e(function(t,i,r,n){const a=r.imageManager.getPattern(t.toString(),i),{width:o,height:s}=r.imageManager.getPixelSize(i),l=Math.pow(2,n.tileID.overscaledZ),c=n.tileSize*Math.pow(2,r.transform.tileZoom)/l,h=c*(n.tileID.canonical.x+n.tileID.wrap*l),u=c*n.tileID.canonical.y;return{u_image:0,u_pattern_tl:a.tl,u_pattern_br:a.br,u_texsize:[o,s],u_pattern_size:a.displaySize,u_tile_units_to_pixels:1/e.a6(n,1,r.transform.tileZoom),u_pixel_coord_upper:[h>>16,u>>16],u_pixel_coord_lower:[65535&h,65535&u]}}(a,o,n,s),{u_matrix:t,u_emissive_strength:i,u_opacity:r}),Hn=new Float32Array(e.a9.identity([])),Wn=function(t,i,r,n,a,o,s,l,c,h,u,d,p){let f=arguments.length>13&&void 0!==arguments[13]?arguments[13]:[0,0,0],m=arguments.length>14?arguments[14]:void 0;const g=a.style.light,_=g.properties.get("position"),y=[-_.x,-_.y,_.z],v=e.ct.create();"viewport"===g.properties.get("anchor")&&(e.ct.fromRotation(v,-a.transform.angle),e.Q.transformMat3(y,y,v));const x="MASK"===u.alphaMode,b=g.properties.get("color"),w=p.paint.get("model-ambient-occlusion-intensity"),S=p.paint.get("model-color").constantOr(e.aA.white),T=p.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:t,u_lighting_matrix:i,u_normal_matrix:r,u_node_matrix:n||Hn,u_lightpos:y,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_camera_pos:f,u_opacity:o,u_baseTextureIsAlpha:0,u_alphaMask:+x,u_alphaCutoff:u.alphaCutoff,u_baseColorFactor:[s.r,s.g,s.b,s.a],u_emissiveFactor:[l[0],l[1],l[2],1],u_metallicFactor:c,u_roughnessFactor:h,u_baseColorTexture:fr.BaseColor,u_metallicRoughnessTexture:fr.MetallicRoughness,u_normalTexture:fr.Normal,u_occlusionTexture:fr.Occlusion,u_emissionTexture:fr.Emission,u_color_mix:[S.r,S.g,S.b,T],u_aoIntensity:w,u_emissive_strength:d,u_occlusionTextureTransform:m||[0,0,0,0]}},Zn=function(e){return{u_matrix:e,u_instance:arguments.length>1&&void 0!==arguments[1]?arguments[1]:Hn,u_node_matrix:arguments.length>2&&void 0!==arguments[2]?arguments[2]:Hn}},Qn={fillExtrusion:t=>({u_matrix:new e.bN(t),u_lightpos:new e.bP(t),u_lightintensity:new e.bQ(t),u_lightcolor:new e.bP(t),u_vertical_gradient:new e.bQ(t),u_opacity:new e.bQ(t),u_edge_radius:new e.bQ(t),u_ao:new e.bO(t),u_tile_id:new e.bP(t),u_zoom_transition:new e.bQ(t),u_inv_rot_matrix:new e.bN(t),u_merc_center:new e.bO(t),u_up_dir:new e.bP(t),u_height_lift:new e.bQ(t),u_flood_light_color:new e.bP(t),u_vertical_scale:new e.bQ(t),u_flood_light_intensity:new e.bQ(t),u_ground_shadow_factor:new e.bP(t),u_emissive_strength:new e.bQ(t)}),fillExtrusionDepth:t=>({u_matrix:new e.bN(t),u_edge_radius:new e.bQ(t),u_vertical_scale:new e.bQ(t)}),fillExtrusionPattern:t=>({u_matrix:new e.bN(t),u_lightpos:new e.bP(t),u_lightintensity:new e.bQ(t),u_lightcolor:new e.bP(t),u_vertical_gradient:new e.bQ(t),u_height_factor:new e.bQ(t),u_edge_radius:new e.bQ(t),u_ao:new e.bO(t),u_tile_id:new e.bP(t),u_zoom_transition:new e.bQ(t),u_inv_rot_matrix:new e.bN(t),u_merc_center:new e.bO(t),u_up_dir:new e.bP(t),u_height_lift:new e.bQ(t),u_image:new e.bR(t),u_texsize:new e.bO(t),u_pixel_coord_upper:new e.bO(t),u_pixel_coord_lower:new e.bO(t),u_tile_units_to_pixels:new e.bQ(t),u_opacity:new e.bQ(t)}),fillExtrusionGroundEffect:t=>({u_matrix:new e.bN(t),u_opacity:new e.bQ(t),u_ao_pass:new e.bQ(t),u_meter_to_tile:new e.bQ(t),u_ao:new e.bO(t),u_flood_light_intensity:new e.bQ(t),u_flood_light_color:new e.bP(t),u_attenuation:new e.bQ(t),u_edge_radius:new e.bQ(t),u_fb:new e.bR(t),u_fb_size:new e.bQ(t)}),fill:t=>({u_matrix:new e.bN(t),u_emissive_strength:new e.bQ(t)}),fillPattern:t=>({u_matrix:new e.bN(t),u_emissive_strength:new e.bQ(t),u_image:new e.bR(t),u_texsize:new e.bO(t),u_pixel_coord_upper:new e.bO(t),u_pixel_coord_lower:new e.bO(t),u_tile_units_to_pixels:new e.bQ(t)}),fillOutline:t=>({u_matrix:new e.bN(t),u_emissive_strength:new e.bQ(t),u_world:new e.bO(t)}),fillOutlinePattern:t=>({u_matrix:new e.bN(t),u_emissive_strength:new e.bQ(t),u_world:new e.bO(t),u_image:new e.bR(t),u_texsize:new e.bO(t),u_pixel_coord_upper:new e.bO(t),u_pixel_coord_lower:new e.bO(t),u_tile_units_to_pixels:new e.bQ(t)}),circle:e.cz,collisionBox:t=>({u_matrix:new e.bN(t),u_camera_to_center_distance:new e.bQ(t),u_extrude_scale:new e.bO(t)}),collisionCircle:t=>({u_matrix:new e.bN(t),u_inv_matrix:new e.bN(t),u_camera_to_center_distance:new e.bQ(t),u_viewport_size:new e.bO(t)}),debug:t=>({u_color:new e.cf(t),u_matrix:new e.bN(t),u_overlay:new e.bR(t),u_overlay_scale:new e.bQ(t)}),clippingMask:t=>({u_matrix:new e.bN(t)}),heatmap:t=>({u_extrude_scale:new e.bQ(t),u_intensity:new e.bQ(t),u_matrix:new e.bN(t),u_inv_rot_matrix:new e.bN(t),u_merc_center:new e.bO(t),u_tile_id:new e.bP(t),u_zoom_transition:new e.bQ(t),u_up_dir:new e.bP(t)}),heatmapTexture:t=>({u_image:new e.bR(t),u_color_ramp:new e.bR(t),u_opacity:new e.bQ(t)}),hillshade:t=>({u_matrix:new e.bN(t),u_image:new e.bR(t),u_latrange:new e.bO(t),u_light:new e.bO(t),u_shadow:new e.cf(t),u_highlight:new e.cf(t),u_emissive_strength:new e.bQ(t),u_accent:new e.cf(t)}),hillshadePrepare:t=>({u_matrix:new e.bN(t),u_image:new e.bR(t),u_dimension:new e.bO(t),u_zoom:new e.bQ(t)}),line:e.cA,linePattern:e.cB,raster:t=>({u_matrix:new e.bN(t),u_normalize_matrix:new e.bN(t),u_globe_matrix:new e.bN(t),u_merc_matrix:new e.bN(t),u_grid_matrix:new e.cg(t),u_tl_parent:new e.bO(t),u_scale_parent:new e.bQ(t),u_fade_t:new e.bQ(t),u_opacity:new e.bQ(t),u_image0:new e.bR(t),u_image1:new e.bR(t),u_brightness_low:new e.bQ(t),u_brightness_high:new e.bQ(t),u_saturation_factor:new e.bQ(t),u_contrast_factor:new e.bQ(t),u_spin_weights:new e.bP(t),u_perspective_transform:new e.bO(t),u_raster_elevation:new e.bQ(t),u_zoom_transition:new e.bQ(t),u_merc_center:new e.bO(t),u_cutoff_params:new e.bS(t),u_colorization_mix:new e.bS(t),u_colorization_offset:new e.bQ(t),u_color_ramp:new e.bR(t),u_texture_offset:new e.bO(t),u_texture_res:new e.bO(t),u_emissive_strength:new e.bQ(t)}),rasterParticle:t=>({u_matrix:new e.bN(t),u_normalize_matrix:new e.bN(t),u_globe_matrix:new e.bN(t),u_merc_matrix:new e.bN(t),u_grid_matrix:new e.cg(t),u_tl_parent:new e.bO(t),u_scale_parent:new e.bQ(t),u_fade_t:new e.bQ(t),u_opacity:new e.bQ(t),u_image0:new e.bR(t),u_image1:new e.bR(t),u_raster_elevation:new e.bQ(t),u_zoom_transition:new e.bQ(t),u_merc_center:new e.bO(t),u_cutoff_params:new e.bS(t)}),rasterParticleTexture:t=>({u_texture:new e.bR(t),u_opacity:new e.bQ(t)}),rasterParticleDraw:t=>({u_particle_texture:new e.bR(t),u_particle_texture_side_len:new e.bQ(t),u_tile_offset:new e.bO(t),u_velocity:new e.bR(t),u_color_ramp:new e.bR(t),u_velocity_res:new e.bO(t),u_max_speed:new e.bQ(t),u_uv_offset:new e.bO(t),u_data_scale:new e.bS(t),u_data_offset:new e.bQ(t),u_particle_pos_scale:new e.bQ(t),u_particle_pos_offset:new e.bO(t)}),rasterParticleUpdate:t=>({u_particle_texture:new e.bR(t),u_particle_texture_side_len:new e.bQ(t),u_velocity:new e.bR(t),u_velocity_res:new e.bO(t),u_max_speed:new e.bQ(t),u_speed_factor:new e.bQ(t),u_reset_rate:new e.bQ(t),u_rand_seed:new e.bQ(t),u_uv_offset:new e.bO(t),u_data_scale:new e.bS(t),u_data_offset:new e.bQ(t),u_particle_pos_scale:new e.bQ(t),u_particle_pos_offset:new e.bO(t)}),symbolIcon:t=>({u_is_size_zoom_constant:new e.bR(t),u_is_size_feature_constant:new e.bR(t),u_size_t:new e.bQ(t),u_size:new e.bQ(t),u_camera_to_center_distance:new e.bQ(t),u_rotate_symbol:new e.bR(t),u_aspect_ratio:new e.bQ(t),u_fade_change:new e.bQ(t),u_matrix:new e.bN(t),u_label_plane_matrix:new e.bN(t),u_coord_matrix:new e.bN(t),u_is_text:new e.bR(t),u_pitch_with_map:new e.bR(t),u_texsize:new e.bO(t),u_tile_id:new e.bP(t),u_zoom_transition:new e.bQ(t),u_inv_rot_matrix:new e.bN(t),u_merc_center:new e.bO(t),u_camera_forward:new e.bP(t),u_tile_matrix:new e.bN(t),u_up_vector:new e.bP(t),u_ecef_origin:new e.bP(t),u_texture:new e.bR(t),u_icon_transition:new e.bQ(t),u_color_adj_mat:new e.bN(t)}),symbolSDF:t=>({u_is_size_zoom_constant:new e.bR(t),u_is_size_feature_constant:new e.bR(t),u_size_t:new e.bQ(t),u_size:new e.bQ(t),u_camera_to_center_distance:new e.bQ(t),u_rotate_symbol:new e.bR(t),u_aspect_ratio:new e.bQ(t),u_fade_change:new e.bQ(t),u_matrix:new e.bN(t),u_label_plane_matrix:new e.bN(t),u_coord_matrix:new e.bN(t),u_is_text:new e.bR(t),u_pitch_with_map:new e.bR(t),u_texsize:new e.bO(t),u_texture:new e.bR(t),u_gamma_scale:new e.bQ(t),u_device_pixel_ratio:new e.bQ(t),u_tile_id:new e.bP(t),u_zoom_transition:new e.bQ(t),u_inv_rot_matrix:new e.bN(t),u_merc_center:new e.bO(t),u_camera_forward:new e.bP(t),u_tile_matrix:new e.bN(t),u_up_vector:new e.bP(t),u_ecef_origin:new e.bP(t),u_is_halo:new e.bR(t)}),symbolTextAndIcon:t=>({u_is_size_zoom_constant:new e.bR(t),u_is_size_feature_constant:new e.bR(t),u_size_t:new e.bQ(t),u_size:new e.bQ(t),u_camera_to_center_distance:new e.bQ(t),u_rotate_symbol:new e.bR(t),u_aspect_ratio:new e.bQ(t),u_fade_change:new e.bQ(t),u_matrix:new e.bN(t),u_label_plane_matrix:new e.bN(t),u_coord_matrix:new e.bN(t),u_is_text:new e.bR(t),u_pitch_with_map:new e.bR(t),u_texsize:new e.bO(t),u_texsize_icon:new e.bO(t),u_texture:new e.bR(t),u_texture_icon:new e.bR(t),u_gamma_scale:new e.bQ(t),u_device_pixel_ratio:new e.bQ(t),u_is_halo:new e.bR(t)}),background:t=>({u_matrix:new e.bN(t),u_emissive_strength:new e.bQ(t),u_opacity:new e.bQ(t),u_color:new e.cf(t)}),backgroundPattern:t=>({u_matrix:new e.bN(t),u_emissive_strength:new e.bQ(t),u_opacity:new e.bQ(t),u_image:new e.bR(t),u_pattern_tl:new e.bO(t),u_pattern_br:new e.bO(t),u_texsize:new e.bO(t),u_pattern_size:new e.bO(t),u_pixel_coord_upper:new e.bO(t),u_pixel_coord_lower:new e.bO(t),u_tile_units_to_pixels:new e.bQ(t)}),terrainRaster:en,terrainDepth:en,skybox:t=>({u_matrix:new e.bN(t),u_sun_direction:new e.bP(t),u_cubemap:new e.bR(t),u_opacity:new e.bQ(t),u_temporal_offset:new e.bQ(t)}),skyboxGradient:t=>({u_matrix:new e.bN(t),u_color_ramp:new e.bR(t),u_center_direction:new e.bP(t),u_radius:new e.bQ(t),u_opacity:new e.bQ(t),u_temporal_offset:new e.bQ(t)}),skyboxCapture:t=>({u_matrix_3f:new e.cg(t),u_sun_direction:new e.bP(t),u_sun_intensity:new e.bQ(t),u_color_tint_r:new e.bS(t),u_color_tint_m:new e.bS(t),u_luminance:new e.bQ(t)}),globeRaster:t=>({u_proj_matrix:new e.bN(t),u_globe_matrix:new e.bN(t),u_normalize_matrix:new e.bN(t),u_merc_matrix:new e.bN(t),u_zoom_transition:new e.bQ(t),u_merc_center:new e.bO(t),u_image0:new e.bR(t),u_grid_matrix:new e.cg(t),u_skirt_height:new e.bQ(t),u_far_z_cutoff:new e.bQ(t),u_frustum_tl:new e.bP(t),u_frustum_tr:new e.bP(t),u_frustum_br:new e.bP(t),u_frustum_bl:new e.bP(t),u_globe_pos:new e.bP(t),u_globe_radius:new e.bQ(t),u_viewport:new e.bO(t)}),globeAtmosphere:t=>({u_frustum_tl:new e.bP(t),u_frustum_tr:new e.bP(t),u_frustum_br:new e.bP(t),u_frustum_bl:new e.bP(t),u_horizon:new e.bQ(t),u_transition:new e.bQ(t),u_fadeout_range:new e.bQ(t),u_color:new e.bS(t),u_high_color:new e.bS(t),u_space_color:new e.bS(t),u_temporal_offset:new e.bQ(t),u_horizon_angle:new e.bQ(t)}),model:t=>({u_matrix:new e.bN(t),u_lighting_matrix:new e.bN(t),u_normal_matrix:new e.bN(t),u_node_matrix:new e.bN(t),u_lightpos:new e.bP(t),u_lightintensity:new e.bQ(t),u_lightcolor:new e.bP(t),u_camera_pos:new e.bP(t),u_opacity:new e.bQ(t),u_baseColorFactor:new e.bS(t),u_emissiveFactor:new e.bS(t),u_metallicFactor:new e.bQ(t),u_roughnessFactor:new e.bQ(t),u_baseTextureIsAlpha:new e.bR(t),u_alphaMask:new e.bR(t),u_alphaCutoff:new e.bQ(t),u_baseColorTexture:new e.bR(t),u_metallicRoughnessTexture:new e.bR(t),u_normalTexture:new e.bR(t),u_occlusionTexture:new e.bR(t),u_emissionTexture:new e.bR(t),u_color_mix:new e.bS(t),u_aoIntensity:new e.bQ(t),u_emissive_strength:new e.bQ(t),u_occlusionTextureTransform:new e.bS(t)}),modelDepth:t=>({u_matrix:new e.bN(t),u_instance:new e.bN(t),u_node_matrix:new e.bN(t)}),groundShadow:t=>({u_matrix:new e.bN(t),u_ground_shadow_factor:new e.bP(t)}),stars:t=>({u_matrix:new e.bN(t),u_up:new e.bP(t),u_right:new e.bP(t),u_intensity_multiplier:new e.bQ(t)})};let Xn;function Yn(t,i,r,n,a,o,s){const l=t.context,c=l.gl,h=t.transform,u=t.getOrCreateProgram("collisionBox"),d=[];let p=0,f=0;for(let b=0;b<n.length;b++){const l=n[b],m=i.getTile(l),g=m.getBucket(r);if(!g)continue;const _=ki(l,g,h);let y=_;0===a[0]&&0===a[1]||(y=t.translatePosMatrix(_,m,a,o));const v=s?g.textCollisionBox:g.iconCollisionBox,x=g.collisionCircleArray;if(x.length>0){const t=e.a9.create(),i=y;e.a9.mul(t,g.placementInvProjMatrix,h.glCoordMatrix),e.a9.mul(t,t,g.placementViewportMatrix),d.push({circleArray:x,circleOffset:f,transform:i,invTransform:t,projection:g.getProjection()}),p+=x.length/4,f=p}v&&(t.terrain&&t.terrain.setupElevationDraw(m,u),u.draw(t,c.LINES,Mt.disabled,Pt.disabled,t.colorModeForRenderPass(),Rt.disabled,Pn(y,h,m,g.getProjection()),r.id,v.layoutVertexBuffer,v.indexBuffer,v.segments,null,h.zoom,null,[v.collisionVertexBuffer,v.collisionVertexBufferExt]))}if(!s||!d.length)return;const m=t.getOrCreateProgram("collisionCircle"),g=new e.cC;g.resize(4*p),g._trim();let _=0;for(const e of d)for(let t=0;t<e.circleArray.length/4;t++){const i=4*t,r=e.circleArray[i+0],n=e.circleArray[i+1],a=e.circleArray[i+2],o=e.circleArray[i+3];g.emplace(_++,r,n,a,o,0),g.emplace(_++,r,n,a,o,1),g.emplace(_++,r,n,a,o,2),g.emplace(_++,r,n,a,o,3)}(!Xn||Xn.length<2*p)&&(Xn=function(t){const i=2*t,r=new e.az;r.resize(i),r._trim();for(let e=0;e<i;e++){const t=6*e;r.uint16[t+0]=4*e+0,r.uint16[t+1]=4*e+1,r.uint16[t+2]=4*e+2,r.uint16[t+3]=4*e+2,r.uint16[t+4]=4*e+3,r.uint16[t+5]=4*e+0}return r}(p));const y=l.createIndexBuffer(Xn,!0),v=l.createVertexBuffer(g,e.cD.members,!0);for(const b of d){const i={u_matrix:b.transform,u_inv_matrix:b.invTransform,u_camera_to_center_distance:(x=h).getCameraToCenterDistance(b.projection),u_viewport_size:[x.width,x.height]};m.draw(t,c.TRIANGLES,Mt.disabled,Pt.disabled,t.colorModeForRenderPass(),Rt.disabled,i,r.id,v,y,e.aE.simpleSegment(0,2*b.circleOffset,b.circleArray.length,b.circleArray.length/2),null,h.zoom)}var x;v.destroy(),y.destroy()}const Jn=e.a9.create();function Kn(t){const i=t._camera.getWorldToCamera(t.worldSize,1),r=e.a9.multiply([],i,t.globeMatrix);e.a9.invert(r,r);const n=[0,0,0],a=[0,1,0,0];return e.aa.transformMat4(a,a,r),n[0]=a[0],n[1]=a[1],n[2]=a[2],e.Q.normalize(n,n),n}function $n(t,i){let{width:r,height:n,anchor:a,textOffset:o,textScale:s}=t;const{horizontalAlign:l,verticalAlign:c}=e.bi(a),h=-(l-.5)*r,u=-(c-.5)*n,d=e.bh(a,o);return new e.P((h/s+d[0])*i,(u/s+d[1])*i)}function ea(t,i,r,n,a,o,s,l,c,h,u){const d=t.text.placedSymbolArray,p=t.text.dynamicLayoutVertexArray,f=t.icon.dynamicLayoutVertexArray,m={},g=t.getProjection(),_=Di(l,g,o),y=o.elevation,v=g.upVectorScale(l.canonical,o.center.lat,o.worldSize).metersToTile;p.clear();for(let x=0;x<d.length;x++){const f=d.get(x),{tileAnchorX:b,tileAnchorY:w,numGlyphs:S}=f,T=f.hidden||!f.crossTileID||t.allowVerticalPlacement&&!f.placedOrientation?null:n[f.crossTileID];if(T){let n=0,d=0,x=0;if(y){const e=y?y.getAtTileOffset(l,b,w):0,[t,i,r]=g.upVector(l.canonical,b,w);n=e*t*v,d=e*i*v,x=e*r*v}let[E,M,A,P]=gi(f.projectedAnchorX+n,f.projectedAnchorY+d,f.projectedAnchorZ+x,r?_:s);const C=_i(o.getCameraToCenterDistance(g),P);let I=a.evaluateSizeForFeature(t.textSizeData,h,f)*C/e.bf;r&&(I*=t.tilePixelRatio/c);const k=$n(T,I);r?(({x:E,y:M,z:A}=g.projectTilePoint(b+k.x,w+k.y,l.canonical)),[E,M,A]=gi(E+n,M+d,A+x,s)):(i&&k._rotate(-o.angle),E+=k.x,M+=k.y,A=0);const D=t.allowVerticalPlacement&&f.placedOrientation===e.b9.vertical?Math.PI/2:0;for(let t=0;t<S;t++)e.bc(p,E,M,A,D);u&&f.associatedIconIndex>=0&&(m[f.associatedIconIndex]={x:E,y:M,z:A,angle:D})}else Mi(S,p)}if(u){f.clear();const i=t.icon.placedSymbolArray;for(let t=0;t<i.length;t++){const r=i.get(t),{numGlyphs:n}=r,a=m[t];if(r.hidden||!a)Mi(n,f);else{const{x:t,y:i,z:r,angle:o}=a;for(let a=0;a<n;a++)e.bc(f,t,i,r,o)}}t.icon.dynamicLayoutVertexBuffer.updateData(f)}t.text.dynamicLayoutVertexBuffer.updateData(p)}function ta(t,i,r,n,a,o){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};const l=r.paint.get("icon-translate"),c=r.paint.get("text-translate"),h=r.paint.get("icon-translate-anchor"),u=r.paint.get("text-translate-anchor"),d=r.layout.get("icon-rotation-alignment"),p=r.layout.get("text-rotation-alignment"),f=r.layout.get("icon-pitch-alignment"),m=r.layout.get("text-pitch-alignment"),g=r.layout.get("icon-keep-upright"),_=r.layout.get("text-keep-upright"),y=r.paint.get("icon-color-saturation"),v=r.paint.get("icon-color-contrast"),x=r.paint.get("icon-color-brightness-min"),b=r.paint.get("icon-color-brightness-max"),w=t.context,S=w.gl,T=t.transform,E="map"===d,M="map"===p,A="map"===f,P="map"===m,C=void 0!==r.layout.get("symbol-sort-key").constantOr(1);let I=!1;const k=t.depthModeForSublayer(0,Mt.ReadOnly),D=[e.a8(T.center.lng),e.ah(T.center.lat)],R=r.layout.get("text-variable-anchor"),L="globe"===T.projection.name,z=[],F=[0,-1,0];for(const O of n){const n=i.getTile(O),a=n.getBucket(r);if(!a)continue;if("mercator"===a.projection.name&&L)continue;if(a.fullyClipped)continue;const o="globe"===a.projection.name,d=o?e.W(T.zoom):0,p=Di(O,a.getProjection(),T),f=T.calculatePixelsToTileUnitsMatrix(n),m=R&&a.hasTextData(),w=a.hasIconTextFit()&&m&&a.hasIconData(),k=a.getProjection().createInversionMatrix(T,O.canonical),B=()=>{const i=E&&"point"!==r.layout.get("symbol-placement"),s=[],c=i||w,u=r.paint.get("icon-image-cross-fade").constantOr(0);t.terrainRenderModeElevated()&&A&&s.push("PITCH_WITH_MAP_TERRAIN"),o&&(s.push("PROJECTION_GLOBE_VIEW"),c&&s.push("PROJECTED_POS_ON_VIEWPORT")),u>0&&s.push("ICON_TRANSITION"),a.icon.zOffsetVertexBuffer&&s.push("Z_OFFSET"),0===y&&0===v&&0===x&&1===b||s.push("COLOR_ADJUSTMENT");const m=a.icon.programConfigurations.get(r.id),_=t.getOrCreateProgram(a.sdfIcons?"symbolSDF":"symbolIcon",{config:m,defines:s});let M;const P=n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],C=a.iconSizeData,I=e.b8(C,T.zoom),R=A||0!==T.pitch,z=pi(p,n.tileID.canonical,A,E,T,a.getProjection(),f),B=mi(p,n.tileID.canonical,A,E,T,a.getProjection(),f),N=t.translatePosMatrix(B,n,l,h,!0),V=t.translatePosMatrix(p,n,l,h),j=c?Jn:z,U=E&&!A&&!i;let G=F;!L&&!T.mercatorFromTransition||E||(G=Kn(T));const q=o?G:F;if(a.sdfIcons&&!a.iconsInText)M=jn(C.kind,I,U,A,t,V,j,N,!1,P,!0,O,d,D,k,q,a.getProjection());else{const e=r.getColorAdjustmentMatrix(y,v,x,b);M=Vn(C.kind,I,U,A,t,V,j,N,!1,P,O,d,D,k,q,a.getProjection(),e,u)}const H=n.imageAtlasTexture?n.imageAtlasTexture:null,W=1!==r.layout.get("icon-size").constantOr(0)||a.iconsNeedLinear,Z=a.sdfIcons||t.options.rotating||t.options.zooming||W||R?S.LINEAR:S.NEAREST,Q=a.sdfIcons&&0!==r.paint.get("icon-halo-width").constantOr(1),X=t.terrain&&A&&i?e.a9.invert(e.a9.create(),z):Jn;if(i&&a.icon){const e=T.elevation,i=e?e.getAtTileOffsetFunc(O,T.center.lat,T.worldSize,a.getProjection()):null,r=fi(p,n.tileID.canonical,A,E,T,a.getProjection(),f);vi(a,p,t,!1,r,B,A,g,i,O)}return{program:_,buffers:a.icon,uniformValues:M,atlasTexture:H,atlasTextureIcon:null,atlasInterpolation:Z,atlasInterpolationIcon:null,isSDF:a.sdfIcons,hasHalo:Q,tile:n,labelPlaneMatrixInv:X}},N=()=>{const i=M&&"point"!==r.layout.get("symbol-placement"),s=[],l=i||R||w;t.terrainRenderModeElevated()&&P&&s.push("PITCH_WITH_MAP_TERRAIN"),o&&(s.push("PROJECTION_GLOBE_VIEW"),l&&s.push("PROJECTED_POS_ON_VIEWPORT")),a.text.zOffsetVertexBuffer&&s.push("Z_OFFSET");const h=a.text.programConfigurations.get(r.id),m=t.getOrCreateProgram(a.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:h,defines:s});let g,y=[0,0],v=null;const x=a.textSizeData;a.iconsInText&&(y=n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],v=n.imageAtlasTexture?n.imageAtlasTexture:null,g=P||0!==T.pitch||t.options.rotating||t.options.zooming||"composite"===x.kind||"camera"===x.kind?S.LINEAR:S.NEAREST);const b=n.glyphAtlasTexture?n.glyphAtlasTexture.size:[0,0],E=e.b8(x,T.zoom),A=pi(p,n.tileID.canonical,P,M,T,a.getProjection(),f),C=mi(p,n.tileID.canonical,P,M,T,a.getProjection(),f),I=t.translatePosMatrix(C,n,c,u,!0),z=t.translatePosMatrix(p,n,c,u),B=l?Jn:A,N=M&&!P&&!i;let V=F;!L&&!T.mercatorFromTransition||M||(V=Kn(T));const j=o?V:F;let U;U=a.iconsInText?Un(x.kind,E,N,P,t,z,B,I,b,y,O,d,D,k,j,a.getProjection()):jn(x.kind,E,N,P,t,z,B,I,!0,b,!0,O,d,D,k,j,a.getProjection());const G=n.glyphAtlasTexture?n.glyphAtlasTexture:null,q=S.LINEAR,H=0!==r.paint.get("text-halo-width").constantOr(1),W=t.terrain&&P&&i?e.a9.invert(e.a9.create(),A):Jn;if(i&&a.text){const e=T.elevation,i=e?e.getAtTileOffsetFunc(O,T.center.lat,T.worldSize,a.getProjection()):null,r=fi(p,n.tileID.canonical,P,M,T,a.getProjection(),f);vi(a,p,t,!0,r,C,P,_,i,O)}return{program:m,buffers:a.text,uniformValues:U,atlasTexture:G,atlasTextureIcon:v,atlasInterpolation:q,atlasInterpolationIcon:g,isSDF:!0,hasHalo:H,tile:n,labelPlaneMatrixInv:W}},V=a.icon.segments.get().length,j=a.text.segments.get().length,U=V&&!s.onlyText?B():null,G=j&&!s.onlyIcons?N():null,q=r.paint.get("icon-opacity").constantOr(1),H=r.paint.get("text-opacity").constantOr(1);if(C&&a.canOverlap){I=!0;const t=q&&!s.onlyText?a.icon.segments.get():[],i=H&&!s.onlyIcons?a.text.segments.get():[];for(const r of t)z.push({segments:new e.aE([r]),sortKey:r.sortKey,state:U});for(const r of i)z.push({segments:new e.aE([r]),sortKey:r.sortKey,state:G})}else s.onlyText||z.push({segments:q?a.icon.segments:new e.aE([]),sortKey:0,state:U}),s.onlyIcons||z.push({segments:H?a.text.segments:new e.aE([]),sortKey:0,state:G})}I&&z.sort(((e,t)=>e.sortKey-t.sortKey));for(const e of z){const i=e.state;if(i)if(t.terrain&&t.terrain.setupElevationDraw(i.tile,i.program,{useDepthForOcclusion:T.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:i.labelPlaneMatrixInv}),w.activeTexture.set(S.TEXTURE0),i.atlasTexture&&i.atlasTexture.bind(i.atlasInterpolation,S.CLAMP_TO_EDGE,!0),i.atlasTextureIcon&&(w.activeTexture.set(S.TEXTURE1),i.atlasTextureIcon&&i.atlasTextureIcon.bind(i.atlasInterpolationIcon,S.CLAMP_TO_EDGE,!0)),t.uploadCommonLightUniforms(t.context,i.program),i.hasHalo){const n=i.uniformValues;n.u_is_halo=1,ia(i.buffers,e.segments,r,t,i.program,k,a,o,n,2),n.u_is_halo=0}else{if(i.isSDF){const n=i.uniformValues;i.hasHalo&&(n.u_is_halo=1,ia(i.buffers,e.segments,r,t,i.program,k,a,o,n,1)),n.u_is_halo=0}ia(i.buffers,e.segments,r,t,i.program,k,a,o,i.uniformValues,1)}}}function ia(e,t,i,r,n,a,o,s,l,c){const h=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer];n.draw(r,r.context.gl.TRIANGLES,a,o,s,Rt.disabled,l,i.id,e.layoutVertexBuffer,e.indexBuffer,t,i.paint,r.transform.zoom,e.programConfigurations.get(i.id),h,c)}function ra(e,t,i,r,n,a,o){const s=e.context.gl,l=i.paint.get("fill-pattern"),c=l&&l.constantOr(1);let h,u,d,p,f;o?(u=c&&!i.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",h=s.LINES):(u=c?"fillPattern":"fill",h=s.TRIANGLES);for(const m of r){const r=t.getTile(m);if(c&&!r.patternsLoaded())continue;const g=r.getBucket(i);if(!g)continue;e.prepareDrawTile();const _=g.programConfigurations.get(i.id),y=e.isTileAffectedByFog(m),v=e.getOrCreateProgram(u,{config:_,overrideFog:y});c&&(e.context.activeTexture.set(s.TEXTURE0),r.imageAtlasTexture&&r.imageAtlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),_.updatePaintBuffers());const x=l.constantOr(null);if(x&&r.imageAtlas){const e=r.imageAtlas.patternPositions[x.toString()];e&&_.setConstantPatternPositions(e)}const b=e.translatePosMatrix(m.projMatrix,r,i.paint.get("fill-translate"),i.paint.get("fill-translate-anchor")),w=i.paint.get("fill-emissive-strength");if(o){p=g.indexBuffer2,f=g.segments2;const t=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[s.drawingBufferWidth,s.drawingBufferHeight];d="fillOutlinePattern"===u&&c?An(b,w,e,r,t):Mn(b,w,t)}else p=g.indexBuffer,f=g.segments,d=c?En(b,w,e,r):Tn(b,w);e.uploadCommonUniforms(e.context,v,m.toUnwrapped()),v.draw(e,h,n,e.stencilModeForClipping(m),a,Rt.disabled,d,i.id,g.layoutVertexBuffer,p,f,i.paint,e.transform.zoom,_,void 0)}}function na(t,i,r,n,a,o,s,l){r.resetLayerRenderingStats(t);const c=t.context,h=c.gl,u=t.transform,d=r.paint.get("fill-extrusion-pattern"),p=d.constantOr(1),f=r.paint.get("fill-extrusion-opacity"),m=t.style.enable3dLights(),g=r.paint.get(m&&!p?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),_=[r.paint.get("fill-extrusion-ambient-occlusion-intensity"),g],y=r.layout.get("fill-extrusion-edge-radius"),v=y>0&&!r.paint.get("fill-extrusion-rounded-roof"),x=v?0:y,b="globe"===u.projection.name?e.cM():0,w="globe"===u.projection.name,S=w?e.W(u.zoom):0,T=[e.a8(u.center.lng),e.ah(u.center.lat)],E=r.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),M=r.paint.get("fill-extrusion-flood-light-intensity"),A=r.paint.get("fill-extrusion-vertical-scale"),P=mr(t,r.paint.get("fill-extrusion-cutoff-fade-range")),C=r.paint.get("fill-extrusion-emissive-strength"),I=[];let k;w&&I.push("PROJECTION_GLOBE_VIEW"),_[0]>0&&I.push("FAUX_AO"),v&&I.push("ZERO_ROOF_RADIUS"),l&&I.push("HAS_CENTROID"),M>0&&I.push("FLOOD_LIGHT"),P.shouldRenderCutoff&&I.push("RENDER_CUTOFF");const D="shadow"===t.renderPass,R=t.shadowRenderer,L=D&&!!R;t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0);let z=[0,0,0];if(R){const e=t.style.directionalLight,i=t.style.ambientLight;e&&i&&(z=wr(e,i)),k=I.concat(["SHADOWS_SINGLE_CASCADE"])}const F=L?"fillExtrusionDepth":p?"fillExtrusionPattern":"fillExtrusion",O=r.getLayerRenderingStats();for(const e of n){const n=i.getTile(e),m=n.getBucket(r);if(!m||m.projection.name!==u.projection.name)continue;let g=!1;R&&(g=0===R.getMaxCascadeForTile(e.toUnwrapped()));const y=t.isTileAffectedByFog(e),v=m.programConfigurations.get(r.id),L=t.getOrCreateProgram(F,{config:v,defines:g?k:I,overrideFog:y});if(t.terrain&&t.terrain.setupElevationDraw(n,L,{useMeterToDem:!0}),!m.centroidVertexBuffer){const e=L.attributes.a_centroid_pos;void 0!==e&&h.vertexAttrib2f(e,0,0)}!D&&R&&R.setupShadows(n.tileID.toUnwrapped(),L,"vector-tile",n.tileID.overscaledZ),p&&(t.context.activeTexture.set(h.TEXTURE0),n.imageAtlasTexture&&n.imageAtlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE),v.updatePaintBuffers());const B=d.constantOr(null);if(B&&n.imageAtlas){const e=n.imageAtlas.patternPositions[B.toString()];e&&v.setConstantPatternPositions(e)}const N=r.paint.get("fill-extrusion-vertical-gradient");let V;if(D&&R){if(ha(n.tileID,m,t))continue;const e=R.calculateShadowPassMatrixFromTile(n.tileID.toUnwrapped());V=wn(e,x,A)}else{const i=t.translatePosMatrix(e.expandedProjMatrix,n,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),a=u.projection.createInversionMatrix(u,e.canonical);V=p?Sn(i,t,N,f,_,x,e,n,b,S,T,a,E,A):bn(i,t,N,f,_,x,e,b,S,T,a,E,A,M,z,C)}t.uploadCommonUniforms(c,L,e.toUnwrapped(),null,P);let j=m.segments;if("mercator"===u.projection.name&&!D&&(j=m.getVisibleSegments(n.tileID,t.terrain,t.transform.getFrustum(0)),!j.get().length))continue;if(O)if(D)for(const e of j.get())O.numRenderedVerticesInShadowPass+=e.primitiveLength;else for(const e of j.get())O.numRenderedVerticesInTransparentPass+=e.primitiveLength;const U=[];(t.terrain||l)&&U.push(m.centroidVertexBuffer),w&&U.push(m.layoutVertexExtBuffer),L.draw(t,c.gl.TRIANGLES,a,o,s,Rt.backCCW,V,r.id,m.layoutVertexBuffer,m.indexBuffer,j,r.paint,t.transform.zoom,v,U)}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1)}function aa(t,i,r,n,a,o,s,l,c,h,u,d,p,f,m,g,_,y,v){const x=t.context,b=x.gl,w=t.transform,S=t.transform.zoom,T=[],E=mr(t,r.paint.get("fill-extrusion-cutoff-fade-range"));"clear"===h?(T.push("CLEAR_SUBPASS"),v&&(T.push("CLEAR_FROM_TEXTURE"),x.activeTexture.set(b.TEXTURE0),v.bind(b.LINEAR,b.CLAMP_TO_EDGE))):"sdf"===h&&T.push("SDF_SUBPASS"),_&&T.push("HAS_CENTROID"),E.shouldRenderCutoff&&T.push("RENDER_CUTOFF");const M=r.layout.get("fill-extrusion-edge-radius"),A=(e,i,n,h,y)=>{const b=i.programConfigurations.get(r.id),w=t.isTileAffectedByFog(e),A=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:b,defines:T,overrideFog:w}),P=((e,t,i,r,n,a,o,s,l,c,h)=>({u_matrix:t,u_opacity:i,u_ao_pass:r?1:0,u_meter_to_tile:n,u_ao:a,u_flood_light_intensity:o,u_flood_light_color:s,u_attenuation:l,u_edge_radius:c,u_fb:0,u_fb_size:h}))(0,h,u,c,y,[d,p*y],f,m,g,S>=17?0:M*y,v?v.size[0]:0),C=[];_&&C.push(i.hiddenByLandmarkVertexBuffer),t.uploadCommonUniforms(x,A,e.toUnwrapped(),null,E),A.draw(t,x.gl.TRIANGLES,a,o,s,l,P,r.id,i.vertexBuffer,i.indexBuffer,n,r.paint,S,b,C)};for(const P of n){const n=i.getTile(P),a=n.getBucket(r);if(!a||a.projection.name!==w.projection.name||!a.groundEffect||a.groundEffect&&!a.groundEffect.hasData())continue;const o=a.groundEffect,s=1/a.tileToMeter;{const e=t.translatePosMatrix(P.projMatrix,n,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),i=o.getDefaultSegment();A(P,o,i,e,s)}if(y)for(let l=0;l<4;l++){const a=e.cN[l](P),o=i.getTile(a);if(!o)continue;const c=o.getBucket(r);if(!c||c.projection.name!==w.projection.name||!c.groundEffect||c.groundEffect&&!c.groundEffect.hasData())continue;const h=c.groundEffect;let u,d;0===l?(u=[-e.Y,0,0],d=1):1===l?(u=[e.Y,0,0],d=0):2===l?(u=[0,-e.Y,0],d=3):(u=[0,e.Y,0],d=2);const p=h.regionSegments[d];if(!p)continue;const f=new Float32Array(16);e.a9.translate(f,P.projMatrix,u),A(P,h,p,t.translatePosMatrix(f,n,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),s)}}}function oa(t,i,r,n,a,o,s){0===n.centroidVertexArray.length&&n.createCentroidsBuffer();const l=o?o.findDEMTileFor(r):null;if(!(l&&l.dem||s))return;const c=t=>new e.P(Math.ceil((t+e.cQ)*e.cR),0),h=e=>{const t=i.getSource().minzoom,r=e=>{const t=i.getTileByID(e);if(t&&t.hasData())return t.getBucket(a)},n=[0,-1,1];for(const i of n){if(e.overscaledZ+i<t)continue;const n=r(e.calculateScaledKey(e.overscaledZ+i));if(n)return n}},u=[0,0,0],d=(t,i)=>(u[0]=Math.min(t.min.y,i.min.y),u[1]=Math.max(t.max.y,i.max.y),u[2]=e.Y-i.min.x>t.max.x?i.min.x-e.Y:t.max.x,u),p=(t,i)=>(u[0]=Math.min(t.min.x,i.min.x),u[1]=Math.max(t.max.x,i.max.x),u[2]=e.Y-i.min.y>t.max.y?i.min.y-e.Y:t.max.y,u),f=[(e,t)=>d(e,t),(e,t)=>d(t,e),(e,t)=>p(e,t),(e,t)=>p(t,e)],m=(t,i,n,a,s,c,h)=>{if(!o)return 0;const u=[[c?n:t,c?t:n,0],[c?n:i,c?i:n,0]],d=h<0?e.Y+h:h,p=[c?d:(t+i)/2,c?(t+i)/2:d,0];return 0===n&&h<0||0!==n&&h>0?o.getForTilePoints(s,[p],!0,a):u.push(p),o.getForTilePoints(r,u,!0,l),Math.max(u[0][2],u[1][2],p[2])/o.exaggeration()};for(let y=0;y<4;y++){const t=n.borderFeatureIndices[y];if(0===t.length)continue;const i=e.cN[y](r),a=h(i);if(!(a&&a instanceof e.cO))continue;if(n.borderDoneWithNeighborZ[y]===a.canonical.z)continue;0===a.centroidVertexArray.length&&a.createCentroidsBuffer();const l=o?o.findDEMTileFor(i):null;if(!(l&&l.dem||s))continue;const u=(y<2?1:5)-y,d=a.borderDoneWithNeighborZ[u]!==n.canonical.z,p=a.borderFeatureIndices[u];let v=0;if(n.canonical.z!==a.canonical.z){for(const e of t)n.showCentroid(n.featuresOnBorder[e]);if(d)for(const e of p)a.showCentroid(a.featuresOnBorder[e]);n.borderDoneWithNeighborZ[y]=a.canonical.z,a.borderDoneWithNeighborZ[u]=n.canonical.z}for(const r of t){const t=n.featuresOnBorder[r],o=n.centroidData[t.centroidDataIndex],h=t.borders[y];let d;for(;v<p.length;){d=a.featuresOnBorder[p[v]];const e=d.borders[u];if(e[1]>h[0]+3||e[0]>h[0]-3)break;a.showCentroid(d),v++}if(d&&v<p.length){const r=v;let x=0;for(;!(d.borders[u][0]>h[1]-3)&&(x++,++v!==p.length);)d=a.featuresOnBorder[p[v]];if(d=a.featuresOnBorder[p[r]],x>1){const e=d.borders[u];Math.abs(h[0]-e[0])<3&&Math.abs(h[1]-e[1])<3&&(x=1,v=r+1)}else if(0===x){n.showCentroid(t);continue}const b=a.centroidData[d.centroidDataIndex];s&&1===x&&(((g=o).flags|(_=b).flags)&e.cP?(g.flags|=e.cP,_.flags|=e.cP):(g.flags&=~e.cP,_.flags&=~e.cP));const w=t.intersectsCount()>1||d.intersectsCount()>1;if(x>1)v=r,o.centroidXY=b.centroidXY=new e.P(0,0);else if(l&&l.dem&&!w){const t=f[y](o,b),r=y%2?e.Y-1:0,n=m(t[0],Math.min(e.Y-1,t[1]),r,l,i,y<2,t[2]);o.centroidXY=b.centroidXY=c(n)}else w?o.centroidXY=b.centroidXY=new e.P(0,0):(o.centroidXY=n.encodeBorderCentroid(t),b.centroidXY=a.encodeBorderCentroid(d));n.writeCentroidToBuffer(o),a.writeCentroidToBuffer(b)}else n.showCentroid(t)}n.borderDoneWithNeighborZ[y]=a.canonical.z,a.borderDoneWithNeighborZ[u]=n.canonical.z}var g,_;(n.needsCentroidUpdate||!n.centroidVertexBuffer&&0!==n.centroidVertexArray.length)&&n.uploadCentroid(t)}const sa=[1,0,0],la=[0,1,0],ca=[0,0,1];function ha(t,i,r){const n=r.transform,a=r.shadowRenderer;if(!a)return!0;const o=t.toUnwrapped(),s=n.tileSize*a._cascades[r.currentShadowCascade].scale;let l=i.maxHeight;if(n.elevation){const e=n.elevation.getMinMaxForTile(t);e&&(l+=e.max)}const c=[...a.shadowDirection];c[2]=-c[2];const h=a.computeSimplifiedTileShadowVolume(o,l,s,c);if(!h)return!1;const u=[sa,la,ca,c,[c[0],0,c[2]],[0,c[1],c[2]]],d="globe"===n.projection.name,p=n.scaleZoom(s),f=e.bt.fromInvProjectionMatrix(n.invProjMatrix,n.worldSize,p,!d),m=a.getCurrentCascadeFrustum();return 0===f.intersectsPrecise(h.vertices,h.planes,u)||0===m.intersectsPrecise(h.vertices,h.planes,u)}function ua(t){return[t[0]*e.cS,t[1]*e.cS,t[2]*e.cS,0]}function da(t,i,r,n,a,o,s,l,c){const h=n.getSource(),u=r.globeSharedBuffers;if(!u)return;let d,p,f;if(i&&(d=n.getTile(i)),h instanceof e.as?(p=h.texture,f=e.co(0,0,r.transform)):d&&i&&(p=d.texture,f=e.co(i.canonical.z,i.canonical.x,r.transform)),!p||!f)return;t||(f=e.a9.scale(e.a9.create(),f,[1,-1,1]));const m=r.context,g=m.gl,_="nearest"===a.paint.get("raster-resampling")?g.NEAREST:g.LINEAR,y=r.colorModeForDrapableLayerRenderPass(o),v=s.defines;v.push("GLOBE_POLES");const x=new Mt(g.LEQUAL,Mt.ReadWrite,r.depthRangeFor3D),b=Float32Array.from(r.transform.expandedFarZProjMatrix),w=Float32Array.from(e.aW(e.cn(new e.bv(0,0,0))));r.terrain&&r.terrain.prepareDrawTile(),m.activeTexture.set(g.TEXTURE0),p.bind(_,g.CLAMP_TO_EDGE),m.activeTexture.set(g.TEXTURE1),p.bind(_,g.CLAMP_TO_EDGE),p.useMipmap&&m.extTextureFilterAnisotropic&&r.transform.pitch>20&&g.texParameterf(g.TEXTURE_2D,m.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,m.extTextureFilterAnisotropicMax);const[S,T,E,M]=i?u.getPoleBuffers(i.canonical.z,!1):u.getPoleBuffers(0,!0),A=a.paint.get("raster-elevation");let P;t?(P=S,r.renderDefaultNorthPole=0!==A):(P=T,r.renderDefaultSouthPole=0!==A);const C=ua(s.mix),I=((e,t,i,r,n,a,o,s,l,c,h,u,d)=>Ln(e,t,i,new Float32Array(16),new Float32Array(9),[0,0],r,[0,0],[0,0,0,0],1,{opacity:1,mix:0},a,[0,0]||0,s,2,c,h,u,1,0,d))(b,w,f,e.W(r.transform.zoom),0,a,0,A,0,C,s.offset,s.range,o),k=r.getOrCreateProgram("raster",{defines:v});r.uploadCommonUniforms(m,k,null),k.draw(r,g.TRIANGLES,x,c,y,l,I,a.id,P,E,M)}function pa(e){const t=e._nearZ,i=e.projection.farthestPixelDistance(e),r=i-t,n=.2*e.height,a=t+n;return[t,i,(a-n-t)/r,(a-t)/r]}function fa(e,t,i,r){if(e)return t instanceof ke&&e instanceof Wt?t.getTextureDescriptor(e,i,!0):{texture:e.texture,mix:ua(r.mix),offset:r.offset,buffer:0,tileSize:1}}function ma(t,i,r){if(!t)return null;const n=i.getTextureDescriptor(t,r,!0);if(!n)return null;let{texture:a,mix:o,offset:s,tileSize:l,buffer:c,format:h}=n;if(!a||!h)return null;let u=!1;return"uint32"===h&&(u=!0,o[3]=0,o=Dn(e.cT,o,[0,r.paint.get("raster-particle-max-speed")]),s=Rn(e.cT,s,[0,r.paint.get("raster-particle-max-speed")])),{texture:a,textureOffset:[c/(l+2*c),l/(l+2*c)],tileSize:l,scalarData:u,scale:o,offset:s,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[h]]}}function ga(e){const t=e._nearZ,i=e.projection.farthestPixelDistance(e),r=i-t,n=.2*e.height,a=t+n;return[t,i,(a-n-t)/r,(a-t)/r]}const _a=new e.aA(1,0,0,1),ya=new e.aA(0,1,0,1),va=new e.aA(0,0,1,1),xa=new e.aA(1,0,1,1),ba=new e.aA(0,1,1,1);function wa(t,i,r,n,a,o,s){const l=t.context,c=t.transform,h=l.gl,u="globe"===c.projection.name,d=u?["PROJECTION_GLOBE_VIEW"]:[];let p=e.a9.clone(r.projMatrix);if(u&&e.W(c.zoom)>0){const t=e.aV(r.canonical,c),i=e.cU(t);p=e.a9.multiply(new Float32Array(16),c.globeMatrix,i),e.a9.multiply(p,c.projMatrix,p)}const f=e.a9.create();f[12]+=2*a/(e.f.devicePixelRatio*c.width),f[13]+=2*o/(e.f.devicePixelRatio*c.height),e.a9.multiply(p,f,p);const m=t.getOrCreateProgram("debug",{defines:d}),g=i.getTileByID(r.key);t.terrain&&t.terrain.setupElevationDraw(g,m);const _=Mt.disabled,y=Pt.disabled,v=t.colorModeForRenderPass(),x="$debug";l.activeTexture.set(h.TEXTURE0),t.emptyTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE),u?g._makeGlobeTileDebugBuffers(t.context,c):g._makeDebugTileBoundsBuffers(t.context,c.projection);const b=g._tileDebugBuffer||t.debugBuffer,w=g._tileDebugIndexBuffer||t.debugIndexBuffer,S=g._tileDebugSegments||t.debugSegments;if(m.draw(t,h.LINE_STRIP,_,y,v,Rt.disabled,Cn(p,n),x,b,w,S,null,null,null,[g._globeTileDebugBorderBuffer]),s){const e=g.latestRawTileData,i=Math.floor((e&&e.byteLength||0)/1024);let n=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(n+=" => ".concat(r.overscaledZ)),n+=" ".concat(g.state),n+=" ".concat(i,"kb"),function(e,t){e.initDebugOverlayCanvas();const i=e.debugOverlayCanvas,r=e.context.gl,n=e.debugOverlayCanvas.getContext("2d");n.clearRect(0,0,i.width,i.height),n.shadowColor="white",n.shadowBlur=2,n.lineWidth=1.5,n.strokeStyle="white",n.textBaseline="top",n.font="bold 36px Open Sans, sans-serif",n.fillText(t,5,5),n.strokeText(t,5,5),e.debugOverlayTexture.update(i),e.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(t,n)}const T=i.getTile(r).tileSize,E=512/Math.min(T,512)*(r.overscaledZ/c.zoom)*.5,M=g._tileDebugTextBuffer||t.debugBuffer,A=g._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,P=g._tileDebugTextSegments||t.debugSegments;m.draw(t,h.TRIANGLES,_,y,It.alphaBlended,Rt.disabled,Cn(p,e.aA.transparent,E),x,M,A,P,null,null,null,[g._globeTileDebugTextBuffer])}function Sa(e,t,i,r){Ea(e,0,t+i/2,e.transform.width,i,r)}function Ta(e,t,i,r){Ea(e,t-i/2,0,i,e.transform.height,r)}function Ea(t,i,r,n,a,o){const s=t.context,l=s.gl;l.enable(l.SCISSOR_TEST),l.scissor(i*e.f.devicePixelRatio,r*e.f.devicePixelRatio,n*e.f.devicePixelRatio,a*e.f.devicePixelRatio),s.clear({color:o}),l.disable(l.SCISSOR_TEST)}const Ma=e.aB([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Aa}=Ma;function Pa(e,t,i,r){e.emplaceBack(t,i,r)}class Ca{constructor(t){this.vertexArray=new e.cV,this.indices=new e.az,Pa(this.vertexArray,-1,-1,1),Pa(this.vertexArray,1,-1,1),Pa(this.vertexArray,-1,1,1),Pa(this.vertexArray,1,1,1),Pa(this.vertexArray,-1,-1,-1),Pa(this.vertexArray,1,-1,-1),Pa(this.vertexArray,-1,1,-1),Pa(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Aa),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=e.aE.simpleSegment(0,0,36,12)}}function Ia(t,i,r,n,a,o){const s=t.context.gl,l=i.paint.get("sky-atmosphere-color"),c=i.paint.get("sky-atmosphere-halo-color"),h=i.paint.get("sky-atmosphere-sun-intensity"),u=((e,t,i,r,n)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:i,u_color_tint_r:[r.r,r.g,r.b,r.a],u_color_tint_m:[n.r,n.g,n.b,n.a],u_luminance:5e-5}))(e.ct.fromMat4(e.ct.create(),n),a,h,l,c);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+o,i.skyboxTexture,0),r.draw(t,s.TRIANGLES,Mt.disabled,Pt.disabled,It.unblended,Rt.frontCW,u,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const ka=e.aB([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Da{constructor(t){const i=new e.cW;i.emplaceBack(-1,1,1,0,0),i.emplaceBack(1,1,1,1,0),i.emplaceBack(1,-1,1,1,1),i.emplaceBack(-1,-1,1,0,1);const r=new e.az;r.emplaceBack(0,1,2),r.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(i,ka.members),this.indexBuffer=t.createIndexBuffer(r),this.segments=e.aE.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ra=e.aB([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class La{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class za{constructor(t){this.colorModeAlphaBlendedWriteRGB=new It([1,Ct,1,Ct],e.aA.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new It([1,0,1,0],e.aA.transparent,[!1,!1,!1,!0]),this.params=new La,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(t){const i=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Da(i);const t=this.params.sizeRange,r=this.params.intensityRange,n=function(t){const i=e.aC(30),r=[];for(let n=0;n<t;++n){const t=2*Math.PI*i(),n=Math.acos(1-2*i())-.5*Math.PI;r.push(e.Q.fromValues(Math.cos(n)*Math.cos(t),Math.cos(n)*Math.sin(t),Math.sin(n)))}return r}(this.params.starsCount),a=e.aC(300),o=new e.cX,s=new e.az;let l=0;for(let i=0;i<n.length;++i){const c=e.Q.scale([],n[i],200),h=Math.max(0,1+.01*t*(1*a()-.5)),u=Math.max(0,1+.01*r*(1*a()-.5));o.emplaceBack(c[0],c[1],c[2],-1,-1,h,u),o.emplaceBack(c[0],c[1],c[2],1,-1,h,u),o.emplaceBack(c[0],c[1],c[2],1,1,h,u),o.emplaceBack(c[0],c[1],c[2],-1,1,h,u),s.emplaceBack(l+0,l+1,l+2),s.emplaceBack(l+0,l+2,l+3),l+=4}this.starsVx=i.createVertexBuffer(o,Ra.members),this.starsIdx=i.createIndexBuffer(s),this.starsSegments=e.aE.simpleSegment(0,0,o.length,s.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,i){const r=t.context,n=r.gl,a=t.transform,o=new Mt(n.LEQUAL,Mt.ReadOnly,[0,1]),s=e.W(a.zoom),l=i.properties.get("color").toArray01(),c=i.properties.get("high-color").toArray01(),h=i.properties.get("space-color").toArray01PremultipliedAlpha(),u=5e-4,d=e.cY(i.properties.get("horizon-blend"),0,1,u,.25),p=e.ci(t,r,a)&&d===u?a.worldSize/(2*Math.PI*1.025)-1:a.globeRadius,f=t.frameCounter/1e3%1,m=e.Q.length(a.globeCenterInViewSpace),g=Math.sqrt(Math.pow(m,2)-Math.pow(p,2)),_=Math.acos(g/m),y=e=>{const i="globe"===a.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];e&&i.push("ALPHA_PASS");const u=t.getOrCreateProgram("globeAtmosphere",{defines:i}),p=((e,t,i,r,n,a,o,s,l,c,h,u)=>({u_frustum_tl:e,u_frustum_tr:t,u_frustum_br:i,u_frustum_bl:r,u_horizon:n,u_transition:a,u_fadeout_range:o,u_color:s,u_high_color:l,u_space_color:c,u_temporal_offset:h,u_horizon_angle:u}))(a.frustumCorners.TL,a.frustumCorners.TR,a.frustumCorners.BR,a.frustumCorners.BL,a.frustumCorners.horizon,s,d,l,c,h,f,_);t.uploadCommonUniforms(r,u);const m=this.atmosphereBuffer;m&&u.draw(t,n.TRIANGLES,o,Pt.disabled,e?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Rt.backCW,p,e?"atmosphere_glow_alpha":"atmosphere_glow",m.vertexBuffer,m.indexBuffer,m.segments)};y(!1),y(!0)}drawStars(t,i){const r=e.ad(i.properties.get("star-intensity"),0,1);if(0===r)return;const n=t.context,a=n.gl,o=t.transform,s=t.getOrCreateProgram("stars"),l=e.bl.identity([]);e.bl.rotateX(l,l,-o._pitch),e.bl.rotateZ(l,l,-o.angle),e.bl.rotateX(l,l,e.bm(o._center.lat)),e.bl.rotateY(l,l,-e.bm(o._center.lng));const c=e.a9.fromQuat(new Float32Array(16),l),h=e.a9.multiply([],o.starsProjMatrix,c),u=e.ct.fromMat4([],c),d=e.ct.invert([],u),p=[0,1,0];e.Q.transformMat3(p,p,d),e.Q.scale(p,p,this.params.sizeMultiplier);const f=[1,0,0];e.Q.transformMat3(f,f,d),e.Q.scale(f,f,this.params.sizeMultiplier);const m=(g=p,_=f,y=r,{u_matrix:Float32Array.from(h),u_up:g,u_right:_,u_intensity_multiplier:y});var g,_,y;t.uploadCommonUniforms(n,s),this.starsVx&&this.starsIdx&&s.draw(t,a.TRIANGLES,Mt.disabled,Pt.disabled,this.colorModeAlphaBlendedWriteRGB,Rt.disabled,m,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Fa(t,i){const r=[...t],n=i.cameraWorldSizeForFog/i.worldSize,a=e.a9.identity([]);return e.a9.scale(a,a,[n,n,1]),e.a9.multiply(r,a,r),e.a9.multiply(r,i.worldToFogMatrix,r),r}function Oa(e,t,i,r){const n=i.material,a=r.context,{baseColorTexture:o,metallicRoughnessTexture:s}=n.pbrMetallicRoughness,{normalTexture:l,occlusionTexture:c,emissionTexture:h}=n;function u(t,i,r){if(t&&(e.push(i),a.activeTexture.set(a.gl.TEXTURE0+r),t.gfxTexture)){const{minFilter:e,magFilter:i,wrapS:r,wrapT:n}=t.sampler;t.gfxTexture.bindExtraParam(e,i,r,n)}}u(o,"HAS_TEXTURE_u_baseColorTexture",fr.BaseColor),u(s,"HAS_TEXTURE_u_metallicRoughnessTexture",fr.MetallicRoughness),u(l,"HAS_TEXTURE_u_normalTexture",fr.Normal),u(c,"HAS_TEXTURE_u_occlusionTexture",fr.Occlusion),u(h,"HAS_TEXTURE_u_emissionTexture",fr.Emission),i.texcoordBuffer&&(e.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(i.texcoordBuffer)),i.colorBuffer&&(e.push(12===i.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(i.colorBuffer)),i.normalBuffer&&(e.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(i.normalBuffer)),i.pbrBuffer&&(e.push("HAS_ATTRIBUTE_a_pbr"),e.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(i.pbrBuffer)),"OPAQUE"!==n.alphaMode&&"MASK"!==n.alphaMode||e.push("UNPREMULT_TEXTURE_IN_SHADER"),n.defined||e.push("DIFFUSE_SHADED"),e.push("USE_STANDARD_DERIVATIVES")}function Ba(t,i,r,n,a,o){const s=r.paint.get("model-opacity"),l=i.context,c=new Mt(i.context.gl.LEQUAL,Mt.ReadWrite,i.depthRangeFor3D),h=i.transform,u=t.mesh,d=u.material,p=d.pbrMetallicRoughness,f=i.style.fog;let m;m="pixels"===i.transform.projection.zAxisUnit?[...t.nodeModelMatrix]:e.a9.multiply([],n.zScaleMatrix,t.nodeModelMatrix),e.a9.multiply(m,n.negCameraPosMatrix,m);const g=e.a9.invert([],m);e.a9.transpose(g,g);const _=r.paint.get("model-emissive-strength").constantOr(0),y=Wn(new Float32Array(t.worldViewProjection),new Float32Array(m),new Float32Array(g),null,i,s,p.baseColorFactor,d.emissiveFactor,p.metallicFactor,p.roughnessFactor,d,_,r),v={defines:[]},x=[];Oa(v.defines,x,u,i);const b=i.shadowRenderer;b&&(b.useNormalOffset=!1);let w=null;if(f){const e=Fa(t.nodeModelMatrix,i.transform);if(w=new Float32Array(e),"globe"!==h.projection.name){const t=u.aabb.min,i=u.aabb.max,[r,n]=f.getOpacityForBounds(e,t[0],t[1],i[0],i[1]);v.overrideFog=r>=pe||n>=pe}}const S=mr(i,r.paint.get("model-cutoff-fade-range"));S.shouldRenderCutoff&&v.defines.push("RENDER_CUTOFF");const T=i.getOrCreateProgram("model",v);i.uploadCommonUniforms(l,T,null,w,S),"shadow"!==i.renderPass&&b&&b.setupShadowsFromMatrix(t.nodeModelMatrix,T),T.draw(i,l.gl.TRIANGLES,c,a,o,u.material.doubleSided?Rt.disabled:Rt.backCCW,y,r.id,u.vertexBuffer,u.indexBuffer,u.segments,r.paint,i.transform.zoom,void 0,x)}function Na(t,i,r,n,a,o,s){let l;l="globe"===t.projection.name?e.c_(r,t):[...r],e.a9.multiply(l,l,i.matrix);const c=e.a9.multiply([],n,l);if(i.meshes)for(const h of i.meshes){if("BLEND"!==h.material.alphaMode){s.push({mesh:h,depth:0,modelIndex:a,worldViewProjection:c,nodeModelMatrix:l});continue}const t=e.Q.transformMat4([],h.centroid,c);t[2]>0&&o.push({mesh:h,depth:t[2],modelIndex:a,worldViewProjection:c,nodeModelMatrix:l})}if(i.children)for(const e of i.children)Na(t,e,r,n,a,o,s)}function Va(e,t,i,r){const n=i.shadowRenderer;if(!n)return;const a=n.getShadowPassDepthMode(),o=n.getShadowPassColorMode(),s=n.calculateShadowPassMatrixFromMatrix(t),l=Zn(s);i.getOrCreateProgram("modelDepth",{defines:i._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(i,i.context.gl.TRIANGLES,a,Pt.disabled,o,Rt.backCCW,l,r.id,e.vertexBuffer,e.indexBuffer,e.segments,r.paint,i.transform.zoom,void 0,void 0)}function ja(t,i,r){const n=i.updateZoomBasedPaintProperties(),a=function(t,i,r){let n,a,o,s=t.terrain?t.terrain.exaggeration():0;if(t.terrain&&s>0){const i=t.terrain,a=i.findDEMTileFor(r);a&&a.dem?n=e.d0.create(i,r,a):s=0}if(0===s&&(i.terrainElevationMin=0,i.terrainElevationMax=0),s===i.validForExaggeration&&(0===s||n&&n._demTile&&n._demTile.tileID===i.validForDEMTile.id&&n._dem._timestamp===i.validForDEMTile.timestamp))return!1;for(const e in i.instancesPerModel){const t=i.instancesPerModel[e];for(let e=0;e<t.instancedDataArray.length;++e){const r=(n?s*n.getElevationAt(0|t.instancedDataArray.float32[16*e],0|t.instancedDataArray.float32[16*e+1],!0,!0):0)+t.instancesEvaluatedElevation[e];t.instancedDataArray.float32[16*e+6]=r,a=a?Math.min(i.terrainElevationMin,r):r,o=o?Math.max(i.terrainElevationMax,r):r}}return i.terrainElevationMin=a||0,i.terrainElevationMax=o||0,i.validForExaggeration=s,i.validForDEMTile=n&&n._demTile?{id:n._demTile.tileID,timestamp:n._dem._timestamp}:{id:void 0,timestamp:0},!0}(t,i,r);(n||a)&&(i.uploaded=!1,i.upload(t.context))}const Ua={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new e.bV([0,0,0],[e.Y,e.Y,0])};function Ga(t,i){const r=1<<t.canonical.z,n=i.getFreeCameraOptions().position,a=i.elevation,o=t.canonical.x/r,s=(t.canonical.x+1)/r,l=t.canonical.y/r,c=(t.canonical.y+1)/r;let h=i._centerAltitude;if(a){const e=a.getMinMaxForTile(t);e&&e.max>h&&(h=e.max)}const u=e.ad(n.x,o,s)-n.x,d=e.ad(n.y,l,c)-n.y,p=e.bo(h,i.center.lat)-n.z;return i._zoomFromMercatorZ(Math.sqrt(u*u+d*d+p*p))}function qa(e,t,i,r,n,a,o){const s=e.context,l="shadow"===e.renderPass,c=e.shadowRenderer,h=l&&c?c.getShadowPassDepthMode():new Mt(s.gl.LEQUAL,Mt.ReadWrite,e.depthRangeFor3D),u=e.isTileAffectedByFog(a);if(i.meshes)for(const d of i.meshes){const p=["MODEL_POSITION_ON_GPU"],f=[];let m,g,_;r.instancedDataArray.length>20&&p.push("INSTANCED_ARRAYS");const y=mr(e,t.paint.get("model-cutoff-fade-range"));if(y.shouldRenderCutoff&&p.push("RENDER_CUTOFF"),l&&c)m=e.getOrCreateProgram("modelDepth",{defines:p}),g=Zn(o.shadowTileMatrix,o.shadowTileMatrix,Float32Array.from(i.matrix)),_=c.getShadowPassColorMode();else{Oa(p,f,d,e),m=e.getOrCreateProgram("model",{defines:p,overrideFog:u});const r=d.material,l=r.pbrMetallicRoughness,h=t.paint.get("model-opacity"),v=t.paint.get("model-emissive-strength").constantOr(0);g=Wn(a.expandedProjMatrix,Float32Array.from(i.matrix),new Float32Array(16),null,e,h,l.baseColorFactor,r.emissiveFactor,l.metallicFactor,l.roughnessFactor,r,v,t,n),c&&(o.shadowUniformsInitialized?m.setShadowUniformValues(s,c.getShadowUniformValues()):(c.setupShadows(a.toUnwrapped(),m,"model-tile",a.overscaledZ),o.shadowUniformsInitialized=!0)),_=y.shouldRenderCutoff||h<1||"OPAQUE"!==r.alphaMode?It.alphaBlended:It.unblended}e.uploadCommonUniforms(s,m,a.toUnwrapped(),null,y);const v=d.material.doubleSided?Rt.disabled:Rt.backCCW;if(r.instancedDataArray.length>20)f.push(r.instancedDataBuffer),m.draw(e,s.gl.TRIANGLES,h,Pt.disabled,_,v,g,t.id,d.vertexBuffer,d.indexBuffer,d.segments,t.paint,e.transform.zoom,void 0,f,r.instancedDataArray.length);else{const i=l?"u_instance":"u_normal_matrix";for(let n=0;n<r.instancedDataArray.length;++n)g[i]=new Float32Array(r.instancedDataArray.arrayBuffer,64*n,16),m.draw(e,s.gl.TRIANGLES,h,Pt.disabled,_,v,g,t.id,d.vertexBuffer,d.indexBuffer,d.segments,t.paint,e.transform.zoom,void 0,f)}}if(i.children)for(const d of i.children)qa(e,t,d,r,n,a,o)}const Ha=[1,-1,1];function Wa(t,i,r,n){if(!r.modelManager)return!0;const a=r.modelManager;if(!r.shadowRenderer)return!0;const o=r.shadowRenderer,s=i.aabb;let l=!0,c=t.maxHeight;if(0===c){let e=0;for(const i in t.instancesPerModel){const t=a.getModel(i,n);t?e=Math.max(e,Math.max(Math.max(t.aabb.max[0],t.aabb.max[1]),t.aabb.max[2])):l=!1}c=t.maxScale*e*1.41+t.maxVerticalOffset,l&&(t.maxHeight=c)}s.max[2]=c,s.min[2]+=t.terrainElevationMin,s.max[2]+=t.terrainElevationMax,e.Q.transformMat4(s.min,s.min,i.tileMatrix),e.Q.transformMat4(s.max,s.max,i.tileMatrix);const h=s.intersects(o.getCurrentCascadeFrustum());return 0===r.currentShadowCascade&&(t.isInsideFirstShadowMapFrustum=2===h),0===h}class Za{}class Qa{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,i,r){{const e=this._storage.get(i.id);if(e)return e.lastUsedFrameIdx=t,e.buf}const n=r.gl,a=n.getBufferParameter(n.ELEMENT_ARRAY_BUFFER,n.BUFFER_SIZE),o=new ArrayBuffer(a),s=new Int16Array(o);n.getBufferSubData(n.ELEMENT_ARRAY_BUFFER,0,new Int16Array(o));const l=new e.d2;for(let e=0;e<a/2;e+=3){const t=s[e],i=s[e+1],r=s[e+2];l.emplaceBack(t,i),l.emplaceBack(i,r),l.emplaceBack(r,t)}const c=r.bindVertexArrayOES.current,h=new Za;return h.buf=new Ne(r,l),h.lastUsedFrameIdx=t,this._storage.set(i.id,h),r.bindVertexArrayOES.set(c),h.buf}update(e){for(const[t,i]of this._storage)e-i.lastUsedFrameIdx>30&&(i.buf.destroy(),this._storage.delete(t))}destroy(){for(const[e,t]of this._storage)t.buf.destroy(),this._storage.delete(e)}}const Xa={symbol:function(t,i,r,n,a){if("translucent"!==t.renderPass)return;const o=Pt.disabled,s=t.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(t,i,r,n,a,o,s){const l=i.transform,c="map"===a,h="map"===o;for(const u of t){const t=n.getTile(u),i=t.getBucket(r);if(!i||!i.text||!i.text.segments.get().length)continue;const a=e.b8(i.textSizeData,l.zoom),o=Di(u,i.getProjection(),l),d=l.calculatePixelsToTileUnitsMatrix(t),p=pi(o,t.tileID.canonical,h,c,l,i.getProjection(),d),f=i.hasIconTextFit()&&i.hasIconData();if(a){const r=Math.pow(2,l.zoom-t.tileID.overscaledZ);ea(i,c,h,s,e.cE,l,p,u,r,a,f)}}}(n,t,r,i,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),a);const l=0!==r.paint.get("icon-opacity").constantOr(1),c=0!==r.paint.get("text-opacity").constantOr(1);void 0!==r.layout.get("symbol-sort-key").constantOr(1)&&(l||c)?ta(t,i,r,n,o,s):(l&&ta(t,i,r,n,o,s,{onlyIcons:!0}),c&&ta(t,i,r,n,o,s,{onlyText:!0})),i.map.showCollisionBoxes&&(Yn(t,i,r,n,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),Yn(t,i,r,n,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(t,i,r,n){if("translucent"!==t.renderPass)return;const a=r.paint.get("circle-opacity"),o=r.paint.get("circle-stroke-width"),s=r.paint.get("circle-stroke-opacity"),l=void 0!==r.layout.get("circle-sort-key").constantOr(1),c=r.paint.get("circle-emissive-strength");if(0===a.constantOr(1)&&(0===o.constantOr(1)||0===s.constantOr(1)))return;const h=t.context,u=h.gl,d=t.transform,p=t.depthModeForSublayer(0,Mt.ReadOnly),f=Pt.disabled,m=t.colorModeForDrapableLayerRenderPass(c),g="globe"===d.projection.name,_=[e.a8(d.center.lng),e.ah(d.center.lat)],y=[];for(let x=0;x<n.length;x++){const a=n[x],o=i.getTile(a),s=o.getBucket(r);if(!s||s.projection.name!==d.projection.name)continue;const c=s.programConfigurations.get(r.id),h=e.cF(r),u=t.isTileAffectedByFog(a);g&&h.push("PROJECTION_GLOBE_VIEW");const p=t.getOrCreateProgram("circle",{config:c,defines:h,overrideFog:u}),f=s.layoutVertexBuffer,m=s.globeExtVertexBuffer,v=s.indexBuffer,b=d.projection.createInversionMatrix(d,a.canonical),w={programConfiguration:c,program:p,layoutVertexBuffer:f,globeExtVertexBuffer:m,indexBuffer:v,uniformValues:e.cG(t,a,o,b,_,r),tile:o};if(l){const t=s.segments.get();for(const i of t)y.push({segments:new e.aE([i]),sortKey:i.sortKey,state:w})}else y.push({segments:s.segments,sortKey:0,state:w})}l&&y.sort(((e,t)=>e.sortKey-t.sortKey));const v={useDepthForOcclusion:d.depthOcclusionForSymbolsAndCircles};for(const e of y){const{programConfiguration:i,program:n,layoutVertexBuffer:a,globeExtVertexBuffer:o,indexBuffer:s,uniformValues:l,tile:c}=e.state,g=e.segments;t.terrain&&t.terrain.setupElevationDraw(c,n,v),t.uploadCommonUniforms(h,n,c.tileID.toUnwrapped()),n.draw(t,u.TRIANGLES,p,f,m,Rt.disabled,l,r.id,a,s,g,r.paint,d.zoom,i,[o])}},heatmap:function(t,i,r,n){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const a=t.context,o=a.gl,s=Pt.disabled,l=new It([o.ONE,o.ONE,o.ONE,o.ONE],e.aA.transparent,[!0,!0,!0,!0]);!function(e,t,i,r){const n=e.gl,a=t.width*r,o=t.height*r;e.activeTexture.set(n.TEXTURE1),e.viewport.set([0,0,a,o]);let s=i.heatmapFbo;if(!s||s&&(s.width!==a||s.height!==o)){s&&s.destroy();const t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),s=i.heatmapFbo=e.createFramebuffer(a,o,!0,null),function(e,t,i,r,n,a){const o=e.gl;o.texImage2D(o.TEXTURE_2D,0,e.extRenderToTextureHalfFloat?o.RGBA16F:o.RGBA,n,a,0,o.RGBA,e.extRenderToTextureHalfFloat?o.HALF_FLOAT:o.UNSIGNED_BYTE,null),r.colorAttachment.set(i)}(e,0,t,s,a,o)}else n.bindTexture(n.TEXTURE_2D,s.colorAttachment.get()),e.bindFramebuffer.set(s.framebuffer)}(a,t,r,"globe"===t.transform.projection.name?.5:.25),a.clear({color:e.aA.transparent});const c=t.transform,h="globe"===c.projection.name,u=h?["PROJECTION_GLOBE_VIEW"]:[],d=h?Rt.frontCCW:Rt.disabled,p=[e.a8(c.center.lng),e.ah(c.center.lat)];for(let e=0;e<n.length;e++){const f=n[e];if(i.hasRenderableParent(f))continue;const m=i.getTile(f),g=m.getBucket(r);if(!g||g.projection.name!==c.projection.name)continue;const _=t.isTileAffectedByFog(f),y=g.programConfigurations.get(r.id),v=t.getOrCreateProgram("heatmap",{config:y,defines:u,overrideFog:_}),{zoom:x}=t.transform;t.terrain&&t.terrain.setupElevationDraw(m,v),t.uploadCommonUniforms(a,v,f.toUnwrapped());const b=c.projection.createInversionMatrix(c,f.canonical);v.draw(t,o.TRIANGLES,Mt.disabled,s,l,d,kn(t,f,m,b,p,x,r.paint.get("heatmap-intensity")),r.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,r.paint,t.transform.zoom,y,h?[g.globeExtVertexBuffer]:null)}a.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,i){const r=t.context,n=r.gl,a=i.heatmapFbo;if(!a)return;r.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,a.colorAttachment.get()),r.activeTexture.set(n.TEXTURE1);let o=i.colorRampTexture;o||(o=i.colorRampTexture=new e.T(r,i.colorRamp,n.RGBA)),o.bind(n.LINEAR,n.CLAMP_TO_EDGE),t.getOrCreateProgram("heatmapTexture").draw(t,n.TRIANGLES,Mt.disabled,Pt.disabled,t.colorModeForRenderPass(),Rt.disabled,((e,t,i,r)=>({u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}))(0,i),i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,i.paint,t.transform.zoom)}(t,r))},line:function(t,i,r,n){if("translucent"!==t.renderPass)return;const a=r.paint.get("line-opacity"),o=r.paint.get("line-width");if(0===a.constantOr(1)||0===o.constantOr(1))return;const s=r.paint.get("line-emissive-strength"),l=t.depthModeForSublayer(0,Mt.ReadOnly),c=t.colorModeForDrapableLayerRenderPass(s),h=t.terrain&&t.terrain.renderingToTexture?1:e.f.devicePixelRatio,u=r.paint.get("line-dasharray"),d=u.constantOr(1),p=r.layout.get("line-cap"),f=r.paint.get("line-pattern"),m=f.constantOr(1),g=1!==r.paint.get("line-opacity").constantOr(1);let _=!m&&g;const y=r.paint.get("line-gradient"),v=m?"linePattern":"line",x=t.context,b=x.gl,w=e.cH(r);t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(_=!1);for(const S of n){const n=i.getTile(S);if(m&&!n.patternsLoaded())continue;const a=n.getBucket(r);if(!a)continue;t.prepareDrawTile();const o=a.programConfigurations.get(r.id),s=t.isTileAffectedByFog(S),g=t.getOrCreateProgram(v,{config:o,defines:w,overrideFog:s}),T=f.constantOr(null);if(T&&n.imageAtlas){const e=n.imageAtlas.patternPositions[T.toString()];e&&o.setConstantPatternPositions(e)}const E=u.constantOr(null),M=p.constantOr(null);if(!m&&E&&M&&n.lineAtlas){const e=n.lineAtlas.getDash(E,M);e&&o.setConstantPatternPositions(e)}let[A,P]=r.paint.get("line-trim-offset");if("round"===M||"square"===M){const e=1;A!==P&&(0===A&&(A-=e),1===P&&(P+=e))}const C=t.terrain?S.projMatrix:null,I=m?e.cI(t,n,r,C,h,[A,P]):e.cJ(t,n,r,C,a.lineClipsArray.length,h,[A,P]);if(y){const n=a.gradients[r.id];let o=n.texture;if(r.gradientVersion!==n.version){let s=256;if(r.stepInterpolant){const r=i.getSource().maxzoom,n=S.canonical.z===r?Math.ceil(1<<t.transform.maxZoom-S.canonical.z):1;s=e.ad(e.cK(a.maxLineLength/e.Y*1024*n),256,x.maxTextureSize)}n.gradient=e.cL({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:s,image:n.gradient||void 0,clips:a.lineClipsArray}),n.texture?n.texture.update(n.gradient):n.texture=new e.T(x,n.gradient,b.RGBA),n.version=r.gradientVersion,o=n.texture}x.activeTexture.set(b.TEXTURE1),o.bind(r.stepInterpolant?b.NEAREST:b.LINEAR,b.CLAMP_TO_EDGE)}d&&(x.activeTexture.set(b.TEXTURE0),n.lineAtlasTexture&&n.lineAtlasTexture.bind(b.LINEAR,b.REPEAT),o.updatePaintBuffers()),m&&(x.activeTexture.set(b.TEXTURE0),n.imageAtlasTexture&&n.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),o.updatePaintBuffers()),t.uploadCommonUniforms(x,g,S.toUnwrapped());const k=e=>{g.draw(t,b.TRIANGLES,l,e,c,Rt.disabled,I,r.id,a.layoutVertexBuffer,a.indexBuffer,a.segments,r.paint,t.transform.zoom,o,[a.layoutVertexBuffer2,a.patternVertexBuffer])};if(_){const e=t.stencilModeForClipping(S).ref;0===e&&t.terrain&&x.clear({stencil:0});const i={func:b.EQUAL,mask:255};I.u_alpha_discard_threshold=.8,k(new Pt(i,e,255,b.KEEP,b.KEEP,b.INVERT)),I.u_alpha_discard_threshold=0,k(new Pt(i,e,255,b.KEEP,b.KEEP,b.KEEP))}else k(t.stencilModeForClipping(S))}_&&(t.resetStencilClippingMasks(),t.terrain&&x.clear({stencil:0}))},fill:function(t,i,r,n){const a=r.paint.get("fill-color"),o=r.paint.get("fill-opacity");if(0===o.constantOr(1))return;const s=r.paint.get("fill-emissive-strength"),l=t.colorModeForDrapableLayerRenderPass(s),c=r.paint.get("fill-pattern"),h=t.opaquePassEnabledForLayer()&&!c.constantOr(1)&&1===a.constantOr(e.aA.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(t.renderPass===h){const e=t.depthModeForSublayer(1,"opaque"===t.renderPass?Mt.ReadWrite:Mt.ReadOnly);ra(t,i,r,n,e,l,!1)}if("translucent"===t.renderPass&&r.paint.get("fill-antialias")){const e=t.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,Mt.ReadOnly);ra(t,i,r,n,e,l,!0)}},"fill-extrusion":function(t,i,r,n){const a=r.paint.get("fill-extrusion-opacity"),o=t.context,s=o.gl,l=t.terrain,c=l&&l.renderingToTexture;if(0===a)return;const h=t.conflationActive&&t.layerUsedInConflation(r,i.getSource());if(h&&function(e,t,i,r){for(const n of r){const r=t.getTile(n).getBucket(i);r&&(r.updateReplacement(n,e.replacementSource),r.uploadCentroid(e.context))}}(t,i,r,n),l||h)for(const e of n){const n=i.getTile(e).getBucket(r);n&&oa(t.context,i,e,n,r,l,h)}if("shadow"===t.renderPass&&t.shadowRenderer){const o=t.shadowRenderer;if(l&&a<.65&&r._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof e.Z)return;const s=o.getShadowPassDepthMode(),c=o.getShadowPassColorMode();na(t,i,r,n,s,Pt.disabled,c,h)}else if("translucent"===t.renderPass){const u=!r.paint.get("fill-extrusion-pattern").constantOr(1),d=r.paint.get("fill-extrusion-color").constantOr(e.aA.white);if(!c&&0!==d.a){const e=new Mt(t.context.gl.LEQUAL,Mt.ReadWrite,t.depthRangeFor3D);1===a&&u?na(t,i,r,n,e,Pt.disabled,It.unblended,h):(na(t,i,r,n,e,Pt.disabled,It.disabled,h),na(t,i,r,n,e,t.stencilModeFor3D(),t.colorModeForRenderPass(),h),t.resetStencilClippingMasks())}if(t.style.enable3dLights()&&u&&(!l&&"globe"!==t.transform.projection.name||c)){const a=r.paint.get("fill-extrusion-opacity"),u=r.paint.get("fill-extrusion-ambient-occlusion-intensity"),d=r.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),p=r.paint.get("fill-extrusion-flood-light-intensity"),f=r.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),m=u>0&&d>0,g=p>0,_=(e,t,i)=>(1-i)*e+i*t,y=o=>{const l=t.depthModeForSublayer(1,Mt.ReadOnly,s.LEQUAL,!0),c=r.paint.get(o?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),m=_(.1,3,c),g=t._showOverdrawInspector;if(!g){const c=new Pt({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),g=new It([s.ONE,s.ONE,s.ONE,s.ONE],e.aA.transparent,[!1,!1,!1,!0],s.MIN);aa(t,i,r,n,l,c,g,Rt.disabled,o,"sdf",a,u,d,p,f,m,h,!1)}{const c=g?Pt.disabled:new Pt({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),_=g?t.colorModeForRenderPass():new It([s.ONE_MINUS_DST_ALPHA,s.DST_ALPHA,s.ONE,s.ONE],e.aA.transparent,[!0,!0,!0,!0]);aa(t,i,r,n,l,c,_,Rt.disabled,o,"color",a,u,d,p,f,m,h,!1)}};if(c){const c=(o,l,c)=>{const m=t.depthModeForSublayer(1,Mt.ReadOnly,s.LEQUAL,!1),g=r.paint.get(o?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),y=_(.1,3,g);{const c=new It([s.ONE,s.ONE,s.ONE,s.ONE],e.aA.transparent,[!1,!1,!1,!0]);aa(t,i,r,n,m,Pt.disabled,c,Rt.disabled,o,"clear",a,u,d,p,f,y,h,l)}{const c=new Pt({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),g=new It([s.ONE,s.ONE,s.ONE,s.ONE],e.aA.transparent,[!1,!1,!1,!0],s.MIN);aa(t,i,r,n,m,c,g,Rt.disabled,o,"sdf",a,u,d,p,f,y,h,l)}{const c=o?s.ZERO:s.ONE_MINUS_DST_ALPHA,g=new Pt({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),_=new It([c,s.DST_ALPHA,s.ONE_MINUS_DST_ALPHA,s.ZERO],e.aA.transparent,[!0,!0,!0,!0]);aa(t,i,r,n,m,g,_,Rt.disabled,o,"color",a,u,d,p,f,y,h,l)}{const g=new It([s.ONE,s.ONE,s.ONE,o?s.ZERO:s.ONE],e.aA.transparent,[!1,!1,!1,!0],o?s.FUNC_ADD:s.MAX);aa(t,i,r,n,m,Pt.disabled,g,Rt.disabled,o,"clear",a,u,d,p,f,y,h,l,c)}};if(m||g){let i;if(t.prepareDrawTile(),l){const t=l.drapeBufferSize[0],r=l.drapeBufferSize[1];i=l.framebufferCopyTexture,i&&(!i||i.size[0]===t&&i.size[1]===r)||(i&&i.destroy(),i=l.framebufferCopyTexture=new e.T(o,new e.h({width:t,height:r}),s.RGBA)),i.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,t,r,0)}m&&c(!0,!1,i),g&&c(!1,!0,i)}}else m&&y(!0),g&&y(!1)}}},hillshade:function(e,t,i,r){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;if(e.style.disableElevatedTerrain)return;const n=e.context,a=e.terrain&&e.terrain.renderingToTexture,[o,s]="translucent"!==e.renderPass||a?[{},r]:e.stencilConfigForOverlap(r);for(const l of s){const r=t.getTile(l);if(r.needsHillshadePrepare&&"offscreen"===e.renderPass)$r(e,r,i);else if("translucent"===e.renderPass){const t=e.depthModeForSublayer(0,Mt.ReadOnly),n=i.paint.get("hillshade-emissive-strength"),s=e.colorModeForDrapableLayerRenderPass(n),c=a&&e.terrain?e.terrain.stencilModeForRTTOverlap(l):o[l.overscaledZ];Jr(e,l,r,i,t,c,s)}}n.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(t,i,r,n,a,o){if("translucent"!==t.renderPass)return;if(0===r.paint.get("raster-opacity"))return;const s="globe"===t.transform.projection.name,l=0!==r.paint.get("raster-elevation"),c=l&&s;if(t.renderElevatedRasterBackface&&!c)return;const h=t.context,u=h.gl,d=i.getSource(),p=function(t,i,r,n){const a=i.paint.get("raster-color"),o="raster-array"===t.type,s=[],l=i.paint.get("raster-resampling"),c=i.paint.get("raster-color-mix");let h=i.paint.get("raster-color-range");const u=[c[0],c[1],c[2],0],d=c[3];let p="nearest"===l?n.NEAREST:n.LINEAR;if(o&&(s.push("RASTER_ARRAY"),a||s.push("RASTER_COLOR"),"linear"===l&&s.push("RASTER_ARRAY_LINEAR"),p=n.NEAREST,!h&&t.rasterLayers)){const e=t.rasterLayers.find((e=>{let{id:t}=e;return t===i.sourceLayer}));e&&e.fields&&e.fields.range&&(h=e.fields.range)}if(h=h||[0,1],a){s.push("RASTER_COLOR"),r.activeTexture.set(n.TEXTURE2),i.updateColorRamp(h);let t=i.colorRampTexture;t||(t=i.colorRampTexture=new e.T(r,i.colorRamp,n.RGBA)),t.bind(n.LINEAR,n.CLAMP_TO_EDGE)}return{mix:u,range:h,offset:d,defines:s,resampling:p}}(d,r,h,u);if(d instanceof e.as&&!n.length&&!s)return;const f=r.paint.get("raster-emissive-strength"),m=t.colorModeForDrapableLayerRenderPass(f),g=t.terrain&&t.terrain.renderingToTexture,_=!t.options.moving,y="nearest"===r.paint.get("raster-resampling")?u.NEAREST:u.LINEAR;if(d instanceof e.as&&!n.length&&(d.onNorthPole||d.onSouthPole)){const e=l?t.stencilModeFor3D():Pt.disabled;return void da(!!d.onNorthPole,null,t,i,r,f,p,Rt.disabled,e)}if(!n.length)return;const[v,x]=d instanceof e.as||g?[{},n]:t.stencilConfigForOverlap(n),b=x[x.length-1].overscaledZ;c&&p.defines.push("PROJECTION_GLOBE_VIEW"),l&&p.defines.push("RENDER_CUTOFF");const w=(n,a,x)=>{for(const w of n){const n=w.toUnwrapped(),S=i.getTile(w);if(g&&(!S||!S.hasData()))continue;h.activeTexture.set(u.TEXTURE0);const T=fa(S,d,r,p);if(!T||!T.texture)continue;const{texture:E,mix:M,offset:A,tileSize:P,buffer:C}=T;let I,k;g?(I=Mt.disabled,k=w.projMatrix):l?(I=new Mt(u.LEQUAL,Mt.ReadWrite,t.depthRangeFor3D),k=s?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(n,_)):(I=t.depthModeForSublayer(w.overscaledZ-b,1===r.paint.get("raster-opacity")?Mt.ReadWrite:Mt.ReadOnly,u.LESS),k=t.transform.calculateProjMatrix(n,_));const D=t.terrain&&g?t.terrain.stencilModeForRTTOverlap(w):v[w.overscaledZ],R=o?0:r.paint.get("raster-fade-duration");S.registerFadeDuration(R);const L=i.findLoadedParent(w,0),z=hn(S,L,i,t.transform,R);let F,O;t.terrain&&t.terrain.prepareDrawTile(),h.activeTexture.set(u.TEXTURE0),E.bind(y,u.CLAMP_TO_EDGE),h.activeTexture.set(u.TEXTURE1),L?(L.texture&&L.texture.bind(y,u.CLAMP_TO_EDGE),F=Math.pow(2,L.tileID.overscaledZ-S.tileID.overscaledZ),O=[S.tileID.canonical.x*F%1,S.tileID.canonical.y*F%1]):E.bind(y,u.CLAMP_TO_EDGE),E.useMipmap&&h.extTextureFilterAnisotropic&&t.transform.pitch>20&&u.texParameterf(u.TEXTURE_2D,h.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h.extTextureFilterAnisotropicMax);const B=t.transform;let N;const V=l?pa(B):[0,0,0,0];let j,U,G,q,H,W=0;if(c&&d instanceof e.as&&d.coordinates.length>3)j=Float32Array.from(e.aW(e.cn(new e.bv(0,0,0)))),U=Float32Array.from(B.globeMatrix),G=Float32Array.from(e.cj(B)),q=[e.a8(B.center.lng),e.ah(B.center.lat)],N=d.elevatedGlobePerspectiveTransform,H=d.elevatedGlobeGridMatrix||new Float32Array(9);else if(c){const t=e.ck(w.canonical);W=e.cl(t.getCenter().lat),j=Float32Array.from(e.aW(e.cn(w.canonical))),U=Float32Array.from(B.globeMatrix),G=Float32Array.from(e.cj(B)),q=[e.a8(B.center.lng),e.ah(B.center.lat)],N=[0,0],H=Float32Array.from(e.cm(w.canonical,t,W,B.worldSize/B._pixelsPerMercatorPixel))}else N=d instanceof e.as?d.perspectiveTransform:[0,0],j=new Float32Array(16),U=new Float32Array(9),G=new Float32Array(16),q=[0,0],H=new Float32Array(9);const Z=Ln(k,j,U,G,H,O||[0,0],e.W(t.transform.zoom),q,V,F||1,z,r,N,l?r.paint.get("raster-elevation"):0,2,M,A,p.range,P,C,f),Q=t.isTileAffectedByFog(w),X=t.getOrCreateProgram("raster",{defines:p.defines,overrideFog:Q});if(t.uploadCommonUniforms(h,X,n),d instanceof e.as){const i=d.elevatedGlobeVertexBuffer,n=d.elevatedGlobeIndexBuffer;if(g||!s)d.boundsBuffer&&d.boundsSegments&&X.draw(t,u.TRIANGLES,I,Pt.disabled,m,Rt.disabled,Z,r.id,d.boundsBuffer,t.quadTriangleIndexBuffer,d.boundsSegments);else if(i&&n){const o=B.zoom<=e.bJ?d.elevatedGlobeSegments:d.getSegmentsForLongitude(B.center.lng);o&&X.draw(t,u.TRIANGLES,I,Pt.disabled,m,a,Z,r.id,i,n,o)}}else if(c){I=new Mt(u.LEQUAL,Mt.ReadOnly,t.depthRangeFor3D);const e=t.globeSharedBuffers;if(e){const[i,n,o]=e.getGridBuffers(W,!1);X.draw(t,u.TRIANGLES,I,x||D,t.colorModeForRenderPass(),a,Z,r.id,i,n,o)}}else{const{tileBoundsBuffer:e,tileBoundsIndexBuffer:i,tileBoundsSegments:n}=t.getTileBoundsBuffers(S);X.draw(t,u.TRIANGLES,I,D,m,Rt.disabled,Z,r.id,e,i,n)}}if(!(d instanceof e.as)&&c)for(const e of n){const n=e.canonical.y===(1<<e.canonical.z)-1;0===e.canonical.y&&da(!0,e,t,i,r,f,p,a,x||Pt.disabled),n&&da(!1,e,t,i,r,f,p,a===Rt.frontCW?Rt.backCW:Rt.frontCW,x||Pt.disabled)}};c?w(x,t.renderElevatedRasterBackface?Rt.backCW:Rt.frontCW,t.stencilModeFor3D()):w(x,Rt.disabled,void 0),t.resetStencilClippingMasks()},"raster-particle":function(t,i,r,n,a,o){"offscreen"===t.renderPass&&function(t,i,r,n){if(!n.length)return;const a=t.context,o=a.gl,s=i.getSource();if(!(s instanceof ke))return;const l=Math.ceil(Math.sqrt(r.paint.get("raster-particle-count")));let c=r.particleFramebuffer;c?c.width!==l&&(c.destroy(),c=r.particleFramebuffer=a.createFramebuffer(l,l,!0,null)):c=r.particleFramebuffer=a.createFramebuffer(l,l,!0,null);const h=[];for(const e of n){const t=i.getTile(e);if(!(t instanceof Wt))continue;const n=ma(t,s,r);if(!n)continue;const o=[t.tileSize,t.tileSize];let c=r.tileFramebuffer;c||(c=r.tileFramebuffer=a.createFramebuffer(o[0],o[1],!0,null));let u=t.rasterParticleState;u||(u=t.rasterParticleState=new Ot(a,e,o,l));const d=u.update(r.lastInvalidatedAt);u.particleTextureDimension!==l&&u.setParticleTextureDimension(e,l);const p=u.targetColorTexture;u.targetColorTexture=u.backgroundColorTexture,u.backgroundColorTexture=p;const f=u.particleTexture0;u.particleTexture0=u.particleTexture1,u.particleTexture1=f,h.push([e,n,u,d])}if(0===h.length)return;const u=e.f.now(),d=r.previousDrawTimestamp?.001*(u-r.previousDrawTimestamp):.0167;if(r.previousDrawTimestamp=u,r.hasColorMap()){a.activeTexture.set(o.TEXTURE0+2);let t=r.colorRampTexture;t||(t=r.colorRampTexture=new e.T(a,r.colorRamp,o.RGBA)),t.bind(o.LINEAR,o.CLAMP_TO_EDGE)}a.bindFramebuffer.set(r.tileFramebuffer.framebuffer),function(t,i,r){const n=t.context,a=n.gl,o=i.tileFramebuffer;n.activeTexture.set(a.TEXTURE0);const s={u_texture:0,u_opacity:1.05*(c=i.paint.get("raster-particle-fade-opacity-factor"))/(c+.05)},l=t.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var c;for(const h of r){const[,,r,c]=h;o.colorAttachment.set(r.targetColorTexture.texture),n.viewport.set([0,0,o.width,o.height]),n.clear({color:e.aA.transparent}),c&&(r.backgroundColorTexture.bind(a.NEAREST,a.CLAMP_TO_EDGE),l.draw(t,a.TRIANGLES,Mt.disabled,Pt.disabled,It.alphaBlended,Rt.disabled,s,i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments))}}(t,r,h),function(t,i,r,n){const a=t.context,o=a.gl,s=r.tileFramebuffer,l="globe"===t.transform.projection.name,c=r.paint.get("raster-particle-max-speed");for(const h of n){const[n,u,d]=h;a.activeTexture.set(o.TEXTURE0+0),u.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s.colorAttachment.set(d.targetColorTexture.texture);const p=t.getOrCreateProgram("rasterParticleDraw",{defines:u.defines,overrideFog:!1});a.activeTexture.set(o.TEXTURE0+1);const f=u.scalarData?[]:[0,1,2,3].map((t=>e.cN[t](n)));f.push(n);const m=n.canonical.x,g=n.canonical.y;for(const e of f){const a=i.getTile(l?e.wrapped():e);if(!a)continue;const s=a.rasterParticleState;if(!s)continue;const h=e.canonical.x+(1<<e.canonical.z)*(e.wrap-n.wrap),d=e.canonical.y;s.particleTexture0.bind(o.NEAREST,o.CLAMP_TO_EDGE);const f=On(1,s.particleTexture0.size[0],[h-m,d-g],0,u.texture.size,2,c,u.textureOffset,u.scale,u.offset);p.draw(t,o.POINTS,Mt.disabled,Pt.disabled,It.alphaBlended,Rt.disabled,f,r.id,s.particleIndexBuffer,void 0,s.particleSegment)}}}(t,i,r,h),a.bindFramebuffer.set(r.particleFramebuffer.framebuffer),function(t,i,r,n){const a=t.context,o=a.gl,s=i.paint.get("raster-particle-max-speed"),l=n*i.paint.get("raster-particle-speed-factor")*.3,c=function(e){return Math.pow(e,6)}(.01+1*i.paint.get("raster-particle-reset-rate-factor")),h=i.particleFramebuffer;a.viewport.set([0,0,h.width,h.height]);for(const u of r){const[,r,n]=u;a.activeTexture.set(o.TEXTURE0+0),r.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),a.activeTexture.set(o.TEXTURE0+1);const d=n.particleTexture0;d.bind(o.NEAREST,o.CLAMP_TO_EDGE);const p=Bn(1,d.size[0],0,r.texture.size,s,l,c,r.textureOffset,r.scale,r.offset);h.colorAttachment.set(n.particleTexture1.texture),a.clear({color:e.aA.transparent}),t.getOrCreateProgram("rasterParticleUpdate",{defines:r.defines}).draw(t,o.TRIANGLES,Mt.disabled,Pt.disabled,It.unblended,Rt.disabled,p,i.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments)}}(t,r,h,d)}(t,i,r,n),"translucent"===t.renderPass&&(function(t,i,r,n,a){const o=t.context,s=o.gl,l=!t.options.moving,c="globe"===t.transform.projection.name;if(!n.length)return;const[h,u]=t.stencilConfigForOverlap(n),d=[];c&&d.push("PROJECTION_GLOBE_VIEW");const p=t.stencilModeFor3D();for(const f of u){const n=f.toUnwrapped(),a=i.getTile(f);if(!a.rasterParticleState)continue;const u=a.rasterParticleState,m=100;a.registerFadeDuration(m);const g=i.findLoadedParent(f,0),_=hn(a,g,i,t.transform,m);let y,v;t.terrain&&t.terrain.prepareDrawTile(),o.activeTexture.set(s.TEXTURE0),u.targetColorTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),o.activeTexture.set(s.TEXTURE1),g&&g.rasterParticleState?(g.rasterParticleState.targetColorTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE),y=Math.pow(2,g.tileID.overscaledZ-a.tileID.overscaledZ),v=[a.tileID.canonical.x*y%1,a.tileID.canonical.y*y%1]):u.targetColorTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const x=c?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(n,l),b=t.transform,w=ga(b),S=e.ck(f.canonical),T=e.cl(S.getCenter().lat);let E,M,A,P,C;c?(E=Float32Array.from(e.aW(e.cn(f.canonical))),M=Float32Array.from(b.globeMatrix),A=Float32Array.from(e.cj(b)),P=[e.a8(b.center.lng),e.ah(b.center.lat)],C=Float32Array.from(e.cm(f.canonical,S,T,b.worldSize/b._pixelsPerMercatorPixel))):(E=new Float32Array(16),M=new Float32Array(9),A=new Float32Array(16),P=[0,0],C=new Float32Array(9));const I=Fn(x,E,M,A,C,v||[0,0],e.W(t.transform.zoom),P,w,y||1,_,250),k=t.isTileAffectedByFog(f),D=t.getOrCreateProgram("rasterParticle",{defines:d,overrideFog:k});if(t.uploadCommonUniforms(o,D,n),c){const e=new Mt(s.LEQUAL,Mt.ReadWrite,t.depthRangeFor3D),i=0,n=t.globeSharedBuffers;if(n){const[a,o,l]=n.getGridBuffers(T,0!==i);D.draw(t,s.TRIANGLES,e,p,It.alphaBlended,Rt.backCCW,I,r.id,a,o,l)}}else{const e=t.depthModeForSublayer(0,Mt.ReadOnly),i=h[f.overscaledZ],{tileBoundsBuffer:n,tileBoundsIndexBuffer:o,tileBoundsSegments:l}=t.getTileBoundsBuffers(a);D.draw(t,s.TRIANGLES,e,i,It.alphaBlended,Rt.disabled,I,r.id,n,o,l)}}t.resetStencilClippingMasks()}(t,i,r,n),t.style.map.triggerRepaint())},background:function(e,t,i,r){const n=i.paint.get("background-color"),a=i.paint.get("background-opacity"),o=i.paint.get("background-emissive-strength");if(0===a)return;const s=e.context,l=s.gl,c=e.transform,h=c.tileSize,u=i.paint.get("background-pattern");if(e.isPatternMissing(u,i.scope))return;const d=!u&&1===n.a&&1===a&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==d)return;const p=Pt.disabled,f=e.depthModeForSublayer(0,"opaque"===d?Mt.ReadWrite:Mt.ReadOnly),m=e.colorModeForDrapableLayerRenderPass(o),g=u?"backgroundPattern":"background";let _,y=r;y||(_=e.getBackgroundTiles(),y=Object.values(_).map((e=>e.tileID))),u&&(s.activeTexture.set(l.TEXTURE0),e.imageManager.bind(e.context,i.scope));for(const v of y){const d=e.isTileAffectedByFog(v),y=e.getOrCreateProgram(g,{overrideFog:d}),x=v.toUnwrapped(),b=r?v.projMatrix:e.transform.calculateProjMatrix(x);e.prepareDrawTile();const w=t?t.getTile(v):_?_[v.key]:new Nt(v,h,c.zoom,e),S=u?qn(b,o,a,e,u,i.scope,{tileID:v,tileSize:h}):Gn(b,o,a,n);e.uploadCommonUniforms(s,y,x);const{tileBoundsBuffer:T,tileBoundsIndexBuffer:E,tileBoundsSegments:M}=e.getTileBoundsBuffers(w);y.draw(e,l.TRIANGLES,f,p,m,Rt.disabled,S,i.id,T,E,M)}},sky:function(t,i,r){const n=t._atmosphere?e.W(t.transform.zoom):1,a=r.paint.get("sky-opacity")*n;if(0===a)return;const o=t.context,s=r.paint.get("sky-type"),l=new Mt(o.gl.LEQUAL,Mt.ReadOnly,[0,1]),c=t.frameCounter/1e3%1;"atmosphere"===s?"offscreen"===t.renderPass?r.needsSkyboxCapture(t)&&(function(t,i,r,n){const a=t.context,o=a.gl;let s=i.skyboxFbo;if(!s){s=i.skyboxFbo=a.createFramebuffer(32,32,!0,null),i.skyboxGeometry=new Ca(a),i.skyboxTexture=a.gl.createTexture(),o.bindTexture(o.TEXTURE_CUBE_MAP,i.skyboxTexture),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR);for(let e=0;e<6;++e)o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,o.RGBA,32,32,0,o.RGBA,o.UNSIGNED_BYTE,null)}a.bindFramebuffer.set(s.framebuffer),a.viewport.set([0,0,32,32]);const l=i.getCenter(t,!0),c=t.getOrCreateProgram("skyboxCapture"),h=new Float64Array(16);e.a9.identity(h),e.a9.rotateY(h,h,.5*-Math.PI),Ia(t,i,c,h,l,0),e.a9.identity(h),e.a9.rotateY(h,h,.5*Math.PI),Ia(t,i,c,h,l,1),e.a9.identity(h),e.a9.rotateX(h,h,.5*-Math.PI),Ia(t,i,c,h,l,2),e.a9.identity(h),e.a9.rotateX(h,h,.5*Math.PI),Ia(t,i,c,h,l,3),e.a9.identity(h),Ia(t,i,c,h,l,4),e.a9.identity(h),e.a9.rotateY(h,h,Math.PI),Ia(t,i,c,h,l,5),a.viewport.set([0,0,t.width,t.height])}(t,r),r.markSkyboxValid(t)):"sky"===t.renderPass&&function(e,t,i,r,n){const a=e.context,o=a.gl,s=e.transform,l=e.getOrCreateProgram("skybox");a.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_CUBE_MAP,t.skyboxTexture);const c=((e,t,i,r,n)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:r,u_temporal_offset:n}))(s.skyboxMatrix,t.getCenter(e,!1),0,r,n);e.uploadCommonUniforms(a,l),l.draw(e,o.TRIANGLES,i,Pt.disabled,e.colorModeForRenderPass(),Rt.backCW,c,"skybox",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}(t,r,l,a,c):"gradient"===s&&"sky"===t.renderPass&&function(t,i,r,n,a){const o=t.context,s=o.gl,l=t.transform,c=t.getOrCreateProgram("skyboxGradient");i.skyboxGeometry||(i.skyboxGeometry=new Ca(o)),o.activeTexture.set(s.TEXTURE0);let h=i.colorRampTexture;h||(h=i.colorRampTexture=new e.T(o,i.colorRamp,s.RGBA)),h.bind(s.LINEAR,s.CLAMP_TO_EDGE);const u=((t,i,r,n,a)=>({u_matrix:t,u_color_ramp:0,u_center_direction:i,u_radius:e.bm(r),u_opacity:n,u_temporal_offset:a}))(l.skyboxMatrix,i.getCenter(t,!1),i.paint.get("sky-gradient-radius"),n,a);t.uploadCommonUniforms(o,c),c.draw(t,s.TRIANGLES,r,Pt.disabled,t.colorModeForRenderPass(),Rt.backCW,u,"skyboxGradient",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}(t,r,l,a,c)},debug:function(t,i,r,n,a,o){for(let s=0;s<r.length;s++)if(a){const a=1,l=.8,c=new e.aA(n.r*l,n.g*l,n.b*l,1);wa(t,i,r[s],n,-a,-a,o),wa(t,i,r[s],n,-a,a,o),wa(t,i,r[s],n,a,a,o),wa(t,i,r[s],n,a,-a,o),wa(t,i,r[s],c,0,0,o)}else wa(t,i,r[s],n,0,0,o)},custom:function(t,i,r,n){const a=t.context,o=r.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||"offscreen"===t.renderPass)&&r.isDraped(i)){if("offscreen"===t.renderPass){const i=o.prerender;if(i){if(t.setCustomLayerDefaults(),a.setColorMode(t.colorModeForRenderPass()),"globe"===t.transform.projection.name){const r=t.transform.pointMerc;i.call(o,a.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.W(t.transform.zoom),[r.x,r.y],t.transform.pixelsPerMeterRatio)}else i.call(o,a.gl,t.transform.customLayerMatrix());a.setDirty(),t.setBaseState()}}else if("translucent"===t.renderPass){if(t.terrain&&t.terrain.renderingToTexture){const i=o.renderToTile;if(i){const r=n[0].canonical,s=new e.O(r.x+n[0].wrap*(1<<r.z),r.y,r.z);a.setDepthMode(Mt.disabled),a.setStencilMode(Pt.disabled),a.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),i.call(o,a.gl,s),a.setDirty(),t.setBaseState()}return}t.setCustomLayerDefaults(),a.setColorMode(t.colorModeForRenderPass()),a.setStencilMode(Pt.disabled);const i="3d"===o.renderingMode?new Mt(t.context.gl.LEQUAL,Mt.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Mt.ReadOnly);if(a.setDepthMode(i),"globe"===t.transform.projection.name){const i=t.transform.pointMerc;o.render(a.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.W(t.transform.zoom),[i.x,i.y],t.transform.pixelsPerMeterRatio)}else o.render(a.gl,t.transform.customLayerMatrix());a.setDirty(),t.setBaseState(),a.bindFramebuffer.set(null)}}else e.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(t,i,r,n){if("opaque"===t.renderPass)return;const a=r.paint.get("model-opacity");if(0===a)return;const o=r.paint.get("model-cast-shadows");if("shadow"===t.renderPass){if(!o)return;if(t.terrain&&a<.65&&r._transitionablePaint._values["model-opacity"].value.expression instanceof e.Z)return}const s=t.shadowRenderer,l=r.paint.get("model-receive-shadows");s&&(s.useNormalOffset=!0,l||(s.enabled=!1));const c=()=>{s&&(s.useNormalOffset=!0,l||(s.enabled=!0))},h=i.getSource();if("light-beam"===t.renderPass&&"batched-model"!==h.type)return;if("vector"===h.type||"geojson"===h.type)return function(t,i,r,n,a){const o=t.transform;if("mercator"!==o.projection.name)return void e.w("Drawing 3D models for ".concat(o.projection.name," projection is not yet implemented"));const s=o.getFreeCameraOptions().position;if(!t.modelManager)return;const l=t.modelManager;r.modelManager=l;const c=t.shadowRenderer;if(!r._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const h=r._unevaluatedLayout._values["model-id"],u={...r.layout.get("model-id").parameters};for(const d of n){const n=i.getTile(d).getBucket(r);if(!n||n.projection.name!==o.projection.name)continue;const p=n.getModelUris();p&&!n.modelsRequested&&(l.addModelsFromBucket(p,a),n.modelsRequested=!0);const f=Ga(d,o);u.zoom=f;const m=h.possiblyEvaluate(u);if(ja(t,n,d),Ua.shadowUniformsInitialized=!1,Ua.useSingleShadowCascade=!!c&&0===c.getMaxCascadeForTile(d.toUnwrapped()),"shadow"===t.renderPass&&c){if(1===t.currentShadowCascade&&n.isInsideFirstShadowMapFrustum)continue;const i=o.calculatePosMatrix(d.toUnwrapped(),o.worldSize);if(Ua.tileMatrix.set(i),Ua.shadowTileMatrix=Float32Array.from(c.calculateShadowPassMatrixFromMatrix(i)),Ua.aabb.min.fill(0),Ua.aabb.max[0]=Ua.aabb.max[1]=e.Y,Ua.aabb.max[2]=0,Wa(n,Ua,t,r.scope))continue}const g=1<<d.canonical.z,_=[((s.x-d.wrap)*g-d.canonical.x)*e.Y,(s.y*g-d.canonical.y)*e.Y,s.z*g*e.Y];for(let e in n.instancesPerModel){const i=n.instancesPerModel[e];i.features.length>0&&(e=m.evaluate(i.features[0].feature,{}));const o=l.getModel(e,a);if(o&&o.uploaded)for(const e of o.nodes)qa(t,r,e,i,_,d,Ua)}}}(t,i,r,n,"vector"===h.type?r.scope:""),void c();if(!h.loaded())return;if("batched-model"===h.type)return function(t,i,r,n){r.resetLayerRenderingStats(t);const a=t.context,o=t.transform,s=t.style.fog,l=t.shadowRenderer;if("mercator"!==o.projection.name)return void e.w("Drawing 3D landmark models for ".concat(o.projection.name," projection is not yet implemented"));const c=t.transform.getFreeCameraOptions().position,h=e.Q.scale([],[c.x,c.y,c.z],t.transform.worldSize);e.Q.negate(h,h);const u=e.a9.identity([]),d=e.cZ(o.center.lat,o.zoom),p=e.a9.fromScaling([],[1,1,1/d]);e.a9.translate(u,u,h);const f=r.paint.get("model-opacity"),m=new Mt(a.gl.LEQUAL,Mt.ReadWrite,t.depthRangeFor3D),g=new Mt(a.gl.LEQUAL,Mt.ReadOnly,t.depthRangeFor3D),_=new e.bV([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),y="shadow"===t.renderPass,v=y&&l?l.getCurrentCascadeFrustum():o.getFrustum(o.scaleZoom(o.worldSize)),x=r.getLayerRenderingStats(),b=function(c,h){for(const d of n){const n=i.getTile(d).getBucket(r);if(!n||!n.uploaded)continue;let b=!1;l&&(b=0===l.getMaxCascadeForTile(d.toUnwrapped()));const w=o.calculatePosMatrix(d.toUnwrapped(),o.worldSize),S=n.modelTraits;for(const i of n.getNodesInfo()){if(i.hiddenByReplacement)continue;if(!i.node.meshes)continue;const n=i.evaluatedScale,d=i.node;let T=0;if(t.terrain&&d.elevation&&(T=d.elevation*t.terrain.exaggeration()),n[0]<=1&&n[1]<=1&&n[2]<=1&&0===(()=>{const t=i.getLocalBounds();return _.min=[...t.min],_.max=[...t.max],_.min[2]+=T,_.max[2]+=T,e.Q.transformMat4(_.min,_.min,w),e.Q.transformMat4(_.max,_.max,w),_})().intersects(v))continue;const E=[...w];e.a9.translate(E,E,[(d.anchor?d.anchor[0]:0)*(n[0]-1),(d.anchor?d.anchor[1]:0)*(n[1]-1),T]),e.Q.exactEquals(n,e.c$)||e.a9.scale(E,E,n);const M=e.a9.multiply([],E,d.matrix);let A=e.a9.multiply([],p,E);e.a9.multiply(A,u,A);const P=e.a9.invert([],A);e.a9.transpose(P,P),e.a9.scale(P,P,Ha),A=e.a9.multiply(A,A,d.matrix);const C="light-beam"===t.renderPass,I=e.a9.multiply([],o.expandedFarZProjMatrix,M),k=e.a9.multiply([],o.expandedFarZProjMatrix,E),D=S&e.d1.HasMapboxMeshFeatures,R=D?0:i.evaluatedRMEA[0][2];for(let e=0;e<d.meshes.length;++e){const n=d.meshes[e],u=e===d.lightMeshIndex;let p=I;if(u){if(!C&&!t.terrain&&t.shadowRenderer){t.currentLayer<t.firstLightBeamLayer&&(t.firstLightBeamLayer=t.currentLayer);continue}p=k}else if(C)continue;const _={defines:[]},v=[];if(Oa(_.defines,v,n,t),D||_.defines.push("DIFFUSE_SHADED"),b&&_.defines.push("SHADOWS_SINGLE_CASCADE"),x&&(y?x.numRenderedVerticesInShadowPass+=n.vertexArray.length:x.numRenderedVerticesInTransparentPass+=n.vertexArray.length),y){Va(n,M,t,r);continue}let w=null;if(s){const e=Fa(M,t.transform);if(w=new Float32Array(e),"globe"!==o.projection.name){const t=n.aabb.min,i=n.aabb.max,[r,a]=s.getOpacityForBounds(e,t[0],t[1],i[0],i[1]);_.overrideFog=r>=pe||a>=pe}}const S=n.material;let T;S.occlusionTexture&&S.occlusionTexture.offsetScale&&(T=S.occlusionTexture.offsetScale,_.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!y&&l&&(l.useNormalOffset=!!n.normalBuffer);const L=t.getOrCreateProgram("model",_);!y&&l&&l.setupShadowsFromMatrix(E,L,l.useNormalOffset),t.uploadCommonUniforms(a,L,null,w);const z=S.pbrMetallicRoughness;z.metallicFactor=.9,z.roughnessFactor=.5;const F=Wn(new Float32Array(p),new Float32Array(A),new Float32Array(P),new Float32Array(d.matrix),t,f,z.baseColorFactor,S.emissiveFactor,z.metallicFactor,z.roughnessFactor,S,R,r,[0,0,0],T);L.draw(t,a.gl.TRIANGLES,h&&!u?m:g,Pt.disabled,c?u||f<1||i.hasTranslucentParts?It.alphaBlended:It.unblended:It.disabled,Rt.backCCW,F,r.id,n.vertexBuffer,n.indexBuffer,n.segments,r.paint,t.transform.zoom,void 0,v)}}}};(function(e,t,i,r){const n=e.terrain?e.terrain.exaggeration():0,a=e.transform.zoom;for(const o of r){const r=t.getTile(o).getBucket(i);r&&(e.conflationActive&&r.updateReplacement(o,e.replacementSource),r.evaluateScale(e,i),e.terrain&&n>0&&r.elevationUpdate(e.terrain,n,o,i.source),r.needsReEvaluation(e,a,i)&&r.evaluate(i))}})(t,i,r,n),1===f?b(!0,!0):(b(!1,!0),b(!0,!1))}(t,i,r,n),void c();const u=h.getModels(),d=[],p=t.transform.getFreeCameraOptions().position,f=e.Q.scale([],[p.x,p.y,p.z],t.transform.worldSize);e.Q.negate(f,f);const m=[],g=[];let _=0;for(const y of u){const i=r.paint.get("model-rotation").constantOr(null),n=r.paint.get("model-scale").constantOr(null),a=r.paint.get("model-translation").constantOr(null);y.computeModelMatrix(t,i,n,a,!0,!0,!1);const o=e.a9.identity([]),s=e.cZ(y.position.lat,t.transform.zoom),l=e.a9.fromScaling([],[1,1,1/s]);e.a9.translate(o,o,f),d.push({zScaleMatrix:l,negCameraPosMatrix:o});for(const e of y.nodes)Na(t.transform,e,y.matrix,t.transform.expandedFarZProjMatrix,_,m,g);_++}if(m.sort(((e,t)=>t.depth-e.depth)),"shadow"!==t.renderPass){if(1===a)for(const e of g)Ba(e,t,r,d[e.modelIndex],Pt.disabled,t.colorModeForRenderPass());else{for(const e of g)Ba(e,t,r,d[e.modelIndex],Pt.disabled,It.disabled);for(const e of g)Ba(e,t,r,d[e.modelIndex],t.stencilModeFor3D(),t.colorModeForRenderPass());t.resetStencilClippingMasks()}for(const e of m)Ba(e,t,r,d[e.modelIndex],Pt.disabled,t.colorModeForRenderPass());c()}else{for(const e of g)Va(e.mesh,e.nodeModelMatrix,t,r);for(const e of m)Va(e.mesh,e.nodeModelMatrix,t,r);c()}}},Ya={model:function(e,t,i){const r=t.getSource();if(!r.loaded())return;if("vector"===r.type||"geojson"===r.type)return void(i.modelManager&&i.modelManager.upload(i,"vector"===r.type?e.scope:""));if("batched-model"===r.type)return;const n=r.getModels();for(const a of n)a.upload(i.context)},raster:function(e,t,i){const r=t.getSource();if(!(r instanceof ke&&r.loaded()))return;const n=e.sourceLayer||r.rasterLayerIds&&r.rasterLayerIds[0];if(!n)return;const a=e.paint.get("raster-array-band")||r.getInitialBand(n);if(null==a)return;const o=t.getIds().map((e=>t.getTileByID(e)));for(const s of o)s.updateNeeded(n,a)&&r.prepareTile(s,n,a)},"raster-particle":function(e,t,i){const r=t.getSource();if(!(r instanceof ke&&r.loaded()))return;const n=e.sourceLayer||r.rasterLayerIds&&r.rasterLayerIds[0];if(!n)return;const a=e.paint.get("raster-particle-array-band")||r.getInitialBand(n);if(null==a)return;const o=t.getIds().map((e=>t.getTileByID(e)));for(const s of o)s.updateNeeded(n,a)&&r.prepareTile(s,n,a)}};class Ja{constructor(t,i,r,n){this.context=new Lt(t,i),this.transform=r,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=n,this._timeStamp=(new Date).getTime(),this._averageFPS=0,this._fpsHistory=[],this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const a=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const e of a)this._debugParams.enabledLayers[e]=!0;n.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),n.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),n.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),n.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),n.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const e of a)n.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],e);this.setup(),this.numSublayers=Qt.maxUnderzooming+Qt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new e.d3,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new vr(this),this._wireframeDebugCache=new Qa,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(e,t){const i=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new fn(this,e));const r=this._terrain;this.transform.elevation=i?r:null,r.update(e,this.transform,t),this.transform.elevation&&!r.enabled&&(this.transform.elevation=null)}_updateFog(e){const t=e.fog;if(!t||"globe"===this.transform.projection.name||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[i,r]=t.getFovAdjustedRange(this.transform._fov);if(i>r)return void(this.transform.fogCullDistSq=null);const n=i+.78*(r-i);this.transform.fogCullDistSq=n*n}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,i){if(this.width=t*e.f.devicePixelRatio,this.height=i*e.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style.order)this.style._mergedLayers[e].resize()}setup(){const t=this.context,i=new e.aQ;i.emplaceBack(0,0),i.emplaceBack(e.Y,0),i.emplaceBack(0,e.Y),i.emplaceBack(e.Y,e.Y),this.tileExtentBuffer=t.createVertexBuffer(i,e.aS.members),this.tileExtentSegments=e.aE.simpleSegment(0,0,4,2);const r=new e.aQ;r.emplaceBack(0,0),r.emplaceBack(e.Y,0),r.emplaceBack(0,e.Y),r.emplaceBack(e.Y,e.Y),this.debugBuffer=t.createVertexBuffer(r,e.aS.members),this.debugSegments=e.aE.simpleSegment(0,0,4,5);const n=new e.aQ;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(-1,1),n.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(n,e.aS.members),this.viewportSegments=e.aE.simpleSegment(0,0,4,2);const a=new e.ay;a.emplaceBack(0,0,0,0),a.emplaceBack(e.Y,0,e.Y,0),a.emplaceBack(0,e.Y,0,e.Y),a.emplaceBack(e.Y,e.Y,e.Y,e.Y),this.mercatorBoundsBuffer=t.createVertexBuffer(a,e.aU.members),this.mercatorBoundsSegments=e.aE.simpleSegment(0,0,4,2);const o=new e.az;o.emplaceBack(0,1,2),o.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(o);const s=new e.aR;for(const e of[0,1,3,2,0])s.emplaceBack(e);this.debugIndexBuffer=t.createIndexBuffer(s),this.emptyTexture=new e.T(t,new e.h({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA),this.identityMat=e.a9.create();const l=this.context.gl;this.stencilClearMode=new Pt({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,Mt.disabled,this.stencilClearMode,It.disabled,Rt.disabled,cn(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,t,i){if(!t||this.currentStencilSource===t.id||!e.isTileClipped()||!i||0===i.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of i)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=t.id;const r=this.context,n=r.gl;this.nextStencilID+i.length>256&&this.clearStencil(),r.setColorMode(It.disabled),r.setDepthMode(Mt.disabled);const a=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const o of i){const e=t.getTile(o),i=this._tileClippingMaskIDs[o.key]=this.nextStencilID++,{tileBoundsBuffer:r,tileBoundsIndexBuffer:s,tileBoundsSegments:l}=this.getTileBoundsBuffers(e);a.draw(this,n.TRIANGLES,Mt.disabled,new Pt({func:n.ALWAYS,mask:0},i,255,n.KEEP,n.KEEP,n.REPLACE),It.disabled,Rt.disabled,cn(o.projMatrix),"$clipping",r,s,l)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,t=this.context.gl;return new Pt({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const t=this.context.gl;return new Pt({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}stencilConfigForOverlap(e){const t=this.context.gl,i=e.sort(((e,t)=>t.overscaledZ-e.overscaledZ)),r=i[i.length-1].overscaledZ,n=i[0].overscaledZ-r+1;if(n>1){this.currentStencilSource=void 0,this.nextStencilID+n>256&&this.clearStencil();const e={};for(let i=0;i<n;i++)e[i+r]=new Pt({func:t.GEQUAL,mask:255},i+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=n,[e,i]}return[{[r]:Pt.disabled},i]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const i=1/8;return new It([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new e.aA(i,i,i,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?It.unblended:It.alphaBlended}colorModeForDrapableLayerRenderPass(t){const i=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?new It([i.ONE,i.ONE_MINUS_SRC_ALPHA,i.CONSTANT_ALPHA,i.ONE_MINUS_SRC_ALPHA],new e.aA(0,0,0,void 0===t?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!this.opaquePassEnabledForLayer()&&!r)return Mt.disabled;const n=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Mt(i||this.context.gl.LEQUAL,t,[n,n])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}updateAverageFPS(){const e=(new Date).getTime(),t=e-this._timeStamp;this._timeStamp=e,this._fpsHistory.push(0===t?0:1e3/t),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((e,t)=>e+t/this._fpsHistory.length),0))}render(t,i){this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=i;const r=this.style._mergedLayers,n=this.style.order.filter((e=>{const t=r[e];return!(t.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[t.type]})),a=n.map((e=>r[e])),o=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.f.now()),this.imageManager.beginFrame();let s=0,l=!1;for(const e in o){const t=o[e];t.used&&(t.prepare(this.context),t.getSource().usedInConflation&&++s)}for(const e of a)e.isHidden(this.transform.zoom)||this.prepareLayer(e);const c={},h={},u={},d={},p={};for(const e in o){const t=o[e];c[e]=t.getVisibleCoordinates(),h[e]=c[e].slice().reverse(),u[e]=t.getVisibleCoordinates(!0).reverse(),d[e]=t.getShadowCasterCoordinates(),p[e]=t.sortCoordinatesByDistance(c[e])}const f=e=>{const t=this.style.getLayerSourceCache(e);return t&&t.used?t.getSource():null};if(s){const e=[];for(const t of a)this.layerUsedInConflation(t,f(t))&&e.push(t);if(e&&e.length>1){const t=[];for(const i of e){const e=this.style.getLayerSourceCache(i);e&&e.used&&e.getSource().usedInConflation&&t.push({layer:i.fqid,cache:e})}this.replacementSource.setSources(t),l=!0}}l||this.replacementSource.clear(),this.conflationActive=l,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const e of a){const t=e.cutoffRange();if(this.longestCutoffRange=Math.max(t,this.longestCutoffRange),t>0){const t=f(e);t&&(this.minCutoffZoom=Math.max(t.minzoom,this.minCutoffZoom)),e.minzoom&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let e=0;e<a.length;e++)if(a[e].is3D()){this.opaquePassCutoff=e;break}const m=this.style&&this.style.fog;m?(this._fogVisible=0!==m.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=m.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(u),this.opaquePassCutoff=0);const g=this._shadowRenderer;if(g){g.updateShadowParameters(this.transform,this.style.directionalLight);for(const e in o)for(const t of c[e]){let e={min:0,max:0};this.terrain&&(e=this.terrain.getMinMaxForTile(t)||e),g.addShadowReceiver(t.toUnwrapped(),e.min,e.max)}}if("globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new e.d4(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new za(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!e.d5(this.context.gl))return;this.renderPass="offscreen";for(const e of a){const i=t.getLayerSourceCache(e);if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;const r=i?h[i.id]:void 0;("custom"===e.type||"raster"===e.type||"raster-particle"===e.type||e.isSky()||r&&r.length)&&this.renderLayer(this,i,e,r)}this.depthRangeFor3D=[0,1-(a.length+2)*this.numSublayers*this.depthEpsilon];const _=this.terrain;_&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&_.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,d)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const y="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),v=(()=>{if(i.showOverdrawInspector)return e.aA.black;if(this.style.fog&&this.transform.projection.supportsFog&&!y){const t=this.style.fog.properties.get("color").toArray01();return new e.aA(...t)}if(this.style.fog&&this.transform.projection.supportsFog&&y){const t=this.style.fog.properties.get("space-color").toArray01();return new e.aA(...t)}return e.aA.transparent})();if(this.context.clear({color:v,depth:1}),this.clearStencil(),this._showOverdrawInspector=i.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=n.length-1;this.currentLayer>=0;this.currentLayer--){const e=a[this.currentLayer],i=t.getLayerSourceCache(e);if(e.isSky())continue;const r=i?(e.is3D()?p:h)[i.id]:void 0;this._renderTileClippingMasks(e,i,r),this.renderLayer(this,i,e,r)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&y&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||e.W(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<n.length;this.currentLayer++){const e=a[this.currentLayer],i=t.getLayerSourceCache(e);e.isSky()&&this.renderLayer(this,i,e,i?h[i.id]:void 0)}function x(e,t){let i;return t&&(i=("symbol"===e.type?u:e.is3D()?p:h)[t.id]),i}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<n.length;){const e=a[this.currentLayer];if("raster"===e.type){const i=t.getLayerSourceCache(e);this.renderLayer(this,i,e,x(e,i))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let b=0;for(g&&(b=g.getShadowCastingLayerCount());this.currentLayer<n.length;){const e=a[this.currentLayer],i=t.getLayerSourceCache(e);if(e.isSky())++this.currentLayer;else if(_&&this.style.isLayerDraped(e)){if(e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=_.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(e,i,i?c[i.id]:void 0),this.renderLayer(this,i,e,x(e,i)),!_&&g&&b>0&&e.hasShadowPass()&&0==--b&&(g.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const e=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=e;this.currentLayer++){const e=a[this.currentLayer];if(!e.hasLightBeamPass())continue;const i=t.getLayerSourceCache(e);this.renderLayer(this,i,e,i?h[i.id]:void 0)}this.currentLayer=e,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let i=null;a.forEach((e=>{const r=t.getLayerSourceCache(e);r&&!e.isHidden(this.transform.zoom)&&r.getVisibleCoordinates().length&&(!i||i.getSource().maxzoom<r.getSource().maxzoom)&&(i=r)})),i&&this.options.showTileBoundaries&&Xa.debug(this,i,i.getVisibleCoordinates(),e.aA.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Xa.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new e.aA(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(e){const t=e.transform.padding;Sa(e,e.transform.height-(t.top||0),3,_a),Sa(e,t.bottom||0,3,ya),Ta(e,t.left||0,3,va),Ta(e,e.transform.width-(t.right||0),3,xa);const i=e.transform.centerPoint;!function(e,t,i,r){Ea(e,t-1,i-10,2,20,r),Ea(e,t-10,i-1,20,2,r)}(e,i.x,e.transform.height-i.y,ba)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),l||(this.conflationActive=!1)}prepareLayer(e){this.gpuTimingStart(e);const{unsupportedLayers:t}=this.transform.projection,i=!t||!t.includes(e.type);if(Ya[e.type]&&(i||this.terrain&&"custom"===e.type)){const t=this.style.getLayerSourceCache(e);Ya[e.type](e,t,this)}this.gpuTimingEnd()}renderLayer(e,t,i,r){i.isHidden(this.transform.zoom)||("background"===i.type||"sky"===i.type||"custom"===i.type||"model"===i.type||"raster"===i.type||"raster-particle"===i.type||r&&r.length)&&(this.id=i.id,this.gpuTimingStart(i),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(i.type)||e.terrain&&"custom"===i.type)&&Xa[i.type](e,t,i,r,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery,i=this.context.gl;let r=this.gpuTimers[e.id];r||(r=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:i.createQuery()}),r.calls++,i.beginQuery(t.TIME_ELAPSED_EXT,r.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,t=this.context.gl,i=t.createQuery();this.deferredRenderGpuTimeQueries.push(i),t.beginQuery(e.TIME_ELAPSED_EXT,i)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const t={};for(const i in e){const r=e[i],n=this.context.extTimerQuery,a=n.getQueryParameter(r.query,this.context.gl.QUERY_RESULT)/1e6;n.deleteQueryEXT(r.query),t[i]=a}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const t=this.context.extTimerQuery,i=this.context.gl;let r=0;for(const n of e)r+=t.getQueryParameter(n,i.QUERY_RESULT)/1e6,t.deleteQueryEXT(n);return r}translatePosMatrix(t,i,r,n,a){if(!r[0]&&!r[1])return t;const o=a?"map"===n?this.transform.angle:0:"viewport"===n?-this.transform.angle:0;if(o){const e=Math.sin(o),t=Math.cos(o);r=[r[0]*t-r[1]*e,r[0]*e+r[1]*t]}const s=[a?r[0]:e.a6(i,r[0],this.transform.zoom),a?r[1]:e.a6(i,r[1],this.transform.zoom),0],l=new Float32Array(16);return e.a9.translate(l,t,s),l}saveTileTexture(e){const t=e.size[0],i=this._tileTextures[t];i?i.push(e):this._tileTextures[t]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}isPatternMissing(e,t){return null===e||void 0!==e&&!this.imageManager.getPattern(e.toString(),t)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(e,t,i){const r=void 0===i?this.terrain&&this.terrain.renderingToTexture:i,n=this.terrain&&0===this.terrain.exaggeration(),a=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===e||"terrainRaster"===e?(a.push("LIGHTING_3D_MODE"),a.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):r||a.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass?this._shadowMapDebug||a.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?a.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):a.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(a.push("TERRAIN"),this.linearFloatFilteringSupported()&&a.push("TERRAIN_DEM_FLOAT_FORMAT"),n&&a.push("ZERO_EXAGGERATION")),"globe"===this.transform.projection.name&&a.push("GLOBE"),!this._fogVisible||r||void 0!==t&&!t||a.push("FOG","FOG_DITHERING"),r&&a.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&a.push("OVERDRAW_INSPECTOR"),a}getOrCreateProgram(e,t){this.cache=this.cache||{};const i=t&&t.defines||[],r=t&&t.config,n=this.currentGlobalDefines(e,t&&t.overrideFog,t&&t.overrideRtt).concat(i),a=yn.cacheKey(Wr[e],e,n,r);return this.cache[a]||(this.cache[a]=new yn(this.context,e,Wr[e],r,Qn[e],n)),this.cache[a]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,i){if(this.style.enable3dLights()){const r=this.style.directionalLight,n=this.style.ambientLight;if(r&&n){const a=((t,i)=>{const r=t.properties.get("direction"),n=t.properties.get("color").toArray01(),a=t.properties.get("intensity"),o=i.properties.get("color").toArray01(),s=i.properties.get("intensity"),l=[r.x,r.y,r.z],c=e.cs(o,s),h=e.cs(n,a);return{u_lighting_ambient_color:c,u_lighting_directional_dir:l,u_lighting_directional_color:h,u_ground_radiance:mn(l,h,c)}})(r,n);i.setLightsUniformValues(t,a)}}}uploadCommonUniforms(t,i,r,n,a){if(this.uploadCommonLightUniforms(t,i),this.terrain&&this.terrain.renderingToTexture)return;const o=this.style.fog;if(o){const a=o.getOpacity(this.transform.pitch),s=((t,i,r,n,a,o,s,l,c,h,u,d)=>{const p=t.transform,f=i.properties.get("color").toArray01();f[3]=n;const m=t.frameCounter/1e3%1,[g,_]=i.properties.get("vertical-range");return{u_fog_matrix:r?p.calculateFogTileMatrix(r):d||t.identityMat,u_fog_range:i.getFovAdjustedRange(p._fov),u_fog_color:f,u_fog_horizon_blend:i.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(g,_),_],u_fog_temporal_offset:m,u_frustum_tl:a,u_frustum_tr:o,u_frustum_br:s,u_frustum_bl:l,u_globe_pos:c,u_globe_radius:h,u_viewport:u,u_globe_transition:e.W(p.zoom),u_is_globe:+("globe"===p.projection.name)}})(this,o,r,a,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*e.f.devicePixelRatio,this.transform.height*e.f.devicePixelRatio],n);i.setFogUniformValues(t,s)}a&&i.setCutoffUniformValues(t,a.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,t=this._backgroundTiles={},i=this.transform.coveringTiles({tileSize:512});for(const r of i)t[r.key]=e[r.key]||new Nt(r,512,this.transform.tileZoom,this);return t}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(e,t){return!(!e.is3D()||e.minzoom&&e.minzoom>this.transform.zoom||"building"!==e.sourceLayer&&(!t||"batched-model"!==t.type))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let t=this._cachedTileFogOpacities[e.key];return t||(this._cachedTileFogOpacities[e.key]=t=this.style.fog.getOpacityForTile(e)),t[0]>=pe||t[1]>=pe}}function Ka(e,t){let i=!1,r=null;const n=()=>{r=null,i&&(e(),r=setTimeout(n,t),i=!1)};return()=>(i=!0,r||n(),r)}class $a{constructor(t){this._hashName=t&&encodeURIComponent(t),e.a$(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ka(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,window.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const e=this._map;if(!e)return"";const t=eo(e);if(this._hashName){const e=this._hashName;let i=!1;const r=location.hash.slice(1).split("&").map((r=>{const n=r.split("=")[0];return n===e?(i=!0,"".concat(n,"=").concat(t)):r})).filter((e=>e));return i||r.push("".concat(e,"=").concat(t)),"#".concat(r.join("&"))}return"#".concat(t)}_getCurrentHash(){const e=location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map((e=>e.split("="))).forEach((e=>{e[0]===this._hashName&&(t=e)})),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const t=this._getCurrentHash();if(t.length>=3&&!t.some((e=>isNaN(e)))){const i=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(t[3]||0):e.getBearing();return e.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:i,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function eo(e,t){const i=e.getCenter(),r=Math.round(100*e.getZoom())/100,n=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),a=Math.pow(10,n),o=Math.round(i.lng*a)/a,s=Math.round(i.lat*a)/a,l=e.getBearing(),c=e.getPitch();let h=t?"/".concat(o,"/").concat(s,"/").concat(r):"".concat(r,"/").concat(s,"/").concat(o);return(l||c)&&(h+="/"+Math.round(10*l)/10),c&&(h+="/".concat(Math.round(c))),h}const to={linearity:.3,easing:e.d6(0,0,.3,1)},io=e.e({deceleration:2500,maxSpeed:1400},to),ro=e.e({deceleration:20,maxSpeed:1400},to),no=e.e({deceleration:1e3,maxSpeed:360},to),ao=e.e({deceleration:1e3,maxSpeed:90},to);class oo{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.f.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,i=e.f.now();for(;t.length>0&&i-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const i={zoom:0,bearing:0,pitch:0,pan:new e.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)i.zoom+=e.zoomDelta||0,i.bearing+=e.bearingDelta||0,i.pitch+=e.pitchDelta||0,e.panDelta&&i.pan._add(e.panDelta),e.around&&(i.around=e.around),e.pinchAround&&(i.pinchAround=e.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,n={};if(i.pan.mag()){const a=lo(i.pan.mag(),r,e.e({},io,t||{}));n.offset=i.pan.mult(a.amount/i.pan.mag()),n.center=this._map.transform.center,so(n,a)}if(i.zoom){const e=lo(i.zoom,r,ro);n.zoom=this._map.transform.zoom+e.amount,so(n,e)}if(i.bearing){const t=lo(i.bearing,r,no);n.bearing=this._map.transform.bearing+e.ad(t.amount,-179,179),so(n,t)}if(i.pitch){const e=lo(i.pitch,r,ao);n.pitch=this._map.transform.pitch+e.amount,so(n,e)}if(n.zoom||n.bearing){const e=void 0===i.pinchAround?i.around:i.pinchAround;n.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),n.noMoveStart=!0,n}}function so(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function lo(t,i,r){const{maxSpeed:n,linearity:a,deceleration:o}=r,s=e.ad(t*a/(i/1e3),-n,n),l=Math.abs(s)/(o*a);return{easing:r.easing,duration:1e3*l,amount:s*(l/2)}}class co extends e.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const a=f(i.getCanvasContainer(),r),o=i.unproject(a);super(t,e.e({point:a,lngLat:o,originalEvent:r},n)),this._defaultPrevented=!1,this.target=i}}class ho extends e.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,i,r){const n="touchend"===t?r.changedTouches:r.touches,a=m(i.getCanvasContainer(),n),o=a.map((e=>i.unproject(e))),s=a.reduce(((e,t,i,r)=>e.add(t.div(r.length))),new e.P(0,0));super(t,{points:a,point:s,lngLats:o,lngLat:i.unproject(s),originalEvent:r}),this._defaultPrevented=!1}}class uo extends e.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,i){super(e,{originalEvent:i}),this._defaultPrevented=!1}}class po{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new uo(e.type,this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new co(e.type,this._map,e))}mouseup(e){this._map.fire(new co(e.type,this._map,e))}preclick(t){const i=e.e({},t);i.type="preclick",this._map.fire(new co(i.type,this._map,i))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new co(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new co(e.type,this._map,e))}mouseover(e){this._map.fire(new co(e.type,this._map,e))}mouseout(e){this._map.fire(new co(e.type,this._map,e))}touchstart(e){return this._firePreventable(new ho(e.type,this._map,e))}touchmove(e){this._map.fire(new ho(e.type,this._map,e))}touchend(e){this._map.fire(new ho(e.type,this._map,e))}touchcancel(e){this._map.fire(new ho(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fo{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new co(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new co("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new co(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class mo{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(h(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const i=t,r=this._startPos,n=this._lastPos;if(!r||!n||n.equals(i)||!this._box&&i.dist(r)<this._clickTolerance)return;this._lastPos=i,this._box||(this._box=a("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const o=Math.min(r.x,i.x),s=Math.max(r.x,i.x),l=Math.min(r.y,i.y),c=Math.max(r.y,i.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform="translate(".concat(o,"px,").concat(l,"px)"),this._box.style.width=s-o+"px",this._box.style.height=c-l+"px")}))}mouseupWindow(t,i){if(!this._active)return;const r=this._startPos,n=i;if(r&&0===t.button){if(this.reset(),p(),r.x!==n.x||r.y!==n.y)return this._map.fire(new e.b("boxzoomend",{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(r,n,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),u(),delete this._startPos,delete this._lastPos}_fireEvent(t,i){return this._map.fire(new e.b(t,{originalEvent:i}))}}function go(e,t){const i={};for(let r=0;r<e.length;r++)i[e[r].identifier]=t[r];return i}class _o{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,i,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),r.length===this.numTouches&&(this.centroid=function(t){const i=new e.P(0,0);for(const e of t)i._add(e);return i.div(t.length)}(i),this.touches=go(r,i)))}touchmove(e,t,i){if(this.aborted||!this.centroid)return;const r=go(i,t);for(const n in this.touches){const e=r[n];(!e||e.dist(this.touches[n])>30)&&(this.aborted=!0)}}touchend(e,t,i){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===i.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class yo{constructor(e){this.singleTap=new _o(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,t,i){this.singleTap.touchstart(e,t,i)}touchmove(e,t,i){this.singleTap.touchmove(e,t,i)}touchend(e,t,i){const r=this.singleTap.touchend(e,t,i);if(r){const t=e.timeStamp-this.lastTime<500,i=!this.lastTap||this.lastTap.dist(r)<30;if(t&&i||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class vo{constructor(){this._zoomIn=new yo({numTouches:1,numTaps:2}),this._zoomOut=new yo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,i){this._zoomIn.touchstart(e,t,i),this._zoomOut.touchstart(e,t,i)}touchmove(e,t,i){this._zoomIn.touchmove(e,t,i),this._zoomOut.touchmove(e,t,i)}touchend(e,t,i){const r=this._zoomIn.touchend(e,t,i),n=this._zoomOut.touchend(e,t,i);return r?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(r)},{originalEvent:e})}):n?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(n)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const xo={0:1,2:2};class bo{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const i=g(e);this._correctButton(e,i)&&(this._lastPoint=t,this._eventButton=i)}mousemoveWindow(e,t){const i=this._lastPoint;if(i)if(e.preventDefault(),null!=this._eventButton&&function(e,t){const i=xo[t];return void 0===e.buttons||(e.buttons&i)!==i}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(i,t)}mouseupWindow(e){this._lastPoint&&g(e)===this._eventButton&&(this._moved&&p(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wo extends bo{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class So extends bo{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=.8*(t.x-e.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(e){e.preventDefault()}}class To extends bo{_correctButton(e,t){return 0===t&&e.ctrlKey||2===t}_move(e,t){const i=-.5*(t.y-e.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(e){e.preventDefault()}}class Eo{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset(),e.a$(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new e.P(0,0)}touchstart(e,t,i){return this._calculateTransform(e,t,i)}touchmove(t,i,r){if(this._active&&!(r.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===r.length&&!e.d7())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,i,r)}}touchend(e,t,i){this._calculateTransform(e,t,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,i,r){r.length>0&&(this._active=!0);const n=go(r,i),a=new e.P(0,0),o=new e.P(0,0);let s=0;for(const e in n){const t=n[e],i=this._touches[e];i&&(a._add(t),o._add(t.sub(i)),s++,n[e]=t)}if(this._touches=n,s<this._minTouches||!o.mag())return;const l=o.div(s);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:a.div(s),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=a("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize="".concat(Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth))),"px"))}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class Mo{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,t,i){return{}}touchstart(e,t,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,i){const r=this._firstTwoTouches;if(!r)return;e.preventDefault();const[n,a]=r,o=Ao(i,t,n),s=Ao(i,t,a);if(!o||!s)return;const l=this._aroundCenter?null:o.add(s).div(2);return this._move([o,s],l,e)}touchend(e,t,i){if(!this._firstTwoTouches)return;const[r,n]=this._firstTwoTouches,a=Ao(i,t,r),o=Ao(i,t,n);a&&o||(this._active&&p(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ao(e,t,i){for(let r=0;r<e.length;r++)if(e[r].identifier===i)return t[r]}function Po(e,t){return Math.log(e/t)/Math.LN2}class Co extends Mo{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const i=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Po(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Po(this._distance,i),pinchAround:t}}}function Io(e,t){return 180*e.angleWith(t)/Math.PI}class ko extends Mo{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const i=this._vector;if(this._vector=e[0].sub(e[1]),i&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Io(this._vector,i),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,i=this._startVector;if(!i)return!1;const r=Io(e,i);return Math.abs(r)<t}}function Do(e){return Math.abs(e.y)>Math.abs(e.x)}class Ro extends Mo{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,Do(e[0].sub(e[1]))&&(this._valid=!1)}_move(t,i,r){const n=this._lastPoints;if(!n)return;const a=t[0].sub(n[0]),o=t[1].sub(n[1]);return this._map._cooperativeGestures&&!e.d7()&&r.touches.length<3||(this._valid=this.gestureBeginsVertically(a,o,r.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(a.y+o.y)/2*-.5})}gestureBeginsVertically(e,t,i){if(void 0!==this._valid)return this._valid;const r=e.mag()>=2,n=t.mag()>=2;if(!r&&!n)return;if(!r||!n)return null==this._firstMove&&(this._firstMove=i),i-this._firstMove<100&&void 0;const a=e.y>0==t.y>0;return Do(e)&&Do(t)&&a}}const Lo={panStep:100,bearingStep:15,pitchStep:10};class zo{constructor(){const e=Lo;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,i=0,r=0,n=0,a=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?i=-1:(e.preventDefault(),n=-1);break;case 39:e.shiftKey?i=1:(e.preventDefault(),n=1);break;case 38:e.shiftKey?r=1:(e.preventDefault(),a=-1);break;case 40:e.shiftKey?r=-1:(e.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(i=0,r=0),{cameraAnimation:o=>{const s=o.getZoom();o.easeTo({duration:300,easeId:"keyboardHandler",easing:Fo,zoom:t?Math.round(s)+t*(e.shiftKey?2:1):s,bearing:o.getBearing()+i*this._bearingStep,pitch:o.getPitch()+r*this._pitchStep,offset:[-n*this._panStep,-a*this._panStep],center:o.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Fo(e){return e*(2-e)}const Oo=4.000244140625,Bo=1/450;class No{constructor(t,i){this._map=t,this._el=t.getCanvasContainer(),this._handler=i,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Bo,e.a$(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||e.d7()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let i=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const r=e.f.now(),n=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==i&&i%Oo==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":n>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(n*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),t.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=t,this._delta-=i,this._active||this._start(t)),t.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=f(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._map.transform;"wheel"===this._type&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const i=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>Oo?this._wheelZoomRate:this._defaultZoomRate;let r=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==r&&(r=1/r);const n=i(),a=Math.pow(2,n),o="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):a;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(o*r))),"wheel"===this._type&&(this._startZoom=n,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const r="number"==typeof this._targetZoom?this._targetZoom:i(),n=this._startZoom,a=this._easing;let o,s=!1;if("wheel"===this._type&&n&&a){const t=Math.min((e.f.now()-this._lastWheelEventTime)/200,1),i=a(t);o=e.X(n,r,i),t<1?this._frameId||(this._frameId=!0):s=!0}else o=r,s=!0;this._active=!0,s&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let l=o-i();return l*this._lastDelta<0&&(l=0),{noInertia:!0,needsRenderFrame:!s,zoomDelta:l,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let i=e.d8;if(this._prevEase){const t=this._prevEase,r=(e.f.now()-t.start)/t.duration,n=t.easing(r+.01)-t.easing(r),a=.27/Math.sqrt(n*n+1e-4)*.01,o=Math.sqrt(.0729-a*a);i=e.d6(a,o,.25,1)}return this._prevEase={start:e.f.now(),duration:t,easing:i},i}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=a("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize="".concat(Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth))),"px"))}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class Vo{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class jo{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,t){return e.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(e.shiftKey?-1:1),around:i.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uo{constructor(){this._tap=new yo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,t,i){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=t[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(e,t,i))}touchmove(e,t,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;const r=t[0],n=r.y-this._swipePoint.y;return this._swipePoint=r,e.preventDefault(),this._active=!0,{zoomDelta:n/128}}}else this._tap.touchmove(e,t,i)}touchend(e,t,i){this._tapTime?this._swipePoint&&0===i.length&&this.reset():this._tap.touchend(e,t,i)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Go{constructor(e,t,i){this._el=e,this._mousePan=t,this._touchPan=i}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class qo{constructor(e,t,i){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ho{constructor(e,t,i,r){this._el=e,this._touchZoom=t,this._touchRotate=i,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Wo=e=>e.zoom||e.drag||e.pitch||e.rotate;class Zo extends e.b{}class Qo{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,i){const r=e.Q.sub([],i,t);this.radius=e.Q.length(r[2]<0?e.Q.div([],r,this.constants):[r[0],r[1],0])}projectRay(t){e.Q.div(t,t,this.constants),e.Q.normalize(t,t),e.Q.mul(t,t,this.constants);const i=e.Q.scale([],t,this.radius);if(i[2]>0){const t=e.Q.scale([],[0,0,1],e.Q.dot(i,[0,0,1])),r=e.Q.scale([],e.Q.normalize([],[i[0],i[1],0]),this.radius),n=e.Q.add([],i,e.Q.scale([],e.Q.sub([],e.Q.add([],r,t),i),2));i[0]=n[0],i[1]=n[1]}return i}}function Xo(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class Yo{constructor(t,i){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new oo(t),this._bearingSnap=i.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Qo,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(i),e.a$(["handleEvent","handleWindowEvent"],this);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[window,"blur",void 0]];for(const[e,n,a]of this._listeners){const t=e===document?this.handleWindowEvent:this.handleEvent;e.addEventListener(n,t,a)}}destroy(){for(const[e,t,i]of this._listeners){const r=e===document?this.handleWindowEvent:this.handleEvent;e.removeEventListener(t,r,i)}}_addDefaultHandlers(e){const t=this._map,i=t.getCanvasContainer();this._add("mapEvent",new po(t,e));const r=t.boxZoom=new mo(t,e);this._add("boxZoom",r);const n=new vo,a=new jo;t.doubleClickZoom=new Vo(a,n),this._add("tapZoom",n),this._add("clickZoom",a);const o=new Uo;this._add("tapDragZoom",o);const s=t.touchPitch=new Ro(t);this._add("touchPitch",s);const l=new So(e),c=new To(e);t.dragRotate=new qo(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const h=new wo(e),u=new Eo(t,e);t.dragPan=new Go(i,h,u),this._add("mousePan",h),this._add("touchPan",u,["touchZoom","touchRotate"]);const d=new ko,p=new Co;t.touchZoomRotate=new Ho(i,p,d,o),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new fo(t));const f=t.scrollZoom=new No(t,this);this._add("scrollZoom",f,["mousePan"]);const m=t.keyboard=new zo;this._add("keyboard",m);for(const g of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[g]&&t[g].enable(e[g])}_add(e,t,i){this._handlers.push({handlerName:e,handler:t,allowed:i}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Wo(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,t,i){for(const r in e)if(r!==i&&(!t||t.indexOf(r)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,"".concat(e.type,"Window"))}_getMapTouches(e){const t=[];for(const i of e)this._el.contains(i.target)&&t.push(i);return t}handleEvent(e,t){this._updatingCamera=!0;const i="renderFrame"===e.type,r=i?void 0:e,n={needsRenderFrame:!1},a={},o={},s=e.touches?this._getMapTouches(e.touches):void 0,l=s?m(this._el,s):i?void 0:f(this._el,e);for(const{handlerName:u,handler:d,allowed:p}of this._handlers){if(!d.isEnabled())continue;let i;this._blockedByActive(o,p,u)?d.reset():d[t||e.type]&&(i=d[t||e.type](e,l,s),this.mergeHandlerResult(n,a,i,u,r),i&&i.needsRenderFrame&&this._triggerRenderFrame()),(i||d.isActive())&&(o[u]=d)}const c={};for(const u in this._previousActiveHandlers)o[u]||(c[u]=r);this._previousActiveHandlers=o,(Object.keys(c).length||Xo(n))&&(this._changes.push([n,a,c]),this._triggerRenderFrame()),(Object.keys(o).length||Xo(n))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:h}=n;h&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],h(this._map))}mergeHandlerResult(t,i,r,n,a){if(!r)return;e.e(t,r);const o={handlerName:n,originalEvent:r.originalEvent||a};void 0!==r.zoomDelta&&(i.zoom=o),void 0!==r.panDelta&&(i.drag=o),void 0!==r.pitchDelta&&(i.pitch=o),void 0!==r.bearingDelta&&(i.rotate=o)}_applyChanges(){const t={},i={},r={};for(const[n,a,o]of this._changes)n.panDelta&&(t.panDelta=(t.panDelta||new e.P(0,0))._add(n.panDelta)),n.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+n.zoomDelta),n.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+n.bearingDelta),n.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+n.pitchDelta),void 0!==n.around&&(t.around=n.around),void 0!==n.aroundCoord&&(t.aroundCoord=n.aroundCoord),void 0!==n.pinchAround&&(t.pinchAround=n.pinchAround),n.noInertia&&(t.noInertia=n.noInertia),e.e(i,a),e.e(r,o);this._updateMapTransform(t,i,r),this._changes=[]}_updateMapTransform(t,i,r){const n=this._map,a=n.transform,o=e=>[e.x,e.y,e.z];if((e=>{const t=this._eventsInProgress.drag;return t&&!this._handlersById[t.handlerName].isActive()})()&&!Xo(t)){const e=a.zoom;a.cameraElevationReference="sea",null!=this._originalZoom&&a._orthographicProjectionAtLowPitch&&"globe"!==a.projection.name&&0===a.pitch?(a.cameraElevationReference="ground",a.zoom=this._originalZoom):(a.recenterOnTerrain(),a.cameraElevationReference="ground"),e!==a.zoom&&this._map._update(!0)}if(a._isCameraConstrained&&n._stop(!0),!Xo(t))return void this._fireEvents(i,r,!0);let{panDelta:s,zoomDelta:l,bearingDelta:c,pitchDelta:h,around:u,aroundCoord:d,pinchAround:p}=t;a._isCameraConstrained&&(l>0&&(l=0),a._isCameraConstrained=!1),void 0!==p&&(u=p),(l||(e=>i[e]&&!this._eventsInProgress[e])("drag"))&&u&&(this._dragOrigin=o(a.pointCoordinate3D(u)),this._originalZoom=a.zoom,this._trackingEllipsoid.setup(a._camera.position,this._dragOrigin)),a.cameraElevationReference="sea",n._stop(!0),u=u||n.transform.centerPoint,c&&(a.bearing+=c),h&&(a.pitch+=h),a._updateCameraState();const f=[0,0,0];if(s)if("mercator"===a.projection.name){const e=this._trackingEllipsoid.projectRay(a.screenPointToMercatorRay(u).dir),t=this._trackingEllipsoid.projectRay(a.screenPointToMercatorRay(u.sub(s)).dir);f[0]=t[0]-e[0],f[1]=t[1]-e[1]}else{const t=a.pointCoordinate(u);if("globe"===a.projection.name){s=s.rotate(-a.angle);const i=a._pixelsPerMercatorPixel/a.worldSize;f[0]=-s.x*e.d9(e.ax(t.y))*i,f[1]=-s.y*e.d9(a.center.lat)*i}else{const e=a.pointCoordinate(u.sub(s));t&&e&&(f[0]=e.x-t.x,f[1]=e.y-t.y)}}const m=a.zoom,g=[0,0,0];if(l){const t=o(d||a.pointCoordinate3D(u)),i={dir:e.Q.normalize([],e.Q.sub([],t,a._camera.position))};if(i.dir[2]<0){const r=a.zoomDeltaToMovement(t,l);e.Q.scale(g,i.dir,r)}}const _=e.Q.add(f,f,g);a._translateCameraConstrained(_),l&&Math.abs(a.zoom-m)>1e-4&&a.recenterOnTerrain(),a.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(i,r,!0)}_fireEvents(t,i,r){const n=Wo(this._eventsInProgress),a=Wo(t),o={};for(const e in t){const{originalEvent:i}=t[e];this._eventsInProgress[e]||(o["".concat(e,"start")]=i),this._eventsInProgress[e]=t[e]}!n&&a&&this._fireEvent("movestart",a.originalEvent);for(const e in o)this._fireEvent(e,o[e]);a&&this._fireEvent("move",a.originalEvent);for(const e in t){const{originalEvent:i}=t[e];this._fireEvent(e,i)}const s={};let l;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:r}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],l=i[t]||r,s["".concat(e,"end")]=l)}for(const e in s)this._fireEvent(e,s[e]);const c=Wo(this._eventsInProgress);if(r&&(n||a)&&!c){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),i=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;t?(i(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:l})):(this._map.fire(new e.b("moveend",{originalEvent:l})),i(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,i){this._map.fire(new e.b(t,i?{originalEvent:i}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{this._frameId=void 0,this.handleEvent(new Zo("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Jo="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ko extends e.E{constructor(t,i){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=i.bearingSnap,this._respectPrefersReducedMotion=!1!==i.respectPrefersReducedMotion,e.a$(["_renderFrameCallback"],this)}getCenter(){return new e.bq(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,i,r){return t=e.P.convert(t).mult(-1),this.panTo(this.transform.center,e.e({offset:t},i),r)}panTo(t,i,r){return this.easeTo(e.e({center:t},i),r)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(t,i,r){return this.easeTo(e.e({zoom:t},i),r)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(t,i,r){return this.easeTo(e.e({bearing:t},i),r)}resetNorth(t,i){return this.rotateTo(0,e.e({duration:1e3},t),i),this}resetNorthPitch(t,i){return this.easeTo(e.e({bearing:0,pitch:0,duration:1e3},t),i),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(t,i){t=e.ag.convert(t);const r=i&&i.bearing||0,n=i&&i.pitch||0,a=t.getNorthWest(),o=t.getSouthEast();return this._cameraForBounds(this.transform,a,o,r,n,i)}_extendPadding(t){const i={top:0,right:0,bottom:0,left:0};return null==t?e.e({},i,this.transform.padding):"number"==typeof t?{top:t,bottom:t,right:t,left:t}:e.e({},i,t)}_extendCameraOptions(t){return(t=e.e({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(e,t){const i=t.max[0]-t.min[0],r=t.max[1]-t.min[1];return i/r>e.aspect?i/(2*Math.tan(.5*e.fovX)*e.aspect):r/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(t,i,r,n,a,o){const s=t.clone(),l=this._extendCameraOptions(o);s.bearing=n,s.pitch=a;const c=e.bq.convert(i),h=e.bq.convert(r),u=.5*(c.lat+h.lat),d=.5*(c.lng+h.lng),p=e.da(u,d),f=e.Q.normalize([],p),m=e.Q.normalize([],e.Q.cross([],f,[0,1,0])),g=e.Q.cross([],m,f),_=[m[0],m[1],m[2],0,g[0],g[1],g[2],0,f[0],f[1],f[2],0,0,0,0,1],y=[p,e.da(c.lat,c.lng),e.da(h.lat,c.lng),e.da(h.lat,h.lng),e.da(c.lat,h.lng),e.da(u,c.lng),e.da(u,h.lng),e.da(c.lat,d),e.da(h.lat,d)];let v=e.bV.fromPoints(y.map((t=>[e.Q.dot(m,t),e.Q.dot(g,t),e.Q.dot(f,t)])));const x=e.Q.transformMat4([],v.center,_);0===e.Q.squaredLength(x)&&e.Q.set(x,0,0,1),e.Q.normalize(x,x),e.Q.scale(x,x,e.ae),s.center=e.db(x);const b=s.getWorldToCameraMatrix(),w=e.a9.invert(new Float64Array(16),b);v=e.bV.applyTransform(v,e.a9.multiply([],b,_));const S=this._extendAABB(v,s,l,n);if(!S)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");v=S,e.Q.transformMat4(x,x,b);const T=.5*(v.max[2]-v.min[2]),E=this._minimumAABBFrustumDistance(s,v),M=e.Q.scale([],[0,0,1],T),A=e.Q.add(M,x,M),P=E+(0===s.pitch?0:e.Q.distance(x,A)),C=s.globeCenterInViewSpace,I=e.Q.sub([],x,[C[0],C[1],C[2]]);e.Q.normalize(I,I),e.Q.scale(I,I,P);const k=e.Q.add([],x,I);e.Q.transformMat4(k,k,w);const D=e.dc/e.ae,R=e.Q.length(k),L=e.bo(Math.max(R*D-e.dc,Number.EPSILON),0),z=Math.min(s.zoomFromMercatorZAdjusted(L),l.maxZoom);return z>.5*(e.bJ+e.bA)?(s.setProjection({name:"mercator"}),s.zoom=z,this._cameraForBounds(s,i,r,n,a,o)):{center:s.center,zoom:z,bearing:n,pitch:a}}_extendAABB(t,i,r,n){const a=.5*((r.padding.left||0)+(r.padding.right||0)),o=.5*((r.padding.top||0)+(r.padding.bottom||0)),s=o,l=a,c=a,h=o,u=i.width-(l+c),d=i.height-(s+h),p=e.Q.sub([],t.max,t.min),f=Math.min(u/p[0],d/p[1]),m=Math.min(i.scaleZoom(i.scale*f),r.maxZoom);if(isNaN(m))return null;const g=i.scale/i.zoomScale(m),_=new e.bV([t.min[0]-l*g,t.min[1]-h*g,t.min[2]],[t.max[0]+c*g,t.max[1]+s*g,t.max[2]]),y=("number"==typeof r.offset.x&&"number"==typeof r.offset.y?new e.P(r.offset.x,r.offset.y):e.P.convert(r.offset)).rotate(-e.bm(n));return _.center[0]-=y.x*g,_.center[1]+=y.y*g,_}queryTerrainElevation(t,i){const r=this.transform.elevation;return r?(i=e.e({},{exaggerated:!0},i),r.getAtPoint(e.O.fromLngLat(t),null,i.exaggerated)):null}_cameraForBounds(t,i,r,n,a,o){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,i,r,n,a,o);const s=t.clone(),l=this._extendCameraOptions(o);s.bearing=n,s.pitch=a;const c=e.bq.convert(i),h=e.bq.convert(r),u=new e.bq(c.lng,h.lat),d=new e.bq(h.lng,c.lat),p=s.project(c),f=s.project(h),m=this.queryTerrainElevation(c),g=this.queryTerrainElevation(h),_=this.queryTerrainElevation(u),y=this.queryTerrainElevation(d),v=[[p.x,p.y,Math.min(m||0,g||0,_||0,y||0)],[f.x,f.y,Math.max(m||0,g||0,_||0,y||0)]];let x=e.bV.fromPoints(v);const b=s.getWorldToCameraMatrix(),w=e.a9.invert(new Float64Array(16),b);x=e.bV.applyTransform(x,b);const S=this._extendAABB(x,s,l,n);if(!S)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");x=S;const T=.5*e.Q.sub([],x.max,x.min)[2],E=this._minimumAABBFrustumDistance(s,x),M=[0,0,1,0];e.aa.transformMat4(M,M,b),e.aa.normalize(M,M);const A=e.Q.scale([],M,E+T),P=e.Q.add([],x.center,A);e.Q.transformMat4(x.center,x.center,w),e.Q.transformMat4(P,P,w);const C=[x.center[0],x.center[1],P[2]*s.pixelsPerMeter];e.Q.scale(C,C,1/s.worldSize);const I=e.aw(C[0]),k=e.ax(C[1]),D=Math.min(s._zoomFromMercatorZ(C[2]),l.maxZoom),R=new e.bq(I,k);return s.mercatorFromTransition&&D<.5*(e.bJ+e.bA)?(s.setProjection({name:"globe"}),s.zoom=D,this._cameraForBounds(s,i,r,n,a,o)):{center:R,zoom:D,bearing:n,pitch:a}}fitBounds(e,t,i){const r=this.cameraForBounds(e,t);return this._fitInternal(r,t,i)}fitScreenCoordinates(t,i,r,n,a){const o=e.P.convert(t),s=e.P.convert(i),l=new e.P(Math.min(o.x,s.x),Math.min(o.y,s.y)),c=new e.P(Math.max(o.x,s.x),Math.max(o.y,s.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(o,s))return this;const h=this.transform.pointLocation3D(l),u=this.transform.pointLocation3D(c),d=this.transform.pointLocation3D(new e.P(l.x,c.y)),p=this.transform.pointLocation3D(new e.P(c.x,l.y)),f=[Math.min(h.lng,u.lng,d.lng,p.lng),Math.min(h.lat,u.lat,d.lat,p.lat)],m=[Math.max(h.lng,u.lng,d.lng,p.lng),Math.max(h.lat,u.lat,d.lat,p.lat)],g=n&&n.pitch?n.pitch:this.getPitch(),_=this._cameraForBounds(this.transform,f,m,r,g,n);return this._fitInternal(_,n,a)}_fitInternal(t,i,r){return t?(i=e.e(t,i)).linear?this.easeTo(i,r):this.flyTo(i,r):this}jumpTo(t,i){this.stop();const r=t.preloadOnly?this.transform.clone():this.transform;let n=!1,a=!1,o=!1;return"zoom"in t&&r.zoom!==+t.zoom&&(n=!0,r.zoom=+t.zoom),void 0!==t.center&&(r.center=e.bq.convert(t.center)),"bearing"in t&&r.bearing!==+t.bearing&&(a=!0,r.bearing=+t.bearing),"pitch"in t&&r.pitch!==+t.pitch&&(o=!0,r.pitch=+t.pitch),null==t.padding||r.isPaddingEqual(t.padding)||(r.padding=t.padding),t.preloadOnly?(this._preloadTiles(r),this):(this.fire(new e.b("movestart",i)).fire(new e.b("move",i)),n&&this.fire(new e.b("zoomstart",i)).fire(new e.b("zoom",i)).fire(new e.b("zoomend",i)),a&&this.fire(new e.b("rotatestart",i)).fire(new e.b("rotate",i)).fire(new e.b("rotateend",i)),o&&this.fire(new e.b("pitchstart",i)).fire(new e.b("pitch",i)).fire(new e.b("pitchend",i)),this.fire(new e.b("moveend",i)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||e.w(Jo),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,i){const r=this.transform;if(!r.projection.supportsFreeCamera)return e.w(Jo),this;this.stop();const n=r.zoom,a=r.pitch,o=r.bearing;r.setFreeCameraOptions(t);const s=n!==r.zoom,l=a!==r.pitch,c=o!==r.bearing;return this.fire(new e.b("movestart",i)).fire(new e.b("move",i)),s&&this.fire(new e.b("zoomstart",i)).fire(new e.b("zoom",i)).fire(new e.b("zoomend",i)),c&&this.fire(new e.b("rotatestart",i)).fire(new e.b("rotate",i)).fire(new e.b("rotateend",i)),l&&this.fire(new e.b("pitchstart",i)).fire(new e.b("pitch",i)).fire(new e.b("pitchend",i)),this.fire(new e.b("moveend",i)),this}easeTo(t,i){this._stop(!1,t.easeId),(!1===(t=e.e({offset:[0,0],duration:500,easing:e.d8},t)).animate||this._prefersReducedMotion(t))&&(t.duration=0);const r=this.transform,n=this.getZoom(),a=this.getBearing(),o=this.getPitch(),s=this.getPadding(),l="zoom"in t?+t.zoom:n,c="bearing"in t?this._normalizeBearing(t.bearing,a):a,h="pitch"in t?+t.pitch:o,u=this._extendPadding(t.padding),d=e.P.convert(t.offset);let p,f,m;if("globe"===r.projection.name){const i=e.O.fromLngLat(r.center),n=d.rotate(-r.angle);i.x+=n.x/r.worldSize,i.y+=n.y/r.worldSize;const a=i.toLngLat(),o=e.bq.convert(t.center||a);this._normalizeCenter(o),p=r.centerPoint.add(n),f=new e.P(i.x,i.y).mult(r.worldSize),m=new e.P(e.a8(o.lng),e.ah(o.lat)).mult(r.worldSize).sub(f)}else{p=r.centerPoint.add(d);const i=r.pointLocation(p),n=e.bq.convert(t.center||i);this._normalizeCenter(n),f=r.project(i),m=r.project(n).sub(f)}const g=r.zoomScale(l-n);let _,y;t.around&&(_=e.bq.convert(t.around),y=r.locationPoint(_));const v=this._zooming||l!==n,x=this._rotating||a!==c,b=this._pitching||h!==o,w=!r.isPaddingEqual(u),S=r=>S=>{if(v&&(r.zoom=e.X(n,l,S)),x&&(r.bearing=e.X(a,c,S)),b&&(r.pitch=e.X(o,h,S)),w&&(r.interpolatePadding(s,u,S),p=r.centerPoint.add(d)),_)r.setLocationAtPoint(_,y);else{const e=r.zoomScale(r.zoom-n),t=l>n?Math.min(2,g):Math.max(.5,g),i=Math.pow(t,1-S),a=r.unproject(f.add(m.mult(S*i)).mult(e));r.setLocationAtPoint(r.renderWorldCopies?a.wrap():a,p)}return t.preloadOnly||this._fireMoveEvents(i),r};if(t.preloadOnly){const e=this._emulate(S,t.duration,r);return this._preloadTiles(e),this}const T={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=v,this._rotating=x,this._pitching=b,this._padding=w,this._easeId=t.easeId,this._prepareEase(i,t.noMoveStart,T),this._ease(S(r),(e=>{"sea"===r.cameraElevationReference&&r.recenterOnTerrain(),this._afterEase(i,e)}),t),this}_prepareEase(t,i){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),i||r.moving||this.fire(new e.b("movestart",t)),this._zooming&&!r.zooming&&this.fire(new e.b("zoomstart",t)),this._rotating&&!r.rotating&&this.fire(new e.b("rotatestart",t)),this._pitching&&!r.pitching&&this.fire(new e.b("pitchstart",t))}_fireMoveEvents(t){this.fire(new e.b("move",t)),this._zooming&&this.fire(new e.b("zoom",t)),this._rotating&&this.fire(new e.b("rotate",t)),this._pitching&&this.fire(new e.b("pitch",t))}_afterEase(t,i){if(this._easeId&&i&&this._easeId===i)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const r=this._zooming,n=this._rotating,a=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new e.b("zoomend",t)),n&&this.fire(new e.b("rotateend",t)),a&&this.fire(new e.b("pitchend",t)),this.fire(new e.b("moveend",t))}flyTo(t,i){if(this._prefersReducedMotion(t)){const r=e.af(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,i)}this.stop(),t=e.e({offset:[0,0],speed:1.2,curve:1.42,easing:e.d8},t);const r=this.transform,n=this.getZoom(),a=this.getBearing(),o=this.getPitch(),s=this.getPadding(),l="zoom"in t?e.ad(+t.zoom,r.minZoom,r.maxZoom):n,c="bearing"in t?this._normalizeBearing(t.bearing,a):a,h="pitch"in t?+t.pitch:o,u=this._extendPadding(t.padding),d=r.zoomScale(l-n),p=e.P.convert(t.offset);let f=r.centerPoint.add(p);const m=r.pointLocation(f),g=e.bq.convert(t.center||m);this._normalizeCenter(g);const _=r.project(m),y=r.project(g).sub(_);let v=t.curve;const x=Math.max(r.width,r.height),b=x/d,w=y.mag();if("minZoom"in t){const i=e.ad(Math.min(t.minZoom,n,l),r.minZoom,r.maxZoom),a=x/r.zoomScale(i-n);v=Math.sqrt(a/w*2)}const S=v*v;function T(e){const t=(b*b-x*x+(e?-1:1)*S*S*w*w)/(2*(e?b:x)*S*w);return Math.log(Math.sqrt(t*t+1)-t)}function E(e){return(Math.exp(e)-Math.exp(-e))/2}function M(e){return(Math.exp(e)+Math.exp(-e))/2}const A=T(0);let P=function(e){return M(A)/M(A+v*e)},C=function(e){return x*((M(A)*(E(t=A+v*e)/M(t))-E(A))/S)/w;var t},I=(T(1)-A)/v;if(Math.abs(w)<1e-6||!isFinite(I)){if(Math.abs(x-b)<1e-6)return this.easeTo(t,i);const e=b<x?-1:1;I=Math.abs(Math.log(b/x))/v,C=function(){return 0},P=function(t){return Math.exp(e*v*t)}}t.duration="duration"in t?+t.duration:1e3*I/("screenSpeed"in t?+t.screenSpeed/v:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const k=a!==c,D=h!==o,R=!r.isPaddingEqual(u),L=r=>d=>{const m=d*I,v=1/P(m);r.zoom=1===d?l:n+r.scaleZoom(v),k&&(r.bearing=e.X(a,c,d)),D&&(r.pitch=e.X(o,h,d)),R&&(r.interpolatePadding(s,u,d),f=r.centerPoint.add(p));const x=1===d?g:r.unproject(_.add(y.mult(C(m))).mult(v));return r.setLocationAtPoint(r.renderWorldCopies?x.wrap():x,f),r._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(i),r};if(t.preloadOnly){const e=this._emulate(L,t.duration,r);return this._preloadTiles(e),this}return this._zooming=!0,this._rotating=k,this._pitching=D,this._padding=R,this._prepareEase(i,!1),this._ease(L(r),(()=>this._afterEase(i)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(e){}_cancelRenderFrame(e){}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(t,i,r){!1===r.animate||0===r.duration?(t(1),i()):(this._easeStart=e.f.now(),this._easeOptions=r,this._onEaseFrame=t,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((e.f.now()-this._easeStart)/this._easeOptions.duration,1),i=this._onEaseFrame;i&&i(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,i){t=e.bk(t,-180,180);const r=Math.abs(t-i);return Math.abs(t-360-i)<r&&(t-=360),Math.abs(t+360-i)<r&&(t+=360),t}_normalizeCenter(e){const t=this.transform;if(t.maxBounds)return;if("globe"!==t.projection.name&&!t.renderWorldCopies)return;const i=e.lng-t.center.lng;e.lng+=i>180?-360:i<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&e.f.prefersReducedMotion&&!(t&&t.essential)}_emulate(e,t,i){const r=Math.ceil(15*t/1e3),n=[],a=e(i.clone());for(let o=0;o<=r;o++){const e=a(o/r);n.push(e.clone())}return n}_preloadTiles(e,t){}}class $o{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=t,e.a$(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact;return this._map=e,this._container=a("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=a("button","mapboxgl-ctrl-attrib-button",this._container),a("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=a("div","mapboxgl-ctrl-attrib-inner",this._container),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,t){const i=this._map._getUIString("AttributionControl.".concat(t));e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const i=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.dd.ACCESS_TOKEN}];if(t){const r=i.reduce(((e,t,r)=>(t.value&&(e+="".concat(t.key,"=").concat(t.value).concat(r<i.length-1?"&":"")),e)),"?");t.href="".concat(e.dd.FEEDBACK_URL,"/").concat(r,"#").concat(eo(this._map,!0)),t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._mergedSourceCaches;for(const r in t){const i=t[r];if(i.used){const t=i.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort(((e,t)=>e.length-t.length)),e=e.filter(((t,i)=>{for(let r=i+1;r<e.length;r++)if(e[r].indexOf(t)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const i=e.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,e.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class es{constructor(){e.a$(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=a("div","mapboxgl-ctrl");const t=a("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const i=e[t].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class ts{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,i=t?this._queue.concat(t):this._queue;for(const r of i)if(r.id===e)return void(r.cancelled=!0)}run(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=this._currentlyRunning=this._queue;this._queue=[];for(const i of t)if(!i.cancelled&&(i.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function is(t,i,r){if(t=new e.bq(t.lng,t.lat),i){const n=new e.bq(t.lng-360,t.lat),a=new e.bq(t.lng+360,t.lat),o=360*Math.ceil(Math.abs(t.lng-r.center.lng)/360),s=r.locationPoint(t).distSqr(i),l=i.x<0||i.y<0||i.x>r.width||i.y>r.height;r.locationPoint(n).distSqr(i)<s&&(l||Math.abs(n.lng-r.center.lng)<o)?t=n:r.locationPoint(a).distSqr(i)<s&&(l||Math.abs(a.lng-r.center.lng)<o)&&(t=a)}for(;Math.abs(t.lng-r.center.lng)>180;){const e=r.locationPoint(t);if(e.x>=0&&e.y>=0&&e.x<=r.width&&e.y<=r.height)break;t.lng>r.center.lng?t.lng-=360:t.lng+=360}return t}const rs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ns extends e.E{constructor(t,i){if(super(),(t instanceof HTMLElement||i)&&(t=e.e({element:t},i)),e.a$(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=t&&t.occludedOpacity||.2,t&&t.element)this._element=t.element,this._offset=e.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=a("div");const i=41,r=27,n=o("svg",{display:"block",height:i*this._scale+"px",width:r*this._scale+"px",viewBox:"0 0 ".concat(r," ").concat(i)},this._element),s=o("radialGradient",{id:"shadowGradient"},o("defs",{},n));o("stop",{offset:"10%","stop-opacity":.4},s),o("stop",{offset:"100%","stop-opacity":.05},s),o("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},n),o("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},n),o("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},n),o("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},n),this._offset=e.P.convert(t&&t.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(e=>{e.preventDefault()})),this._element.addEventListener("mousedown",(e=>{e.preventDefault()}));const r=this._element.classList;for(const e in rs)r.remove("mapboxgl-marker-anchor-".concat(e));r.add("mapboxgl-marker-anchor-".concat(this._anchor));const n=t&&t.className?t.className.trim().split(/\s+/):[];r.add(...n),this._popup=null}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.bq.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,i=13.5,r=Math.sqrt(Math.pow(i,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[r,-1*(t-i+r)],"bottom-right":[-r,-1*(t-i+r)],left:[i,-1*(t-i)],right:[-i,-1*(t-i)]}:this._offset}this._popup=e,e._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const t=e.code,i=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==i&&13!==i||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,i=this._element;this._popup&&(t===i||i.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,t=this._pos;if(!e||!t)return!1;const i=e.unproject(t),r=e.getFreeCameraOptions();if(!r.position)return!1;const n=r.position.toLngLat();return n.distanceTo(i)<.9*n.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const i=this._pos;if(!i||i.x<0||i.x>t.transform.width||i.y<0||i.y>t.transform.height)return void this._clearFadeTimer();const r=t.unproject(i);let n;t._showingGlobe()&&e.de(t.transform,this._lngLat)?n=0:(n=1-t._queryFogOpacity(r),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(n*=this._occludedOpacity)),this._element.style.opacity="".concat(n),this._element.style.pointerEvents=n>0?"auto":"none",this._popup&&this._popup._setOpacity(n),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const t=this._offset.mult(this._scale);this._element.style.transform="\n            translate(".concat(e.x,"px,").concat(e.y,"px)\n            ").concat(rs[this._anchor],"\n            ").concat(this._calculateXYTransform()," ").concat(this._calculateZTransform(),"\n            translate(").concat(t.x,"px,").concat(t.y,"px)\n        ")}_calculateXYTransform(){const t=this._pos,i=this._map,r=this.getPitchAlignment();if(!i||!t||"map"!==r)return"";if(!i._showingGlobe()){const e=i.getPitch();return e?"rotateX(".concat(e,"deg)"):""}const n=e.bI(e.df(i.transform,this._lngLat)),a=t.sub(e.dg(i.transform)),o=Math.abs(a.x)+Math.abs(a.y);if(0===o)return"";const s=n/o;return"rotateX(".concat(-a.y*s,"deg) rotateY(").concat(a.x*s,"deg)")}_calculateZTransform(){const t=this._pos,i=this._map;if(!i||!t)return"";let r=0;const n=this.getRotationAlignment();if("map"===n)if(i._showingGlobe()){const t=i.project(new e.bq(this._lngLat.lng,this._lngLat.lat+.001)),n=i.project(new e.bq(this._lngLat.lng,this._lngLat.lat-.001)).sub(t);r=e.bI(Math.atan2(n.y,n.x))-90}else r=-i.getBearing();else if("horizon"===n){const n=e.S(4,6,i.getZoom()),a=e.dg(i.transform);a.y+=n*i.transform.height;const o=t.sub(a),s=e.bI(Math.atan2(o.y,o.x));r=(s>90?s-270:s+90)*(1-n)}return r+=this._rotation,r?"rotateZ(".concat(r,"deg)"):""}_update(e){cancelAnimationFrame(this._updateFrameId);const t=this._map;t&&(t.transform.renderWorldCopies&&(this._lngLat=is(this._lngLat,this._pos,t.transform)),this._pos=t.project(this._lngLat),!0===e?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),t._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(t._showingGlobe()||t.getTerrain()||t.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=e.P.convert(t),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(t){const i=this._map;if(!i)return;const r=this._pointerdownPos,n=this._positionDelta;if(r&&n){if(!this._isDragging){const e=this._clickTolerance||i._clickTolerance;if(t.point.dist(r)<e)return;this._isDragging=!0}this._pos=t.point.sub(n),this._lngLat=i.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.b("dragstart"))),this.fire(new e.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new e.b("dragend")),this._state="inactive"}_addDragHandler(e){const t=this._map,i=this._pos;t&&i&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(i),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const as={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},os=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ss(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e.P(0,0),i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom";if("number"==typeof t){const r=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(i){case"top":return new e.P(0,t);case"top-left":return new e.P(r,r);case"top-right":return new e.P(-r,r);case"bottom":return new e.P(0,-t);case"bottom-left":return new e.P(r,-r);case"bottom-right":return new e.P(-r,-r);case"left":return new e.P(t,0);case"right":return new e.P(-t,0)}return new e.P(0,0)}return t instanceof e.P||Array.isArray(t)?e.P.convert(t):e.P.convert(t[i]||[0,0])}class ls{constructor(e){this.jumpTo(e)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const i=e.ch((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-i)+this._end*i}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,i){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+i}}class cs{registerParameter(e,t,i,r,n){}registerButton(e,t,i){}registerBinding(e,t,i,r){}refreshUI(){}}const hs={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},us={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},ds={showCompass:!0,showZoom:!0,visualizePitch:!1};class ps{constructor(t,i){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._clickTolerance=10,this.element=i,this.mouseRotate=new So({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,r&&(this.mousePitch=new To({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.a$(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),i.addEventListener("mousedown",this.mousedown),i.addEventListener("touchstart",this.touchstart,{passive:!1}),i.addEventListener("touchmove",this.touchmove),i.addEventListener("touchend",this.touchend),i.addEventListener("touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),h()}move(e,t){const i=this.map,r=this.mouseRotate.mousemoveWindow(e,t),n=r&&r.bearingDelta;if(n&&i.setBearing(i.getBearing()+n),this.mousePitch){const r=this.mousePitch.mousemoveWindow(e,t),n=r&&r.pitchDelta;n&&i.setPitch(i.getPitch()+n)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){u(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(e.e({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),f(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,f(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=m(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=m(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const fs={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ms={maxWidth:100,unit:"metric"},gs={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},_s={version:e.du,supported:i,setRTLTextPlugin:e.dw,getRTLTextPluginStatus:e.dx,Map:class extends Ko{constructor(t){const i=t;if(null!=(t=e.e({},us,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&e.dh(window)&&(t.antialias=!1,e.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new pr(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t),this._repaint=!!t.repaint,this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._collectResourceTiming=t.collectResourceTiming,this._language=this._parseLanguage(t.language),this._worldview=t.worldview,this._renderTaskQueue=new ts,this._domRenderTaskQueue=new ts,this._controls=[],this._markers=[],this._popups=[],this._mapId=e.aF(),this._locale=e.e({},hs,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._performanceMetricsCollection=t.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ls(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new e.di(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,this._contextCreateOptions=t.contextCreateOptions?{...t.contextCreateOptions}:{},"string"==typeof t.container){const e=document.getElementById(t.container);if(!e)throw new Error("Container '".concat(t.container.toString(),"' not found."));this._container=e}else{if(!(t.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&e.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),e.a$(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp=t.devtools?new cs(this):new cs,this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},(()=>{this._update()})),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Yo(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,(t.style||!t.testMode)&&this.setStyle(t.style||e.dd.DEFAULT_STYLE,{config:t.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),t.hash&&(this._hash=new $a("string"==typeof t.hash&&t.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==i.center&&null==i.zoom||(this.transform._unmodified=!1),this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch});const r=t.bounds;r&&(this.resize(),this.fitBounds(r,e.e({},t.fitBoundsOptions,{duration:0})))}this.resize(),t.attributionControl&&this.addControl(new $o({customAttribution:t.customAttribution})),this._logoControl=new es,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()})),this.on("data",(t=>{this._update("style"===t.dataType),this.fire(new e.b("".concat(t.dataType,"data"),t))})),this.on("dataloading",(t=>{this.fire(new e.b("".concat(t.dataType,"dataloading"),t))}))}_getMapId(){return this._mapId}addControl(t,i){if(void 0===i&&(i=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=t.onAdd(this);this._controls.push(t);const n=this._controlPositions[i];return-1!==i.indexOf("bottom")?n.insertBefore(r,n.firstChild):n.appendChild(r),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(t);return i>-1&&this._controls.splice(i,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new e.b("movestart",t)).fire(new e.b("move",t)),this.fire(new e.b("resize",t)),i&&this.fire(new e.b("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(e.ag.convert(t)),this._update()}setMinZoom(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new e.b("zoomstart")).fire(new e.b("zoom")).fire(new e.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new e.b("zoomstart")).fire(new e.b("zoom")).fire(new e.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new e.b("pitchstart")).fire(new e.b("pitch")).fire(new e.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null==t?85:t)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new e.b("pitchstart")).fire(new e.b("pitch")).fire(new e.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return"auto"===e?navigator.language:Array.isArray(e)?0===e.length?void 0:e.map((e=>"auto"===e?navigator.language:e)):e}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const i of this._controls)i._setLanguage&&i._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const t=this.transform,i=t.projection.name;let r;"globe"===i&&t.zoom>=e.bA?(t.setMercatorFromTransition(),r=!0):"mercator"===i&&t.zoom<e.bA&&(t.setProjection({name:"globe"}),r=!0),r&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(t){let i;return i="globe"===t.name&&this.transform.zoom>=e.bA?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(t){return this.transform.locationPoint3D(e.bq.convert(t))}unproject(t){return this.transform.pointLocation3D(e.P.convert(t))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,i){if("mouseenter"===e||"mouseover"===e){let r=!1;const n=n=>{const a=t.filter((e=>this.getLayer(e))),o=a.length?this.queryRenderedFeatures(n.point,{layers:a}):[];o.length?r||(r=!0,i.call(this,new co(e,this,n.originalEvent,{features:o}))):r=!1},a=()=>{r=!1};return{layers:new Set(t),listener:i,delegates:{mousemove:n,mouseout:a}}}if("mouseleave"===e||"mouseout"===e){let r=!1;const n=n=>{const a=t.filter((e=>this.getLayer(e)));(a.length?this.queryRenderedFeatures(n.point,{layers:a}):[]).length?r=!0:r&&(r=!1,i.call(this,new co(e,this,n.originalEvent)))},a=t=>{r&&(r=!1,i.call(this,new co(e,this,t.originalEvent)))};return{layers:new Set(t),listener:i,delegates:{mousemove:n,mouseout:a}}}{const r=e=>{const r=t.filter((e=>this.getLayer(e))),n=r.length?this.queryRenderedFeatures(e.point,{layers:r}):[];n.length&&(e.features=n,i.call(this,e),delete e.features)};return{layers:new Set(t),listener:i,delegates:{[e]:r}}}}on(e,t,i){if(void 0===i)return super.on(e,t);if(Array.isArray(t)||(t=[t]),t)for(const n of t)if(!this._isValidId(n))return this;const r=this._createDelegatedListener(e,t,i);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(r);for(const n in r.delegates)this.on(n,r.delegates[n]);return this}once(e,t,i){if(void 0===i)return super.once(e,t);if(Array.isArray(t)||(t=[t]),t)for(const n of t)if(!this._isValidId(n))return this;const r=this._createDelegatedListener(e,t,i);for(const n in r.delegates)this.once(n,r.delegates[n]);return this}off(e,t,i){if(void 0===i)return super.off(e,t);t=new Set(Array.isArray(t)?t:[t]);for(const a of t)if(!this._isValidId(a))return this;const r=(e,t)=>{if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0},n=this._delegatedListeners?this._delegatedListeners[e]:void 0;return n&&(e=>{for(let n=0;n<e.length;n++){const a=e[n];if(a.listener===i&&r(a.layers,t)){for(const e in a.delegates)this.off(e,a.delegates[e]);return e.splice(n,1),this}}})(n),this}queryRenderedFeatures(t,i){if(!this.style)return[];if(void 0!==i||void 0===t||t instanceof e.P||Array.isArray(t)||(i=t,t=void 0),t=t||[[0,0],[this.transform.width,this.transform.height]],(i=i||{}).layers&&Array.isArray(i.layers))for(const e of i.layers)if(!this._isValidId(e))return[];return this.style.queryRenderedFeatures(t,i,this.transform)}querySourceFeatures(e,t){return this._isValidId(e)?this.style.querySourceFeatures(e,t):[]}isPointOnSurface(t){const{name:i}=this.transform.projection;return"globe"!==i&&"mercator"!==i&&e.w("".concat(i," projection does not support isPointOnSurface, this API may behave unexpectedly.")),this.transform.isPointOnSurface(e.P.convert(t))}setStyle(t,i){return i=e.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&t&&!1!==i.diff&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(t,((r,n)=>{r?(e.w("Unable to perform style diff: ".concat(String(r.message||r.error||r),". Rebuilding the style from scratch.")),this._updateStyle(t,i)):n&&this._update(!0)}),(()=>{this._postStyleLoadEvent()})),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(t,i))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error("Missing UI string '".concat(e,"'"));return t}_updateStyle(t,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),t){const r=e.e({},i);i&&i.config&&(r.initialConfig=i.config,delete r.config),this.style=new Cr(this,r).setEventedParent(this,{style:this.style}).load(t)}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Cr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(e.w("There is no style added to the map."),!1)}_isValidId(t){return null==t?(this.fire(new e.a(new Error("IDs can't be empty."))),!1):!e.c9(t)||(this.fire(new e.a(new Error("IDs can't contain special symbols: \"".concat(t,'".')))),!1)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(e,t,i){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,i)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(t,i){let{pixelRatio:r=1,sdf:n=!1,stretchX:a,stretchY:o,content:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:l,height:c,data:h}=e.f.getImageData(i);this.style.addImage(t,{data:new e.h({width:l,height:c},h),pixelRatio:r,stretchX:a,stretchY:o,content:s,sdf:n,version:0})}else if(void 0===i.width||void 0===i.height)this.fire(new e.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:l,height:c}=i,h=i;this.style.addImage(t,{data:new e.h({width:l,height:c},new Uint8Array(h.data)),pixelRatio:r,stretchX:a,stretchY:o,content:s,sdf:n,version:0,userImage:h}),h.onAdd&&h.onAdd(this,t)}}updateImage(t,i){this._lazyInitEmptyStyle();const r=this.style.getImage(t);if(!r)return void this.fire(new e.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const n=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?e.f.getImageData(i):i,{width:a,height:o}=n,s=n.data;if(void 0===a||void 0===o)return void this.fire(new e.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(a!==r.data.width||o!==r.data.height)return void this.fire(new e.a(new Error("The width and height of the updated image (".concat(a,", ").concat(o,")\n                must be that same as the previous version of the image\n                (").concat(r.data.width,", ").concat(r.data.height,")"))));const l=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);r.data.replace(s,l),this.style.updateImage(t,r)}hasImage(t){return t?!!this.style&&!!this.style.getImage(t):(this.fire(new e.a(new Error("Missing required image id"))),!1)}removeImage(e){this.style.removeImage(e)}loadImage(t,i){e.d(this._requestManager.transformRequest(t,e.R.Image),((t,r)=>{i(t,r instanceof HTMLImageElement?e.f.getImageData(r):r)}))}listImages(){return this.style.listImages()}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(t){return t?this.style.hasModel(t):(this.fire(new e.a(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}getSlot(e){const t=this.getLayer(e);return t&&t.slot||null}setSlot(e,t){return this.style.setSlot(e,t),this.style.mergeLayers(),this._update(!0)}addImport(e,t){return this.style.addImport(e,t),this}updateImport(e,t){return"string"!=typeof t&&t.id!==e?(this.removeImport(e),this.addImport(t)):(this.style.updateImport(e,t),this._update(!0))}removeImport(e){return this.style.removeImport(e),this}moveImport(e,t){return this.style.moveImport(e,t),this._update(!0)}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){return this._isValidId(e)?this.style.getOwnLayer(e):null}setLayerZoomRange(e,t,i){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,i),this._update(!0)):this}setFilter(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._isValidId(e)?(this.style.setFilter(e,t,i),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?(this.style.setPaintProperty(e,t,i,r),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?(this.style.setLayoutProperty(e,t,i,r),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}getSchema(e){return this.style.getSchema(e)}setSchema(e,t){return this.style.setSchema(e,t),this._update(!0)}getConfig(e){return this.style.getConfig(e)}setConfig(e,t){return this.style.setConfig(e,t),this._update(!0)}getConfigProperty(e,t){return this.style.getConfigProperty(e,t)}setConfigProperty(e,t,i){return this.style.setConfigProperty(e,t,i),this._update(!0)}setLights(e){if(this._lazyInitEmptyStyle(),e&&1===e.length&&"flat"===e[0].type){const t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const e=this.style.getLights()||[];return 0===e.length&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===e["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(e.bq.convert(t),this.transform):0}setFeatureState(e,t){return this._isValidId(e.source)?(this.style.setFeatureState(e,t),this._update()):this}removeFeatureState(e,t){return this._isValidId(e.source)?(this.style.removeFeatureState(e,t),this._update()):this}getFeatureState(e){return this._isValidId(e.source)?this.style.getFeatureState(e):null}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let i,r,n,a=this._container;for(;a&&(!r||!n);){const e=window.getComputedStyle(a).transform;e&&"none"!==e&&(i=e.match(/matrix.*\((.+)\)/)[1].split(", "),i[0]&&"0"!==i[0]&&"1"!==i[0]&&(r=i[0]),i[3]&&"0"!==i[3]&&"1"!==i[3]&&(n=i[3])),a=a.parentElement}this._containerWidth=r?Math.abs(e/r):e,this._containerHeight=n?Math.abs(t/n):t}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=a("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=a("div","mapboxgl-canvas-container",e);this._canvas=a("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=a("div","mapboxgl-control-container",e),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((e=>{r[e]=a("div","mapboxgl-ctrl-".concat(e),i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,i){const r=e.f.devicePixelRatio||1;this._canvas.width=r*Math.ceil(t),this._canvas.height=r*Math.ceil(i),this._canvas.style.width="".concat(t,"px"),this._canvas.style.height="".concat(i,"px")}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){const t=this._popups.indexOf(e);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const t=e.e({},i.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",t);r?(e.dj(r,!0),this.painter=new Ja(r,this._contextCreateOptions,this.transform,this._tp),this.on("data",(e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)})),e.dk.testSupport(r)):this.fire(new e.a(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.b("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new e.b("webglcontextrestored",{originalEvent:t}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(t){let i;this.fire(new e.b("renderstart"));const r=this.painter.context.extTimerQuery,n=e.f.now(),a=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=a.createQuery(),a.beginQuery(r.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;this._updateProjectionTransition();const o=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,i=this.transform.pitch,r=e.f.now(),n=new e.N(t,{now:r,fadeDuration:o,pitch:i,transition:this.style.transition});this.style.update(n)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let s=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),s=this._updateAverageElevation(n),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):s=this._updateAverageElevation(n),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new e.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const t=e.f.now()-n;a.endQuery(r.TIME_ELAPSED_EXT),setTimeout((()=>{const r=a.getQueryParameter(i,a.QUERY_RESULT)/1e6;a.deleteQuery(i),this.fire(new e.b("gpu-timing-frame",{cpuTime:t,gpuTime:r}))}),50)}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout((()=>{const i=this.painter.queryGpuTimers(t);this.fire(new e.b("gpu-timing-layer",{layerTimes:i}))}),50)}if(this.listens("gpu-timing-deferred-render")){const t=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const i=this.painter.queryGpuTimeDeferredRender(t);this.fire(new e.b("gpu-timing-deferred-render",{gpuTime:i}))}),50)}const l=this._sourcesDirty||this._styleDirty||this._placementDirty||s;if(l||this._repaint)this.triggerRepaint();else{const t=!this.isMoving()&&this.loaded();if(t&&(s=this._updateAverageElevation(n,!0)),s)this.triggerRepaint();else if(this._triggerFrame(!1),t&&(this.fire(new e.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new e.b("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,this._performanceMetricsCollection&&e.dl(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&i(0);const r=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(r||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let n=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(n)?n=0:this._averageElevationLastSampledAt=e;const a=Math.abs(t-n);if(a>1){if(this._isInitialLoad||r)return this._averageElevation.jumpTo(n),i(n);this._averageElevation.easeTo(n,e,300)}else if(a>1e-4)return this._averageElevation.jumpTo(n),i(n)}return!!this._averageElevation.isEasing(e)&&i(this._averageElevation.getValue(e))}_authenticate(){e.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(t=>{if(t&&(t.message===e.dn||401===t.status)){const t=this.painter.context.gl;e.dj(t,!1),this._logoControl instanceof es&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new e.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),e.dp(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&e.dq(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const i=this.painter.context.gl,r=i.createFramebuffer();function n(e){i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0);const t=new Uint8Array(i.drawingBufferWidth*i.drawingBufferHeight*4);return i.readPixels(0,0,i.drawingBufferWidth,i.drawingBufferHeight,i.RGBA,i.UNSIGNED_BYTE,t),t}return i.bindFramebuffer(i.FRAMEBUFFER,r),this._canvasPixelComparison(n(e),t.canvasCopies.map(n),t.timeStamps)}_canvasPixelComparison(e,t,i){let r=i[1]-i[0];const n=e.length/4;for(let a=0;a<t.length;a++){const o=t[a];let s=0;for(let t=0;t<o.length;t+=4)o[t]===e[t]&&o[t+1]===e[t+1]&&o[t+2]===e[t+2]&&o[t+3]===e[t+3]&&(s+=1);r+=(i[a+2]-i[a+1])*(1-s/n)}return r}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),e.dr(this.painter.context.gl),e.ds.remove(),e.dt.remove(),this._removed=!0,this.fire(new e.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=e.f.frame((e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)})))}_preloadTiles(t){const i=this.style?this.style.getSourceCaches():[];return e.b4(i,((e,i)=>e._preloadTiles(t,i)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(e){this._showParseStatus!==e&&(this._showParseStatus=e,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,this._tp.refreshUI(),e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,this._tp.refreshUI(),e&&this._update())}_setCacheLimits(t,i){e.dv(t,i)}get version(){return e.du}},NavigationControl:class{constructor(t){this.options=e.e({},ds,t),this._container=a("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(e.a$(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(e=>{this._map&&this._map.zoomIn({},{originalEvent:e})})),a("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(e=>{this._map&&this._map.zoomOut({},{originalEvent:e})})),a("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(e.a$(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(e=>{const t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))})),this._compassIcon=a("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),i=t===e.getMaxZoom(),r=t===e.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=r,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",r.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?"scale(".concat(1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5),") rotateX(").concat(e.transform.pitch,"deg) rotateZ(").concat(e.transform.angle*(180/Math.PI),"deg)"):"rotate(".concat(e.transform.angle*(180/Math.PI),"deg)");e._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ps(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const i=a("button",e,this._container);return i.type="button",i.addEventListener("click",t),i}_setButtonTitle(e,t){if(!this._map)return;const i=this._map._getUIString("NavigationControl.".concat(t));e.setAttribute("aria-label",i),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}},GeolocateControl:class extends e.E{constructor(t){super();const i=navigator.geolocation;this.options=e.e({geolocation:i},fs,t),e.a$(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ka(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=a("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){var t=this;const i=function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!!t.options.geolocation;t._supportsGeolocation=i,e(i)};void 0!==this._supportsGeolocation?e(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then((e=>i("denied"!==e.state))).catch((()=>i())):i()}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),i=e.coords;return!!t&&(i.longitude<t.getWest()||i.longitude>t.getEast()||i.latitude<t.getSouth()||i.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.b("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.b("geolocate",t)),this._finish()}}_updateCamera(t){const i=new e.bq(t.coords.longitude,t.coords.latitude),r=t.coords.accuracy,n=this._map.getBearing(),a=e.e({bearing:n},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(r),a,{geolocateSource:!0})}_updateMarker(t){if(t){const i=new e.bq(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map.transform,i=e.bo(1,t._center.lat)*t.worldSize,r=Math.ceil(2*this._accuracy*i);this._circleElement.style.width="".concat(r,"px"),this._circleElement.style.height="".concat(r,"px")}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.b("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=a("button","mapboxgl-ctrl-geolocate",this._container),a("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){e.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=a("div","mapboxgl-user-location"),this._dotElement.appendChild(a("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(a("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ns({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=a("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ns({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new e.b("trackuserlocationend")))}))}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return e.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&e()})).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:$o,ScaleControl:class{constructor(t){this.options=e.e({},ms,t),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(e){return!1}}(),e.a$(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,i=t._containerHeight/2,r=t._containerWidth/2-e/2,n=t.unproject([r,i]),a=t.unproject([r+e,i]),o=n.distanceTo(a);if("imperial"===this.options.unit){const t=3.2808*o;t>5280?this._setScale(e,t/5280,"mile"):this._setScale(e,t,"foot")}else"nautical"===this.options.unit?this._setScale(e,o/1852,"nautical-mile"):o>=1e3?this._setScale(e,o/1e3,"kilometer"):this._setScale(e,o,"meter")}_setScale(e,t,i){this._map._requestDomTask((()=>{const r=function(e){const t=Math.pow(10,"".concat(Math.floor(e)).length-1);let i=e/t;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:i>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(i),t*i}(t),n=r/t;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==i?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:i}).format(r):"".concat(r,"&nbsp;").concat(gs[i]),this._container.style.width=e*n+"px"}))}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=a("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof HTMLElement?this._container=t.container:e.w("Full screen control 'container' must be a DOM element.")),e.a$(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=a("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=a("button","mapboxgl-ctrl-fullscreen",this._controlContainer);a("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends e.E{constructor(t){super(),this.options=e.e(Object.create(as),t),e.a$(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new e.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new e.b("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=e.bq.convert(t),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){const t=document.createDocumentFragment(),i=document.createElement("body");let r;for(i.innerHTML=e;r=i.firstChild,r;)t.appendChild(r);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=a("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=a("button","mapboxgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.setAttribute("aria-hidden","true"),e.innerHTML="&#215;",e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,i=this._container,r=this._pos;if(!t||!i||!r)return"bottom";const n=i.offsetWidth,a=i.offsetHeight,o=r.x<n/2,s=r.x>t.transform.width-n/2;if(r.y+e<a)return o?"top-left":s?"top-right":"top";if(r.y>t.transform.height-a){if(o)return"bottom-left";if(s)return"bottom-right"}return o?"left":s?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push("mapboxgl-popup-anchor-".concat(this._anchor)),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(t){const i=this._map,r=this._content;if(!i||!this._lngLat&&!this._trackPointer||!r)return;let n=this._container;if(n||(n=this._container=a("div","mapboxgl-popup",i.getContainer()),this._tip=a("div","mapboxgl-popup-tip",n),n.appendChild(r)),this.options.maxWidth&&n.style.maxWidth!==this.options.maxWidth&&(n.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=is(this._lngLat,this._pos,i.transform)),!this._trackPointer||t){const e=this._pos=this._trackPointer&&t?t:i.project(this._lngLat),r=ss(this.options.offset),n=this._anchor=this._getAnchor(r.y),a=ss(this.options.offset,n),o=e.add(a).round();i._requestDomTask((()=>{this._container&&n&&(this._container.style.transform="".concat(rs[n]," translate(").concat(o.x,"px,").concat(o.y,"px)"))}))}if(!this._marker&&i._showingGlobe()){const t=e.de(i.transform,this._lngLat)?0:1;this._setOpacity(t)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(os);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity="".concat(e)),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:ns,Style:Cr,LngLat:e.bq,LngLatBounds:e.ag,Point:e.P,MercatorCoordinate:e.O,FreeCameraOptions:cr,Evented:e.E,config:e.dd,prewarm:e.dy,clearPrewarmedResources:e.dz,get accessToken(){return e.dd.ACCESS_TOKEN},set accessToken(t){e.dd.ACCESS_TOKEN=t},get baseApiUrl(){return e.dd.API_URL},set baseApiUrl(t){e.dd.API_URL=t},get workerCount(){return e.dA.workerCount},set workerCount(t){e.dA.workerCount=t},get maxParallelImageRequests(){return e.dd.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.dd.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){e.dB(t)},get workerUrl(){return e.dC.workerUrl},set workerUrl(t){e.dC.workerUrl=t},get workerClass(){return e.dC.workerClass},set workerClass(t){e.dC.workerClass=t},get workerParams(){return e.dC.workerParams},set workerParams(t){e.dC.workerParams=t},get dracoUrl(){return e.dD()},set dracoUrl(t){e.dE(t)},get meshoptUrl(){return e.dF()},set meshoptUrl(t){e.dG(t)},setNow:e.f.setNow,restoreNow:e.f.restoreNow};return _s})),i}()},1497:(e,t,i)=>{"use strict";var r=i(3218);function n(){}function a(){}a.resetWarningCache=n,e.exports=function(){function e(e,t,i,n,a,o){if(o!==r){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var i={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:a,resetWarningCache:n};return i.PropTypes=i,i}},5173:(e,t,i)=>{e.exports=i(1497)()},3218:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},2730:(e,t,i)=>{"use strict";var r=i(5043),n=i(8853);function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var h=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),u=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},f={};function m(e,t,i,r,n,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=n,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var g={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){g[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];g[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){g[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){g[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){g[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){g[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){g[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){g[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){g[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var _=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function v(e,t,i,r){var n=g.hasOwnProperty(t)?g[t]:null;(null!==n?0!==n.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,i,r){if(null===t||"undefined"===typeof t||function(e,t,i,r){if(null!==i&&0===i.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==i?!i.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,i,r))return!0;if(r)return!1;if(null!==i)switch(i.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,i,n,r)&&(i=null),r||null===n?function(e){return!!u.call(f,e)||!u.call(p,e)&&(d.test(e)?f[e]=!0:(p[e]=!0,!1))}(t)&&(null===i?e.removeAttribute(t):e.setAttribute(t,""+i)):n.mustUseProperty?e[n.propertyName]=null===i?3!==n.type&&"":i:(t=n.attributeName,r=n.attributeNamespace,null===i?e.removeAttribute(t):(i=3===(n=n.type)||4===n&&!0===i?"":""+i,r?e.setAttributeNS(r,t,i):e.setAttribute(t,i))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(_,y);g[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(_,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(_,y);g[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),g.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){g[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var x=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),w=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),M=Symbol.for("react.provider"),A=Symbol.for("react.context"),P=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),I=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),D=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var R=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var L=Symbol.iterator;function z(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=L&&e[L]||e["@@iterator"])?e:null}var F,O=Object.assign;function B(e){if(void 0===F)try{throw Error()}catch(i){var t=i.stack.trim().match(/\n( *(at )?)/);F=t&&t[1]||""}return"\n"+F+e}var N=!1;function V(e,t){if(!e||N)return"";N=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var n=c.stack.split("\n"),a=r.stack.split("\n"),o=n.length-1,s=a.length-1;1<=o&&0<=s&&n[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(n[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||n[o]!==a[s]){var l="\n"+n[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=o&&0<=s);break}}}finally{N=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?B(e):""}function j(e){switch(e.tag){case 5:return B(e.type);case 16:return B("Lazy");case 13:return B("Suspense");case 19:return B("SuspenseList");case 0:case 2:case 15:return e=V(e.type,!1);case 11:return e=V(e.type.render,!1);case 1:return e=V(e.type,!0);default:return""}}function U(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case w:return"Portal";case E:return"Profiler";case T:return"StrictMode";case C:return"Suspense";case I:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case A:return(e.displayName||"Context")+".Consumer";case M:return(e._context.displayName||"Context")+".Provider";case P:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case k:return null!==(t=e.displayName||null)?t:U(e.type)||"Memo";case D:t=e._payload,e=e._init;try{return U(e(t))}catch(i){}}return null}function G(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return U(t);case 8:return t===T?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function q(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function H(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function W(e){e._valueTracker||(e._valueTracker=function(e){var t=H(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof i&&"function"===typeof i.get&&"function"===typeof i.set){var n=i.get,a=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return n.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Z(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),r="";return e&&(r=H(e)?e.checked?"true":"false":e.value),(e=r)!==i&&(t.setValue(e),!0)}function Q(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function X(e,t){var i=t.checked;return O({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=i?i:e._wrapperState.initialChecked})}function Y(e,t){var i=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;i=q(null!=t.value?t.value:i),e._wrapperState={initialChecked:r,initialValue:i,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function J(e,t){null!=(t=t.checked)&&v(e,"checked",t,!1)}function K(e,t){J(e,t);var i=q(t.value),r=t.type;if(null!=i)"number"===r?(0===i&&""===e.value||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,i):t.hasOwnProperty("defaultValue")&&ee(e,t.type,q(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}""!==(i=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==i&&(e.name=i)}function ee(e,t,i){"number"===t&&Q(e.ownerDocument)===e||(null==i?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}var te=Array.isArray;function ie(e,t,i,r){if(e=e.options,t){t={};for(var n=0;n<i.length;n++)t["$"+i[n]]=!0;for(i=0;i<e.length;i++)n=t.hasOwnProperty("$"+e[i].value),e[i].selected!==n&&(e[i].selected=n),n&&r&&(e[i].defaultSelected=!0)}else{for(i=""+q(i),t=null,n=0;n<e.length;n++){if(e[n].value===i)return e[n].selected=!0,void(r&&(e[n].defaultSelected=!0));null!==t||e[n].disabled||(t=e[n])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(a(91));return O({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ne(e,t){var i=t.value;if(null==i){if(i=t.children,t=t.defaultValue,null!=i){if(null!=t)throw Error(a(92));if(te(i)){if(1<i.length)throw Error(a(93));i=i[0]}t=i}null==t&&(t=""),i=t}e._wrapperState={initialValue:q(i)}}function ae(e,t){var i=q(t.value),r=q(t.defaultValue);null!=i&&((i=""+i)!==e.value&&(e.value=i),null==t.defaultValue&&e.defaultValue!==i&&(e.defaultValue=i)),null!=r&&(e.defaultValue=""+r)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,he,ue=(he=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,i,r){MSApp.execUnsafeLocalFunction((function(){return he(e,t)}))}:he);function de(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&3===i.nodeType)return void(i.nodeValue=t)}e.textContent=t}var pe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function me(e,t,i){return null==t||"boolean"===typeof t||""===t?"":i||"number"!==typeof t||0===t||pe.hasOwnProperty(e)&&pe[e]?(""+t).trim():t+"px"}function ge(e,t){for(var i in e=e.style,t)if(t.hasOwnProperty(i)){var r=0===i.indexOf("--"),n=me(i,t[i],r);"float"===i&&(i="cssFloat"),r?e.setProperty(i,n):e[i]=n}}Object.keys(pe).forEach((function(e){fe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),pe[t]=pe[e]}))}));var _e=O({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(_e[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(a(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(a(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(a(62))}}function ve(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function be(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,Se=null,Te=null;function Ee(e){if(e=vn(e)){if("function"!==typeof we)throw Error(a(280));var t=e.stateNode;t&&(t=bn(t),we(e.stateNode,e.type,t))}}function Me(e){Se?Te?Te.push(e):Te=[e]:Se=e}function Ae(){if(Se){var e=Se,t=Te;if(Te=Se=null,Ee(e),t)for(e=0;e<t.length;e++)Ee(t[e])}}function Pe(e,t){return e(t)}function Ce(){}var Ie=!1;function ke(e,t,i){if(Ie)return e(t,i);Ie=!0;try{return Pe(e,t,i)}finally{Ie=!1,(null!==Se||null!==Te)&&(Ce(),Ae())}}function De(e,t){var i=e.stateNode;if(null===i)return null;var r=bn(i);if(null===r)return null;i=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(i&&"function"!==typeof i)throw Error(a(231,t,typeof i));return i}var Re=!1;if(h)try{var Le={};Object.defineProperty(Le,"passive",{get:function(){Re=!0}}),window.addEventListener("test",Le,Le),window.removeEventListener("test",Le,Le)}catch(he){Re=!1}function ze(e,t,i,r,n,a,o,s,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(i,c)}catch(h){this.onError(h)}}var Fe=!1,Oe=null,Be=!1,Ne=null,Ve={onError:function(e){Fe=!0,Oe=e}};function je(e,t,i,r,n,a,o,s,l){Fe=!1,Oe=null,ze.apply(Ve,arguments)}function Ue(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(i=t.return),e=t.return}while(e)}return 3===t.tag?i:null}function Ge(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function qe(e){if(Ue(e)!==e)throw Error(a(188))}function He(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ue(e)))throw Error(a(188));return t!==e?null:e}for(var i=e,r=t;;){var n=i.return;if(null===n)break;var o=n.alternate;if(null===o){if(null!==(r=n.return)){i=r;continue}break}if(n.child===o.child){for(o=n.child;o;){if(o===i)return qe(n),e;if(o===r)return qe(n),t;o=o.sibling}throw Error(a(188))}if(i.return!==r.return)i=n,r=o;else{for(var s=!1,l=n.child;l;){if(l===i){s=!0,i=n,r=o;break}if(l===r){s=!0,r=n,i=o;break}l=l.sibling}if(!s){for(l=o.child;l;){if(l===i){s=!0,i=o,r=n;break}if(l===r){s=!0,r=o,i=n;break}l=l.sibling}if(!s)throw Error(a(189))}}if(i.alternate!==r)throw Error(a(190))}if(3!==i.tag)throw Error(a(188));return i.stateNode.current===i?e:t}(e))?We(e):null}function We(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=We(e);if(null!==t)return t;e=e.sibling}return null}var Ze=n.unstable_scheduleCallback,Qe=n.unstable_cancelCallback,Xe=n.unstable_shouldYield,Ye=n.unstable_requestPaint,Je=n.unstable_now,Ke=n.unstable_getCurrentPriorityLevel,$e=n.unstable_ImmediatePriority,et=n.unstable_UserBlockingPriority,tt=n.unstable_NormalPriority,it=n.unstable_LowPriority,rt=n.unstable_IdlePriority,nt=null,at=null;var ot=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/lt|0)|0},st=Math.log,lt=Math.LN2;var ct=64,ht=4194304;function ut(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var i=e.pendingLanes;if(0===i)return 0;var r=0,n=e.suspendedLanes,a=e.pingedLanes,o=268435455&i;if(0!==o){var s=o&~n;0!==s?r=ut(s):0!==(a&=o)&&(r=ut(a))}else 0!==(o=i&~n)?r=ut(o):0!==a&&(r=ut(a));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&n)&&((n=r&-r)>=(a=t&-t)||16===n&&0!==(4194240&a)))return t;if(0!==(4&r)&&(r|=16&i),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)n=1<<(i=31-ot(t)),r|=e[i],t&=~n;return r}function pt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function gt(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function _t(e,t,i){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=i}function yt(e,t){var i=e.entangledLanes|=t;for(e=e.entanglements;i;){var r=31-ot(i),n=1<<r;n&t|e[r]&t&&(e[r]|=t),i&=~n}}var vt=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var bt,wt,St,Tt,Et,Mt=!1,At=[],Pt=null,Ct=null,It=null,kt=new Map,Dt=new Map,Rt=[],Lt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function zt(e,t){switch(e){case"focusin":case"focusout":Pt=null;break;case"dragenter":case"dragleave":Ct=null;break;case"mouseover":case"mouseout":It=null;break;case"pointerover":case"pointerout":kt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dt.delete(t.pointerId)}}function Ft(e,t,i,r,n,a){return null===e||e.nativeEvent!==a?(e={blockedOn:t,domEventName:i,eventSystemFlags:r,nativeEvent:a,targetContainers:[n]},null!==t&&(null!==(t=vn(t))&&wt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==n&&-1===t.indexOf(n)&&t.push(n),e)}function Ot(e){var t=yn(e.target);if(null!==t){var i=Ue(t);if(null!==i)if(13===(t=i.tag)){if(null!==(t=Ge(i)))return e.blockedOn=t,void Et(e.priority,(function(){St(i)}))}else if(3===t&&i.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===i.tag?i.stateNode.containerInfo:null)}e.blockedOn=null}function Bt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var i=Xt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==i)return null!==(t=vn(i))&&wt(t),e.blockedOn=i,!1;var r=new(i=e.nativeEvent).constructor(i.type,i);xe=r,i.target.dispatchEvent(r),xe=null,t.shift()}return!0}function Nt(e,t,i){Bt(e)&&i.delete(t)}function Vt(){Mt=!1,null!==Pt&&Bt(Pt)&&(Pt=null),null!==Ct&&Bt(Ct)&&(Ct=null),null!==It&&Bt(It)&&(It=null),kt.forEach(Nt),Dt.forEach(Nt)}function jt(e,t){e.blockedOn===t&&(e.blockedOn=null,Mt||(Mt=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,Vt)))}function Ut(e){function t(t){return jt(t,e)}if(0<At.length){jt(At[0],e);for(var i=1;i<At.length;i++){var r=At[i];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Pt&&jt(Pt,e),null!==Ct&&jt(Ct,e),null!==It&&jt(It,e),kt.forEach(t),Dt.forEach(t),i=0;i<Rt.length;i++)(r=Rt[i]).blockedOn===e&&(r.blockedOn=null);for(;0<Rt.length&&null===(i=Rt[0]).blockedOn;)Ot(i),null===i.blockedOn&&Rt.shift()}var Gt=x.ReactCurrentBatchConfig,qt=!0;function Ht(e,t,i,r){var n=vt,a=Gt.transition;Gt.transition=null;try{vt=1,Zt(e,t,i,r)}finally{vt=n,Gt.transition=a}}function Wt(e,t,i,r){var n=vt,a=Gt.transition;Gt.transition=null;try{vt=4,Zt(e,t,i,r)}finally{vt=n,Gt.transition=a}}function Zt(e,t,i,r){if(qt){var n=Xt(e,t,i,r);if(null===n)Gr(e,t,r,Qt,i),zt(e,r);else if(function(e,t,i,r,n){switch(t){case"focusin":return Pt=Ft(Pt,e,t,i,r,n),!0;case"dragenter":return Ct=Ft(Ct,e,t,i,r,n),!0;case"mouseover":return It=Ft(It,e,t,i,r,n),!0;case"pointerover":var a=n.pointerId;return kt.set(a,Ft(kt.get(a)||null,e,t,i,r,n)),!0;case"gotpointercapture":return a=n.pointerId,Dt.set(a,Ft(Dt.get(a)||null,e,t,i,r,n)),!0}return!1}(n,e,t,i,r))r.stopPropagation();else if(zt(e,r),4&t&&-1<Lt.indexOf(e)){for(;null!==n;){var a=vn(n);if(null!==a&&bt(a),null===(a=Xt(e,t,i,r))&&Gr(e,t,r,Qt,i),a===n)break;n=a}null!==n&&r.stopPropagation()}else Gr(e,t,r,null,i)}}var Qt=null;function Xt(e,t,i,r){if(Qt=null,null!==(e=yn(e=be(r))))if(null===(t=Ue(e)))e=null;else if(13===(i=t.tag)){if(null!==(e=Ge(t)))return e;e=null}else if(3===i){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Qt=e,null}function Yt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ke()){case $e:return 1;case et:return 4;case tt:case it:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Jt=null,Kt=null,$t=null;function ei(){if($t)return $t;var e,t,i=Kt,r=i.length,n="value"in Jt?Jt.value:Jt.textContent,a=n.length;for(e=0;e<r&&i[e]===n[e];e++);var o=r-e;for(t=1;t<=o&&i[r-t]===n[a-t];t++);return $t=n.slice(e,1<t?1-t:void 0)}function ti(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function ii(){return!0}function ri(){return!1}function ni(e){function t(t,i,r,n,a){for(var o in this._reactName=t,this._targetInst=r,this.type=i,this.nativeEvent=n,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(n):n[o]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?ii:ri,this.isPropagationStopped=ri,this}return O(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=ii)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=ii)},persist:function(){},isPersistent:ii}),t}var ai,oi,si,li={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ci=ni(li),hi=O({},li,{view:0,detail:0}),ui=ni(hi),di=O({},hi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ti,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==si&&(si&&"mousemove"===e.type?(ai=e.screenX-si.screenX,oi=e.screenY-si.screenY):oi=ai=0,si=e),ai)},movementY:function(e){return"movementY"in e?e.movementY:oi}}),pi=ni(di),fi=ni(O({},di,{dataTransfer:0})),mi=ni(O({},hi,{relatedTarget:0})),gi=ni(O({},li,{animationName:0,elapsedTime:0,pseudoElement:0})),_i=O({},li,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yi=ni(_i),vi=ni(O({},li,{data:0})),xi={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},bi={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Si(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=wi[e])&&!!t[e]}function Ti(){return Si}var Ei=O({},hi,{key:function(e){if(e.key){var t=xi[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=ti(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?bi[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ti,charCode:function(e){return"keypress"===e.type?ti(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?ti(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Mi=ni(Ei),Ai=ni(O({},di,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Pi=ni(O({},hi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ti})),Ci=ni(O({},li,{propertyName:0,elapsedTime:0,pseudoElement:0})),Ii=O({},di,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),ki=ni(Ii),Di=[9,13,27,32],Ri=h&&"CompositionEvent"in window,Li=null;h&&"documentMode"in document&&(Li=document.documentMode);var zi=h&&"TextEvent"in window&&!Li,Fi=h&&(!Ri||Li&&8<Li&&11>=Li),Oi=String.fromCharCode(32),Bi=!1;function Ni(e,t){switch(e){case"keyup":return-1!==Di.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vi(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var ji=!1;var Ui={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Ui[e.type]:"textarea"===t}function qi(e,t,i,r){Me(r),0<(t=Hr(t,"onChange")).length&&(i=new ci("onChange","change",null,i,r),e.push({event:i,listeners:t}))}var Hi=null,Wi=null;function Zi(e){Or(e,0)}function Qi(e){if(Z(xn(e)))return e}function Xi(e,t){if("change"===e)return t}var Yi=!1;if(h){var Ji;if(h){var Ki="oninput"in document;if(!Ki){var $i=document.createElement("div");$i.setAttribute("oninput","return;"),Ki="function"===typeof $i.oninput}Ji=Ki}else Ji=!1;Yi=Ji&&(!document.documentMode||9<document.documentMode)}function er(){Hi&&(Hi.detachEvent("onpropertychange",tr),Wi=Hi=null)}function tr(e){if("value"===e.propertyName&&Qi(Wi)){var t=[];qi(t,Wi,e,be(e)),ke(Zi,t)}}function ir(e,t,i){"focusin"===e?(er(),Wi=i,(Hi=t).attachEvent("onpropertychange",tr)):"focusout"===e&&er()}function rr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Qi(Wi)}function nr(e,t){if("click"===e)return Qi(t)}function ar(e,t){if("input"===e||"change"===e)return Qi(t)}var or="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function sr(e,t){if(or(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(r=0;r<i.length;r++){var n=i[r];if(!u.call(t,n)||!or(e[n],t[n]))return!1}return!0}function lr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function cr(e,t){var i,r=lr(e);for(e=0;r;){if(3===r.nodeType){if(i=e+r.textContent.length,e<=t&&i>=t)return{node:r,offset:t-e};e=i}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=lr(r)}}function hr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function ur(){for(var e=window,t=Q();t instanceof e.HTMLIFrameElement;){try{var i="string"===typeof t.contentWindow.location.href}catch(r){i=!1}if(!i)break;t=Q((e=t.contentWindow).document)}return t}function dr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=ur(),i=e.focusedElem,r=e.selectionRange;if(t!==i&&i&&i.ownerDocument&&hr(i.ownerDocument.documentElement,i)){if(null!==r&&dr(i))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in i)i.selectionStart=t,i.selectionEnd=Math.min(e,i.value.length);else if((e=(t=i.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var n=i.textContent.length,a=Math.min(r.start,n);r=void 0===r.end?a:Math.min(r.end,n),!e.extend&&a>r&&(n=r,r=a,a=n),n=cr(i,a);var o=cr(i,r);n&&o&&(1!==e.rangeCount||e.anchorNode!==n.node||e.anchorOffset!==n.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(n.node,n.offset),e.removeAllRanges(),a>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=i;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof i.focus&&i.focus(),i=0;i<t.length;i++)(e=t[i]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var fr=h&&"documentMode"in document&&11>=document.documentMode,mr=null,gr=null,_r=null,yr=!1;function vr(e,t,i){var r=i.window===i?i.document:9===i.nodeType?i:i.ownerDocument;yr||null==mr||mr!==Q(r)||("selectionStart"in(r=mr)&&dr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},_r&&sr(_r,r)||(_r=r,0<(r=Hr(gr,"onSelect")).length&&(t=new ci("onSelect","select",null,t,i),e.push({event:t,listeners:r}),t.target=mr)))}function xr(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var br={animationend:xr("Animation","AnimationEnd"),animationiteration:xr("Animation","AnimationIteration"),animationstart:xr("Animation","AnimationStart"),transitionend:xr("Transition","TransitionEnd")},wr={},Sr={};function Tr(e){if(wr[e])return wr[e];if(!br[e])return e;var t,i=br[e];for(t in i)if(i.hasOwnProperty(t)&&t in Sr)return wr[e]=i[t];return e}h&&(Sr=document.createElement("div").style,"AnimationEvent"in window||(delete br.animationend.animation,delete br.animationiteration.animation,delete br.animationstart.animation),"TransitionEvent"in window||delete br.transitionend.transition);var Er=Tr("animationend"),Mr=Tr("animationiteration"),Ar=Tr("animationstart"),Pr=Tr("transitionend"),Cr=new Map,Ir="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function kr(e,t){Cr.set(e,t),l(t,[e])}for(var Dr=0;Dr<Ir.length;Dr++){var Rr=Ir[Dr];kr(Rr.toLowerCase(),"on"+(Rr[0].toUpperCase()+Rr.slice(1)))}kr(Er,"onAnimationEnd"),kr(Mr,"onAnimationIteration"),kr(Ar,"onAnimationStart"),kr("dblclick","onDoubleClick"),kr("focusin","onFocus"),kr("focusout","onBlur"),kr(Pr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),zr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Lr));function Fr(e,t,i){var r=e.type||"unknown-event";e.currentTarget=i,function(e,t,i,r,n,o,s,l,c){if(je.apply(this,arguments),Fe){if(!Fe)throw Error(a(198));var h=Oe;Fe=!1,Oe=null,Be||(Be=!0,Ne=h)}}(r,t,void 0,e),e.currentTarget=null}function Or(e,t){t=0!==(4&t);for(var i=0;i<e.length;i++){var r=e[i],n=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==a&&n.isPropagationStopped())break e;Fr(n,s,c),a=l}else for(o=0;o<r.length;o++){if(l=(s=r[o]).instance,c=s.currentTarget,s=s.listener,l!==a&&n.isPropagationStopped())break e;Fr(n,s,c),a=l}}}if(Be)throw e=Ne,Be=!1,Ne=null,e}function Br(e,t){var i=t[mn];void 0===i&&(i=t[mn]=new Set);var r=e+"__bubble";i.has(r)||(Ur(t,e,2,!1),i.add(r))}function Nr(e,t,i){var r=0;t&&(r|=4),Ur(i,e,r,t)}var Vr="_reactListening"+Math.random().toString(36).slice(2);function jr(e){if(!e[Vr]){e[Vr]=!0,o.forEach((function(t){"selectionchange"!==t&&(zr.has(t)||Nr(t,!1,e),Nr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Vr]||(t[Vr]=!0,Nr("selectionchange",!1,t))}}function Ur(e,t,i,r){switch(Yt(t)){case 1:var n=Ht;break;case 4:n=Wt;break;default:n=Zt}i=n.bind(null,t,i,e),n=void 0,!Re||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(n=!0),r?void 0!==n?e.addEventListener(t,i,{capture:!0,passive:n}):e.addEventListener(t,i,!0):void 0!==n?e.addEventListener(t,i,{passive:n}):e.addEventListener(t,i,!1)}function Gr(e,t,i,r,n){var a=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===n||8===s.nodeType&&s.parentNode===n)break;if(4===o)for(o=r.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===n||8===l.nodeType&&l.parentNode===n))return;o=o.return}for(;null!==s;){if(null===(o=yn(s)))return;if(5===(l=o.tag)||6===l){r=a=o;continue e}s=s.parentNode}}r=r.return}ke((function(){var r=a,n=be(i),o=[];e:{var s=Cr.get(e);if(void 0!==s){var l=ci,c=e;switch(e){case"keypress":if(0===ti(i))break e;case"keydown":case"keyup":l=Mi;break;case"focusin":c="focus",l=mi;break;case"focusout":c="blur",l=mi;break;case"beforeblur":case"afterblur":l=mi;break;case"click":if(2===i.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=fi;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Pi;break;case Er:case Mr:case Ar:l=gi;break;case Pr:l=Ci;break;case"scroll":l=ui;break;case"wheel":l=ki;break;case"copy":case"cut":case"paste":l=yi;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Ai}var h=0!==(4&t),u=!h&&"scroll"===e,d=h?null!==s?s+"Capture":null:s;h=[];for(var p,f=r;null!==f;){var m=(p=f).stateNode;if(5===p.tag&&null!==m&&(p=m,null!==d&&(null!=(m=De(f,d))&&h.push(qr(f,m,p)))),u)break;f=f.return}0<h.length&&(s=new l(s,c,null,i,n),o.push({event:s,listeners:h}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||i===xe||!(c=i.relatedTarget||i.fromElement)||!yn(c)&&!c[fn])&&(l||s)&&(s=n.window===n?n:(s=n.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=r,null!==(c=(c=i.relatedTarget||i.toElement)?yn(c):null)&&(c!==(u=Ue(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(h=pi,m="onMouseLeave",d="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(h=Ai,m="onPointerLeave",d="onPointerEnter",f="pointer"),u=null==l?s:xn(l),p=null==c?s:xn(c),(s=new h(m,f+"leave",l,i,n)).target=u,s.relatedTarget=p,m=null,yn(n)===r&&((h=new h(d,f+"enter",c,i,n)).target=p,h.relatedTarget=u,m=h),u=m,l&&c)e:{for(d=c,f=0,p=h=l;p;p=Wr(p))f++;for(p=0,m=d;m;m=Wr(m))p++;for(;0<f-p;)h=Wr(h),f--;for(;0<p-f;)d=Wr(d),p--;for(;f--;){if(h===d||null!==d&&h===d.alternate)break e;h=Wr(h),d=Wr(d)}h=null}else h=null;null!==l&&Zr(o,s,l,h,!1),null!==c&&null!==u&&Zr(o,u,c,h,!0)}if("select"===(l=(s=r?xn(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var g=Xi;else if(Gi(s))if(Yi)g=ar;else{g=rr;var _=ir}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(g=nr);switch(g&&(g=g(e,r))?qi(o,g,i,n):(_&&_(e,s,r),"focusout"===e&&(_=s._wrapperState)&&_.controlled&&"number"===s.type&&ee(s,"number",s.value)),_=r?xn(r):window,e){case"focusin":(Gi(_)||"true"===_.contentEditable)&&(mr=_,gr=r,_r=null);break;case"focusout":_r=gr=mr=null;break;case"mousedown":yr=!0;break;case"contextmenu":case"mouseup":case"dragend":yr=!1,vr(o,i,n);break;case"selectionchange":if(fr)break;case"keydown":case"keyup":vr(o,i,n)}var y;if(Ri)e:{switch(e){case"compositionstart":var v="onCompositionStart";break e;case"compositionend":v="onCompositionEnd";break e;case"compositionupdate":v="onCompositionUpdate";break e}v=void 0}else ji?Ni(e,i)&&(v="onCompositionEnd"):"keydown"===e&&229===i.keyCode&&(v="onCompositionStart");v&&(Fi&&"ko"!==i.locale&&(ji||"onCompositionStart"!==v?"onCompositionEnd"===v&&ji&&(y=ei()):(Kt="value"in(Jt=n)?Jt.value:Jt.textContent,ji=!0)),0<(_=Hr(r,v)).length&&(v=new vi(v,e,null,i,n),o.push({event:v,listeners:_}),y?v.data=y:null!==(y=Vi(i))&&(v.data=y))),(y=zi?function(e,t){switch(e){case"compositionend":return Vi(t);case"keypress":return 32!==t.which?null:(Bi=!0,Oi);case"textInput":return(e=t.data)===Oi&&Bi?null:e;default:return null}}(e,i):function(e,t){if(ji)return"compositionend"===e||!Ri&&Ni(e,t)?(e=ei(),$t=Kt=Jt=null,ji=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fi&&"ko"!==t.locale?null:t.data}}(e,i))&&(0<(r=Hr(r,"onBeforeInput")).length&&(n=new vi("onBeforeInput","beforeinput",null,i,n),o.push({event:n,listeners:r}),n.data=y))}Or(o,t)}))}function qr(e,t,i){return{instance:e,listener:t,currentTarget:i}}function Hr(e,t){for(var i=t+"Capture",r=[];null!==e;){var n=e,a=n.stateNode;5===n.tag&&null!==a&&(n=a,null!=(a=De(e,i))&&r.unshift(qr(e,a,n)),null!=(a=De(e,t))&&r.push(qr(e,a,n))),e=e.return}return r}function Wr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Zr(e,t,i,r,n){for(var a=t._reactName,o=[];null!==i&&i!==r;){var s=i,l=s.alternate,c=s.stateNode;if(null!==l&&l===r)break;5===s.tag&&null!==c&&(s=c,n?null!=(l=De(i,a))&&o.unshift(qr(i,l,s)):n||null!=(l=De(i,a))&&o.push(qr(i,l,s))),i=i.return}0!==o.length&&e.push({event:t,listeners:o})}var Qr=/\r\n?/g,Xr=/\u0000|\uFFFD/g;function Yr(e){return("string"===typeof e?e:""+e).replace(Qr,"\n").replace(Xr,"")}function Jr(e,t,i){if(t=Yr(t),Yr(e)!==t&&i)throw Error(a(425))}function Kr(){}var $r=null,en=null;function tn(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var rn="function"===typeof setTimeout?setTimeout:void 0,nn="function"===typeof clearTimeout?clearTimeout:void 0,an="function"===typeof Promise?Promise:void 0,on="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof an?function(e){return an.resolve(null).then(e).catch(sn)}:rn;function sn(e){setTimeout((function(){throw e}))}function ln(e,t){var i=t,r=0;do{var n=i.nextSibling;if(e.removeChild(i),n&&8===n.nodeType)if("/$"===(i=n.data)){if(0===r)return e.removeChild(n),void Ut(t);r--}else"$"!==i&&"$?"!==i&&"$!"!==i||r++;i=n}while(i);Ut(t)}function cn(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function hn(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var i=e.data;if("$"===i||"$!"===i||"$?"===i){if(0===t)return e;t--}else"/$"===i&&t++}e=e.previousSibling}return null}var un=Math.random().toString(36).slice(2),dn="__reactFiber$"+un,pn="__reactProps$"+un,fn="__reactContainer$"+un,mn="__reactEvents$"+un,gn="__reactListeners$"+un,_n="__reactHandles$"+un;function yn(e){var t=e[dn];if(t)return t;for(var i=e.parentNode;i;){if(t=i[fn]||i[dn]){if(i=t.alternate,null!==t.child||null!==i&&null!==i.child)for(e=hn(e);null!==e;){if(i=e[dn])return i;e=hn(e)}return t}i=(e=i).parentNode}return null}function vn(e){return!(e=e[dn]||e[fn])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xn(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(a(33))}function bn(e){return e[pn]||null}var wn=[],Sn=-1;function Tn(e){return{current:e}}function En(e){0>Sn||(e.current=wn[Sn],wn[Sn]=null,Sn--)}function Mn(e,t){Sn++,wn[Sn]=e.current,e.current=t}var An={},Pn=Tn(An),Cn=Tn(!1),In=An;function kn(e,t){var i=e.type.contextTypes;if(!i)return An;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var n,a={};for(n in i)a[n]=t[n];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Dn(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Rn(){En(Cn),En(Pn)}function Ln(e,t,i){if(Pn.current!==An)throw Error(a(168));Mn(Pn,t),Mn(Cn,i)}function zn(e,t,i){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return i;for(var n in r=r.getChildContext())if(!(n in t))throw Error(a(108,G(e)||"Unknown",n));return O({},i,r)}function Fn(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||An,In=Pn.current,Mn(Pn,e),Mn(Cn,Cn.current),!0}function On(e,t,i){var r=e.stateNode;if(!r)throw Error(a(169));i?(e=zn(e,t,In),r.__reactInternalMemoizedMergedChildContext=e,En(Cn),En(Pn),Mn(Pn,e)):En(Cn),Mn(Cn,i)}var Bn=null,Nn=!1,Vn=!1;function jn(e){null===Bn?Bn=[e]:Bn.push(e)}function Un(){if(!Vn&&null!==Bn){Vn=!0;var e=0,t=vt;try{var i=Bn;for(vt=1;e<i.length;e++){var r=i[e];do{r=r(!0)}while(null!==r)}Bn=null,Nn=!1}catch(n){throw null!==Bn&&(Bn=Bn.slice(e+1)),Ze($e,Un),n}finally{vt=t,Vn=!1}}return null}var Gn=[],qn=0,Hn=null,Wn=0,Zn=[],Qn=0,Xn=null,Yn=1,Jn="";function Kn(e,t){Gn[qn++]=Wn,Gn[qn++]=Hn,Hn=e,Wn=t}function $n(e,t,i){Zn[Qn++]=Yn,Zn[Qn++]=Jn,Zn[Qn++]=Xn,Xn=e;var r=Yn;e=Jn;var n=32-ot(r)-1;r&=~(1<<n),i+=1;var a=32-ot(t)+n;if(30<a){var o=n-n%5;a=(r&(1<<o)-1).toString(32),r>>=o,n-=o,Yn=1<<32-ot(t)+n|i<<n|r,Jn=a+e}else Yn=1<<a|i<<n|r,Jn=e}function ea(e){null!==e.return&&(Kn(e,1),$n(e,1,0))}function ta(e){for(;e===Hn;)Hn=Gn[--qn],Gn[qn]=null,Wn=Gn[--qn],Gn[qn]=null;for(;e===Xn;)Xn=Zn[--Qn],Zn[Qn]=null,Jn=Zn[--Qn],Zn[Qn]=null,Yn=Zn[--Qn],Zn[Qn]=null}var ia=null,ra=null,na=!1,aa=null;function oa(e,t){var i=kc(5,null,null,0);i.elementType="DELETED",i.stateNode=t,i.return=e,null===(t=e.deletions)?(e.deletions=[i],e.flags|=16):t.push(i)}function sa(e,t){switch(e.tag){case 5:var i=e.type;return null!==(t=1!==t.nodeType||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ia=e,ra=cn(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ia=e,ra=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(i=null!==Xn?{id:Yn,overflow:Jn}:null,e.memoizedState={dehydrated:t,treeContext:i,retryLane:1073741824},(i=kc(18,null,null,0)).stateNode=t,i.return=e,e.child=i,ia=e,ra=null,!0);default:return!1}}function la(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ca(e){if(na){var t=ra;if(t){var i=t;if(!sa(e,t)){if(la(e))throw Error(a(418));t=cn(i.nextSibling);var r=ia;t&&sa(e,t)?oa(r,i):(e.flags=-4097&e.flags|2,na=!1,ia=e)}}else{if(la(e))throw Error(a(418));e.flags=-4097&e.flags|2,na=!1,ia=e}}}function ha(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ia=e}function ua(e){if(e!==ia)return!1;if(!na)return ha(e),na=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!tn(e.type,e.memoizedProps)),t&&(t=ra)){if(la(e))throw da(),Error(a(418));for(;t;)oa(e,t),t=cn(t.nextSibling)}if(ha(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var i=e.data;if("/$"===i){if(0===t){ra=cn(e.nextSibling);break e}t--}else"$"!==i&&"$!"!==i&&"$?"!==i||t++}e=e.nextSibling}ra=null}}else ra=ia?cn(e.stateNode.nextSibling):null;return!0}function da(){for(var e=ra;e;)e=cn(e.nextSibling)}function pa(){ra=ia=null,na=!1}function fa(e){null===aa?aa=[e]:aa.push(e)}var ma=x.ReactCurrentBatchConfig;function ga(e,t,i){if(null!==(e=i.ref)&&"function"!==typeof e&&"object"!==typeof e){if(i._owner){if(i=i._owner){if(1!==i.tag)throw Error(a(309));var r=i.stateNode}if(!r)throw Error(a(147,e));var n=r,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=n.refs;null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(a(284));if(!i._owner)throw Error(a(290,e))}return e}function _a(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function ya(e){return(0,e._init)(e._payload)}function va(e){function t(t,i){if(e){var r=t.deletions;null===r?(t.deletions=[i],t.flags|=16):r.push(i)}}function i(i,r){if(!e)return null;for(;null!==r;)t(i,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function n(e,t){return(e=Rc(e,t)).index=0,e.sibling=null,e}function o(t,i,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<i?(t.flags|=2,i):r:(t.flags|=2,i):(t.flags|=1048576,i)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,i,r){return null===t||6!==t.tag?((t=Oc(i,e.mode,r)).return=e,t):((t=n(t,i)).return=e,t)}function c(e,t,i,r){var a=i.type;return a===S?u(e,t,i.props.children,r,i.key):null!==t&&(t.elementType===a||"object"===typeof a&&null!==a&&a.$$typeof===D&&ya(a)===t.type)?((r=n(t,i.props)).ref=ga(e,t,i),r.return=e,r):((r=Lc(i.type,i.key,i.props,null,e.mode,r)).ref=ga(e,t,i),r.return=e,r)}function h(e,t,i,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==i.containerInfo||t.stateNode.implementation!==i.implementation?((t=Bc(i,e.mode,r)).return=e,t):((t=n(t,i.children||[])).return=e,t)}function u(e,t,i,r,a){return null===t||7!==t.tag?((t=zc(i,e.mode,r,a)).return=e,t):((t=n(t,i)).return=e,t)}function d(e,t,i){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Oc(""+t,e.mode,i)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case b:return(i=Lc(t.type,t.key,t.props,null,e.mode,i)).ref=ga(e,null,t),i.return=e,i;case w:return(t=Bc(t,e.mode,i)).return=e,t;case D:return d(e,(0,t._init)(t._payload),i)}if(te(t)||z(t))return(t=zc(t,e.mode,i,null)).return=e,t;_a(e,t)}return null}function p(e,t,i,r){var n=null!==t?t.key:null;if("string"===typeof i&&""!==i||"number"===typeof i)return null!==n?null:l(e,t,""+i,r);if("object"===typeof i&&null!==i){switch(i.$$typeof){case b:return i.key===n?c(e,t,i,r):null;case w:return i.key===n?h(e,t,i,r):null;case D:return p(e,t,(n=i._init)(i._payload),r)}if(te(i)||z(i))return null!==n?null:u(e,t,i,r,null);_a(e,i)}return null}function f(e,t,i,r,n){if("string"===typeof r&&""!==r||"number"===typeof r)return l(t,e=e.get(i)||null,""+r,n);if("object"===typeof r&&null!==r){switch(r.$$typeof){case b:return c(t,e=e.get(null===r.key?i:r.key)||null,r,n);case w:return h(t,e=e.get(null===r.key?i:r.key)||null,r,n);case D:return f(e,t,i,(0,r._init)(r._payload),n)}if(te(r)||z(r))return u(t,e=e.get(i)||null,r,n,null);_a(t,r)}return null}function m(n,a,s,l){for(var c=null,h=null,u=a,m=a=0,g=null;null!==u&&m<s.length;m++){u.index>m?(g=u,u=null):g=u.sibling;var _=p(n,u,s[m],l);if(null===_){null===u&&(u=g);break}e&&u&&null===_.alternate&&t(n,u),a=o(_,a,m),null===h?c=_:h.sibling=_,h=_,u=g}if(m===s.length)return i(n,u),na&&Kn(n,m),c;if(null===u){for(;m<s.length;m++)null!==(u=d(n,s[m],l))&&(a=o(u,a,m),null===h?c=u:h.sibling=u,h=u);return na&&Kn(n,m),c}for(u=r(n,u);m<s.length;m++)null!==(g=f(u,n,m,s[m],l))&&(e&&null!==g.alternate&&u.delete(null===g.key?m:g.key),a=o(g,a,m),null===h?c=g:h.sibling=g,h=g);return e&&u.forEach((function(e){return t(n,e)})),na&&Kn(n,m),c}function g(n,s,l,c){var h=z(l);if("function"!==typeof h)throw Error(a(150));if(null==(l=h.call(l)))throw Error(a(151));for(var u=h=null,m=s,g=s=0,_=null,y=l.next();null!==m&&!y.done;g++,y=l.next()){m.index>g?(_=m,m=null):_=m.sibling;var v=p(n,m,y.value,c);if(null===v){null===m&&(m=_);break}e&&m&&null===v.alternate&&t(n,m),s=o(v,s,g),null===u?h=v:u.sibling=v,u=v,m=_}if(y.done)return i(n,m),na&&Kn(n,g),h;if(null===m){for(;!y.done;g++,y=l.next())null!==(y=d(n,y.value,c))&&(s=o(y,s,g),null===u?h=y:u.sibling=y,u=y);return na&&Kn(n,g),h}for(m=r(n,m);!y.done;g++,y=l.next())null!==(y=f(m,n,g,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?g:y.key),s=o(y,s,g),null===u?h=y:u.sibling=y,u=y);return e&&m.forEach((function(e){return t(n,e)})),na&&Kn(n,g),h}return function e(r,a,o,l){if("object"===typeof o&&null!==o&&o.type===S&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case b:e:{for(var c=o.key,h=a;null!==h;){if(h.key===c){if((c=o.type)===S){if(7===h.tag){i(r,h.sibling),(a=n(h,o.props.children)).return=r,r=a;break e}}else if(h.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===D&&ya(c)===h.type){i(r,h.sibling),(a=n(h,o.props)).ref=ga(r,h,o),a.return=r,r=a;break e}i(r,h);break}t(r,h),h=h.sibling}o.type===S?((a=zc(o.props.children,r.mode,l,o.key)).return=r,r=a):((l=Lc(o.type,o.key,o.props,null,r.mode,l)).ref=ga(r,a,o),l.return=r,r=l)}return s(r);case w:e:{for(h=o.key;null!==a;){if(a.key===h){if(4===a.tag&&a.stateNode.containerInfo===o.containerInfo&&a.stateNode.implementation===o.implementation){i(r,a.sibling),(a=n(a,o.children||[])).return=r,r=a;break e}i(r,a);break}t(r,a),a=a.sibling}(a=Bc(o,r.mode,l)).return=r,r=a}return s(r);case D:return e(r,a,(h=o._init)(o._payload),l)}if(te(o))return m(r,a,o,l);if(z(o))return g(r,a,o,l);_a(r,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==a&&6===a.tag?(i(r,a.sibling),(a=n(a,o)).return=r,r=a):(i(r,a),(a=Oc(o,r.mode,l)).return=r,r=a),s(r)):i(r,a)}}var xa=va(!0),ba=va(!1),wa=Tn(null),Sa=null,Ta=null,Ea=null;function Ma(){Ea=Ta=Sa=null}function Aa(e){var t=wa.current;En(wa),e._currentValue=t}function Pa(e,t,i){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===i)break;e=e.return}}function Ca(e,t){Sa=e,Ea=Ta=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(vs=!0),e.firstContext=null)}function Ia(e){var t=e._currentValue;if(Ea!==e)if(e={context:e,memoizedValue:t,next:null},null===Ta){if(null===Sa)throw Error(a(308));Ta=e,Sa.dependencies={lanes:0,firstContext:e}}else Ta=Ta.next=e;return t}var ka=null;function Da(e){null===ka?ka=[e]:ka.push(e)}function Ra(e,t,i,r){var n=t.interleaved;return null===n?(i.next=i,Da(t)):(i.next=n.next,n.next=i),t.interleaved=i,La(e,r)}function La(e,t){e.lanes|=t;var i=e.alternate;for(null!==i&&(i.lanes|=t),i=e,e=e.return;null!==e;)e.childLanes|=t,null!==(i=e.alternate)&&(i.childLanes|=t),i=e,e=e.return;return 3===i.tag?i.stateNode:null}var za=!1;function Fa(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Oa(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ba(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Na(e,t,i){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Pl)){var n=r.pending;return null===n?t.next=t:(t.next=n.next,n.next=t),r.pending=t,La(e,i)}return null===(n=r.interleaved)?(t.next=t,Da(r)):(t.next=n.next,n.next=t),r.interleaved=t,La(e,i)}function Va(e,t,i){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&i))){var r=t.lanes;i|=r&=e.pendingLanes,t.lanes=i,yt(e,i)}}function ja(e,t){var i=e.updateQueue,r=e.alternate;if(null!==r&&i===(r=r.updateQueue)){var n=null,a=null;if(null!==(i=i.firstBaseUpdate)){do{var o={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};null===a?n=a=o:a=a.next=o,i=i.next}while(null!==i);null===a?n=a=t:a=a.next=t}else n=a=t;return i={baseState:r.baseState,firstBaseUpdate:n,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=i)}null===(e=i.lastBaseUpdate)?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function Ua(e,t,i,r){var n=e.updateQueue;za=!1;var a=n.firstBaseUpdate,o=n.lastBaseUpdate,s=n.shared.pending;if(null!==s){n.shared.pending=null;var l=s,c=l.next;l.next=null,null===o?a=c:o.next=c,o=l;var h=e.alternate;null!==h&&((s=(h=h.updateQueue).lastBaseUpdate)!==o&&(null===s?h.firstBaseUpdate=c:s.next=c,h.lastBaseUpdate=l))}if(null!==a){var u=n.baseState;for(o=0,h=c=l=null,s=a;;){var d=s.lane,p=s.eventTime;if((r&d)===d){null!==h&&(h=h.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var f=e,m=s;switch(d=t,p=i,m.tag){case 1:if("function"===typeof(f=m.payload)){u=f.call(p,u,d);break e}u=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(d="function"===typeof(f=m.payload)?f.call(p,u,d):f)||void 0===d)break e;u=O({},u,d);break e;case 2:za=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(d=n.effects)?n.effects=[s]:d.push(s))}else p={eventTime:p,lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===h?(c=h=p,l=u):h=h.next=p,o|=d;if(null===(s=s.next)){if(null===(s=n.shared.pending))break;s=(d=s).next,d.next=null,n.lastBaseUpdate=d,n.shared.pending=null}}if(null===h&&(l=u),n.baseState=l,n.firstBaseUpdate=c,n.lastBaseUpdate=h,null!==(t=n.shared.interleaved)){n=t;do{o|=n.lane,n=n.next}while(n!==t)}else null===a&&(n.shared.lanes=0);Fl|=o,e.lanes=o,e.memoizedState=u}}function Ga(e,t,i){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],n=r.callback;if(null!==n){if(r.callback=null,r=i,"function"!==typeof n)throw Error(a(191,n));n.call(r)}}}var qa={},Ha=Tn(qa),Wa=Tn(qa),Za=Tn(qa);function Qa(e){if(e===qa)throw Error(a(174));return e}function Xa(e,t){switch(Mn(Za,t),Mn(Wa,e),Mn(Ha,qa),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}En(Ha),Mn(Ha,t)}function Ya(){En(Ha),En(Wa),En(Za)}function Ja(e){Qa(Za.current);var t=Qa(Ha.current),i=le(t,e.type);t!==i&&(Mn(Wa,e),Mn(Ha,i))}function Ka(e){Wa.current===e&&(En(Ha),En(Wa))}var $a=Tn(0);function eo(e){for(var t=e;null!==t;){if(13===t.tag){var i=t.memoizedState;if(null!==i&&(null===(i=i.dehydrated)||"$?"===i.data||"$!"===i.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var to=[];function io(){for(var e=0;e<to.length;e++)to[e]._workInProgressVersionPrimary=null;to.length=0}var ro=x.ReactCurrentDispatcher,no=x.ReactCurrentBatchConfig,ao=0,oo=null,so=null,lo=null,co=!1,ho=!1,uo=0,po=0;function fo(){throw Error(a(321))}function mo(e,t){if(null===t)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!or(e[i],t[i]))return!1;return!0}function go(e,t,i,r,n,o){if(ao=o,oo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ro.current=null===e||null===e.memoizedState?$o:es,e=i(r,n),ho){o=0;do{if(ho=!1,uo=0,25<=o)throw Error(a(301));o+=1,lo=so=null,t.updateQueue=null,ro.current=ts,e=i(r,n)}while(ho)}if(ro.current=Ko,t=null!==so&&null!==so.next,ao=0,lo=so=oo=null,co=!1,t)throw Error(a(300));return e}function _o(){var e=0!==uo;return uo=0,e}function yo(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===lo?oo.memoizedState=lo=e:lo=lo.next=e,lo}function vo(){if(null===so){var e=oo.alternate;e=null!==e?e.memoizedState:null}else e=so.next;var t=null===lo?oo.memoizedState:lo.next;if(null!==t)lo=t,so=e;else{if(null===e)throw Error(a(310));e={memoizedState:(so=e).memoizedState,baseState:so.baseState,baseQueue:so.baseQueue,queue:so.queue,next:null},null===lo?oo.memoizedState=lo=e:lo=lo.next=e}return lo}function xo(e,t){return"function"===typeof t?t(e):t}function bo(e){var t=vo(),i=t.queue;if(null===i)throw Error(a(311));i.lastRenderedReducer=e;var r=so,n=r.baseQueue,o=i.pending;if(null!==o){if(null!==n){var s=n.next;n.next=o.next,o.next=s}r.baseQueue=n=o,i.pending=null}if(null!==n){o=n.next,r=r.baseState;var l=s=null,c=null,h=o;do{var u=h.lane;if((ao&u)===u)null!==c&&(c=c.next={lane:0,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null}),r=h.hasEagerState?h.eagerState:e(r,h.action);else{var d={lane:u,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null};null===c?(l=c=d,s=r):c=c.next=d,oo.lanes|=u,Fl|=u}h=h.next}while(null!==h&&h!==o);null===c?s=r:c.next=l,or(r,t.memoizedState)||(vs=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,i.lastRenderedState=r}if(null!==(e=i.interleaved)){n=e;do{o=n.lane,oo.lanes|=o,Fl|=o,n=n.next}while(n!==e)}else null===n&&(i.lanes=0);return[t.memoizedState,i.dispatch]}function wo(e){var t=vo(),i=t.queue;if(null===i)throw Error(a(311));i.lastRenderedReducer=e;var r=i.dispatch,n=i.pending,o=t.memoizedState;if(null!==n){i.pending=null;var s=n=n.next;do{o=e(o,s.action),s=s.next}while(s!==n);or(o,t.memoizedState)||(vs=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),i.lastRenderedState=o}return[o,r]}function So(){}function To(e,t){var i=oo,r=vo(),n=t(),o=!or(r.memoizedState,n);if(o&&(r.memoizedState=n,vs=!0),r=r.queue,Fo(Ao.bind(null,i,r,e),[e]),r.getSnapshot!==t||o||null!==lo&&1&lo.memoizedState.tag){if(i.flags|=2048,ko(9,Mo.bind(null,i,r,n,t),void 0,null),null===Cl)throw Error(a(349));0!==(30&ao)||Eo(i,t,n)}return n}function Eo(e,t,i){e.flags|=16384,e={getSnapshot:t,value:i},null===(t=oo.updateQueue)?(t={lastEffect:null,stores:null},oo.updateQueue=t,t.stores=[e]):null===(i=t.stores)?t.stores=[e]:i.push(e)}function Mo(e,t,i,r){t.value=i,t.getSnapshot=r,Po(t)&&Co(e)}function Ao(e,t,i){return i((function(){Po(t)&&Co(e)}))}function Po(e){var t=e.getSnapshot;e=e.value;try{var i=t();return!or(e,i)}catch(r){return!0}}function Co(e){var t=La(e,1);null!==t&&ic(t,e,1,-1)}function Io(e){var t=yo();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xo,lastRenderedState:e},t.queue=e,e=e.dispatch=Qo.bind(null,oo,e),[t.memoizedState,e]}function ko(e,t,i,r){return e={tag:e,create:t,destroy:i,deps:r,next:null},null===(t=oo.updateQueue)?(t={lastEffect:null,stores:null},oo.updateQueue=t,t.lastEffect=e.next=e):null===(i=t.lastEffect)?t.lastEffect=e.next=e:(r=i.next,i.next=e,e.next=r,t.lastEffect=e),e}function Do(){return vo().memoizedState}function Ro(e,t,i,r){var n=yo();oo.flags|=e,n.memoizedState=ko(1|t,i,void 0,void 0===r?null:r)}function Lo(e,t,i,r){var n=vo();r=void 0===r?null:r;var a=void 0;if(null!==so){var o=so.memoizedState;if(a=o.destroy,null!==r&&mo(r,o.deps))return void(n.memoizedState=ko(t,i,a,r))}oo.flags|=e,n.memoizedState=ko(1|t,i,a,r)}function zo(e,t){return Ro(8390656,8,e,t)}function Fo(e,t){return Lo(2048,8,e,t)}function Oo(e,t){return Lo(4,2,e,t)}function Bo(e,t){return Lo(4,4,e,t)}function No(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Vo(e,t,i){return i=null!==i&&void 0!==i?i.concat([e]):null,Lo(4,4,No.bind(null,t,e),i)}function jo(){}function Uo(e,t){var i=vo();t=void 0===t?null:t;var r=i.memoizedState;return null!==r&&null!==t&&mo(t,r[1])?r[0]:(i.memoizedState=[e,t],e)}function Go(e,t){var i=vo();t=void 0===t?null:t;var r=i.memoizedState;return null!==r&&null!==t&&mo(t,r[1])?r[0]:(e=e(),i.memoizedState=[e,t],e)}function qo(e,t,i){return 0===(21&ao)?(e.baseState&&(e.baseState=!1,vs=!0),e.memoizedState=i):(or(i,t)||(i=mt(),oo.lanes|=i,Fl|=i,e.baseState=!0),t)}function Ho(e,t){var i=vt;vt=0!==i&&4>i?i:4,e(!0);var r=no.transition;no.transition={};try{e(!1),t()}finally{vt=i,no.transition=r}}function Wo(){return vo().memoizedState}function Zo(e,t,i){var r=tc(e);if(i={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null},Xo(e))Yo(t,i);else if(null!==(i=Ra(e,t,i,r))){ic(i,e,r,ec()),Jo(i,t,r)}}function Qo(e,t,i){var r=tc(e),n={lane:r,action:i,hasEagerState:!1,eagerState:null,next:null};if(Xo(e))Yo(t,n);else{var a=e.alternate;if(0===e.lanes&&(null===a||0===a.lanes)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,i);if(n.hasEagerState=!0,n.eagerState=s,or(s,o)){var l=t.interleaved;return null===l?(n.next=n,Da(t)):(n.next=l.next,l.next=n),void(t.interleaved=n)}}catch(c){}null!==(i=Ra(e,t,n,r))&&(ic(i,e,r,n=ec()),Jo(i,t,r))}}function Xo(e){var t=e.alternate;return e===oo||null!==t&&t===oo}function Yo(e,t){ho=co=!0;var i=e.pending;null===i?t.next=t:(t.next=i.next,i.next=t),e.pending=t}function Jo(e,t,i){if(0!==(4194240&i)){var r=t.lanes;i|=r&=e.pendingLanes,t.lanes=i,yt(e,i)}}var Ko={readContext:Ia,useCallback:fo,useContext:fo,useEffect:fo,useImperativeHandle:fo,useInsertionEffect:fo,useLayoutEffect:fo,useMemo:fo,useReducer:fo,useRef:fo,useState:fo,useDebugValue:fo,useDeferredValue:fo,useTransition:fo,useMutableSource:fo,useSyncExternalStore:fo,useId:fo,unstable_isNewReconciler:!1},$o={readContext:Ia,useCallback:function(e,t){return yo().memoizedState=[e,void 0===t?null:t],e},useContext:Ia,useEffect:zo,useImperativeHandle:function(e,t,i){return i=null!==i&&void 0!==i?i.concat([e]):null,Ro(4194308,4,No.bind(null,t,e),i)},useLayoutEffect:function(e,t){return Ro(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ro(4,2,e,t)},useMemo:function(e,t){var i=yo();return t=void 0===t?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var r=yo();return t=void 0!==i?i(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=Zo.bind(null,oo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},yo().memoizedState=e},useState:Io,useDebugValue:jo,useDeferredValue:function(e){return yo().memoizedState=e},useTransition:function(){var e=Io(!1),t=e[0];return e=Ho.bind(null,e[1]),yo().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,i){var r=oo,n=yo();if(na){if(void 0===i)throw Error(a(407));i=i()}else{if(i=t(),null===Cl)throw Error(a(349));0!==(30&ao)||Eo(r,t,i)}n.memoizedState=i;var o={value:i,getSnapshot:t};return n.queue=o,zo(Ao.bind(null,r,o,e),[e]),r.flags|=2048,ko(9,Mo.bind(null,r,o,i,t),void 0,null),i},useId:function(){var e=yo(),t=Cl.identifierPrefix;if(na){var i=Jn;t=":"+t+"R"+(i=(Yn&~(1<<32-ot(Yn)-1)).toString(32)+i),0<(i=uo++)&&(t+="H"+i.toString(32)),t+=":"}else t=":"+t+"r"+(i=po++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},es={readContext:Ia,useCallback:Uo,useContext:Ia,useEffect:Fo,useImperativeHandle:Vo,useInsertionEffect:Oo,useLayoutEffect:Bo,useMemo:Go,useReducer:bo,useRef:Do,useState:function(){return bo(xo)},useDebugValue:jo,useDeferredValue:function(e){return qo(vo(),so.memoizedState,e)},useTransition:function(){return[bo(xo)[0],vo().memoizedState]},useMutableSource:So,useSyncExternalStore:To,useId:Wo,unstable_isNewReconciler:!1},ts={readContext:Ia,useCallback:Uo,useContext:Ia,useEffect:Fo,useImperativeHandle:Vo,useInsertionEffect:Oo,useLayoutEffect:Bo,useMemo:Go,useReducer:wo,useRef:Do,useState:function(){return wo(xo)},useDebugValue:jo,useDeferredValue:function(e){var t=vo();return null===so?t.memoizedState=e:qo(t,so.memoizedState,e)},useTransition:function(){return[wo(xo)[0],vo().memoizedState]},useMutableSource:So,useSyncExternalStore:To,useId:Wo,unstable_isNewReconciler:!1};function is(e,t){if(e&&e.defaultProps){for(var i in t=O({},t),e=e.defaultProps)void 0===t[i]&&(t[i]=e[i]);return t}return t}function rs(e,t,i,r){i=null===(i=i(r,t=e.memoizedState))||void 0===i?t:O({},t,i),e.memoizedState=i,0===e.lanes&&(e.updateQueue.baseState=i)}var ns={isMounted:function(e){return!!(e=e._reactInternals)&&Ue(e)===e},enqueueSetState:function(e,t,i){e=e._reactInternals;var r=ec(),n=tc(e),a=Ba(r,n);a.payload=t,void 0!==i&&null!==i&&(a.callback=i),null!==(t=Na(e,a,n))&&(ic(t,e,n,r),Va(t,e,n))},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var r=ec(),n=tc(e),a=Ba(r,n);a.tag=1,a.payload=t,void 0!==i&&null!==i&&(a.callback=i),null!==(t=Na(e,a,n))&&(ic(t,e,n,r),Va(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=ec(),r=tc(e),n=Ba(i,r);n.tag=2,void 0!==t&&null!==t&&(n.callback=t),null!==(t=Na(e,n,r))&&(ic(t,e,r,i),Va(t,e,r))}};function as(e,t,i,r,n,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!sr(i,r)||!sr(n,a))}function os(e,t,i){var r=!1,n=An,a=t.contextType;return"object"===typeof a&&null!==a?a=Ia(a):(n=Dn(t)?In:Pn.current,a=(r=null!==(r=t.contextTypes)&&void 0!==r)?kn(e,n):An),t=new t(i,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ns,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=n,e.__reactInternalMemoizedMaskedChildContext=a),t}function ss(e,t,i,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(i,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(i,r),t.state!==e&&ns.enqueueReplaceState(t,t.state,null)}function ls(e,t,i,r){var n=e.stateNode;n.props=i,n.state=e.memoizedState,n.refs={},Fa(e);var a=t.contextType;"object"===typeof a&&null!==a?n.context=Ia(a):(a=Dn(t)?In:Pn.current,n.context=kn(e,a)),n.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(rs(e,t,a,i),n.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof n.getSnapshotBeforeUpdate||"function"!==typeof n.UNSAFE_componentWillMount&&"function"!==typeof n.componentWillMount||(t=n.state,"function"===typeof n.componentWillMount&&n.componentWillMount(),"function"===typeof n.UNSAFE_componentWillMount&&n.UNSAFE_componentWillMount(),t!==n.state&&ns.enqueueReplaceState(n,n.state,null),Ua(e,i,n,r),n.state=e.memoizedState),"function"===typeof n.componentDidMount&&(e.flags|=4194308)}function cs(e,t){try{var i="",r=t;do{i+=j(r),r=r.return}while(r);var n=i}catch(a){n="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:n,digest:null}}function hs(e,t,i){return{value:e,source:null,stack:null!=i?i:null,digest:null!=t?t:null}}function us(e,t){try{console.error(t.value)}catch(i){setTimeout((function(){throw i}))}}var ds="function"===typeof WeakMap?WeakMap:Map;function ps(e,t,i){(i=Ba(-1,i)).tag=3,i.payload={element:null};var r=t.value;return i.callback=function(){ql||(ql=!0,Hl=r),us(0,t)},i}function fs(e,t,i){(i=Ba(-1,i)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var n=t.value;i.payload=function(){return r(n)},i.callback=function(){us(0,t)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(i.callback=function(){us(0,t),"function"!==typeof r&&(null===Wl?Wl=new Set([this]):Wl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),i}function ms(e,t,i){var r=e.pingCache;if(null===r){r=e.pingCache=new ds;var n=new Set;r.set(t,n)}else void 0===(n=r.get(t))&&(n=new Set,r.set(t,n));n.has(i)||(n.add(i),e=Ec.bind(null,e,t,i),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function _s(e,t,i,r,n){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,i.flags|=131072,i.flags&=-52805,1===i.tag&&(null===i.alternate?i.tag=17:((t=Ba(-1,1)).tag=2,Na(i,t,1))),i.lanes|=1),e):(e.flags|=65536,e.lanes=n,e)}var ys=x.ReactCurrentOwner,vs=!1;function xs(e,t,i,r){t.child=null===e?ba(t,null,i,r):xa(t,e.child,i,r)}function bs(e,t,i,r,n){i=i.render;var a=t.ref;return Ca(t,n),r=go(e,t,i,r,a,n),i=_o(),null===e||vs?(na&&i&&ea(t),t.flags|=1,xs(e,t,r,n),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,qs(e,t,n))}function ws(e,t,i,r,n){if(null===e){var a=i.type;return"function"!==typeof a||Dc(a)||void 0!==a.defaultProps||null!==i.compare||void 0!==i.defaultProps?((e=Lc(i.type,null,r,t,t.mode,n)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=a,Ss(e,t,a,r,n))}if(a=e.child,0===(e.lanes&n)){var o=a.memoizedProps;if((i=null!==(i=i.compare)?i:sr)(o,r)&&e.ref===t.ref)return qs(e,t,n)}return t.flags|=1,(e=Rc(a,r)).ref=t.ref,e.return=t,t.child=e}function Ss(e,t,i,r,n){if(null!==e){var a=e.memoizedProps;if(sr(a,r)&&e.ref===t.ref){if(vs=!1,t.pendingProps=r=a,0===(e.lanes&n))return t.lanes=e.lanes,qs(e,t,n);0!==(131072&e.flags)&&(vs=!0)}}return Ms(e,t,i,r,n)}function Ts(e,t,i){var r=t.pendingProps,n=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Mn(Rl,Dl),Dl|=i;else{if(0===(1073741824&i))return e=null!==a?a.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Mn(Rl,Dl),Dl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==a?a.baseLanes:i,Mn(Rl,Dl),Dl|=r}else null!==a?(r=a.baseLanes|i,t.memoizedState=null):r=i,Mn(Rl,Dl),Dl|=r;return xs(e,t,n,i),t.child}function Es(e,t){var i=t.ref;(null===e&&null!==i||null!==e&&e.ref!==i)&&(t.flags|=512,t.flags|=2097152)}function Ms(e,t,i,r,n){var a=Dn(i)?In:Pn.current;return a=kn(t,a),Ca(t,n),i=go(e,t,i,r,a,n),r=_o(),null===e||vs?(na&&r&&ea(t),t.flags|=1,xs(e,t,i,n),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n,qs(e,t,n))}function As(e,t,i,r,n){if(Dn(i)){var a=!0;Fn(t)}else a=!1;if(Ca(t,n),null===t.stateNode)Gs(e,t),os(t,i,r),ls(t,i,r,n),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var l=o.context,c=i.contextType;"object"===typeof c&&null!==c?c=Ia(c):c=kn(t,c=Dn(i)?In:Pn.current);var h=i.getDerivedStateFromProps,u="function"===typeof h||"function"===typeof o.getSnapshotBeforeUpdate;u||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||l!==c)&&ss(t,o,r,c),za=!1;var d=t.memoizedState;o.state=d,Ua(t,r,o,n),l=t.memoizedState,s!==r||d!==l||Cn.current||za?("function"===typeof h&&(rs(t,i,h,r),l=t.memoizedState),(s=za||as(t,i,s,r,d,l,c))?(u||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),o.props=r,o.state=l,o.context=c,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,Oa(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:is(t.type,s),o.props=c,u=t.pendingProps,d=o.context,"object"===typeof(l=i.contextType)&&null!==l?l=Ia(l):l=kn(t,l=Dn(i)?In:Pn.current);var p=i.getDerivedStateFromProps;(h="function"===typeof p||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==u||d!==l)&&ss(t,o,r,l),za=!1,d=t.memoizedState,o.state=d,Ua(t,r,o,n);var f=t.memoizedState;s!==u||d!==f||Cn.current||za?("function"===typeof p&&(rs(t,i,p,r),f=t.memoizedState),(c=za||as(t,i,c,r,d,f,l)||!1)?(h||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,f,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,f,l)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=f),o.props=r,o.state=f,o.context=l,r=c):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return Ps(e,t,i,r,a,n)}function Ps(e,t,i,r,n,a){Es(e,t);var o=0!==(128&t.flags);if(!r&&!o)return n&&On(t,i,!1),qs(e,t,a);r=t.stateNode,ys.current=t;var s=o&&"function"!==typeof i.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=xa(t,e.child,null,a),t.child=xa(t,null,s,a)):xs(e,t,s,a),t.memoizedState=r.state,n&&On(t,i,!0),t.child}function Cs(e){var t=e.stateNode;t.pendingContext?Ln(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Ln(0,t.context,!1),Xa(e,t.containerInfo)}function Is(e,t,i,r,n){return pa(),fa(n),t.flags|=256,xs(e,t,i,r),t.child}var ks,Ds,Rs,Ls,zs={dehydrated:null,treeContext:null,retryLane:0};function Fs(e){return{baseLanes:e,cachePool:null,transitions:null}}function Os(e,t,i){var r,n=t.pendingProps,o=$a.current,s=!1,l=0!==(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&0!==(2&o)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Mn($a,1&o),null===e)return ca(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=n.children,e=n.fallback,s?(n=t.mode,s=t.child,l={mode:"hidden",children:l},0===(1&n)&&null!==s?(s.childLanes=0,s.pendingProps=l):s=Fc(l,n,0,null),e=zc(e,n,i,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Fs(i),t.memoizedState=zs,e):Bs(t,l));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return function(e,t,i,r,n,o,s){if(i)return 256&t.flags?(t.flags&=-257,Ns(e,t,s,r=hs(Error(a(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,n=t.mode,r=Fc({mode:"visible",children:r.children},n,0,null),(o=zc(o,n,s,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,0!==(1&t.mode)&&xa(t,e.child,null,s),t.child.memoizedState=Fs(s),t.memoizedState=zs,o);if(0===(1&t.mode))return Ns(e,t,s,null);if("$!"===n.data){if(r=n.nextSibling&&n.nextSibling.dataset)var l=r.dgst;return r=l,Ns(e,t,s,r=hs(o=Error(a(419)),r,void 0))}if(l=0!==(s&e.childLanes),vs||l){if(null!==(r=Cl)){switch(s&-s){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}0!==(n=0!==(n&(r.suspendedLanes|s))?0:n)&&n!==o.retryLane&&(o.retryLane=n,La(e,n),ic(r,e,n,-1))}return mc(),Ns(e,t,s,r=hs(Error(a(421))))}return"$?"===n.data?(t.flags|=128,t.child=e.child,t=Ac.bind(null,e),n._reactRetry=t,null):(e=o.treeContext,ra=cn(n.nextSibling),ia=t,na=!0,aa=null,null!==e&&(Zn[Qn++]=Yn,Zn[Qn++]=Jn,Zn[Qn++]=Xn,Yn=e.id,Jn=e.overflow,Xn=t),t=Bs(t,r.children),t.flags|=4096,t)}(e,t,l,n,r,o,i);if(s){s=n.fallback,l=t.mode,r=(o=e.child).sibling;var c={mode:"hidden",children:n.children};return 0===(1&l)&&t.child!==o?((n=t.child).childLanes=0,n.pendingProps=c,t.deletions=null):(n=Rc(o,c)).subtreeFlags=14680064&o.subtreeFlags,null!==r?s=Rc(r,s):(s=zc(s,l,i,null)).flags|=2,s.return=t,n.return=t,n.sibling=s,t.child=n,n=s,s=t.child,l=null===(l=e.child.memoizedState)?Fs(i):{baseLanes:l.baseLanes|i,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=e.childLanes&~i,t.memoizedState=zs,n}return e=(s=e.child).sibling,n=Rc(s,{mode:"visible",children:n.children}),0===(1&t.mode)&&(n.lanes=i),n.return=t,n.sibling=null,null!==e&&(null===(i=t.deletions)?(t.deletions=[e],t.flags|=16):i.push(e)),t.child=n,t.memoizedState=null,n}function Bs(e,t){return(t=Fc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ns(e,t,i,r){return null!==r&&fa(r),xa(t,e.child,null,i),(e=Bs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Vs(e,t,i){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Pa(e.return,t,i)}function js(e,t,i,r,n){var a=e.memoizedState;null===a?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:i,tailMode:n}:(a.isBackwards=t,a.rendering=null,a.renderingStartTime=0,a.last=r,a.tail=i,a.tailMode=n)}function Us(e,t,i){var r=t.pendingProps,n=r.revealOrder,a=r.tail;if(xs(e,t,r.children,i),0!==(2&(r=$a.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Vs(e,i,t);else if(19===e.tag)Vs(e,i,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Mn($a,r),0===(1&t.mode))t.memoizedState=null;else switch(n){case"forwards":for(i=t.child,n=null;null!==i;)null!==(e=i.alternate)&&null===eo(e)&&(n=i),i=i.sibling;null===(i=n)?(n=t.child,t.child=null):(n=i.sibling,i.sibling=null),js(t,!1,n,i,a);break;case"backwards":for(i=null,n=t.child,t.child=null;null!==n;){if(null!==(e=n.alternate)&&null===eo(e)){t.child=n;break}e=n.sibling,n.sibling=i,i=n,n=e}js(t,!0,i,null,a);break;case"together":js(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Gs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function qs(e,t,i){if(null!==e&&(t.dependencies=e.dependencies),Fl|=t.lanes,0===(i&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(a(153));if(null!==t.child){for(i=Rc(e=t.child,e.pendingProps),t.child=i,i.return=t;null!==e.sibling;)e=e.sibling,(i=i.sibling=Rc(e,e.pendingProps)).return=t;i.sibling=null}return t.child}function Hs(e,t){if(!na)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;null!==t;)null!==t.alternate&&(i=t),t=t.sibling;null===i?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var r=null;null!==i;)null!==i.alternate&&(r=i),i=i.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ws(e){var t=null!==e.alternate&&e.alternate.child===e.child,i=0,r=0;if(t)for(var n=e.child;null!==n;)i|=n.lanes|n.childLanes,r|=14680064&n.subtreeFlags,r|=14680064&n.flags,n.return=e,n=n.sibling;else for(n=e.child;null!==n;)i|=n.lanes|n.childLanes,r|=n.subtreeFlags,r|=n.flags,n.return=e,n=n.sibling;return e.subtreeFlags|=r,e.childLanes=i,t}function Zs(e,t,i){var r=t.pendingProps;switch(ta(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ws(t),null;case 1:case 17:return Dn(t.type)&&Rn(),Ws(t),null;case 3:return r=t.stateNode,Ya(),En(Cn),En(Pn),io(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(ua(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==aa&&(oc(aa),aa=null))),Ds(e,t),Ws(t),null;case 5:Ka(t);var n=Qa(Za.current);if(i=t.type,null!==e&&null!=t.stateNode)Rs(e,t,i,r,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(a(166));return Ws(t),null}if(e=Qa(Ha.current),ua(t)){r=t.stateNode,i=t.type;var o=t.memoizedProps;switch(r[dn]=t,r[pn]=o,e=0!==(1&t.mode),i){case"dialog":Br("cancel",r),Br("close",r);break;case"iframe":case"object":case"embed":Br("load",r);break;case"video":case"audio":for(n=0;n<Lr.length;n++)Br(Lr[n],r);break;case"source":Br("error",r);break;case"img":case"image":case"link":Br("error",r),Br("load",r);break;case"details":Br("toggle",r);break;case"input":Y(r,o),Br("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Br("invalid",r);break;case"textarea":ne(r,o),Br("invalid",r)}for(var l in ye(i,o),n=null,o)if(o.hasOwnProperty(l)){var c=o[l];"children"===l?"string"===typeof c?r.textContent!==c&&(!0!==o.suppressHydrationWarning&&Jr(r.textContent,c,e),n=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&Jr(r.textContent,c,e),n=["children",""+c]):s.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Br("scroll",r)}switch(i){case"input":W(r),$(r,o,!0);break;case"textarea":W(r),oe(r);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(r.onclick=Kr)}r=n,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===n.nodeType?n:n.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(i)),"http://www.w3.org/1999/xhtml"===e?"script"===i?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=l.createElement(i,{is:r.is}):(e=l.createElement(i),"select"===i&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,i),e[dn]=t,e[pn]=r,ks(e,t,!1,!1),t.stateNode=e;e:{switch(l=ve(i,r),i){case"dialog":Br("cancel",e),Br("close",e),n=r;break;case"iframe":case"object":case"embed":Br("load",e),n=r;break;case"video":case"audio":for(n=0;n<Lr.length;n++)Br(Lr[n],e);n=r;break;case"source":Br("error",e),n=r;break;case"img":case"image":case"link":Br("error",e),Br("load",e),n=r;break;case"details":Br("toggle",e),n=r;break;case"input":Y(e,r),n=X(e,r),Br("invalid",e);break;case"option":default:n=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},n=O({},r,{value:void 0}),Br("invalid",e);break;case"textarea":ne(e,r),n=re(e,r),Br("invalid",e)}for(o in ye(i,n),c=n)if(c.hasOwnProperty(o)){var h=c[o];"style"===o?ge(e,h):"dangerouslySetInnerHTML"===o?null!=(h=h?h.__html:void 0)&&ue(e,h):"children"===o?"string"===typeof h?("textarea"!==i||""!==h)&&de(e,h):"number"===typeof h&&de(e,""+h):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=h&&"onScroll"===o&&Br("scroll",e):null!=h&&v(e,o,h,l))}switch(i){case"input":W(e),$(e,r,!1);break;case"textarea":W(e),oe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+q(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?ie(e,!!r.multiple,o,!1):null!=r.defaultValue&&ie(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof n.onClick&&(e.onclick=Kr)}switch(i){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ws(t),null;case 6:if(e&&null!=t.stateNode)Ls(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(a(166));if(i=Qa(Za.current),Qa(Ha.current),ua(t)){if(r=t.stateNode,i=t.memoizedProps,r[dn]=t,(o=r.nodeValue!==i)&&null!==(e=ia))switch(e.tag){case 3:Jr(r.nodeValue,i,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jr(r.nodeValue,i,0!==(1&e.mode))}o&&(t.flags|=4)}else(r=(9===i.nodeType?i:i.ownerDocument).createTextNode(r))[dn]=t,t.stateNode=r}return Ws(t),null;case 13:if(En($a),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(na&&null!==ra&&0!==(1&t.mode)&&0===(128&t.flags))da(),pa(),t.flags|=98560,o=!1;else if(o=ua(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(a(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(a(317));o[dn]=t}else pa(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ws(t),o=!1}else null!==aa&&(oc(aa),aa=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=i,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&$a.current)?0===Ll&&(Ll=3):mc())),null!==t.updateQueue&&(t.flags|=4),Ws(t),null);case 4:return Ya(),Ds(e,t),null===e&&jr(t.stateNode.containerInfo),Ws(t),null;case 10:return Aa(t.type._context),Ws(t),null;case 19:if(En($a),null===(o=t.memoizedState))return Ws(t),null;if(r=0!==(128&t.flags),null===(l=o.rendering))if(r)Hs(o,!1);else{if(0!==Ll||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=eo(e))){for(t.flags|=128,Hs(o,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=i,i=t.child;null!==i;)e=r,(o=i).flags&=14680066,null===(l=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=l.childLanes,o.lanes=l.lanes,o.child=l.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=l.memoizedProps,o.memoizedState=l.memoizedState,o.updateQueue=l.updateQueue,o.type=l.type,e=l.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return Mn($a,1&$a.current|2),t.child}e=e.sibling}null!==o.tail&&Je()>Ul&&(t.flags|=128,r=!0,Hs(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=eo(l))){if(t.flags|=128,r=!0,null!==(i=e.updateQueue)&&(t.updateQueue=i,t.flags|=4),Hs(o,!0),null===o.tail&&"hidden"===o.tailMode&&!l.alternate&&!na)return Ws(t),null}else 2*Je()-o.renderingStartTime>Ul&&1073741824!==i&&(t.flags|=128,r=!0,Hs(o,!1),t.lanes=4194304);o.isBackwards?(l.sibling=t.child,t.child=l):(null!==(i=o.last)?i.sibling=l:t.child=l,o.last=l)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Je(),t.sibling=null,i=$a.current,Mn($a,r?1&i|2:1&i),t):(Ws(t),null);case 22:case 23:return uc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Dl)&&(Ws(t),6&t.subtreeFlags&&(t.flags|=8192)):Ws(t),null;case 24:case 25:return null}throw Error(a(156,t.tag))}function Qs(e,t){switch(ta(t),t.tag){case 1:return Dn(t.type)&&Rn(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Ya(),En(Cn),En(Pn),io(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return Ka(t),null;case 13:if(En($a),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(a(340));pa()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return En($a),null;case 4:return Ya(),null;case 10:return Aa(t.type._context),null;case 22:case 23:return uc(),null;default:return null}}ks=function(e,t){for(var i=t.child;null!==i;){if(5===i.tag||6===i.tag)e.appendChild(i.stateNode);else if(4!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},Ds=function(){},Rs=function(e,t,i,r){var n=e.memoizedProps;if(n!==r){e=t.stateNode,Qa(Ha.current);var a,o=null;switch(i){case"input":n=X(e,n),r=X(e,r),o=[];break;case"select":n=O({},n,{value:void 0}),r=O({},r,{value:void 0}),o=[];break;case"textarea":n=re(e,n),r=re(e,r),o=[];break;default:"function"!==typeof n.onClick&&"function"===typeof r.onClick&&(e.onclick=Kr)}for(h in ye(i,r),i=null,n)if(!r.hasOwnProperty(h)&&n.hasOwnProperty(h)&&null!=n[h])if("style"===h){var l=n[h];for(a in l)l.hasOwnProperty(a)&&(i||(i={}),i[a]="")}else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(s.hasOwnProperty(h)?o||(o=[]):(o=o||[]).push(h,null));for(h in r){var c=r[h];if(l=null!=n?n[h]:void 0,r.hasOwnProperty(h)&&c!==l&&(null!=c||null!=l))if("style"===h)if(l){for(a in l)!l.hasOwnProperty(a)||c&&c.hasOwnProperty(a)||(i||(i={}),i[a]="");for(a in c)c.hasOwnProperty(a)&&l[a]!==c[a]&&(i||(i={}),i[a]=c[a])}else i||(o||(o=[]),o.push(h,i)),i=c;else"dangerouslySetInnerHTML"===h?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(o=o||[]).push(h,c)):"children"===h?"string"!==typeof c&&"number"!==typeof c||(o=o||[]).push(h,""+c):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(s.hasOwnProperty(h)?(null!=c&&"onScroll"===h&&Br("scroll",e),o||l===c||(o=[])):(o=o||[]).push(h,c))}i&&(o=o||[]).push("style",i);var h=o;(t.updateQueue=h)&&(t.flags|=4)}},Ls=function(e,t,i,r){i!==r&&(t.flags|=4)};var Xs=!1,Ys=!1,Js="function"===typeof WeakSet?WeakSet:Set,Ks=null;function $s(e,t){var i=e.ref;if(null!==i)if("function"===typeof i)try{i(null)}catch(r){Tc(e,t,r)}else i.current=null}function el(e,t,i){try{i()}catch(r){Tc(e,t,r)}}var tl=!1;function il(e,t,i){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var n=r=r.next;do{if((n.tag&e)===e){var a=n.destroy;n.destroy=void 0,void 0!==a&&el(t,i,a)}n=n.next}while(n!==r)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var i=t=t.next;do{if((i.tag&e)===e){var r=i.create;i.destroy=r()}i=i.next}while(i!==t)}}function nl(e){var t=e.ref;if(null!==t){var i=e.stateNode;e.tag,e=i,"function"===typeof t?t(e):t.current=e}}function al(e){var t=e.alternate;null!==t&&(e.alternate=null,al(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[dn],delete t[pn],delete t[mn],delete t[gn],delete t[_n])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ol(e){return 5===e.tag||3===e.tag||4===e.tag}function sl(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ol(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ll(e,t,i){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===i.nodeType?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(8===i.nodeType?(t=i.parentNode).insertBefore(e,i):(t=i).appendChild(e),null!==(i=i._reactRootContainer)&&void 0!==i||null!==t.onclick||(t.onclick=Kr));else if(4!==r&&null!==(e=e.child))for(ll(e,t,i),e=e.sibling;null!==e;)ll(e,t,i),e=e.sibling}function cl(e,t,i){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?i.insertBefore(e,t):i.appendChild(e);else if(4!==r&&null!==(e=e.child))for(cl(e,t,i),e=e.sibling;null!==e;)cl(e,t,i),e=e.sibling}var hl=null,ul=!1;function dl(e,t,i){for(i=i.child;null!==i;)pl(e,t,i),i=i.sibling}function pl(e,t,i){if(at&&"function"===typeof at.onCommitFiberUnmount)try{at.onCommitFiberUnmount(nt,i)}catch(s){}switch(i.tag){case 5:Ys||$s(i,t);case 6:var r=hl,n=ul;hl=null,dl(e,t,i),ul=n,null!==(hl=r)&&(ul?(e=hl,i=i.stateNode,8===e.nodeType?e.parentNode.removeChild(i):e.removeChild(i)):hl.removeChild(i.stateNode));break;case 18:null!==hl&&(ul?(e=hl,i=i.stateNode,8===e.nodeType?ln(e.parentNode,i):1===e.nodeType&&ln(e,i),Ut(e)):ln(hl,i.stateNode));break;case 4:r=hl,n=ul,hl=i.stateNode.containerInfo,ul=!0,dl(e,t,i),hl=r,ul=n;break;case 0:case 11:case 14:case 15:if(!Ys&&(null!==(r=i.updateQueue)&&null!==(r=r.lastEffect))){n=r=r.next;do{var a=n,o=a.destroy;a=a.tag,void 0!==o&&(0!==(2&a)||0!==(4&a))&&el(i,t,o),n=n.next}while(n!==r)}dl(e,t,i);break;case 1:if(!Ys&&($s(i,t),"function"===typeof(r=i.stateNode).componentWillUnmount))try{r.props=i.memoizedProps,r.state=i.memoizedState,r.componentWillUnmount()}catch(s){Tc(i,t,s)}dl(e,t,i);break;case 21:dl(e,t,i);break;case 22:1&i.mode?(Ys=(r=Ys)||null!==i.memoizedState,dl(e,t,i),Ys=r):dl(e,t,i);break;default:dl(e,t,i)}}function fl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var i=e.stateNode;null===i&&(i=e.stateNode=new Js),t.forEach((function(t){var r=Pc.bind(null,e,t);i.has(t)||(i.add(t),t.then(r,r))}))}}function ml(e,t){var i=t.deletions;if(null!==i)for(var r=0;r<i.length;r++){var n=i[r];try{var o=e,s=t,l=s;e:for(;null!==l;){switch(l.tag){case 5:hl=l.stateNode,ul=!1;break e;case 3:case 4:hl=l.stateNode.containerInfo,ul=!0;break e}l=l.return}if(null===hl)throw Error(a(160));pl(o,s,n),hl=null,ul=!1;var c=n.alternate;null!==c&&(c.return=null),n.return=null}catch(h){Tc(n,t,h)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gl(t,e),t=t.sibling}function gl(e,t){var i=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ml(t,e),_l(e),4&r){try{il(3,e,e.return),rl(3,e)}catch(g){Tc(e,e.return,g)}try{il(5,e,e.return)}catch(g){Tc(e,e.return,g)}}break;case 1:ml(t,e),_l(e),512&r&&null!==i&&$s(i,i.return);break;case 5:if(ml(t,e),_l(e),512&r&&null!==i&&$s(i,i.return),32&e.flags){var n=e.stateNode;try{de(n,"")}catch(g){Tc(e,e.return,g)}}if(4&r&&null!=(n=e.stateNode)){var o=e.memoizedProps,s=null!==i?i.memoizedProps:o,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===o.type&&null!=o.name&&J(n,o),ve(l,s);var h=ve(l,o);for(s=0;s<c.length;s+=2){var u=c[s],d=c[s+1];"style"===u?ge(n,d):"dangerouslySetInnerHTML"===u?ue(n,d):"children"===u?de(n,d):v(n,u,d,h)}switch(l){case"input":K(n,o);break;case"textarea":ae(n,o);break;case"select":var p=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!o.multiple;var f=o.value;null!=f?ie(n,!!o.multiple,f,!1):p!==!!o.multiple&&(null!=o.defaultValue?ie(n,!!o.multiple,o.defaultValue,!0):ie(n,!!o.multiple,o.multiple?[]:"",!1))}n[pn]=o}catch(g){Tc(e,e.return,g)}}break;case 6:if(ml(t,e),_l(e),4&r){if(null===e.stateNode)throw Error(a(162));n=e.stateNode,o=e.memoizedProps;try{n.nodeValue=o}catch(g){Tc(e,e.return,g)}}break;case 3:if(ml(t,e),_l(e),4&r&&null!==i&&i.memoizedState.isDehydrated)try{Ut(t.containerInfo)}catch(g){Tc(e,e.return,g)}break;case 4:default:ml(t,e),_l(e);break;case 13:ml(t,e),_l(e),8192&(n=e.child).flags&&(o=null!==n.memoizedState,n.stateNode.isHidden=o,!o||null!==n.alternate&&null!==n.alternate.memoizedState||(jl=Je())),4&r&&fl(e);break;case 22:if(u=null!==i&&null!==i.memoizedState,1&e.mode?(Ys=(h=Ys)||u,ml(t,e),Ys=h):ml(t,e),_l(e),8192&r){if(h=null!==e.memoizedState,(e.stateNode.isHidden=h)&&!u&&0!==(1&e.mode))for(Ks=e,u=e.child;null!==u;){for(d=Ks=u;null!==Ks;){switch(f=(p=Ks).child,p.tag){case 0:case 11:case 14:case 15:il(4,p,p.return);break;case 1:$s(p,p.return);var m=p.stateNode;if("function"===typeof m.componentWillUnmount){r=p,i=p.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(g){Tc(r,i,g)}}break;case 5:$s(p,p.return);break;case 22:if(null!==p.memoizedState){bl(d);continue}}null!==f?(f.return=p,Ks=f):bl(d)}u=u.sibling}e:for(u=null,d=e;;){if(5===d.tag){if(null===u){u=d;try{n=d.stateNode,h?"function"===typeof(o=n.style).setProperty?o.setProperty("display","none","important"):o.display="none":(l=d.stateNode,s=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=me("display",s))}catch(g){Tc(e,e.return,g)}}}else if(6===d.tag){if(null===u)try{d.stateNode.nodeValue=h?"":d.memoizedProps}catch(g){Tc(e,e.return,g)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:ml(t,e),_l(e),4&r&&fl(e);case 21:}}function _l(e){var t=e.flags;if(2&t){try{e:{for(var i=e.return;null!==i;){if(ol(i)){var r=i;break e}i=i.return}throw Error(a(160))}switch(r.tag){case 5:var n=r.stateNode;32&r.flags&&(de(n,""),r.flags&=-33),cl(e,sl(e),n);break;case 3:case 4:var o=r.stateNode.containerInfo;ll(e,sl(e),o);break;default:throw Error(a(161))}}catch(s){Tc(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yl(e,t,i){Ks=e,vl(e,t,i)}function vl(e,t,i){for(var r=0!==(1&e.mode);null!==Ks;){var n=Ks,a=n.child;if(22===n.tag&&r){var o=null!==n.memoizedState||Xs;if(!o){var s=n.alternate,l=null!==s&&null!==s.memoizedState||Ys;s=Xs;var c=Ys;if(Xs=o,(Ys=l)&&!c)for(Ks=n;null!==Ks;)l=(o=Ks).child,22===o.tag&&null!==o.memoizedState?wl(n):null!==l?(l.return=o,Ks=l):wl(n);for(;null!==a;)Ks=a,vl(a,t,i),a=a.sibling;Ks=n,Xs=s,Ys=c}xl(e)}else 0!==(8772&n.subtreeFlags)&&null!==a?(a.return=n,Ks=a):xl(e)}}function xl(e){for(;null!==Ks;){var t=Ks;if(0!==(8772&t.flags)){var i=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ys||rl(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Ys)if(null===i)r.componentDidMount();else{var n=t.elementType===t.type?i.memoizedProps:is(t.type,i.memoizedProps);r.componentDidUpdate(n,i.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Ga(t,o,r);break;case 3:var s=t.updateQueue;if(null!==s){if(i=null,null!==t.child)switch(t.child.tag){case 5:case 1:i=t.child.stateNode}Ga(t,s,i)}break;case 5:var l=t.stateNode;if(null===i&&4&t.flags){i=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&i.focus();break;case"img":c.src&&(i.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var h=t.alternate;if(null!==h){var u=h.memoizedState;if(null!==u){var d=u.dehydrated;null!==d&&Ut(d)}}}break;default:throw Error(a(163))}Ys||512&t.flags&&nl(t)}catch(p){Tc(t,t.return,p)}}if(t===e){Ks=null;break}if(null!==(i=t.sibling)){i.return=t.return,Ks=i;break}Ks=t.return}}function bl(e){for(;null!==Ks;){var t=Ks;if(t===e){Ks=null;break}var i=t.sibling;if(null!==i){i.return=t.return,Ks=i;break}Ks=t.return}}function wl(e){for(;null!==Ks;){var t=Ks;try{switch(t.tag){case 0:case 11:case 15:var i=t.return;try{rl(4,t)}catch(l){Tc(t,i,l)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var n=t.return;try{r.componentDidMount()}catch(l){Tc(t,n,l)}}var a=t.return;try{nl(t)}catch(l){Tc(t,a,l)}break;case 5:var o=t.return;try{nl(t)}catch(l){Tc(t,o,l)}}}catch(l){Tc(t,t.return,l)}if(t===e){Ks=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Ks=s;break}Ks=t.return}}var Sl,Tl=Math.ceil,El=x.ReactCurrentDispatcher,Ml=x.ReactCurrentOwner,Al=x.ReactCurrentBatchConfig,Pl=0,Cl=null,Il=null,kl=0,Dl=0,Rl=Tn(0),Ll=0,zl=null,Fl=0,Ol=0,Bl=0,Nl=null,Vl=null,jl=0,Ul=1/0,Gl=null,ql=!1,Hl=null,Wl=null,Zl=!1,Ql=null,Xl=0,Yl=0,Jl=null,Kl=-1,$l=0;function ec(){return 0!==(6&Pl)?Je():-1!==Kl?Kl:Kl=Je()}function tc(e){return 0===(1&e.mode)?1:0!==(2&Pl)&&0!==kl?kl&-kl:null!==ma.transition?(0===$l&&($l=mt()),$l):0!==(e=vt)?e:e=void 0===(e=window.event)?16:Yt(e.type)}function ic(e,t,i,r){if(50<Yl)throw Yl=0,Jl=null,Error(a(185));_t(e,i,r),0!==(2&Pl)&&e===Cl||(e===Cl&&(0===(2&Pl)&&(Ol|=i),4===Ll&&sc(e,kl)),rc(e,r),1===i&&0===Pl&&0===(1&t.mode)&&(Ul=Je()+500,Nn&&Un()))}function rc(e,t){var i=e.callbackNode;!function(e,t){for(var i=e.suspendedLanes,r=e.pingedLanes,n=e.expirationTimes,a=e.pendingLanes;0<a;){var o=31-ot(a),s=1<<o,l=n[o];-1===l?0!==(s&i)&&0===(s&r)||(n[o]=pt(s,t)):l<=t&&(e.expiredLanes|=s),a&=~s}}(e,t);var r=dt(e,e===Cl?kl:0);if(0===r)null!==i&&Qe(i),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=i&&Qe(i),1===t)0===e.tag?function(e){Nn=!0,jn(e)}(lc.bind(null,e)):jn(lc.bind(null,e)),on((function(){0===(6&Pl)&&Un()})),i=null;else{switch(xt(r)){case 1:i=$e;break;case 4:i=et;break;case 16:default:i=tt;break;case 536870912:i=rt}i=Cc(i,nc.bind(null,e))}e.callbackPriority=t,e.callbackNode=i}}function nc(e,t){if(Kl=-1,$l=0,0!==(6&Pl))throw Error(a(327));var i=e.callbackNode;if(wc()&&e.callbackNode!==i)return null;var r=dt(e,e===Cl?kl:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=gc(e,r);else{t=r;var n=Pl;Pl|=2;var o=fc();for(Cl===e&&kl===t||(Gl=null,Ul=Je()+500,dc(e,t));;)try{yc();break}catch(l){pc(e,l)}Ma(),El.current=o,Pl=n,null!==Il?t=0:(Cl=null,kl=0,t=Ll)}if(0!==t){if(2===t&&(0!==(n=ft(e))&&(r=n,t=ac(e,n))),1===t)throw i=zl,dc(e,0),sc(e,r),rc(e,Je()),i;if(6===t)sc(e,r);else{if(n=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var i=t.updateQueue;if(null!==i&&null!==(i=i.stores))for(var r=0;r<i.length;r++){var n=i[r],a=n.getSnapshot;n=n.value;try{if(!or(a(),n))return!1}catch(s){return!1}}}if(i=t.child,16384&t.subtreeFlags&&null!==i)i.return=t,t=i;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(n)&&(2===(t=gc(e,r))&&(0!==(o=ft(e))&&(r=o,t=ac(e,o))),1===t))throw i=zl,dc(e,0),sc(e,r),rc(e,Je()),i;switch(e.finishedWork=n,e.finishedLanes=r,t){case 0:case 1:throw Error(a(345));case 2:case 5:bc(e,Vl,Gl);break;case 3:if(sc(e,r),(130023424&r)===r&&10<(t=jl+500-Je())){if(0!==dt(e,0))break;if(((n=e.suspendedLanes)&r)!==r){ec(),e.pingedLanes|=e.suspendedLanes&n;break}e.timeoutHandle=rn(bc.bind(null,e,Vl,Gl),t);break}bc(e,Vl,Gl);break;case 4:if(sc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,n=-1;0<r;){var s=31-ot(r);o=1<<s,(s=t[s])>n&&(n=s),r&=~o}if(r=n,10<(r=(120>(r=Je()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Tl(r/1960))-r)){e.timeoutHandle=rn(bc.bind(null,e,Vl,Gl),r);break}bc(e,Vl,Gl);break;default:throw Error(a(329))}}}return rc(e,Je()),e.callbackNode===i?nc.bind(null,e):null}function ac(e,t){var i=Nl;return e.current.memoizedState.isDehydrated&&(dc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=Vl,Vl=i,null!==t&&oc(t)),e}function oc(e){null===Vl?Vl=e:Vl.push.apply(Vl,e)}function sc(e,t){for(t&=~Bl,t&=~Ol,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-ot(t),r=1<<i;e[i]=-1,t&=~r}}function lc(e){if(0!==(6&Pl))throw Error(a(327));wc();var t=dt(e,0);if(0===(1&t))return rc(e,Je()),null;var i=gc(e,t);if(0!==e.tag&&2===i){var r=ft(e);0!==r&&(t=r,i=ac(e,r))}if(1===i)throw i=zl,dc(e,0),sc(e,t),rc(e,Je()),i;if(6===i)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,bc(e,Vl,Gl),rc(e,Je()),null}function cc(e,t){var i=Pl;Pl|=1;try{return e(t)}finally{0===(Pl=i)&&(Ul=Je()+500,Nn&&Un())}}function hc(e){null!==Ql&&0===Ql.tag&&0===(6&Pl)&&wc();var t=Pl;Pl|=1;var i=Al.transition,r=vt;try{if(Al.transition=null,vt=1,e)return e()}finally{vt=r,Al.transition=i,0===(6&(Pl=t))&&Un()}}function uc(){Dl=Rl.current,En(Rl)}function dc(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(-1!==i&&(e.timeoutHandle=-1,nn(i)),null!==Il)for(i=Il.return;null!==i;){var r=i;switch(ta(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Rn();break;case 3:Ya(),En(Cn),En(Pn),io();break;case 5:Ka(r);break;case 4:Ya();break;case 13:case 19:En($a);break;case 10:Aa(r.type._context);break;case 22:case 23:uc()}i=i.return}if(Cl=e,Il=e=Rc(e.current,null),kl=Dl=t,Ll=0,zl=null,Bl=Ol=Fl=0,Vl=Nl=null,null!==ka){for(t=0;t<ka.length;t++)if(null!==(r=(i=ka[t]).interleaved)){i.interleaved=null;var n=r.next,a=i.pending;if(null!==a){var o=a.next;a.next=n,r.next=o}i.pending=r}ka=null}return e}function pc(e,t){for(;;){var i=Il;try{if(Ma(),ro.current=Ko,co){for(var r=oo.memoizedState;null!==r;){var n=r.queue;null!==n&&(n.pending=null),r=r.next}co=!1}if(ao=0,lo=so=oo=null,ho=!1,uo=0,Ml.current=null,null===i||null===i.return){Ll=1,zl=t,Il=null;break}e:{var o=e,s=i.return,l=i,c=t;if(t=kl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var h=c,u=l,d=u.tag;if(0===(1&u.mode)&&(0===d||11===d||15===d)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=gs(s);if(null!==f){f.flags&=-257,_s(f,s,l,0,t),1&f.mode&&ms(o,h,t),c=h;var m=(t=f).updateQueue;if(null===m){var g=new Set;g.add(c),t.updateQueue=g}else m.add(c);break e}if(0===(1&t)){ms(o,h,t),mc();break e}c=Error(a(426))}else if(na&&1&l.mode){var _=gs(s);if(null!==_){0===(65536&_.flags)&&(_.flags|=256),_s(_,s,l,0,t),fa(cs(c,l));break e}}o=c=cs(c,l),4!==Ll&&(Ll=2),null===Nl?Nl=[o]:Nl.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,ja(o,ps(0,c,t));break e;case 1:l=c;var y=o.type,v=o.stateNode;if(0===(128&o.flags)&&("function"===typeof y.getDerivedStateFromError||null!==v&&"function"===typeof v.componentDidCatch&&(null===Wl||!Wl.has(v)))){o.flags|=65536,t&=-t,o.lanes|=t,ja(o,fs(o,l,t));break e}}o=o.return}while(null!==o)}xc(i)}catch(x){t=x,Il===i&&null!==i&&(Il=i=i.return);continue}break}}function fc(){var e=El.current;return El.current=Ko,null===e?Ko:e}function mc(){0!==Ll&&3!==Ll&&2!==Ll||(Ll=4),null===Cl||0===(268435455&Fl)&&0===(268435455&Ol)||sc(Cl,kl)}function gc(e,t){var i=Pl;Pl|=2;var r=fc();for(Cl===e&&kl===t||(Gl=null,dc(e,t));;)try{_c();break}catch(n){pc(e,n)}if(Ma(),Pl=i,El.current=r,null!==Il)throw Error(a(261));return Cl=null,kl=0,Ll}function _c(){for(;null!==Il;)vc(Il)}function yc(){for(;null!==Il&&!Xe();)vc(Il)}function vc(e){var t=Sl(e.alternate,e,Dl);e.memoizedProps=e.pendingProps,null===t?xc(e):Il=t,Ml.current=null}function xc(e){var t=e;do{var i=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(i=Zs(i,t,Dl)))return void(Il=i)}else{if(null!==(i=Qs(i,t)))return i.flags&=32767,void(Il=i);if(null===e)return Ll=6,void(Il=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Il=t);Il=t=e}while(null!==t);0===Ll&&(Ll=5)}function bc(e,t,i){var r=vt,n=Al.transition;try{Al.transition=null,vt=1,function(e,t,i,r){do{wc()}while(null!==Ql);if(0!==(6&Pl))throw Error(a(327));i=e.finishedWork;var n=e.finishedLanes;if(null===i)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var o=i.lanes|i.childLanes;if(function(e,t){var i=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<i;){var n=31-ot(i),a=1<<n;t[n]=0,r[n]=-1,e[n]=-1,i&=~a}}(e,o),e===Cl&&(Il=Cl=null,kl=0),0===(2064&i.subtreeFlags)&&0===(2064&i.flags)||Zl||(Zl=!0,Cc(tt,(function(){return wc(),null}))),o=0!==(15990&i.flags),0!==(15990&i.subtreeFlags)||o){o=Al.transition,Al.transition=null;var s=vt;vt=1;var l=Pl;Pl|=4,Ml.current=null,function(e,t){if($r=qt,dr(e=ur())){if("selectionStart"in e)var i={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(i=(i=e.ownerDocument)&&i.defaultView||window).getSelection&&i.getSelection();if(r&&0!==r.rangeCount){i=r.anchorNode;var n=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{i.nodeType,o.nodeType}catch(b){i=null;break e}var s=0,l=-1,c=-1,h=0,u=0,d=e,p=null;t:for(;;){for(var f;d!==i||0!==n&&3!==d.nodeType||(l=s+n),d!==o||0!==r&&3!==d.nodeType||(c=s+r),3===d.nodeType&&(s+=d.nodeValue.length),null!==(f=d.firstChild);)p=d,d=f;for(;;){if(d===e)break t;if(p===i&&++h===n&&(l=s),p===o&&++u===r&&(c=s),null!==(f=d.nextSibling))break;p=(d=p).parentNode}d=f}i=-1===l||-1===c?null:{start:l,end:c}}else i=null}i=i||{start:0,end:0}}else i=null;for(en={focusedElem:e,selectionRange:i},qt=!1,Ks=t;null!==Ks;)if(e=(t=Ks).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Ks=e;else for(;null!==Ks;){t=Ks;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var g=m.memoizedProps,_=m.memoizedState,y=t.stateNode,v=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:is(t.type,g),_);y.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(a(163))}}catch(b){Tc(t,t.return,b)}if(null!==(e=t.sibling)){e.return=t.return,Ks=e;break}Ks=t.return}m=tl,tl=!1}(e,i),gl(i,e),pr(en),qt=!!$r,en=$r=null,e.current=i,yl(i,e,n),Ye(),Pl=l,vt=s,Al.transition=o}else e.current=i;if(Zl&&(Zl=!1,Ql=e,Xl=n),o=e.pendingLanes,0===o&&(Wl=null),function(e){if(at&&"function"===typeof at.onCommitFiberRoot)try{at.onCommitFiberRoot(nt,e,void 0,128===(128&e.current.flags))}catch(t){}}(i.stateNode),rc(e,Je()),null!==t)for(r=e.onRecoverableError,i=0;i<t.length;i++)n=t[i],r(n.value,{componentStack:n.stack,digest:n.digest});if(ql)throw ql=!1,e=Hl,Hl=null,e;0!==(1&Xl)&&0!==e.tag&&wc(),o=e.pendingLanes,0!==(1&o)?e===Jl?Yl++:(Yl=0,Jl=e):Yl=0,Un()}(e,t,i,r)}finally{Al.transition=n,vt=r}return null}function wc(){if(null!==Ql){var e=xt(Xl),t=Al.transition,i=vt;try{if(Al.transition=null,vt=16>e?16:e,null===Ql)var r=!1;else{if(e=Ql,Ql=null,Xl=0,0!==(6&Pl))throw Error(a(331));var n=Pl;for(Pl|=4,Ks=e.current;null!==Ks;){var o=Ks,s=o.child;if(0!==(16&Ks.flags)){var l=o.deletions;if(null!==l){for(var c=0;c<l.length;c++){var h=l[c];for(Ks=h;null!==Ks;){var u=Ks;switch(u.tag){case 0:case 11:case 15:il(8,u,o)}var d=u.child;if(null!==d)d.return=u,Ks=d;else for(;null!==Ks;){var p=(u=Ks).sibling,f=u.return;if(al(u),u===h){Ks=null;break}if(null!==p){p.return=f,Ks=p;break}Ks=f}}}var m=o.alternate;if(null!==m){var g=m.child;if(null!==g){m.child=null;do{var _=g.sibling;g.sibling=null,g=_}while(null!==g)}}Ks=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,Ks=s;else e:for(;null!==Ks;){if(0!==(2048&(o=Ks).flags))switch(o.tag){case 0:case 11:case 15:il(9,o,o.return)}var y=o.sibling;if(null!==y){y.return=o.return,Ks=y;break e}Ks=o.return}}var v=e.current;for(Ks=v;null!==Ks;){var x=(s=Ks).child;if(0!==(2064&s.subtreeFlags)&&null!==x)x.return=s,Ks=x;else e:for(s=v;null!==Ks;){if(0!==(2048&(l=Ks).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(w){Tc(l,l.return,w)}if(l===s){Ks=null;break e}var b=l.sibling;if(null!==b){b.return=l.return,Ks=b;break e}Ks=l.return}}if(Pl=n,Un(),at&&"function"===typeof at.onPostCommitFiberRoot)try{at.onPostCommitFiberRoot(nt,e)}catch(w){}r=!0}return r}finally{vt=i,Al.transition=t}}return!1}function Sc(e,t,i){e=Na(e,t=ps(0,t=cs(i,t),1),1),t=ec(),null!==e&&(_t(e,1,t),rc(e,t))}function Tc(e,t,i){if(3===e.tag)Sc(e,e,i);else for(;null!==t;){if(3===t.tag){Sc(t,e,i);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Wl||!Wl.has(r))){t=Na(t,e=fs(t,e=cs(i,e),1),1),e=ec(),null!==t&&(_t(t,1,e),rc(t,e));break}}t=t.return}}function Ec(e,t,i){var r=e.pingCache;null!==r&&r.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&i,Cl===e&&(kl&i)===i&&(4===Ll||3===Ll&&(130023424&kl)===kl&&500>Je()-jl?dc(e,0):Bl|=i),rc(e,t)}function Mc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ht,0===(130023424&(ht<<=1))&&(ht=4194304)));var i=ec();null!==(e=La(e,t))&&(_t(e,t,i),rc(e,i))}function Ac(e){var t=e.memoizedState,i=0;null!==t&&(i=t.retryLane),Mc(e,i)}function Pc(e,t){var i=0;switch(e.tag){case 13:var r=e.stateNode,n=e.memoizedState;null!==n&&(i=n.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(a(314))}null!==r&&r.delete(t),Mc(e,i)}function Cc(e,t){return Ze(e,t)}function Ic(e,t,i,r){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function kc(e,t,i,r){return new Ic(e,t,i,r)}function Dc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Rc(e,t){var i=e.alternate;return null===i?((i=kc(e.tag,t,e.key,e.mode)).elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=14680064&e.flags,i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function Lc(e,t,i,r,n,o){var s=2;if(r=e,"function"===typeof e)Dc(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case S:return zc(i.children,n,o,t);case T:s=8,n|=8;break;case E:return(e=kc(12,i,t,2|n)).elementType=E,e.lanes=o,e;case C:return(e=kc(13,i,t,n)).elementType=C,e.lanes=o,e;case I:return(e=kc(19,i,t,n)).elementType=I,e.lanes=o,e;case R:return Fc(i,n,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case M:s=10;break e;case A:s=9;break e;case P:s=11;break e;case k:s=14;break e;case D:s=16,r=null;break e}throw Error(a(130,null==e?e:typeof e,""))}return(t=kc(s,i,t,n)).elementType=e,t.type=r,t.lanes=o,t}function zc(e,t,i,r){return(e=kc(7,e,r,t)).lanes=i,e}function Fc(e,t,i,r){return(e=kc(22,e,r,t)).elementType=R,e.lanes=i,e.stateNode={isHidden:!1},e}function Oc(e,t,i){return(e=kc(6,e,null,t)).lanes=i,e}function Bc(e,t,i){return(t=kc(4,null!==e.children?e.children:[],e.key,t)).lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Nc(e,t,i,r,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gt(0),this.expirationTimes=gt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gt(0),this.identifierPrefix=r,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function Vc(e,t,i,r,n,a,o,s,l){return e=new Nc(e,t,i,s,l),1===t?(t=1,!0===a&&(t|=8)):t=0,a=kc(3,null,null,t),e.current=a,a.stateNode=e,a.memoizedState={element:r,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},Fa(a),e}function jc(e){if(!e)return An;e:{if(Ue(e=e._reactInternals)!==e||1!==e.tag)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Dn(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(a(171))}if(1===e.tag){var i=e.type;if(Dn(i))return zn(e,i,t)}return t}function Uc(e,t,i,r,n,a,o,s,l){return(e=Vc(i,r,!0,e,0,a,0,s,l)).context=jc(null),i=e.current,(a=Ba(r=ec(),n=tc(i))).callback=void 0!==t&&null!==t?t:null,Na(i,a,n),e.current.lanes=n,_t(e,n,r),rc(e,r),e}function Gc(e,t,i,r){var n=t.current,a=ec(),o=tc(n);return i=jc(i),null===t.context?t.context=i:t.pendingContext=i,(t=Ba(a,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Na(n,t,o))&&(ic(e,n,o,a),Va(e,n,o)),o}function qc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Hc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var i=e.retryLane;e.retryLane=0!==i&&i<t?i:t}}function Wc(e,t){Hc(e,t),(e=e.alternate)&&Hc(e,t)}Sl=function(e,t,i){if(null!==e)if(e.memoizedProps!==t.pendingProps||Cn.current)vs=!0;else{if(0===(e.lanes&i)&&0===(128&t.flags))return vs=!1,function(e,t,i){switch(t.tag){case 3:Cs(t),pa();break;case 5:Ja(t);break;case 1:Dn(t.type)&&Fn(t);break;case 4:Xa(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,n=t.memoizedProps.value;Mn(wa,r._currentValue),r._currentValue=n;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Mn($a,1&$a.current),t.flags|=128,null):0!==(i&t.child.childLanes)?Os(e,t,i):(Mn($a,1&$a.current),null!==(e=qs(e,t,i))?e.sibling:null);Mn($a,1&$a.current);break;case 19:if(r=0!==(i&t.childLanes),0!==(128&e.flags)){if(r)return Us(e,t,i);t.flags|=128}if(null!==(n=t.memoizedState)&&(n.rendering=null,n.tail=null,n.lastEffect=null),Mn($a,$a.current),r)break;return null;case 22:case 23:return t.lanes=0,Ts(e,t,i)}return qs(e,t,i)}(e,t,i);vs=0!==(131072&e.flags)}else vs=!1,na&&0!==(1048576&t.flags)&&$n(t,Wn,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Gs(e,t),e=t.pendingProps;var n=kn(t,Pn.current);Ca(t,i),n=go(null,t,r,e,n,i);var o=_o();return t.flags|=1,"object"===typeof n&&null!==n&&"function"===typeof n.render&&void 0===n.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Dn(r)?(o=!0,Fn(t)):o=!1,t.memoizedState=null!==n.state&&void 0!==n.state?n.state:null,Fa(t),n.updater=ns,t.stateNode=n,n._reactInternals=t,ls(t,r,e,i),t=Ps(null,t,r,!0,o,i)):(t.tag=0,na&&o&&ea(t),xs(null,t,n,i),t=t.child),t;case 16:r=t.elementType;e:{switch(Gs(e,t),e=t.pendingProps,r=(n=r._init)(r._payload),t.type=r,n=t.tag=function(e){if("function"===typeof e)return Dc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===P)return 11;if(e===k)return 14}return 2}(r),e=is(r,e),n){case 0:t=Ms(null,t,r,e,i);break e;case 1:t=As(null,t,r,e,i);break e;case 11:t=bs(null,t,r,e,i);break e;case 14:t=ws(null,t,r,is(r.type,e),i);break e}throw Error(a(306,r,""))}return t;case 0:return r=t.type,n=t.pendingProps,Ms(e,t,r,n=t.elementType===r?n:is(r,n),i);case 1:return r=t.type,n=t.pendingProps,As(e,t,r,n=t.elementType===r?n:is(r,n),i);case 3:e:{if(Cs(t),null===e)throw Error(a(387));r=t.pendingProps,n=(o=t.memoizedState).element,Oa(e,t),Ua(t,r,null,i);var s=t.memoizedState;if(r=s.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Is(e,t,r,i,n=cs(Error(a(423)),t));break e}if(r!==n){t=Is(e,t,r,i,n=cs(Error(a(424)),t));break e}for(ra=cn(t.stateNode.containerInfo.firstChild),ia=t,na=!0,aa=null,i=ba(t,null,r,i),t.child=i;i;)i.flags=-3&i.flags|4096,i=i.sibling}else{if(pa(),r===n){t=qs(e,t,i);break e}xs(e,t,r,i)}t=t.child}return t;case 5:return Ja(t),null===e&&ca(t),r=t.type,n=t.pendingProps,o=null!==e?e.memoizedProps:null,s=n.children,tn(r,n)?s=null:null!==o&&tn(r,o)&&(t.flags|=32),Es(e,t),xs(e,t,s,i),t.child;case 6:return null===e&&ca(t),null;case 13:return Os(e,t,i);case 4:return Xa(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=xa(t,null,r,i):xs(e,t,r,i),t.child;case 11:return r=t.type,n=t.pendingProps,bs(e,t,r,n=t.elementType===r?n:is(r,n),i);case 7:return xs(e,t,t.pendingProps,i),t.child;case 8:case 12:return xs(e,t,t.pendingProps.children,i),t.child;case 10:e:{if(r=t.type._context,n=t.pendingProps,o=t.memoizedProps,s=n.value,Mn(wa,r._currentValue),r._currentValue=s,null!==o)if(or(o.value,s)){if(o.children===n.children&&!Cn.current){t=qs(e,t,i);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var l=o.dependencies;if(null!==l){s=o.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===o.tag){(c=Ba(-1,i&-i)).tag=2;var h=o.updateQueue;if(null!==h){var u=(h=h.shared).pending;null===u?c.next=c:(c.next=u.next,u.next=c),h.pending=c}}o.lanes|=i,null!==(c=o.alternate)&&(c.lanes|=i),Pa(o.return,i,t),l.lanes|=i;break}c=c.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(a(341));s.lanes|=i,null!==(l=s.alternate)&&(l.lanes|=i),Pa(s,i,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}xs(e,t,n.children,i),t=t.child}return t;case 9:return n=t.type,r=t.pendingProps.children,Ca(t,i),r=r(n=Ia(n)),t.flags|=1,xs(e,t,r,i),t.child;case 14:return n=is(r=t.type,t.pendingProps),ws(e,t,r,n=is(r.type,n),i);case 15:return Ss(e,t,t.type,t.pendingProps,i);case 17:return r=t.type,n=t.pendingProps,n=t.elementType===r?n:is(r,n),Gs(e,t),t.tag=1,Dn(r)?(e=!0,Fn(t)):e=!1,Ca(t,i),os(t,r,n),ls(t,r,n,i),Ps(null,t,r,!0,e,i);case 19:return Us(e,t,i);case 22:return Ts(e,t,i)}throw Error(a(156,t.tag))};var Zc="function"===typeof reportError?reportError:function(e){console.error(e)};function Qc(e){this._internalRoot=e}function Xc(e){this._internalRoot=e}function Yc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Kc(){}function $c(e,t,i,r,n){var a=i._reactRootContainer;if(a){var o=a;if("function"===typeof n){var s=n;n=function(){var e=qc(o);s.call(e)}}Gc(t,o,e,n)}else o=function(e,t,i,r,n){if(n){if("function"===typeof r){var a=r;r=function(){var e=qc(o);a.call(e)}}var o=Uc(t,r,e,0,null,!1,0,"",Kc);return e._reactRootContainer=o,e[fn]=o.current,jr(8===e.nodeType?e.parentNode:e),hc(),o}for(;n=e.lastChild;)e.removeChild(n);if("function"===typeof r){var s=r;r=function(){var e=qc(l);s.call(e)}}var l=Vc(e,0,!1,null,0,!1,0,"",Kc);return e._reactRootContainer=l,e[fn]=l.current,jr(8===e.nodeType?e.parentNode:e),hc((function(){Gc(t,l,i,r)})),l}(i,t,e,n,r);return qc(o)}Xc.prototype.render=Qc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(a(409));Gc(e,t,null,null)},Xc.prototype.unmount=Qc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;hc((function(){Gc(null,e,null,null)})),t[fn]=null}},Xc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Tt();e={blockedOn:null,target:e,priority:t};for(var i=0;i<Rt.length&&0!==t&&t<Rt[i].priority;i++);Rt.splice(i,0,e),0===i&&Ot(e)}},bt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var i=ut(t.pendingLanes);0!==i&&(yt(t,1|i),rc(t,Je()),0===(6&Pl)&&(Ul=Je()+500,Un()))}break;case 13:hc((function(){var t=La(e,1);if(null!==t){var i=ec();ic(t,e,1,i)}})),Wc(e,1)}},wt=function(e){if(13===e.tag){var t=La(e,134217728);if(null!==t)ic(t,e,134217728,ec());Wc(e,134217728)}},St=function(e){if(13===e.tag){var t=tc(e),i=La(e,t);if(null!==i)ic(i,e,t,ec());Wc(e,t)}},Tt=function(){return vt},Et=function(e,t){var i=vt;try{return vt=e,t()}finally{vt=i}},we=function(e,t,i){switch(t){case"input":if(K(e,i),t=i.name,"radio"===i.type&&null!=t){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var r=i[t];if(r!==e&&r.form===e.form){var n=bn(r);if(!n)throw Error(a(90));Z(r),K(r,n)}}}break;case"textarea":ae(e,i);break;case"select":null!=(t=i.value)&&ie(e,!!i.multiple,t,!1)}},Pe=cc,Ce=hc;var eh={usingClientEntryPoint:!1,Events:[vn,xn,bn,Me,Ae,cc]},th={findFiberByHostInstance:yn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ih={bundleType:th.bundleType,version:th.version,rendererPackageName:th.rendererPackageName,rendererConfig:th.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:th.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var rh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!rh.isDisabled&&rh.supportsFiber)try{nt=rh.inject(ih),at=rh}catch(he){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=eh,t.createPortal=function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Yc(t))throw Error(a(200));return function(e,t,i){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==r?null:""+r,children:e,containerInfo:t,implementation:i}}(e,t,null,i)},t.createRoot=function(e,t){if(!Yc(e))throw Error(a(299));var i=!1,r="",n=Zc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(i=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(n=t.onRecoverableError)),t=Vc(e,1,!1,null,0,i,0,r,n),e[fn]=t.current,jr(8===e.nodeType?e.parentNode:e),new Qc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(a(188));throw e=Object.keys(e).join(","),Error(a(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return hc(e)},t.hydrate=function(e,t,i){if(!Jc(t))throw Error(a(200));return $c(null,e,t,!0,i)},t.hydrateRoot=function(e,t,i){if(!Yc(e))throw Error(a(405));var r=null!=i&&i.hydratedSources||null,n=!1,o="",s=Zc;if(null!==i&&void 0!==i&&(!0===i.unstable_strictMode&&(n=!0),void 0!==i.identifierPrefix&&(o=i.identifierPrefix),void 0!==i.onRecoverableError&&(s=i.onRecoverableError)),t=Uc(t,null,e,1,null!=i?i:null,n,0,o,s),e[fn]=t.current,jr(e),r)for(e=0;e<r.length;e++)n=(n=(i=r[e])._getVersion)(i._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[i,n]:t.mutableSourceEagerHydrationData.push(i,n);return new Xc(t)},t.render=function(e,t,i){if(!Jc(t))throw Error(a(200));return $c(null,e,t,!1,i)},t.unmountComponentAtNode=function(e){if(!Jc(e))throw Error(a(40));return!!e._reactRootContainer&&(hc((function(){$c(null,null,e,!1,(function(){e._reactRootContainer=null,e[fn]=null}))})),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,i,r){if(!Jc(i))throw Error(a(200));if(null==e||void 0===e._reactInternals)throw Error(a(38));return $c(e,t,i,!1,r)},t.version="18.3.1-next-f1338f8080-20240426"},4391:(e,t,i)=>{"use strict";var r=i(7950);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},7950:(e,t,i)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=i(2730)},5226:(e,t,i)=>{"use strict";var r=d(i(4414)),n=d(i(7360)),a=d(i(6731)),o=d(i(2239)),s=d(i(1912)),l=d(i(6835)),c=d(i(5043)),h=d(i(5173)),u=d(i(1302));function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(){var e,i,r,o;(0,a.default)(this,t);for(var l=arguments.length,c=Array(l),h=0;h<l;h++)c[h]=arguments[h];return i=r=(0,s.default)(this,(e=t.__proto__||(0,n.default)(t)).call.apply(e,[this].concat(c))),r.handleClickToPause=function(){r.anim.isPaused?r.anim.play():r.anim.pause()},o=i,(0,s.default)(r,o)}return(0,l.default)(t,e),(0,o.default)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.options,i=e.eventListeners,n=t.loop,a=t.autoplay,o=t.animationData,s=t.rendererSettings,l=t.segments;this.options={container:this.el,renderer:"svg",loop:!1!==n,autoplay:!1!==a,segments:!1!==l,animationData:o,rendererSettings:s},this.options=(0,r.default)({},this.options,t),this.anim=u.default.loadAnimation(this.options),this.registerEvents(i)}},{key:"componentWillUpdate",value:function(e){this.options.animationData!==e.options.animationData&&(this.deRegisterEvents(this.props.eventListeners),this.destroy(),this.options=(0,r.default)({},this.options,e.options),this.anim=u.default.loadAnimation(this.options),this.registerEvents(e.eventListeners))}},{key:"componentDidUpdate",value:function(){this.props.isStopped?this.stop():this.props.segments?this.playSegments():this.play(),this.pause(),this.setSpeed(),this.setDirection()}},{key:"componentWillUnmount",value:function(){this.deRegisterEvents(this.props.eventListeners),this.destroy(),this.options.animationData=null,this.anim=null}},{key:"setSpeed",value:function(){this.anim.setSpeed(this.props.speed)}},{key:"setDirection",value:function(){this.anim.setDirection(this.props.direction)}},{key:"play",value:function(){this.anim.play()}},{key:"playSegments",value:function(){this.anim.playSegments(this.props.segments)}},{key:"stop",value:function(){this.anim.stop()}},{key:"pause",value:function(){(this.props.isPaused&&!this.anim.isPaused||!this.props.isPaused&&this.anim.isPaused)&&this.anim.pause()}},{key:"destroy",value:function(){this.anim.destroy()}},{key:"registerEvents",value:function(e){var t=this;e.forEach((function(e){t.anim.addEventListener(e.eventName,e.callback)}))}},{key:"deRegisterEvents",value:function(e){var t=this;e.forEach((function(e){t.anim.removeEventListener(e.eventName,e.callback)}))}},{key:"render",value:function(){var e=this,t=this.props,i=t.width,n=t.height,a=t.ariaRole,o=t.ariaLabel,s=t.isClickToPauseDisabled,l=t.title,h=function(e){return"number"===typeof e?e+"px":e||"100%"},u=(0,r.default)({width:h(i),height:h(n),overflow:"hidden",margin:"0 auto",outline:"none"},this.props.style),d=s?function(){return null}:this.handleClickToPause;return c.default.createElement("div",{ref:function(t){e.el=t},style:u,onClick:d,title:l,role:a,"aria-label":o,tabIndex:"0"})}}]),t}(c.default.Component);t.A=p,p.propTypes={eventListeners:h.default.arrayOf(h.default.object),options:h.default.object.isRequired,height:h.default.oneOfType([h.default.string,h.default.number]),width:h.default.oneOfType([h.default.string,h.default.number]),isStopped:h.default.bool,isPaused:h.default.bool,speed:h.default.number,segments:h.default.arrayOf(h.default.number),direction:h.default.number,ariaRole:h.default.string,ariaLabel:h.default.string,isClickToPauseDisabled:h.default.bool,title:h.default.string,style:h.default.string},p.defaultProps={eventListeners:[],isStopped:!1,isPaused:!1,speed:1,ariaRole:"button",ariaLabel:"animation",isClickToPauseDisabled:!1,title:""}},1153:(e,t,i)=>{"use strict";var r=i(5043),n=Symbol.for("react.element"),a=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,i){var r,a={},c=null,h=null;for(r in void 0!==i&&(c=""+i),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(h=t.ref),t)o.call(t,r)&&!l.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:n,type:e,key:c,ref:h,props:a,_owner:s.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},4202:(e,t)=>{"use strict";var i=Symbol.for("react.element"),r=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function _(e,t,i){this.props=e,this.context=t,this.refs=g,this.updater=i||f}function y(){}function v(e,t,i){this.props=e,this.context=t,this.refs=g,this.updater=i||f}_.prototype.isReactComponent={},_.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},_.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=_.prototype;var x=v.prototype=new y;x.constructor=v,m(x,_.prototype),x.isPureReactComponent=!0;var b=Array.isArray,w=Object.prototype.hasOwnProperty,S={current:null},T={key:!0,ref:!0,__self:!0,__source:!0};function E(e,t,r){var n,a={},o=null,s=null;if(null!=t)for(n in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)w.call(t,n)&&!T.hasOwnProperty(n)&&(a[n]=t[n]);var l=arguments.length-2;if(1===l)a.children=r;else if(1<l){for(var c=Array(l),h=0;h<l;h++)c[h]=arguments[h+2];a.children=c}if(e&&e.defaultProps)for(n in l=e.defaultProps)void 0===a[n]&&(a[n]=l[n]);return{$$typeof:i,type:e,key:o,ref:s,props:a,_owner:S.current}}function M(e){return"object"===typeof e&&null!==e&&e.$$typeof===i}var A=/\/+/g;function P(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function C(e,t,n,a,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l=!1;if(null===e)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case i:case r:l=!0}}if(l)return o=o(l=e),e=""===a?"."+P(l,0):a,b(o)?(n="",null!=e&&(n=e.replace(A,"$&/")+"/"),C(o,t,n,"",(function(e){return e}))):null!=o&&(M(o)&&(o=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,n+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(A,"$&/")+"/")+e)),t.push(o)),1;if(l=0,a=""===a?".":a+":",b(e))for(var c=0;c<e.length;c++){var h=a+P(s=e[c],c);l+=C(s,t,n,h,o)}else if(h=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=p&&e[p]||e["@@iterator"])?e:null}(e),"function"===typeof h)for(e=h.call(e),c=0;!(s=e.next()).done;)l+=C(s=s.value,t,n,h=a+P(s,c++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function I(e,t,i){if(null==e)return e;var r=[],n=0;return C(e,r,"","",(function(e){return t.call(i,e,n++)})),r}function k(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D={current:null},R={transition:null},L={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:R,ReactCurrentOwner:S};function z(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:I,forEach:function(e,t,i){I(e,(function(){t.apply(this,arguments)}),i)},count:function(e){var t=0;return I(e,(function(){t++})),t},toArray:function(e){return I(e,(function(e){return e}))||[]},only:function(e){if(!M(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=_,t.Fragment=n,t.Profiler=o,t.PureComponent=v,t.StrictMode=a,t.Suspense=h,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=L,t.act=z,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=m({},e.props),a=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=S.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)w.call(t,c)&&!T.hasOwnProperty(c)&&(n[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)n.children=r;else if(1<c){l=Array(c);for(var h=0;h<c;h++)l[h]=arguments[h+2];n.children=l}return{$$typeof:i,type:e.type,key:a,ref:o,props:n,_owner:s}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=E,t.createFactory=function(e){var t=E.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=M,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:k}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=R.transition;R.transition={};try{e()}finally{R.transition=t}},t.unstable_act=z,t.useCallback=function(e,t){return D.current.useCallback(e,t)},t.useContext=function(e){return D.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return D.current.useDeferredValue(e)},t.useEffect=function(e,t){return D.current.useEffect(e,t)},t.useId=function(){return D.current.useId()},t.useImperativeHandle=function(e,t,i){return D.current.useImperativeHandle(e,t,i)},t.useInsertionEffect=function(e,t){return D.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return D.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return D.current.useMemo(e,t)},t.useReducer=function(e,t,i){return D.current.useReducer(e,t,i)},t.useRef=function(e){return D.current.useRef(e)},t.useState=function(e){return D.current.useState(e)},t.useSyncExternalStore=function(e,t,i){return D.current.useSyncExternalStore(e,t,i)},t.useTransition=function(){return D.current.useTransition()},t.version="18.3.1"},5043:(e,t,i)=>{"use strict";e.exports=i(4202)},579:(e,t,i)=>{"use strict";e.exports=i(1153)},7234:(e,t)=>{"use strict";function i(e,t){var i=e.length;e.push(t);e:for(;0<i;){var r=i-1>>>1,n=e[r];if(!(0<a(n,t)))break e;e[r]=t,e[i]=n,i=r}}function r(e){return 0===e.length?null:e[0]}function n(e){if(0===e.length)return null;var t=e[0],i=e.pop();if(i!==t){e[0]=i;e:for(var r=0,n=e.length,o=n>>>1;r<o;){var s=2*(r+1)-1,l=e[s],c=s+1,h=e[c];if(0>a(l,i))c<n&&0>a(h,l)?(e[r]=h,e[c]=i,r=c):(e[r]=l,e[s]=i,r=s);else{if(!(c<n&&0>a(h,i)))break e;e[r]=h,e[c]=i,r=c}}}return t}function a(e,t){var i=e.sortIndex-t.sortIndex;return 0!==i?i:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,l=s.now();t.unstable_now=function(){return s.now()-l}}var c=[],h=[],u=1,d=null,p=3,f=!1,m=!1,g=!1,_="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,v="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=r(h);null!==t;){if(null===t.callback)n(h);else{if(!(t.startTime<=e))break;n(h),t.sortIndex=t.expirationTime,i(c,t)}t=r(h)}}function b(e){if(g=!1,x(e),!m)if(null!==r(c))m=!0,R(w);else{var t=r(h);null!==t&&L(b,t.startTime-e)}}function w(e,i){m=!1,g&&(g=!1,y(M),M=-1),f=!0;var a=p;try{for(x(i),d=r(c);null!==d&&(!(d.expirationTime>i)||e&&!C());){var o=d.callback;if("function"===typeof o){d.callback=null,p=d.priorityLevel;var s=o(d.expirationTime<=i);i=t.unstable_now(),"function"===typeof s?d.callback=s:d===r(c)&&n(c),x(i)}else n(c);d=r(c)}if(null!==d)var l=!0;else{var u=r(h);null!==u&&L(b,u.startTime-i),l=!1}return l}finally{d=null,p=a,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,T=!1,E=null,M=-1,A=5,P=-1;function C(){return!(t.unstable_now()-P<A)}function I(){if(null!==E){var e=t.unstable_now();P=e;var i=!0;try{i=E(!0,e)}finally{i?S():(T=!1,E=null)}}else T=!1}if("function"===typeof v)S=function(){v(I)};else if("undefined"!==typeof MessageChannel){var k=new MessageChannel,D=k.port2;k.port1.onmessage=I,S=function(){D.postMessage(null)}}else S=function(){_(I,0)};function R(e){E=e,T||(T=!0,S())}function L(e,i){M=_((function(){e(t.unstable_now())}),i)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||f||(m=!0,R(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var i=p;p=t;try{return e()}finally{p=i}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var i=p;p=e;try{return t()}finally{p=i}},t.unstable_scheduleCallback=function(e,n,a){var o=t.unstable_now();switch("object"===typeof a&&null!==a?a="number"===typeof(a=a.delay)&&0<a?o+a:o:a=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:u++,callback:n,priorityLevel:e,startTime:a,expirationTime:s=a+s,sortIndex:-1},a>o?(e.sortIndex=a,i(h,e),null===r(c)&&e===r(h)&&(g?(y(M),M=-1):g=!0,L(b,a-o))):(e.sortIndex=s,i(c,e),m||f||(m=!0,R(w))),e},t.unstable_shouldYield=C,t.unstable_wrapCallback=function(e){var t=p;return function(){var i=p;p=t;try{return e.apply(this,arguments)}finally{p=i}}}},8853:(e,t,i)=>{"use strict";e.exports=i(7234)}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(i.exports,i,i.exports,__webpack_require__),i.exports}__webpack_require__.amdO={},__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;__webpack_require__.t=function(i,r){if(1&r&&(i=this(i)),8&r)return i;if("object"===typeof i&&i){if(4&r&&i.__esModule)return i;if(16&r&&"function"===typeof i.then)return i}var n=Object.create(null);__webpack_require__.r(n);var a={};e=e||[null,t({}),t([]),t(t)];for(var o=2&r&&i;"object"==typeof o&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach((e=>a[e]=()=>i[e]));return a.default=()=>i,__webpack_require__.d(n,a),n}})(),__webpack_require__.d=(e,t)=>{for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.p="/keepers_app/";var __webpack_exports__={};(()=>{"use strict";var e,t=__webpack_require__(5043),i=__webpack_require__.t(t,2),r=__webpack_require__(4391),n=__webpack_require__(7950),a=__webpack_require__.t(n,2);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},o.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(e||(e={}));const s="popstate";function l(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function c(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(i){}}}function h(e,t){return{usr:e.state,key:e.key,idx:t}}function u(e,t,i,r){return void 0===i&&(i=null),o({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?p(t):t,{state:i,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function d(e){let{pathname:t="/",search:i="",hash:r=""}=e;return i&&"?"!==i&&(t+="?"===i.charAt(0)?i:"?"+i),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function p(e){let t={};if(e){let i=e.indexOf("#");i>=0&&(t.hash=e.substr(i),e=e.substr(0,i));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function f(t,i,r,n){void 0===n&&(n={});let{window:a=document.defaultView,v5Compat:c=!1}=n,p=a.history,f=e.Pop,m=null,g=_();function _(){return(p.state||{idx:null}).idx}function y(){f=e.Pop;let t=_(),i=null==t?null:t-g;g=t,m&&m({action:f,location:x.location,delta:i})}function v(e){let t="null"!==a.location.origin?a.location.origin:a.location.href,i="string"===typeof e?e:d(e);return i=i.replace(/ $/,"%20"),l(t,"No window.location.(origin|href) available to create URL for href: "+i),new URL(i,t)}null==g&&(g=0,p.replaceState(o({},p.state,{idx:g}),""));let x={get action(){return f},get location(){return t(a,p)},listen(e){if(m)throw new Error("A history only accepts one active listener");return a.addEventListener(s,y),m=e,()=>{a.removeEventListener(s,y),m=null}},createHref:e=>i(a,e),createURL:v,encodeLocation(e){let t=v(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(t,i){f=e.Push;let n=u(x.location,t,i);r&&r(n,t),g=_()+1;let o=h(n,g),s=x.createHref(n);try{p.pushState(o,"",s)}catch(l){if(l instanceof DOMException&&"DataCloneError"===l.name)throw l;a.location.assign(s)}c&&m&&m({action:f,location:x.location,delta:1})},replace:function(t,i){f=e.Replace;let n=u(x.location,t,i);r&&r(n,t),g=_();let a=h(n,g),o=x.createHref(n);p.replaceState(a,"",o),c&&m&&m({action:f,location:x.location,delta:0})},go:e=>p.go(e)};return x}var m;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(m||(m={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function g(e,t,i){return void 0===i&&(i="/"),_(e,t,i,!1)}function _(e,t,i,r){let n=k(("string"===typeof t?p(t):t).pathname||"/",i);if(null==n)return null;let a=y(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let i=e.length===t.length&&e.slice(0,-1).every(((e,i)=>e===t[i]));return i?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(a);let o=null;for(let s=0;null==o&&s<a.length;++s){let e=I(n);o=P(a[s],e,r)}return o}function y(e,t,i,r){void 0===t&&(t=[]),void 0===i&&(i=[]),void 0===r&&(r="");let n=(e,n,a)=>{let o={relativePath:void 0===a?e.path||"":a,caseSensitive:!0===e.caseSensitive,childrenIndex:n,route:e};o.relativePath.startsWith("/")&&(l(o.relativePath.startsWith(r),'Absolute route path "'+o.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),o.relativePath=o.relativePath.slice(r.length));let s=F([r,o.relativePath]),c=i.concat(o);e.children&&e.children.length>0&&(l(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+s+'".'),y(e.children,t,c,s)),(null!=e.path||e.index)&&t.push({path:s,score:A(s,e.index),routesMeta:c})};return e.forEach(((e,t)=>{var i;if(""!==e.path&&null!=(i=e.path)&&i.includes("?"))for(let r of v(e.path))n(e,t,r);else n(e,t)})),t}function v(e){let t=e.split("/");if(0===t.length)return[];let[i,...r]=t,n=i.endsWith("?"),a=i.replace(/\?$/,"");if(0===r.length)return n?[a,""]:[a];let o=v(r.join("/")),s=[];return s.push(...o.map((e=>""===e?a:[a,e].join("/")))),n&&s.push(...o),s.map((t=>e.startsWith("/")&&""===t?"/":t))}const x=/^:[\w-]+$/,b=3,w=2,S=1,T=10,E=-2,M=e=>"*"===e;function A(e,t){let i=e.split("/"),r=i.length;return i.some(M)&&(r+=E),t&&(r+=w),i.filter((e=>!M(e))).reduce(((e,t)=>e+(x.test(t)?b:""===t?S:T)),r)}function P(e,t,i){void 0===i&&(i=!1);let{routesMeta:r}=e,n={},a="/",o=[];for(let s=0;s<r.length;++s){let e=r[s],l=s===r.length-1,c="/"===a?t:t.slice(a.length)||"/",h=C({path:e.relativePath,caseSensitive:e.caseSensitive,end:l},c),u=e.route;if(!h&&l&&i&&!r[r.length-1].route.index&&(h=C({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!h)return null;Object.assign(n,h.params),o.push({params:n,pathname:F([a,h.pathname]),pathnameBase:O(F([a,h.pathnameBase])),route:u}),"/"!==h.pathnameBase&&(a=F([a,h.pathnameBase]))}return o}function C(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[i,r]=function(e,t,i){void 0===t&&(t=!1);void 0===i&&(i=!0);c("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let r=[],n="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((e,t,i)=>(r.push({paramName:t,isOptional:null!=i}),i?"/?([^\\/]+)?":"/([^\\/]+)")));e.endsWith("*")?(r.push({paramName:"*"}),n+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):i?n+="\\/*$":""!==e&&"/"!==e&&(n+="(?:(?=\\/|$))");let a=new RegExp(n,t?void 0:"i");return[a,r]}(e.path,e.caseSensitive,e.end),n=t.match(i);if(!n)return null;let a=n[0],o=a.replace(/(.)\/+$/,"$1"),s=n.slice(1);return{params:r.reduce(((e,t,i)=>{let{paramName:r,isOptional:n}=t;if("*"===r){let e=s[i]||"";o=a.slice(0,a.length-e.length).replace(/(.)\/+$/,"$1")}const l=s[i];return e[r]=n&&!l?void 0:(l||"").replace(/%2F/g,"/"),e}),{}),pathname:a,pathnameBase:o,pattern:e}}function I(e){try{return e.split("/").map((e=>decodeURIComponent(e).replace(/\//g,"%2F"))).join("/")}catch(t){return c(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function k(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let i=t.endsWith("/")?t.length-1:t.length,r=e.charAt(i);return r&&"/"!==r?null:e.slice(i)||"/"}function D(e,t,i,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+i+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function R(e){return e.filter(((e,t)=>0===t||e.route.path&&e.route.path.length>0))}function L(e,t){let i=R(e);return t?i.map(((t,i)=>i===e.length-1?t.pathname:t.pathnameBase)):i.map((e=>e.pathnameBase))}function z(e,t,i,r){let n;void 0===r&&(r=!1),"string"===typeof e?n=p(e):(n=o({},e),l(!n.pathname||!n.pathname.includes("?"),D("?","pathname","search",n)),l(!n.pathname||!n.pathname.includes("#"),D("#","pathname","hash",n)),l(!n.search||!n.search.includes("#"),D("#","search","hash",n)));let a,s=""===e||""===n.pathname,c=s?"/":n.pathname;if(null==c)a=i;else{let e=t.length-1;if(!r&&c.startsWith("..")){let t=c.split("/");for(;".."===t[0];)t.shift(),e-=1;n.pathname=t.join("/")}a=e>=0?t[e]:"/"}let h=function(e,t){void 0===t&&(t="/");let{pathname:i,search:r="",hash:n=""}="string"===typeof e?p(e):e,a=i?i.startsWith("/")?i:function(e,t){let i=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?i.length>1&&i.pop():"."!==e&&i.push(e)})),i.length>1?i.join("/"):"/"}(i,t):t;return{pathname:a,search:B(r),hash:N(n)}}(n,a),u=c&&"/"!==c&&c.endsWith("/"),d=(s||"."===c)&&i.endsWith("/");return h.pathname.endsWith("/")||!u&&!d||(h.pathname+="/"),h}const F=e=>e.join("/").replace(/\/\/+/g,"/"),O=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),B=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",N=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function V(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const j=["post","put","patch","delete"],U=(new Set(j),["get",...j]);new Set(U),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function G(){return G=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},G.apply(this,arguments)}const q=t.createContext(null);const H=t.createContext(null);const W=t.createContext(null);const Z=t.createContext(null);const Q=t.createContext({outlet:null,matches:[],isDataRoute:!1});const X=t.createContext(null);function Y(){return null!=t.useContext(Z)}function J(){return Y()||l(!1),t.useContext(Z).location}function K(e){t.useContext(W).static||t.useLayoutEffect(e)}function $(){let{isDataRoute:e}=t.useContext(Q);return e?function(){let{router:e}=le(oe.UseNavigateStable),i=he(se.UseNavigateStable),r=t.useRef(!1);return K((()=>{r.current=!0})),t.useCallback((function(t,n){void 0===n&&(n={}),r.current&&("number"===typeof t?e.navigate(t):e.navigate(t,G({fromRouteId:i},n)))}),[e,i])}():function(){Y()||l(!1);let e=t.useContext(q),{basename:i,future:r,navigator:n}=t.useContext(W),{matches:a}=t.useContext(Q),{pathname:o}=J(),s=JSON.stringify(L(a,r.v7_relativeSplatPath)),c=t.useRef(!1);return K((()=>{c.current=!0})),t.useCallback((function(t,r){if(void 0===r&&(r={}),!c.current)return;if("number"===typeof t)return void n.go(t);let a=z(t,JSON.parse(s),o,"path"===r.relative);null==e&&"/"!==i&&(a.pathname="/"===a.pathname?i:F([i,a.pathname])),(r.replace?n.replace:n.push)(a,r.state,r)}),[i,n,s,o,e])}()}function ee(i,r,n,a){Y()||l(!1);let{navigator:o}=t.useContext(W),{matches:s}=t.useContext(Q),c=s[s.length-1],h=c?c.params:{},u=(c&&c.pathname,c?c.pathnameBase:"/");c&&c.route;let d,f=J();if(r){var m;let e="string"===typeof r?p(r):r;"/"===u||(null==(m=e.pathname)?void 0:m.startsWith(u))||l(!1),d=e}else d=f;let _=d.pathname||"/",y=_;if("/"!==u){let e=u.replace(/^\//,"").split("/");y="/"+_.replace(/^\//,"").split("/").slice(e.length).join("/")}let v=g(i,{pathname:y});let x=ae(v&&v.map((e=>Object.assign({},e,{params:Object.assign({},h,e.params),pathname:F([u,o.encodeLocation?o.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?u:F([u,o.encodeLocation?o.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),s,n,a);return r&&x?t.createElement(Z.Provider,{value:{location:G({pathname:"/",search:"",hash:"",state:null,key:"default"},d),navigationType:e.Pop}},x):x}function te(){let e=function(){var e;let i=t.useContext(X),r=ce(se.UseRouteError),n=he(se.UseRouteError);if(void 0!==i)return i;return null==(e=r.errors)?void 0:e[n]}(),i=V(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,n="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:n};return t.createElement(t.Fragment,null,t.createElement("h2",null,"Unexpected Application Error!"),t.createElement("h3",{style:{fontStyle:"italic"}},i),r?t.createElement("pre",{style:a},r):null,null)}const ie=t.createElement(te,null);class re extends t.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?t.createElement(Q.Provider,{value:this.props.routeContext},t.createElement(X.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function ne(e){let{routeContext:i,match:r,children:n}=e,a=t.useContext(q);return a&&a.static&&a.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=r.route.id),t.createElement(Q.Provider,{value:i},n)}function ae(e,i,r,n){var a;if(void 0===i&&(i=[]),void 0===r&&(r=null),void 0===n&&(n=null),null==e){var o;if(null==(o=r)||!o.errors)return null;e=r.matches}let s=e,c=null==(a=r)?void 0:a.errors;if(null!=c){let e=s.findIndex((e=>e.route.id&&void 0!==(null==c?void 0:c[e.route.id])));e>=0||l(!1),s=s.slice(0,Math.min(s.length,e+1))}let h=!1,u=-1;if(r&&n&&n.v7_partialHydration)for(let t=0;t<s.length;t++){let e=s[t];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(u=t),e.route.id){let{loaderData:t,errors:i}=r,n=e.route.loader&&void 0===t[e.route.id]&&(!i||void 0===i[e.route.id]);if(e.route.lazy||n){h=!0,s=u>=0?s.slice(0,u+1):[s[0]];break}}}return s.reduceRight(((e,n,a)=>{let o,l=!1,d=null,p=null;var f;r&&(o=c&&n.route.id?c[n.route.id]:void 0,d=n.route.errorElement||ie,h&&(u<0&&0===a?(f="route-fallback",!1||ue[f]||(ue[f]=!0),l=!0,p=null):u===a&&(l=!0,p=n.route.hydrateFallbackElement||null)));let m=i.concat(s.slice(0,a+1)),g=()=>{let i;return i=o?d:l?p:n.route.Component?t.createElement(n.route.Component,null):n.route.element?n.route.element:e,t.createElement(ne,{match:n,routeContext:{outlet:e,matches:m,isDataRoute:null!=r},children:i})};return r&&(n.route.ErrorBoundary||n.route.errorElement||0===a)?t.createElement(re,{location:r.location,revalidation:r.revalidation,component:d,error:o,children:g(),routeContext:{outlet:null,matches:m,isDataRoute:!0}}):g()}),null)}var oe=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(oe||{}),se=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(se||{});function le(e){let i=t.useContext(q);return i||l(!1),i}function ce(e){let i=t.useContext(H);return i||l(!1),i}function he(e){let i=function(e){let i=t.useContext(Q);return i||l(!1),i}(),r=i.matches[i.matches.length-1];return r.route.id||l(!1),r.route.id}const ue={};i.startTransition;function de(e){let{to:i,replace:r,state:n,relative:a}=e;Y()||l(!1);let{future:o,static:s}=t.useContext(W),{matches:c}=t.useContext(Q),{pathname:h}=J(),u=$(),d=z(i,L(c,o.v7_relativeSplatPath),h,"path"===a),p=JSON.stringify(d);return t.useEffect((()=>u(JSON.parse(p),{replace:r,state:n,relative:a})),[u,p,a,r,n]),null}function pe(e){l(!1)}function fe(i){let{basename:r="/",children:n=null,location:a,navigationType:o=e.Pop,navigator:s,static:c=!1,future:h}=i;Y()&&l(!1);let u=r.replace(/^\/*/,"/"),d=t.useMemo((()=>({basename:u,navigator:s,static:c,future:G({v7_relativeSplatPath:!1},h)})),[u,h,s,c]);"string"===typeof a&&(a=p(a));let{pathname:f="/",search:m="",hash:g="",state:_=null,key:y="default"}=a,v=t.useMemo((()=>{let e=k(f,u);return null==e?null:{location:{pathname:e,search:m,hash:g,state:_,key:y},navigationType:o}}),[u,f,m,g,_,y,o]);return null==v?null:t.createElement(W.Provider,{value:d},t.createElement(Z.Provider,{children:n,value:v}))}function me(e){let{children:t,location:i}=e;return ee(ge(t),i)}new Promise((()=>{}));t.Component;function ge(e,i){void 0===i&&(i=[]);let r=[];return t.Children.forEach(e,((e,n)=>{if(!t.isValidElement(e))return;let a=[...i,n];if(e.type===t.Fragment)return void r.push.apply(r,ge(e.props.children,a));e.type!==pe&&l(!1),e.props.index&&e.props.children&&l(!1);let o={id:e.props.id||a.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(o.children=ge(e.props.children,a)),r.push(o)})),r}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);try{window.__reactRouterVersion="6"}catch(It){}new Map;const _e=i.startTransition;a.flushSync,i.useId;function ye(e){let{basename:i,children:r,future:n,window:a}=e,o=t.useRef();var s;null==o.current&&(o.current=(void 0===(s={window:a,v5Compat:!0})&&(s={}),f((function(e,t){let{pathname:i="/",search:r="",hash:n=""}=p(e.location.hash.substr(1));return i.startsWith("/")||i.startsWith(".")||(i="/"+i),u("",{pathname:i,search:r,hash:n},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){let i=e.document.querySelector("base"),r="";if(i&&i.getAttribute("href")){let t=e.location.href,i=t.indexOf("#");r=-1===i?t:t.slice(0,i)}return r+"#"+("string"===typeof t?t:d(t))}),(function(e,t){c("/"===e.pathname.charAt(0),"relative pathnames are not supported in hash history.push("+JSON.stringify(t)+")")}),s)));let l=o.current,[h,m]=t.useState({action:l.action,location:l.location}),{v7_startTransition:g}=n||{},_=t.useCallback((e=>{g&&_e?_e((()=>m(e))):m(e)}),[m,g]);return t.useLayoutEffect((()=>l.listen(_)),[l,_]),t.createElement(fe,{basename:i,children:r,location:h.location,navigationType:h.action,navigator:l,future:n})}"undefined"!==typeof window&&"undefined"!==typeof window.document&&window.document.createElement;var ve,xe;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(ve||(ve={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(xe||(xe={}));const be=__webpack_require__.p+"static/media/k-logo.971fd0299069125e317c7dd615a207a3.svg";var we=__webpack_require__(579);const Se=()=>(0,we.jsx)("img",{src:be,className:"w-auto h-24",alt:""}),Te=()=>(0,we.jsx)("img",{src:be,className:"w-auto h-12",alt:""}),Ee=e=>(0,we.jsx)("p",{className:"quicksand-header-700 leading-relaxed text-3xl font-bold text-gray-900",children:e.text}),Me=e=>(0,we.jsx)("p",{className:"quicksand-header-700 text-2xl font-bold text-gray-900",children:e.text}),Ae=e=>(0,we.jsx)("p",{className:"quicksand-header-700 text-xl font-bold text-gray-900",children:e.text}),Pe=e=>(0,we.jsx)("p",{className:"quicksand-header-700 text-xl font-bold text-white",children:e.text}),Ce=e=>(0,we.jsx)("p",{className:"text-md font-normal text-gray-700",children:e.text}),Ie=e=>(0,we.jsx)("p",{className:"text-xs text-center font-normal text-gray-500",children:e.children}),ke=e=>(0,we.jsx)("span",{children:(0,we.jsx)("a",{href:e.link,className:"font-medium text-red-500",children:e.text})});function De(e){return(0,we.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",id:"Outline",viewBox:"0 0 24 24",fill:e.c,width:e.w,height:e.h,children:(0,we.jsx)("path",{d:"M17.17,24a1,1,0,0,1-.71-.29L8.29,15.54a5,5,0,0,1,0-7.08L16.46.29a1,1,0,1,1,1.42,1.42L9.71,9.88a3,3,0,0,0,0,4.24l8.17,8.17a1,1,0,0,1,0,1.42A1,1,0,0,1,17.17,24Z"})})}function Re(e){return(0,we.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",id:"Outline",viewBox:"0 0 24 24",fill:e.c,width:e.w,height:e.h,children:[(0,we.jsx)("path",{d:"M23.271,9.419C21.72,6.893,18.192,2.655,12,2.655S2.28,6.893.729,9.419a4.908,4.908,0,0,0,0,5.162C2.28,17.107,5.808,21.345,12,21.345s9.72-4.238,11.271-6.764A4.908,4.908,0,0,0,23.271,9.419Zm-1.705,4.115C20.234,15.7,17.219,19.345,12,19.345S3.766,15.7,2.434,13.534a2.918,2.918,0,0,1,0-3.068C3.766,8.3,6.781,4.655,12,4.655s8.234,3.641,9.566,5.811A2.918,2.918,0,0,1,21.566,13.534Z"}),(0,we.jsx)("path",{d:"M12,7a5,5,0,1,0,5,5A5.006,5.006,0,0,0,12,7Zm0,8a3,3,0,1,1,3-3A3,3,0,0,1,12,15Z"})]})}function Le(e){return(0,we.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",id:"Outline",viewBox:"0 0 24 24",fill:e.c,width:e.w,height:e.h,children:(0,we.jsx)("path",{d:"M23.271,9.419A15.866,15.866,0,0,0,19.9,5.51l2.8-2.8a1,1,0,0,0-1.414-1.414L18.241,4.345A12.054,12.054,0,0,0,12,2.655C5.809,2.655,2.281,6.893.729,9.419a4.908,4.908,0,0,0,0,5.162A15.866,15.866,0,0,0,4.1,18.49l-2.8,2.8a1,1,0,1,0,1.414,1.414l3.052-3.052A12.054,12.054,0,0,0,12,21.345c6.191,0,9.719-4.238,11.271-6.764A4.908,4.908,0,0,0,23.271,9.419ZM2.433,13.534a2.918,2.918,0,0,1,0-3.068C3.767,8.3,6.782,4.655,12,4.655A10.1,10.1,0,0,1,16.766,5.82L14.753,7.833a4.992,4.992,0,0,0-6.92,6.92l-2.31,2.31A13.723,13.723,0,0,1,2.433,13.534ZM15,12a3,3,0,0,1-3,3,2.951,2.951,0,0,1-1.285-.3L14.7,10.715A2.951,2.951,0,0,1,15,12ZM9,12a3,3,0,0,1,3-3,2.951,2.951,0,0,1,1.285.3L9.3,13.285A2.951,2.951,0,0,1,9,12Zm12.567,1.534C20.233,15.7,17.218,19.345,12,19.345A10.1,10.1,0,0,1,7.234,18.18l2.013-2.013a4.992,4.992,0,0,0,6.92-6.92l2.31-2.31a13.723,13.723,0,0,1,3.09,3.529A2.918,2.918,0,0,1,21.567,13.534Z"})})}function ze(e){return(0,we.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",id:"Outline",viewBox:"0 0 24 24",fill:e.c,width:e.w,height:e.h,children:(0,we.jsx)("path",{d:"M15.4,9.88,10.81,5.29a1,1,0,0,0-1.41,0,1,1,0,0,0,0,1.42L14,11.29a1,1,0,0,1,0,1.42L9.4,17.29a1,1,0,0,0,1.41,1.42l4.59-4.59A3,3,0,0,0,15.4,9.88Z"})})}function Fe(e){return(0,we.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",id:"Layer_1","data-name":"Layer 1",viewBox:"0 0 24 24",fill:e.c,width:e.w,height:e.h,children:(0,we.jsx)("path",{d:"M12,24A12,12,0,1,1,24,12,12.013,12.013,0,0,1,12,24ZM12,2A10,10,0,1,0,22,12,10.011,10.011,0,0,0,12,2Zm5.666,13.746a1,1,0,0,0-1.33-1.494A7.508,7.508,0,0,1,12,16a7.509,7.509,0,0,1-4.334-1.746,1,1,0,0,0-1.332,1.492A9.454,9.454,0,0,0,12,18,9.454,9.454,0,0,0,17.666,15.746ZM6,10c0,1,.895,1,2,1s2,0,2-1a2,2,0,0,0-4,0Zm8,0c0,1,.895,1,2,1s2,0,2-1a2,2,0,0,0-4,0Z"})})}function Oe(e){return(0,we.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",id:"Outline",viewBox:"0 0 24 24",fill:e.c,width:e.w,height:e.h,children:(0,we.jsx)("path",{d:"M23.119.882a2.966,2.966,0,0,0-2.8-.8l-16,3.37a4.995,4.995,0,0,0-2.853,8.481L3.184,13.65a1,1,0,0,1,.293.708v3.168a2.965,2.965,0,0,0,.3,1.285l-.008.007.026.026A3,3,0,0,0,5.157,20.2l.026.026.007-.008a2.965,2.965,0,0,0,1.285.3H9.643a1,1,0,0,1,.707.292l1.717,1.717A4.963,4.963,0,0,0,15.587,24a5.049,5.049,0,0,0,1.605-.264,4.933,4.933,0,0,0,3.344-3.986L23.911,3.715A2.975,2.975,0,0,0,23.119.882ZM4.6,12.238,2.881,10.521a2.94,2.94,0,0,1-.722-3.074,2.978,2.978,0,0,1,2.5-2.026L20.5,2.086,5.475,17.113V14.358A2.978,2.978,0,0,0,4.6,12.238Zm13.971,7.17a3,3,0,0,1-5.089,1.712L11.762,19.4a2.978,2.978,0,0,0-2.119-.878H6.888L21.915,3.5Z"})})}function Be(e){return(0,we.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",id:"Outline",viewBox:"0 0 24 24",fill:e.c,width:e.w,height:e.h,children:(0,we.jsx)("path",{d:"M18,12h0a2,2,0,0,0-.59-1.4l-4.29-4.3a1,1,0,0,0-1.41,0,1,1,0,0,0,0,1.42L15,11H5a1,1,0,0,0,0,2H15l-3.29,3.29a1,1,0,0,0,1.41,1.42l4.29-4.3A2,2,0,0,0,18,12Z"})})}function Ne(e){return(0,we.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",id:"Layer_1","data-name":"Layer 1",viewBox:"0 0 24 24",fill:e.c,width:e.w,height:e.h,children:(0,we.jsx)("path",{d:"M12,12A4,4,0,1,0,8,8,4,4,0,0,0,12,12Zm0-6a2,2,0,1,1-2,2A2,2,0,0,1,12,6Zm8.66,3.157-.719-.239A8,8,0,0,0,12,0,7.993,7.993,0,0,0,4.086,9.092a5.045,5.045,0,0,0-2.548,1.3A4.946,4.946,0,0,0,0,14v4.075a5.013,5.013,0,0,0,3.6,4.8l2.87.9A4.981,4.981,0,0,0,7.959,24a5.076,5.076,0,0,0,1.355-.186l5.78-1.71a2.987,2.987,0,0,1,1.573,0l2.387.8A4,4,0,0,0,24,19.021V13.872A5.015,5.015,0,0,0,20.66,9.156ZM7.758,3.762a5.987,5.987,0,0,1,8.484,0,6.037,6.037,0,0,1,.011,8.5L12.7,15.717a.992.992,0,0,1-1.389,0L7.758,12.277A6.04,6.04,0,0,1,7.758,3.762ZM22,19.021a1.991,1.991,0,0,1-.764,1.572,1.969,1.969,0,0,1-1.626.395L17.265,20.2a5.023,5.023,0,0,0-2.717-.016L8.764,21.892a3,3,0,0,1-1.694-.029l-2.894-.9A3.013,3.013,0,0,1,2,18.075V14a2.964,2.964,0,0,1,.92-2.163,3.024,3.024,0,0,1,1.669-.806A8.021,8.021,0,0,0,6.354,13.7l3.567,3.453a2.983,2.983,0,0,0,4.174,0l3.563-3.463a7.962,7.962,0,0,0,1.813-2.821l.537.178A3.006,3.006,0,0,1,22,13.872Z"})})}function Ve(e){return(0,we.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",id:"Outline",viewBox:"0 0 24 24",fill:e.c,width:e.w,height:e.h,children:(0,we.jsx)("path",{d:"M22.853,1.148a3.626,3.626,0,0,0-5.124,0L1.465,17.412A4.968,4.968,0,0,0,0,20.947V23a1,1,0,0,0,1,1H3.053a4.966,4.966,0,0,0,3.535-1.464L22.853,6.271A3.626,3.626,0,0,0,22.853,1.148ZM5.174,21.122A3.022,3.022,0,0,1,3.053,22H2V20.947a2.98,2.98,0,0,1,.879-2.121L15.222,6.483l2.3,2.3ZM21.438,4.857,18.932,7.364l-2.3-2.295,2.507-2.507a1.623,1.623,0,1,1,2.295,2.3Z"})})}function je(e){return(0,we.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",id:"Outline",viewBox:"0 0 24 24",fill:e.c,width:e.w,height:e.h,children:(0,we.jsx)("path",{d:"M23.707,22.293l-5.969-5.969a10.016,10.016,0,1,0-1.414,1.414l5.969,5.969a1,1,0,0,0,1.414-1.414ZM10,18a8,8,0,1,1,8-8A8.009,8.009,0,0,1,10,18Z"})})}function Ue(e){return(0,we.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",id:"Outline",viewBox:"0 0 24 24",fill:e.c,width:e.w,height:e.h,children:[(0,we.jsx)("path",{d:"M12,0A11.972,11.972,0,0,0,4,3.073V1A1,1,0,0,0,2,1V4A3,3,0,0,0,5,7H8A1,1,0,0,0,8,5H5a.854.854,0,0,1-.1-.021A9.987,9.987,0,1,1,2,12a1,1,0,0,0-2,0A12,12,0,1,0,12,0Z"}),(0,we.jsx)("path",{d:"M12,6a1,1,0,0,0-1,1v5a1,1,0,0,0,.293.707l3,3a1,1,0,0,0,1.414-1.414L13,11.586V7A1,1,0,0,0,12,6Z"})]})}function Ge(e){return(0,we.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",id:"Outline",viewBox:"0 0 24 24",fill:e.c,width:e.w,height:e.h,children:(0,we.jsx)("path",{d:"M18,6h0a1,1,0,0,0-1.414,0L12,10.586,7.414,6A1,1,0,0,0,6,6H6A1,1,0,0,0,6,7.414L10.586,12,6,16.586A1,1,0,0,0,6,18H6a1,1,0,0,0,1.414,0L12,13.414,16.586,18A1,1,0,0,0,18,18h0a1,1,0,0,0,0-1.414L13.414,12,18,7.414A1,1,0,0,0,18,6Z"})})}function qe(e){return(0,we.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",id:"Filled",viewBox:"0 0 24 24",fill:e.c,width:e.w,height:e.h,children:(0,we.jsx)("path",{d:"M12,.042a9.992,9.992,0,0,0-9.981,9.98c0,2.57,1.99,6.592,5.915,11.954a5.034,5.034,0,0,0,8.132,0c3.925-5.362,5.915-9.384,5.915-11.954A9.992,9.992,0,0,0,12,.042ZM12,14a4,4,0,1,1,4-4A4,4,0,0,1,12,14Z"})})}function He(e){return(0,we.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",id:"Outline",viewBox:"0 0 24 24",fill:e.c,width:e.w,height:e.h,children:(0,we.jsx)("path",{d:"M17.5,1.917a6.4,6.4,0,0,0-5.5,3.3,6.4,6.4,0,0,0-5.5-3.3A6.8,6.8,0,0,0,0,8.967c0,4.547,4.786,9.513,8.8,12.88a4.974,4.974,0,0,0,6.4,0C19.214,18.48,24,13.514,24,8.967A6.8,6.8,0,0,0,17.5,1.917Zm-3.585,18.4a2.973,2.973,0,0,1-3.83,0C4.947,16.006,2,11.87,2,8.967a4.8,4.8,0,0,1,4.5-5.05A4.8,4.8,0,0,1,11,8.967a1,1,0,0,0,2,0,4.8,4.8,0,0,1,4.5-5.05A4.8,4.8,0,0,1,22,8.967C22,11.87,19.053,16.006,13.915,20.313Z"})})}function We(e){return(0,we.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",id:"Outline",viewBox:"0 0 24 24",fill:e.c,width:e.w,height:e.h,children:(0,we.jsx)("path",{d:"M21,6H18A6,6,0,0,0,6,6H3A3,3,0,0,0,0,9V19a5.006,5.006,0,0,0,5,5H19a5.006,5.006,0,0,0,5-5V9A3,3,0,0,0,21,6ZM12,2a4,4,0,0,1,4,4H8A4,4,0,0,1,12,2ZM22,19a3,3,0,0,1-3,3H5a3,3,0,0,1-3-3V9A1,1,0,0,1,3,8H6v2a1,1,0,0,0,2,0V8h8v2a1,1,0,0,0,2,0V8h3a1,1,0,0,1,1,1Z"})})}const Ze=()=>(0,we.jsx)("div",{className:"bg-slate-200 p-2.5 rounded-md w-full my-4",children:(0,we.jsx)("input",{type:"email",placeholder:"Enter email",className:"px-2.5 placeholder-slate-500 text-lg bg-transparent outline-none"})}),Qe=()=>{const[e,i]=(0,t.useState)("password");return(0,we.jsxs)("div",{className:"bg-slate-200 p-2.5 rounded-md w-full my-4 flex justify-between items-center",children:[(0,we.jsx)("input",{type:e,placeholder:"Password",className:"w-full px-2.5 placeholder-slate-500 text-lg bg-transparent outline-none"}),(0,we.jsx)("div",{onClick:()=>{i("password"===e?"text":"password")},className:"cursor-pointer",children:"password"===e?(0,we.jsx)(Le,{c:"#64748b",w:"20",h:"20"}):(0,we.jsx)(Re,{c:"#64748b",w:"20",h:"20"})})]})},Xe=()=>(0,we.jsx)("div",{className:"bg-slate-200 p-4 rounded-md w-full my-4",children:(0,we.jsx)("input",{type:"number",placeholder:"",className:"px-2.5 placeholder-slate-500 text-lg text-center text-2xl text-red-500 bg-transparent outline-none"})}),Ye=()=>(0,we.jsx)("div",{className:"bg-white p-4 rounded-xl w-full my-4",children:(0,we.jsx)("textarea",{style:{resize:"none"},rows:1,placeholder:"Enter your message",className:"px-2.5 placeholder-slate-500 text-lg bg-transparent outline-none w-full"})}),Je=()=>(0,we.jsxs)("div",{className:"bg-slate-200 p-2.5 rounded-2xl w-full flex justify-start items-center",children:[(0,we.jsx)(je,{c:"#94a3b8",w:"23",h:"23"}),(0,we.jsx)("input",{type:"text",placeholder:"Search foods or restaurants",className:"px-2.5 placeholder-slate-400 text-lg bg-transparent outline-none w-full"})]}),Ke=e=>(0,we.jsxs)("div",{className:"bg-white z-50 w-full px-2.5 py-4 absolute sticky-0 top-0 flex justify-between items-center",children:[(0,we.jsx)("div",{className:"cursor-pointer",children:(0,we.jsx)(De,{w:25,h:25,c:"#404040"})}),(0,we.jsx)("div",{children:(0,we.jsx)("p",{className:"text-xl text-red-600",children:e.title})}),(0,we.jsx)("div",{children:(0,we.jsx)(De,{w:30,h:30,c:"#fff"})})]}),$e=e=>(0,we.jsxs)("div",{className:"bg-white z-50 w-full px-2.5 py-4 absolute sticky-0 top-0 flex justify-between items-center",children:[(0,we.jsx)("div",{onClick:()=>{var e=JSON.stringify({type:"GO_BACK",path:"home"});window.ReactNativeWebView.postMessage(e)},className:"hover:bg-red-500 cursor-pointer",children:(0,we.jsx)(De,{w:25,h:25,c:"#404040"})}),(0,we.jsx)("div",{children:(0,we.jsx)("p",{})}),(0,we.jsx)("div",{children:e.children})]}),et=e=>(0,we.jsxs)("div",{className:"bg-white z-50 w-full px-2.5 py-4 absolute sticky-0 shadow-lg top-0 flex justify-between items-center",children:[(0,we.jsxs)("div",{className:"flex justify-start items-center space-x-2",children:[(0,we.jsx)(Te,{}),(0,we.jsxs)("div",{className:"cursor-default",children:[(0,we.jsx)("p",{className:"text-lg text-gray-900 leading-5",children:e.title}),(0,we.jsx)("p",{className:"text-sm text-gray-500",children:e.subtitle})]})]}),(0,we.jsx)("div",{}),(0,we.jsx)("div",{children:(0,we.jsx)(De,{w:30,h:30,c:"#fff"})})]}),tt=e=>(0,we.jsxs)("div",{className:"bg-white z-50 w-full px-2.5 py-4 absolute sticky-0 top-0 flex justify-between items-center space-x-2.5",children:[(0,we.jsx)("div",{onClick:()=>{var e=JSON.stringify({type:"GO_BACK",path:"home"});window.ReactNativeWebView.postMessage(e)},className:"cursor-pointer",children:(0,we.jsx)(De,{w:25,h:25,c:"#404040"})}),(0,we.jsx)(Je,{})]}),it=e=>(0,we.jsx)("button",{onClick:e.click,className:"my-2 text-center w-full bg-red-500 p-2.5 text-white hover:bg-red-600 rounded-xl shadow-md",children:e.text}),rt=e=>(0,we.jsx)("button",{onClick:e.click,className:"my-2 text-center w-full bg-gray-200 p-2.5 text-gray-800 hover:bg-gray-100 rounded-xl",children:e.text}),nt=e=>(0,we.jsxs)("div",{onClick:e.click,className:"my-2 flex justify-center items-center space-x-1 text-center w-full bg-red-500 p-2.5 text-white hover:bg-red-600 rounded-xl shadow-md",children:[(0,we.jsx)("button",{children:e.text}),(0,we.jsx)(ze,{w:"20",h:"20",c:"#fff"})]}),at=e=>(0,we.jsxs)("div",{className:"my-2 flex justify-center items-center space-x-2 text-center min-w-40 w-40 bg-red-500 py-2.5 px-4 text-white hover:bg-red-600 rounded-xl shadow-md",children:[(0,we.jsx)("button",{children:e.text}),(0,we.jsx)(Be,{w:"20",h:"20",c:"#fff"})]}),ot=e=>(0,we.jsxs)("div",{onClick:e.click,className:"font-medium my-2 flex justify-center items-center space-x-2 text-center w-full bg-gray-200 p-2.5 text-gray-900 hover:bg-gray-300 rounded-xl",children:[(0,we.jsx)(Fe,{w:"20",h:"20",c:"#111827"}),(0,we.jsx)("button",{children:e.text})]}),st=()=>(0,we.jsx)("button",{className:"px-4 cursor-pointer bg-red-50 py-2.5 rounded-xl shadow-xl",children:(0,we.jsx)(Oe,{w:"20",h:"20",c:"#111827"})}),lt=e=>(0,we.jsx)("button",{className:"my-2.5 text-left w-auto bg-red-100 py-2.5 px-4 text-red-800 hover:bg-gray-100 rounded-t-2xl rounded-r-2xl shadow-lg",children:e.text}),ct=e=>(0,we.jsx)("button",{className:"cursor-pointer font-medium text-red-500 mx-2.5",children:e.text});const ht=function(){return(0,we.jsx)("div",{className:"flex justify-center items-center bg-white h-screen w-screen",children:(0,we.jsxs)(we.Fragment,{children:[(0,we.jsx)(et,{title:"Support Agent",subtitle:"Active now"}),(0,we.jsxs)("div",{className:"p-2.5 w-full px-2 h-full",children:[(0,we.jsx)("div",{className:"p-2 w-full min-h-[650px] max-h-full",children:(0,we.jsxs)("div",{className:"mx-4 mt-28 w-64 space-y-2.5",children:[(0,we.jsx)(Ee,{text:"Feel free to chat. How can I help you today?"}),(0,we.jsx)(Ce,{text:"Powered by A.I"}),(0,we.jsxs)("div",{className:"mt-6",children:[(0,we.jsx)(lt,{text:"Padeliver ng food"}),(0,we.jsx)(lt,{text:"Any suggestions?"}),(0,we.jsx)(at,{text:"Browse App"})]})]})}),(0,we.jsxs)("div",{className:"flex justify-between items-center",children:[(0,we.jsx)(Ye,{}),(0,we.jsx)(st,{})]})]})]})})},ut=e=>(0,we.jsxs)("div",{className:"bg-red-50 p-2.5 rounded-xl m-1.5 flex justify-start items-center space-x-2.5",children:[(0,we.jsx)(Ne,{c:"#ef4444",h:"30",w:"30"}),(0,we.jsxs)("div",{className:"w-64",children:[(0,we.jsx)("p",{className:"font-medium text-red-900 truncate",children:e.location}),(0,we.jsxs)("div",{className:"flex justify-start items-center space-x-1.5",children:[(0,we.jsx)("p",{className:"font-normal text-sm text-gray-500",children:"Click to edit"}),(0,we.jsx)(Ve,{c:"#6b7280",h:"12",w:"12"})]})]})]}),dt=e=>(0,we.jsxs)("div",{className:"bg-white p-1.5 rounded-lg hover:bg-gray-100 my-1.5 flex justify-between items-center",children:[(0,we.jsxs)("div",{className:"flex justify-start items-center space-x-2.5",children:[(0,we.jsx)(Ue,{c:"#9ca3af",h:"18",w:"18"}),(0,we.jsx)("p",{className:"text-gray-400",children:e.text})]}),(0,we.jsx)("button",{children:(0,we.jsx)(Ge,{c:"#1f2937",h:"23",w:"23"})})]}),pt=e=>(0,we.jsx)("div",{children:(0,we.jsxs)("div",{className:"rounded-lg bg-white hover:bg-gray-50 flex justify-start items-center space-x-2 my-1.5 p-1.5",children:[(0,we.jsx)("img",{src:e.image,alt:"",className:"w-auto h-16 rounded-2xl"}),(0,we.jsxs)("div",{className:"w-auto max-w-48",children:[(0,we.jsx)("p",{className:"font-medium truncate",children:e.title}),(0,we.jsx)("p",{className:"text-gray-500 truncate",children:e.subtitle})]})]})}),ft=e=>(0,we.jsxs)("div",{className:"overflow-hidden relative bg-white border border-gray-200 shadow-sm rounded-xl p-2.5 h-36 w-full",children:[(0,we.jsxs)("div",{className:"absolute z-20",children:[(0,we.jsx)("p",{className:"text-lg font-medium",children:e.title}),(0,we.jsx)("p",{className:"text-gray-600 text-xs",children:e.subtitle})]}),(0,we.jsx)("div",{className:"h-full",children:(0,we.jsx)("img",{src:e.image,alt:"",className:"z-10 w-auto h-36 object-cover absolute bottom-0 top-10 -right-8"})})]}),mt=e=>(0,we.jsxs)("div",{className:"overflow-hidden relative bg-white border border-gray-200 shadow-sm rounded-xl p-2.5 h-16 w-full",children:[(0,we.jsxs)("div",{className:"absolute z-20",children:[(0,we.jsx)("p",{className:"text-md font-medium text-gray-800",children:e.title}),(0,we.jsx)("p",{className:"text-gray-300 text-xs font-medium",children:e.subtitle})]}),(0,we.jsx)("img",{src:e.image,alt:"",className:"z-10 w-auto h-24 object-cover absolute bottom-0 top-0 -right-4"})]}),gt=e=>(0,we.jsxs)("div",{className:"overflow-hidden relative bg-white border border-gray-200 shadow-sm rounded-xl p-2.5 h-16 w-full",children:[(0,we.jsxs)("div",{className:"absolute z-20",children:[(0,we.jsx)("p",{className:"text-md font-medium text-gray-800",children:e.title}),(0,we.jsx)("p",{className:"text-gray-300 text-xs font-medium",children:e.subtitle})]}),(0,we.jsx)("img",{src:e.image,alt:"",className:"z-10 w-auto h-16 object-center absolute bottom-0 -top-0 -right-2"})]}),_t=e=>(0,we.jsxs)("div",{className:"bg-white rounded-xl shadow-md px-2.5 flex justify-between items-center w-auto",children:[(0,we.jsxs)("div",{children:[(0,we.jsx)("p",{className:"font-medium text-lg",children:e.title}),(0,we.jsx)("p",{className:"font-normal text-gray-500 text-xs",children:e.subtitle}),(0,we.jsx)("button",{className:"font-medium bg-red-500 shadow-xl rounded-lg my-1.5 text-red-50 text-sm px-2.5 py-1",children:"Join Waitlist"})]}),(0,we.jsx)("div",{children:(0,we.jsx)("img",{src:e.image,alt:"",className:"w-auto h-24"})})]});const yt=function(){const e=$();return(0,we.jsxs)("div",{className:"bg-white h-screen w-screen",children:[(0,we.jsxs)("div",{className:"bg-red-500 relative h-32 p-4 w-full",children:[(0,we.jsxs)("div",{className:"flex justify-between items-center",children:[(0,we.jsxs)("div",{onClick:()=>{e("/setlocation")},className:"flex justify-start items-center space-x-1",children:[(0,we.jsx)(qe,{c:"#fff",w:"20",h:"20"}),(0,we.jsx)("p",{className:"text-white font-normal truncate w-auto max-w-48",children:"San Manuel, Villa Manuel, Puerto Princesa City"})]}),(0,we.jsxs)("div",{className:"flex justify-center items-center space-x-4",children:[(0,we.jsx)("button",{children:(0,we.jsx)(He,{c:"#fff",w:"25",h:"25"})}),(0,we.jsx)("button",{children:(0,we.jsx)(We,{c:"#fff",w:"25",h:"25"})})]})]}),(0,we.jsx)("div",{className:"my-4",children:(0,we.jsx)(Pe,{text:"Discover with Kiefers"})}),(0,we.jsxs)("div",{onClick:()=>{e("/search")},className:"shadow-xl border border-gray-300 p-2 rounded-xl flex justify-start space-x-2 items-center bg-white",children:[(0,we.jsx)(je,{c:"#6b7280",w:"22",h:"22"}),(0,we.jsx)("p",{className:"text-gray-500",children:"Search foods or restaurant"})]})]}),(0,we.jsxs)("div",{className:"bg-red-50 px-4 pt-6  grid grid-cols-2 gap-2",children:[(0,we.jsx)(ft,{image:"https://fruitask.com/assets/file_upload/Jk14xOv2XiiDa67/ZGQ5Y245SURFcGlJYnF0MXFGQUR0V09sRGc9PQ.png",title:"Pa-deliver",subtitle:"Crave for food?"}),(0,we.jsxs)("div",{className:"space-y-2",children:[(0,we.jsx)(gt,{image:"https://fruitask.com/assets/file_upload/Jk14xOv2XiiDa67/ZXM5UGpKa0JGNTQ9.png",title:"Pa-palengke",subtitle:"Coming Soon"}),(0,we.jsx)(mt,{image:"https://fruitask.com/assets/file_upload/Jk14xOv2XiiDa67/WjhOTms4SUJHNWlXTmFoNnBBPT0.png",title:"Pa-pickup",subtitle:"Coming Soon"})]})]}),(0,we.jsx)("div",{className:"bg-red-50 px-4 py-2.5",children:(0,we.jsx)(_t,{image:"https://fruitask.com/assets/file_upload/Jk14xOv2XiiDa67/WmM5S2xkWWRGWnFRYWF4NnFsTU90V09sRGc9PQ.png",title:"Pagrocery",subtitle:"Experience the best grocery app"})}),(0,we.jsx)("div",{className:"px-4 py-2",children:(0,we.jsx)(Ae,{text:"Categories"})})]})};const vt=function(){const e=$(),[i,r]=(0,t.useState)(!0),[n,a]=(0,t.useState)(!0),o=()=>{e("/verify")};return(0,we.jsx)("div",{className:"flex justify-center items-center bg-white h-screen w-screen",children:(0,we.jsxs)(we.Fragment,{children:[(0,we.jsx)($e,{shadow:!0,children:(0,we.jsx)("div",{onClick:()=>{a(!n)},children:n?(0,we.jsx)(ct,{text:"Login?"}):(0,we.jsx)(ct,{text:"Create Account?"})})}),(0,we.jsxs)("div",{className:"p-2.5 w-full px-12",children:[(0,we.jsx)("div",{className:"flex justify-center items-center py-4",children:(0,we.jsx)(Se,{})}),(0,we.jsx)("div",{className:"text-center",children:n?(0,we.jsx)(Me,{text:"Join Kiefers today!"}):(0,we.jsx)(Me,{text:"Welcome Back!"})}),(0,we.jsxs)("div",{className:"space-y-2.5 mt-8",children:[(0,we.jsx)(Ze,{}),(0,we.jsx)(Qe,{})]}),(0,we.jsxs)("div",{onClick:()=>{r(!i)},className:"group cursor-pointer my-4 flex justify-start items-center space-x-2.5",children:[(0,we.jsx)("div",{className:"bg-red-100 group-hover:bg-red-200 p-2 w-6 h-6 rounded-md",children:i&&(0,we.jsx)("div",{className:"bg-red-500 group-hover:bg-red-600 h-2 w-2 rounded-md"})}),(0,we.jsx)("p",{children:"Remember this device"})]}),(0,we.jsxs)("div",{children:[n?(0,we.jsx)(nt,{click:o,text:"Create"}):(0,we.jsx)(nt,{click:o,text:"Login"}),(0,we.jsx)("div",{className:"my-6"}),n&&(0,we.jsx)(ot,{click:()=>{e("/home")},text:"Use as Guest"})]}),(0,we.jsx)("div",{className:"mt-14",children:(0,we.jsxs)(Ie,{children:["By proceeding your account you agreeing to ",(0,we.jsx)(ke,{link:"",text:"Kiefers TOC"})," and ",(0,we.jsx)(ke,{link:"",text:"Data Privacy Policy"}),".",(0,we.jsx)("p",{children:"1.1.4"})]})})]})]})})};const xt=function(){return(0,we.jsxs)("div",{className:"flex justify-center bg-white h-screen w-screen",children:[(0,we.jsx)(tt,{shadow:!0}),(0,we.jsxs)("div",{className:"w-full px-5 h-auto",children:[(0,we.jsx)("div",{className:"h-24"}),(0,we.jsx)(Ae,{text:"Recent Searches"}),(0,we.jsx)(dt,{text:"Chaolong ni JC"}),(0,we.jsx)(dt,{text:"Diwata Siken"}),(0,we.jsx)(dt,{text:"Jollibee Siken"}),(0,we.jsx)(Ae,{text:"Suggestions"}),(0,we.jsx)(pt,{image:"https://fruitask.com/assets/file_upload/Jk14xOv2XiiDa67/ZE5oSGk4Y0lWSitEY3Ixdzdsb0Y4bkNnREFTQnFsQjBteFk5SlgxNzhPVzYvZWZzT2JyVmh1L0xoUFJWbHU2dA.jpg",title:"JC Fried Chicken San Jose, Puerto Princesa",subtitle:"8-9 yummy pieces"}),(0,we.jsx)(pt,{image:"https://fruitask.com/assets/file_upload/Jk14xOv2XiiDa67/ZE1aQmk5SUVDZFNYYWJGeHB4UU84M3FvQWcvQzkxNTZtQjg5Sm5WdDlLM2s2K0w1TmJyRmh1amFqcTBTaUxDZ2taND0.jpg",title:"Zeeian Fried Chicken",subtitle:"8-9 yummy pieces and so cripes and juicy and more fillin"})]})]})};var bt=__webpack_require__(879),wt=__webpack_require__.n(bt),St=__webpack_require__(5226);const Tt=JSON.parse('{"v":"4.6.9","fr":28,"ip":0,"op":82,"w":375,"h":281,"nm":"Location Marker","ddd":0,"assets":[],"layers":[{"ddd":0,"ind":2,"ty":4,"nm":"White Outlines","ks":{"o":{"a":0,"k":20},"r":{"a":0,"k":0},"p":{"a":1,"k":[{"i":{"x":0.667,"y":1},"o":{"x":0.333,"y":0},"n":"0p667_1_0p333_0","t":1,"s":[187,181,0],"e":[187,85.125,0],"to":[0,-15.9791669845581,0],"ti":[0,15.1458330154419,0]},{"i":{"x":0.667,"y":1},"o":{"x":0.333,"y":0},"n":"0p667_1_0p333_0","t":4,"s":[187,85.125,0],"e":[187,90.125,0],"to":[0,-15.1458330154419,0],"ti":[0,-0.83333331346512,0]},{"i":{"x":0.667,"y":0.667},"o":{"x":0.333,"y":0.333},"n":"0p667_0p667_0p333_0p333","t":5,"s":[187,90.125,0],"e":[187,90.125,0],"to":[0,0,0],"ti":[0,0,0]},{"i":{"x":0.667,"y":1},"o":{"x":0.333,"y":0},"n":"0p667_1_0p333_0","t":58.714,"s":[187,90.125,0],"e":[187,85.125,0],"to":[0,-0.83333331346512,0],"ti":[0,-15.1458330154419,0]},{"i":{"x":0.667,"y":1},"o":{"x":0.333,"y":0},"n":"0p667_1_0p333_0","t":60.571,"s":[187,85.125,0],"e":[187,181,0],"to":[0,15.1458330154419,0],"ti":[0,-15.9791669845581,0]},{"t":66.142578125}]},"a":{"a":0,"k":[43,43,0]},"s":{"a":1,"k":[{"i":{"x":[0.667,0.667,0.667],"y":[1,1,0.667]},"o":{"x":[0.333,0.333,0.333],"y":[0,0,0.333]},"n":["0p667_1_0p333_0","0p667_1_0p333_0","0p667_0p667_0p333_0p333"],"t":1,"s":[80.531,80.531,100],"e":[100,100,100]},{"i":{"x":[0.667,0.667,0.667],"y":[1,1,0.667]},"o":{"x":[0.333,0.333,0.333],"y":[0,0,0.333]},"n":["0p667_1_0p333_0","0p667_1_0p333_0","0p667_0p667_0p333_0p333"],"t":3,"s":[100,100,100],"e":[110,110,100]},{"i":{"x":[0.667,0.667,0.667],"y":[0.667,0.667,0.667]},"o":{"x":[0.333,0.333,0.333],"y":[0.333,0.333,0.333]},"n":["0p667_0p667_0p333_0p333","0p667_0p667_0p333_0p333","0p667_0p667_0p333_0p333"],"t":5,"s":[110,110,100],"e":[110,110,100]},{"i":{"x":[0.667,0.667,0.667],"y":[0.667,0.667,0.667]},"o":{"x":[0.333,0.333,0.333],"y":[0.333,0.333,0.333]},"n":["0p667_0p667_0p333_0p333","0p667_0p667_0p333_0p333","0p667_0p667_0p333_0p333"],"t":12,"s":[110,110,100],"e":[110,110,100]},{"i":{"x":[0.667,0.667,0.667],"y":[0.667,0.667,0.667]},"o":{"x":[0.333,0.333,0.333],"y":[0.333,0.333,0.333]},"n":["0p667_0p667_0p333_0p333","0p667_0p667_0p333_0p333","0p667_0p667_0p333_0p333"],"t":56,"s":[110,110,100],"e":[110,110,100]},{"i":{"x":[0.667,0.667,0.667],"y":[1,1,0.667]},"o":{"x":[0.333,0.333,0.333],"y":[0,0,0.333]},"n":["0p667_1_0p333_0","0p667_1_0p333_0","0p667_0p667_0p333_0p333"],"t":58.714,"s":[110,110,100],"e":[100,100,100]},{"i":{"x":[0.667,0.667,0.667],"y":[1,1,0.667]},"o":{"x":[0.333,0.333,0.333],"y":[0,0,0.333]},"n":["0p667_1_0p333_0","0p667_1_0p333_0","0p667_0p667_0p333_0p333"],"t":62.429,"s":[100,100,100],"e":[80.531,80.531,100]},{"t":66.142578125}]}},"ao":0,"shapes":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,-23.748],[23.748,0],[0,23.748],[-23.748,0]],"o":[[0,23.748],[-23.748,0],[0,-23.748],[23.748,0]],"v":[[86,43],[43,86],[0,43],[43,0]],"c":true}},"nm":"Path 1","mn":"ADBE Vector Shape - Group"},{"ty":"fl","c":{"a":0,"k":[0.96,0.96,0.96,1]},"o":{"a":0,"k":100},"r":1,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill"}],"ip":0,"op":84,"st":0,"bm":0,"sr":1},{"ddd":0,"ind":4,"ty":4,"nm":"Red circle Outlines","ks":{"o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":1,"k":[{"i":{"x":0.667,"y":1},"o":{"x":0.333,"y":0},"n":"0p667_1_0p333_0","t":1,"s":[187,181,0],"e":[187,85.125,0],"to":[0,-15.9791669845581,0],"ti":[0,15.1458330154419,0]},{"i":{"x":0.667,"y":1},"o":{"x":0.333,"y":0},"n":"0p667_1_0p333_0","t":4,"s":[187,85.125,0],"e":[187,90.125,0],"to":[0,-15.1458330154419,0],"ti":[0,-0.83333331346512,0]},{"i":{"x":0.667,"y":0.667},"o":{"x":0.333,"y":0.333},"n":"0p667_0p667_0p333_0p333","t":5,"s":[187,90.125,0],"e":[187,90.125,0],"to":[0,0,0],"ti":[0,0,0]},{"i":{"x":0.667,"y":1},"o":{"x":0.333,"y":0},"n":"0p667_1_0p333_0","t":58.714,"s":[187,90.125,0],"e":[187,85.125,0],"to":[0,-0.83333331346512,0],"ti":[0,-15.1458330154419,0]},{"i":{"x":0.667,"y":1},"o":{"x":0.333,"y":0},"n":"0p667_1_0p333_0","t":60.571,"s":[187,85.125,0],"e":[187,181,0],"to":[0,15.1458330154419,0],"ti":[0,-15.9791669845581,0]},{"t":66.142578125}]},"a":{"a":0,"k":[56.5,56.5,0]},"s":{"a":1,"k":[{"i":{"x":[0.667,0.667,0.667],"y":[1,1,0.667]},"o":{"x":[0.333,0.333,0.333],"y":[0,0,0.333]},"n":["0p667_1_0p333_0","0p667_1_0p333_0","0p667_0p667_0p333_0p333"],"t":1,"s":[80.531,80.531,100],"e":[100,100,100]},{"i":{"x":[0.667,0.667,0.667],"y":[1,1,0.667]},"o":{"x":[0.333,0.333,0.333],"y":[0,0,0.333]},"n":["0p667_1_0p333_0","0p667_1_0p333_0","0p667_0p667_0p333_0p333"],"t":4,"s":[100,100,100],"e":[120,120,100]},{"i":{"x":[0.667,0.667,0.667],"y":[1,1,0.667]},"o":{"x":[0.333,0.333,0.333],"y":[0,0,0.333]},"n":["0p667_1_0p333_0","0p667_1_0p333_0","0p667_0p667_0p333_0p333"],"t":6,"s":[120,120,100],"e":[110,110,100]},{"i":{"x":[0.667,0.667,0.667],"y":[0.667,0.667,0.667]},"o":{"x":[0.333,0.333,0.333],"y":[0.333,0.333,0.333]},"n":["0p667_0p667_0p333_0p333","0p667_0p667_0p333_0p333","0p667_0p667_0p333_0p333"],"t":12,"s":[110,110,100],"e":[110,110,100]},{"i":{"x":[0.667,0.667,0.667],"y":[1,1,0.667]},"o":{"x":[0.333,0.333,0.333],"y":[0,0,0.333]},"n":["0p667_1_0p333_0","0p667_1_0p333_0","0p667_0p667_0p333_0p333"],"t":56,"s":[110,110,100],"e":[100,100,100]},{"i":{"x":[0.667,0.667,0.667],"y":[1,1,0.667]},"o":{"x":[0.333,0.333,0.333],"y":[0,0,0.333]},"n":["0p667_1_0p333_0","0p667_1_0p333_0","0p667_0p667_0p333_0p333"],"t":60.571,"s":[100,100,100],"e":[80.531,80.531,100]},{"t":66.142578125}]}},"ao":0,"shapes":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,-30.928],[30.928,0],[0,30.928],[-30.928,0]],"o":[[0,30.928],[-30.928,0],[0,-30.928],[30.928,0]],"v":[[112.25,56.25],[56.25,112.25],[0.25,56.25],[56.25,0.25]],"c":true}},"nm":"Path 1","mn":"ADBE Vector Shape - Group"},{"ty":"mm","mm":4,"nm":"Merge Paths 1","mn":"ADBE Vector Filter - Merge"},{"ty":"fl","c":{"a":0,"k":[1,0.02,0.02,1]},"o":{"a":0,"k":100},"r":1,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill"}],"ip":0,"op":84,"st":0,"bm":0,"sr":1},{"ddd":0,"ind":6,"ty":4,"nm":"Shape Layer 1","ks":{"o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":1,"k":[{"i":{"x":0.637,"y":0.846},"o":{"x":0.286,"y":0},"n":"0p637_0p846_0p286_0","t":1,"s":[187,224.5,0],"e":[187,233.585,0],"to":[0,0.2442112416029,0],"ti":[0,-0.75295668840408,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.4,"y":0.583},"n":"0p833_0p833_0p4_0p583","t":4,"s":[187,233.585,0],"e":[187,232.5,0],"to":[0,2.30573344230652,0],"ti":[0,-0.25727394223213,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.333,"y":0},"n":"0p833_0p833_0p333_0","t":7,"s":[187,232.5,0],"e":[187,232.5,0],"to":[0,1.33333337306976,0],"ti":[0,0.25727394223213,0]},{"i":{"x":0.6,"y":0.417},"o":{"x":0.167,"y":0.167},"n":"0p6_0p417_0p167_0p167","t":60,"s":[187,232.5,0],"e":[187,233.585,0],"to":[0,-0.25727394223213,0],"ti":[0,2.30573344230652,0]},{"i":{"x":0.714,"y":1},"o":{"x":0.363,"y":0.154},"n":"0p714_1_0p363_0p154","t":63.071,"s":[187,233.585,0],"e":[187,224.5,0],"to":[0,-0.75295668840408,0],"ti":[0,0.2442112416029,0]},{"t":66.142578125}]},"a":{"a":0,"k":[0,0,0]},"s":{"a":0,"k":[100,100,100]}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":1,"k":[{"i":{"x":0.833,"y":0.833},"o":{"x":0.333,"y":0},"n":"0p833_0p833_0p333_0","t":1,"s":[{"i":[[0,0],[0,0],[0,0],[0,0]],"o":[[0,0],[0,0],[0,0],[0,0]],"v":[[11.314,0],[0,11.314],[-11.314,0],[0,-11.314]],"c":true}],"e":[{"i":[[0,-1.257],[1.257,0],[0,1.257],[-1.257,0]],"o":[[0,1.257],[-1.257,0],[0,-1.257],[1.257,0]],"v":[[7.152,0],[0,7.152],[-7.152,0],[0,-7.152]],"c":true}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"n":"0p833_0p833_0p167_0p167","t":2,"s":[{"i":[[0,-1.257],[1.257,0],[0,1.257],[-1.257,0]],"o":[[0,1.257],[-1.257,0],[0,-1.257],[1.257,0]],"v":[[7.152,0],[0,7.152],[-7.152,0],[0,-7.152]],"c":true}],"e":[{"i":[[0,-2.209],[2.209,0],[0,2.209],[-2.209,0]],"o":[[0,2.209],[-2.209,0],[0,-2.209],[2.209,0]],"v":[[4,0],[0,4],[-4,0],[0,-4]],"c":true}]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0},"n":"0p833_0p833_0p167_0","t":4,"s":[{"i":[[0,-2.209],[2.209,0],[0,2.209],[-2.209,0]],"o":[[0,2.209],[-2.209,0],[0,-2.209],[2.209,0]],"v":[[4,0],[0,4],[-4,0],[0,-4]],"c":true}],"e":[{"i":[[0,-2.209],[2.209,0],[0,2.209],[-2.209,0]],"o":[[0,2.209],[-2.209,0],[0,-2.209],[2.209,0]],"v":[[4,0],[0,4],[-4,0],[0,-4]],"c":true}]},{"i":{"x":0.833,"y":0.837},"o":{"x":0.167,"y":0.167},"n":"0p833_0p837_0p167_0p167","t":63.071,"s":[{"i":[[0,-2.209],[2.209,0],[0,2.209],[-2.209,0]],"o":[[0,2.209],[-2.209,0],[0,-2.209],[2.209,0]],"v":[[4,0],[0,4],[-4,0],[0,-4]],"c":true}],"e":[{"i":[[0,-1.257],[1.257,0],[0,1.257],[-1.257,0]],"o":[[0,1.257],[-1.257,0],[0,-1.257],[1.257,0]],"v":[[7.152,0],[0,7.152],[-7.152,0],[0,-7.152]],"c":true}]},{"i":{"x":0.667,"y":1},"o":{"x":0.167,"y":0.163},"n":"0p667_1_0p167_0p163","t":65.119,"s":[{"i":[[0,-1.257],[1.257,0],[0,1.257],[-1.257,0]],"o":[[0,1.257],[-1.257,0],[0,-1.257],[1.257,0]],"v":[[7.152,0],[0,7.152],[-7.152,0],[0,-7.152]],"c":true}],"e":[{"i":[[0,0],[0,0],[0,0],[0,0]],"o":[[0,0],[0,0],[0,0],[0,0]],"v":[[11.314,0],[0,11.314],[-11.314,0],[0,-11.314]],"c":true}]},{"t":66.142578125}]},"nm":"Path 1","mn":"ADBE Vector Shape - Group"},{"ty":"fl","c":{"a":0,"k":[1,0.02,0.02,1]},"o":{"a":0,"k":100},"r":1,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill"},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Shape 1","np":3,"cix":2,"ix":1,"mn":"ADBE Vector Group"}],"ip":0,"op":84,"st":0,"bm":0,"sr":1},{"ddd":0,"ind":8,"ty":4,"nm":"Layer 4/location_marker_animation Outlines","ks":{"o":{"a":0,"k":100},"r":{"a":0,"k":0},"p":{"a":0,"k":[187,187.5,0]},"a":{"a":0,"k":[2,38,0]},"s":{"a":0,"k":[100,100,100]}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[0,0]],"o":[[0,0],[0,0]],"v":[[2,73],[2,74]],"c":false}},"nm":"Path 1","mn":"ADBE Vector Shape - Group"},{"ty":"st","c":{"a":0,"k":[1,0.02,0.02,1]},"o":{"a":0,"k":100},"w":{"a":0,"k":4},"lc":2,"lj":1,"ml":10,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke"},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 1","np":2,"cix":2,"ix":1,"mn":"ADBE Vector Group"},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[0,0]],"o":[[0,0],[0,0]],"v":[[2,9],[2,70]],"c":false}},"nm":"Path 1","mn":"ADBE Vector Shape - Group"},{"ty":"st","c":{"a":0,"k":[1,0.02,0.02,1]},"o":{"a":0,"k":100},"w":{"a":0,"k":4},"lc":2,"lj":1,"ml":10,"d":[{"n":"d","nm":"dash","v":{"a":0,"k":2}},{"n":"g","nm":"gap","v":{"a":0,"k":6}},{"n":"o","nm":"offset","v":{"a":0,"k":0}}],"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke"},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 2","np":2,"cix":2,"ix":2,"mn":"ADBE Vector Group"},{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,0],[0,0]],"o":[[0,0],[0,0]],"v":[[2,2],[2,3]],"c":false}},"nm":"Path 1","mn":"ADBE Vector Shape - Group"},{"ty":"st","c":{"a":0,"k":[1,0.02,0.02,1]},"o":{"a":0,"k":100},"w":{"a":0,"k":4},"lc":2,"lj":1,"ml":10,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke"},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Group 3","np":2,"cix":2,"ix":3,"mn":"ADBE Vector Group"}],"ip":1,"op":67,"st":-16,"bm":0,"sr":1},{"ddd":0,"ind":10,"ty":4,"nm":"shadow Outlines","ks":{"o":{"a":0,"k":20},"r":{"a":0,"k":0},"p":{"a":0,"k":[187,233,0]},"a":{"a":0,"k":[26,11,0]},"s":{"a":0,"k":[100,100,100]}},"ao":0,"shapes":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[0,-5.919],[14.359,0],[0,5.919],[-14.359,0]],"o":[[0,5.919],[-14.359,0],[0,-5.919],[14.359,0]],"v":[[52,10.718],[26,21.436],[0,10.718],[26,0]],"c":true}},"nm":"Path 1","mn":"ADBE Vector Shape - Group"},{"ty":"fl","c":{"a":0,"k":[0.9373,0.2667,0.2667,1]},"o":{"a":0,"k":100},"r":1,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill"}],"ip":0,"op":84,"st":0,"bm":0,"sr":1}]}'),Et=()=>{const e=(0,t.useRef)(null),i=(0,t.useRef)(null),r=(0,t.useRef)(null),[n,a]=(0,t.useState)(!0),[o,s]=(0,t.useState)("Loading");var l=9.755569056998596,c=118.7480596523905;const h=()=>{JSON.stringify({type:"GO_LOCATION",path:"home"})},u={animationData:Tt,autoplay:!1,loop:!1,speed:1,rendererSettings:{preserveAspectRatio:"xMidYMid slice"}};return(0,t.useEffect)((()=>{const t=new(wt().Map)({container:e.current,style:"mapbox://styles/mapbox/streets-v12",center:[c,l],zoom:15,accessToken:"pk.eyJ1Ijoia2llZmVycyIsImEiOiJjbHhwbWJvMWYwcWx3MmpzZXNxdGhqd3d4In0.oB6CUshVEfETHORooOun_w"});i.current=t;t.on("move",(()=>{s("Please wait"),a(!1),r.current&&r.current.anim.goToAndStop(8,!0)})),t.on("moveend",(async()=>{a(!0);const e=t.getCenter();l=e.lat,c=e.lng,r.current&&r.current.anim.goToAndStop(58,!0);try{await(async(e,t)=>{try{const e=await fetch("http://kiefers-app.com/location/names/?start=9.768555095836641,118.74780653195928&end=9.768555095836641, 118.74780653195928",{method:"GET"});if(e.ok){const t=await e.text();return s("Data:"+t),t}s("Error fetching data:"+e.statusText)}catch(i){s("Error fetching data:"+i)}})()}catch(i){s("Error fetching data: "+i.message)}})),t.on("style.load",(()=>{t.setStyle("mapbox://styles/mapbox/streets-v12")}));t.on("load",(()=>{(()=>{const e=document.querySelector(".mapboxgl-control-container");e&&e.remove();const t=document.querySelector(".mapboxgl-control-container");t&&t.remove()})()}))}),[l,c]),(0,t.useEffect)((()=>{const e=e=>{if("geo"===e.detail.type){var t=JSON.stringify(e.detail.data);const r=JSON.parse(t),n=r.latitude,a=r.longitude;l=n,c=a,i.current.flyTo({center:[c,l],zoom:15,speed:1.2,curve:1,easing:function(e){return e*(2-e)}})}};return window.addEventListener("customMessage",e),()=>{h(),window.removeEventListener("customMessage",e)}}),[]),(0,we.jsxs)("div",{className:"relative",children:[(0,we.jsx)("div",{ref:e,style:{width:"100vw",height:"100vh"}}),(0,we.jsx)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:(0,we.jsx)(St.A,{ref:r,options:u,height:70,width:70})}),n&&(0,we.jsx)("div",{className:"select-none bg-white border-t rounded-t-3xl border-gray-200 absolute z-40 w-full h-56 bottom-0",children:(0,we.jsxs)("div",{className:"p-2.5",children:[(0,we.jsx)(ut,{location:o}),(0,we.jsx)("p",{children:o}),(0,we.jsxs)("div",{children:[(0,we.jsx)(it,{click:h,text:"Save Address"}),(0,we.jsx)(rt,{click:()=>{var e=JSON.stringify({type:"GO_BACK",path:"home"});window.ReactNativeWebView.postMessage(e)},text:"Close"})]})]})})]})};const Mt=function(){return(0,we.jsx)("div",{className:"flex justify-center items-center bg-white h-screen w-screen",children:(0,we.jsxs)(we.Fragment,{children:[(0,we.jsx)(Ke,{shadow:!0}),(0,we.jsxs)("div",{className:"p-2.5 w-full px-12",children:[(0,we.jsxs)("div",{className:"text-center",children:[(0,we.jsx)(Me,{text:"Verify OTP"}),(0,we.jsx)("div",{children:(0,we.jsx)(Xe,{})}),(0,we.jsx)(Ce,{text:"We sent 6-digits code to your email. This process is one-time only."})]}),(0,we.jsxs)("div",{className:"my-4",children:[(0,we.jsx)(nt,{text:"Continue"}),(0,we.jsx)(rt,{text:"Back"})]})]})]})})},At=()=>{const[e,i]=(0,t.useState)([]);return(0,we.jsxs)("div",{children:[(0,we.jsx)($e,{}),(0,we.jsx)("div",{className:"p-4",children:0===e.length?(0,we.jsx)("p",{className:"text-xl text-gray-500 font-medium",children:"Cart is empty"}):(0,we.jsx)("p",{className:"text-2xl font-medium text-gray-500",children:"Cart is full"})})]})},Pt=()=>(0,we.jsxs)("div",{className:"bg-red-50 h-screen w-full",children:[(0,we.jsxs)("div",{className:"relative",children:[(0,we.jsx)("div",{className:"absolute top-2 right-4",children:(0,we.jsx)(He,{c:"#fff",w:"25",h:"25"})}),(0,we.jsx)("img",{src:"https://fruitask.com/assets/file_upload/Jk14xOv2XiiDa67/ZE1aQmk5SUVDZFNYYWJGeHB4UU84M3FvQWcvQzkxNTZtQjg5Sm5WdDlLM2s2K0w1TmJyRmh1amFqcTBTaUxDZ2taND0.jpg",alt:"",className:"w-full h-56 rounded-b-3xl object-cover"})]}),(0,we.jsx)("div",{className:"p-2.5",children:(0,we.jsxs)("div",{className:"bg-white rounded-lg p-2.5 w-full",children:[(0,we.jsx)(Ae,{text:"Miguel Chicken"}),(0,we.jsxs)("div",{className:"flex justify-start items-center space-x-1",children:[(0,we.jsx)(qe,{c:"red",w:"15",h:"15"}),(0,we.jsx)("p",{className:"text-red-500 text-sm font-normal",children:"San Manuel, Villa Mauel, Puerto Princesa,Palawan, Philippines 5300"})]})]})})]});const Ct=function(){const[e,i]=(0,t.useState)(!0);return(0,t.useEffect)((()=>{const e=setTimeout((()=>{i(!1)}),1e3);return()=>clearTimeout(e)}),[]),(0,we.jsx)(ye,{children:(0,we.jsx)("div",{children:(0,we.jsxs)(me,{children:[(0,we.jsx)(pe,{path:"/login",element:(0,we.jsx)(vt,{})}),(0,we.jsx)(pe,{path:"/chat",element:(0,we.jsx)(ht,{})}),(0,we.jsx)(pe,{path:"/home",element:(0,we.jsx)(yt,{})}),(0,we.jsx)(pe,{path:"/search",element:(0,we.jsx)(xt,{})}),(0,we.jsx)(pe,{path:"/setlocation",element:(0,we.jsx)(Et,{})}),(0,we.jsx)(pe,{path:"/verify",element:(0,we.jsx)(Mt,{})}),(0,we.jsx)(pe,{path:"/cart",element:(0,we.jsx)(At,{})}),(0,we.jsx)(pe,{path:"/store",element:(0,we.jsx)(Pt,{})}),(0,we.jsx)(pe,{path:"*",element:(0,we.jsx)(de,{to:"/login"})})]})})})};r.createRoot(document.getElementById("root")).render((0,we.jsx)(t.StrictMode,{children:(0,we.jsx)(Ct,{})}))})()})();
//# sourceMappingURL=main.69e4a08f.js.map